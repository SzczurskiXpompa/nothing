!function(t){function e(e){for(var n,r,o=e[0],l=e[1],c=e[2],h=0,u=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&u.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(d&&d(e);u.length;)u.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(n=!1)}n&&(s.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},a={0:0},s=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=l;s.push([132,1]),i()}([function(t,e,i){const n=i(149);let a=new function(){var t=this;const e=this,i={jQueryObject:!0};let a=null;this.init=()=>{this.prepare(),this.dataAttr2()},this.prepare=()=>{for(let t in n)n[t]=$(n[t])},this.mergeOptions=t=>{a={...i,...t}},this.getTplOld=function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.mergeOptions(n);var s=null.find('[data-template="'+i+'"]').clone();if(s.addClass(s.attr("data-template")).removeAttr("data-template"),!s.length)throw alert("No template found ["+i+"]"),"No template found ["+i+"]";var r=s.find("[data-template-inside]");return r.length>0&&r.each((function(){const t=$(this);var i="data-template-inside",n=t.attr(i),a=e.getTpl(n);t.replaceWith(a),console.log(i)})),a.jQueryObject?s:s[0]},this.getTpl=function(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.mergeOptions(s);let r=n[i];if(!r)throw alert("No template found ["+i+"]"),"No template found ["+i+"]";r=r.clone();let o=r.find("[data-template-inside]");return o.length>0&&o.each((function(){let t=$(this),i="data-template-inside",n=t.attr(i),a=e.getTpl(n);t.replaceWith(a),console.log(i)})),a.jQueryObject?r:r[0]},this.dataAttr=t=>{"undefined"==typeof RUNNING_UNIT_TEST&&t.find("[data-trans]").each((t,e)=>{const i=$(e);var n=i.attr("data-trans").split("#"),a=""!==i.attr("data-tip-type")?i.attr("data-tip-type"):null,s=n[0],r=null,o=null;n.length>1&&(r=n[0]?n[0]:null,s=n[1],void 0!==n[2]&&(o=n[2]));var l=[];l.push(s),l.push(null),o&&l.push(o),r?"data-tip"==r?i.tip(_t.apply(null,l),a):i.attr(r,_t.apply(null,l)):i.html(_t.apply(null,l))})},this.dataAttr2=()=>{for(let t in n)this.dataAttr(n[t])}};a.init(),t.exports.get=a.getTpl},function(t,e){t.exports={NPC:"NPC",FAKE_NPC:"FAKE_NPC",OTHER:"OTHER",HERO:"HERO",PET:"PET",M_ITEM:"M_ITEM",GATEWAY:"GATEWAY",MAP:"MAP",HEROES_RESP:"HEROES_RESP",FLOAT_OBJECT:"FLOAT_OBJECT"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMobileApp=e.debounce=e.replaceNumber=e.enhancedItemConfirmIfNeeded=e.enhancedItemConfirm=e.checkPersonalItems=e.checkEnhancedItems=e.checkReducedRequirementItems=e.checkBetterItemClass=e.sameClGroup=e.getClGroup=e.areAllElementsSame=e.esc=e.copyToClipboard=e.removeFromArray=e.getAllProfName=e.siblings=e.configIcon=e.errorReport=e.count=e.roundToPrevStep=e.roundToNextStep=e.isMan=e.showProfile=e.isDevOrExpe=e.decodeHtmlEntities=e.setOnlyPositiveNumberInInput=e.setAttributes=e.zero=e.ut_fulltime=e.ut_time=e.ut_date=e.isEn=e.isPl=e._l=e.triggerEvent=e.isset=e.clGroups=void 0,e.clGroups={weapons:[1,2,3,4,5,6,7,29],armors:[8,9,10,11,14],jewelry:[12,13]};e.isset=function(t){return void 0!==t};e.triggerEvent=(t,e)=>{const i=new Event(e);t.dispatchEvent(i)};e._l=function(){return __build.lang};e.isPl=function(){return(0,e._l)()==CFG.LANG.PL};e.isEn=function(){return(0,e._l)()==CFG.LANG.EN};e.ut_date=function(t){var i=new Date(1e3*t),n=i.getFullYear();return`${(0,e.zero)(i.getDate())}.${(0,e.zero)(i.getMonth()+1)}.${n}`};e.ut_time=function(t,i){var n=new Date(1e3*t),a=(0,e.zero)(n.getHours())+":"+(0,e.zero)(n.getMinutes());return i&&(a+=":"+(0,e.zero)(n.getSeconds())),a};e.ut_fulltime=function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,e.ut_date)(t)+" "+(0,e.ut_time)(t,i)};e.zero=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=t.toString();for(;i.length<e;)i="0"+i;return i};e.setAttributes=(t,e)=>{for(const i in e)t.setAttribute(i,e[i])};e.setOnlyPositiveNumberInInput=function(t){t.mask("0#")};e.decodeHtmlEntities=function(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value};e.isDevOrExpe=function(){const t=Engine.worldConfig.getWorldName();return"dev"===t||"experimental"===t};e.showProfile=function(t,i){(0,e.isPl)()?Engine.iframeWindowManager.newPlayerProfile({accountId:t,characterId:i}):window.open(`https://margonem.com/profile/view,${t}#char_${i}`,"_blank")};e.isMan=function(t){return"m"===t};e.roundToNextStep=function(t,e){return Math.ceil(t/e)*e};e.roundToPrevStep=function(t,e){return Math.floor(t/e)*e};e.count=(t,e,i)=>{switch(t){case"<":return e<i;case"<=":return e<=i;case">":return e>i;case">=":return e>=i;case"==":return e==i;case"===":return e===i;case"!==":return e!==i;case"includes":return i.includes(e)}};e.errorReport=(t,e,i,n)=>{n=n||"",console.error(`[${t}, ${e}] ${i}`,n)};e.configIcon=()=>{const t=document.createElement("div");return t.classList.add("add-bck","config"),t};e.siblings=t=>[...t.parentElement.children].filter(e=>e!==t);e.getAllProfName=t=>({m:_t("prof_mag",null,"eq_prof"),w:_t("prof_warrior",null,"eq_prof"),p:_t("prof_paladyn",null,"eq_prof"),t:_t("prof_tracker",null,"eq_prof"),h:_t("prof_hunter",null,"eq_prof"),b:_t("prof_bladedancer",null,"eq_prof")}[t]);e.removeFromArray=(t,e)=>{const i=t.indexOf(e);return-1!==i&&(t.splice(i,1),!0)};e.copyToClipboard=t=>{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Your browser doesn't support copy to clipboard")}document.body.removeChild(e)};e.esc=t=>t?encodeURIComponent(t):"";e.areAllElementsSame=t=>{if(0===t.length)return!1;const e=t[0];return t.every(t=>t===e)};e.getClGroup=t=>{let i=null;for(const n of Object.keys(e.clGroups))if(e.clGroups[n].includes(t)){i=n;break}return i};e.sameClGroup=t=>{const i=[];for(const n of t){const t=(0,e.getClGroup)(n);if(null===t)return!1;i.push(t)}return(0,e.areAllElementsSame)(i)};e.checkBetterItemClass=(t,i)=>{if(Array.isArray(t))for(const n of t){const t=Engine.items.getItemById(n);if((0,e.isset)(t)&&t.itemTypeSort>i.itemTypeSort)return!0}else if(t.itemTypeSort>i.itemTypeSort)return!0;return!1};e.checkReducedRequirementItems=t=>{if(Array.isArray(t))for(const i of t){const t=Engine.items.getItemById(i);if((0,e.isset)(t)&&(0,e.isset)(t._cachedStats.lowreq))return!0}else if((0,e.isset)(t._cachedStats.lowreq))return!0;return!1};e.checkEnhancedItems=t=>{if(Array.isArray(t))for(const i of t){const t=Engine.items.getItemById(i);if((0,e.isset)(t)&&(0,e.isset)(t._cachedStats.enhancement_upgrade_lvl))return!0}else if((0,e.isset)(t._cachedStats.enhancement_upgrade_lvl))return!0;return!1};e.checkPersonalItems=t=>{if(Array.isArray(t))for(const i of t){const t=Engine.items.getItemById(i);if((0,e.isset)(t)&&(0,e.isset)(t._cachedStats.personal))return!0}else if((0,e.isset)(t._cachedStats.personal))return!0;return!1};e.enhancedItemConfirm=t=>{const e=_t("enhanced-item-confirm");askAlert({q:e,clb:t,m:"yesno4"})};e.enhancedItemConfirmIfNeeded=(t,i)=>{(0,e.checkEnhancedItems)(t)?(0,e.enhancedItemConfirm)(i):i()};e.replaceNumber=function(t,e){const i=/\d+$/;return null!==t.match(i)?t.replace(i,String(e)):t};e.debounce=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null;return function(){for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];const o=i&&!n,l=()=>t.apply(this,s);clearTimeout(n),n=setTimeout(l,e),o&&l()}};e.isMobileApp=()=>window.navigator.userAgent.includes("MargonemMobile")},function(t,e){t.exports={ACTION:{CREATE:"CREATE",CREATE_FORCE:"CREATE_FORCE",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST",REMOVE:"REMOVE",REMOVE_IF_EXIST:"REMOVE_IF_EXIST",UPDATE:"UPDATE"},GROUP_NAME:{OVERRIDE_OBJECT:"OVERRIDE_OBJECT",OVERRIDE_OBJECT_WITH_LIST:"OVERRIDE_OBJECT_WITH_LIST",OBJECT_WITH_LIST_ACTION_NAME:"OBJECT_WITH_LIST_ACTION_NAME",OBJECT_WITH_LIST_ACTION_TARGET:"OBJECT_WITH_LIST_ACTION_TARGET",OBJECT_WITH_LIST_ACTION_TARGET_ID:"OBJECT_WITH_LIST_ACTION_TARGET_ID",OBJECT_WITH_LIST_ACTION_ID:"OBJECT_WITH_LIST_ACTION_ID",OBJECT_WITH_OPTIONAL_LIST_ACTION_ID:"OBJECT_WITH_OPTIONAL_LIST_ACTION_ID",OBJECT_WITH_LIST_ACTION_ID_NAME:"OBJECT_WITH_LIST_ACTION_ID_NAME",DEFINITIONS_OBJECT:"DEFINITIONS_OBJECT",DEFINITIONS_OBJECT_STORE:"DEFINITIONS_OBJECT_STORE",INSTANT_CALL_OBJECT:"INSTANT_CALL_OBJECT"},TYPE:{VAL_OR_GET_RANDOM_ELEMENTS:"VAL_OR_GET_RANDOM_ELEMENTS",BOOL:"BOOL",INT:"INT",INT_OR_BOOL:"INT_OR_BOOL",INT_OR_GET_CHARACTER_DATA:"INT_OR_GET_CHARACTER_DATA",INT_OR_GET_RANDOM_ELEMENTS:"INT_OR_GET_RANDOM_ELEMENTS",INT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS:"INT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS",FLOAT:"FLOAT",FLOAT_OR_GET_RANDOM_ELEMENTS:"FLOAT_OR_GET_RANDOM_ELEMENTS",FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS:"FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS",ARRAY:"ARRAY",OBJECT:"OBJECT",RGB_COLOR:"RGB_COLOR",RGBA_COLOR:"RGBA_COLOR",RGB_OR_RGBA_COLOR:"RGB_OR_RGBA_COLOR",RGB_OR_RGBA_COLOR_GET_RANDOM_ELEMENTS:"RGB_OR_RGBA_COLOR_GET_RANDOM_ELEMENTS",TARGET:"TARGET"},TARGET_KIND:{THIS_NPC_INSTANCE:"THIS_NPC_INSTANCE"}}},function(t,e,i){let n=i(3),a=i(6),s=i(21),r=i(1);t.exports=function(){const t="RajActionManager.js";let e=null,i=null,o={};const l=n.ACTION,c=l.CREATE_FORCE,d=l.CREATE,h=l.CREATE_IF_NOT_EXIST,u=l.REMOVE,p=l.UPDATE,g=l.REMOVE_IF_EXIST;let f=null,m=null,v=null,E=null,_=null,b=null,w=null,C=null,T=null;const y=e=>{if(e){if(e.createFunc&&e.clearFunc){if(!(!e.removeFunc&&!E))return void errorReport(t,"setDataActions","With clearFunc i available only createFunc",e)}e.createFunc&&(f=e.createFunc,o[d]=!0),e.createRequire&&(b=e.createRequire),e.createRequireFunc&&(w=e.createRequireFunc),e.removeRequire&&(C=e.removeRequire),e.mainDataRequire&&(T=e.mainDataRequire),e.clearFunc&&(_=e.clearFunc,o[d]=!0),e.removeFunc&&(m=e.removeFunc,o[u]=!0),e.updateFunc&&(v=e.updateFunc,o[p]=!0),e.checkExistFunc&&(E=e.checkExistFunc,o[c]=!0,o[h]=!0,o[g]=!0)}},I=t=>{e=t},A=t=>{i=t},k=()=>{let t=[];for(let e in o)t.push(e);return t},S=i=>{const n="checkUpdateDataCorrect";if(!elementIsObject(i))return errorReport(t,n,'first argument in updateData must be object {"action": ... } !!! in module '+e,i),!1;let a=i.action;return a?!!L(a)||(errorReport(t,n,`action ${a} not exist in module ${e}. Available: `,k()),!1):(errorReport(t,n,"attr action not exist in module "+e,i),!1)},O=(e,a)=>{const s=n.TYPE,r=n.GROUP_NAME,o=s.VAL_OR_GET_RANDOM_ELEMENTS;switch(i){case r.OVERRIDE_OBJECT:return!0;case r.OBJECT_WITH_LIST_ACTION_NAME:return D(e,a,{action:!0,name:{type:o}});case r.OBJECT_WITH_LIST_ACTION_TARGET:return D(e,a,{action:!0,target:{type:s.OBJECT}});case r.OBJECT_WITH_LIST_ACTION_TARGET_ID:return D(e,a,{action:!0,target:{type:s.OBJECT,id:!0}});case r.OBJECT_WITH_OPTIONAL_LIST_ACTION_ID:case r.OBJECT_WITH_LIST_ACTION_ID:return D(e,a,{action:!0,id:!0});case r.OBJECT_WITH_LIST_ACTION_ID_NAME:return D(e,a,{action:!0,id:!0,name:{type:o}});case r.DEFINITIONS_OBJECT:case r.DEFINITIONS_OBJECT_STORE:return elementIsObject(e);default:return errorReport(t,"checkCorrectOneData","incorrect kindOfSrajClass!",i,e),!1}},M=i=>{const a="createProcedure";let o=i[0],l=i[1];s.manageRandomElementInObjectIfExist(o),(!b||D(o,l,b))&&(!w||w(o,l))?getEngine().rajCase.checkFullFillCase(o.case,l)&&(o.target&&o.target.kind==n.TARGET_KIND.THIS_NPC_INSTANCE&&(o.target.kind=r.NPC,o.target.id=l.npcId),f.apply(null,i)):errorReport(t,a,`Create procedure in module ${e} have incorrect data. Create procedure failed`,o)},N=i=>{let a=i[0],s=i[1];!C||D(a,s,b)?getEngine().rajCase.checkFullFillCase(a.case,s)&&(a.target&&a.target.kind==n.TARGET_KIND.THIS_NPC_INSTANCE&&(a.target.kind=r.NPC,a.target.id=s.npcId),m.apply(null,i)):errorReport(t,"removeProcedure",`Remove procedure in module ${e} have incorrect data. Remove procedure failed`,a)},R=t=>{let e=t[0],i=t[1];getEngine().rajCase.checkFullFillCase(e.case,i)&&v.apply(null,t)},x=t=>{let e=t[0],i=t[1];getEngine().rajCase.checkFullFillCase(e.case,i)&&_.apply(null,t)},L=t=>!!o[t],D=(i,a,r)=>{const o="checkAttr",l=n.TYPE;if(!elementIsObject(i))return errorReport(t,o,`data in module ${e} have to be object!`,i,a),!1;for(let n in r){let c=r[n];if(!0===c){if(isset(i[n]))continue;return errorReport(t,o,`attr ${n} in module ${e} not exist!`,i,a),!1}let d=i[n];if(c.optional&&!isset(i[n]))continue;let h=c.type;if(!isset(i[n])){if(h&&c.type==l.VAL_OR_GET_RANDOM_ELEMENTS&&s.checkRandomElementsExist(i))continue;return errorReport(t,o,`attr ${n} is obligatory!`,i,a),!1}if(h){if(!P(i,a,n,c,d))return!1}if(c.specificVal){let e;if(e=elementIsArray(c.specificVal)?c.specificVal:[c.specificVal],!e.includes(d))return errorReport(t,o,`val: ${d} of attr: ${n} is incorect!`,{PossibleVals:e,actualData:i},a),!1}if(c.specificFunc&&!c.specificFunc(d))return errorReport(t,o,`val: ${d} of attr: ${n} is incorect!`,i,a),!1;if(c.conditionVal){if(!c.conditionVal[d])return errorReport(t,o,`val: ${d} of attr: ${n} is incorect!`,i,a),!1;if(!D(i,a,c.conditionVal[d]))return!1}if(c.elementInObject){if(!D(i[n],a,c.elementInObject))return!1}if(c.elementInArray)for(let t of i[n]){if(!D(t,a,c.elementInArray))return!1}}return!0},P=(i,o,l,c,d)=>{let h=!1;const u="checkTypeRequire",p=n.TYPE,g=a.checkGetCharacterData,f=s.checkRandomElementsExist;if(elementIsObject(c.type)){let e=c.type.name,n=c.type.option;if(!e)return errorReport(t,u,"Programmer forgive declare name in createRequire type",c),!1;if(!n)return errorReport(t,u,"Programmer forgive declare option in createRequire type",c),!1;if(!elementIsArray(n))return errorReport(t,u,"Programmer forgive declare option like array!",c),!1;switch(e){case p.TARGET:if(!elementIsObject(d))return errorReport(t,u,"target have to be object!",i),!1;if(!isset(d.kind))return errorReport(t,u,"target have to be target.kind!",i),!1;let e=d.kind;return n.includes(e)?e==r.MAP?isset(d.x||d.y)?!(!isIntVal(d.x)||!isIntVal(d.y))||(errorReport(t,u,"target.kind:MAP target.x and target.y have to integer!",i),!1):(errorReport(t,u,"target.kind:MAP have to target.x and target.y",i),!1):a.getTargetObject(d,o):(errorReport(t,u,"not allowed kind in target.kind",i),!1);default:return errorReport(t,u,"UNDEFINED TYPE",c.type,i),!1}}switch(c.type){case p.VAL_OR_GET_RANDOM_ELEMENTS:break;case p.ARRAY:elementIsArray(d)||(h=p.ARRAY);break;case p.OBJECT:elementIsObject(d)||(h=p.OBJECT);break;case p.NUMBER:isInt(d)||isFloatVal(d)||(h=p.NUMBER);break;case p.INT:isInt(d)||(h=p.INT);break;case p.BOOL:isBoolean(d)||(h=p.BOOL);break;case p.INT_OR_BOOL:isInt(d)||isBoolean(d)||(h=p.INT_OR_BOOL);break;case p.INT_OR_GET_CHARACTER_DATA:isInt(d)||g(d)||f(i)||(h=p.INT_OR_GET_CHARACTER_DATA);break;case p.INT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS:isInt(d)||g(d)||f(i)||(h=p.INT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS);break;case p.FLOAT:isFloatVal(d)||(h=p.FLOAT);break;case p.FLOAT_OR_GET_RANDOM_ELEMENTS:isFloatVal(d)||g(d)||f(i)||(h=p.FLOAT_OR_GET_RANDOM_ELEMENTS);break;case p.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS:isFloatVal(d)||g(d)||f(i)||(h=p.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS);break;case p.RGB_COLOR:checkRGBObject(e,u,d,i)||(h=p.RGB_COLOR);break;case p.RGBA_COLOR:checkRGBAObject(e,u,d,i)||(h=p.RGBA_COLOR);break;case p.RGB_OR_RGBA_COLOR:checkRGBOrRGBAObject(e,u,d,i)||(h=p.RGB_OR_RGBA_COLOR);break;case p.RGB_OR_RGBA_COLOR_GET_RANDOM_ELEMENTS:checkRGBOrRGBAObject(e,u,d,i)&&!g(d)||(h=p.RGB_OR_RGBA_COLOR_GET_RANDOM_ELEMENTS);break;default:return errorReport(t,u,"UNDEFINED TYPE",c.type,i),!1}if(h)return errorReport(t,u,`attr ${l} in module ${e} have to be ${h}!`,i),!1;if(c.range){let n=c.range[0],a=c.range[1];if(d<n)return errorReport(t,u,`attr ${l} in module ${e} have too small val! Min val have to be ${n}!`,i),!1;if(d>a)return errorReport(t,u,`attr ${l} in module ${e} have too big val! Max val have to be ${a}!`,i),!1}return!0};this.init=(t,e,i)=>{I(t),i&&(A(i),getEngine().rajController.addSrajClass(i,t)),y(e)},this.checkPossibleAction=e=>{let i=[d];m&&i.push(u),L&&(i.push(c),i.push(h),i.push(g)),v&&i.push(p);let n=i.includes(e);return n||errorReport(t,"checkPossibleAction",`Action ${e} is not possible! Possible action:`,i),n},this.checkCorrectMainData=(a,s)=>{const r="checkCorrectMainData",o=n.GROUP_NAME,l=n.TYPE;let c;switch(i){case o.OVERRIDE_OBJECT:c=elementIsObject(a);break;case o.OVERRIDE_OBJECT_WITH_LIST:case o.OBJECT_WITH_LIST_ACTION_NAME:case o.OBJECT_WITH_LIST_ACTION_TARGET:case o.OBJECT_WITH_LIST_ACTION_TARGET_ID:case o.OBJECT_WITH_LIST_ACTION_ID:case o.OBJECT_WITH_LIST_ACTION_ID_NAME:c=D(a,s,{list:{type:l.ARRAY}});break;case o.OBJECT_WITH_OPTIONAL_LIST_ACTION_ID:c=D(a,s,{list:{type:l.ARRAY,optional:!0}});break;case o.DEFINITIONS_OBJECT:case o.DEFINITIONS_OBJECT_STORE:c=elementIsObject(a);break;case o.INSTANT_CALL_OBJECT:c=!0;break;default:return errorReport(t,r,"incorrect kindOfSrajClass!",i,a),!1}return c?!T||D(a,s,T):(errorReport(t,r,`action in ${e} failed!`,a,s),!1)},this.updateData=function(){const s="updateData";n.GROUP_NAME;let r=arguments[0],o=arguments[1];if(i){if(!O(r,o))return}else errorReport(t,s,`!!!!!!!!!! SRAJ CLASS NOT ADD TO MODULE ${e} !!!!`,r);if(f&&_)return r.action&&warningReport(t,s,`action in module ${e} is deprecated!`,r),r.clear?void x(arguments):void M(arguments);if(!S(r))return;let l=r.action;if(!E){switch(l){case d:M(arguments);break;case u:N(arguments);break;default:errorReport(t,s,"unregistered action!",l)}return}if(l!=h&&l!=g||warningReport(t,s,`action ${l} is deprecated! Use REMOVE or CREATE or CREATE_FORCE. Occurred in module ${e}`,r),!isset(r.id))return void errorReport(t,s,"attr id not exist in module "+e,r);r.id=a.getCharacterData(r.id,o);let m=E(r.id);switch(l){case d:if(m)return void(isDebug()&&warningReport(t,s,`can not call CREATE action in module: ${e} for id: ${r.id}, because already exist!`,r));M(arguments);break;case u:if(!m)return void(isDebug()&&warningReport(t,s,`can not call REMOVE action in module: ${e} for id: ${r.id}, because not exist!`,r));N(arguments);break;case c:m&&N(arguments),M(arguments);break;case h:if(m)return;M(arguments);break;case g:if(!m)return;N(arguments);break;case p:if(!m)return void(isDebug()&&errorReport(t,s,`can not call UPDATE action in module: ${e} for id: ${r.id}, because not exist!`,r));R(arguments)}},this.getArrayOfAllAvailableActionNames=k}},function(t,e){t.exports=new function(){var t=localStorage,e=null,i=this,n=function(){t.setItem("Margonem",JSON.stringify(e))};this.checkToResetLocalStorage=function(){var t=this.get("version");t?t!=CFG.storage.version&&this.resetLocalStorage():this.resetLocalStorage()},this.resetLocalStorage=function(){for(let t=0;t<CFG.storage.keysToRemove.length;t++)this.get(CFG.storage.keysToRemove[t])&&this.remove(CFG.storage.keysToRemove[t]);this.setStorageVersion()},this.setStorageVersion=function(){this.set("version",CFG.storage.version)},this.get=function(t,i){for(var n=t.split("/"),a=e;n.length;){var s=n.splice(0,1)[0];if(void 0===a[s])return void 0===i?null:i;a=a[s]}return a},this.set=function(t,i){for(var a=t.split("/"),s=e;a.length>1;){var r=a.splice(0,1)[0];void 0===s[r]&&(s[r]={}),s=s[r]}s[a[0]]=i,n()},this.easySet=function(t){if(arguments.length<2)return void console.error("[Storage.js, easySet, Incorrect quantity arguments]",arguments);let e=1,n="";for(;arguments[e];){let t=arguments[e];if(!t)return void console.error("[Storage.js, easySet, Incorrect path value]",t);n+=arguments[e]+"/",e++}i.set(n.slice(0,-1),t)},this.easyGet=function(){arguments.length||console.error("[Storage.js, easyGet, Incorrect quantity arguments]",arguments);let t=0,e="";for(;arguments[t];){let i=arguments[t];if(!i)return void console.error("[Storage.js, easyGet, Incorrect path value]",i);e+=arguments[t]+"/",t++}return i.get(e.slice(0,-1))},this.remove=function(t,i){for(var a=t.split("/"),s=e,r=a.splice(0,1)[0];a.length>=1;)s=s[r],r=a.splice(0,1)[0];if(void 0===s[r]){if(i)return void warningReport("Storage.js","remove",t+" not found in storage");throw t+" not found in storage"}delete s[r],n()},null==(e=JSON.parse(t.getItem("Margonem")))&&(e={},n())}},function(t,e,i){const n="RajGetSpecificData.js";let a=i(3),s=i(1);function r(t,e){let i=t.getCharacterData,a=o(i,e);return a?function(t,e){if(!isset(e.toGet))return errorReport(n,"getDataFromTargetObject","attr toGet is obligatory!",e),null;switch(e.toGet){case"nick":return t.getNick();case"x":return c(e,t);case"y":return d(e,t);case"rx":return function(t,e){let i=e.getRX();return c(t,e,i)}(e,t);case"ry":return function(t,e){let i=e.getRY();return d(t,e,i)}(e,t);case"img":return t.getImg();case"oldImg":return t.getOldImg();case"dir":return t.getDir();case"id":return function(t,e){let i=e.getId();t.prefix&&(i=t.prefix+i);t.modify&&(i+=t.modify);return i}(e,t);default:return errorReport(n,"getDataFromTargetObject","undefined data to get",e),null}}(a,i):null}function o(t,e){const i="getTargetObject";if(!isset(t.kind))return errorReport(n,i,"Attr kind is obligatory!",t),null;let r;switch(t.kind){case s.FLOAT_OBJECT:return isset(t.id)?(r=Engine.floatObjectManager.getById(t.id),r||(errorReport(n,i,`NPC with id ${t.id} not exist!`,t),null)):(errorReport(n,i,"Attr id is obligatory!",t),null);case s.FAKE_NPC:return isset(t.id)?(r=Engine.fakeNpcs.getById(t.id),r||(errorReport(n,i,`NPC with id ${t.id} not exist!`,t),null)):(errorReport(n,i,"Attr id is obligatory!",t),null);case s.NPC:return isset(t.id)?(r=Engine.npcs.getById(t.id),r||(errorReport(n,i,`NPC with id ${t.id} not exist!`,t),null)):(errorReport(n,i,"Attr id is obligatory!",t),null);case a.TARGET_KIND.THIS_NPC_INSTANCE:return isset(e.npcId)?(r=Engine.npcs.getById(e.npcId),r||(Engine.npcs.checkDeleteNpc(e.npcId)?(console.log("getFromDeleteNpc"),Engine.npcs.getDeleteNpc(e.npcId)):(errorReport(n,i,`NPC with id ${t} not exist!`,t),null))):(errorReport(n,i,"Attr id is obligatory!",t),null);case s.HERO:return r=Engine.hero,r;case s.PET:return Engine.hero.havePet()?(r=Engine.hero.getPet(),r):(errorReport(n,i,"PET not exist!",t),null);default:return errorReport(n,i,"undefined kind!",t),null}}function l(){switch(Engine.hero.d.dir){case 0:return 0;case 1:return 90;case 2:return-90;case 3:return 180}}function c(t,e,i){if(i=isset(i)?i:e.getX(),isset(t.rotation)){i+=u(t.rotation.x,t.rotation.y,l())[0]}else t.modify&&(i=h(i,t.modify));return i}function d(t,e,i){if(i=isset(i)?i:e.getY(),isset(t.rotation)){i+=u(t.rotation.x,t.rotation.y,l())[1]}else t.modify&&(i=h(i,t.modify));return i}function h(t,e){return t+e}function u(t,e,i){let n=Math.floor(1e3*(i*(Math.PI/180)))/1e3;return[Math.round(t*Math.cos(n)-e*Math.sin(n)),Math.round(t*Math.sin(n)+e*Math.cos(n))]}function p(t){return elementIsObject(t)&&isset(t.getCharacterData)}t.exports={getCharacterData:function(t,e){return p(t)?r(t,e):t},getTargetObject:o,checkGetCharacterData:p}},function(t,e){t.exports={QUICK_ITEMS:"QUICK_ITEMS",GREAT_MERCHAMP:"greatMerchamp",ENCHANT_AUTOFILLER:"ENCHANT_AUTOFILLER",CHAT:"CHAT",HOTKEYS:"hotKeys",SOUND_NOTIFICATION_MOBILE:"soundNotification_mobile",SOUND_NOTIFICATION_PC:"soundNotification_pc",MARGO_SOUNDS_MOBILE:"margoSounds_mobile",MARGO_SOUNDS_PC:"margoSounds_pc",ADDONS:"addons",HOT_WIDGET_MOBILE:"hotWidget_mobile",HOT_WIDGET_PC:"hotWidget_pc",WHO_IS_HERE:"whoIsHere",STORAGE_CONFIG:"storageConfig",WINDOW_DATA:"WINDOW_DATA",LAST_WIDGET_CLICK:"LAST_WIDGET_CLICK",M_CLIENT_DATA:"M_CLIENT_DATA",ADDON_17:"addon_17",ADDON_20:"addon_20",ADDON_27:"addon_27",ADDON_24:"addon_24",SI_STORAGE_CONFIG:"siStorageConfig"}},function(t,e){t.exports={TYPE_OBJECT:{HERO:"hero",NPC:"npc",GROUND_ITEM_COLLECTIONS:"groundItemCollections"},STAT_OPERATION:{NUMBER_EQUAL:"n==",STRING_EQUAL:"s=="},ON_FINISH_TYPE:{REQUIRE:"require",ABSOLUTE_FINISH:"absoluteFinish",BREAK:"break"},ON_FINISH_REQUIRE:{HERO_LEAVE_BATTLE_BUTTON_OR_HOTKEY:"leaveBattleButtonOrHotkey",USE_ITEM_TPL:"useItemTpl",USE_BATTLE_SKILL:"useBattleSkill",ITEMS_IN_BASKET:"itemsInBasket",TALK_NPC_ID:"talkNpcId",ATTACK_NPC_ID:"attackNpcId",MOVE_REQUIRE:"moveRequire",ACCEPT_BASKET:"acceptBasket",CLICK_RECIPE_ON_LIST:"clickRecipeOnList",CLICK_BARTER_OFFER_ON_LIST:"clickBarterOfferOnList",USE_RECIPE:"useRecipe",USE_BARTER_OFFER:"useBarterOffer",CLICK_WIDGET:"clickWidget",OPEN_WINDOW:"openWindow"},ON_FINISH_ABSOLUTE_FINISH:{HERO_END_BATTLE:"heroEndBattle",CLOSE_BATTLE_WINDOW:"closeBattleWindow",START_BATTLE:"startBattle"},ON_FINISH_BREAK:{CLOSE_SHOP:"closeShop",CLOSE_BARTER:"closeBarter",CLOSE_CRAFTING:"closeCrafting"}}},function(t,e){let i="ChatData.js",n={CHANNEL:null,CHANNEL_CARDS:null,SERVER_CHANNEL:null,INPUT_CHANNEL_HEADER:null,INPUT_REGEXP:null,CHANNEL_INPUT_DATA:null,MESSAGE_SECTIONS_VISIBLE:null,MESSAGE_SECTIONS:null,MESSAGE_SUB_SECTIONS:null,MESSAGE_LINK_REGEXP:null,MESSAGE_MARK_REGEXP_KINDS:null,MESSAGE_MARK_REGEXP:null,SYSTEM_MESSAGE_MARK_REGEXP:null,NOTIFICATION:null,AVAILABLE:null,MESSAGES_ADD_TO_GENERAL:null,STATIC_KEYS:null,SERVER_STORAGE:null};function a(t,e){return function(t,e){return'{"width": "'+(e=e||"15px")+'", "height": "15px", "display": "inline-block", "vertical-align": "middle", "background": "url('+t+')"}'}(CFG.a_imgpath+"emots/"+t+".gif",e)}n.SERVER_STORAGE={VISIBLE:"VISIBLE",CHANNEL:"CHANNEL",DATA:"DATA"},n.SERVER_STYLE={ME:2,TOWN:7},n.STYLE={SPECIAL:"special",NAR:"nar",ME:"me"},n.STATIC_KEYS={MESSAGES_ADD_TO_GENERAL:"MESSAGES_ADD_TO_GENERAL",MESSAGES_COLORS:"MESSAGES_COLORS"},n.NOTIFICATION={WATCH:"WATCH",WARNING:"WARNING",MUTE:"MUTE"},n.LINK_TYPES={PLAYER_PROFILE:"player-profile",CLAN_PROFILE:"clan-profile"},n.CHANNEL={GENERAL:"GENERAL",GLOBAL:"GLOBAL",LOCAL:"LOCAL",TRADE:"TRADE",GROUP:"GROUP",CLAN:"CLAN",SYSTEM:"SYSTEM",PRIVATE:"PRIVATE",COMMERCIAL:"COMMERCIAL"},n.CHANNEL_CARDS={GENERAL:"GENERAL",GLOBAL:"GLOBAL",LOCAL:"LOCAL",TRADE:"TRADE",GROUP:"GROUP",CLAN:"CLAN",SYSTEM:"SYSTEM",PRIVATE:"PRIVATE"},n.MESSAGES_ADD_TO_GENERAL_OPT={ADD:"ADD"},n.MESSAGES_COLORS_OPT={EDIT_COLOR:"EDIT_COLOR"},n.SERVER_CHANNEL={[n.CHANNEL.LOCAL]:"local",[n.CHANNEL.GLOBAL]:"global",[n.CHANNEL.TRADE]:"trade",[n.CHANNEL.GROUP]:"party",[n.CHANNEL.CLAN]:"clan",[n.CHANNEL.SYSTEM]:"system",[n.CHANNEL.PRIVATE]:"personal",[n.CHANNEL.COMMERCIAL]:"commercial"},n.KIND_MESSAGE_COLOR={HERO_MSG_COLOR:"HERO_MSG_COLOR",OTHER_MSG_COLOR:"OTHER_MSG_COLOR"},n.MESSAGES_ADD_TO_GENERAL={[n.CHANNEL.GLOBAL]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.LOCAL]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.TRADE]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.GROUP]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.CLAN]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.SYSTEM]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.PRIVATE]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0},[n.CHANNEL.COMMERCIAL]:{[n.MESSAGES_ADD_TO_GENERAL_OPT.ADD]:!0}},n.MESSAGES_COLORS={[n.CHANNEL.GLOBAL]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.LOCAL]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.TRADE]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.GROUP]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.CLAN]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.SYSTEM]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0}},[n.CHANNEL.PRIVATE]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!0,saveApart:!0}},[n.CHANNEL.COMMERCIAL]:{[n.MESSAGES_COLORS_OPT.EDIT_COLOR]:{edit:!1}}},n.MESSAGE_SECTIONS={TS:"TS",CHANNEL_TAG:"CHANNEL_TAG",EMO_ICON:"EMO_ICON"},n.MESSAGE_SUB_SECTIONS={DISPLAY:"DISPLAY",TWELVE_HOUR:"TWELVE_HOUR",ALL_UNIT:"ALL_UNIT",ALL_TAG:"ALL_TAG"},n.MESSAGE_SECTIONS_VISIBLE={TS:{[n.MESSAGE_SUB_SECTIONS.DISPLAY]:!0,[n.MESSAGE_SUB_SECTIONS.TWELVE_HOUR]:!1,[n.MESSAGE_SUB_SECTIONS.ALL_UNIT]:!1},CHANNEL_TAG:{[n.MESSAGE_SUB_SECTIONS.DISPLAY]:!0,[n.MESSAGE_SUB_SECTIONS.ALL_TAG]:!0},EMO_ICON:{[n.MESSAGE_SUB_SECTIONS.DISPLAY]:!1}},n.MESSAGE_LINK_REGEXP={PROFILE:{linkType:n.LINK_TYPES.PLAYER_PROFILE,getText:function(){return"["+_t("player_profile")+"]"},style:'{"color":"#008000","font-weight": "bold"}',htmlClass:"chat-message-profile-link",getTip:function(){return _t("player_profile")},getPattern:function(){return isPl()?new RegExp("^https://www.margonem.pl/profile/view,([0-9]+)($|\\s|&nbsp;|#char_([0-9]+),([a-zA-Z]+))","g"):new RegExp("^https://margonem.com/profile/view,([0-9]+)($|\\s|#char_([0-9]+)($|\\s|,([a-zA-Z]+)($|\\s)))","g")}},CLAN_PROFILE:{linkType:n.LINK_TYPES.CLAN_PROFILE,getText:function(){return"["+getEngine().chatController.chatLang("clanProfile")+"]"},style:'{"color":"#ee82ee","font-weight": "bold"}',htmlClass:"chat-message-clan-link",getTip:function(){return _t("clan_page",null,"clan")},getPattern:function(){let t=isPl()?"www.margonem.pl":"margonem.com";return new RegExp("^https://"+t+"/guilds/view,([a-zA-Z]+),([0-9]+)","g")}}},n.MESSAGE_MARK_REGEXP_KINDS={NORMAL:"NORMAL",TEST:"TEST",EMO_ICON:"EMO_ICON"},n.MESSAGE_MARK_REGEXP={"8p":{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("8p"),dynamicMark:!1,getPattern:function(){return new RegExp(":p","ig")}},aww:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("aww"),dynamicMark:!1,getPattern:function(){return new RegExp(":ahh","ig")}},biggrin_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("biggrin"),dynamicMark:!1,getPattern:function(){return new RegExp(";d","ig")}},biggrin_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("biggrin"),dynamicMark:!1,getPattern:function(){return new RegExp(":d","ig")}},blush_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("blush"),dynamicMark:!1,getPattern:function(){return new RegExp(";wstydnis","ig")}},blush_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("blush"),dynamicMark:!1,getPattern:function(){return new RegExp(":wstydnis","ig")}},boogie:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("blush"),dynamicMark:!1,getPattern:function(){return new RegExp(":tanczy","ig")}},crying:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("crying","25px"),dynamicMark:!1,getPattern:function(){return new RegExp(";\\(","ig")}},doh:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("doh"),dynamicMark:!1,getPattern:function(){return new RegExp("x\\|","ig")}},eek:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("eek"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\|","ig")}},evileye_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("evileye"),dynamicMark:!1,getPattern:function(){return new RegExp(";>","ig")}},evileye_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("evileye"),dynamicMark:!1,getPattern:function(){return new RegExp(":>","ig")}},evillaugh_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("crying","19px"),dynamicMark:!1,getPattern:function(){return new RegExp("]:->","ig")}},evillaugh_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("crying","19px"),dynamicMark:!1,getPattern:function(){return new RegExp("];->","ig")}},kiss_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("kiss"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\*","ig")}},kiss_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("kiss"),dynamicMark:!1,getPattern:function(){return new RegExp(";\\*","ig")}},lol_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("lol"),dynamicMark:!1,getPattern:function(){return new RegExp(";\\)\\)\\)","ig")}},lol_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("lol"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\)\\)\\)","ig")}},mad_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("mad"),dynamicMark:!1,getPattern:function(){return new RegExp(":x","ig")}},mad_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("mad"),dynamicMark:!1,getPattern:function(){return new RegExp(";x","ig")}},o_o_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("o_o"),dynamicMark:!1,getPattern:function(){return new RegExp(";o","ig")}},o_o_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("o_o"),dynamicMark:!1,getPattern:function(){return new RegExp(":o","ig")}},oops:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("oops"),dynamicMark:!1,getPattern:function(){return new RegExp(":oops","ig")}},razz:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("razz"),dynamicMark:!1,getPattern:function(){return new RegExp(";p","ig")}},rotfl:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("rotfl","71px"),dynamicMark:!1,getPattern:function(){return new RegExp(":rotfl","ig")}},sad:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("sad"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\(","ig")}},smile:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("smile"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\)","ig")}},smirk_0:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("smirk"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\]","ig")}},smirk_1:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("smirk"),dynamicMark:!1,getPattern:function(){return new RegExp(";\\]","ig")}},thanks:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("thanks"),dynamicMark:!1,getPattern:function(){return new RegExp(":thx","ig")}},upset:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("upset"),dynamicMark:!1,getPattern:function(){return new RegExp(":\\/","ig")}},wink:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("wink"),dynamicMark:!1,getPattern:function(){return new RegExp(";\\)","ig")}},xd:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("xd"),dynamicMark:!1,getPattern:function(){return new RegExp("xd","ig")}},zombie:{kind:n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,text:"",style:a("zombie"),dynamicMark:!1,getPattern:function(){return new RegExp(":zombie","ig")}},ASD:{kind:n.MESSAGE_MARK_REGEXP_KINDS.TEST,text:"[ASD]",style:'{"color":"yellow"}',dynamicMark:!1,getPattern:function(){return new RegExp("ASD([0-9]{3})","g")}},QWE:{kind:n.MESSAGE_MARK_REGEXP_KINDS.TEST,text:"[QWE]",style:'{"color":"orange"}',dynamicMark:!1,getPattern:function(){return new RegExp("QWE([0-9]{3})","g")}},ZXC:{kind:n.MESSAGE_MARK_REGEXP_KINDS.TEST,text:"[ZXC]",style:'{"color":"red"}',dynamicMark:!1,getTip:function(){return"ZXC_TEST"},getPattern:function(){return new RegExp("ZXC([0-9]{3})","g")}},NICK:{kind:n.MESSAGE_MARK_REGEXP_KINDS.NORMAL,style:'{"color":"#48D1CC","font-weight": "bold"}',dynamicMark:function(t){return t[0]},getPattern:function(){return new RegExp("("+getEngine().hero.d.nick+")","g")}}},n.SYSTEM_MESSAGE_MARK_REGEXP={RELATED_NICK:{style:'{"font-weight": "bold"}',dynamicMark:function(t){return t[0]},getDynamicPattern:function(t){return isset(t.relatedNick)?new RegExp("("+t.relatedNick+")","g"):(errorReport(i,"getDynamicPattern","data.relatedNick not exist",t),null)},editMark:function(t,e,i){t.attachContextMenuToRelatedNick(e,i)}}},n.AVAILABLE={[n.CHANNEL.GENERAL]:!0,[n.CHANNEL.GLOBAL]:!0,[n.CHANNEL.LOCAL]:!0,[n.CHANNEL.TRADE]:!0,[n.CHANNEL.GROUP]:!1,[n.CHANNEL.CLAN]:!1,[n.CHANNEL.SYSTEM]:!0,[n.CHANNEL.PRIVATE]:!0};const s=n.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,r=n.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR;n.INPUT_CHANNEL_HEADER={[n.CHANNEL.GENERAL]:{name:n.CHANNEL.GENERAL,short:{pl:"a",en:"a"},[s]:"#FFFFFF",[r]:"#FFFFFF",inputWrapper:n.CHANNEL.LOCAL,remove:!1,menu:!1},[n.CHANNEL.GLOBAL]:{name:n.CHANNEL.GLOBAL,short:{pl:"o",en:"o"},[s]:"#FFFFFF",[r]:"#FFFFFF",inputWrapper:n.CHANNEL.GLOBAL,remove:!1,menu:!0},[n.CHANNEL.LOCAL]:{name:n.CHANNEL.LOCAL,short:{pl:"l",en:"l"},[s]:"#D49999",[r]:"#D49999",inputWrapper:n.CHANNEL.LOCAL,remove:!0,menu:!0},[n.CHANNEL.TRADE]:{name:n.CHANNEL.TRADE,short:{pl:"h",en:"t"},[s]:"#87fdff",[r]:"#87fdff",inputWrapper:n.CHANNEL.TRADE,remove:!0,menu:!0},[n.CHANNEL.GROUP]:{name:n.CHANNEL.GROUP,short:{pl:"g",en:"p"},[s]:"#b554ff",[r]:"#b554ff",inputWrapper:n.CHANNEL.GROUP,remove:!0,menu:!0},[n.CHANNEL.CLAN]:{name:n.CHANNEL.CLAN,short:{pl:"k",en:"g"},[s]:"#4cfa4f",[r]:"#4cfa4f",inputWrapper:n.CHANNEL.CLAN,remove:!0,menu:!0},[n.CHANNEL.SYSTEM]:{name:n.CHANNEL.SYSTEM,short:{pl:"s",en:"s"},[s]:"#B1B7BD",[r]:"#B1B7BD",inputWrapper:n.CHANNEL.SYSTEM,remove:!0,menu:!1},[n.CHANNEL.COMMERCIAL]:{name:n.CHANNEL.COMMERCIAL,short:{pl:"i",en:"i"},[s]:"#ec0c0c",[r]:"#ec0c0c",inputWrapper:n.CHANNEL.COMMERCIAL,remove:!0,menu:!1},[n.CHANNEL.PRIVATE]:{name:n.CHANNEL.PRIVATE,short:{pl:"p",en:"w"},[s]:"#CC32D0",[r]:"#D38BD5",inputWrapper:n.CHANNEL.PRIVATE,remove:!0,menu:!1}},n.INPUT_CHANNEL_MODE={[n.STYLE.SPECIAL]:{name:n.STYLE.SPECIAL,short:"s",request:"special"},[n.STYLE.NAR]:{name:n.STYLE.NAR,short:"n",request:"nar"},[n.STYLE.ME]:{name:n.STYLE.ME,short:"m",request:"me"}},n.INPUT_REGEXP={$_LINKED_ITEMS:{tag:"$_LINKED_ITEMS",getSrc:function(){return createTextGraphic("["+getEngine().chatController.chatLang("Item")+"]",13,"yellow","").url},getPattern:function(){return new RegExp("ITEM#([0-9a-z]{64}|[0-9]{7,11})(\\.[a-z]+|)(\\s|&nbsp;)","g")}},$_TEST_ASD_ITEMS:{tag:"$_TEST_ASD_ITEMS",getSrc:function(){return createTextGraphic("[ASD_TEST]",13,"pink","").url},getPattern:function(){return new RegExp("ASD([0-9]{3})","g")}},$_TEST_QWE_ITEMS:{tag:"$_TEST_QWE_ITEMS",getSrc:function(){return createTextGraphic("[QWE_TEST]",13,"orange","").url},getPattern:function(){return new RegExp("QWE([0-9]{3})","g")}},$_TEST_ZXC_ITEMS:{tag:"$_TEST_ZXC_ITEMS",getSrc:function(){return createTextGraphic("[ZXC_TEST]",13,"red","").url},getPattern:function(){return new RegExp("ZXC([0-9]{3})","g")}},$_PROFILE_ITEMS:{tag:"$_PROFILE_ITEMS",getSrc:function(){return createTextGraphic("["+getEngine().chatController.chatLang("playerProfile")+"]",13,"green","").url},getPattern:function(){return isPl()?new RegExp("(^|&nbsp;|\\s)https://www.margonem.pl/profile/view,([0-9]+)(\\s|&nbsp;|#char_([0-9]+),([a-zA-Z]+)(\\s|&nbsp;))","g"):new RegExp("(^|&nbsp;|\\s)https://margonem.com/profile/view,([0-9]+)(\\s|&nbsp;|(#char_([0-9]+(\\s|&nbsp;|,[a-zA-Z]+(\\s|&nbsp;)))))","g")}},$_CLAN_ITEMS:{tag:"$_CLAN_ITEMS",getSrc:function(){return createTextGraphic("["+getEngine().chatController.chatLang("clanProfile")+"]",13,"violet","").url},getPattern:function(){return new RegExp("(^|&nbsp;|\\s)https://www.margonem.pl/guilds/view,([a-zA-Z]+),([0-9]+)(\\s|&nbsp;)","g")}}},n.CHANNEL_INPUT_DATA=[{callback:function(){let t=getEngine().chatController.getChatChannelCardWrapper().getActiveChannelName(),e=n.INPUT_CHANNEL_HEADER[t].inputWrapper,i=n.INPUT_CHANNEL_HEADER[e];getEngine().chatController.getChatInputWrapper().setChannel(i)},getPattern:function(){return new RegExp("^/b(\\s|&nbsp;)","g")}},{callback:function(){let t=getEngine().chatController.getChatPrivateMessageData().getLastUserWhoSendToHeroPrivateMessage();t?getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.PRIVATE,t):message(getEngine().chatController.chatLang("nobodySendToYouAnyPrivateMessage"))},getPattern:function(){return new RegExp("^/r(\\s|&nbsp;)","g")}},{callback:function(){let t=getEngine().chatController.getChatPrivateMessageData().getLastUserWhoGetFromHeroPrivateMessage();t?getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.PRIVATE,t):message(getEngine().chatController.chatLang("youDoNotSendAnyPrivateMessageToUsers"))},getPattern:function(){return new RegExp("^/rr(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(n.CHANNEL.GROUP)&&getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.GROUP)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GROUP);return new RegExp("^/"+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(n.CHANNEL.GROUP)&&getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.GROUP)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GROUP);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.TRADE)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.TRADE);return new RegExp("^/"+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.TRADE)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.TRADE);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.LOCAL)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.LOCAL);return new RegExp("^/"+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.SYSTEM)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.SYSTEM);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.LOCAL)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.LOCAL);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.PRIVATE)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.PRIVATE);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(n.CHANNEL.CLAN)&&getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.CLAN)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.CLAN);return new RegExp("^/"+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(n.CHANNEL.CLAN)&&getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.CLAN)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.CLAN);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.GLOBAL)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GLOBAL);return new RegExp("^/"+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.GLOBAL)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GLOBAL);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.GENERAL)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GENERAL);return new RegExp("^/"+t+t+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.GLOBAL,n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].request)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.GLOBAL),e=n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].short;return new RegExp("^/"+t+e+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.LOCAL,n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].request)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.LOCAL),e=n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].short;return new RegExp("^/"+t+e+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.LOCAL,n.INPUT_CHANNEL_MODE[n.STYLE.ME].request)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.LOCAL),e=n.INPUT_CHANNEL_MODE[n.STYLE.ME].short;return new RegExp("^/"+t+e+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.LOCAL,n.INPUT_CHANNEL_MODE[n.STYLE.NAR].request)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.LOCAL),e=n.INPUT_CHANNEL_MODE[n.STYLE.NAR].short;return new RegExp("^/"+t+e+"(\\s|&nbsp;)","g")}},{callback:function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.TRADE,n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].request)},getPattern:function(){let t=getEngine().chatController.getChatDataUpdater().getShortInputChannelData(n.INPUT_CHANNEL_HEADER.TRADE),e=n.INPUT_CHANNEL_MODE[n.STYLE.SPECIAL].short;return new RegExp("^/"+t+e+"(\\s|&nbsp;)","g")}},{callback:function(t){getEngine().chatController.getChatInputWrapper().setChannel(n.INPUT_CHANNEL_HEADER.PRIVATE,t)},getValFromPatter:!0,getPattern:function(){return new RegExp("^@([-'`~ĄąĆćĘęŁłŃńÓóŚśŹźŻż_a-zA-Z]+)(\\s|&nbsp;)","g")}}],t.exports=n},function(t,e,i){i(17);t.exports={TYPE:{NPC:"npc",RESP:"resp",OTHER:"other",RIP:"rip",GATEWAY:"gateway",ITEM:"item",HERO:"hero"},KIND:{HERO:"hero",GATEWAY:"gateway",RIP:"rip",HEROES_RESP:"heroes-resp",HEROES_RESP_E:"heroes-resp-e",RECOVERY:"recovery",NPCS:"npcs",NORMAL_MONSTER:"normal-monster",ELITE_1:"elita1",ELITE_2:"elita2",ELITE_3:"elita3",HEROS:"heros",COLOSSUS:"colossus",TYTAN:"tytan",MARK_OBJECT:"mark-object",NORMAL_OTHER:"normal-other",FRIEND:"fr",ENEMY:"en",CLAN:"cl",CLAN_FRIEND:"cl-fr",CLAN_ENEMY:"cl-en",GROUP:"group",WANTED:"wanted"},STATIC_ICONS:{CIRCLE:1,SQUARE:0,RHOMB:2},MIN_SQUARE:14,MIN_SIZE:7,MIN_LEVEL_DATA:{KEY:"min-level",DEFAULT:0,MIN:0,MAX:300},DATA_DRAWER_WIDTH_DATA:{KEY:"data-drawer-width",DEFAULT:96,MIN:32,MAX:128},DATA_DRAWER_FONT_SIZE_DATA:{KEY:"data-drawer-font-size",DEFAULT:10,MIN:8,MAX:14}}},function(t,e){t.exports={N:"N",S:"S",E:"E",W:"W",dirMapping:["S","W","E","N"]}},function(t,e,i){var n=i(15);t.exports=new function(){this.isBlessSt=function(t){return t===n.ST.BLESS},this.isWeaponShieldOrArrowSt=function(t){return t===n.ST.WEAPON_SHIELD_OR_ARROW},this.isPurseSt=t=>t==n.ST.PURSE,this.isBagSlotSt=t=>t>=n.ST.BAG_0_SLOT&&t<=n.ST.BAG_KEYS_SLOT,this.isBag_0_SlotSt=t=>t==n.ST.BAG_0_SLOT,this.isBag_Keys_SlotSt=t=>t==n.ST.BAG_KEYS_SLOT,this.isInBagSt=t=>t==n.ST.IN_BAG,this.isInBagOrInEquipNotBagsSlotsSt=t=>t>=n.ST.IN_BAG&&t<=n.ST.BLESS,this.isEquippedButNotPurseNotBlessNotBagsSlotsSt=t=>t&&t>0&&t<=8,this.isEquippedSt=t=>t>n.ST.IN_BAG}},function(t,e){t.exports={OBJECT_TYPE:{PET:3,NPC:2,OTHER:1,HERO:0},ACTION:{ON_SELF:"OnSelf",REMOVER:"remover",LANTERN:"Lantern",FIRE:"Fire",STICK_TO_PLAYER:"StickToAnotherPlayer",STICK_TO_MAP:"StickToMap",CHAR_TO_CHAR:"CharToChar",BETWEEN_PLAYERS:"BetweenPlayers",SCRIPT_EMO:"ScriptEmo"},NAME:{NPC_TALK:"NPC_TALK",BLUE_EXCLAMATION:"b_exclamation",DAILY_QUEST:"DAILY_QUEST",RED_EXCLAMATION:"r_exclamation",YELLOW_EXCLAMATION:"y_exclamation",NORMAL_QUEST:"NORMAL_QUEST",ELITE_HERE:"elite_here",AGGRESSIVE:"aggressive",WALKOVER:"walkOver",FLAG_ENGLAND:"flag-anglia.gif",FLAG_CROATIA:"flag-chorwacja.gif",FLAG_CZECH:"flag-czechy.gif",FLAG_DENMARK:"flag-dania.gif",FLAG_FRANCE:"flag-francja.gif",FLAG_GREECE:"flag-grecja.gif",FLAG_SPAIN:"flag-hiszpania.gif",FLAG_NETHERLAND:"flag-holandia.gif",FLAG_IRELAND:"flag-irlandia.gif",FLAG_GERMANY:"flag-niemcy.gif",FLAG_POLAND:"flag-polska.gif",FLAG_PORTUGAL:"flag-portugalia.gif",FLAG_RUSSIA:"flag-rosja.gif",FLAG_SKULL:"flag-skull.gif",FLAG_SWEDEN:"flag-szwecja.gif",FLAG_UKRAINE:"flag-ukraina.gif",FLAG_ITALY:"flag-wlochy.gif",ABBYS_OUT:"abyssout",ANGRY:"angry",AWAY:"away",BAT:"bat",BATTLE:"battle",STASIS:"stasis",STASIS_INCOMING:"away",FRND:"frnd",LOGIN:"login",LOGOFF:"logoff",LVL_UP:"lvlup",PVP_PROTECTED:"pvpprotected",RESPAWNED:"respawned",SPIDER:"spider",TELEPORTED:"teleported",BUBBLES:"banki",CURSE:"curse",TUNE:"emonutki",GUM_1:"guma1",GUM_2:"guma2",GUM_3:"guma3",GUM_4:"guma4",KUCIAK:"kuciak",BIRD:"ptaszek",EMO_SNOW:"emosnow",GHOST:"ghost",WATER:"water",FACE_1:"buzia1",FACE_2:"buzia2",ROSE:"roza",COCOS:"cocos",EMO_HUG_1:"emohug1",EMO_HUG_2:"emohug2",EMO_HUG_3:"emohug3",GIFT:"gift",HOLLY:"holly",SNOWBALL:"snowball",PILLOW:"pillow",FIRE_1:"fire_1",FIRE_2:"fire_2",FIRE_3:"fire_3",FIRE_4:"fire_4",FIRE_5:"fire_5",FIRE_6:"fire_6",FIRE_7:"fire_7",FIRE_8:"fire_8",FIRE_9:"fire_9",FIREWORKS:"fireworks",STARS:"stars",TERMOFOR:"termofor",LANTERN_1:"lampion1",LANTERN_2:"lampion2",LANTERN_3:"lampion3",LANTERN_4:"lampion4",LANTERN_5:"lampion5",NO_EMO:"noemo",ZOMBIE:"zombie",KISS_1:"kiss",KISS_2:"kiss2",VISUAL_EFFECTS:"VisualEffects",AUCTION:"AUCTION",MAIL:"MAIL",SHOP:"SHOP",HEAL:"HEAL",DEPO:"DEPO",DEPO_CLAN:"DEPO_CLAN",INKEEPER:"INKEEPER"}}},function(t,e){t.exports={WARRIOR:"w",PALADIN:"p",MAGE:"m",HUNTER:"h",TRACKER:"t",BLADE_DANCER:"b"}},function(t,e){t.exports={ST:{IN_BAG:0,HEAD:1,FINGER:2,NECKLACE:3,GLOVES:4,MAIN_WEAPON:5,ARMOR:6,WEAPON_SHIELD_OR_ARROW:7,SHOES:8,PURSE:9,BLESS:10,BAG_0_SLOT:20,BAG_1_SLOT:21,BAG_2_SLOT:22,BAG_KEYS_SLOT:26},CL:{ONE_HAND_WEAPON:1,TWO_HAND_WEAPON:2,ONE_AND_HALF_HAND_WEAPON:3,DISTANCE_WEAPON:4,HELP_WEAPON:5,WAND_WEAPON:6,ORB_WEAPON:7,ARMOR:8,HELMET:9,BOOTS:10,GLOVES:11,RING:12,NECKLACE:13,SHIELD:14,NEUTRAL:15,CONSUME:16,GOLD:17,KEYS:18,QUEST:19,RENEWABLE:20,ARROWS:21,TALISMAN:22,BOOK:23,BAG:24,BLESS:25,UPGRADE:26,RECIPE:27,COINAGE:28,QUIVER:29,OUTFITS:30,PETS:31,TELEPORTS:32}}},function(t,e){t.exports={TYPE:{TEXT:"text",NUMBER:"number",NUMBER_FLOAT:"number_float",NUMBER_WITH_KMG:"number_with_kmg"}}},function(t,e){t.exports={KIND:{FRIEND:"f",ENEMY:"e",WANTED:"w"},STATE:{ONLINE:"online"},RELATION:{NONE:1,FRIEND:2,ENEMY:3,CLAN:4,CLAN_ALLY:5,CLAN_ENEMY:6,FRACTION_ALLY:7,FRACTION_ENEMY:8}}},function(t,e,i){const n=i(0);t.exports=function(){this.initWindow=function(){Engine.windowManager.add({content:n.get("draconite-shop"),nameWindow:Engine.windowsData.name.DRACONITE_SHOP,nameRefInParent:"wnd",objParent:this,title:_t("buy_sl_pane",null,"shop"),onclose:()=>{this.close()}})},this.open=function(){if(isset(Engine.hero.d.guest)){const t=_t("guest_cannot_buy_draconite");return mAlert(t),void(Engine.draconiteShop=!1)}if(!isPl()){return window.open("https://margonem.com/draconite").opener=null,void(Engine.draconiteShop=!1)}this.initWindow(),this.wnd.$.find("iframe").attr("src","https://www.margonem.pl/profile/payments"),this.wnd.addToAlertLayer(),this.wnd.setWndOnPeak(),this.wnd.center(),this.wnd.$.show()},this.close=function(){Engine.draconiteShop=!1,this.wnd.remove()}}},function(t,e){t.exports={CATEGORY:{weapon:[1,4,2,6,7,3,5,29],armor:[8,11,10,14,9,12,13],other:[23,16,15,22,24,27,28,32]},MY_AUCTION:"MY_AUCTION",UPDATE_PAGES:"UPDATE_PAGES",KIND_MY_AUCTION:{MY_AUCTION_OFF:1,MY_WATCH:3,MY_BID:2},KIND_OTHERS_AUCTION:{ALL_AUCTION:4},TYPE_OF_AUCTION:{NORMAL:"NORMAL",EVENT:"EVENT"},ALL_AUCTION:"ALL_AUCTION",AUCTION_CEIL:{ITEM_SLOT_TD:{key:"item-slot-td",sort:null},ITEM_TIME_TD:{key:"item-time-td",sort:1},ITEM_BID_TD:{key:"item-bid-td",sort:2},ITEM_BUY_NOW_TD:{key:"item-buy-now-td",sort:3},ITEM_LEVEL_TD:{key:"item-level-td",sort:4},ITEM_NAME_TD:{key:"item-name-td",sort:5},AUCTION_ACTION_TD:{key:"auction-action-td",sort:null}},SORT_ORDER:{ASC:0,DESC:1},FILTER_KEYS:{FILTER_ID:"FILTER_ID",FILTER_NAME:"FILTER_NAME",FILTER_VAL:"FILTER_VAL",MIN_LEVEL:"MIN_LEVEL",PROF:"PROF",MAX_LEVEL:"MAX_LEVEL",RARITY:"RARITY",MIN_PRICE:"MIN_PRICE",MAX_PRICE:"MAX_PRICE",AUCTION_TYPE:"AUCTION_TYPE",NAME_ITEM:"NAME_ITEM"},FILTER_ID:{EMPTY_FILTER:-2,ADD_FILTER:-1},TYPE_OF_BUY_AUCTION:{ALL:0,BUY_NOW:1,BIDS:2},TYPE_OF_RARITY:{ALL:0,UNIQUE:1,HEROIC:2,LEGENDARY:3},BIDDER_VALUES:{NO_BIDDER:0,SOMEBODY_BID:1,YOU_BID:2},MAX_QUANTITY_OF_ITEMS_PACKAGE:15,COST_FEATURED_AUCTION:100,MAX_FEATURED_COUNT:10,MAX_OBSERVED:100}},function(t,e){t.exports={MINI_MAP_CONTROLLER:{mainKey:"miniMapController-window",STATE:"state"},HAND_HELD_DATA:{mainKey:"handheld-window",COLOR:"color",ICON:"icon",STATE:"state",MIN_LEVEL:"min-level",DATA_DRAWER_STATE:"data-drawer-state",DATA_DRAWER_NICK_STATE:"data-drawer-nick-state",DATA_DRAWER_LVL_AND_PROF_STATE:"data-drawer-lvl-and-prof-state",DATA_DRAWER_FONT_SIZE:"data-drawer-font-size",DATA_DRAWER_WIDTH:"data-drawer-width",WHO_IS_HERE:"who-is-here",MAP_BLUR:"map-blur",AMOUNT:"amount",SHOW:"show",BIG:"big"},WINDOW_DATA:{mainKey:"WINDOW_DATA",OPACITY:"opacity",COLLAPSE:"COLLAPSE",POSITION:"pos",SHOW:"SHOW"},WHO_IS_HERE:{mainKey:"whoIsHere"},GLOBAL_ADDONS:{mainKey:"globalAddons"},BATTLE_PANEL:{mainKey:"BATTLE_PANEL",BATTLE_PANEL_SIZE:"BATTLE_PANEL_SIZE",ATTACH_BATTLE_LOG_HELP_WINDOW:"ATTACH_BATTLE_LOG_HELP_WINDOW",BATTLE_LOG_HELP_WINDOW_SIZE_OPT:"BATTLE_LOG_HELP_WINDOW_SIZE_OPT",ATTACH_BATTLE_PREDICTION_HELP_WINDOW:"ATTACH_BATTLE_PREDICTION_HELP_WINDOW",BATTLE_PREDICTION_HELP_WINDOW_SIZE_OPT:"BATTLE_PREDICTION_HELP_WINDOW_SIZE_OPT"}}},function(t,e){const i="RajRandomElements.js";function n(t){return!!t.getRandomElements}function a(t){const e="randRandomElements";let n=t.getRandomElements;if(!elementIsObject(n))return void errorReport(i,e,"getRandomElements is not object!",t);let a=n.options;if(!a)return void errorReport(i,e,"getRandomElements have to attr options!",t);let s=getRandomElementFromArray(a);for(let e in s)t[e]=s[e];delete t.getRandomElements}t.exports={checkRandomElementsExist:n,manageRandomElementInObjectIfExist:function(t){n(t)&&a(t)},manageRandomElementInBehaviorIfExist:function(t){if(!t)return;let e=t.list;for(let t in e){let i=e[t];n(i)&&a(i)}}}},function(t,e){t.exports={INTERFACE_SKIN:"interfaceSkin",WEATHER:"weather",NIGHT:"night",OVERRIDE_DAY_NIGHT_CYCLE:"overrideDayNightCycle",SCREEN_EFFECTS:"screenEffects",MAP_FILTER:"mapFilter",EARTHQUAKE:"earthQuake",CHARACTER_EFFECT:"characterEffect",FAKE_NPC:"fakeNpc",TUTORIAL:"tutorial",BATTLE_EVENTS:"battleEvents",MAP_EVENTS:"mapEvents",CHARACTER_IMAGE_CHANGER:"characterImageChanger",WINDOW_EVENTS:"windowEvents",MAP_EXTERNAL_PROPERTIES_REFRESH:"mapExternalPropertiesRefresh",PROGRAMMER:"programmer",EXTRA_LIGHT:"extraLight",DYNAMIC_LIGHT:"dynamicLight",DYNAMIC_DIR_CHARACTER_LIGHT:"dynamicDirCharacterLight",BEHAVIOR_DYNAMIC_LIGHT:"behaviorDynamicLight",TEMPLATE:"template",FLOAT_FOREGROUND:"floatForeground",FLOAT_OBJECT:"floatObject",TRACKING:"tracking",CAMERA:"camera",CHARACTER_HIDE:"characterHide",DIALOGUE:"dialogue",EMO_DEFINITIONS:"emoDefinitions",EMO_ACTIONS:"emoActions",YELLOW_MESSAGE:"yellowMessage",SEQUENCE:"sequence",RANDOM_CALLER:"randomCaller",SOUND:"sound",AREA_TRIGGER:"areaTrigger",CONNECT_SRAJ:"connectSraj",MAP_MUSIC:"mapMusic",ZOOM:"zoom"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.default=class{constructor(t){this.disabled=!1,this.el=n.get("button")[0],this.createButton(t)}createButton(t){let{text:e,classes:i,action:n,tip:a,disabled:s}=t;i&&this.el.classList.add(...i),this.el.addEventListener("click",t=>{n&&n(t)}),s&&this.setState(!0),a&&this.setTip(a),"string"==typeof e||void 0===e?this.el.querySelector(".label").innerText=e:this.el.querySelector(".label").appendChild(e)}setState(t){this.disabled=t,this.disabled?this.el.classList.add("disable"):this.el.classList.remove("disable")}getState(){return this.disabled}setTip(t){return $(this.el).tip(t)}getButton(){return this.el}}},function(t,e,i){let n=i(10);t.exports=function(){let t,e="MiniMapObject.js",i=null,a=null,s=null,r=null,o=null,l=null,c=null,d=null,h=null,u=0;function p(t){o=t}function g(){let t=Engine.miniMapController.handHeldMiniMapController.getMiniMapTipController(),e=f();t.removeFromCords(s.d.x,s.d.y,o,e)}function f(){let t;switch(o){case n.TYPE.NPC:case n.TYPE.HERO:case n.TYPE.OTHER:case n.TYPE.ITEM:case n.TYPE.RIP:case n.TYPE.RESP:t=s.d.id;break;case n.TYPE.GATEWAY:t=s.d.affectedId;break;default:console.error("incorrect type",o)}return t}function m(){let t=Engine.miniMapController.handHeldMiniMapController.getObjectController(o),e=f();t.deleteFromList(r,e),p(null)}function v(t,e){let n=t.createRadialGradient(0,0,0,0,0,Math.round(e-.4*e));return n.addColorStop(0,"white"),n.addColorStop(1,i),n}function E(t,e){Engine.miniMapController.handHeldMiniMapController.getImageObjectController().addImageObject(t,a,e,i)}this.remove=function(){null!=o&&g(),null!=o&&m()},this.addToBelongList=function(t){p(t);let i,a=Engine.miniMapController.handHeldMiniMapController.getObjectController(o);switch(t){case n.TYPE.NPC:case n.TYPE.OTHER:case n.TYPE.ITEM:case n.TYPE.RIP:case n.TYPE.RESP:i=s.d.id;break;case n.TYPE.GATEWAY:i=s.d.affectedId;break;default:errorReport(e,"addToBelongList","type not exist",t)}a.addToList(r,i)},this.deleteFromBelongList=m,this.setRef=function(t){s=t},this.setTip=function(t,e,i,n){l=[t,e,i,n]},this.getTip=function(){return l},this.checkCanShowTip=function(){return Engine.rajCharacterHide.checkShowTip(s)},this.setAlpha=function(t){h=t},this.getRef=function(){return s},this.draw=function(e,r){if(!s)return;if(!Engine.rajCharacterHide.checkDisplayOnMiniMap(s))return;let o=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),l=o.getMargin(),c=o.getSquareData();!function(e){if(!t){let s=e.minSize,r=function(t){let e=Engine.miniMapController.handHeldMiniMapController.getImageObjectController();return e.checkImageObjectExist(a,t,i)?e.getImageObject(a,t,i):null}(s);switch(a){case n.STATIC_ICONS.SQUARE:r?t=r:(t=function(t){let e=document.createElement("canvas"),i=e.getContext("2d"),n=t.minSize;return e.width=n+5,e.height=n+5,i.save(),i.fillStyle=v(i,e.width),i.fillRect(0,0,n,n),i.restore(),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(0,0,n,n),e}(e),E(t,s));break;case n.STATIC_ICONS.CIRCLE:r?t=r:(t=function(t){let e=document.createElement("canvas"),i=e.getContext("2d"),n=t.minSize;e.width=n+5,e.height=n+5;let a=t.halfMinSize;return i.fillStyle=v(i,e.width),i.save(),i.beginPath(),i.arc(a,a,a,0,2*Math.PI,!1),i.fill(),i.restore(),i.beginPath(),i.arc(a,a,a,0,2*Math.PI,!1),i.lineWidth=1,i.strokeStyle="#003300",i.stroke(),e}(e),E(t,s));break;case n.STATIC_ICONS.RHOMB:r?t=r:(t=function(t){let e=document.createElement("canvas"),i=e.getContext("2d"),n=t.margin,a=t.minSize,s=Math.round(a+n),r=Math.round(s/2);return e.width=s+5,e.height=s+5,i.save(),i.fillStyle=v(i,s),i.beginPath(),i.moveTo(r,0),i.lineTo(s,r),i.lineTo(r,s),i.lineTo(0,r),i.closePath(),i.fill(),i.restore(),i.beginPath(),i.moveTo(r,0),i.lineTo(s,r),i.lineTo(r,s),i.lineTo(0,r),i.closePath(),i.lineWidth=1,i.strokeStyle="#003300",i.stroke(),e}(e),E(t,s))}}}(c),function(t){null!=h&&function(t){u+=3*t,u>3.14&&(u=0);h=Math.round(100*Math.sin(u))/100}(t)}(r),function(e,i,n){if(!t)return;let a=n.normalSize,r=n.margin;null!=h&&(e.globalAlpha=h);e.drawImage(t,Math.round(s.rx*a+i.left-r-0),Math.round(s.ry*a+i.top-r-0)),null!=h&&(e.globalAlpha=1)}(e,l,c)},this.drawWarShadow=function(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=e.getMargin(),n=e.getSquareData(),a=Engine.warShadow.warRangeAndMargin-2,r=n.normalSize,o=Math.max(0,s.rx-a)*r+i.left,l=Math.max(0,s.ry-a)*r+i.top,c=Math.min(Engine.map.size.x,s.rx+a+1)*r+i.left,d=Math.min(Engine.map.size.y,s.ry+a+1)*r+i.top;t.save(),t.lineWidth=1,t.strokeStyle="#a6d500",t.beginPath(),t.moveTo(o,l),t.lineTo(c,l),t.lineTo(c,d),t.lineTo(o,d),t.closePath(),t.stroke(),t.restore()},this.setKind=function(t){r=t},this.getKind=function(){return r},this.setColor=function(){i=Engine.miniMapController.handHeldMiniMapController.getColorByKind(r)},this.setShape=function(){a=Engine.miniMapController.handHeldMiniMapController.getShapeByKind(r)},this.clearImageObject=function(){t=null},this.checkVisible=function(){return!!o&&!!Engine.miniMapController.handHeldMiniMapController.canUpdate(o,r)},this.setBelongType=p,this.addMapObjectToCords=function(){let t=Engine.miniMapController.handHeldMiniMapController.getMiniMapTipController(),i=f();isset(s.d.x)&&isset(s.d.x)||errorReport(e,"addMapObjectToCords","objRef.d.x || objRef.d.x not exist!",s),t.addToCords(s.d.x,s.d.y,o,i)},this.updateMapObjectInCords=function(){let t=Engine.miniMapController.handHeldMiniMapController.getMiniMapTipController(),e=f();t.removeFromCords(c,d,o,e),t.addToCords(s.d.x,s.d.y,o,e)},this.setPos=function(){c=s.d.x,d=s.d.y},this.removeMapObjectFromCords=g}},function(t,e,i){i(1);t.exports={action:{CREATE:"CREATE",REMOVE:"REMOVE",REMOVE_IF_EXIST:"REMOVE_IF_EXIST",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST"},windowTarget:{MAP:"MAP",BATTLE:"BATTLE"},effect:{ANIMATION:"ANIMATION",TINT:"TINT",SHAKE:"SHAKE",TEXT:"TEXT"},position:{CENTER:"CENTER",LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",FRONT:"FRONT",BACK:"BACK",LEFT_HAND:"LEFT_HAND",RIGHT_HAND:"RIGHT_HAND"},TINT_KIND:{SHOW_AND_HIDE:"SHOW_AND_HIDE",SHOW_AND_STICK:"SHOW_AND_STICK",HIDE:"HIDE"}}},function(t,e,i){let n=i(95),a=i(11),s={W:a.N,ARROWUP:a.N,S:a.S,ARROWDOWN:a.S,A:a.W,ARROWLEFT:a.W,D:a.E,ARROWRIGHT:a.E},r={W:a.S,ARROWUP:a.S,S:a.N,ARROWDOWN:a.N,A:a.E,ARROWLEFT:a.E,D:a.W,ARROWRIGHT:a.W},o={},l=null,c=null,d=null,h=null,u=null,p=[],g=null;const f=["INPUT","TEXTAREA","MAGIC_INPUT"];function m(t){return p.includes(t)}var v=new function(){this.getMoveDirection=function(){return g},this.updateKeys=()=>{s={ARROWUP:a.N,ARROWDOWN:a.S,ARROWLEFT:a.W,ARROWRIGHT:a.E},r={ARROWUP:a.S,ARROWDOWN:a.N,ARROWLEFT:a.E,ARROWRIGHT:a.W};let t=Engine.hotKeys.getKeyByClbName(n.name.move_up),e=Engine.hotKeys.getKeyByClbName(n.name.move_down),i=Engine.hotKeys.getKeyByClbName(n.name.move_left),o=Engine.hotKeys.getKeyByClbName(n.name.move_right);null!=t&&(s[t]=a.N,r[t]=a.S),null!=e&&(s[e]=a.S,r[e]=a.N),null!=i&&(s[i]=a.W,r[i]=a.E),null!=o&&(s[o]=a.E,r[o]=a.W),this.setKeyboardSystem()},this.setMoveDirection=function(t){v.setMoveDir(t),Engine.dialogue&&Engine.dialogue.checkIsBubbleCloud()},this.setMoveDir=t=>{g=t},this.getLastActivityK=function(){return l},this.getLastActivityX=function(){return c},this.getLastActivityY=function(){return d},this.getAltAndCtrl=function(){return u&&h},this.setKeyboardSystem=function(){o=invertKeyInputOnSpecificMap()?r:s}};function E(){return!Engine.allInit||!Engine.settings||Engine.settings.getBlockInput()}function _(t){let e=correctKey(t.key);if(m(e)&&function(t){const e=p.indexOf(t);e>-1&&p.splice(e,1)}(e),!Engine.alreadyInitialised&&Engine.hotKeys.checkKeyIsConsole(e));else if(E())return;h=null,u=null,l=t.keyCode,isset(o[e+""])&&o[e+""]==g&&(Engine.hero.blockMove=!0,v.setMoveDir(null))}$((function(){$(document).on("keydown",(function(t){!function(t){let e=correctKey(t.key);if(!E()){if(h=t.ctrlKey,u=t.altKey,Engine.hero.blockMove=!1,f.indexOf(t.target.tagName)<0&&isset(o[e+""])){if(Engine.battle.getShow()){switch(e){case"W":case"ARROWUP":Engine.battle.getPosMarkObject(!1,1);break;case"S":case"ARROWDOWN":Engine.battle.getPosMarkObject(!1,-1);break;case"A":case"ARROWLEFT":Engine.battle.getPosMarkObject(-1,!1);break;case"D":case"ARROWRIGHT":Engine.battle.getPosMarkObject(1,!1)}return}v.setMoveDir(o[e+""]),Engine.hero.blockMove=!0,setTimeout((function(){Engine.hero.blockMove=!1}),50),Engine.dialogue&&Engine.dialogue.checkIsBubbleCloud()}if("TAB"==e&&f.indexOf(t.target.tagName)<0&&t.preventDefault(),"ESCAPE"==e){if(Engine.hotKeys.checkCanCancelAlert())return t.preventDefault();if(Engine.hotKeys.checkCanRefuseLoot())return t.preventDefault();if(Engine.hotKeys.checkCanCloseConsole())return t.preventDefault();if(Engine.hotKeys.checkCanCloseWindow())return t.preventDefault();if(Engine.hotKeys.checkCanCloseMiniMap())return t.preventDefault();if(Engine.hotKeys.checkCanCloseDialog())return t.preventDefault();if(Engine.hotKeys.checkCanCloseTrade())return t.preventDefault();if(Engine.hotKeys.checkCanBlurInput())return t.preventDefault()}"ENTER"==e&&(Engine.hotKeys.checkCanAcceptAlert()||Engine.hotKeys.checkCanAcceptWindow())&&t.preventDefault()}}(t)})).on("keyup",(function(t){_(t)})).on("keypress",(function(t){let e=correctKey(t.key);if(!m(e)){if(p.push(e),!Engine.alreadyInitialised&&Engine.hotKeys.checkKeyIsConsole(e));else if(E())return;if(f.indexOf(t.target.tagName)>=0)"console_input"==t.target.id&&"`"==e&&Engine.console.toggle();else{switch(e){case"ENTER":console.log("input parser"),t.preventDefault(),Engine.chatController.getChatWindow().manageChatWindowAfterEnter()}if(t.ctrlKey||Engine.hotKeys.checkKey(e),["1","2","3","4","5","6","7","8","9"].includes(e)){var i=Engine.dialogue;if(i){var n=!1;if(i.getBubble()?1==e&&(n=!0):n=!0,n)return Engine.dialogue.hotKeyLine(e)}if(9==e)return;var a=Engine.battle;a.endBattle||a.doSkillAction(e),a.show||Engine.interfaceItems.doInterfaceItemAcion(e)}}}})).click((function(t){c=t.clientX,d=t.clientY})).on("mouseup",(function(){Engine.map.onmouseup()})),$(window).on("blur",(function(){Engine.map.onmouseup()}))})),t.exports=v},function(t,e,i){var n=i(20),a=i(5);t.exports=new function(){let t=n.WINDOW_DATA;this.setShowWindow=(e,i)=>{a.easySet(e,t.mainKey,i,t.SHOW)},this.removeShowWindow=e=>{a.remove(t.mainKey+"/"+e+"/"+t.SHOW)},this.setPositionWindow=(e,i)=>{a.easySet(e,t.mainKey,i,t.POSITION)},this.setOpacityWindow=(e,i)=>{a.easySet(e,t.mainKey,i,t.OPACITY)},this.setCollapseWindow=(e,i)=>{a.easySet(e,t.mainKey,i,t.COLLAPSE)},this.getShowWindow=e=>a.easyGet(t.mainKey,e,t.SHOW),this.getPositionWindow=e=>a.easyGet(t.mainKey,e,t.POSITION),this.getOpacityWindow=e=>a.easyGet(t.mainKey,e,t.OPACITY),this.getCollapseWindow=e=>a.easyGet(t.mainKey,e,t.COLLAPSE)}},function(t,e,i){let n=i(15);t.exports=new function(){this.isWeaponCl=t=>t>0&&t<n.CL.DISTANCE_WEAPON,this.isMagicWeaponCl=t=>t==n.CL.WAND_WEAPON,this.isNeutralCl=t=>t==n.CL.NEUTRAL,this.isBagCl=t=>t==n.CL.BAG,this.isConsumeCl=t=>t==n.CL.CONSUME,this.isEquipCl=t=>n.CL.ONE_HAND_WEAPON<=t&&t<=n.CL.SHIELD||t===n.CL.QUIVER,this.isNotEquipClWithoutBlessCl=t=>t>n.CL.SHIELD&&!this.isArrowsCl(t),this.isNotEquipCl=t=>t>n.CL.SHIELD&&t!=n.CL.BLESS&&!this.isArrowsCl(t),this.isArrowsCl=t=>t==n.CL.QUIVER,this.isGoldCl=t=>t==n.CL.GOLD,this.isQuestCl=t=>t==n.CL.QUEST,this.isBlessCl=t=>t==n.CL.BLESS,this.isUpgradeCl=t=>t==n.CL.UPGRADE,this.isRecipeCl=t=>t==n.CL.RECIPE,this.isOutfitCl=t=>t==n.CL.OUTFITS,this.isPetCl=t=>t==n.CL.PETS,this.isShowPreviewItemInShop=t=>this.isOutfitCl(t)||this.isPetCl(t),this.canAddToBottomPanel=t=>t===n.CL.CONSUME||t===n.CL.OUTFITS||t===n.CL.PETS||t===n.CL.TELEPORTS}},function(t,e){t.exports={drawSystem:{PLAYER_OUTFIT:"PLAYER_OUTFIT",PET:"PET"}}},function(t,e){let i="NAME",n="VIEW_PARAMS",a="CHAT",s="MESSAGE",r="YELLOW_MESSAGE",o="CHAT_SYSTEM_MESSAGE",l={CODE_MESSAGE_ATTR:{[i]:i,KEY_CODE:"KEY_CODE",TEXT_PARAMS:"TEXT_PARAMS",[n]:n,CALL_PARAMS:"CALL_PARAMS"},SOURCE:{[a]:a,[s]:s},TEXT_MODIFY:{GROUP_PARAMS_AMOUNT:"GROUP_PARAMS_AMOUNT"},CALL_KIND:{INSTANT_CALL:"INSTANT_CALL",AFTER_CLIENT_READY_CALL:"AFTER_CLIENT_READY_CALL"},VISIBLE_KIND:{ALERT:"ALERT",[r]:r,[o]:o,CHAT_CLAN_MESSAGE:"CHAT_CLAN_MESSAGE"},CODE_MESSAGE_WRAPPER:null,CODE_MESSAGE:null};l.CODE_MESSAGE_WRAPPER={1004001:{[i]:"confirm-prompt-ask-message-wrapper"}},l.CODE_MESSAGE={1001001:{[i]:"ItemClassIsNotValid"},1001002:{[i]:"ItemCanNotBeCursed"},1001003:{[i]:"ItemIsProgressable"},1001004:{[i]:"ItemMustBeInInventory"},1001005:{[i]:"IngredientMustBeInBag"},1001006:{[i]:"NotEnoughGold"},1001007:{[i]:"NotEnoughIngredients"},1001008:{[i]:"BonusSelectorApplyError"},1001009:{[i]:"BonusSelectorSelectError"},1001010:{[i]:"IngredientIsWorthless"},1001011:{[i]:"ItemLevelIsTooLow"},1001012:{[i]:"ProgressOverflow"},1001013:{[i]:"ItemIsUpgradable"},1001014:{[i]:"ItemIsCompleted"},1001015:{[i]:"BoundConfirm"},1001016:{[i]:"SelfItemUpgrade"},1001017:{[i]:"ItemCannotBeTimeLimited"},1001018:{[i]:"ItemIsRequiredInQuest"},1002001:{[i]:"ItemUpgraded"},1101001:{[i]:"MissingSelectedStat"},1201001:{[i]:"ForceBindingConfirmation"},1005001:{[i]:"MatchCommonOnly"},1005002:{[i]:"MatchUniqueOnly"},1005003:{[i]:"MatchHeroicOnly"},1005004:{[i]:"MatchUpgradeOnly"},1005005:{[i]:"MatchLegendaryOnly"},1005006:{[i]:"MatchArtifactOnly"},1003001:{[i]:"ItemIsDeleted"},1003002:{[i]:"ItemLocationIsNotInPlayer"},1003003:{[i]:"ItemStateIsEquipped"},1003004:{[i]:"ItemStateIsNotInBag"},1003005:{[i]:"ItemRarityIsNotSalvageable"},1003006:{[i]:"ItemClassIsNotSalvageable"},1003007:{[i]:"ItemLevelIsTooLow"},1003008:{[i]:"ItemValueIsWorthless"},1003009:{[i]:"ItemIsRequiredInQuest"},1003010:{[i]:"ItemIsCursed"},1003011:{[i]:"ItemExpires"},1004001:{[i]:"ItemsInBattleSets",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:2}},1301001:{[i]:"GuestCantUseCredits"},1301002:{[i]:"InvalidCurrency"},1301003:{[i]:"NotEnoughGold"},1301004:{[i]:"NotEnoughCredits"},1401001:{[i]:"ItemMustBeInBag"},1401002:{[i]:"NotUpgraded"},1004002:{[i]:"ItemNotInBag"},1004003:{[i]:"NotEnoughItems"},1004004:{[i]:"BagIsFull"},1004005:{[i]:"RequiredTakeOffTwoItems"},1004006:{[i]:"ItemIsNotEquippable"},1004007:{[i]:"ItemIsAlreadyEquipped"},1004008:{[i]:"ItemIsExpired"},1004009:{[i]:"ItemReqNotFullfilled"},1004010:{[i]:"ItemNoUsesLeft"},1004011:{[i]:"ItemUsedInBattle"},1006001:{[i]:"NotSummable"},1006002:{[i]:"DifferentLevels"},1006003:{[i]:"DifferentExpires"},1006004:{[i]:"DifferentCustomTeleports"},1006005:{[i]:"SelectedOutfitMissmatch"},1007001:{[i]:"InvalidOperation"},1008001:{[i]:"TalismanSuccessful"},1008002:{[i]:"TalismanAlreadyActivated"},1101002:{[i]:"MissingSelectorStat"},1601001:{[i]:"TooFastLinkedGetLinkedItem"},1501001:{[i]:"LinkedItemDoesNotExist"},1501002:{[i]:"TooMuchLinkedItem"},1501003:{[i]:"ChatCharacterLimitExceeded"},1701001:{[i]:"TooHighLevelToAttack"},1702002:{[i]:"GroupFightConfirm"},1801001:{[i]:"EnhancementLimitExceed"},1902001:{[i]:"InvalidAuctionTime",[n]:{[s]:"ALERT"}},2001001:{[i]:"RerollCompletedMission"},2003001:{[i]:"InsufficientPoints"},2002001:{[i]:"CollectedReward"},2002002:{[i]:"InsufficientAccesToCollectReward"},2002003:{[i]:"AlreadyHavePremium"},2101001:{[i]:"FreeSkillsTime"},1905001:{[i]:"AuctionSellConfirm"},1901001:{[i]:"ChangeAllAuctionsTime"},1904001:{[i]:"FeaturedAuctionLimitReached"},1903001:{[i]:"ObservedAuction"},1906001:{[i]:"AuctionsItemIsExpired"},1907001:{[i]:"AuctionsFeaturedIsNotPossible"},2201001:{[i]:"TradeAcceptCanceled",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:1}},2202001:{[i]:"AcceptanceIsLocked"},2202002:{[i]:"OfferIsChanged"},2301001:{[i]:"ClanNameChange",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:2}},2302001:{[i]:"ClanNameIsTooLong "},2302002:{[i]:"ClanNameIsImproper"},2302003:{[i]:"ClanNameContainsTooManyCapitalLetters"},2302004:{[i]:"ClanNameContainsInvalidCapitalLetters"},2302005:{[i]:"ClanNameContainsForbiddenPhrases"},2401001:{[i]:"CouldNotThrowAwayQuestItem"},2501001:{[i]:"ExpbackCreditsConfirm",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:1}},2502001:{[i]:"L_EXP_BACK",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:2}},1801012:{[i]:"ItemSplitLimit"},1801013:{[i]:"ShopBuyLimit"},1801014:{[i]:"MailSendLimit"},1801015:{[i]:"TradeLimit"},1801016:{[i]:"AuctionSellLimit"},1801017:{[i]:"ItemGroundDropLimit"},1801018:{[i]:"ItemGroundTakeLimit"},2803001:{[i]:"InvitationParty",[n]:{[s]:r}},4505001:{[i]:"GetLvlAndProf",[n]:{[a]:o}},2305e3:{[i]:"ClanMemberStatusNotification_Left",[n]:{[a]:o}},2305001:{[i]:"ClanMemberStatusNotification_Join",[n]:{[a]:o}},2701e3:{[i]:"FriendStatusNotification_Left",[n]:{[a]:o}},2701001:{[i]:"FriendStatusNotification_Join",[n]:{[a]:o}},2801e3:{[i]:"PartyStatusNotification_Left",[n]:{[a]:o}},2801001:{[i]:"PartyStatusNotification_Join",[n]:{[a]:o}},2806001:{[i]:"EPartyInvitationError_TooFarAway"},4501001:{[i]:"EChatBroadcastError_TooShort"},4501002:{[i]:"EChatBroadcastError_InvalidCharacters"},4501003:{[i]:"EChatBroadcastError_Muted"},4501004:{[i]:"EChatBroadcastError_NoobUsesHyperlinks"},4501005:{[i]:"EChatBroadcastError_TooFast"},4501008:{[i]:"EChatBroadcastError_ChatIsDisabled"},4501009:{[i]:"EChatBroadcastError_ChatIsLocked"},4501012:{[i]:"EChatBroadcastError_YouAreEnemyOfReceiver"},4501013:{[i]:"EChatBroadcastError_ReceiverIsYourEnemy"},4501014:{[i]:"EChatBroadcastError_ReceiverHasPersonalLocked"},4501015:{[i]:"EChatBroadcastError_YourPrivIsLocked"},4501016:{[i]:"EChatBroadcastError_YouAreNewbie"},4501019:{[i]:"EChatBroadcastError_LowLvl"},4501006:{[i]:"EChatBroadcastError_Spam"},4501007:{[i]:"EChatBroadcastError_ShadowBanned"},4501010:{[i]:"EChatBroadcastError_NarStyleIsNotAvailable"},4501011:{[i]:"EChatBroadcastError_MeStyleIsNotAvailable"},4501017:{[i]:"EChatBroadcastError_RedStyleIsNotAvailable"},4501018:{[i]:"EChatBroadcastError_StyleIsNotAvailable"},2602001:{[i]:"LSYSTEM_MAINTENANCE_CLOSED_ACCESS_OK",[n]:{[a]:o}},2702001:{[i]:"L_INVITATION_DECLINED_friend",[n]:{[s]:r}},2802001:{[i]:"L_INVITATION_DECLINED_party",[n]:{[s]:r}},2703001:{[i]:"L_INVITATION_SENT_friend",[n]:{[s]:r}},2303001:{[i]:"L_INVITATION_SENT_clan",[n]:{[s]:r}},2203001:{[i]:"L_INVITATION_SENT_trade",[n]:{[s]:r}},2304004:{[i]:"L_SAVED_clan",[n]:{[a]:o}},2304006:{[i]:"LCLAN_ALLY_ACCEPTED",[n]:{[a]:o}},2304007:{[i]:"LCLAN_ALLY_BROKEN",[n]:{[a]:o}},2304005:{[i]:"LCLAN_ALLY_SENT",[n]:{[a]:o}},2304008:{[i]:"LCLAN_APPLICATION_ACCEPTED",[n]:{[a]:o}},2304009:{[i]:"LCLAN_APPLICATION_REJECTED",[n]:{[a]:o}},2304010:{[i]:"LCLAN_APPLIED",[n]:{[a]:o}},2304011:{[i]:"LCLAN_DISBANDED",[n]:{[a]:o}},2304012:{[i]:"LCLAN_GOLD_IN_MSG",[n]:{[a]:o}},2304013:{[i]:"LCLAN_GOLD_OUT_MSG",[n]:{[a]:o}},2304014:{[i]:"LCLAN_HAS_BEEN_RENAMED",[n]:{[a]:o}},2304003:{[i]:"LCLAN_LEFT",[n]:{[a]:o}},2304015:{[i]:"LCLAN_NO_LONGER_LEADER",[n]:{[a]:o}},2304016:{[i]:"LCLAN_WAR_ENDED",[n]:{[a]:o}},2304001:{[i]:"LCLAN_YOU_HAVE_CREATED",[n]:{[a]:o}},2304002:{[i]:"LCLAN_YOU_HAVE_JOINED",[n]:{[a]:o}},3001001:{[i]:"LCONFIG_SAVED",[n]:{[a]:o}},3101001:{[i]:"LEMO_KB_BLESS_CAST_ON",[n]:{[a]:o}},39020001:{[i]:"LEMO_SPELL_EXPIRED",[n]:{[a]:o}},4101001:{[i]:"LRECEIVED/LLOST + LFATIGUE",[n]:{[a]:o}},100101001:{[i]:"LITEM_CUSTOM_OUTFIT_SET",[n]:{[a]:o}},100201001:{[i]:"LITEM_CUSTOM_TELEPORT_SET",[n]:{[a]:o}},100301001:{[i]:"LITEM_LOWREQ_DONE",[n]:{[a]:o}},100401001:{[i]:"LITEM_RECIPE_LEARNT",[n]:{[a]:o}},100501001:{[i]:"LITEM_UNBOUND",[n]:{[a]:o}},39010001:{[i]:"LITEM_UNDER_SPELL",[n]:{[a]:o}},100601001:{[i]:"LITEM_UNDO_DONE",[n]:{[a]:o}},100701001:{[i]:"CEventRevivePlayerIsWantedError",[n]:{[s]:r}},100602001:{[i]:"UndoupgError",[n]:{[s]:r},TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:1}},100302001:{[i]:"LowreqError",[n]:{[s]:r}},100702001:{[i]:"UpglvlError",[n]:{[s]:r}},100901001:{[i]:"ExpaddLevelAdvanceConfirmation"},101001001:{[i]:"UpgResetCustomTeleportConfirmation"},101101001:{[i]:"AddEnhancementRefundConfirmation"},101101002:{[i]:"ChangeEnhancementRefundConfirmation.RemoveByAuction"},101101003:{[i]:"ChangeEnhancementRefundConfirmation.RemoveByTrade"},101101004:{[i]:"ChangeEnhancementRefundConfirmation.RemoveByUnbind"},101201001:{[i]:"AddTabDepositConfirmation"},4001001:{[i]:"LITEM_YOU_HAVE_RECEIVED",[n]:{[a]:o,[s]:r}},4601001:{[i]:"QUEST_STARTED",[n]:{[a]:o,[s]:r}},4002001:{[i]:"LITEM_YOU_HAVE_RECEIVED",[n]:{[s]:r}},3701004:{[i]:"LITEM_TOO_HIGH_LVL_TO_GAIN",[n]:{[a]:o}},3201001:{[i]:"LMAIL_VOTE_STORED",[n]:{[a]:o}},3201002:{[i]:"MessageSent"},3301001:{[i]:"LMATCH_SIGNED_OUT",[n]:{[a]:o}},3401001:{[i]:"LML_FIGHT_WITHDRAWN",[n]:{[a]:o}},3401002:{[i]:"LML_ROUND",[n]:{[s]:r}},2804001:{[i]:"LPARTY_FAIL_TRIALS",[n]:{[a]:o}},2706001:{[i]:"LPLAYER_FRIENDS_ADDED",[n]:{[a]:o}},2805001:{[i]:"LPLAYER_PARTY_ADDED",[n]:{[a]:o}},3501001:{[i]:"LSHOP_TTL_ACTIVATED",[n]:{[a]:o}},3501004:{[i]:"LSHOP_TTL_ADD_BOUGHT",[n]:{[a]:o}},3501003:{[i]:"LSHOP_TTL_DEL_BOUGHT",[n]:{[a]:o}},3501002:{[i]:"LSHOP_TTL_PROLONGED",[n]:{[a]:o}},3302001:{[i]:"LTALK_LOOT_EMPTY_matchmaking",[n]:{[s]:r}},3601001:{[i]:"LTALK_LOOT_EMPTY_promo",[n]:{[s]:r}},3701002:{[i]:"LTALK_LOOT_EMPTY_lootbox",[n]:{[s]:r}},2205001:{[i]:"LTRADE_CANCELLED",[n]:{[a]:o}},2206001:{[i]:"LTRADE_SUCCESSFUL",[n]:{[a]:o}},2207001:{[i]:"ETradeInvitationError_TooFarAway"},2208001:{[i]:"TradeSoulboundItemConfirmation",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:1}},2209001:{[i]:"TradeSoulboundItemsAcceptConfirmation",TEXT_PARAMS:{GROUP_PARAMS_AMOUNT:1}},2210001:{[i]:"TradeInvalidSoulboundItem"},2402001:{[i]:"(HARD_CODED)",[n]:{[a]:o}},3801001:{[i]:"(HARD_CODED)",[n]:{[a]:o}},4506001:{[i]:"CHANNEL_NOT_EXITST",[n]:{[s]:r}},4201001:{[i]:"L_PLAYER_NOT_FOUND"},4201002:{[i]:"L_PLAYER_OFFLINE"},4701001:{[i]:"L_INVITATION_BUSY"},4401001:{[i]:"LBATTLE_CAN_ATTACK_ONLY"},4401002:{[i]:"LBATTLE_CAN_ATTACK_ONLY_LBATTLE_OR_SELF_CAST_SPELL"},4401003:{[i]:"CanNotUseFightperhealInMatchmaking"},4301001:{[i]:"LCLAN_CREATE_COST_IS"},2304019:{[i]:"LCLAN_GOLD_IN_MAX"},2304020:{[i]:"LCLAN_QUEST_NO_ITEM"},2704002:{[i]:"LFRIENDS_ADD_LIMIT"},2704001:{[i]:"LFIRENDS_ADD_IS_ALREADY"},2704004:{[i]:"LFRIENDS_ADD_LOCKED"},2704005:{[i]:"LFRIENDS_ADD_SELF"},2704006:{[i]:"LFRIENDS_ADD_YOU_ENEMY"},2704007:{[i]:"LFRIENDS_ADD_YOUR_ENEMY"},2705001:{[i]:"LFRIENDS_EADD_IS_ALREADY"},2705004:{[i]:"LFRIENDS_EADD_IS_FRIEND"},2705003:{[i]:"LFRIENDS_EADD_LIMIT"},2705002:{[i]:"LFRIENDS_EADD_SELF"},2704003:{[i]:"LFRINEDS_ADD_TOO_MANY"},1301005:{[i]:"LPLAYER_GOLD_LIMIT_HAPPEN_1_LPLAYER_GOLD_LIMIT_HAPPEN_2"},4503001:{[i]:"LSYSTEM_OPT_NOT_THIS_WORLD_ChatShowLvlError"},3502001:{[i]:"LSYSTEM_OPT_NOT_THIS_WORLD_ShopTimeticketsChangeError"},2204001:{[i]:"LTRADE_PLAYER_DECLINED"},4504001:{[i]:"LCHAT_DICE_HELP"},4504002:{[i]:"LCHAT_DICE_ERR"},4504003:{[i]:"LCHAT_COIN_DONT_HAVE"},2603001:{[i]:"LSYSTEM_CHAR_REMOVED"},2603002:{[i]:"LSYSTEM_ERR_IP_CHANGED*"},2602002:{[i]:"LSYSTEM_MAINTENANCE*",CALL_PARAMS:"INSTANT_CALL"},4502001:{[i]:"FORBIDDEN_HREF"},4502002:{[i]:"FORBIDDEN_SWERING"},3901001:{[i]:"AFFECTED_BY_SPELL",[n]:{[a]:o}},2304017:{[i]:"ALLIANCE_PROPOSAL_REJECTED"},2304018:{[i]:"DONT_ENOUGH_GOLD_TO_CREATE_CLAN"},4102001:{[i]:"LOST_MINUTES_TO_STAMINA",[n]:{[a]:o}},3902001:{[i]:"NOT_ACCEPT_STH",[n]:{[a]:o}},4003001:{[i]:"INVENTORY_GAIN_LEGENDARY_ITEMS_LINKED",[n]:{[a]:"CHAT_CLAN_MESSAGE"}}};for(let t in l.CODE_MESSAGE_WRAPPER)l.CODE_MESSAGE_WRAPPER[t].KEY_CODE=t;for(let t in l.CODE_MESSAGE)l.CODE_MESSAGE[t].KEY_CODE=t;t.exports=l},function(t,e){t.exports=function(){let t=null,e=!1;const i=()=>{t&&clearTimeout(t),t=null},n=(t,e,i,s,r,o)=>{a(t,e,i,s,a=>{o(a),++i!=r&&n(t,e,i,s,r,o)})},a=(t,e,i,n,a)=>{let s=h(),r=s.canvas,o=s.ctx;d(r),c(o,r,e),t.length?l(r,o,t,i,n,a):a(r)},s=(e,n,a,o,l,c)=>{i();let d=n[l][a];r(d,e),++l!=n.length?o.indexOf(a)>-1?s(e,n,a,o,l,c):t=setTimeout((function(){s(e,n,a,o,l,c)}),0):c()},r=(t,i)=>{let n,a;e?(n=t.x,a=t.y):(n=t.x*CFG.tileSize+CFG.tileSize/2,a=t.y*CFG.tileSize+CFG.tileSize/2);let s=t.r;n+=t.offsetX,a+=t.offsetY;let r=i.createRadialGradient(n,a,0,n,a,s);r.addColorStop(t.startOpacity0,t.stop0),r.addColorStop(t.startOpacity1,t.stop1),r.addColorStop(t.startOpacity2,t.stop2),i.fillStyle=r,i.beginPath(),i.arc(n,a,s,0,2*Math.PI),i.fill()},o=(t,e)=>Math.floor(100*(t+Math.random()*e))/100,l=(t,e,i,n,a,r)=>{let o=h(),l=o.canvas,c=o.ctx;d(l),((t,e,i,n,a,r)=>{s(e,i,n,a,0,r)})(0,c,i,n,a,(function(){e.save(),e.globalCompositeOperation="destination-out",e.drawImage(l,0,0),e.restore(),r(t)}))},c=(t,e,i)=>{let n=e.width,a=e.height;t.fillStyle="rgba("+i+")",t.fillRect(0,0,n,a)},d=function(t){t.width=Engine.map.size.x*CFG.tileSize,t.height=Engine.map.size.y*CFG.tileSize},h=()=>{let t=document.createElement("canvas"),e=t.getContext("2d");return{canvas:t,ctx:e}},u=(t,e,i,n)=>{let a=isset(t.gradientPercent1)?t.gradientPercent1:40,s=isset(t.gradientPercent2)?t.gradientPercent2:40,r=t.offsetX?t.offsetX:0,o=t.offsetY?t.offsetY:0,l=t.x,c=t.y,d=null,h=null,u=null;if(i)d=t.r?t.r:30,u=null,h=n||[{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:.2},{r:0,g:0,b:0,a:0}];else{let e=t.light.color?t.light.color:{r:235,g:228,b:255,a:1};d=t.light.r?t.light.r:t.r?t.r:30,u=t.light,h=[{r:e.r,g:e.g,b:e.b,a:e.a},{r:e.r,g:e.g,b:e.b,a:0}]}let g=[];for(let t=0;t<e;t++){let t=p(d,0,a,s,l,c,r,o,u,h);g.push(t)}return g},p=(t,e,i,n,a,s,r,l,c,d)=>{let h={r:t+(Math.round(Math.random())?1:-1)*e,gradientPercent1:i,gradientPercent2:n,x:a,y:s,offsetX:r,offsetY:l,light:c,gradientLength:d.length};for(let t=0;t<d.length;t++){let e=d[t];h["stop"+t]=`rgba(${e.r},${e.g},${e.b},${e.a})`,h["stop"+t+"Data"]={r:e.r,g:e.g,b:e.b,a:e.a};let a=null;0==t&&(a=0),1==t&&(a=o(.5,.199*i/100)),2==t&&(a=o(.9,.099*n/100)),h["startOpacity"+t]=a}return h};this.init=()=>{},this.getHolesList=(t,e,i)=>{let n=[];for(let i in t.list){let a=t.list[i];if(!Engine.rajCase.checkFullFillCase(a.case))continue;let s=u(a,e,!0);n.push(s)}return n},this.createFrames=(t,e,i,a,s)=>{n(t,e,0,a,i,s)},this.getOnePoint=u,this.drawOneHole=r,this.createCanvasData=h,this.setSizeCanvas=d,this.getDynamicHoleImg=(t,e)=>{let i=e||h(),n=i.ctx,a=i.canvas,s=t.offsetX,o=t.offsetY,l=2*t.r+2*Math.abs(s),c=2*t.r+2*Math.abs(o);return a.width!=l&&(a.width=l),a.height!=c&&(a.height=c),r(t,n),a},this.onClear=()=>{i()},this.getDefaultR=()=>30,this.setRealXYPos=t=>{e=t}}},function(t,e){let i={$_DROP_TO_DELETE_WIDGET_LAYER:"",$_ECHH_LAYER:"",$_STICKY_TIPS_LAYER:"",$_CAPTCHA_LAYER:"",$_INTERFACE_LAYER:"",$_ALERTS_LAYER:"",$_M_ALERT_LAYER:"",$_TUTORIAL_LAYER:"",$_POP_UP_LAYER:"",$_CONSOLE_LAYER:"",$_M_ALERT_MOBILE_LAYER:"",$_LOADER_LAYER:"",$_GAME_LAYER:"",$_ZOOM_LAYER:"",$_CHAT_LAYER:""};for(let t in i)i[t]=t;t.exports=i},function(t,e){t.exports={THEME_KIND:{EVENT:1,CITY:2}}},function(t,e,i){var n=i(173),a=i(93),s=i(181),r=i(184);t.exports=new function(){var t=this;this.map=null,this.contextMap=null,this.roads=[],asdasd=this,this.createMap=function(e){t.map=new n(e),t.contextMap=new a(t.map),t.roads=[]},this.find=function(e,i){var n=new s(t.contextMap,i),a=this.createRoad(e,n);return a.findWay(),t.roads.push(a),a},this.getEmptyRoad=function(){return this.createRoad(null,null)},this.createRoad=function(e,i){var n=new r(e,i,(function(){var e=t.roads.indexOf(n);-1!==e&&t.roads.splice(e,1)}));return n},this.readCollisions=function(e,i){i?t.map.copyCollisionsToNodesCache(e):t.map.copyCollisionsToNodes(e),t.reload()},this.changeCollision=function(e,i,n){var a=t.map.getNode(e,i);if(null!==a){var s=a.isBlocked();if(a.setCollision(n),s!==a.isBlocked())for(var r in t.roads)t.roads[r].changeCollision(e,i,n)}},this.reload=function(){null!=t.map&&(t.map.reloadCollisionsConnections(),t.reloadRoads())},this.reloadRoads=function(){t.roads.forEach(t=>t.reloadConnections())}}},function(t,e,i){var n=i(46);let a=i(11);var s=i(65);let r=i(98),o=i(189);var l=function(){};function c(t,e,i,n,a,s,r,o){t.globalAlpha=.25,t.drawImage(e,i,n,r,o,a,s,r,o),t.globalAlpha=1}l.prototype.staticAnimation=null,(l.prototype=Object.create(n.prototype)).imgLoaded=!1,l.prototype.fetchError=function(){console.log("fetchError",this,this.d.icon)},l.prototype.initDataDrawer=function(){let t=new o;t.init(this),this.updateDataDrawer=e=>{t.update(e)},this.getDataDrawer=()=>t,this.clearDataToDraw=()=>{t.clearDataToDraw()}},l.prototype.initOnSelfEmoList=function(){let t=[];this.checkEmoExist=()=>!!t.length,this.getEmoLength=()=>t.length,this.removeOnSelfEmoList=e=>{t.splice(e,1)},this.getOnSelfEmoList=()=>t,this.addToOnSelfEmoList=e=>{t.push(e)},this.refreshEmotions=()=>{if(t.length>0)for(const e of t)e.setXYOffset()},this.getEmotionIndex=e=>t.indexOf(e)},l.prototype.addDebugOptionMenu=function(t){r.addDebugOptionMenu(this,t)},l.prototype.createPlaceHolderCharacter=function(){Engine.imgLoader.onload("../img/def-npc-sprite.gif",!1,t=>{this.placeHolderCharacter=t})},l.prototype.initDynamicLightCharacterManager=function(){let t=new s;t.init(),this.getObjectDynamicLightManager=()=>t},l.prototype.setPlaceHolderIcon=function(){let t=this.getPlaceholderCharacter();this.fw=32,this.fh=48,this.halffw=16,this.halffh=24,this.activeFrame=0,this.sprite=t,this.imgLoaded=!0,this.frames=[{delay:300}],this.afterLoadImage()},l.prototype.getPlaceholderCharacter=function(){return this.placeHolderCharacter},l.prototype.changeWarShadowOpacity=function(t){if(1!=this.warShadowOpacity&&this.imgLoaded){if(Engine.opt(8))return void(this.warShadowOpacity=1);if(this.warShadowOpacity+=2*t,this.warShadowOpacity>1)return void(this.warShadowOpacity=1)}},l.prototype.decreaseWarShadowOpacity=function(t){if(0!=this.warShadowOpacity&&this.imgLoaded){if(Engine.opt(8))return void(this.warShadowOpacity=0);if(this.warShadowOpacity-=2*t,this.warShadowOpacity<0)return void(this.warShadowOpacity=0)}},l.prototype.isHide=function(){return this.warShadowOpacity<=0},l.prototype.warShadowOpacity=0,l.prototype.getCanvasObjectType=function(){return this.canvasObjectType},l.prototype.setWarShadowAlpha=function(t){t.globalAlpha=this.warShadowOpacity},l.prototype.setDefaultAlpha=function(t){t.globalAlpha=1},l.prototype.draw=function(t){this.imgLoaded&&(Engine.rajCharacterHide.checkHideObject(this)||Engine.rajCharacterImageChangerManager.checkHideObject(this)||this.drawIcon(t))},l.prototype.drawIcon=function(t,e){let i=Engine.mapShift.getShift();var n=32*this.rx+16-this.halffw+(isset(this.ofsetX)?this.ofsetX:0)-Engine.map.offset[0]-i[0]+(void 0!==this.leftPosMod?this.leftPosMod:0),s=32*this.ry-this.fh+32-Engine.map.offset[1]-i[1],r=isset(this.dir)?this.dir:"S",o=this.fh,l=Math.round(this.rx)+256*Math.round(this.ry),d=0,h=this.frame*this.fw,u=0,p=!1;switch(r){case a.S:u=0;break;case a.W:u=this.fh;break;case a.E:u=2*this.fh;break;case a.N:u=3*this.fh}if(isset(Engine.map.water[l])){d=this.isPlayer?Engine.map.water[l]:Engine.map.water[l]/4;var g=this.isPlayer?d/4>8?0:d:0;s+=g,p=!0,this.isPlayer||4!==this.d.type?o-=this.isPlayer?d/4>8?d-32:d:d>8?4*(d-8):0:p=!1,this.waterTopModify=g}n=Math.round(n),s=Math.round(s),this.img||this.staticAnimation?(p&&c(t,this.img||this.sprite,h,u,n,s,this.fw,this.fh),e||this.setWarShadowAlpha(t),t.drawImage(this.img||this.sprite,h,u,this.fw,o,n,s,this.fw,o),this.setDefaultAlpha(t)):this.sprite&&void 0!==this.activeFrame&&this.frames.length>0&&!this.isPlayer&&!this.fake?(p&&c(t,this.sprite,h,u+this.activeFrame*this.fh,n,s,this.fw,this.fh),e||this.setWarShadowAlpha(t),t.drawImage(this.sprite,h,u+this.activeFrame*this.fh,this.fw,o,n,s,this.fw,o),this.setDefaultAlpha(t)):this.sprite&&void 0!==this.activeFrame&&this.frames.length>0&&(this.isPlayer||this.fake)&&(p&&c(t,this.sprite,h,u+this.activeFrame*this.fh*4,n,s,this.fw,this.fh),e||this.setWarShadowAlpha(t),t.drawImage(this.sprite,h,u+this.activeFrame*this.fh*4,this.fw,o,n,s,this.fw,o),this.setDefaultAlpha(t))},l.prototype.updateCollider=function(){let t=void 0!==this.leftPosMod?this.leftPosMod:0,e=this;this.collider={box:[32*e.rx+16-e.fw/2+t,32*e.ry+32-e.fh,32*e.rx+16+e.fw/2+t,32*e.ry+32]}},l.prototype.setStaticAnimation=function(t){IE?l.prototype.staticAnimation=!0:l.prototype.staticAnimation=t},t.exports=l},function(t,e){t.exports={SEND_CHAT_MESSAGE:"SEND_CHAT_MESSAGE",SHOW_EQ:"SHOW_EQ",INVITE_TO_FRIEND:"INVITE_TO_FRIEND",INVITE_TO_ENEMIES:"INVITE_TO_ENEMIES",INVITE_TO_PARTY:"INVITE_TO_PARTY",SHOW_PROFILE:"SHOW_PROFILE"}},function(t,e){t.exports=function(){var t=this;this.master=null,this.d={},this.color=null,this.mask=null,this.drawMask=null,this.maskLoad=!1,this.alpha=1,this.getOrder=function(){return t.master.ry+.1},this.update=function(){Engine.allInit&&(this.rx=t.master.rx-.025,this.ry=t.master.ry,this.d.x=t.master.d.x,this.d.y=t.master.d.y)},this.setAlpha=t=>{this.alpha=t},this.createImg=function(){Engine.imgLoader.onload("/img/mask.png",!1,t=>{this.beforeOnload(t)},t=>{this.afterOnload(t)})},this.beforeOnload=e=>{this.fw=t.master.fw+4,this.fh=t.master.fh+4,t.mask=e},this.afterOnload=()=>{this.maskLoad=!0},this.draw=function(e){let i=Engine.mapShift.getShift();e.globalAlpha=this.alpha;var n=32*this.rx+16-this.fw/2+(isset(this.offsetX)?this.offsetX:0)-Engine.map.offset[0]-i[0]+(void 0!==this.leftPosMod?this.leftPosMod:0),a=32*this.ry-this.fh+32+(isset(this.offsetY)?this.offsetY:0)-Engine.map.offset[1]-i[1];t.createMaskColor(1);var s=Math.round(this.rx)+256*Math.round(this.ry),r=isset(Engine.map.water[s])?a+this.master.waterTopModify:a;if(n=Math.round(n),r=Math.round(r),t.drawMask){let i=Engine.map.clipObject(n,r,this.fw,this.fh);i&&e.drawImage(t.drawMask,i.backgroundPositionX,i.backgroundPositionY,i.width,i.height,i.left,i.top,i.width,i.height)}e.globalAlpha=1},this.updateColor=function(e){var i=e||t.master.d.whoIsHere;t.color=i,t.drawMask=null},this.createMaskColor=function(){if(!t.drawMask&&t.maskLoad){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.fw,e.height=t.fh,i.drawImage(t.mask,0,0,t.fw,t.fh),i.globalCompositeOperation="source-in",i.fillStyle=t.color,i.fillRect(0,0,e.width,e.height),t.drawMask=e}return t.drawMask},this.createObject=function(e,i){t.master=e,t.d.id=t.master.d.id,t.update(),t.updateColor(i),t.createImg()}}},function(t,e,i){i(91);t.exports=new function(){this.isEquipItemLoc=t=>t==Engine.itemsFetchData.NEW_EQUIP_ITEM.loc,this.isAuctionItemLoc=t=>t==Engine.itemsFetchData.NEW_AUCTION_ITEM.loc,this.isGroundItemLoc=t=>t==Engine.itemsFetchData.NEW_GROUND_ITEM.loc,this.isPrivateDepoItemLoc=t=>t==Engine.itemsFetchData.NEW_PRIVATE_DEPO_ITEM.loc,this.isClanDepoItemLoc=t=>t==Engine.itemsFetchData.NEW_CLAN_DEPO_ITEM.loc,this.isRecoveryItemLoc=t=>t==Engine.itemsFetchData.NEW_RECOVERY_ITEM.loc,this.isMailItemLoc=t=>t==Engine.itemsFetchData.NEW_MAIL_ITEM.loc,this.isOtherEqItemLoc=t=>t==Engine.itemsFetchData.NEW_OTHER_EQ_ITEM.loc,this.isPromoItemLoc=t=>t==Engine.itemsFetchData.NEW_PROMO_ITEM.loc}},function(t,e){t.exports={specificSkills:{ONE_STEP_ID:-2,NORMAL_ATTACK_ID:-1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0);e.default=class{constructor(t,e){this.onSelected=e,this.el=a.get("checkbox-custom")[0],this.createCheckbox(t)}createCheckbox(t){let{id:e,name:i,value:a,label:s,checked:r,attrs:o,i:l,highlight:c=!0}=t;const d=this.el.querySelector("input"),h=this.el.querySelector("label");this.el.classList.add("c-checkbox"),h.classList.add("c-checkbox__label"),c&&h.classList.add("c-checkbox__label--highlight"),d.addEventListener("change",t=>{this.onSelected&&this.onSelected(t)}),!(0,n.isset)(e)&&(0,n.isset)(l)&&(e=`${i}_${l}`),(0,n.setAttributes)(d,{id:e,name:i,value:a}),(0,n.isset)(r)&&r&&(d.checked=!0),s?"object"==typeof s?h.appendChild(s):h.innerHTML=s:this.el.classList.add("checkbox-custom--alone"),h.setAttribute("for",e.toString()),o&&"object"==typeof o&&(0,n.setAttributes)(this.el,o)}getCheckbox(){return this.el}getChecked(){return this.el.querySelector("input").checked}setChecked(t){this.el.querySelector("input").checked=t}}},function(t,e){t.exports={effect:{SHAKE:"SHAKE",TINT:"TINT",ANIMATION:"ANIMATION"},target:{SCREEN:"SCREEN",CHARACTER:"CHARACTER"},specificTarget:{SKILL_CASTER:"SKILL_CASTER",SKILL_TARGET:"SKILL_TARGET",SKILL_CASTER_GROUP:"SKILL_CASTER_GROUP",SKILL_TARGET_GROUP:"SKILL_TARGET_GROUP"},soundUrl:{},params:{delay:!0,duration:!0,repeat:!0,opacity:!0,color:!0,url:!0,gifUrl:!0,position:{TOP:"TOP",RIGHT:"RIGHT",BOTTOM:"BOTTOM",LEFT:"LEFT",CENTER:"CENTER"}}}},,,,function(t,e){const i=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Engine.hero.isMan(),i=t.match(/\[SEX\=(.*?)\]/g);if(i)for(let n in i){let a=i[n],s=e?0:1,r=a.replace("[SEX=","").replace("]","").split("|")[s];t=t.replace(a,r)}return t},n=t=>t.replace(/\[NICK_UPPERCASE\]/,Engine.hero.d.nick.toUpperCase());t.exports={sexModify:i,nickUppercase:n,parseText:t=>Engine.interface.alreadyInitialised?(t=i(t),t=n(t)):t}},function(t,e){var i=function(){};i.prototype.updateDATA=function(t,e,i){var n=$.extend({},this.d);for(var a in isset(this.beforeUpdate)&&"function"==typeof this.beforeUpdate&&this.beforeUpdate(t,n,e,i),t)isset(this.onUpdate)&&"function"==typeof this.onUpdate[a]&&this.onUpdate[a].call(this,t[a],this.d[a],t,e),this.d[a]=t[a];isset(this.afterUpdate)&&"function"==typeof this.afterUpdate&&this.afterUpdate(t,n,e)},t.exports=i},function(t,e,i){let n=i(1);var a=i(187);t.exports=function(){let t=null,e=null,i=null,s="FollowGlow.js";const r=t=>{e=t},o=t=>{i=t};this.init=(t,e)=>{r(t),o(e)},this.addFollowGlow=()=>{let r=e.getRefFollowObj();if(r){let t=r.canvasObjectType;switch(t){case n.OTHER:break;case n.NPC:case n.M_ITEM:case n.GATEWAY:if(t==i.canvasObjectType&&r.d.id==i.d.id)return;break;default:return void errorReport(s,"addFollowGlow","Undefined canvasObjectType "+t)}e.clearRefFollowObj()}t=new a,t.createObject(i,"red"),e.setRefFollowObj(i)},this.clearFollowGlow=()=>{t=null},this.getFollowGlow=()=>t,this.checkFollowGlow=()=>!!t}},function(t,e,i){var n=i(0),a=i(5),s=i(101),r=i(102);t.exports=function(){this.$=null;var t,e,i,o,l,c=!1,d=this,h=0,u=null,p=null,g=!0,f={},m=!0,v=!1,E="";const _=[];let b=null,w=null;this.setChatOverAdditionaBarPanel=function(t){var e=t?48:0;d.$.css("bottom",e+"px")},this.newMessages=function(e){v=!0,m&&(m=!1,d.initPrivCards());var i=[];g&&t.html("");var n=null==u;for(var s in null==u&&(u=[]),e){var r=e[s].ts,o=d.isTsExistInTimeTable(r),l="System"==e[s].n,c="sys_red"==e[s].s;if(!o||l&&c){if(this.setCategory(e[s]),u.push(e[s]),!n){if(o&&l)continue;i.push(e[s])}0!=r&&d.addTsToTimeTable(r)}}if(i.reverse(),i.length>0)for(var h=0;h<i.length;h++)0==h&&0==i[h].ts||this.appendMessage(i[h]);n&&this.changeTab(a.get("chat/tab",0)),g=!1,v=!1},this.isTsExistInTimeTable=function(t){return isset(f[t])},this.addTsToTimeTable=function(t){f[t]=d.isTsExistInTimeTable(t)},this.getAmountCards=function(){var t=this.$.find(".tabs-wrapper").children(),e=0;return t.each((function(){"none"!=$(this).css("display")&&e++})),e},this.setCategory=function(t){if(3==t.k){var e=this.$.find(".tab"),i=!1;e.each((function(){var e=Engine.hero.d.nick,n=t.n==e?t.nd:t.n;$(this).hasClass(d.changeNickToIdString(n))&&(i=!0)})),t.where=i?"onlyPriv":"general"}},this.setVisibleCard=function(t,e){var i=["none","inline-block"];Engine.interface.get$gameWindowPositioner().find("div[data-tab="+t+"]").css("display",i[e]),h==t&&"none"==i[e]&&d.changeTab(0)},this.createCard=function(t,e,i,a,s){var r,o=n.get("chat-tab").attr("data-tab",t);(e?o.tip(i):o.tip(_t(i)),"chat_global_tab"==i||a)&&(r=a?_t("close_priv_card",null,"chat"):mobileCheck()?_t("global_tab_info_mobile",null,"chat"):_t("global_tab_info",null,"chat"),o.find(".close").css("display","block").tip(r));if(d.initClickCard(o),!a)return o;""!=s&&null!=s&&this.createAvatar(o,s);var l=d.changeNickToIdString(i);return o.addClass("priv "+l),d.initDblClickCard(o),o},this.createAvatar=function(t,e){var i=t.find(".icon");i.css("display","block").addClass("av");var n=CFG.a_opath+e;createImgStyle(i,n,{height:"28px",width:"32px"},{"background-size":"400% 400%"},32),t.attr("data-avatar",e),t.addClass("delete-hover")},this.initClickCard=function(t){t.on("click",(function(){$(".linked-chat-item"),d.changeTab($(this).attr("data-tab")),d.setScrollOnBottom()})),t.on("contextmenu",(function(t,e){var i=$(this),n=[[_t("change_state"),function(){d.changeTab(i.attr("data-tab")),d.setScrollOnBottom()}]],a=$(this).attr("data-tab");d.checkPrivateCard(a)&&n.push([_t("delete"),function(){d.clickDelete(i)}]);var s=getE(t,e);s.clientX+=30,Engine.interface.showPopupMenu(n,s)}))},this.initDblClickCard=function(t){t.dblclick((function(){d.clickDelete($(this))}))},this.clickDelete=function(t){var e=_t("deleteCard",null,"chat")+t.attr("data-tab")+"?";d.alert(e,(function(){d.deleteCard(t)}))},this.deleteCard=function(t){var e=t.attr("data-tab");d.deletePrivCard(e),t.remove();var i="chat/avatar/"+d.changeNickToIdString(Engine.hero.d.nick)+"/"+d.changeNickToIdString(e);a.get(i)&&a.remove(i),d.rebuildCards(),d.rebuildStorage(),d.changeTab(0)},this.initSortable=function(){var t=d.$.find(".tabs-wrapper");$((function(){t.sortable({dropOnEmpty:!0,revert:!0,items:"> :not(.static-card)",receive:d.rebuildCards,start:d.startDrag,stop:d.stopDrag,sort:d.sort}).disableSelection()}))},this.sort=function(t){},this.startDrag=function(t){!0,$(this).sortable("refresh")},this.stopDrag=function(t,e){e.item.click(),!1,d.rebuildStorage()},this.rebuildStorage=function(){d.$.find(".tabs-wrapper").children().each((function(){if(!$(this).hasClass("static-card")){var t=$(this).index(),e=$(this).attr("data-tab"),i=$(this).attr("data-avatar");d.saveToStorage(e,i,t)}}))},this.saveOldXAndY=function(t,e){t,e},this.initCards=function(){for(var t=this.$.find(".tabs-wrapper"),e=["chat_global_tab","chat_clan_tab","chat_group_tab"],i=0;i<e.length;i++){var n=this.createCard(i,!1,e[i],!1);t.append(n),n.addClass("static-card")}},this.initPrivCards=function(){var t=d.changeNickToIdString(Engine.hero.d.nick),e=a.get("chat/avatar/"+t);if(e)for(var i=this.sortPersons(e),n=0;n<i.length;n++){var s=i[n][0],r=i[n][1],o=d.changeIdStringToNick(s);d.createPrivCard(o,r)}},this.sortPersons=function(t){var e=[];for(var i in t){if(!Array.isArray(t[i]))return localStorage.clear(),void location.reload();var n=t[i][0],a=t[i][1];e.push([i,n,a])}return e.sort((function(t,e){return t[2]-e[2]})),e},this.deletePrivCard=function(t){for(var e=0;e<u.length;e++){var i=u[e].n==t,n=u[e].nd==t,a="onlyPriv"==u[e].where;(i||n)&&a&&(u[e].where="out")}},this.appendMessage=function(t,e){var i=""==t.n&&"sys_red"==t.s?t.s+" sys_important_info":t.s,s=n.get("chat-message").addClass(i),r=d.getChatSizeFromStorage();null===r&&(a.set("chatSize",1),r=1);var o=r>0;s.data("data",t),this.setAvatarData(s,t),this.setTimeMessage(s,t),this.parseChatText(s,t),this.setAutorsMessage(s,t),this.setGeneralMessage(s,t),this.setGroupMessage(s,t),this.setClanMessage(s,t),this.setPrivInGeneral(s,t),this.createQuickMessage(s,t,o,e),this.appendToProperCard(s,t,o,e),v?API.callEvent(Engine.apiData.NEW_MSG,[s,t]):API.callEvent(Engine.apiData.UPDATE_MSG,[s,t])},this.setGeneralMessage=function(t,e){"System"!=e.n&&(0==e.k&&(""!=e.s&&"abs"!=e.s||t.find(".color-chat-msg").addClass("general-message")))},this.setGroupMessage=function(t,e){if("System"!=e.n&&2==e.k){var i=t.find(".color-chat-msg"),n=t.find(".nick");i.addClass("group-message"),n.addClass("group-nick")}},this.setClanMessage=function(t,e){if("System"!=e.n&&1==e.k){var i=t.find(".color-chat-msg"),n=t.find(".nick");i.addClass("clan-message"),n.addClass("clan-nick")}},this.setPrivInGeneral=function(t,e){if(e.where&&"general"==e.where){var i=t.find(".nick"),n=t.find(".color-chat-msg");i.addClass("System"==e.n?"system-in-general":"priv-in-general"),"sys_info"!=e.s&&n.addClass("System"==e.n?"system-in-general-span":"priv-in-general-span")}},this.setAvatarData=function(t,e,i){if(e.i&&(t.find(".nick").attr("data-avatar",e.i),e.n!=Engine.hero.d.nick)){var n=d.changeNickToIdString(e.n),s=Engine.interface.get$gameWindowPositioner().find(".tab."+n),r=s.find(".icon");if(0!=s.length&&(!r.hasClass("av")||s.attr("data-avatar")!=e.i)){var o=d.changeNickToIdString(e.n);d.createAvatar(s,e.i);var l=s.find(".icon");s.hasClass("active")&&l.addClass("active");var c=d.changeNickToIdString(Engine.hero.d.nick);a.set("chat/avatar/"+c+"/"+o,[e.i,i])}}},this.changeNickToIdString=function(t){return t.replace(/ /gi,"1").replace(/'/gi,"2").replace(/-/gi,"3").replace(/`/gi,"4")},this.changeIdStringToNick=function(t){return t.replace(/1/gi," ").replace(/2/gi,"'").replace(/3/gi,"-").replace(/4/gi,"`")},this.setTimeMessage=function(t,e){t.find(".info").tip(ut_time(Math.floor(e.ts),!0))},this.setAutorsMessage=function(t,e){if(e.n){var i=Engine.hero.d.nick,n=t.find(".nick"),a=t.find(".color-chat-msg");if(n.addClass("bold"),e.n==i&&t.addClass("hero-msg"),(!e.where||e.where&&"general"==e.where)&&n.html("&lt;"+e.n+(isset(e.nd)?" -&gt; "+e.nd+"&gt;":"&gt;")),e.where&&"onlyPriv"==e.where&&(n.html("&lt;"+e.n+"&gt;"),n.addClass(i==e.n?"yellow":"green"),a.addClass(i==e.n?"yellow":"green")),e.k<3||3==e.k&&"general"==e.where){var s=e.nd==i?e.n:e.nd;isset(e.nd)?"System"!=s&&n.addClass("pointer").tip(_t("private_msg_to %nick%",{"%nick%":s},"chat")):e.n!=i&&"System"!=s&&n.addClass("pointer").tip(_t("private_msg_to %nick%",{"%nick%":e.n},"chat"))}n.attr("data-nick",e.n==i&&e.nd?e.nd:e.n)}},this.createQuickMessage=function(t,i,n,a){if(!n&&d.canShowQuickMsg(i.ts)){var s=t.clone(!0);a?e.prepend(s):e.append(s),s.animate({right:0},100).delay(3e3).fadeOut((function(){$(this).remove()}))}},this.isAllInGeneralChannel=function(){return!Engine.opt(20)},this.appendToProperCard=function(e,i,n,a){var s,r,o,l=Engine.hero.d.nick,c=i.k>2?i.n==l?i.nd:i.n:i.k,u=this.getCardById(c),p=Engine.hero.d.nick,g=i.n==p?i.nd:i.n;if(this.isAllInGeneralChannel()&&(0!=i.k&&"general"!=i.where&&0==h)){var f=e.clone(!0,!0),m=f.find(".nick"),v=f.find(".color-chat-msg");if(f.addClass("clone"),m.addClass("pointer"),a?t.prepend(f).trigger("update"):t.append(f).trigger("update"),1==i.k&&(m.addClass("clan-in-general").tip(_t("clan_chanel")),v.addClass("clan-in-general-span")),2==i.k&&(m.addClass("group-in-general").tip(_t("group_chanel")),v.addClass("group-in-general-span")),3==i.k&&"System"!=i.n){var E=i.n==Engine.hero.d.nick?i.nd:i.n;m.html("&lt;"+i.n+(isset(i.nd)?" -&gt; "+i.nd+"&gt;":"&gt;")).addClass("priv-in-general").removeClass("green"),v.addClass("priv-in-general-span"),"System"!=E&&m.tip(_t("private_msg_to %nick%",{"%nick%":E},"chat"))}API.callEvent(Engine.apiData.UPDATE_MSG,[f,i])}if(3==i.k?(d.setLastAutor(i.n),s=g==h&&"onlyPriv"==i.where,o=0==h&&"general"==i.where):r=h==c,s||r||o){var _=d.scrolbarIsVisible();if(a?t.prepend(e).trigger("update"):t.append(e).trigger("update"),!_)d.scrolbarIsVisible()&&d.setScrollOnBottom();n||this.redNotif(u,i)}else this.redNotif(u,i)},this.setLastAutor=function(t){"System"!=t&&t!=Engine.hero.d.nick&&(E="@"+t.split(" ").join("_")+" ")},this.scrolbarIsVisible=function(){return"block"==t.parent().find(".scrollbar-wrapper").css("display")},this.redNotif=function(t,e){if(e.n!=Engine.hero.d.nick&&"System"!=e.n&&"me"!=e.s&&"nar"!=e.s&&"me"!=e.s&&"emo"!=e.s&&"sys_info"!=e.s&&"sys_red"!=e.s){var i=this.getMaxTimeShowedMsg();if(!(g||i>=e.ts)&&"entertown"!=e.s&&"sys_red"!=e.s){var n=t||this.getCardById(0),a=n.find(".counter"),s=parseInt(a.html());n.find(".notif").addClass("visible"),a.html(s+1),d.newMsgSound()}}},this.newMsgSound=function(){var t=Engine.soundManager;t.getStateSoundNotifById(0)||t.createNotifSound(0)},this.getMaxTimeShowedMsg=function(){var t=0;for(let e in f)f[e]?t=Math.max(t,e):this.addTsToTimeTable(e);return t},this.canShowQuickMsg=function(t){return(!p||p<t)&&(p=t,!0)},this.changeTab=function(e){this.updateTab(),h=e,t.html("").trigger("update"),a.set("chat/tab",e),this.$.find(".tab").removeClass("active"),this.$.find(".icon").removeClass("active");var i=this.getCardById(e);if(!i||i&&"none"==i.css("display"))this.changeTab(0);else{i.find(".counter").html(0),i.find(".notif").removeClass("visible"),i.find(".icon").addClass("active"),i.addClass("active"),i.find("span").removeClass("newMsg");for(var n=this.getSortedMessages(),s=0;s<n.length;s++)this.appendMessage(n[s]);d.rebuildCards()}},this.getCardById=function(t){for(var e=this.$.find(".tab"),i=0;i<e.length;i++)if(t==e.eq(i).attr("data-tab"))return e.eq(i)},this.getSortedMessages=function(){var t=[];for(var e in u)t.push(u[e]);return t.sort((function(t,e){return t.ts<e.ts?-1:t.ts>e.ts?1:0})),t},this.focus=function(){mobileCheck()?d.turnOnMobileView():i.focus()},this.replyTo=function(t){var e="@"+t.split(" ").join("_")+" ";mobileCheck()?this.setMobileInputVal(e):this.setInputVal(e),this.focus()},this.getInputVal=()=>i.val(),this.getMobileInputVal=()=>o.val(),this.setInputVal=t=>{t,i.val(t)},this.setMobileInputVal=t=>{t,o.val(t)},this.setLinkedItem=function(t){let e="ITEM#"+t;if(mobileCheck()){let t=this.prepareMsgWithLinkedItem(this.getMobileInputVal(),e);this.setMobileInputVal(t)}else{let t=this.prepareMsgWithLinkedItem(this.getInputVal(),e);this.setInputVal(t)}this.focus()},this.prepareMsgWithLinkedItem=(t,e)=>{if(e+=" ",""===t)return e;const i=" "===t.slice(-1)?"":" ";return t+i+e},this.sendMessage=function(t){if(!this.parseChatCommand(t))if("/cls"==(t=$.trim(t)))_g("chat&tab="+($.isNumeric(h)?h:3),!1,{c:"/cls"});else if(""!=t){var e=this.createNewVal(t);let i=Engine.chatLinkedItemsManager;i.checkSendMessageIsItemLinked(e)?i.manageItemLinked(e):d.sendRequest(e)}},this.sendRequest=function(t){_g("chat",!1,{c:t})},this.createNewVal=function(t){return 1==h?t=(isPl()?"/k ":"/g ")+t:2==h&&(t=(isPl()?"/g ":"/p ")+t),$.isNumeric(h)?t:"@"+h.replace(/ /gi,"_")+" "+t},this.parseChatCommand=function(t){var e=t.split(" ");if("/"!=t.substr(0,1)){var i="@"==e[0].substr(0,1);if(e.length>1&&i){var n=$.trim(t);return d.sendRequest(n),!0}return!1}if(e.length>1)switch(e[0]){case"/ban":var a=Engine.hero.d.uprawnienia;if(4==a||16==a){var s=t.substr(5);return Engine.smcAddon&&Engine.smcAddon.close(),Engine.smcAddon=new r(s),Engine.smcAddon.init(),!0}break;case"/k":case"/g":case"/p":n=$.trim(t);return d.sendRequest(n),!0}return!1},this.initVariables=function(){let n=Engine.interface.get$gameWindowPositioner();i=this.$.find("input"),o=n.find(".chat-layer").find(".mobile-input"),t=this.$.find(".messages-wrapper .scroll-pane"),e=n.find(".quick_messages"),l=this.$.find(".tabs-wrapper .tab")},this.initCloseMobileOverlay=function(){Engine.interface.get$gameWindowPositioner().find(".chat-layer").find(".chat-overlay").click(d.closeChatMobileOverlay)},this.closeChatMobileOverlay=function(){d.setMobileInputVal(""),$(".chat-layer").css("display","none")},this.next=function(t){t.preventDefault(),null!=b&&(b++,b>=_.length?(b=null,d.setInputVal(w),w=null):(this.setCustom(),d.setInputVal(_[b])))},this.previous=function(t){t.preventDefault(),null==b?b=_.length-1:b>0&&b--,this.setCustom(),d.setInputVal(_[b])},this.setCustom=function(){null==w&&(w=d.getInputVal())},this.initKeypress=function(){i.on("keydown",(function(t){38==t.keyCode&&d.previous(t),40==t.keyCode&&d.next(t)})),i.on("keypress",(function(t){if(13==t.keyCode){const e=d.getInputVal();t.stopPropagation(),d.sendMessage(e),null!=b&&_[b]==e||_.push(e),d.setInputVal(""),i.blur(),b=null}})).on("keyup",(function(t){"/r"==d.getInputVal()&&""!=E&&d.setInputVal(E)})).focusin((function(){mobileCheck()&&d.turnOnMobileView()})),mobileCheck()&&o.on("keypress",(function(t){if(13==t.keyCode){t.stopPropagation();let e=d.getMobileInputVal();d.sendMessage(e),d.setMobileInputVal(""),o.blur(),d.closeChatMobileOverlay()}})).focusout((function(){}))},this.turnOnMobileView=function(){Engine.interface.get$gameWindowPositioner().find(".chat-layer").css("display","block"),d.showRemainingChars(0),i.blur(),o.focus()},this.initRemaingChars=function(){o.bind("input propertychange",(function(){let t=d.getMobileInputVal();d.showRemainingChars(t.length)}))},this.initSendMessage=function(){var t=n.get("button").addClass("send-message green small");t.find(".label").html(_t("send",null,"mails")),Engine.interface.get$gameWindowPositioner().find(".chat-layer").find(".chat-mobile-input-wrapper").append(t),t.click((function(){let t=d.getMobileInputVal();d.sendMessage(t),d.closeChatMobileOverlay()}))},this.showRemainingChars=function(t){Engine.interface.get$gameWindowPositioner().find(".remaining-chars").html(_t("chats_left",null,"mails")+(200-t))},this.init=function(){$(document).on("keydown",t=>{c=t.ctrlKey}).on("keyup",()=>{c=!1}),$(window).on("blur",()=>{c=!1}),d.$=n.get("chat-tpl"),Engine.interface.get$interfaceLayer().find(".left-column").find(".inner-wrapper").append(this.$),d.initCards(),d.initSortable(),d.initVariables(),$(l[0]).addClass("active"),d.setVisibleCard(2,0),d.initKeypress(),d.initRemaingChars(),d.initSendMessage(),d.initCloseMobileOverlay(),d.initClickMessage(),d.initSendButton(),d.initScroll()},this.initSendButton=function(){this.$.parent().find(".send-btn").click((function(){let t=d.getInputVal();d.sendMessage(t),d.setInputVal(""),i.blur()}))},this.checkItsMe=function(t){return t==Engine.hero.d.nick},this.checkPrivateCard=function(t){var e;return e=isset(t)?t:h,isNaN(parseInt(e))},this.initClickMessage=function(){$(document).on("click",".chat-message .nick, .chat-message .priv-message",(function(t){var e=$(this).attr("data-nick");if("System"!=e&&e!=Engine.hero.nick)return c?(d.setInputVal(e+" "),void d.focus()):void(d.checkPrivateCard()?d.focus():d.checkItsMe(e)?d.putNickInInput():d.replyTo(e))})),$(document).on("contextmenu",".chat-message .nick",(function(t,e){var i=$(this).attr("data-nick");if("System"!=i){var n=[];if(d.checkPrivateCard()?d.putNickInInput(i,n):d.checkItsMe(i)?d.goToGroupOrClan(i,$(this),n):(d.replyItem(i,n),d.goToGroupOrClan(i,$(this),n),d.addCardToMenu(i,$(this),n),d.putNickInInput(i,n),d.checkSmc(i,n)),n.length>0){var a=getE(t,e);a.clientX+=30,Engine.interface.showPopupMenu(n,a)}}}))},this.putNickInInput=function(t,e){e.push([_t("player_nick",null,"clan"),function(){d.setInputVal(t+" "),d.focus()}])},this.replyItem=function(t,e){e.push([_t("send_message",null,"chat"),function(){d.replyTo(t)}])},this.addCardToMenu=function(t,e,i){t!=Engine.hero.d.nick&&"System"!=t&&i.push([_t("create_chat_card"),function(){var i=e.attr("data-avatar"),n=e.parent().hasClass("hero-msg");d.createPrivCard(t,n?"":i,!0),d.rebuildStorage(),d.rebuildCards(),d.changeTab(t)}])},this.goToGroupOrClan=function(t,e,i){e.hasClass("clan-in-general")&&i.push([_t("to-clan"),function(){d.changeTab(1)}]),e.hasClass("group-in-general")&&i.push([_t("to-group"),function(){d.changeTab(2)}])},this.checkSmc=function(t,e){var i=Engine.hero.d.uprawnienia;0!=i&&t!=Engine.hero.d.nick&&"System"!=t&&(e.push(["MC Panel",function(){Engine.mcAddon||(Engine.mcAddon=new s(d),Engine.mcAddon.init()),Engine.mcAddon.update(t)}]),4!=i&&16!=i||e.push(["SMC Panel",function(){Engine.smcAddon&&Engine.smcAddon.close(),Engine.smcAddon=new r(t),Engine.smcAddon.init()}]))},this.initScroll=function(){d.$.find(".messages-wrapper").addScrollBar({track:!0,wheelSpeed:40}),d.setScrollOnBottom()},this.setScrollOnBottom=function(){$(".scroll-wrapper",d.$).trigger("scrollBottom")},this.updateTab=function(){l=this.$.find(".tabs-wrapper .tab")},this.createPrivCard=function(t,e,i){if(0==Engine.interface.get$gameWindowPositioner().find('[data-tab="'+t+'"]').length){var n=this.createCard(t,!0,t,!0,e);i?$(d.$.find("[data-tab=2]")[0]).after(n):this.$.find(".tabs-wrapper").append(n)}},this.saveToStorage=function(t,e,i){if(""!=e){var n=d.changeNickToIdString(t),s=d.changeNickToIdString(Engine.hero.d.nick);a.set("chat/avatar/"+s+"/"+n,[e,i])}},this.rebuildCards=function(){var e=d.getAmountCards(),i=d.getChatSizeFromStorage()>1?14:7,n=Math.ceil(e/i);d.$.find(".tabs-pannel").css("height",5+35*n),d.$.find(".messages-wrapper").css("top",4+35*n),t.trigger("update")},this.getChatSizeFromStorage=()=>a.get("chatSize"),this.onClear=function(){d.deleteSysRed()},this.deleteSysRed=function(){if(u){d.$.find(".chat-message.sys_important_info").remove();for(var t=0;t<u.length;t++)"sys_red"==u[t].s&&u.splice(t,1)}},this.alert=function(t,e){mAlert(t,[{txt:_t("yes"),callback:function(){return e(),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.createTextNodeOrSpanLinkedItem=(t,e,i)=>Engine.chatLinkedItemsManager.checkReceiveMessageHaveLinkedItem(t,e)?Engine.chatLinkedItemsManager.parseReceiveMessageWithLinkedItem(t,e,i):document.createTextNode(t),this.chatTextWithHeroNick=function(t,e){var i=Engine.hero.d.nick,n=new RegExp("^"+i+" | "+i+" | "+i+"$|^"+i+"$","ig"),a=e.split(n);let s=[];for(let t in a){let e=a[t];s.push(d.createTextNodeOrSpanLinkedItem(e))}for(var r=$("<b>").addClass("yourname").text(i),o=0;o<s.length;o++){d.appendTextToColorChatMsg(t,s[o]),t.append(s[o]),o==s.length-1?t.append(s[s.length-1]):(t.append(document.createTextNode(" ")),t.append(r.clone()),t.append(document.createTextNode(" ")))}},this.appendTextToColorChatMsg=(t,e)=>{if(Array.isArray(e))for(let i in e)t.append(e[i]);else t.append(e)},this.createChatURL=function(t){var e=t.toObject("https"),i=$("<u>");return i.addClass("link"),i.click((function(){if(isPl()){const t=e.href.indexOf("https://www.margonem.pl/profile/view,")>-1,i=e.href.indexOf("https://www.margonem.pl/guilds/view,")>-1;if(t)return void Engine.iframeWindowManager.newPlayerProfile({staticUrl:e.href});if(i)return void Engine.iframeWindowManager.newClanPage({staticUrl:e.href})}window.goToUrl(e.href)})),i.text(e.href),i},this.checkCorrectlyURL=function(t){return/^(?:(https?:\/\/)|(www\.))/i.test(t)},this.parseJoinToGame=function(t,e){if(t.indexOf(" dołączył")>=0){const i=t.substring(0,t.indexOf(" dołączył"));e.addClass("pointer priv-message").tip(_t("private_msg_to %nick%",{"%nick%":i},"chat")),e.attr("data-nick",i)}return e},this.parseChatText=function(t,e){var i=t.find(".color-chat-msg"),n="entertown"==e.s;if("sys_info"==e.s||"sys_red"==e.s){var a=parseChatBB(e.t);if(!n&&-1==e.t.indexOf("url")){var s=Engine.hero.d.nick,r=new RegExp("^"+s+" | "+s+" | "+s+"$|^"+s+"$","ig");a=a.replace(r,' <b class="yourname">'+s+"</b> ")}"sys_info"==e.s&&this.parseJoinToGame(e.t,i),Engine.chatLinkedItemsManager.checkReceiveMessageHaveLinkedItem(a,!0)?i.append(d.createTextNodeOrSpanLinkedItem(a,!0,!0)):i.append(a)}else if(isset(window.linkify)){var o=linkify.tokenize(e.t);for(var l in o){var c=o[l];h=c.toString();"url"==c.type&&d.checkCorrectlyURL(h)?i.append(d.createChatURL(c)):n?i.append(d.createTextNodeOrSpanLinkedItem(h)):d.chatTextWithHeroNick(i,h)}}else{var h=e.t;n?i.append(d.createTextNodeOrSpanLinkedItem(h)):d.chatTextWithHeroNick(i,h)}return i},this.clear=function(e){t.html("")},this.onResize=function(){t.trigger("update")}}},function(t,e){let i={ON_IN:"ON_IN",ON_OUT:"ON_OUT"};t.exports={defaultData:{REPEAT:1,COLS:1,ROWS:1,ACTION_ON_EACH_CORD:!1,kind:i.ON_IN},kind:i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n={type:"yesno4"};e.default=class{constructor(){this.conditions=[]}addCondition(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=Object.assign(Object.assign({},n),i);return this.conditions.push({condition:t,message:e,confirmOptions:a}),this}processConditions(t){this.processCondition(0,t)}processCondition(t,e){if(t<this.conditions.length){const{condition:i,message:n,confirmOptions:a}=this.conditions[t];i()?askAlert(Object.assign({q:n,clb:()=>{this.processCondition(t+1,e)}},a)):this.processCondition(t+1,e)}else e()}}},function(t,e,i){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.RECEIVED="received",t.SENT="sent",t.NEW_MAIL="new"}(n||(n={})),e.default=n},function(t,e,i){var n=i(0);const{replaceNumber:a}=i(2);t.exports={setSkillTip:function(t,e){let a=e.id,s=e.name,r=i(71).getSections(a,e),o=this.getSkillTextBySectionsData(r),l=n.get("one-battle-skill-tip");if(l.find(".skill-name").html(s),l.find(".skill-attrs").html(o.join(" ")),""!=r.cost){let t=r.cost.join("").replace(/\((\D+[\d\D]*)\)/g,"");l.find(".skill-cost").html(t)}""!=r.lvl&&l.find(".skill-level").html(_t("level",null,"pklist")+r.lvl),l.find(".icon").addClass("icon-"+a+" "+_l()),CFG.debug&&l.append(this.getDebugContent(e)),t.tip(l.prop("outerHTML"),"t_skill")},getDebugContent:t=>`\n    <span class="debug-content">\n      id: ${t.id}, \n      name: ${t.name}<br>\n      regs: ${t.regs}<br>\n      stats: ${t.stats}<br>\n      kind: ${t.kind}\n    </span>\n  `,changeIconRegToTextReg:function(t){let e=Engine.battle.getIconTips();for(let i in e)if(t.search(i)>-1)return'<span class="weapon-require">'+e[i]+"</span>";return t},getSkillTextBySectionsData:function(t){let e=[];for(let i in t.attr){let n=t.attr[i];if(n.length){for(let t in n)e.push(n[t]);e.push('<div class="line"></div>')}}if(t.regs.length){e.push("<div>"+_t("lower_requirements",null,"skills")+"</div>");for(let i in t.regs)e.push(`- ${t.regs[i]}<br>`);e.push('<div class="line"></div>')}return e},getStats:function(t,e){let i=null;if(!isset(t.cLvl))return t.allStats[0]+"&"+t.allStats[0];const n=isset(e)?e-1:t.cLvl,a=t.allStats[t.currentStatsIndex],s=t.regs+";"+t.allStats[n];return i=t.cLvl<t.mLvl?a+"&"+s:a+"&"+a,i},changeCostInTip:(t,e)=>{const i=t.getTipData(),n=$("<div/>").html(i),s=".skill-cost span";if(n.find(s).length>0){const i=n.find(s),r=i.text();i.text(a(r,e)),t.changeInTip(s,i.html())}}}},function(t,e,i){var n=i(5),a=i(278),s=i(109);t.exports=function(){var t=this,e=!1;this.trackList={},this.activeTrack=null,this.tasks={},this.trackedNpcs={},this.placeHolders={},this.questTargets={},this.arrows={},this.settrackFalseStart=!1,this.collect=!1,this.init=function(){t.npcTarget=new a,t.npcTarget.init("npc")},this.resetTasks=function(){for(var t in this.tasks={},this.trackedNpcs={},this.trackList)delete this.trackList[t].closerPos},this.checkTaskNpcOrItem=function(t,e){};this.updateData=function(i){var n=this.deleteDoubleRecords(i);e=!0;var a=[];for(var s in Engine.map.gateways.removeHightlights(),this.placeHolders={},this.questTargets={},this.arrows={},n)if("*"!=n[s]){if(""!=n[s]){var r=n[s].split("|");if(a.indexOf(r[0])<0&&(a.push(r[0]),this.trackList[r[0]]=[]),5==r.length)this.trackList[r[0]].push({pos:r[4].split("."),data:"#"+r[1][0]+"."+(s-1)+"#"+r[3],txt:r[3]+("K"==r[1][0]?" ("+r[2]+")":""),quest:r[0],collect:"C"==r[1][0]?parseInt(r[2]):null});else if(3==r.length){if(-1==r[2].split(".")[1]&&-1==r[2].split(".")[2])continue;this.trackList[r[0]].push({pos:r[2].split("."),data:/Kill: /.test(r[1])?t.getName(r[1]):r[1],txt:r[1].replace(/#[KB]\.([0-9]+)#/g,""),quest:r[0]})}}}else this.trackList={};var o=this.getTrackingStorage();!o||this.activeTrack||isset(this.settrack)||this.startTracking(o,!0),this.settrack&&this.settrackFalseStart&&this.startTracking(this.settrack),e=!1,this.isCollect(),this.upgradeTasks(),this.drawArrow(),Engine.quests.setAvailableOfTrackingButtons()},this.deleteQuest=t=>{if(this.isQuestInTrackListArray(t)&&(delete this.trackList[t],this.settrack===t)){this.stopTracking();let t=Object.keys(this.trackList);this.settrack=t.length>0?t[0]:null,this.settrack&&this.startTracking(this.settrack)}},this.isQuestInTrackListArray=t=>isset(this.trackList[t]),this.getName=function(t){var e=t;return(e=e.replace(/Kill: /g,"")).replace(/.\(.*\)/g,"")},this.deleteDoubleRecords=function(t){for(var e=[],i=[],n=0;n<t.length;n++){var a=t[n];if(!(e.indexOf(a)>-1)){var s=a.split("|");if(Array.isArray(s)&&"KILL"==s[1]){var r=s[3];if(i.indexOf(r)>-1)continue;e.push(a),i.push(r)}else e.push(a)}}return e},this.toggleTrack=function(t){if(t==this.activeTrack)return this.settrack=null,this.stopTracking();this.startTracking(t,!0)},this.setTrackingInStorage=function(t){n.set("qtrack"+Engine.hero.d.id,parseInt(t))},this.getTrackingStorage=function(){var t=Engine.hero.d.id;return n.get("qtrack"+t)},this.startTracking=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.settrackFalseStart=!1,t=parseInt(t),this.resetTasks(),this.stopTracking(),Engine.map.gateways.removeHightlights(),this.questTargets={},this.placeHolders={},this.arrows={},isset(this.trackList[t])?(this.setTrackingInStorage(t),this.activeTrack=t,e&&(this.settrack=t),this.isCollect(),this.upgradeTasks(),this.drawArrow(),Engine.items.updateTrackHighlights(),Engine.tpls.updateTrackHighlights()):(this.settrack=t,this.settrackFalseStart=!0)},this.isCollect=function(){if(this.collect=!1,isPl())for(var t in this.trackList[this.activeTrack])if("C"==this.trackList[this.activeTrack][t].data[1]){this.collect=this.trackList[this.activeTrack][t].collect-0>0}},this.upgradeTasks=function(){if(this.resetTasks(),this.activeTrack&&isset(this.trackList[this.activeTrack])){for(var t=this.trackList[this.activeTrack],e=!1,i=0;i<t.length;i++){let n="item";if(/#[BKC]\.([0-9]+)#/.test(t[i].data)){const a=this.getNameFromData(t[i].data);/#[K]\.([0-9]+)#/.test(t[i].data)&&(n="npc"),this.tasks[i]=this.prepareTask(a,n),/#[BC]\.([0-9]+)#/.test(t[i].data)&&4==t[i].pos.length&&(n="npc",this.tasks[i]=this.prepareTask(t[i].pos[3],n)),this.putPlaceholder(i,n),e=!0}}if(e){var n=Engine.npcs.check(),a=Engine.map.groundItems.getDrawableItems();for(i in n)this.checkTaskNpcOrItem(i,"npc");for(i in a)isset(a[i].i)&&this.checkTaskNpcOrItem(a[i].i.id,"item")}}},this.prepareTask=(t,e)=>({name:t,type:e}),this.getNameFromData=t=>t.replace(/(.*?#)|\s(\(.*)/g,""),this.putPlaceholder=function(t,e){const i=this.trackList[this.activeTrack][t].pos;if(!isset(Engine.map.gateways.getGtwAtPosition(i[1],i[2]))&&0!==parseInt(i[0])){var n=i[1]+"_"+i[2];isset(this.questTargets[n])&&1==this.questTargets[n].enabled&&this.questTargets[n].setEnabled(!1),isset(this.placeHolders[n])||(this.placeHolders[n]=new a,this.placeHolders[n].init("npc_item"),this.placeHolders[n].setOpacity(1)),this.placeHolders[n].setEnabled(!0),this.placeHolders[n].setTip(_t("quest_placeholder_"+e,{"%NAME%":this.tasks[t].name},"quest")),this.placeHolders[n].setPosition({rx:i[1],ry:i[2]}),3===Engine.map.d.mode&&this.placeHolders[n].setEnabled(!1)}},this.putPlaceholder2=function(t,e){const i=this.trackList[this.activeTrack][t].pos,n=getEngine().map;let s=i[1],r=i[2],o=i[0],l=s+"_"+r,c="npc"==e,d=n.col.check(s,r,2),h=n.gateways.getGtwAtPosition(s,r);if(0===parseInt(o))return;!c||d||h||(e="npc_item");let u=this.questTargets[l],p=this.placeHolders[l];u&&u.setEnabled(!1),p||(p=new a,this.placeHolders[l]=p,p.init(e),p.setOpacity(1));let g=!h;p.setEnabled(g),p.setTip(_t("quest_placeholder_"+e,{"%NAME%":this.tasks[t].name},"quest")),p.setPosition({rx:i[1],ry:i[2]}),3===n.d.mode&&p.setEnabled(!1)},this.checkGwAndHighlight=function(t){if(isset(this.trackList[this.activeTrack]))for(var e in this.trackList[this.activeTrack])isset(Engine.map.gateways.getGtwById(t))&&this.trackList[this.activeTrack][e].pos[0]==t&&Engine.map.gateways.addHightlight(t)},this.removePlaceholder=function(t){var e=t[1]+"_"+t[2];isset(this.placeHolders[e])&&this.placeHolders[e].setEnabled(!1)},this.stopTracking=function(t){void 0!==t&&t!=this.activeTrack||(n.get("qtrack"+Engine.hero.d.id)&&n.remove("qtrack"+Engine.hero.d.id),this.activeTrack=null,this.placeHolders={},this.questTargets={},this.arrows={},Engine.map.gateways.removeLock(),Engine.map.gateways.removeHightlights(),Engine.items.updateTrackHighlights(),Engine.tpls.updateTrackHighlights())},this.drawArrow=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e){if(!isset(this.trackList[this.activeTrack]))return this.stopTracking();for(var i in this.trackList[this.activeTrack]){var n=this.trackList[this.activeTrack][i].pos;-1!=parseInt(n[0])&&-1!=parseInt(n[1])&&-1!=parseInt(n[2])&&(parseInt(n[0])>0&&this.checkGwAndHighlight(parseInt(n[0])),this.updateArrow(this.trackList[this.activeTrack][i],t))}}},this.checkClosestPos=function(t){let e=null,i=null,n=d();for(let a in t.closerPos){const s=t.closerPos[a],r=n.rx-parseInt(s[1]),o=n.ry-parseInt(s[2]),l=Math.max(Math.abs(r),Math.abs(o));(null===e||e>l)&&(e=l,i=t.closerPos[a])}if(i){for(let e in this.questTargets)e.includes(t.data)&&this.questTargets[e].setEnabled(!1);return i}return!1},this.hideArrowAndRemoveHighlight=function(t,e){this.arrows[t].updateDATA({enabled:!1}),Engine.map.gateways.removeHightlights(e)},this.checkPlaceholderOnInstance=e=>Object.keys(t.placeHolders).includes(e);let i=0,r=null,o=!0,l=0,c=0;const d=()=>Engine.hero;this.updateArrow=function(e,i){let n=e.pos;const s=n.join("_").replace(" ","_")+e.data;let r=d();if(isset(e.closerPos)&&this.checkClosestPos(e))n=this.checkClosestPos(e);else{const e=n[1]+"_"+n[2];if(3===Engine.map.d.mode&&t.checkPlaceholderOnInstance(e))return}let o=r.rx-parseInt(n[1]),l=r.ry-parseInt(n[2]);const c=Math.max(Math.abs(o),Math.abs(l)),h=Math.sqrt(o*o+l*l);let u=Math.min(99,16*h);if(this.checkIdleArrowAnimation()){const t=this.doArrowAnimation(i,h);u=t||u}const p=this.setFade(h,!0);c?(o=Math.round(u*o/c),l=Math.round(u*l/c)):(o=0,l=0),isset(Engine.map.gateways.getGtwAtPosition(n[1],n[2]))||(!isset(this.placeHolders[s])||0!=this.placeHolders[s].enabled)&&isset(this.placeHolders[s])||(p<1?(isset(this.questTargets[s])||(this.questTargets[s]=new a,this.questTargets[s].init("npc")),this.questTargets[s].setEnabled(!0)):isset(this.questTargets[s])&&this.questTargets[s].setEnabled(!1),isset(this.questTargets[s])&&this.questTargets[s].enabled&&(this.questTargets[s].setPosition({rx:n[1],ry:n[2]}),this.questTargets[s].setOpacity(1-p))),this.setArrow(s,n,h,e.txt,o,l)},this.updateArrow2=function(e,i){let n=e.pos;const a=n.join("_").replace(" ","_")+e.data;let s=d();if(isset(e.closerPos)&&this.checkClosestPos(e))n=this.checkClosestPos(e);else{const e=n[1]+"_"+n[2];if(3===Engine.map.d.mode&&t.checkPlaceholderOnInstance(e))return}let r=s.rx-parseInt(n[1]),o=s.ry-parseInt(n[2]);const l=Math.max(Math.abs(r),Math.abs(o)),c=Math.sqrt(r*r+o*o);let u=Math.min(99,16*c);if(this.checkIdleArrowAnimation()){const t=this.doArrowAnimation(i,c);u=t||u}const p=this.setFade(c,!0);l?(r=Math.round(u*r/l),o=Math.round(u*o/l)):(r=0,o=0);let g=a,f=n[1]+"_"+n[2];h(g,p,n),h(f,p,n),this.setArrow(a,n,c,e.txt,r,o)};const h=(t,e,i)=>{let n=this.placeHolders[t];Engine.map.gateways.getGtwAtPosition(i[1],i[2]);if(n&&0==n.enabled||!n){let n=this.questTargets[t];e<1?(n||(n=new a,this.questTargets[t]=n,n.init("npc")),n.setEnabled(!0)):n&&n.setEnabled(!1),n&&n.enabled&&(n.setPosition({rx:i[1],ry:i[2]}),n.setOpacity(1-e))}};this.clearAnim=()=>{i=0,c=0,r=null,o=!0,l=0},this.checkIdleArrowAnimation=()=>Engine.hero.getIdleTime()-c>5,this.doArrowAnimation=(t,e)=>{i+=10*t;let n=Math.sin(i);null==r&&(r=0);let a=n>r;if(a===o||(o=a,l++),l>1&&n>0)return this.clearAnim(),c=Engine.hero.getIdleTime(),!1;r=n;const s=99+.5*n*16,d=16*(e+.5*n);return Math.min(s,d)},this.setArrow=(t,e,i,n,a,r)=>{const o=Math.atan2(-r,-a),l=this.setFade(i),c={};let h=d();isset(this.arrows[t])||(this.arrows[t]=new s),c.id=t,c.opacity=.6*(l>0?Math.min(1,l):1),c.radians=o,c.enabled=l>0,c.tip=n,c.posX=32*(h.rx-Engine.map.offset[0]/32)-a,c.posY=32*(h.ry-Engine.map.offset[1]/32)-r,this.arrows[t].updateDATA(c)},this.setFade=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e?16:48,n=50,a=130,s=Math.min(a,i*t),r=a-n,o=s-a+r;return o>=r?1:o<=0?0:o/r},this.getDrawableList=function(){var t,e=[];for(t in this.placeHolders)this.placeHolders[t].enabled&&e.push(this.placeHolders[t]);for(t in this.questTargets)this.questTargets[t].enabled&&e.push(this.questTargets[t]);for(t in this.arrows)this.arrows[t].enabled&&e.push(this.arrows[t]);return e},this.init()}},function(t,e){t.exports={TYPE:{COLLECT:"COLLECT",TALK:"TALK",KILL:"KILL"},TRACKING_ARROW:"TRACKING_ARROW",HIGHLIGHT_CLASS:{TRACK:"track",QUEST:"quest-item-require"}}},function(t,e,i){var n=i(0),a=i(281),s=i(18),r=i(110);t.exports=function(){var t,e=this;this.init=function(){this.initWindow(),this.initGrid(),this.updateSl(),this.createBottomPanel(),this.center()},this.updateSl=function(){var e=Engine.hero.d.credits;t.find(".sl-amount").html(e)},this.center=function(){this.wnd.center()},this.showCodeProm=function(){Engine.codeProm||(Engine.codeProm=new a),Engine.codeProm.initAskAlert()},this.showStaminaShop=function(){Engine.staminaShop=new r,Engine.staminaShop.init()},this.addControll=function(t,i,a){var s=n.get("button");return a&&s.click(a.bind(e)),s.find(".label").html(t),this.wnd.find(i).append(s),s},this.initGrid=function(){for(var t={[CFG.LANG.PL]:[[{name:"chest",txt:0,npcPhone:"chests"},{name:"consumtable",txt:12,npcPhone:304},{name:"helmets",txt:5,npcPhone:301},{name:"gold-shop",txt:3,npcPhone:"gold"}],[{name:"for-you",txt:21,npcPhone:"for-you"},{name:"rings",txt:9,npcPhone:299},{name:"necklaces",txt:8,npcPhone:302},{name:"gloves",txt:6,npcPhone:296}],[{name:"outfits",txt:14,npcPhone:293},{name:"pets",txt:13,npcPhone:295},{name:"armor",txt:7,npcPhone:298},{name:"upgrades",txt:1,npcPhone:306}],[{name:"teleports",txt:11,npcPhone:294},{name:"stamina",txt:2,npcPhone:"stamina"},{name:"boots",txt:4,npcPhone:297},{name:"bags",txt:15,npcPhone:300}]],[CFG.LANG.EN]:[[{name:"chest",txt:0,npcPhone:191},{name:"sales",txt:20,npcPhone:190}],[{name:"potions",txt:16,npcPhone:154},{name:"upgrades",txt:1,npcPhone:155},{name:"gold-shop",txt:3,npcPhone:"gold"}],[{name:"blessing",txt:18,npcPhone:164},{name:"teleports",txt:11,npcPhone:163},{name:"pets",txt:13,npcPhone:165}],[{name:"outfits",txt:14,npcPhone:166},{name:"bags",txt:15,npcPhone:167},{name:"boots",txt:22,npcPhone:400}]]}[_l()],i=t.length,a=0;a<i;a++){var s=n.get("premium-item-wrapper");for(var r in e.wnd.$.find(".product-kind").append(s),t[a]){var o=t[a][r],l=n.get("premium-item").addClass(o.name),c=_t("new_premium_item_"+o.txt,null,"premium_panel");l.find(".premium-text").html(c),e.clickShop(l,o.npcPhone),s.append(l)}}},this.clickShop=function(t,i){t.click((function(t){t.stopPropagation(),e.allShopsClosed(),e.showShop(i)}))},this.allShopsClosed=function(){for(var t=[Engine.shop,Engine.staminaShop,Engine.goldShop,Engine.chests,Engine.promo],e=0;e<t.length;e++)t[e]&&t[e].hide()},this.showShop=function(t){"gold"==t&&_g("creditshop&credits_gold=-1"),"stamina"==t&&e.showStaminaShop(),"chests"==t&&_g("creditshop&npc=436"),"for-you"==t&&_g("creditshop&filters=1&npc=479&filterlvlunder=10&filterlvlabove=5"),"number"==typeof t&&_g("creditshop&npc="+t)},this.initWindow=function(){(t=n.get("premium-panel")).find(".background").addClass("bck-"+_l()),Engine.windowManager.add({content:t,title:this.tLang("premium_shop"),nameWindow:Engine.windowsData.name.PREMIUM_WND,objParent:this,nameRefInParent:"wnd",onclose:()=>{e.close()}}),this.wnd.addToAlertLayer()},this.createBottomPanel=function(){var t=n.get("button").addClass("small purple");t.find(".label").text(_t("buy_sl",null,"shop")),t.click((function(t){t.stopPropagation(),Engine.draconiteShop||(Engine.draconiteShop=new s,Engine.draconiteShop.open())})),e.wnd.$.find(".premium-bottom-panel").addClass(_l());var i=n.get("button").addClass("small purple");i.find(".label").text(_t("have_code",null,"premium_panel")),i.click(e.showCodeProm),e.wnd.$.find(".buy-currency").append(t),e.wnd.$.find(".recover-items").append(i);var a=_t("buy_sl_label",null,"shop");e.wnd.$.find(".currency-label").html(a),e.wnd.$.find(".chest").addClass("sl")},this.close=function(){e.wnd.remove(),Engine.premium=!1},this.tLang=function(t,e){return _t(t,null,e||"premium_panel")}}},function(t,e,i){var n=i(0),a=i(111),s=i(295);let r=i(296),o=i(29),l=i(297);var c=i(12),d=i(28),h=i(38);t.exports=function(t,e,i){var u=this,p=this,g={heroic:["t-her",2,2],upgraded:["t-upgraded",3,3],elite:["t-uniupg",1,1],unique:["t-uniupg",1,1],legendary:["t-leg",4,4],artefact:["t-art",5,5],common:["t-norm",0,0]};let f={};var m=0,v=null;var E=!0,_=!0;this.$=n.get("item"),this.$.data("item",this),this.id=t,this.events={},this._cachedStats=null,this.onload=!1,this.itemType=null,this.hlPos=null,this.score=null,this.ctx,this.$canvasIcon;let b=!1;"tpl"==i&&(this.st=0),this.createNotice=t=>{if(f[t])return;let e=new l(t);e.init(t,this),f[t]=e},this.removeNotice=t=>{f[t]&&(b=!0,delete f[t])},this.clearCanvasNotice=()=>{let t=this.getView();for(let e in t){let i=t[e][4];i=this.isItem()?t[e][4]:t[e][5];let n=i.canvas;i.clearRect(0,0,n.width,n.height)}},this.update=(t,e)=>{if(!(Engine.reload&&isset(t.loc)&&h.isEquipItemLoc(t.loc))||isset(Engine.hero.oldLvl)&&Engine.hero.oldLvl>Engine.hero.d.lvl&&1===Engine.hero.d.lvl){var i={};for(var n in t)i[n]=this[n],this[n]=t[n];h.isGroundItemLoc(this.loc)&&(this.d={id:t.hid,x:this.x,y:this.y},this.rx=this.x,this.ry=this.y),this._cachedStats=this.parseStats(),_&&(this.createHighlight(),this.$.attr("data-name",parseItemBB(this.name)),this.$.addClass("item-id-"+this.id)),this.updateAmount(),this.updateCl(),this.updateTtl(),this.addScore(),this.isItem()&&this.checkGetNow(t),p.updateIcon(),E||this.setTip(),this.isItem()&&this.trigger("afterUpdate",i,e),Engine.itemsMarkManager.newItem(p),_&&(_=!1,p.continueFetch())}},this.updateIcon=()=>{if(E){E=!1;var t=CFG.r_ipath+this.icon;p.setPlaceHolderIcon(),Engine.imgLoader.onload(t,{speed:!1,externalSource:cdnUrl},!1,(t,e)=>{p.afterOnloadItem(e,t)},()=>{log("Fetch error! Path: "+t+" ("+p.name+")")})}},this.setIdFetchPackage=function(t){p.idFetchPackage=t},this.updateDraw=function(t){p.animate(t)},this.drawItem=function(t,e,i,n,a,s){if(i==Engine.itemsViewData.BAG_VIEW&&c.isInBagSt(p.st)){if(Engine.heroEquipment.getActiveBag()-20!=Math.floor(p.y/6))return}v&&this.drawIcon(t,e),n&&this.drawNotice(s,a)},this.drawIcon=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.drawImage(p.sprite,0,p.staticAnimation?0:32*p.activeFrame,32,32,0,0,32,32)},this.drawNotice=(t,e)=>{if(b&&t.clearRect(0,0,e.width,e.height),Object.keys(f).length){t.clearRect(0,0,e.width,e.height),b=!1;for(let i in f)f[i].draw(t,e)}},this.animate=function(t){null!==v?this.frames&&this.frames.length>1&&t?(m+=100*t,this.frames[this.activeFrame].delay<m?(m-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1,C(!0)):C(!1)):C(!1):C(!0)},this.setPlaceHolderIcon=()=>{let t=Engine.items.getPlaceholderItem();p.fw=32,p.fh=32,p.halffw=16,p.halffh=16,p.activeFrame=0,p.sprite=t,p.$canvasIcon=p.$.find(".canvas-icon"),p.ctx=p.$canvasIcon[0].getContext("2d"),p.ctx.drawImage(t,0,0)},this.afterOnloadItem=(t,e)=>{this.fw=t.hdr.width/4,this.fh=t.hdr.height/4,this.halffw=this.fw/2,this.halffh=this.fh/2,this.frames=t.frames,this.activeFrame=0,this.sprite=e,this.imgLoaded=!0,this.onload=!0,this.ctx=this.$canvasIcon[0].getContext("2d"),this.ctx.clearRect(0,0,this.$canvasIcon[0].width,this.$canvasIcon[0].height),this.ctx.drawImage(e,0,0),this.setTip(),this.isItem()?Engine.items.changePlaceHolderIconIntoNormalIcon(this.id):Engine.tpls.changePlaceHolderIconIntoNormalIcon(this.id,this.loc)},this.continueFetch=function(){p.isItem()?Engine.items.newItemInLocation(p.loc,p,p.idFetchPackage):Engine.tpls.newTplInLocation(p.loc,p,p.idFetchPackage)},this.fetchError=function(){console.log("fetch error")},this.getTpl=()=>this.isItem()?this.tpl:this.id,this.isItem=function(){return"item"==i},this.updateDynamicTips=(t,e,i)=>{if(this.stat.match(e)){let e;t.on("mouseover",()=>{this.setTip(t),e=setInterval(()=>{t.is(":visible")||clearInterval(e),this.setTip(t)},i)}),t.on("mouseleave",()=>{clearInterval(e)})}},this.updateTtl=()=>{c.isBlessSt(this.st)&&(1===parseInt(this._cachedStats.ttl)?(this.$.addClass("very-low-value"),message(_t("bless_soon_end"))):this.$.removeClass("very-low-value"))},this.updateAmount=function(){var t=null,e=d.isBagCl(this.cl)&&h.isEquipItemLoc(this.loc)&&c.isBagSlotSt(this.st),i=isset(this._cachedStats.cursed),n=isset(this._cachedStats.amount)?this._cachedStats.amount:0;if(!c.isBlessSt(this.st)&&n>0&&(t=n),t||e||i){var a,s=$(".amount",this.$);e?(this.$.addClass("bag"),a=""):a=t,s.length||(s=$("<div></div>"),this.$.append(s)),a=roundShorten(Math.max(0,a)),s.attr("class","amount").html(a)}else $(".amount",this.$).remove();if(i&&(null===t?this.$.find(".amount").addClass("low-value"):this.$.find(".amount").removeClass("low-value")),e){var r=this.st-20,o=this.parseStats();Engine.bags[r][0]=parseInt(o.bag),Engine.bags[r][2]=parseInt(this.id)}},this.updadeViewAfterUpdateItem=t=>{p.$.find(".amount").hasClass("low-value")?t.find(".amount").addClass("low-value"):t.find(".amount").removeClass("low-value"),p.$.hasClass("very-low-value")?t.addClass("very-low-value"):t.removeClass("very-low-value"),this.setTip(t);let e=p.$.find(".cooldown");e.length&&t.append($("<div>").addClass("cooldown").html(e.html())),isset(p._cachedStats.amount)&&t.find(".amount").html(roundShorten(p._cachedStats.amount))},this.getUnbindCost=()=>isset(this.unbindCost)?this.unbindCost:null,this.checkGetNow=function(t){this.getNow||(this.getNow=isset(t.nn)&&1===t.nn)},this.firstGetNow=function(){Engine.allInit&&(this.getNow=!0)},this.canShowOutfit=function(t){isset(this._cachedStats.outfit)&&t.push([_t("show",null,"item"),function(){Engine.showMiniature&&Engine.showMiniature.close(),Engine.showMiniature=new r,Engine.showMiniature.init(),Engine.showMiniature.onUpdate(p,o.drawSystem.PLAYER_OUTFIT)}])},this.canShowOutfitSelector=function(t){this.haveStat("outfit_selector")&&t.push([_t("show",null,"item"),function(){Engine.showMiniature&&Engine.showMiniature.close();let t=p.getOutfits();Engine.chooseOutfit&&Engine.chooseOutfit.close(),Engine.chooseOutfit=new a,Engine.chooseOutfit.init(!0),Engine.chooseOutfit.update({item_id:p.id,outfitsTTL:0,outfits:t})}])},this.getOutfits=()=>{let t={},e=p._cachedStats.outfit_selector.split("|");e.shift();for(let i=0;i<e.length;i++){let n=e[i].split(",");t[i]={img:n[0],name:n[1],gender:n[2]}}return t},this.canShowPet=function(t){isset(this._cachedStats.pet)&&t.push([_t("show",null,"item"),function(){Engine.showMiniature&&Engine.showMiniature.close(),Engine.showMiniature=new r,Engine.showMiniature.init(),Engine.showMiniature.onUpdate(p,o.drawSystem.PET)}])},this.showIdStatMenu=function(t){"n"!=this.loc&&t.push([_t("show_id"),()=>{new s(this)}])},this.stickTip=function(t){"n"!=this.loc&&"l"!=this.loc&&t.push([_t("stick_tip"),function(){Engine.stickyTips.add(p)}])},this.canSplit=function(t){!h.isEquipItemLoc(this.loc)||!c.isInBagSt(this.st)||1!=this._cachedStats.cansplit||isset(this._cachedStats.amount)&&this._cachedStats.amount<=1||t.push([_t("split",null,"menu"),function(){Engine.heroEquipment.splitItem(p,p.x,p.y,!0)}])},this.destroy=function(t){h.isEquipItemLoc(this.loc)&&c.isInBagSt(this.st)&&!d.isQuestCl(this.cl)&&t.push([_t("destroy",null,"menu"),()=>{if(this.checkExpires())_g("moveitem&st=-2&id="+this.id);else{const t={msg:_t("destroy_confirm"),clb:()=>_g("moveitem&st=-2&id="+this.id)};confirmWithCallback(t)}},{button:{cls:"menu-item--red"}}])},this.drop=function(t){h.isEquipItemLoc(this.loc)&&c.isInBagSt(this.st)&&!d.isQuestCl(this.cl)&&!isset(this._cachedStats.permbound)&&!isset(this._cachedStats.soulbound)&&isPl()&&t.push([_t("drop",null,"menu"),function(){const t={msg:_t("drop_confirm"),clb:()=>_g("moveitem&st=-1&id="+p.id)};confirmWithCallback(t)}])};this.canEnhance=t=>{h.isEquipItemLoc(this.loc)&&Engine.hero.d.lvl>=20&&!Engine.disableItemsManager.checkRequires(p,{[Engine.itemsDisableData.ENHANCE]:!0})&&t.push([_t("upgrade",null,"menu"),()=>{Engine.crafting.opened?(Engine.crafting.enhancement&&Engine.crafting.enhancement.close(),Engine.crafting.open("enhancement"),Engine.crafting.enhancement.onClickInventoryItem(p)):(Engine.crafting.tempEnhanceItemId=parseInt(p.id),_g("enhancement&action=open&item="+p.id))}])},this.playStatMenu=function(t){if(isset(this._cachedStats.play)){var e=this._cachedStats.play.split(",");"object"==typeof soundManager.getSoundById("itemSound"+p.id)?t.push([_t("turn_off",null,"item"),function(){soundManager.destroySound("itemSound"+p.id)}]):t.push([isset(e[1])?e[1]:_t("use_it",null,"item"),function(){soundManager.destroySound("itemSound"+p.id);var t=soundManager.createSound({id:"itemSound"+p.id,url:e[0],autoPlay:!0,onfinish:function(){t.destruct()}})}])}},this.createPromoOptionMenu=function(t,e){var i=[];this.canShowOutfit(i),this.canShowOutfitSelector(i),this.canShowPet(i),this.playStatMenu(i),this.playStatMenu(i),this.canPreviewStatMenu(i);var n=0==i.length,a=!e||e&&0==lengthObject(e);if(!n||!a){if(e){Array.isArray(e)||(e=[e]);for(var s=0;s<e.length;s++)this.createUseItem(i,t,e[s])}Engine.interface.showPopupMenu(i,t)}},this.createOptionMenu=function(t,e,i){var n=[];i||(i={}),i.use||this.canShowUse(n),i.move||this.canMove(n),i.attachToQuickItems||this.canAttachToQuickItems(n,t),i.moveToEnhancement||this.canMoveToEnhancement(n),i.shop||this.shopMenus(n),i.outfit||this.canShowOutfit(n),i.outfit_selector||this.canShowOutfitSelector(n),i.enhance||this.canEnhance(n),i.pet||this.canShowPet(n),i.play||this.playStatMenu(n),i.canPreview||this.canPreviewStatMenu(n),i.chatLinkedItem||this.canChatLinkedItem(n),i.bonus_not_selected||this.canBonusSelect(n),i.itemId||this.showIdStatMenu(n),i.stickTip||this.stickTip(n),i.split||this.canSplit(n),i.drop||this.drop(n),i.destroy||this.destroy(n),CFG.debug&&(t=>{let e={button:{cls:"menu-item--debug"}},i=p.icon,n=CFG.r_ipath+i,a=cdnUrl+n;t.push(["Copy id",function(){copyClipboard(p.id)},e]),t.push(["Copy hid",function(){copyClipboard(p.hid)},e]),t.push(["Copy details hid",function(){copyClipboard("ITEM#"+p.hid+"."+getEngine().worldConfig.getWorldName())},e]),t.push(["Copy tpl",function(){copyClipboard(p.tpl)},e]),t.push(["icreate",function(){_g("console&custom=.icreate"+esc(" ")+(p.isItem()?p.tpl:p.id))},e]),t.push(["Copy short url",function(){copyClipboard(i)},e]),t.push(["Copy relative url",function(){copyClipboard(n)},e]),t.push(["Copy absolute url",function(){copyClipboard(a)},e]),t.push(["getData",function(){console.log(p)},e])})(n);var a=0==n.length,s=!e||e&&0==lengthObject(e);if(!a||!s){if(e){Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++)this.createUseItem(n,t,e[r])}Engine.interface.showPopupMenu(n,t)}},this.canMove=function(t){h.isEquipItemLoc(this.loc)&&specificElementsExist()&&(this.addMoveItemToMenu(t),Engine.trade&&h.isEquipItemLoc(this.loc)&&t.push([_t("show_blesses",null,"clan"),function(){Engine.trade.setShowItem(p)}]))},this.canAttachToQuickItems=(t,e)=>{h.isEquipItemLoc(this.loc)&&!specificElementsExist()&&!Engine.interfaceItems.isntRightItem(this)&&this.addAttachToQuickItemsToMenu(t,e)},this.canMoveToEnhancement=function(t){h.isEquipItemLoc(this.loc)&&!c.isInBagSt(this.st)&&Engine.crafting.enhancement&&this.addMoveItemToMenu(t)},this.addAttachToQuickItemsToMenu=(t,e)=>{t.push([_t("attach_to_quick_items"),()=>{Engine.interfaceItems.prepareMenuToPutItemInSlot(this,e)}])},this.addMoveItemToMenu=t=>{t.push([_t("move",null,"item"),function(){const t=Engine.items.getAllViewsByIdAndViewName(p.id,Engine.itemsViewData.BAG_VIEW)[0];Engine.heroEquipment.afterOneClick(p,t)}])},this.canShowUse=function(t){var e=p.isItem()&&h.isEquipItemLoc(this.loc)&&!d.isNeutralCl(this.cl)&&!d.isQuestCl(this.cl)&&!d.isUpgradeCl(this.cl),i=isset(this._cachedStats.play);e&&!i&&t.push([_t("use_it",null,"item"),function(){const t=Engine.items.getAllViewsByIdAndViewName(p.id,Engine.itemsViewData.BAG_VIEW)[0];Engine.heroEquipment.afterDoubleClick(p,t)}])},this.shopMenus=function(t){"n"==this.loc&&(t.push([_t("buy 5"),function(){Engine.shop.buySeriallyItem(5,p)},{button:{cls:"not-close"}}]),t.push([_t("buy 1"),function(){Engine.shop.buySeriallyItem(1,p)},{button:{cls:"not-close"}}]),t.push([_t("buy more"),function(){Engine.shop.alertWindow(p)}]))},this.createUseItem=function(t,e,i){lengthObject(i)>0&&t.unshift([i.txt,function(){i.f()}])},this.canPreviewStatMenu=function(t){isset(this._cachedStats.canpreview)&&t.push([_t("show",null,"item"),function(){const t=isset(p.tpl)?p.tpl:p.id;_g("moveitem&st=2&tpl="+t),Engine.tpls.deleteMessItemsByLoc("p"),Engine.tpls.deleteMessItemsByLoc("s")}])},this.canChatLinkedItem=t=>{this.isItem()&&(h.isEquipItemLoc(this.loc)||h.isAuctionItemLoc(this.loc)||h.isPrivateDepoItemLoc(this.loc)||h.isClanDepoItemLoc(this.loc)||h.isRecoveryItemLoc(this.loc)||h.isMailItemLoc(this.loc)||h.isOtherEqItemLoc(this.loc))&&t.push([_t("link-item"),function(){Engine.chatController.getChatInputWrapper().setLinkedItem(p.hid)}])},this.canBonusSelect=t=>{isset(this._cachedStats.bonus_not_selected)&&isOwnItem(this)&&t.push([_t("select_bonus",null,"item"),()=>{_g("moveitem&st=2&id="+p.id)}])},this.on=function(t,e){void 0===this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},this.unregisterCallback=function(t,e){if(void 0===this.events[t])return;const i=e.toString(),n=this.events[t].map(String).indexOf(i);n>=0&&this.events[t].splice(n,1)},this.trigger=function(t){for(var e=[],i=1;i<arguments.length;)e.push(arguments[i++]);if(!isset(this.events[t]))return;let n=[];for(i=0;i<this.events[t].length;i++)n.push(this.events[t][i]);for(i=0;i<n.length;i++)n[i].apply(this,e)},this.beforeDelete=function(){this.$.remove(),this.trigger("delete")},this.updateCl=function(){let t=c.isInBagSt(this.st);var e=d.isBlessCl(this.cl)&&t||!isset(this.st),i=d.isArrowsCl(this.cl)&&t||!isset(this.st);if(e||i||d.isEquipCl(this.cl)&&(t||!isset(this.st))){let t=Engine.heroEquipment.getEqItemsName(this.cl);null==t&&(t=this.cl),this.$.attr("data-cl",t)}},this.parseStats=function(t){for(var e=(t||this.stat).split(";"),i={},n=0;n<e.length;n++){var a=e[n].split("=");i[a[0]]=isset(a[1])?a[1]:null}return i},this.createHighlight=function(){this.addHighlightType()},this.addHighlightType=function(){const t=this.$.find(".highlight");if(this.checkQuestTracking(),isset(this._cachedStats.rarity)){const e=this._cachedStats.rarity,i=g[e];return this.itemType=i[0],this.itemTypeName=e,this.hlPos=i[1],this.itemTypeSort=i[2],t.addClass(i[0]),isset(this._cachedStats.bag)&&!c.isInBagSt(this.st)||t.addClass("h-exist"),t}for(let e in g){if(!isset(this._cachedStats[e])&&"common"!==e)continue;const i=g[e];return this.itemType=i[0],this.itemTypeName=e,this.hlPos=i[1],this.itemTypeSort=i[2],t.addClass(i[0]),isset(this._cachedStats.bag)&&!c.isInBagSt(this.st)||t.addClass("h-exist"),t}},this.checkQuestTracking=function(){},this.addScore=function(){this.score=parseInt(this.getItemMultiplier(p.itemType)*p._cachedStats.lvl)},this.getLvl=()=>p._cachedStats.lvl,this.getItemType=()=>this.itemType,this.haveStat=t=>p._cachedStats.hasOwnProperty(t),this.getAmount=()=>parseInt(p._cachedStats.amount),this.checkSoulbound=()=>isset(this._cachedStats.soulbound),this.checkPermbound=()=>isset(this._cachedStats.permbound),this.getCustomTeleport=()=>p._cachedStats.custom_teleport,this.checkExpires=()=>ts()/1e3>p._cachedStats.expires,this.getItemMultiplier=function(t){return{"t-norm":1,"t-uniupg":1.5,"t-her":2,"t-upgraded":2,"t-leg":3}[t]},this.isItemType=t=>isset(g[t]),this.getTipContent=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const e=w();return MargoTipsParser.getTip(u,t)+e},this.getTipData=()=>[this.getTipContent(),"t_item",this.itemType],this.setTip=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.$,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.getTipContent(),i=arguments.length>2?arguments[2]:void 0;t.tip(e,"t_item",u.itemType,i)},this.debugRefreshTip=()=>{this.setTip()};const w=()=>CFG.debug?`<span class="debug-content">\n\t\t\tid: ${this.id},\n\t\t\t${this.isItem()?`tpl id: ${this.tpl}, `:""}\n\t\t\tloc: ${this.loc}, \n\t\t\tcl: ${this.cl}, \n\t\t\tstats: ${this.stat.replace(/opis=[^;]*/,"opis=X")}<br><br>\n\t\t</span>`:"",C=t=>{v=t};this.getView=()=>{let t,e=[];t=this.isItem()?getEngine().items.getViewById(this.id):getEngine().tpls.getViewById(this.tpl);for(let i in t){let n=t[i];for(let t=0;t<n.length;t++)e.push(n[t])}return e},this.getName=()=>this.name,this.getId=()=>this.id,this.getLoc=()=>this.loc,this.getX=()=>this.x,this.setShouldDrawIcon=C}},function(t,e){t.exports={TYPE:{MUSIC:"MUSIC",NOTIFICATION:"NOTIFICATION",BATTLE_EFFECT:"BATTLE_EFFECT",SRAJ:"SRAJ",TMP:"TMP"},QUALITY:{HQ:"hq",LQ:"lq"}}},function(t,e){t.exports={action:{FADE_IN:"FADE_IN",FADE_OUT:"FADE_OUT"}}},function(t,e){t.exports={KIND:{ON_RESPAWN:"ON_RESPAWN",ON_DIE:"ON_DIE",AFTER_DIE:"AFTER_DIE"},DEFAULT_DATA:{V_ORDER:0,REPEAT:1,ACTUAL_REPEAT:0,CHARACTER_HIDE:!0,BEHIND:!1,ORDER_DATA_KIND:"FLOAT_OBJECT",ORDER_DATA_V:0},ORDER_DATA_KIND:{FLOAT_OBJECT:"FLOAT_OBJECT",MAP_OBJECT:"MAP_OBJECT"}}},function(t,e,i){var n=i(13);let a={BITS:{[n.NAME.INKEEPER]:0,[n.NAME.AUCTION]:1,[n.NAME.MAIL]:2,[n.NAME.DEPO]:3,[n.NAME.DEPO_CLAN]:4,[n.NAME.SHOP]:5,[n.NAME.HEAL]:8},PRIORITY_EMO_MAP:null};a.PRIORITY_EMO_MAP={[n.NAME.MAIL]:10,[n.NAME.INKEEPER]:20,[n.NAME.DEPO_CLAN]:30,[n.NAME.AUCTION]:40,[n.NAME.DEPO]:50,[n.NAME.SHOP]:60,[n.NAME.HEAL]:70,[n.NAME.DAILY_QUEST]:80,[n.NAME.NORMAL_QUEST]:90,[n.NAME.NPC_TALK]:100,[n.NAME.AGGRESSIVE]:101,[n.NAME.ELITE_HERE]:102},a.GATE_URL={"mas/exit-h64c.gif":!0,"mas/exit.gif":!0,"obj/cos.gif":!0},t.exports=a},function(t,e,i){var n=i(5),a=i(20);t.exports=new function(){let t=a.HAND_HELD_DATA;this.getSizeWindow=()=>n.easyGet(t.mainKey,t.BIG),this.getStateOfKindByName=e=>n.easyGet(t.mainKey,e,t.STATE),this.getDataDrawerNickOfKindByName=e=>n.easyGet(t.mainKey,e,t.DATA_DRAWER_NICK_STATE),this.getDataDrawerProfAndLevelOfKindByName=e=>n.easyGet(t.mainKey,e,t.DATA_DRAWER_LVL_AND_PROF_STATE),this.getDataDrawerFontSizeOfKindByName=e=>n.easyGet(t.mainKey,e,t.DATA_DRAWER_FONT_SIZE),this.getColorOfKindByName=e=>n.easyGet(t.mainKey,e,t.COLOR),this.getWhoIsHereOfKindByName=e=>n.easyGet(t.mainKey,e,t.WHO_IS_HERE),this.getMapBlurOfKindByName=e=>n.easyGet(t.mainKey,e,t.MAP_BLUR),this.getIconOfKindByName=e=>n.easyGet(t.mainKey,e,t.ICON),this.getMinLevelOfKindByName=()=>n.easyGet(t.mainKey,t.MIN_LEVEL,t.AMOUNT),this.getWidthDataDrawerOfKindByName=()=>n.easyGet(t.mainKey,t.DATA_DRAWER_WIDTH,t.AMOUNT),this.getFontSizeDataDrawerOfKindByName=()=>n.easyGet(t.mainKey,t.DATA_DRAWER_FONT_SIZE,t.AMOUNT),this.setStateOfKindByName=(e,i)=>{n.easySet(i,t.mainKey,e,t.STATE)},this.setDataDrawerNickOfKindByName=(e,i)=>{n.easySet(i,t.mainKey,e,t.DATA_DRAWER_NICK_STATE)},this.setDataDrawerProfAndLevelOfKindByName=(e,i)=>{n.easySet(i,t.mainKey,e,t.DATA_DRAWER_LVL_AND_PROF_STATE)},this.setColorOfKindByName=(e,i)=>{n.easySet(i,t.mainKey,e,t.COLOR)},this.setWhoIsHereOfKindByName=(e,i)=>n.easySet(i,t.mainKey,e,t.WHO_IS_HERE),this.setMapBlurOfKindByName=(e,i)=>n.easySet(i,t.mainKey,e,t.MAP_BLUR),this.setIconOfKindByName=(e,i)=>{n.easySet(i,t.mainKey,e,t.ICON)},this.setWidthDataDrawerOfKindByName=e=>{n.easySet(e,t.mainKey,t.DATA_DRAWER_WIDTH,t.AMOUNT)},this.setFontSizeDataDrawerOfKindByName=e=>{n.easySet(e,t.mainKey,t.DATA_DRAWER_FONT_SIZE,t.AMOUNT)},this.setMinLevelOfKindByName=e=>{n.easySet(e,t.mainKey,t.MIN_LEVEL,t.AMOUNT)},this.setSizeWindow=e=>{n.easySet(e,t.mainKey,t.BIG)}}},function(t,e){t.exports={action:{CREATE:"CREATE",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST",REMOVE:"REMOVE",REMOVE_IF_EXIST:"REMOVE_IF_EXIST"},behavior:{IDLE:"IDLE",IDLE_GIF_ANIMATION:"IDLE_GIF_ANIMATION",MOVE_FROM_VECTORS:"MOVE_FROM_VECTORS",MOVE_TO_CORDS:"MOVE_TO_CORDS",MOVE_TO_START_CORDS:"MOVE_TO_START_CORDS",TP_TO_CORDS:"TP_TO_CORDS",FOLLOW:"FOLLOW",TP_START_CORDS:"TP_START_CORDS",TP_ON_OTHER_SIDE:"TP_ON_OTHER_SIDE",FADE_IN:"FADE_IN",FADE_OUT:"FADE_OUT",ROTATION:"ROTATION",CHANGE_IMG:"CHANGE_IMG"},defaultData:{BEHAVIOR_REPEAT:1,BEHAVIOR_DURATION:5,SPEED:2,X_VECTOR:-.6,Y_VECTOR:1.4,ROTATION_SPEED:.5},kind:{SPRITE:"SPRITE",GIF:"GIF",FAKE_NPC:"FAKE_NPC",IDLE_FAKE_NPC_FRAME:"IDLE_FAKE_NPC_FRAME"}}},,function(t,e){var i=function(){this.openSet=[],this.closeSet=[],this.currentNode=null};i.prototype.finalize=function(){for(this.prepare();this.isOpenSetNoEmpty();)this.currentNode=this.getFirstNode(),this.checkNode()},i.prototype.prepare=function(){},i.prototype.isOpenSetNoEmpty=function(){return this.openSet.length>0},i.prototype.getFirstNode=function(){return this.openSet.shift()},i.prototype.checkNode=function(){this.checkNeighbors(),this.addToCloseSet()},i.prototype.checkNeighbors=function(){},i.prototype.addToCloseSet=function(){this.closeSet.push(this.currentNode)},t.exports=i},function(t,e,i){var n=i(97);t.exports=function(){const t={fileName:""};let e,i;this.init=()=>{e=new n,e.init(),i=new n,i.init()},this.removeAllDynamicLights=()=>{let t=e.getArrayOfDynamicLightIds();for(let e of t)Engine.dynamicLightsManager.rajRemoveActionBeyondManager(e)},this.removeDynamicLightId=t=>{e.removeDynamicLightId(t)},this.addDynamicLightId=i=>{e.checkDynamicLightId(i)?errorReport(t.fileName,"addDynamicLightId",`Id ${i} already exist!`):e.addDynamicLightId(i)},this.removeAllDynamicDirCharacterLights=()=>{let t=i.getArrayOfDynamicLightIds();for(let e of t)Engine.dynamicDirCharacterLightsManager.rajRemoveActionBeyondManager(e)},this.removeDynamicDirCharacterLightId=t=>{i.removeDynamicLightId(t)},this.addDynamicDirCharacterLightId=e=>{i.checkDynamicLightId(e)?errorReport(t,"addDynamicDirCharacterLightId",`Id ${e} already exist!`):i.addDynamicLightId(e)}}},function(t,e){t.exports=function(){const t="px Arial regular",e=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return t/4-t+t*(1-e)-i},i=(t,e,i,n,a,s,r)=>{let o=n+2*s,l=a+2*r,c=e-o/2,d=i-r;t.globalAlpha=.4,t.fillStyle="rgb(86, 86, 86)",t.fillRect(c,d,o,l),t.globalAlpha=.23,t.lineWidth=1,t.strokeStyle="rgb(255, 255, 255)",t.strokeRect(c,d,o,l)},n=(e,i,n,a,s,r)=>{e.textAlign="center",e.globalAlpha=1,e.fillStyle=a,e.font=i+t,e.shadowColor="black",e.shadowBlur=0,e.lineWidth=2,e.shadowOffsetX=1,e.shadowOffsetY=1,e.strokeStyle="black",e.strokeText(n,s,r),e.shadowBlur=0,e.fillText(n,s,r)},a=(t,e,i)=>{let n=e.split(" "),a=0,s={rows:[],maxWidth:0},r=s.rows,o=t.measureText(" ").width;r.push({str:"",width:0});for(let e=0;e<n.length;e++){let l=n[e],c=t.measureText(l).width,d=r[a].width+c,h=r[a].str;if(""!=h&&(d+=o),d<i){let t=l;""!=h&&(t=" "+t),r[a].str+=t,r[a].width=d}else a++,r.push({str:n[e],width:c-o});s.maxWidth<r[a].width&&(s.maxWidth=r[a].width)}return s};this.draw=function(s,r,o,l,c,d){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:200,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:10,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:5;s.textAlign="center",s.font=c+t;let g=a(s,r,h),f=g.rows,m=f.length,v=g.maxWidth,E=c*m,_=10,b=e(c,m,_);i(s,o,l+b,v,E,u,p);for(let t=0;t<m;t++)b=c*(-m+t+1)-_,n(s,c,f[t].str,d,o,l+b)},this.getTopTrans=e}},function(t,e){t.exports=function(){let t=0,e=0,i=0,n=null,a=!1,s=null,r=null,o=!0;function l(t,e){return t>>4*e&15}function c(t){e++,e==i?function(t){if(r)return r.waitTime=0,void e--;null==n?t.stopAction():a=!0}(t):t.setActionFrame(0)}this.createActionsDataArrayForOther=function(t){return[{name:null,actionIndex:l(t,1),actionBin:t,actionBinWithDir:t,special:l(t,2)}]},this.createActionsDataArrayForHero=function(t,e){let i=[];for(let n in t){let a=t[n].split("#"),s=isset(a[1])?parseInt(a[1]):3,r=parseInt(n)+1,o={name:a[0],actionIndex:r,actionBin:r<<4|(isset(s)&&s?s<<8:0),actionBinWithDir:e+(r<<4|(isset(s)&&s?s<<8:0)),special:s};i.push(o)}return i},this.doAction=function(l){let c=l.getRunActionIndex(),d=l.getSpecialByRunActionIndex();if(t=0,e=0,i=0,n=null,a=!1,s=100,r=null,o=!0,0==d&&(i=1,n=3),d>=1&&d<=9&&(i=d),d>=13&&d<=15){switch(d){case 13:s=150;break;case 14:s=200;break;case 15:s=300}i=3}if(d>=10&&d<=12){switch(r={timeOfWaitToInvert:null,waitTime:null},n=0,d){case 10:r.timeOfWaitToInvert=0;break;case 11:r.timeOfWaitToInvert=5e3;break;case 12:r.timeOfWaitToInvert=2e4}i=1}l.setActionFrame(0),l.setFrame(4+(l.getAnim()?1:0)+c-1)},this.updateAction=function(e,i){if(a)return;if(r&&null!=r.waitTime){if(r.waitTime+=1e3*i,r.waitTime<r.timeOfWaitToInvert)return;r=null,o=!1}t+=1e3*i;let n=e.getActionFrame();t<s||(t=0,o&&(n++,n>3)||!o&&(n--,n<0)?c(e):e.setActionFrame(n))},this.getHalfByte=l,this.checkActionsAmount=function(t){var e=new RegExp("-([0-9]+)(a?).gif").exec(t);return e?parseInt(e[1]):0}}},function(t,e,i){var n=i(5),a=i(48),s=(i(35),i(190));t.exports={WantedController:function(){var t=this,e=null,i=[],r=0,o=null;this.init=function(){this.getSettings(),this.initWantedList()},this.initWantedList=function(){(o=new s).init()},this.toggleWatch=function(t){return t=parseInt(t),i.indexOf(t)<0?(this.addToWatch(t),1):(this.removeFromWatch(t),0)},this.addToWatch=function(t){var n=!1;if(i.indexOf(t)<0&&i.length>=10){for(var a=0;a<i.length;a++)if(!isset(e[i[a]])){i.splice(a,1,t),n=!0;break}}else i.indexOf(t)<0&&(i.push(parseInt(t)),n=!0);n?(this.saveSettings(),this.updateHuntedList()):message(this.tLang("observed_limi_reached"))},this.addAllToWatch=()=>{if(null!=e){var i=Object.keys(e),n=t.getWachList();for(let e=0;e<i.length;e++)n.indexOf(parseInt(i[e]))<0&&t.addToWatch(i[e])}},this.removeFromWatch=function(t){i.indexOf(t)>=0&&i.splice(i.indexOf(t),1),this.saveSettings(),this.updateHuntedList()},this.getList=function(){return e},this.lvl=function(t){a.sendMessage("/lvl "+t)},this.updateHuntedList=function(){if(o.wnd.$.find(".scroll-pane").find(".one-wanted").remove(),e.length<=0)o.setVisibleEmptyRecord();else{for(var t in e)o.update(t,e[t]);o.setVisibleEmptyRecord(),o.setSize()}},this.getWantedList=function(){return o},this.updateList=function(t){if(!(lengthObject(t)<1)){for(var i in this.getSettings(),e={},t)e[i]=t[i];this.updateHuntedList()}},this.parse=function(t){if(""!=t){var i=t.split(";"),n=null;e={};for(var a=0;a<i.length;a++)n=i[a].split(","),e[n[0]]=n}else e=null;!0},this.getSettings=function(){var t=n.get("pkWatch");t&&(t=t.split("|"),r=parseInt(t[1]))},this.saveSettings=function(){n.set("pkWatch","0|"+r)},this.getWachList=function(){return i},this.tLang=function(t){return _t(t,null,"pklist")}}}},function(t,e){t.exports={ACTION:{CREATE:"CREATE",SHOW:"SHOW",HIDE:"HIDE"},NAME:{LOW_HEALTH:"LOW_HEALTH"}}},function(t,e,i){let n=i(5);t.exports=function(){let t="WindowManageSize",e=null,i=null,a=null,s=null,r=null,o=null;const l=()=>{let t=h();w(t)},c=()=>{w(s+1),s>e.length-1&&w(0),d(),E(),_(),b()},d=()=>{n.easySet(s,"WINDOW_OPT_SIZE",r)},h=()=>{let i=n.easyGet("WINDOW_OPT_SIZE",r);return null===i?1:isInt(i)&&-1<i&&i<e.length?i:(errorReport(t,"getWindowSizeOptFromStorage","incorrect sizeOptData",i),1)},u=t=>{e=t},p=t=>{r=t},g=t=>{o=t},f=t=>{i=t},m=t=>{a=t},v=t=>{let e=$("<div>").addClass("toggle-size-button");e.on("click",c),t.append(e)},E=()=>{let t=e[s],i={};t.w&&(i.width=t.w),t.h&&(i.height=t.h),a.css(i)},_=()=>{i&&i.checkPassTheScreenBounds()&&(i.setWindowOnLeftTopCorner(),0!=s&&i.checkPassTheScreenBounds()&&(w(0),E(),b()))},b=()=>{o&&o()},w=t=>{s=t};this.init=(t,e,i,n,a,s)=>{p(e),u(a),m(n),s&&g(s),t&&f(t),v(i),l(),E(),_()}}},function(t,e,i){let n=i(14);var a=i(52),s={sw:["weapon"],"1h":[1],"2h":[2],bs:[3],dis:[4],fire:["fire"],light:["light"],frost:["frost"],sh:[14],orb:[2],h:[5],poison:["poison"],phydis:["phydis"],wound:["wound"]};function r(t){return t>4?_t("five_round"):t>1?_t("two_round"):_t("one_round")}function o(t,e,i){var a,o,l="",c=""==e?i:e,d=""==e?"first":""==i?"normal":"compare",h="default",u=function(t,e,i,n){if(!isset(t)||!isset(e))return[t,e,""];var a=t.search("@"),s=e.search("@");if(!(a>-1||s>-1))return[t,e,""];var o="en-regen"!=n?_t("on"):_t("by");if(""==i){var l=e.slice(0,s);return[d=t.slice(0,a),l,o+(c=e.slice(s+1,e.length))+r(c)]}if(a>-1&&s>-1){var c=t.slice(a+1,t.length),d=t.slice(0,a),h=o+c,u=e.slice(s+1,e.length);return[d,e.slice(0,s),h=h+"<span>("+u+")</span> "+r(c)]}return a>-1&&s<0?[t.slice(0,a),e,o+(c=t.slice(a+1,t.length))+r(c)]:void 0}(c,i,e,t),p=u[2],g=function(t,e){const i=t.search("/*cplvl")>-1;var n=t.search("/*c?plvl"),a=i?_t("value_increase_per_player_max"):_t("value_increase_per_player"),s=t.replace(/\*c?plvl/,"");if(!isset(e))return n>-1?[s,e,a]:[t,e,""];var r=e.search("/*c?plvl");return n>-1||r>-1?[s,e.replace(/\*c?plvl/,""),a]:[t,e,""]}(c=u[0],i=u[1]),f=g[2];switch(c=g[0],i=g[1],""!=e&&isset(i)&&""!=i&&(h="new_skills"),t){case"step":case"norm-atack":l+="<span class="+d+">"+_t("skill_"+t);break;case"acshield_per":case"perdmg":case"ac_per":case"pdmg":case"ac":l+="<span class="+d+">"+_t("item_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"redacdmg_per":l+="<span class="+d+">"+_t("skill_"+t+" %val%",{"%val%":Math.abs(c),"%val2%":Math.abs(i)},h);break;case"decevade_per":case"active_decevade_per":l+="<span class="+d+">"+_t("skills_"+t+" %val%",{"%val%":c,"%val2%":i,"%val3%":c<2?_t("percentPoints1"):c>4?_t("percentPoints3"):_t("percentPoints2")},h);break;case"decevade":var m=c>4?"":"2";l+="<span class="+d+">"+_t("skills_"+m+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"agi":case"firebon":case"lightbon":case"frostbon":l+="<span class="+d+">"+_t("skills_"+t+" %val%",{"%val%":mp(Math.floor(100*parseFloat(c))),"%val2%":mp(Math.floor(100*parseFloat(i)))},h);break;case"critslow_per":case"critslow":case"critsa_per":case"critsa":case"immobilize":case"lastcrit":case"redslow":case"woundred":case"healpower":case"engback":case"sa-clothes":case"red-sa":case"footshoot":case"critwound":case"swing":case"distract":case"injure":case"reusearrows":case"pcontra":case"fastarrow":case"bandage_per":case"bandage":case"set":case"resfrost_per":case"resfire_per":case"longfireshield":case"longfrostshield":case"longlightshield":case"soullink":case"poisonbon":case"of-thirdatt":case"woundchance":case"wounddmgbon_perw":case"wounddmgbon":case"arrowrain":case"insult":case"frostpunch":case"redstun":case"active_redstun":case"lightmindmg":case"actdmg":case"hpsa":case"mresdmg":l+="<span class="+d+">"+_t("skills_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"disturbshoot":l+="<span class="+d+">"+_t("skill_"+t+" %val%",{"%val%":c,"%val2%":6==c?12:15==c?30:i,"%val3%":2*c,"%val4%":2*i},h);break;case"str":case"stepslow_per":case"poisonbon_poison-perw":case"arrowrain_all-perw":case"manarestore_per":case"rime_per":case"firepunch_fire-perw":case"heal1_per":case"pdmg_physical-perw":case"energyrestore_per":case"allcritval":case"vamp":case"reddest_per":case"poisonstab_perw":case"woundextend":case"energyout":case"adrenalin_per":case"adrenalin_sa_per":case"adrenalin_sa_threshold_per":case"adrenalin_evade_per":case"adrenalin_evade_threshold_per":case"critpoison_per":case"slowfreeze_per":case"absorb_per":case"absorbm_per":case"heal_per":case"distractshoot":case"blind_per":case"alllowdmg":case"aura-adddmg2_per-meele":case"firedmg_fire-perw":case"chainlightning_perw":case"absagain_per":case"stealmana_per":case"allcritmval":case"reslight_per":case"mcurse":case"weakness_per":case"antidote":case"lowtension":case"vulture_perw":case"of-wounddmgbon_perw":case"act":case"rage_3turns":case"critrage_perw":case"resfire":case"reslight":case"resfrost":case"adddmg_physical-perw":case"active_acdmg_physical-perw":case"adddmg_fire-perw":case"active_acdmg_per":case"active_absorbdest_per":case"active_block_per":case"decblock_per":case"active_decblock_per":case"active_decblock_per-enemies":case"ac2_per":l+="<span class="+d+">"+_t("skill_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"trickyknife":case"blackout":break;case"str1h":case"str2h":case"of-str":l+="<span class="+d+">"+_t("skill_"+t+" %val%",{"%val%":mp(Math.floor(100*parseFloat(c))),"%val2%":mp(Math.floor(100*parseFloat(i)))},h);break;case"runes":case"goldpack":case"perheal":case"crit":case"active_crit":case"of-crit":case"critval":case"of-critval":case"critmval":case"critmval_f":case"critmval_c":case"critmval_l":case"heal":case"pierce":case"pierceb":case"contra":case"parry":case"fire":case"light":case"adest":case"absorb":case"absorbm":case"hpbon":case"acdmg_per":case"acdmg_physical-perw":case"resdmg":case"en-regen":case"manastr":case"manarestore":case"manatransfer":case"stun":case"freeze":case"hpcost":case"cover":case"allslow":case"allslow_per":case"dmg_evade-target_fire-perw":case"dmg-target_fire-perw":case"firewall_perw":case"thunder":case"storm":case"lowdmg":case"lowdmg_self":case"lowdmg_enemy":case"blizzard":case"sunshield_per":case"sunreduction":case"healall_per":case"healall":case"heal1":case"absorbd":case"abdest":case"endest":case"manadest":case"lowevade":case"lowcrit":case"arrowblock":case"redabdest_per":l+="<span class="+d+">"+_t("bonus_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"evade_per":l+="<span class="+d+">"+_t("bonus_"+t+" %val%",{"%val%":c,"%val2%":i,"%val3%":c<2?_t("percentPoints1"):c>4?_t("percentPoints3"):_t("percentPoints2")},h);break;case"hp":case"sa_per":case"sa2_per":case"ds":case"dz":case"di":case"da":case"gold":case"blok_per":case"blok":case"evade":case"energybon":case"energygain":case"manabon":case"managain":case"aura-resall":l+="<span class="+d+">"+_t("bonus_"+t+" %val%",{"%val%":mp(c),"%val2%":mp(i)},h);break;case"dmg_evade_hpp-target":case"dmg_evade_hpp-target_light":case"lightshield2_per":case"lightshield_per":case"lightshield":l+="<span class="+d+">"+_t("skills_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"rage":l+="<span class="+d+">"+_t("skills_rage %val% %turn%",{"%val%":c,"%turn%":parseInt(c)>1?parseInt(c)>4?_t("five_round"):_t("two_round"):" "+_t("turn"),"%val2%":i},h);break;case"doubleshoot":l+="<span class="+d+">"+_t("skill_doubleshoot");break;case"disturb":l+="<span class="+d+">"+_t("skills_disturb %val%",{"%val%":c,"%val2%":2*parseInt(c),"%val3%":i,"%val4%":2*parseInt(i)},h);break;case"shout":l+="<span class="+d+">"+_t("skills_shout %val%",{"%val%":c,"%val2%":i},h)+" "+(c>1?_t("moreenemy"):_t("oneenemy"));break;case"sa1":l+="<span class="+d+">"+_t("bonus_sa1 %val%",{"%val%":c/100,"%val2%":i/100},h);break;case"leczy":l+=c>0?"<span class="+d+">"+_t("bonus_leczy %val%",{"%val%":c,"%val2%":i},h):"<span class="+d+">"+_t("bonus_truje %val%",{"%val%":c,"%val2%":i},h);break;case"fullheal":l+="<span class="+d+">"+_t("bonus_fullheal %val%",{"%val%":round(c,2),"%val2%":round(i,2)},h);break;case"creditsbon":l+="<span class="+d+">"+_t("bonus_creditsbon");break;case"revive":l+="<span class="+d+">"+_t("revive %amount%",{"%amount%":c,"%val2%":i},h);break;case"frost":a=c.split(","),l+="<span class="+d+">"+_t("bonus_frost %val% %slow%",{"%val%":a[1],"%slow%":a[0]/100},h);break;case"poison":a=c.split(","),l+="<span class="+d+">"+_t("bonus_poison %val% %slow%",{"%val%":a[1],"%slow%":a[0]/100},h);break;case"slow":l+="<span class="+d+">"+_t("bonus_slow %val%",{"%val%":c/100,"%val2%":i/100},h);break;case"wound":a=c.split(","),l+="<span class="+d+">"+_t("bonus_wound %val% %dmg%",{"%val%":a[0],"%dmg%":a[1]},h);break;case"energy":l+=c>0?"<span class="+d+">"+_t("bonus_energy1 %val%",{"%val%":c,"%val2%":i},h):"<span class="+d+">"+_t("bonus_energy2 %val%",{"%val%":Math.abs(c),"%val2%":Math.abs(i)},h);break;case"energyp":l+=c>0?"<span class="+d+">"+_t("bonus_energyp1 %val%",{"%val%":mp(c),"%val2%":mp(i)},h):"<span class="+d+">"+_t("bonus_energyp2 %val%",{"%val%":Math.abs(c),"%val2%":Math.abs(i)},h);break;case"mana":l+=c>0?"<span class="+d+">"+_t("bonus_mana1 %val%",{"%val%":c,"%val2%":i},h):"<span class="+d+">"+_t("bonus_mana2 %val%",{"%val%":Math.abs(c),"%val2%":Math.abs(i)},h);break;case"firearrow":case"firepunch":case"firebolt":l+="<span class="+d+">"+_t("bonus_firebolt %val%",{"%val%":c,"%val2%":i},h);break;case"sunshield":l+="<span class="+d+">"+_t("bonus_sunshield %val%",{"%val%":c,"%val2%":c/2},h);break;case"aura-ac_per":case"aura-ac":l+="<span class="+d+">"+_t("bonus_aura-ac %val%",{"%val%":mp(c),"%val2%":mp(i)},h);break;case"aura-sa_per":l+="<span class="+d+">"+_t("bonus_aura-sa_per %val%",{"%val%":mp(c),"%val2%":mp(i)},h);break;case"aura-sa":l+="<span class="+d+">"+_t("bonus_aura-sa %val%",{"%val%":mp(c/100),"%val2%":mp(i/100)},h);break;case"removedot":case"removedot-allies":case"removestun":l+="<span class="+d+">"+_t("skill_"+t,null,h);break;case"stinkbomb":l+="<span class="+d+">"+_t("bonus_stinkbomb %val% %crit%",{"%val%":2*parseInt(c),"%crit%":c,"%val2%":2*parseInt(i),"%crit2%":i},h);break;case"reqp":for(o=0;o<c.length;o++)l+='<div class="cl-icon icon-'+c.charAt(o)+'"></div>';break;case"reqw":a=c.split(",");var v=0;for(o=0;o<a.length;o++)for(var E=0;E<s[a[o]].length;E++)v=s[a[o]][E],Engine.hero.d.prof==n.MAGE&&(1==s[a[o]][E]?v=6:2==s[a[o]][E]&&(v=7)),l+='<div data-icon="icon-'+v+'" class="cl-icon icon-'+v+'"></div>';break;case"add_attacks":m=c>1?"add_moreAttacks %val%":"add_attacks %val%";l+="<span class="+d+">"+_t(m,{"%val%":c,"%val2%":i},h);break;case"dmg_to_npc_per":case"dmg_from_npc_per":case"dmg_to_player_per":case"dmg_from_player_per":case"chest_armor_per":case"critval-enemies":case"critval-allies":case"critmval-enemies":case"critmval-allies":case"crush_threshold_per":case"crush_dmg_per":case"vamp_time_per":case"dmg-swing_physical-perw":case"taken_dmg_per":case"critpierce_per":case"dmg-row_fire-perw":case"dmg-force-4_light-perw":case"hp_per-allies":case"hp_per-enemies":case"heal_per-allies":l+="<span class="+d+">"+_t("end-game-percent"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"heal_per-enemies":l+="<span class="+d+">"+_t("end-game-percent"+t+" %val%",{"%val%":Math.abs(c),"%val2%":Math.abs(i)},h);break;case"acdmg":case"active_acdmg":case"dmg-line_physical":case"immunity_to_dmg":case"dmg-target_physical":case"distortion":l+="<span class="+d+">"+_t("end-game-without-percent"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"manaendest":l+="<span class="+d+">"+_t("end-game-more-val"+t+" %val% %val2% %val3% %val4%",{"%val%":c,"%val2%":i,"%val3%":Math.round(c/3),"%val4%":Math.round(i/3)},h);break;case"rotatingblade":case"daggerthrow":case"chainlightning":case"firewall":case"balloflight":break;case"doublecastcost_per":case"combo-crit":case"combo-block":case"combo-evade":case"combo-wound":case"combo-pierce":case"combo-skill":case"combo-max":case"combo_perdmg":case"combo_resfire_per":case"combo_resfrost_per":case"combo_reslight_per":case"combo_dmg_hpp-target":case"dmg_hpp-target":case"combo_dmg_hpp-target_fire":case"dmg_hpp-target_fire":case"combo_dmg_hpp-target_frost":case"dmg_hpp-target_frost":case"combo_dmg_hpp-target_light":case"dmg_hpp-target_light":case"combo_heal_per":case"combo_energyrestore_per":case"combo_manarestore_per":case"combo_lowdmg_enemy":case"dmg_hpp-row_fire":case"dmg_hpp-row_frost":case"dmg_hpp-row_light":case"lowheal_per-enemies":case"achpp_per":case"adrenalin_reddest_threshold_per":case"adrenalin_reddest_per_sum":case"poisonspread":case"taken_dmg_per-row":case"taken_dmg_per-all":case"perdmg-allies":case"active_crit-allies":case"disturb_crit":case"disturb_pierce":case"stinkbomb_crit":case"stinkbomb_pierce":l+="<span class="+d+">"+_t("skill_"+t+" %val%",{"%val%":c,"%val2%":i},h);break;case"removeslow-allies":case"removestun-allies":case"of-woundstart":case"poison_lowdmg_per-enemies":l+="<span class="+d+">"+_t("skill_"+t,{"%val%":c,"%val2%":i},h);break;case"cooldown":l+="<span class="+d+">"+_t("skill_"+t,{"%val%":c,"%val2%":i},h),l+=1==c?_t("turn"):c>4?_t("turn5"):_t("turns");break;case"reqarrows":m=c>4?"5arrow":c>1?"2arrow":"arrow";l+=c+" "+_t(m);break;default:""!=t&&(l+="<span class="+d+">"+_t("unknown_stat %val%",{"%val%":t},h))}return l+f+p}var l=["reqp","reqw","lvl","reqarrows"];function c(t){for(var e in l)for(var i in t){var n=t[i].indexOf(l[e]);-1!==n&&t.splice(n,1)}return t}t.exports={getSections:function(t,e){let i,n,s={attr:{0:[],1:[],2:[]},cost:[],regs:[],lvl:null};s.lvl=e.lvl,e.regs?n=this.getRegs(e.regs):""==e.kind?n=[]:(i=e.kind.split("|")[0],n=this.getRegs(i));for(let t in n){let e=n[t],i=Engine.battle.changeIconRegToTextReg(e);s.regs.push(i)}let r=a.getStats(e),o=this.getStats(r,10);for(let t in o){let e=0,i=o[t];switch((i.search("(passive effect)")>-1||i.search("(efekt pasywny)")>-1)&&(e=1),(i.search("combination points")>-1||i.search("pkt kombinacji")>-1)&&(e=2),(i.search(" cost: ")>-1||i.search("Koszt ")>-1)&&(e="cost"),e){case 0:case 1:case 2:s.attr[e].push(i);break;case"cost":s[e].push(i)}}return s},getStats:function(t,e){var i=t.split("&");if(""==i[0]&&""==i[1])return[];var n,a,s,r=i[0].split(";"),l=i[1].split(";"),d=[];r=c(r);for(var h=(l=c(l)).length>r.length?l.length:r.length,u=0;u<h;u++){n=isset(r[u])?r[u].split("="):["",""],a=isset(l[u])?l[u].split("="):["",""],n[0]=""==n[0]?a[0]:n[0],isset(n[1])||(n[1]=""),n[1]==a[1]&&10==e&&(a[1]=""),0==e&&(n[1]="");var p=o(n[0],n[1],a[1]);p&&(s='<div class="skill-stat">'+p+"</div>",d.push(s))}return d},prepareFormattedHtmlStatsArrayFromSections:t=>{let e=[];for(let e in t){let i=t[e];i.length?i.push('<div class="line"></div>div>'):delete t[e]}for(let i in t){let n=t[i];for(let t in n)e.push(n[t])}return e},getStatsForTips:function(t,e){for(var i,n,a=t.split("+"),s=[],r=(a=c(a)).length,l=0;l<r;l++){i=isset(a[l])?a[l].split(":"):["",""],isset(i[1])||(i[1]=""),0==e&&(i[1]="");var d=o(i[0],i[1],i[1]);d&&(n='<span class="tip-skill-stat">- '+d+"</span>",s.push(n))}return s},getRegs:function(t){const e=t.split(";"),i=[];for(const t of e){const[e,n]=t.split("=");if("reqp"===e||"lvl"===e)continue;(n.includes(",")?n.split(","):[n]).forEach(t=>{const n=o(e,t);i.push(n)})}return i},getObjStats:function(t){var e=t.split(";"),i={};for(var n in e){var a=e[n].split("="),s=a[0],r=!(a.length>1)||a[1].replace(/\*c?plvl/,"");i[s]=r}return i}}},function(t,e){t.exports={CURSOR:{DO_ACTION:"do-action-cursor",PICK_UP:"pick-up-cursor",DIALOGUE:"dialogue-cursor",ATTACK:"attack-cursor"}}},function(t,e){let i={_DEFAULT:"_DEFAULT",_920_X_555:"_920_X_555",_1173_X_555:"_1173_X_555",_1024_X_768:"_1024_X_768",_1277_X_768:"_1277_X_768",_1200_X_675:"_1200_X_675",_1253_X_675:"_1253_X_675",_1366_X_768:"_1366_X_768",_1619_X_768:"_1619_X_768",_1600_X_900:"_1600_X_900",_1853_X_900:"_1853_X_900",_1920_X_1080:"_1920_X_1080"};t.exports={KEY:i,RES:{[i._DEFAULT]:"default",[i._920_X_555]:"920x555",[i._1173_X_555]:"1173x555",[i._1024_X_768]:"1024x768",[i._1277_X_768]:"1277x768",[i._1200_X_675]:"1200x675",[i._1253_X_675]:"1253x675",[i._1366_X_768]:"1366x768",[i._1619_X_768]:"1619x768",[i._1600_X_900]:"1600x900",[i._1853_X_900]:"1853x900",[i._1920_X_1080]:"1920x1080"},DATA:{[i._DEFAULT]:{w:null,h:null},[i._920_X_555]:{w:920,h:555},[i._1173_X_555]:{w:1173,h:555},[i._1024_X_768]:{w:1024,h:768},[i._1277_X_768]:{w:1277,h:768},[i._1200_X_675]:{w:1200,h:675},[i._1253_X_675]:{w:1253,h:675},[i._1366_X_768]:{w:1366,h:768},[i._1619_X_768]:{w:1619,h:768},[i._1600_X_900]:{w:1600,h:900},[i._1853_X_900]:{w:1853,h:900},[i._1920_X_1080]:{w:1920,h:1080}},WINDOW_HEIGHT_BY_RES:{[i._DEFAULT]:{v:60,k:"vh"},[i._920_X_555]:{v:345,k:"px"},[i._1173_X_555]:{v:345,k:"px"},[i._1024_X_768]:{v:495,k:"px"},[i._1277_X_768]:{v:495,k:"px"},[i._1200_X_675]:{v:460,k:"px"},[i._1253_X_675]:{v:460,k:"px"},[i._1366_X_768]:{v:495,k:"px"},[i._1619_X_768]:{v:495,k:"px"},[i._1600_X_900]:{v:580,k:"px"},[i._1853_X_900]:{v:580,k:"px"},[i._1920_X_1080]:{v:580,k:"px"}},WIDGET_SIZE_BY_RES:{[i._DEFAULT]:44,[i._920_X_555]:32,[i._1173_X_555]:36,[i._1024_X_768]:36,[i._1277_X_768]:44,[i._1200_X_675]:44,[i._1253_X_675]:44,[i._1366_X_768]:44,[i._1619_X_768]:44,[i._1600_X_900]:44,[i._1853_X_900]:44,[i._1920_X_1080]:44}}},function(t,e,i){var n=i(58);t.exports=function(){let t="CanvasFade.js",e=null,i=null,a=null,s=null,r=null,o=null;const l=t=>{o=t},c=()=>{switch(e){case n.action.FADE_IN:a=r||0;break;case n.action.FADE_OUT:a=r||1;break;default:errorReport(t,"startAction","action not exist",e)}},d=()=>a<0||a>s,h=()=>{i()};this.init=()=>{s=1,l(.5)},this.getFadeValue=()=>a,this.forceFinish=()=>{i()},this.update=i=>{switch(e){case n.action.FADE_IN:(t=>{a+=t*o})(i);break;case n.action.FADE_OUT:(t=>{a-=t*o})(i);break;default:errorReport(t,"update","action not exist",e)}d()&&h()},this.updateData=t=>{var n,a,o,d;n=t.action,e=n,a=t.callback,i=a,isset(t.startAlpha)&&(o=t.startAlpha,r=o),isset(t.finishAlpha)&&(d=t.finishAlpha,s=d),isset(t.speed)&&l(t.speed),c()}}},function(t,e){t.exports={ON_DIE_NPC:"ON_DIE_NPC",ON_RESPAWN_NPC:"ON_RESPAWN_NPC"}},function(t,e){t.exports=function(){let t=null,e=null,i=null,n=null,a=null,s=null,r=null,o=!1,l=null,c=null,d=!1,h=!1,u=null,p=null,g=null;const f=t=>{P(t);let e=S();D(null!=e?e:l)},m=()=>{d?v():(B(!0),g())},v=()=>{x(t.prepareBehaviorList(copyStructure(s.list))),L(s.repeat),P(c-1),E(),_(!1),b()},E=()=>{c=null},_=t=>{d=t},b=()=>{p(),w(),(()=>{if(null!=a){if(!0!==n&&(M(),n<=0&&(f(a+1),e.length<a+1))){if(f(0),!0===i)return;O(),i<=0&&m()}}else f(0)})(),C()},w=()=>{h&&(y()||T(),x(t.prepareBehaviorList(copyStructure(u.list))),L(isset(u.repeat)?u.repeat:l),P(null),_(!0),$(!1))},C=()=>{let e=A(),i=k(),n=I();null==n||Engine.rajCase.checkFullFillCase(n)?(i&&t.serverRayControllerData(i),t.startBehavior(e)):b()},T=()=>{c=a},y=()=>null!=c,I=()=>{let t=H();return t&&t.case?t.case:null},A=()=>{let t=H();return t?t.name:null},k=()=>{let t=H();return t&&t.external_properties?t.external_properties:null},S=()=>{let t=H();return t&&t.repeat?t.repeat:null},O=()=>{L(i-1)},M=()=>{D(n-1)},N=e=>{t=e},R=t=>{r=t},x=t=>{e=t},L=t=>{i=t},D=t=>{n=t},P=t=>{a=t},B=t=>{o=t},F=t=>{p=t},W=t=>{g=t},$=t=>{h=t},H=()=>e[a];this.init=(t,e,i)=>{N(t),F(e),W(i)},this.callBehavior=b,this.decreaseDuration=t=>{R(r-t)},this.setDuration=R,this.setBehaviorRepeat=L,this.setOneBehaviorRepeat=D,this.setBehaviorList=x,this.setBehaviorData=t=>{s=t},this.setDefaultRepeat=t=>{l=t},this.setBreakBehavior=$,this.setNewBehaviorData=t=>{u=t},this.getActualBehaviorDurationData=()=>{let t=H();return t&&t.duration?t.duration:null},this.getActualBehaviorName=A,this.getActualBehavior=H,this.getAllBehaviorFinished=()=>o,this.getDuration=()=>r,this.getBreakBehavior=()=>h}},function(t,e,i){var n=i(0);t.exports=function(){let t="ColorPicker.js",e=null,i=null,a=null,s=null,r=null,o=null,l=null,c=null,d=null;const h=t=>{t.append(a)},u=()=>{s.on("click",(function(t){t.stopPropagation(),T()}))},p=()=>{i={0:!0,1:!0,2:!0}},g=()=>{e=["#fc3e40","#767676","#87fdff","#93441c","#4cfa4f","#fe5afb","#40bfff","#f37125","#a500fc","#ffba37","#eaeaea","#93b900","#fef348","#3559ff","#c71618","#ffa9fe","#46a31d","#292929","#FFFFFF","#D49999","#ACDA22","#B554FF","#FFA500","#B1B7BD","#ec0c0c","#CC32D0"]},f=()=>{a=n.get("color-picker"),o=a.find(".pick-color-palette"),s=a.find(".choose-color-bck"),r=a.find(".choose-icon")},m=()=>{v()},v=function(){for(let t in i)E(parseInt(t))},E=t=>{let e=$("<div>").addClass("icon-to-choose mark-id-"+t),i=$("<div>").addClass("icon-to-choose-wrapper");i.on("click",(function(){A(t)})),o.find(".first-column-icon").append(i.append(e))},_=()=>{b()},b=function(){var t=o.find(".first-column-icon"),i=o.find(".first-column-color"),n=o.find(".second-column-color");o.append(t,i,n);for(var a=0;a<e.length;a++){w(a<13?i:n,e[a])}},w=(t,e)=>{var i=$("<div>").addClass("palette-one-color");i.css("background-color",e),i.on("click",(function(){I(e),l&&l(c),C()})),t.append(i)},C=()=>{o.css("display","none")},T=()=>{"block"==o.css("display")?C():y()},y=()=>{o.css("display","block")},I=t=>{O(t),s.css("background-color",c),o.find(".icon-to-choose").css("background-color",c)},A=e=>{M(e),(()=>{if(i[d]){for(let t in i)r.removeClass("mark-id-"+t);r.addClass("mark-id-"+d)}else errorReport(t,"updateIcon","chooseIconId not exist",d)})()},k=t=>{let e=t?"block":"none";r.css("display",e),o.find(".first-column-icon").css("display",e)},S=t=>{l=t},O=t=>{c=t},M=e=>{if(!i[e])return errorReport(t,"setChooseIconId","chooseIconId not exist",d),void(d=0);d=e};this.init=()=>{g(),p(),f(),m(),_(),u()},this.updateData=(t,e,i,n)=>{null!=i&&(k(!0),A(i)),I(e),n&&S(n),h(t)},this.getChooseColor=()=>c,this.getChooseIconId=()=>d,this.get$colorPicker=()=>a,this.setColorAndUpdate=I,this.setIconIdAndUpdate=A}},function(t,e,i){let n=i(470);t.exports=function(){const t="KindOrder.js";let e,i,a;const s=t=>{e=t},r=t=>{i=t},o=t=>{a=t};this.init=(t,e,i)=>{let a=isset(t)?t:n.KIND.FLOAT_OBJECT,l=isset(e)?e:n.V,c=isset(i)?i:n.MINIMUM_ORDER;s(a),r(l),o(c)},this.getOrder=t=>{const s=n.KIND,r=isNumberFunc(t)?t:0;switch(e){case s.FLOAT_OBJECT:return a+i;case s.MAP_OBJECT:return r+i}},this.setOrderData=t=>{isset(t.kind)&&s(t.kind),isset(t.v)&&r(t.v)},this.checkCorrectData=i=>{const a="checkCorrectData";if(!elementIsObject(i))return errorReport(t,a,"data have to be object",i),!1;if(isset(i.kind)){const s=n.KIND;switch(e){case s.FLOAT_OBJECT:case s.MAP_OBJECT:break;default:return errorReport(t,a,"incorrect kind!",i),!1}}return!(isset(i.v)&&!isNumberFunc(i.v))||(errorReport(t,a,"incorrect kind!",i),!1)}}},function(t,e){t.exports={GET_RANDOM_KEY:"getRandom",resultType:{INT:"int",FLOAT:"float",OPTION:"option"}}},function(t,e){t.exports={action:{CREATE:"CREATE",REMOVE:"REMOVE",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST",REMOVE_IF_EXIST:"REMOVE_IF_EXIST"},mode:{STATIC:"static",TRANSITION:"transition"},defaultData:{ORDER:0,BEHAVIOR_REPEAT:1,BEHAVIOR_DURATION:5,SCREEN_EFFECT_REPEAT:1}}},function(t,e){t.exports=function(){const t="BehaviorDynamicCommons.js";let e=null,i=null,n=0;const a=()=>{setTimeout((function(){s(n),n++,e[n]&&a()}),0)},s=n=>{let a=e[n];if(!a)return void errorReport(t,"drawHoleByFrame",`dynamicPoint[${n}] not exist`,e);let s=null;if(i[n]){let t=i[n];s={canvas:t,ctx:t.getContext("2d")}}i[n]=Engine.dynamicLightsManager.getframesWithHoles().getDynamicHoleImg(a,s)};this.getXY=(t,e)=>{let i=CFG.tileSize,n=CFG.halfTileSize,a=(isset(e.r)?e.r:Engine.dynamicLightsManager.getframesWithHoles().getDefaultR())/i-n/i,s=isset(e.offsetX)?e.offsetX:0,r=isset(e.offsetY)?e.offsetY:0;return{x:a+Math.abs(s)/i,y:a+Math.abs(r)/i}},this.getOnlyNight=t=>t.light&&!!t.light.onlyNight||null,this.getDynamicPointImg=()=>i,this.getDynamicHoleRByFrame=i=>e[i]?e[i].r:(errorReport(t,"getDynamicHoleRByFrame",`dynamicPoint[${i}] not exist`,e),null),this.setDynamicHoleRByFrame=(i,n)=>{if(e[i])return e[i].r=n;errorReport(t,"setDynamicHoleRByFrame",`dynamicPoint[${i}] not exist`,e)},this.getDynamicHoleOffsetXByFrame=i=>e[i]?e[i].offsetX:(errorReport(t,"getDynamicHoleOffsetXByFrame",`dynamicPoint[${i}] not exist`,e),null),this.getDynamicHoleOffsetYByFrame=i=>e[i]?e[i].offsetY:(errorReport(t,"getDynamicHoleOffsetYByFrame",`dynamicPoint[${i}] not exist`,e),null),this.setDynamicHoleXByFrame=(i,n)=>{if(e[i])return e[i].x=n;errorReport(t,"setDynamicHoleXByFrame",`dynamicPoint[${i}] not exist`,e)},this.setDynamicHoleYByFrame=(i,n)=>{if(e[i])return e[i].y=n;errorReport(t,"setDynamicHoleYByFrame",`dynamicPoint[${i}] not exist`,e)},this.drawHoleByFrame=s,this.prepareDynamicPointAndDynamicPointImg=(t,n)=>{let s=Engine.nightController.getNightFrameLength();e=Engine.dynamicLightsManager.getframesWithHoles().getOnePoint(t,s,!0,n),i=[],a()},this.createLight=t=>{if(!t.light)return null;let e=Engine.nightController.createOneLightPoint(t);return e||null},this.getDynamicHoleImgBuActualFrame=t=>i[t]}},function(t,e,i){let n=i(25),a=i(11),s=i(1),r=function(){};r.prototype.id=null,r.prototype.x=null,r.prototype.y=null,r.prototype.actualRepeat=1,r.prototype.data=null,r.prototype.master=null,r.prototype.fw=null,r.prototype.fh=null,r.prototype.delayBefore=null,r.prototype.delayAfter=null,r.prototype.cycleFinish=null,r.prototype.getCycleFinish=function(){return this.cycleFinish},r.prototype.setCycleFinish=function(t){this.cycleFinish=t},r.prototype.initObject=function(t,e){this.setId(t),this.setData(e),this.setMaster(this.findMaster()),this.getMaster()&&(this.setXFromMaster(),this.setYFromMaster())},r.prototype.isDelayBeforeInParams=function(){return!!this.getData().params.delayBefore},r.prototype.setDelayBefore=function(t){this.delayBefore=t},r.prototype.increaseDelayBefore=function(t){this.setDelayBefore(this.delayBefore+t)},r.prototype.isDelayBeforeReach=function(){let t=this.getData();return this.delayBefore>100*t.params.delayBefore},r.prototype.isDelayAfterInParams=function(){return!!this.getData().params.delayAfter},r.prototype.setDelayAfter=function(t){this.delayAfter=t},r.prototype.increaseDelayAfter=function(t){this.setDelayAfter(this.delayAfter+t)},r.prototype.isDelayAfterReach=function(){let t=this.getData();return this.delayAfter>100*t.params.delayAfter},r.prototype.shouldBreakDrawFromDelayBefore=function(){return this.isDelayBeforeInParams()&&!this.isDelayBeforeReach()},r.prototype.setPosFromMaster=function(){this.getMaster()&&(this.setXFromMaster(),this.setYFromMaster())},r.prototype.setXFromMaster=function(){let t=this.getMaster();this.setX(t.rx)},r.prototype.setFw=function(t){this.fw=t},r.prototype.getFw=function(){return this.fw},r.prototype.getFh=function(){return this.fh},r.prototype.setFh=function(t){this.fh=t},r.prototype.setYFromMaster=function(){let t=this.getMaster();this.setY(t.ry)},r.prototype.setX=function(t){this.x=t,this.rx=this.x},r.prototype.setY=function(t){this.y=t,this.ry=this.y},r.prototype.getX=function(){return this.x},r.prototype.getY=function(){return this.y},r.prototype.findMaster=function(){let t=this.getData(),e=t.target.kind,i=t.target.id,n=null;switch(e){case s.FAKE_NPC:n=Engine.fakeNpcs.getById(i);break;case s.NPC:n=Engine.npcs.getById(i);break;case s.HERO:n=Engine.hero;break;case s.PET:n=Engine.hero.pet?Engine.hero.pet:Engine.hero;break;default:return errorReport("CharacterEffect.js","findMaster","incorrect attr kind!",t),null}return n||(errorReport("CharacterEffect.js","findMaster","Master not exits!",t),null)},r.prototype.setMaster=function(t){this.master=t},r.prototype.getMaster=function(){return this.master},r.prototype.getMasterKindObject=function(){return this.getMaster().getCanvasObjectType()},r.prototype.getMasterId=function(){return this.getMaster().d.id},r.prototype.getOrder=function(){let t=this.getData(),e=this.textOrder?this.textOrder:0;if(t.params.behind){return this.getMaster().ry-.1}return 1e4+e},r.prototype.getActualRepeat=function(){return this.actualRepeat},r.prototype.setActualRepeat=function(t){this.actualRepeat=t},r.prototype.getOffsetX=function(){let t=this.getData();return t.params.offsetX?t.params.offsetX:0},r.prototype.getOffsetY=function(){let t=this.getData();return t.params.offsetY?t.params.offsetY:0},r.prototype.getRepeat=function(){let t=this.getData();return t.params.repeat?t.params.repeat:null},r.prototype.setId=function(t){this.id=t},r.prototype.setData=function(t){this.data=t},r.prototype.getEffect=function(){return this.getData().effect},r.prototype.getData=function(){return this.data},r.prototype.getId=function(){return this.id},r.prototype.getPos=function(){let t=this.getX(),e=this.getY(),i=this.getMaster(),n=void 0!==i.leftPosMod?i.leftPosMod:0,a=this.getOffsetX(),s=this.getOffsetY(),r=this.getPositionModify(),o=Engine.mapShift.getShift();return{left:t*CFG.tileSize-Engine.map.offset[0]-o[0]+r[0]+n+a,top:e*CFG.tileSize-Engine.map.offset[1]-o[1]+r[1]+CFG.tileSize+s}},r.prototype.correctPosition=function(t){switch(t){case n.position.CENTER:case n.position.LEFT:case n.position.RIGHT:case n.position.TOP:case n.position.BOTTOM:return t}switch(this.getMaster().dir){case a.N:switch(t){case n.position.FRONT:return n.position.TOP;case n.position.BACK:return n.position.BOTTOM;case n.position.LEFT_HAND:return n.position.LEFT;case n.position.RIGHT_HAND:return n.position.RIGHT}break;case a.S:switch(t){case n.position.FRONT:return n.position.BOTTOM;case n.position.BACK:return n.position.TOP;case n.position.LEFT_HAND:return n.position.RIGHT;case n.position.RIGHT_HAND:return n.position.LEFT}break;case a.E:switch(t){case n.position.FRONT:return n.position.RIGHT;case n.position.BACK:return n.position.LEFT;case n.position.LEFT_HAND:return n.position.TOP;case n.position.RIGHT_HAND:return n.position.BOTTOM}break;case a.W:switch(t){case n.position.FRONT:return n.position.LEFT;case n.position.BACK:return n.position.RIGHT;case n.position.LEFT_HAND:return n.position.BOTTOM;case n.position.RIGHT_HAND:return n.position.TOP}}},r.prototype.getPositionModify=function(){let t=this.getMaster();if(!t)return;let e=this.getFw(),i=this.getFh(),a=this.getData(),s=null;switch(this.getEffect()){case n.effect.ANIMATION:s=this.correctPosition(a.params.position);break;case n.effect.TINT:s=n.position.CENTER;break;case n.effect.TEXT:s=n.position.TOP;break;default:return errorReport("CharacterEffect.js","getPositionModify","incorrect attr effect!",a),[0,0]}switch(s){case n.position.CENTER:return[-e/2+CFG.tileSize/2,-i/2-t.fh/2];case n.position.LEFT:return[-e,-i/2-t.fh/2];case n.position.RIGHT:return[t.fw,-i/2-t.fh/2];case n.position.TOP:return[-e/2+t.fw/2,-t.fh-i];case n.position.BOTTOM:return[-e/2+t.fw/2,0];default:return errorReport("CharacterEffect.js","getPositionModify","incorrect attr position!",a),[0,0]}},t.exports=r},function(t,e,i){var n=i(5),a=i(20);t.exports=new function(){const t="BattleLogHelpWindow.js",e=a.BATTLE_PANEL,i=e.mainKey,s=e.BATTLE_PANEL_SIZE,r=e.ATTACH_BATTLE_LOG_HELP_WINDOW,o=e.ATTACH_BATTLE_PREDICTION_HELP_WINDOW,l=e.BATTLE_LOG_HELP_WINDOW_SIZE_OPT,c=e.BATTLE_PREDICTION_HELP_WINDOW_SIZE_OPT;this.getBattlePanelState=()=>n.easyGet(i,s),this.setBattlePanelState=t=>{n.easySet(t,i,s)},this.getAttachBattleLogHelpWindow=()=>{let e=n.easyGet(i,r);return null!==e&&(isBoolean(e)?e:(errorReport(t,"getAttachBattleLogHelpWindow","incorrect attachData",e),!1))},this.setAttachBattleLogHelpWindow=t=>{n.easySet(t,i,r)},this.getBattleLogHelpWindowSizeOpt=e=>{let a=n.easyGet(i,l);return isInt(a)&&-1<a&&a<e.length?a:(errorReport(t,"getBattleLogHelpWindowSizeOpt","incorrect sizeOptData",a),0)},this.setBattleLogHelpWindowSizeOpt=t=>{n.easySet(t,i,l)},this.getAttachBattlePredictionHelpWindow=()=>{let e=n.easyGet(i,o);return null!==e&&(isBoolean(e)?e:(errorReport(t,"getAttachBattlePredictionHelpWindow","incorrect attachData",e),!1))},this.setAttachBattlePredictionHelpWindow=t=>{n.easySet(t,i,o)},this.getBattlePredictionHelpWindowSizeOpt=e=>{let a=n.easyGet(i,c);return isInt(a)&&-1<a&&a<e.length?a:(errorReport(t,"getBattlePredictionHelpWindowSizeOpt","incorrect sizeOptData",a),0)},this.setBattlePredictionHelpWindowSizeOpt=t=>{n.easySet(t,i,c)}}},,,,,,,function(t,e,i){var n=i(5),a=i(0);t.exports=new function(){var t={};this.init=function(){this.Storage=n,this.Templates=a},this.callEvent=function(e,i){if(t[e])for(var n=t[e],a=0;a<n.length;a++){(0,n[a])(i)}},this.checkCorrectEvent=t=>{let e=Engine.apiData;for(let i in e)if(e[i]==t)return!0;return!1},this.addCallbackToEvent=function(e,i){this.checkCorrectEvent(e)||errorReport("Api.js","addCallbackToEvent",`Event name "${e}" not exist in ApiData!`);var n=this.getData(e);isset(t[e])||(t[e]=[]);var a=t[e],s=a.length;if(a.indexOf(i)>-1)throw"this callback already exist "+i;for(var r in a.push(i),n)a[s](n[r])},this.removeCallbackFromEvent=function(e,i){this.checkCorrectEvent(e)||errorReport("Api.js","removeCallbackFromEvent",`Event name "${e}" not exist in ApiData!`);var n=t[e];if(!n)throw"No eventName found ["+e+"]";for(var a=0;a<n.length;a++)if(n[a]==i)return void n.splice(a,1);throw"No callback found ["+e+"]"},this.getData=function(t){var e=null;switch(t){case Engine.apiData.NEW_OTHER:e=Engine.others.check();break;case Engine.apiData.NEW_NPC:e=Engine.npcs.check();break;case Engine.apiData.NEW_WARRIOR:if(!Engine.battle)return;e=Engine.battle.warriorsList;break;case Engine.apiData.NEW_MSG:e=[],$(".chat-message").each((function(){e.push([$(this),$(this).data("data")])}));break;default:e={}}return e},this.init()}},function(t,e){let i={NEW_INVENTORY_ITEM:{loc:"g"},NEW_BOTTOM_ITEM:{loc:"g"},ITEM_IN_REPLENISHMENT_ARROWS:{loc:"g"},NEW_OUTFIT_ITEM:{loc:"g"},NEW_EQUIP_ITEM:{loc:"g"},NEW_BATTLE_SET_EQ_ITEM:{loc:"g"},NEW_AUCTION_ITEM:{loc:"a"},NEW_NORMAL_LOOT_ITEM:{loc:"l"},NEW_PERSONAL_LOOT_ITEM:{loc:"k"},NEW_GROUND_ITEM:{loc:"m"},NEW_MINI_MAP_GROUND_ITEM:{loc:"m"},NEW_PROMO_ITEM:{loc:"$"},NEW_PRIVATE_DEPO_ITEM:{loc:"d"},NEW_CLAN_DEPO_ITEM:{loc:"c"},NEW_QUEST_REWARD_ITEM:{loc:"q"},NEW_RECOVERY_ITEM:{loc:"r"},NEW_REGISTRATION_ITEM:{loc:"e"},NEW_OTHER_EQ_ITEM:{loc:"otherEqItem"},NEW_TRADE_ITEM_T:{loc:"t"},NEW_TRADE_ITEM_S:{loc:"s"},NEW_ENHANCEMENT_RECEIVED_ITEM:{loc:"u"},NEW_EXTRACTION_RECEIVED_ITEM:{loc:"j"},NEW_MAIL_ITEM:{loc:"b"},NEW_CHAT_LINKED_ITEM:{loc:"C"},NEW_CHAT_LINKED_TPL:{loc:"C"},NEW_TPL_PREVIEW:{loc:"p"},NEW_OPEN_TPL:{loc:"s"},NEW_SEASON_TPL:{loc:"r"},NEW_SEASON_REWARD_TPL:{loc:"i"},NEW_PROGRESS_TPL:{loc:"d"},M_ALERT_TPL:{loc:!1},NEW_PACK_TPL:{loc:"o"},NEW_BLESS_TPL:{loc:"b"},NEW_BARTER_TPL:{loc:"f"},NEW_BATTLE_PASS_TPL:{loc:"B"},NEW_BATTLE_SUMMARY_TPL:{loc:"d"},NEW_REWARD_CALENDAR_TPL:{loc:"v"},NEW_BRING_CLAN_QUEST_TPL:{loc:"q"},NEW_UPGRADE_REQUIRE_TPL:{loc:"u"},NEW_SALVAGE_RECEIVED_TPL:{loc:"h"},NEW_EXTRACTION_RECEIVED_TPL:{loc:"j"},NEW_BONUS_RESELECT_COST_TPL:{loc:"w"},NEW_SHOP_TPL:{loc:"n"},NEW_BASKET_TPL:{loc:"n"},NEW_CRAZY_TPL_SHOP_CHEST:{loc:"n"},NEW_CRAZY_TPL_SHOP_PROMO:{loc:"n"},NEW_RECIPE_TPL:{loc:"c"},NEW_RECIPE_INGREDIENT_TPL:{loc:"c"},FETCH_NEW_LOOT:{loc:"l"},FETCH_NEW_LOOT_ITEM:{loc:"l"},FETCH_WATCH_ITEM:{loc:"m"},FETCH_NEW_ITEM:{loc:"g"},FETCH_CHECK_IF_TP_ITEM:{loc:"g"}};for(let t in i)i[t].k=t;t.exports=i},function(t,e,i){var n=i(174),a=i(176),s=i(177),r=i(178),o=function(t,e,i){this.width=t,this.height=e,this.chunkSize=i,this.nodes=[],this.chunks=[],this.zones=[],this.chunksInRow=Math.ceil(this.width/this.chunkSize),this.chunksRows=Math.ceil(this.height/this.chunkSize),this.zoneConnectionIds=new s};o.prototype.setNodes=function(t){this.nodes=t},o.prototype.getNodes=function(){return this.nodes},o.prototype.setChunks=function(t){this.chunks=t},o.prototype.getChunks=function(){return this.chunks},o.prototype.getChunkById=function(t){return this.chunks[t]},o.prototype.getWidth=function(){return this.width},o.prototype.getHeight=function(){return this.height},o.prototype.getChunksInRow=function(){return this.chunksInRow},o.prototype.getChunksRows=function(){return this.chunksRows},o.prototype.getChunkSize=function(){return this.chunkSize},o.prototype.createChunk=function(t,e){for(var i=t*this.chunksInRow+e,a=new n(i,t,e,this.chunkSize,this),s=[],r=t*this.chunkSize,o=e*this.chunkSize,l=0;l<this.chunkSize;l++)for(var c=0;c<this.chunkSize;c++)s.push(this.getNode(l+r,c+o));return a.setNodes(s),a},o.prototype.createNode=function(t,e){return new r(t,e,this)},o.prototype.isCorrectPosition=function(t,e){return!(t<0)&&(!(e<0)&&(!(t>=this.getWidth())&&!(e>=this.getHeight())))},o.prototype.correctPosition=function(t,e){var i={x:t,y:e};return i.x>=this.getWidth()&&(i.x=this.getWidth()-1),i.y>=this.getHeight()&&(i.y=this.getHeight()-1),i},o.prototype.getNode=function(t,e){var i=this.correctPosition(t,e),n=i.y*this.getWidth()+i.x,a=this.getNodeById(n);return a.isPosition(i)?a:null},o.prototype.getNodeById=function(t){return this.nodes[t]},o.prototype.createNeighborConnections=function(){for(var t in this.nodes)this.nodes[t].findAndSetNeighbors(this)},o.prototype.copyCollisionsToNodes=function(t){for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];t.check(i.x,i.y)&&i.setCollision(!0)}},o.prototype.copyCollisionsToNodesCache=function(t){for(var e=0;e<t.length;e++){let i=t[e];this.nodes[i].setCollision(!0)}},o.prototype.clearIgnores=function(){for(var t in this.nodes)this.nodes[t].clearIgnore()},o.prototype.reloadCollisionsConnections=function(){for(var t=0;t<this.chunks.length;t++)this.chunks[t].reloadGroups();for(t=0;t<this.chunks.length;t++)this.chunks[t].createConnection()},o.prototype.createChunkZone=function(t,e){var i=new a(t,e,this.zoneConnectionIds);return e||this.createSingleConnectionChunkZone(i),this.zones.push(i),i},o.prototype.removeChunkZone=function(t){var e=t.connectionId;t.unassignNodes(),t.releaseConnectionId(),this.zones.forEach(t=>{t.connectionId===e&&t.releaseConnectionId()});var i=this.zones.indexOf(t);-1!==i&&this.zones.splice(i,1)},o.prototype.connectNodesChunkZone=function(t,e){this.connectChunkZone(t.chunkZone,e.chunkZone)},o.prototype.createSingleConnectionChunkZone=function(t){var e=this.zoneConnectionIds.getFree();t.setConnectionId(e)},o.prototype.connectChunkZone=function(t,e){if(null===t.connectionId&&null===e.connectionId){var i=this.zoneConnectionIds.getFree();t.setConnectionId(i),e.setConnectionId(i)}else{if(t.connectionId===e.connectionId)return;if(null===t.connectionId)t.setConnectionId(e.connectionId);else if(null===e.connectionId)e.setConnectionId(t.connectionId);else{var n=e.connectionId,a=t.connectionId;this.zones.forEach(t=>{t.connectionId===n&&t.setConnectionId(a)})}}},o.prototype.getNeighbors=function(t){var e=[t.id-1,t.id+1,t.id-this.getWidth(),t.id+this.getWidth()],i=[];for(var n in e){var a=e[n],s=this.nodes[a];isset(s)&&t.isNeighbor(s)&&i.push(s)}return i},o.prototype.generateMap=function(){var t=this;const e=document.createElement("canvas");document.body.appendChild(e),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex="10";var i=()=>{e.width=8*this.width+8*(this.chunksInRow-1)/2,e.height=8*this.height+8*(this.chunksRows-1)/2;const n=e.getContext("2d");for(var a in n.fillStyle="white",n.fillRect(0,0,e.width,e.height),t.chunks)t.chunks[a].draw(n,8);requestAnimationFrame(i)};requestAnimationFrame(i)},t.exports=o},function(t,e,i){var n=i(92),a=i(94),s=function(t){this.map=new n(t.getWidth(),t.getHeight(),t.getChunkSize());var e=t.getNodes().map(t=>new a(t));this.map.setNodes(e),e.forEach(t=>t.createNeighborsConnections(this.map)),this.map.setChunks(t.getChunks())};s.prototype.getNode=function(t,e){return this.map.getNode(t,e)},s.prototype.clearContext=function(){for(var t=this.map.getNodes(),e=0;e<t.length;e++)t[e].clearContext()},s.prototype.clearDisables=function(){for(var t=this.map.getNodes(),e=0;e<t.length;e++)t[e].clearDisable()},t.exports=s},function(t,e,i){var n=i(180),a=function(t){this.baseNode=t,this.neighbors=[],this.disabled=!1,this.from=null,this.gScore=null,this.dests=[]};a.prototype.setChunk=function(t){return this.baseNode.setChunk(t)},a.prototype.setChunkZone=function(t){return this.baseNode.setChunkZone(t)},a.prototype.isChunkZoneEmpty=function(){return this.baseNode.isChunkZoneEmpty()},a.prototype.isOnChunk=function(t){return this.baseNode.isOnChunk(t)},a.prototype.isOnSameChunk=function(t){return!this.disabled&&this.baseNode.isOnSameChunk(t.baseNode)},a.prototype.isConnectedWith=function(t){return!this.disabled&&this.baseNode.isConnectedWith(t.baseNode)},a.prototype.getChunkId=function(){return this.baseNode.getChunkId()},a.prototype.createNeighborsConnections=function(t){for(var e=0;e<this.baseNode.neighbors.length;e++){var i=this.baseNode.neighbors[e];this.neighbors[e]=t.getNodeById(i.getId())}},a.prototype.disableNode=function(){this.disabled=!0},a.prototype.isBlocked=function(){return!!this.disabled||this.baseNode.isBlocked()},a.prototype.getId=function(){return this.baseNode.id},a.prototype.isNeighbor=function(t){return this.baseNode.isNeighbor(t.baseNode)},a.prototype.getHCETo=function(t){return this.baseNode.getHCETo(t.baseNode)},a.prototype.getHCE8To=function(t){return this.baseNode.getHCE8To(t.baseNode)},a.prototype.isPosition=function(t){return this.baseNode.isPosition(t)},a.prototype.getPosition=function(){return this.baseNode.getPosition()},a.prototype.setStartNodes=function(t){this.from=null,this.gScore=0,this.dests=[];for(var e=0;e<t.length;e++)this.dests.push(new n(this));this.updateCosts(t)},a.prototype.setPreviousNodes=function(t,e){this.from=t,this.gScore=t.getGScore()+1,this.updateCosts(e)},a.prototype.setGScore=function(t){this.gScore=t},a.prototype.isLowerCostThan=function(t){for(var e=Math.min(this.dests.length,t.dests.length),i=0;i<e;i++){var n=this.dests[i],a=t.dests[i];if(n.isLowerScore(a))return!0}return!1},a.prototype.getGScore=function(){return this.gScore},a.prototype.getFrom=function(){return this.from},a.prototype.clearContext=function(){this.from=null,this.gScore=null,this.dests=[]},a.prototype.clearDisable=function(){this.disabled=!1},a.prototype.updateCosts=function(t){for(var e=0;e<t.length;e++){var i=this.getCostById(e),n=t[e];i.setScore(n)}},a.prototype.getCostById=function(t){if(this.dests.length>t)return this.dests[t];var e=new n(this);return this.dests[t]=e,e},t.exports=a},function(t,e){t.exports={group:{MOVE:"move",FIGHT:"fight",MAP:"map",SOCIAL:"social",OTHER:"other"},type:{TIP:"Tip",LABEL:"Label"},name:{hotAttackNearMob:"hotAttackNearMob",autofightNearMob:"autofightNearMob",hotAttackNearPlayer:"hotAttackNearPlayer",hotChangeTarget:"hotChangeTarget",hotAutoFight:"hotAutoFight",hotAcceptLoot:"hotAcceptLoot",toggleBattlePanel:"toggleBattlePanel",hotCloseFight:"hotCloseFight",showLog:"showLog",iconglobe:"iconglobe",hotportablemap:"hotportablemap",iconcompass:"iconcompass",goGateway:"goGateway",hotTalkNearMob:"hotTalkNearMob",iconchat:"iconchat",iconclans:"iconclans",iconfriends:"iconfriends",iconparty:"iconparty",quickParty:"quickParty",clanSendMessage:"clanSendMessage",iconconfig:"iconconfig",iconkeyboard:"iconkeyboard",iconWindows:"iconWindows",iconpuzzle:"iconpuzzle",iconconsole:"iconconsole",eqcolumnshow:"eqcolumnshow",showhideStats:"showhideStats",hotAuction:"hotAuction",iconphoto:"iconphoto",iconscroll:"iconscroll",iconskills:"iconskills",iconexit:"iconexit",iconstar:"iconstar",news:"news",matchmaking:"matchmaking",achievements:"achievements",hotTakeGroundItem:"hotTakeGroundItem",world:"world",move_up:"move_up",move_down:"move_down",move_left:"move_left",move_right:"move_right"}}},function(t,e,i){var n=i(35),a=i(17),s=i(100),r=(i(68),i(48),i(103),i(104)),o=i(37),l=i(47),c=i(13);let d=i(1),h=i(11);const{showProfile:u}=i(2),p=i(36);var g=function(){var t=this,e=[_t("admin",null,"ranks"),_t("super_mg",null,"ranks"),_t("mg",null,"ranks"),_t("chat_mod",null,"ranks"),_t("super_chat_mod",null,"ranks")];this.d={},this.inMove=!1,this.isPlayer=!0,this.frame=0,this.frames=null,this.collider=null,this.canvasObjectType=d.OTHER,this.overMouse=!1,this.onSelfMarginEmo=0;var i=new Lock(["create","image"],(function(){}));this.$=$('<div class="other character"></div>');var n=[h.S,h.W,h.E,h.N],g=0,f=0;let m=null,v=null;this.init=()=>{E(),t.createPlaceHolderCharacter(),t.initOnSelfEmoList(),t.initDataDrawer()};const E=()=>{v=new l,v.init(getEngine().hero,this)};this.getFollowController=function(){return v},this.update=function(e){if(Engine.allInit){if(this.changeWarShadowOpacity(e),this.inMove=!1,isset(this.pet)&&this.pet.update(e),this.rx!=this.d.x||this.ry!=this.d.y){this.inMove=!0;var i=5*e;g+=i,this.rx<this.d.x?(this.rx+=i,this.rx>this.d.x&&(this.rx=this.d.x)):this.rx>this.d.x&&(this.rx-=i,this.rx<this.d.x&&(this.rx=this.d.x)),this.ry<this.d.y?(this.ry+=i,this.ry>this.d.y&&(this.ry=this.d.y)):this.ry>this.d.y&&(this.ry-=i,this.ry<this.d.y&&(this.ry=this.d.y)),isset(this.colorMark)&&this.colorMark.update(),isset(this.whoIsHereGlow)&&this.whoIsHereGlow.update(),v.checkFollowGlow()&&v.getFollowGlow().update()}else 0!=this.frame&&(this.frame=0);this.animate(e),g>=.5&&(this.frame++,g%=.5,4==this.frame&&(this.frame=0)),this.updateCollider(),t.getDataDrawer().update(e)}},this.animate=function(t){this.frames&&this.frames.length>1&&t&&(f+=100*t,this.frames[this.activeFrame].delay<f&&(f-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.delete=function(e){API.callEvent(Engine.apiData.REMOVE_OTHER,t),t.colorMark&&"red"==t.colorMark.color&&(Engine.hero.markOtherObj=null),Engine.others.removeOne(t.d.id,e),Engine.emotions.removeAllFromSourceId(t.d.id)};const _=()=>{C(getEngine().others.findKindOther(this))},b=t=>{t!=m&&this.clearDataToDraw()},w=()=>{let t=m;_(),b(t)};this.afterUpdate=function(e,n){if(isset(e.icon)&&!isset(e.pet)&&isset(this.pet)&&this.deletePet(),isset(this.d.del))return this.delete();if(w(),isset(this.rx)&&isset(this.ry)){var a=this.rx-this.d.x,s=this.ry-this.d.y;a<-2&&(this.rx=this.d.x-2),a>2&&(this.rx=this.d.x+2),s<-2&&(this.ry=this.d.y-2),s>2&&(this.ry=this.d.y+2)}else this.rx=this.d.x,this.ry=this.d.y;isset(this.pet)&&this.pet.calculatePosition(),i.check().length&&i.unlock("create"),this.tip=[t.createStrTip(),"t_other",{borderColor:t.whoIsHere}],isset(this.petLock)&&this.petLock.unlock("petUpdate"),this.updateWhoIsHereGlow()},this.tipUpdate=function(){this.tip=[t.createStrTip(),"t_other",{borderColor:t.whoIsHere}]},this.createStrTip=function(){var i="";if(t.rights){var n=-1;n=1&t.rights?0:16&t.rights?1:2&t.rights?2:4&t.rights?4:3,i+='<div class="rank">'+e[n]+"</div>"}isset(t.d.guest)&&parseInt(t.d.guest)&&(i+='<div class="rank">'+_t("deputy")+"</div>"),i+=t.setTipHeader(t),isset(t.wanted)&&1==parseInt(t.wanted)&&(i+="<div class=wanted></div>"),t.d.clan&&(i+='<div class="clan-in-tip">'+escapeHTML(t.d.clan.name)+"</div>");var a={text:i+=t.setBuffsSections(),object:t};return API.callEvent(Engine.apiData.AFTER_CHARACTER_TIP_UPDATE,a),a.text},this.updateWhoIsHereGlow=function(){isset(t.whoIsHereGlow)&&delete t.whoIsHereGlow,t.whoIsHere&&t.imgLoaded&&(t.whoIsHereGlow=new o,t.whoIsHereGlow.createObject(t))},this.getFar=()=>Math.abs(Engine.hero.d.x-this.d.x)>1||Math.abs(Engine.hero.d.y-this.d.y)>1,this.setBuffsSections=function(){var e="",i=isset(t.d.is_blessed)&&t.d.is_blessed?'<div class="bless"></div>':"",n=1&t.d.attr?'<div class="mute"></div>':"",a=isset(t.d.vip)&&"1"==t.d.vip?'<div class="k-b"></div>':"",s=2&t.d.attr?'<div class="warn"></div>':"",r=t.d.clan?'<div class="line"></div>':"",o=t.d.wanted?'<div class="wanted-i"></div>':"";return""==i&&""==n&&""==a&&""==s&&""==o||(e='<div class="buffs-wrapper">'+r+o+i+n+a+s+"</div>"),e},this.setTipHeader=function(e){var i=isset(t.d.prof)?t.d.prof:"",n=0==e.d.lvl?"":"("+e.d.lvl+i+")";return'<div class="info-wrapper">'+('<div class="nick">'+e.nick+" "+n+"</div>")+"</div>"},this.getOrder=function(){return this.ry+.4},this.onmousemove=function(){return!1},this.oncontextmenu=function(t){return t.stopPropagation(),this.createMenu(t),!1},this.markIsRed=function(){return t.colorMark&&"red"==t.colorMark.color},this.deleteRedMark=function(){var e={};e[t.d.id]=t.d,Engine.hero.markOtherObj=null,Engine.targets.deleteArrow("Other-"+t.d.id),Engine.miniMapController.updateWindowMiniMapOthersPos(e),delete t.colorMark},this.createMenu=function(e){var i=Engine.hero,n=[],a=Engine.party;((!a||a&&!isset(a.getMembers()[t.d.id]))&&(t.markIsRed()?n.push([_t("stop_attack",null,"menu"),function(){t.deleteRedMark()}]):n.push([_t("attack",null,"menu"),function(){var e=Engine.hero.markOtherObj,i={};i[t.d.id]=t.d,e&&"red"==e.colorMark.color&&(i[e.d.id]=e.d,Engine.targets.deleteArrow("Other-"+e.d.id),delete e.colorMark),Engine.hero.markOtherObj=t,Engine.miniMapController.updateWindowMiniMapOthersPos(i),t.colorMark=new r(t.d.id,"red"),t.colorMark.init(),Engine.targets.addArrow(!1,t.nick,t,"Other","attack"),Engine.hero.heroAtackOtherRequest()}])),n.push([_t("trade",null,"menu"),function(){Engine.hero.addAfterFollowAction(t,(function(){_g("trade&a=ask&id="+t.d.id)}))}]),i.d.lvl>29&&n.push([_t("kiss",null,"menu"),function(){Engine.hero.addAfterFollowAction(t,(function(){_g("emo&a=kiss&id="+t.d.id)}))}]),i.d.vip&&n.push([_t("crimson_bless",null,"menu"),function(){Engine.hero.addAfterFollowAction(t,(function(){_g("emo&a=bless&id="+t.d.id)}))}]),this.addShowEqAndMessageToMenu(n),n.push([_t("invite_to_friend"),function(){_g("friends&a=finvite&nick="+t.d.nick.trim().split(" ").join("_"))}]),n.push([_t("team_invite",null,"menu"),function(){_g("party&a=inv&id="+t.d.id)}]),n.push([_t("show_profile",null,"menu"),()=>u(this.d.account,this.d.id)]),mobileCheck())&&(Engine.targets.checkExistById("Other-"+t.d.id)?n.push([_t("stop_navigate"),function(){Engine.targets.deleteArrow("Other-"+t.d.id)}]):n.push([_t("navigate"),function(){Engine.targets.deleteAllOtherArrows(),Engine.targets.addArrow(!1,t.nick,t,"Other","navigate")}]));return t.addDebugOptionMenu(n),!!n.length&&(Engine.interface.showPopupMenu(n,e,!0),!0)},this.createBasicMenu=function(e){getEngine().others.createOtherContextMenu(e,{lvl:t.getLvl(),prof:t.getProf(),nick:t.getNick(),charId:t.getId(),accountId:t.getAccountId()},[p.INVITE_TO_FRIEND,p.INVITE_TO_ENEMIES,p.INVITE_TO_PARTY])},this.addShowEqAndMessageToMenu=function(e){t.d.relation!=a.RELATION.ENEMY&&e.push([_t("send_message",null,"chat"),function(){Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(t.d.nick)}]),e.push([_t("show_eq"),this.showEq])},this.showEq=()=>{Engine.showEqManager.update(t.d)},this.updatePet=function(e){var i=!!jQuery.isEmptyObject(e);isset(this.pet)?i?this.deletePet():(e.isNew=!1,e.action&&t.pet.createActionsDataArrayForOther(e.action),t.pet.updateDATA(e)):(e.isNew=!0,e.master=t,this.pet=new s,this.pet.updateDATA(e),this.petLock=new Lock(["petUpdate"],(function(){e.action&&t.pet.createActionsDataArrayForOther(e.action),t.pet.updateDATA({master:t}),delete t.petLock})))},this.deletePet=function(){isset(this.pet)&&delete this.pet},this.onhover=function(e,i){t.overMouse=i,getEngine().interface.setDoActionCursor(i);var n=t.grp;t.grp&&Engine.npcs.groupShining(n,i)},this.setStasis=function(e){1===e?t.stasis=e:(delete t.stasis,delete t.d.stasis)},this.setStasisEmo=function(e,i){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.d.id?t.d.id:i.id,s=Engine.emotions,r=n?c.NAME.STASIS_INCOMING:c.NAME.STASIS;e>0?s.updateData([{name:r,source_id:a,source_type:c.OBJECT_TYPE.OTHER}]):s.removeEmotionBySourceIdAndEmoType(a,r)},this.beforeOnload=(e,n)=>{t.fw=e.hdr.width/4,t.fh=e.hdr.height/4,t.halffw=t.fw/2,t.halffh=t.fh/2,t.frames=e.frames,t.activeFrame=0,t.sprite=n,i.unlock("image"),t.updateCollider()},this.afterLoadImage=()=>{this.imgLoaded=!0,this.updateWhoIsHereGlow(),this.refreshEmotions()},this.getId=()=>this.d.id,this.getNick=()=>this.d.nick,this.getImg=()=>this.d.icon,this.getLvl=()=>this.d.lvl,this.getProf=()=>this.d.prof;this.getRelation=()=>this.d.relation,this.getAccountId=()=>this.d.account,this.onUpdate=new function(){this.icon=function(e,i){let n=CFG.r_opath+fixSrc(e);t.setPlaceHolderIcon(),t.setStaticAnimation(Engine.opt(8)),Engine.imgLoader.onload(n,{speed:!0,externalSource:cdnUrl},(t,e)=>{this.beforeOnload(e,t)},t=>{this.afterLoadImage()},()=>{t.fetchError()})},this.x=function(e){isset(t.stasis)&&1===t.stasis&&t.setStasis(0)},this.dir=function(t){this.dir=n[t],this.dir2=n[t]},this.nick=function(e){t.nick=e},this.pet=function(e){t.updatePet(e)},this.wanted=function(e){t.wanted=e},this.whoIsHere=function(e){t.whoIsHere=e,t.whoIsHereGlow&&t.whoIsHereGlow.updateColor(t.whoIsHere)},this.rights=function(e){t.rights=e},this.prof=function(e){t.prof=e},this.lvl=function(e){t.lvl=e},this.stasis=function(e,i,n){t.setStasis(e),t.setStasisEmo(e,n)},this.stasis_incoming_seconds=function(e,i,n){t.setStasisEmo(e,n,!0)}};const C=t=>{m=t};this.getLevel=()=>this.d.lvl,this.getKind=()=>m,this.firstAfterUpdate=()=>{},this.refreshKind=_,this.getCanvasObjectType=()=>this.canvasObjectType,this.manageRefreshKind=w};(g.prototype=Object.create(n.prototype)).constructor=g,t.exports=g},function(t,e){t.exports=function(){let t=null;this.init=()=>{t={}},this.addDynamicLightId=e=>{t[e]=!0},this.checkDynamicLightId=e=>!!t[e],this.removeDynamicLightId=e=>{delete t[e]},this.getArrayOfDynamicLightIds=()=>{let e=[];for(let i in t)e.push(i);return e}}},function(t,e,i){let n=i(1);t.exports={addDebugOptionMenu:function(t,e){if(!CFG.debug)return;let i=t.getId(),a=t.getNick(),s=t.getImg(),r=t.canvasObjectType,o=CFG.r_npath+s;switch(r){case n.HERO:case n.OTHER:o=CFG.r_opath+fixSrc(s);break;case n.NPC:o=CFG.r_npath+s;break;case n.PET:o=CFG.r_ppath+s}let l=cdnUrl+o,c={button:{cls:"menu-item--debug"}};e.push(["Info",function(){mAlert(`\n\t\t\t ${i}<br>\n\t\t\t ${a}<br>\n\t\t\t ${s}<br>\n\t\t\t ${o}<br>\n\t\t\t <a target="_blank" href="${l}">${l}</a>\n\t\t\t`)},c]),e.push(["Copy id",function(){copyClipboard(i)},c]),e.push(["Copy nick",function(){copyClipboard(a)},c]),e.push(["Copy short url",function(){copyClipboard(s)},c]),e.push(["Copy relative url",function(){copyClipboard(o)},c]),e.push(["Copy absolute url",function(){copyClipboard(l)},c]),r==n.NPC&&(e.push(["Copy tpl",function(){copyClipboard(t.getTpl())},c]),e.push(["get_external_properties",function(){console.log(t.getExternalProperties())},c]),e.push(["getData",function(){console.log(t.getData())},c]))}}},function(t,e,i){let n=i(1);t.exports={addOffsetOfEmo:(t,e)=>t.checkEmoExist&&t.checkEmoExist()?e?20:18:0,addOffsetOfKillTimer:(t,e)=>t.checkKillTimer&&t.checkKillTimer()?e?20:25:0,addOffsetOfCharacterTimer:t=>{if(!t.getCanvasObjectType)return 0;const e=n.NPC;return t.getCanvasObjectType()!=e?0:getEngine().interfaceTimerManager.check(e,t.getId())?20:0},addOffsetOfDataDrawNick:t=>t.getDataDrawer&&t.getDataDrawer()?25:0}},function(t,e,i){var n=i(46),a=i(67);let s=i(1),r=i(11),o=i(98),l=i(65);var c=function(){var t=this;this.d={},this.pos=0,this.frame=0,this.onSelfMarginEmo=0,this.canvasObjectType=s.PET,this.overMouse=!1,this.warShadowOpacity=0;let e,i=0;this.actionCounter=0,this.dir="S",this.specialAction=null;let n,c=null,d=new a,h=0,u=!1,p=0,g=0,f={1:[0,-1],2:[1,0],3:[0,1],4:[-1,0]};var m=new Lock(["create","image","master"],(function(){t.setStaticAnimation(Engine.opt(8)),t.createTip(),t.calculatePosition(t.d.isNew),t.updateCollider()}));const v=()=>{n=new l,n.init()};this.calculatePosition=function(t){if(null!=this.d.master){var e=this.d.master,i=this.d.x,n=this.d.y;if(t||!t&&Math.abs(e.d.x-this.d.x)+Math.abs(e.d.y-this.d.y)>1||this.pos){var a=e.d.x+(e.dir==r.W||e.dir==r.E?e.dir==r.E?-1:1:0),s=e.d.y+(e.dir==r.S||e.dir==r.N?e.dir==r.S?-1:1:0);this.pos&&isset(f[this.pos])&&(a=e.d.x+f[this.pos][0],s=e.d.y+f[this.pos][1]),Engine.map.col.check(a,s)&&(a=e.d.x,s=e.d.y),this.d.x=a,this.d.y=s,t&&(this.rx=a,this.ry=s),(i!=this.d.x||this.d.y!=n&&!t)&&this.checkActionIsRunning()&&this.stopAction()}else this.d.afterReload&&isset(e.d.x)&&isset(e.d.y)&&(this.d.x=e.d.x,this.d.y=e.d.y,this.d.afterReload=!1)}},this.checkActionIsRunning=()=>null!=c,this.update=function(e){if(Engine.allInit)if(t.changeWarShadowOpacity(e),this.rx!=this.d.x||this.ry!=this.d.y)this.checkDiff(),this.move(e),this.animate(e);else{if(this.animate(e),this.checkActionIsRunning())return void d.updateAction(t,e);this.frame=0}},this.checkDiff=function(){if(g=Math.abs(this.d.x-this.rx)+Math.abs(this.d.y-this.ry),g>2){g>4&&this.calculatePosition(!0);var t=this.rx-this.d.x,e=this.ry-this.d.y;e>2&&(this.ry=this.d.y+2),e<-2&&(this.ry=this.d.y-2),t>2&&(this.rx=this.d.x+2),t<-2&&(this.rx=this.d.x-2),this.updateCollider()}},this.move=function(e){if(!m.check().length&&e){var i=4.9*e;this.run(i),p+=i,p>=.5&&(t.frame++,p%=.5,t.frame==(t.anim?5:4)&&(t.frame=t.anim?1:0))}},this.run=function(e){this.rx<this.d.x?(this.dir="E",this.rx+=e,u=this.rx>=this.d.x):this.rx>this.d.x&&(this.dir="W",this.rx-=e,u=this.rx<=this.d.x),u&&(this.rx=this.d.x,u=!1),this.ry<this.d.y?(this.dir="S",this.ry+=e,u=this.ry>=this.d.y):this.ry>this.d.y&&(this.dir=r.N,this.ry-=e,u=this.ry<=this.d.y),u&&(this.ry=this.d.y,u=!1),t.updateCollider()},this.clearAnimationAndGw=function(){this.activeFrame=0,h=0},this.animate=function(t){this.frames&&this.frames.length>1&&!IE&&(h+=100*t,this.frames[this.activeFrame].delay<h&&(h-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.setWarShadowAlpha=function(e){e.globalAlpha=t.warShadowOpacity},this.setDefaultAlpha=function(t){t.globalAlpha=1},this.changeWarShadowOpacity=function(t){if(1!=this.warShadowOpacity&&this.imgLoaded){if(Engine.opt(8))return this.warShadowOpacity=1;if(this.warShadowOpacity>1)return this.warShadowOpacity=1;this.warShadowOpacity+=2*t}},this.draw=function(e){if(m.check().length)return;let n=Engine.mapShift.getShift();if(Engine.rajCharacterHide.checkHideObject(this))return;let a=32*this.rx+16-this.fw/2+(isset(this.ofsetX)?this.ofsetX:0)-Engine.map.offset[0]-n[0],s=32*this.ry-this.fh+32-Engine.map.offset[1]-n[1],o=isset(this.dir)?this.dir:"S",l=this.fh,c=Math.round(this.rx)+256*Math.round(this.ry),d=0,h=0,u=!1;if(t.checkActionIsRunning())switch(i){case 0:h=0;break;case 1:h=this.fh;break;case 2:h=2*this.fh;break;case 3:h=3*this.fh}else switch(o){case r.S:h=0;break;case r.W:h=this.fh;break;case r.E:h=2*this.fh;break;case r.N:h=3*this.fh}isset(Engine.map.water[c])&&(d=Engine.map.water[c],s+=d/4>8?0:d,l-=d/4>8?d-32:d,l=0==l?1:l,u=!0),a=Math.round(a),s=Math.round(s);let p=t.frame*t.fw,g=h+t.activeFrame*t.fh*4;t.checkActionIsRunning()?(u&&this.putIntoWater(e,this.sprite,p,g,a,s,this.fw,this.fh),this.staticAnimation,t.setWarShadowAlpha(e),e.drawImage(this.sprite,p,g,this.fw,l,a,s,this.fw,l),t.setDefaultAlpha(e)):this.d.x==this.rx&&this.d.y==this.ry?(this.staticAnimation,u&&this.putIntoWater(e,this.sprite,p,g,a,s,this.fw,this.fh),t.setWarShadowAlpha(e),e.drawImage(this.sprite,p,g,this.fw,l,a,s,this.fw,l),t.setDefaultAlpha(e)):this.sprite&&void 0!==this.activeFrame&&(u&&this.putIntoWater(e,this.sprite,p,g,a,s,this.fw,this.fh),t.setWarShadowAlpha(e),e.drawImage(this.sprite,p,g,this.fw,l,a,s,this.fw,l),t.setDefaultAlpha(e))},this.putIntoWater=function(t,e,i,n,a,s,r,o){t.globalAlpha=.25,t.drawImage(e,i,n,r,o,a,s,r,o),t.globalAlpha=1},this.afterUpdate=function(){m.unlock("create")},this.setStaticAnimation=function(t){IE?this.staticAnimation=!0:this.staticAnimation=t},this.beforeOnload=(e,i,n)=>{var a=new RegExp("-([0-9]+)(a?).gif").exec(n);a||(a=[0,0,""]),this.auxFrames=isNaN(parseInt(a[1]))?0:parseInt(a[1]),this.anim="a"==a[2],this.frames=e.frames,this.activeFrame=0,this.fw=e.hdr.width/(4+t.auxFrames+(t.anim?1:0)),this.fh=e.hdr.height/4,this.sprite=i},this.afterOnload=()=>{m.unlock("image"),this.imgLoaded=!0},this.createActionsDataArrayForOther=t=>{e=null,e=d.createActionsDataArrayForOther(t)},this.onUpdate=new function(){this.outfit=function(e){if(t.actionPossible=!isset(t.outfitSrc)||t.outfitSrc==e,!!(isset(t.outfitSrc)&&t.outfitSrc==e))return;t.outfitSrc=e;let i=CFG.r_ppath+e;Engine.imgLoader.onload(i,{speed:!1,externalSource:cdnUrl},(t,i)=>{this.beforeOnload(i,t,e)},t=>{this.afterOnload()})},this.actions=function(i){let n=i.split("|");e=d.createActionsDataArrayForHero(n,t.pos)},this.action=function(e){if(t.pos=d.getHalfByte(e,0),!Engine.allInit)return;let i=this.findActionIndex(e);null!=i&&this.callAction(i)},this.master=function(e){isset(e.d)&&isset(e.d.x)&&m.unlock("master"),e.d.id&&(t.d.id=e.d.id)}},this.findActionIndex=t=>{if(e){for(let i in e)if(e[i].actionBinWithDir==t)return e[i].actionIndex;return null}},this.getSpecialByRunActionIndex=()=>{if(e)for(let t=0;t<e.length;t++)if(e[t].actionIndex==c)return e[t].special},this.updateCollider=()=>{let e=void 0!==this.leftPosMod?this.leftPosMod:0;this.sprite&&(this.collider={box:[32*t.rx+16-t.fw/2+e,32*t.ry+32-t.fh,32*t.rx+16+t.fw/2+e,32*t.ry+32]})},this.getOrder=function(){return this.ry?this.ry:0},this.createTip=function(){let e="<strong>"+t.d.name+"</strong><br>";if(isset(t.d.elite)&&t.d.elite){let i=null;switch(parseInt(t.d.elite)){case 1:i="elite";break;case 2:i="elite_her";break;case 3:i="elite_leg"}null!==i&&(i=_t(i,null,"pet"),e+='<i class="elite cls-'+t.d.elite+'">'+i+"</i>")}e+=_t("owner %name%",{"%name%":t.d.master.nick},"pet")+"</span>",t.tip=[e,"t_pet"]},this.stopAction=()=>{this.setActiveFrame(0),this.setActionFrame(0),this.setFrame(0),this.setRunActionIndex(null)},this.onmousedown=function(){},this.onhover=function(e,i){t.overMouse=i,getEngine().interface.setDoActionCursor(i)},this.callAction=e=>{this.stopAction(),this.setRunActionIndex(e),d.doAction(t)},this.oncontextmenu=function(i){if(t.d.own){let n=_t("menu_hide",null,"pet"),a=[];if(isset(t.d.quest)&&t.d.quest?a.push([n,t.hideMyPet.bind(this,!0)]):a.push([n,t.hideMyPet]),e)for(let t=0;t<e.length;t++){let i=e[t].name,n=()=>{_g("pet&a="+e[t].actionBin)};a.push([i,n])}for(let e=1;e<=5;e++){if(e==t.pos||5==e&&0==t.pos)continue;let i="";switch(e){case 5:i="menu_comeafter";break;case 1:i="menu_standbehind";break;case 2:i="menu_standright";break;case 3:i="menu_standfront";break;case 4:i="menu_standleft"}i=_t(i,null,"pet"),a.push([i,_g.bind(this,"pet&a="+e)])}o.addDebugOptionMenu(t,a),Engine.interface.showPopupMenu(a,i,!0)}else{let e=[];o.addDebugOptionMenu(t,e),e.length&&Engine.interface.showPopupMenu(e,i,!0)}},this.hideMyPet=function(t){isset(t)?mAlert(_t("are_u_sure",null,"pet"),[{txt:_t("yes"),callback:function(){return _g("pet&a=0"),!0}},{txt:_t("no"),callback:function(){return!0}}]):_g("pet&a=0")},this.getImg=()=>this.d.outfit,this.getId=()=>this.d.id,this.getNick=()=>this.d.name;this.getNDir=()=>this.dir;this.setActionFrame=t=>{i=t},this.setActiveFrame=t=>{this.activeFrame=t},this.setActionCounter=t=>{this.actionCounter=t},this.setDir=t=>{this.dir=t},this.setFrame=t=>{this.frame=t},this.setSpecialAction=t=>{this.specialAction=t},this.setRunActionIndex=t=>{c=t},this.getRunActionIndex=()=>c,this.getAction=()=>this.action,this.getActionFrame=()=>i,this.getActionCounter=()=>this.actionCounter,this.getAnim=()=>this.anim,this.init=()=>{v()},this.removePet=()=>{n.removeAllDynamicLights(),n.removeAllDynamicDirCharacterLights()},this.getObjectDynamicLightManager=()=>n};(c.prototype=Object.create(n.prototype)).constructor=c,t.exports=c},function(t,e,i){var n=i(0);t.exports=function(t){var e=this;this.wnd=null,this.nick=null;this.init=function(){e.initWindow(),e.initAllText(),e.initAllMuteBtns(),e.initUnmuteBtn(),e.initScroll()},this.initWindow=function(){Engine.windowManager.add({content:n.get("mc-addon"),title:"MC Addon",nameWindow:Engine.windowsData.name.MC_ADDON,objParent:this,nameRefInParent:"wnd",managePosition:{x:"251",y:"65"},addClass:"mc-addon-window",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.updatePos()},this.initAllText=function(){for(var t=e.wnd.$.find(".all-texts"),i=0;i<14;i++){var a=n.get("mc-text"),s=_t(i,null,"mc-addon");t.append(a),a.find(".label-text").html(s).tip(s),e.createButton("send","green small",a.find(".send"),(function(){var t=$(this).find(".label").parent().parent().parent().find(".label-text").html();_g("console&custom=.reminder"+esc(' "'+e.nick.replace(" ","_")+'" "'+t+'"'))}))}},this.initAllMuteBtns=function(){for(var t=[1,6,12,18,24,36,48,60,72],i=e.wnd.$.find(".times-of-mute"),n=0;n<t.length;n++){var a=t[n];e.createButton(a,"green small",i,(function(){let t=$(this).find(".label").html();_g("console&custom=.mute"+esc(" "+e.nick.replace(" ","_")+" "+t))}))}},this.initUnmuteBtn=function(){e.createButton("Unmute","green small",e.wnd.$.find(".unmute"),(function(){_g("console&custom=.unmute"+esc(" "+e.nick.replace(" ","_")))}))},this.createButton=function(t,e,i,a){var s=n.get("button").addClass(e);s.find(".label").html(t),i.append(s),s.click(a)},this.update=function(t){e.wnd.$.find(".nick-header").html(t),e.nick=t.replace(/ /gi,"_")},this.initScroll=function(){e.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0}),$(".scroll-wrapper",e.wnd.$).trigger("update")},this.close=function(){e.wnd.remove(),Engine.mcAddon=!1}}},function(t,e,i){var n=i(0),a=i(0);t.exports=function(t){var e=this;this.wnd=null,this.nick=t,this.init=function(){e.initWindow(),e.createAllButtons(),e.initCos(),e.initCheckboxes(),e.acceptBut()},this.initWindow=function(){Engine.windowManager.add({content:n.get("chat-ban"),nameWindow:Engine.windowsData.name.SMC_ADDON,nameRefInParent:"wnd",objParent:this,managePosition:{x:"696",y:"61"},title:"SMC Addon",onclose:()=>{e.close()}}),this.wnd.addToAlertLayer(),this.wnd.updatePos()},this.close=function(){e.wnd.remove(),Engine.smcAddon=!1},this.createAllButtons=function(){var t=[1,3,7,14,30];for(var i in t)e.createButton(t[i]);e.createButton()},this.createButton=function(t){var i="banday_"+(t||"custom"),n=a.get("banday-row"),s=n.find(".nr");if(n.find(".checkbox").attr("id",i),t)s.attr("for","banday_"+t).html(t);else{s.remove();var r=$("<input>").attr({id:"custom_banday_value",for:"banday_custom"}).addClass("default");n.find(".table-wrapper").append(r)}e.wnd.$.find(".days").append(n)},this.acceptBut=function(){var i=a.get("button");e.wnd.$.find(".ban-btn").append(i),i.find(".label").html("OK"),i.click((function(){var i=e.wnd.$.find(".active"),n=i.length?i.attr("id").substr(7):null,a="custom"==n?$("#custom_banday_value").val():n;!isNaN(parseInt(a))&&$(".ban-reason").val().length>=10?_g("gm&a=ban&nick="+esc(t)+"&days="+a+"&reason="+esc($("#banday_reason").val()),(function(){e.close()})):mAlert(_t("banday_wrong_values_error"))}))},this.initCos=function(){e.wnd.$.find(".question").html(_t("bandays_amount for %name%",{"%name%":e.nick})),e.wnd.$.find(".ban-reason").attr("id","banday_reason")},this.initCheckboxes=function(){e.wnd.$.find(".banday-row").on("click",(function(){$(".banday-row").find(".checkbox").removeClass("active"),$(this).find(".checkbox").addClass("active"),$(this).find("input").focus()}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),a=i(15),s=i(36);e.default=class{constructor(t){this.playerData=t,this.allItemsId=[],this.initWindow()}setItems(t){if(t.own!=this.playerData.id)return;const e=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.SHOW_EQ_ITEM_VIEW)[0][0];this.contentEl.querySelector(".other-eq-slot.st-"+t._st).appendChild(e),e.addEventListener("contextmenu",(e,i)=>{t.createOptionMenu(getE(e,i))})}setInfo(){const{id:t,nick:e,lvl:i,prof:n,account:a}=this.playerData,s=this.contentEl.querySelector(".player-info");s.appendChild(this.getLinkedPlayerName(e,t,a)),0!=i&&s.append(` (${i}${n})`)}getLinkedPlayerName(t,e,i){const n=document.createElement("span");return n.classList.add("character-name"),n.textContent=t,n.addEventListener("click",e=>{e.stopPropagation(),Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(t)}),n.addEventListener("contextmenu",t=>{this.getEngine().others.createOtherContextMenu(t,Object.assign({charId:this.playerData.id,accountId:this.playerData.account},this.playerData),[s.SHOW_EQ])}),n}setAvatar(t){if(!t)return;const e=CFG.a_opath+t,i=document.createElement("div");i.classList.add("avatar-icon"),createImgStyle($(i),e);this.contentEl.querySelector(".prof-image").appendChild(i)}initWindow(){this.contentEl=n.get("show-eq")[0],this.getEngine().windowManager.add({content:this.contentEl,nameWindow:this.getEngine().windowsData.name.SHOW_EQ,title:_t("other_eq"),objParent:this,nameRefInParent:"wnd",type:Engine.windowsData.type.TRANSPARENT,addClass:"showeq-window showeq-"+this.playerData.id,managePosition:{position:Engine.windowsData.position.CENTER_OR_SAVE_IN_STORAGE},onclose:()=>this.close()}),this.wnd.addToAlertLayer(),this.wnd.updatePos(),this.wnd.setWndOnPeak(!0)}parseItemsData(t,e){for(let i in t)t[i].loc="otherEqItem",t[i].own=e,t[i]._st=t[i].st,t[i].st=a.ST.IN_BAG,this.allItemsId.push(parseInt(i))}update(t){const e={};Object.keys(t).map(i=>{e[i+"-showeq"]=t[i]});const{id:i,nick:n,prof:a,icon:s,lvl:r}=this.playerData;this.parseItemsData(e,i),Object.keys(e).length&&this.getEngine().items.updateDATA(e),this.setInfo(),this.setAvatar(s),this.updateEqInfo()}updateEqInfo(){const t=this.contentEl.querySelector(".info-icon");$(t).tip(_t("show_eq_info %date%",{"%date%":getTimeStampEv()}))}close(){this.wnd.remove(),this.getEngine().items.deleteMessItemsByLocAndOwnId("otherEqItem",this.playerData.id),this.getEngine().showEqManager.removeWindow(this.playerData.id)}getEngine(){return Engine}}},function(t,e){t.exports=function(t,e){this.fw=40,this.fh=52,this.margin=5,this.color=e,this.collider=null;this.update=function(){this.updatePos()},this.updatePos=function(){var e=Engine.others.getById(t);this.rx=e.rx,this.ry=e.ry,this.fw=e.fw+this.margin,this.fh=e.fh+this.margin},this.draw=function(t){var e=32*this.rx+16-this.fw/2-Engine.map.offset[0],i=32*this.ry-this.fh+34-Engine.map.offset[1];t.lineWidth=3,t.strokeStyle=this.color,t.strokeRect(e,i,this.fw,this.fh)},this.onclick=function(t){},this.getOrder=function(){return this.ry},this.init=function(){this.updatePos()}}},function(t,e,i){let n=i(27);t.exports=function(){let t,e;const i=e=>{t=e},a=t=>{e=t},s=()=>{let t=c();t+=1,t=t>5?1:t,r(t),l(t)},r=e=>{t.attr("data-opacity-lvl",e)},o=t=>{let i=n.getOpacityWindow(e);null==i&&(i=t,l(i)),r(i)},l=t=>{n.setOpacityWindow(t,e)},c=()=>parseInt(t.attr("data-opacity-lvl"));this.init=(t,e,n)=>{i(n),a(e)},this.setManageOpacity=e=>{let i=$("<div>",{class:"increase-opacity"});t.append(i),i.tip(_t("window-opacity")),i.click(s),o(e)}}},function(t,e,i){var n=i(0);i(8);t.exports=new function(){var t=this,e=!1,i=0,a=!0,s=!1,r=!1,o=!1;this.source,this.owners=null,this.states=null,this.itemsDecision={},this.wnd=null,this.closeInterval=null,this.statesOfLoot=null,this.colorized=!1,this.init=function(){this.initWnd(),this.initStates(),this.initAcceptButton(),this.initFetch()},this.initAcceptButton=function(){var e=n.get("button").addClass("green small");e.find(".label").text(_t("loot_now",null,"loot")),e.click((function(){t.acceptLoot()})),this.wnd.$.find(".accept-button").append(e)},this.initWnd=function(){Engine.windowManager.add({content:n.get("loot-window"),title:_t("loots_header"),nameWindow:Engine.windowsData.name.LOOT,objParent:this,nameRefInParent:"wnd",managePosition:{position:Engine.windowsData.position.CENTER_OR_SAVE_IN_STORAGE},closeable:!1,onclose:()=>{}})},this.acceptLoot=function(){t.finalize()},this.initStates=function(){this.states=[{key:"not",text:_t("dont_want2",null,"loot"),button:"red"},{key:"want",text:_t("want",null,"loot"),button:"green"},{key:"must",text:_t("really_want2",null,"loot"),button:"orange"}]},this.getKeyFromState=function(t){return this.states[t].key},this.initFetch=function(){Engine.items.fetch(Engine.itemsFetchData.NEW_NORMAL_LOOT_ITEM,t.newLootItem),Engine.items.fetch(Engine.itemsFetchData.NEW_PERSONAL_LOOT_ITEM,t.newLootItem)},this.newLootItem=function(e,a){var s="k"==e.loc,r=(s&&(e.own,Engine.hero.id),n.get("loot-item-wrapper")),l=r.find(".text-info"),c=e;r.addClass("loot-item-wrapper-"+e.id),t.colorized&&t.wnd.$.find(".loot-window").addClass("colorized "+e.itemType);var d=Engine.items.createViewIcon(e.id,Engine.itemsViewData.LOOT_ITEM_VIEW)[0];if(r.find(".slot").append(d),t.bagAlert(),s){var h=t.getNameAndAvatar(c.own),u=n.get("loot-icon").addClass("id-personal-avatar-"+c.own);createImgStyle(u,h.imgUrl),i=1,l.addClass("id-personal-nick-"+c.own),l.html(h.name),l.tipOverflow(),c.own==Engine.hero.d.id&&r.addClass("yours"),r.find(".button-holder").html(u),r.addClass("avatar-loot")}else{i++,t.choiceButton(c,r);var p=t.statesOfLoot[e.id];t.itemsDecision[e.id]=t.getKeyFromState(p),l.html(t.states[0].text),t.setViewBySorce(r),isset(e._cachedStats.reqp)&&-1==e._cachedStats.reqp.indexOf(Engine.hero.d.prof)&&r.addClass("cant-must")}(t.bagAlert(),r.attr("loot-id",e.id),t.appendToItemsWrapper(r),d.contextmenu((function(t,i){e.createOptionMenu(getE(t,i),!1,{canPreview:!0})})),l[0].scrollWidth>l.innerWidth()&&l.tip(h.name),s||t.setStateOnOneItemWrapper(e.id),a)&&(o=!0,Engine.chestAnimation&&Engine.chestAnimation.animation||t.wnd.show(),t.itemsIsMoreThanOne()?t.lootCenter():t.wnd.updatePos(),t.wnd.updatePos(),t.wnd.setWndOnPeak(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,12),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,12))},this.lootCenter=()=>{let t=this.wnd.$.width()/2,e=this.wnd.$.height()/2;t<0&&(t=0),e<0&&(e=0),this.wnd.setContentPos(t+"px",e+"px")},this.itemsIsMoreThanOne=()=>Object.keys(this.itemsDecision).length>1,this.appendToItemsWrapper=e=>{let i=t.wnd.$.find(".loot-item-wrapper");if(i.length){let n=!1,a=parseInt(e.attr("loot-id")),s=t.wnd.$.find(".loot-item-wrapper").length;i.each((function(t){let i=parseInt($(this).attr("loot-id"));return a>i?t+1==s?($(this).after(e),n=!0,!1):void 0:($(this).before(e),n=!0,!1)})),n||console.warn(t.wnd.$.find(".loot-item-wrapper"))}else t.wnd.$.find(".items-wrapper").append(e)},this.newMsgSound=function(){var t=Engine.soundManager;t.getStateSoundNotifById(0)||t.createNotifSound(0)},this.getNameAndAvatar=function(t){if(Engine.hero.d.id==t)return{name:Engine.hero.d.nick,imgUrl:CFG.a_opath+Engine.hero.d.img};var e=Engine.others.getById(t);return e?{name:e.d.nick,imgUrl:CFG.a_opath+e.d.icon}:Engine.loots.owners[t]?{name:Engine.loots.owners[t].nick,imgUrl:CFG.a_opath+Engine.loots.owners[t].icon}:{name:"",imgUrl:"/img/def-npc.gif"}},this.choiceButton=function(e,i){t.createOneChoiceButton(i,1),t.createOneChoiceButton(i,0),s&&(i.find(".button-holder").addClass("is-party"),t.createOneChoiceButton(i,2)),i.find(".button").on("click",(function(){t.onChooseButtonClick($(this),e.id)}))},this.createOneChoiceButton=function(e,i){let a=n.get("button"),s=0==i?"green":"red",r=0===i?" [Esc]":"";s+=" "+t.states[i].key,a.addClass(s+" no-hover"),a.data("state",i),a.find(".label").addClass(t.states[i].key),a.tip(t.states[i].text+r),e.find(".button-holder").append(a)},this.onChooseButtonClick=function(e,i){var n=e.data("state"),a=t.states[n];if(t.checkCanSendLootRequest()){var s=this.getChangeDecisionObj([[i,a.key]]),r="loot"+t.lootUrl(s)+"&final=0";_g(r)}},this.setViewBySorce=t=>{switch(this.source){case"lootbox":t.addClass("lootbox-source");break;default:t.removeClass("lootbox-source")}},this.setSource=t=>{this.source=t},this.initUpdate=function(e,i){a=!0,r=!1,t.setGroupped(e),i.source&&this.setSource(i.source),this.colorized=Engine.chestAnimation&&!Engine.chestAnimation.animation,t.wnd.$.css("display",o?"block":"none"),t.wnd.addToAlertLayer(),Engine.hotKeys.replacehotAcceptLootBtnsNames(),t.wnd.updatePos(),t.wnd.setWndOnPeak(!0),t.owners=i.owners?i.owners:null,t.updateFreeBagSlots(),setTimeout((function(){t.groupLootSound()}),5e3)},this.updateFreeBagSlots=function(){const e=Engine.heroEquipment.getFreeSlots();t.wnd.$.find(".bag-left").html("<span>"+e+" m</span>").data("free",e)},this.groupLootSound=function(){var e=Engine.soundManager;Engine.party&&!e.getStateSoundNotifById(5)&&t.wnd.$.is(":visible")&&e.createNotifSound(7)},this.setGroupped=function(t){s=t>1},this.getGroupped=function(){return s},this.getChangeDecisionObj=function(e){var i={};for(var n in t.itemsDecision){for(var a=!1,s=0;s<e.length;s++){var r=e[s][0],o=e[s][1];if(n==r){i[n]=o,a=!0;break}}a||(i[n]=t.itemsDecision[n])}return i},this.lootUrl=function(e){var i={want:[],not:[],must:[]};let n=e||t.itemsDecision;for(var a in n)i[n[a]].push(a);return"&want="+i.want.join(",")+"&not="+i.not.join(",")+"&must="+i.must.join(",")},this.refuseAllLoot=function(){let e={};for(var i in t.itemsDecision)e[i]="not";this.setLootItems(e)},this.setLootItems=function(e){t.checkCanSendLootRequest()&&_g("loot"+t.lootUrl(e)+"&final=0")},this.finalize=function(e){if(!r){r=!0,a=!1;var i=e||t.itemsDecision,n=t.lootUrl(i);_g("loot"+n+"&final=1",(function(e){var i=new URLSearchParams(n);""===i.get("want")&&""===i.get("not")&&""===i.get("must")&&console.log(e),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,12),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,12),e.w?(r=!1,a=!0):t.deleteItemsAndCloseLootWindow()}))}},this.bagAlert=function(){t.wnd.$.find(".bag-left").data("free")<i&&!e&&Engine.settings&&!Engine.opt(21)&&(e=!0,message(_t("bag_alert")))},this.itemsDecisionExist=function(){return 0!=lengthObject(t.itemsDecision)},this.checkCanSendLootRequest=function(){return a&&t.itemsDecisionExist()},this.update=function(e,i){this.setStatesOfLoot(e.states),isset(e.init)&&e.init&&t.initUpdate(e.init,e),this.manageCloseInterval(e.endTs,i)},this.resetWindowClasses=function(){t.wnd.$.find(".loot-window").attr("class","loot-window")},this.setStatesOfLoot=function(e){for(var i in t.statesOfLoot={},e){t.statesOfLoot[i]=e[i];const n=t.wnd.$.find(".loot-item-wrapper-"+i);n.length&&!n.hasClass("avatar-loot")&&t.setStateOnOneItemWrapper(i)}},this.setStateOnOneItemWrapper=function(e){var i=t.wnd.$.find(".loot-item-wrapper-"+e),n=i.find(".button"),a=t.statesOfLoot[e],s=t.states[a],r=s.key,o=s.text;t.itemsDecision[e]=r,i.attr("data-state",r),i.find(".text-info").html(o),n.removeClass("red green"),n.each((function(){var t=$(this).hasClass(r)?"green":"red";$(this).addClass(t)}))},this.manageCloseInterval=function(e,i){if(t.closeInterval)return;const n=e-(isset(i.ev)?i.ev:Engine.getEv());t.setTime(Math.floor(n));let a=n;t.closeInterval=setInterval((function(){a--,t.setTime(Math.floor(a)),a<1&&t.deleteItemsAndCloseLootWindow()}),1e3)},this.setTime=function(e){t.wnd.$.find(".time-left").html("<span>"+e+" s</span>")},this.clearIntervalIfExist=function(){t.closeInterval&&(clearInterval(t.closeInterval),t.closeInterval=null)},this.deleteItemsAndCloseLootWindow=function(){r=!0,Engine.items.deleteUnnecessaryItems(),t.close()},this.close=function(){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,12),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,12),t.clearIntervalIfExist(),t.resetWindowClasses(),Engine.chestAnimation&&(Engine.chestAnimation=null),t.wnd.$.find(".items-wrapper").html(""),t.itemsDecision={},t.wnd.hide(),t.wnd.detachFromLayer(),e=!1,i=0,o=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);const a={};e.default=class{constructor(t,e){this.cards=t,this.opened=!1,this.options=Object.assign(Object.assign({},a),e),this.createContent(),this.createCards()}createContent(){void 0!==this.options.tabsEl.navEl?(this.navEl=this.options.tabsEl.navEl,this.contentsEl=this.options.tabsEl.contentsEl):(this.navEl=document.createElement("div"),this.contentsEl=document.createElement("div"),this.options.tabsEl.appendChild(this.navEl),this.options.tabsEl.appendChild(this.contentsEl)),this.navEl.classList.add("tabs-nav"),this.contentsEl.classList.add("tabs-contents")}createCards(){for(const t in this.cards)this.createOneCard(t,this.cards[t])}createOneCard(t,e){const i=n.get("card")[0],a=i.querySelector(".label");i.classList.add(t+"-tab"),a.innerHTML=e.name,isset(e.disabled)&&e.disabled&&(i.classList.add("disabled"),e.disabledTip&&$(i).tip(e.disabledTip)),this.navEl.appendChild(i);let s=document.createElement("div");s.classList.add(t+"-content"),this.contentsEl.appendChild(s),i.addEventListener("click",()=>{i.classList.contains("disabled")||(e.initAction?e.initAction():(this.activateCard(t),e.afterShowFn&&e.afterShowFn()))})}activateCard(t){const e=this.navEl.querySelector(`.${t}-tab`),i=this.contentsEl.querySelector(`.${t}-content`);e.classList.add("active"),i.classList.add("active");const n=siblings(e),a=siblings(i);n.forEach(t=>t.classList.remove("active")),a.forEach(t=>t.classList.remove("active"))}checkRequires(){for(const t in this.cards){const e=this.cards[t];if(isset(e.disabled)&&e.disabled)continue;const i=this.navEl.querySelector(`.${t}-tab`);isset(e.requireLvl)&&e.requireLvl&&this.getEngine().hero.d.lvl<e.requireLvl?(i.classList.add("disabled"),$(i).tip(this.tLang("need__lvl","default",{"%val%":e.requireLvl}))):(i.classList.remove("disabled"),$(i).tip(""))}}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default"):""}}},function(t,e,i){var n=i(0);t.exports=function(t,e,i){var a,s,r,o;this.update=function(t){this.updatePage(t),this.setClanName(),this.hideOrShowEditBut(),this.updateScroll()},this.updatePage=function(i){if(i)o=deletePositionFixed(i.official);else{var n="priv-page"==e?"info":"official";o=t.getProp(n)}const s=parseClanBB(o);a.find(".page-content").html(s),this.imagesOnLoad(this.updateScroll)},this.imagesOnLoad=t=>{let i=a.parent().find(".clan-"+e+"-content .page-content img"),n=0,s=i.length;0!==s?i.on("load",()=>{++n===s&&t()}):t()},this.hideOrShowEditBut=function(){if("clan"==i){var t="priv-page"==e?"priv":"official",n=this["allow"+t+"Edit"]();s.find(".clan-"+t+"-page-content").find(".edit-page-but").css("display",n?"block":"none")}},this.allowprivEdit=function(){return 32&t.getProp("myrank")},this.allowofficialEdit=function(){return 64&t.getProp("myrank")},this.updateScroll=function(){$(".scroll-wrapper",a).trigger("update")},this.init=function(){this.initWindow(),this.initContent(),this.initEditPageBut()},this.initWindow=function(){var e="clan"==i?1:0,n=[["showcase",t.getShowcaseWnd().$],["clan",t.wnd.$]];r=n[e][0],s=n[e][1]},this.initContent=function(){if((a=n.get("clan-page-content")).addClass("clan-"+e+"-content"),s.find(".card-content").append(a),$(".scroll-wrapper",a).addScrollBar({track:!0}),"official-page"==e){var i=n.get("clan-banner-name");a.find(".clan-banner-name").remove(),i.find(".edit-logo-but").html(""),t.createEditLogoBut(),a.find(".clan-page-header").prepend(i),a.find(".clan-desc").text(_t("clan_desc",null,"clan"))}},this.setClanName=function(){var e=t.getProp("name");a.find(".clan-page-header .clan-name").text(e)},this.showOtherClanOfficial=function(){var i=t.getShowcaseWnd().$.find(".card");t.showChooseCard(r,"clan-"+e),i.removeClass("active"),i.eq(0).addClass("active")},this.initEditPageBut=function(){if("clan"==i){var e=n.get("button").addClass("small green");a.find(".edit-page-but").append(e),e.tip(t.tLang("redit_td")),e.find(".label").html(t.tLang("redit_td")),this.butClick(e)}},this.butClick=function(i){i.click((function(){t.showChooseCard(r,"clan-edit-"+e),"official-page"==e?t.updateEditOfficialPage(o):t.updateEditPrivPage(o)}))}}},function(t,e,i){var n=i(46),a=function(){var t=this;this.enabled=!0,this.d={},this.collider={},this.img=null,this.radians=0,this.parent=null,this.objParent=null,this.typeParent=null,this.alwaysDraw=!0,this.getOrder=function(){return 1e3};const e=()=>{let t;return t=getEngine().rajTracking.checkParent()?getEngine().rajTracking.getParent():Engine.hero,t};this.getRadians=function(t){let i=e();return Math.atan2(parseInt(t[2])-i.ry,parseInt(t[1])-i.rx)},this.update=function(i){var n=t.getPos();if(!n)return void Engine.targets.deleteArrow(t.id);let a=e();var s=a.rx-parseInt(n[1]),r=a.ry-parseInt(n[2]),o=Math.max(Math.abs(s),Math.abs(r)),l=Math.sqrt(s*s+r*r),c=Math.min(99,16*l),d=this.setFade(l);o?(s=Math.round(c*s/o),r=Math.round(c*r/o)):(s=0,r=0),t.opacity=d>0?Math.min(1,d):1,t.radians=t.getRadians(n),t.enabled=d>0,t.posX=32*(a.rx-Engine.map.offset[0]/32)-s,t.posY=32*(a.ry-Engine.map.offset[1]/32)-r,t.updateCollider()},this.setFade=t=>{var e=Math.min(130,32*t)-130+80;return e>=80?1:e<=0?0:e/80},this.getPos=function(){var e;if(t.parent)switch(t.typeParent){case"Npc":if(!Engine.npcs.getById(t.objParent.d.id))return!1;e=["?",t.objParent.rx,t.objParent.ry];break;case"Other":if(!Engine.others.getById(t.objParent.d.id))return!1;e=["?",t.objParent.rx,t.objParent.ry];break;case"Item":if(!Engine.items.getItemById(t.objParent.id))return!1;e=["?",t.objParent.x,t.objParent.y];break;case"TRACKING_ARROW":case"SRAJ_TRACKING_ARROW":e=["?",t.objParent.x,t.objParent.y];break;default:return console.warn("[Arrow.js, getPos] buug"),!1}else e=["?",0,0];return e},this.updateCollider=function(){this.collider={box:[Engine.map.offset[0]+t.posX+12-t.fw/2,Engine.map.offset[1]+t.posY+24-t.fh,Engine.map.offset[0]+t.posX+12+t.fw/2,Engine.map.offset[1]+t.posY+24]}},this.draw=function(t){this.enabled&&(t.globalAlpha=this.opacity,t.save(),t.translate(this.posX,this.posY),t.translate(this.fw/2,this.fh/2),t.rotate(this.radians),this.img&&t.drawImage(this.img,-this.fw/2,-this.fh/2),t.restore(),t.globalAlpha=1)},this.afterUpdate=function(){if(!t.img){let e=t.src?this.src:"/img/qt-arrow.png";Engine.imgLoader.onload(e,!1,!1,t=>{this.fh=24,this.fw=24,this.img=t})}t.updateCollider()},this.onUpdate=new function(){this.opacity=function(e){t.opacity=e},this.posX=function(e){t.posX=e},this.posY=function(e){t.posY=e},this.enabled=function(e){t.enabled=e},this.bgX=function(e){t.bgX=e},this.tip=function(t){this.tip=[""+parseBasicBB(t)]},this.radians=function(e){t.radians=e}}};a.prototype=Object.create(n.prototype),t.exports=a},function(t,e,i){var n=i(0),a=i(18);t.exports=function(){var t=this,e=[_t("for_today",null,"staminaShop"),_t("for_week",null,"staminaShop"),_t("for_30days",null,"staminaShop")];this.init=function(){this.initWindow(),this.initButs(),this.initLabels(),this.initBottomPanel()},this.initBottomPanel=function(){var e=n.get("button").addClass("purple small"),i=n.get("button").addClass("green small");e.find(".label").html(_t("buy_sl",null,"shop")),i.find(".label").html(_t("close",null,"shop")),t.wnd.$.find(".buy-sl-btn").append(e),t.wnd.$.find(".close-btn").append(i),e.click((function(){Engine.draconiteShop?Engine.draconiteShop.close():(Engine.draconiteShop=new a,Engine.draconiteShop.open())})),i.click(t.close),t.wnd.$.find(".sl-label").html(_t("low_sl",null,"shop"))},this.initWindow=function(){Engine.windowManager.add({content:n.get("stamina-shop"),nameWindow:Engine.windowsData.name.STAMINA_SHOP,nameRefInParent:"wnd",objParent:this,title:_t("premium_item_2",null,"premium_panel"),onclose:()=>{t.close()}}),Engine.lock.add("staminaShop"),this.wnd.addToAlertLayer(),this.wnd.center()},this.initHeader=function(){var t=_t("stamina_renew_4h",null,"static");this.wnd.$.find(".header").html(t)},this.initButs=function(){var e=_t("increase"),i=_t("decrease");this.addControll(e,".one-day>.but",(function(){t.howStamina(1,!0)})).addClass("small purple"),this.addControll(e,".one-week>.but",(function(){t.howStamina(7,!0)})).addClass("small purple"),this.addControll(e,".one-month>.but",(function(){t.howStamina(30,!0)})).addClass("small purple"),this.addControll(i,".one-day>.but",(function(){t.howStamina(1)})).addClass("small purple"),this.addControll(i,".one-week>.but",(function(){t.howStamina(7)})).addClass("small purple"),this.addControll(i,".one-month>.but",(function(){t.howStamina(30)})).addClass("small purple")},this.initLabels=function(){var i=this.wnd.$;t.updateDescription(),i.find(".one-day>.info-label").html(e[0]),i.find(".one-week>.info-label").html(e[1]),i.find(".one-month>.info-label").html(e[2])},this.updateDescription=function(t,e){var i=t||Engine.hero.d.ttl_end,n=isset(e)?e:Engine.hero.d.ttl_del,a=this.wnd.$.find(".description1");if(!i||i&&i<ts()/1e3)a.css("display","none");else{a.css("display","block");var s=0==n?_t("stamina_increase"):_t("stamina_decrease");a.html(s+" "+ut_fulltime(i))}},this.howStamina=function(t,e){var i=[_t("stamina_shop choosen_option",null,"default"),_t("stamina_shop_sure",null,"default"),_t("stamina_buy_info_increase",null,"default"),_t("stamina_buy_info-decrease",null,"default")],n={"%state%":e?_t("add"):_t("sub")},a={1:_t("for_today_desc",n,"static"),7:_t("for_week_desc",n,"static"),30:_t("for_30days_desc",n,"static")};askAlert({re:"creditshop&ttl_days="+t+"&ttl_del="+(e?"0":"1"),m:"yesno2",q:i[0]+"<br/><br/>"+a[t]+"<br/><br/>"+(e?i[2]:i[3])+"<br/><br/>"+i[1]})},this.addControll=function(e,i,a){var s=n.get("button");return a&&s.click(a.bind(t)),s.find(".label").html(e),this.wnd.$.find(i).append(s),s},this.hide=function(){t.close()},this.close=function(){t.wnd.remove(),Engine.lock.remove("staminaShop"),Engine.staminaShop=!1}}},function(t,e,i){let n=i(0),a=i(29);t.exports=function(){this.itemId=null,this.ttl=null,this.active=null,this.canvsCharacterWrapperIdArray=[],this.init=t=>{this.initWindow(t),this.initButtons()},this.initButtons=()=>{let t=n.get("button").addClass("green disable small"),e=n.get("button").addClass("green small");this.wnd.$.find(".save-button").append(t),this.wnd.$.find(".cancel-button").append(e),t.find(".label").html(_t("accept",null,"trade")),e.find(".label").html(_t("cancel")),t.on("click",()=>{this.acceptAlert()}),e.on("click",()=>{this.close()})},this.acceptAlert=()=>{var t=_t("one-choose");mAlert(t,[{txt:_t("accept",null,"trade"),callback:()=>(console.log(this.active),_g("moveitem&st=2&id="+this.itemId+"&outfit_id="+this.active,()=>{this.close()}),!0)},{txt:_t("cancel"),callback:function(){return!0}}])},this.update=t=>{this.itemId=t.item_id,this.ttl=t.outfitsTTL;for(let e in t.outfits)this.createOutfits(t.outfits[e],e);this.wnd.center()},this.createOutfits=(t,e)=>{let i=n.get("choose-outfit-wrapper"),a=$("<span>").html(t.name),s=$("<div>").addClass("gender gender-"+t.gender),r=$("<div>");s.html({1:"&#9794;",2:"&#9792;"}[t.gender]),r.append(a),r.append(s),i.find(".outfit-name").html(r),this.setImage(i,t.img),this.wnd.$.find(".all-outfits").append(i),i.click(()=>{this.wnd.$.find(".choose-outfit-wrapper").removeClass("active"),this.wnd.$.find(".save-button").find(".button").removeClass("disable"),i.addClass("active"),this.active=e})},this.setImage=(t,e)=>{let i=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:a.drawSystem.PLAYER_OUTFIT,path:e}),n=i.getId(),s=$(i.getCanvas());this.canvsCharacterWrapperIdArray.push(n),s.addClass("outfit"),t.append(s)},this.initWindow=t=>{let e={content:n.get("choose-outfit"),nameWindow:Engine.windowsData.name.CHOOSE_OUTFIT,nameRefInParent:"wnd",objParent:this,addClass:"choose-outfit-window",onclose:()=>{this.close()}};t?(e.type=Engine.windowsData.type.TRANSPARENT,e.title=_t("preview",null,"shop")):e.title=_t("choose_outfit"),Engine.windowManager.add(e),this.wnd.addToAlertLayer()},this.removeAllCanvasCharacterWprapper=()=>{for(let t=0;t<this.canvsCharacterWrapperIdArray.length;t++){let e=this.canvsCharacterWrapperIdArray[t];Engine.canvasCharacterWrapperManager.removeCharacter(e)}},this.close=()=>{this.removeAllCanvasCharacterWprapper(),this.wnd.remove(),Engine.chooseOutfit=null}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e=this,i=[],a=null,s=null;this.itemId,this.data={},this.wnd=null,e.scale=null,this.init=function(){this.initWindow(),this.modifyContent(),this.initSearch(),this.initScroll()},this.initWindow=function(){t=n.get("divide-panel").addClass("tp-scroll"),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.TP_SCROLL,nameRefInParent:"wnd",objParent:this,title:_t("kcs_set"),onclose:()=>{e.close()}}),this.wnd.addToAlertLayer(),this.wnd.center()},this.updateScroll=function(){$(".scroll-wrapper",e.wnd.$).trigger("update")},this.initScroll=function(){e.wnd.$.find(".left-column").find(".scroll-wrapper").addScrollBar({track:!0})},this.initSearch=function(){var t=this.wnd.$.find(".search-item"),i=this.wnd.$.find(".search-x");t.keyup((function(){var t=$(this).val(),i=e.wnd.$.find(".divide-list-group");""==t?i.css("display","block"):i.each((function(){var e=$(this).find(".label").html().toLowerCase().search(t.toLowerCase())>-1?"block":"none";$(this).css("display",e)})),e.updateScroll()})),t.attr("placeholder",_t("search")),i.on("click",(function(){t.val("").blur().trigger("keyup")}))},this.update=function(t){this.itemId=t.item_id,this.data=t.targets;const e=[];for(const t in this.data){const i=this.data[t].n,a=n.get("divide-list-group").addClass("city-"+t);a.find(".label").text(i),a.on("click",()=>this.onClickEvent(t)),e.push(a)}this.appendCityToWrapper(e),this.updateScroll(),this.openCurrentLocation()},this.appendCityToWrapper=function(t){if(t.length>0){t.sort((function(t,e){var i=t.find(".label").text().toLowerCase()[0],n=e.find(".label").text().toLowerCase()[0];return i<n?-1:i>n}));for(var e=this.wnd.$.find(".left-scroll").find(".scroll-pane"),i=0;i<t.length;i++)e.append(t[i])}},this.modifyContent=function(){var t=$("<div>").addClass("mini-map-wrapper"),i=$("<div>").addClass("mini-map-positioner");t.append(i),e.wnd.$.find(".right-scroll").find(".scroll-pane").append(t);var r=$("<div>").addClass("city-name");e.wnd.$.find(".left-column-header").html(_t("loc")),e.wnd.$.find(".right-column-header").append(r);var o=$("<div>").addClass("city-buffer-wrapper"),l=$("<div>").addClass("city-buffer");o.append(l),e.wnd.$.find(".right-column").append(o);var c=n.get("button").addClass("set-tp-stone small green disable");c.find(".label").html(_t("set_tp")),e.wnd.$.find(".bottom-part").append(c),c.click((function(){const[t,i]=s;_g("moveitem&st=2&id="+e.itemId+"&town_id="+a+"&town_x="+t+"&town_y="+i,(function(){e.close()}))}))},this.cordEvents=function(t,i,n){t.hover((function(){e.wnd.$.find(".cord-"+n).addClass("hover")}),(function(){e.wnd.$.find(".cord-"+n).removeClass("hover")})),t.click((function(a){e.wnd.$.find(".cords").removeClass("active"),e.wnd.$.find(".cord-"+n).addClass("active"),e.wnd.$.find(".one-item-on-divide-list").removeClass("active"),e.wnd.$.find(".city-"+i).find(".cord-list-"+n).addClass("active"),e.setChoice(i,t.data("coords")),a.stopPropagation()})),e.wnd.$.on("click",`.cord-${n}.map-${i}`,(function(){e.wnd.$.find(`.city-${i} .cord-list-${n}`).click()}))},this.resetChoice=function(){a=null,s=null,e.wnd.$.find(".set-tp-stone").addClass("disable")},this.setChoice=function(t,i){a=t,s=i,e.wnd.$.find(".set-tp-stone").removeClass("disable")},this.showHideBuffer=function(t){e.wnd.$.find(".city-buffer-wrapper").css("display",t?"block":"none")},this.onClickEvent=t=>{const e=this.wnd.$.find(".city-"+t);e.hasClass("active")?e.removeClass("active"):_g("moveitem&st=1&id="+this.itemId+"&locationId="+t)},this.openCurrentLocation=()=>{const t=Engine.map.d.id;if(isset(this.data[t])){this.onClickEvent(t);const i=this.checkCityTabPosition(t);$(".scroll-wrapper",e.wnd.$).trigger("setScroll",i)}},this.checkCityTabPosition=t=>e.wnd.$.find(".left-scroll .city-"+t).position().top,this.showLocation=t=>{const n=e.wnd.$.find(".left-column .city-"+t.id);this.createCords(n,t.coords,t.id),this.activeGeoupItem(n);let a=CFG.a_mpath+t.file;i.indexOf(t.name)<0&&e.showHideBuffer(!0),e.wnd.$.find(".one-item-on-divide-list").removeClass("active"),e.resetChoice(),this.updateScroll(),Engine.imgLoader.onload(a,!1,t=>{fixCorsForTaintedCanvas(t)},i=>{e.afterOnload(i,t)})},this.createCords=(t,e,i)=>{var a=t.find(".group-list");a.html("");for(var s=0;s<e.length;s++){var r=e[s],o=n.get("one-item-on-divide-list").addClass("cord-list-"+s);o.find(".name").html(r[0]+", "+r[1]),o.data("coords",r),a.append(o),this.cordEvents(o,i,s)}},this.afterOnload=(t,n)=>{var a=e.wnd.$.find(".mini-map-positioner").empty();e.setMapBackground(n,t.width,t.height,a),i.push(n.name);for(var s=0;s<n.coords.length;s++){var r=n.coords[s],o=$("<div>").addClass(`cords cord-${s} map-${n.id}`).tip(r[0]+", "+r[1]);a.append(o),e.setCords(o,r)}e.showHideBuffer(!1)},this.setMapBackground=function(t,i,n,a){var s={x:i/32,y:n/32};e.wnd.$.find(".city-name").html(t.name),e.setScale(s),a.css({background:"url("+CFG.a_mpath+t.file+") no-repeat",width:s.x*e.scale+"px",height:s.y*e.scale+"px","background-size":"contain"})},this.activeGeoupItem=function(t){var i=t.hasClass("active");e.wnd.$.find(".divide-list-group").removeClass("active"),i||t.addClass("active")},this.setCords=function(t,i){t.css("left",e.scale*i[0]+"px"),t.css("top",e.scale*i[1]+"px")},this.setScale=function(t){var i=e.wnd.$.find(".mini-map-wrapper"),n=i.width()/i.height();e.scale=t.x>t.y*n?i.width()/t.x:i.height()/t.y},this.close=function(){e.wnd.remove(),delete this.data,Engine.tpScroll=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.default=class{constructor(t,e){this.wrapperEl=t,this.selected=null,this.defaultOptions={onSelectedClb:!1,ownSubmitBtn:!1,itemId:!1,onSubmitClb:!1,isReselectWindow:!1},this.options=Object.assign(Object.assign({},this.defaultOptions),e),this.createContent()}createContent(){this.el=n.get("bonus-selector")[0],this.bonusesEl=this.el.querySelector(".bonus-selector__bonuses"),this.buttonsContainerEl=this.el.querySelector(".bonus-selector__submit")}createBonusChoose(t){let e=0;this.bonusesEl.innerHTML="";for(const i of t){const t=n.get("radio-custom")[0];let[a,s]=i;const r=t.querySelector("input"),o=t.querySelector("label");let l="";setAttributes(r,{id:a,name:"enhance-bonus",value:e}),o.setAttribute("for",a),this.options.isReselectWindow&&0===e&&(l=`<b>${this.tLang("current_bonus")}</b> `),o.innerHTML=l+this.bonusStatsParser(a,s),this.bonusesEl.appendChild(t),r.addEventListener("change",this.onSelected.bind(this)),e++}this.options.ownSubmitBtn||this.createButtons(),this.wrapperEl.appendChild(this.el)}onSelected(t){this.selected=parseInt(t.target.value),this.options.ownSubmitBtn||this.setStateSubmitButton(),this.options.onSelectedClb&&"function"==typeof this.options.onSelectedClb&&this.options.onSelectedClb(this.selected)}createButtons(){this.buttonsContainerEl.innerHTML="",this.createConfirmButton(),this.createCancelButton()}createConfirmButton(){const t={txt:this.tLang("accept","buttons"),classes:["small","green","disable"],onClick:this.confirmOnClick.bind(this)};this.submitBtnEl=createButton(t.txt,t.classes,t.onClick),this.buttonsContainerEl.appendChild(this.submitBtnEl)}createCancelButton(){const t={txt:this.tLang("cancel","buttons"),classes:["small","red"],onClick:this.cancelOnClick.bind(this)};this.cancelBtnEl=createButton(t.txt,t.classes,t.onClick),this.buttonsContainerEl.appendChild(this.cancelBtnEl)}confirmOnClick(){const t=this.tLang("confirm-prompt");askAlert({q:t,clb:()=>this.submit(),m:"yesno4"})}cancelOnClick(){this.options.onSubmitClb&&"function"==typeof this.options.onSubmitClb&&this.options.onSubmitClb(!1)}setStateSubmitButton(){null!==this.selected?this.enableSubmitButton():this.disableSubmitButton()}enableSubmitButton(){this.submitBtnEl.classList.remove("disable")}disableSubmitButton(){this.submitBtnEl.classList.add("disable")}submit(){"function"==typeof this.options.onSubmitClb&&null!=this.selected&&this.options.onSubmitClb(!0,this.selected)}bonusStatsParser(t,e){let i,n="";switch(t){case"critmval":n="%",i=_t(`bonus_of-${t} %val%`,createTransVal(e,n,"(+",")"),"newOrder");break;case"sa":i=_t("no_percent_bonus_sa %val%",createTransVal(e/100,n,"(+",")"));break;case"ac":i=_t(`item_${t} %val%`,createTransVal(e,n,"(+",")"));break;case"act":case"resfire":case"reslight":case"resfrost":n="%",i=_t(`item_${t} %val%`,createTransVal(e,n,"(+",")"),"newOrder");break;case"crit":case"critval":case"resdmg":n="%",i=_t(`bonus_${t} %val%`,createTransVal(e,n,"(+",")"),"newOrder");break;case"slow":i=_t(`bonus_${t} %val%`,createTransVal(e/100,n,"(+",")"));break;default:i=_t(`bonus_${t} %val%`,createTransVal(e,n,"(+",")"))}return i}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement"):""}}},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WW=void 0;const n=i(107),a=i(0),s=i(343),r=i(345),o=i(346),l=i(351),c=i(2);e.WW={MODULES:{PLAYERS_ONLINE:"players-online",HUNTING_STATISTICS:"hunting-statistics",SERVER_PARAMETERS:"server-parameters",LOCATION_PARAMETERS:"location-parameters"}};e.default=class{constructor(){this.opened=!1,this.content="",this.TabsInstance=null,this.cards=Object.assign(Object.assign({[e.WW.MODULES.PLAYERS_ONLINE]:{name:this.tLang(e.WW.MODULES.PLAYERS_ONLINE),initAction:()=>{this.open(e.WW.MODULES.PLAYERS_ONLINE)}}},(0,c.isPl)()&&{[e.WW.MODULES.HUNTING_STATISTICS]:{initAction:()=>{this.open(e.WW.MODULES.HUNTING_STATISTICS)},name:this.tLang(e.WW.MODULES.HUNTING_STATISTICS)}}),{[e.WW.MODULES.SERVER_PARAMETERS]:{initAction:()=>{this.open(e.WW.MODULES.SERVER_PARAMETERS)},name:this.tLang(e.WW.MODULES.SERVER_PARAMETERS)},[e.WW.MODULES.LOCATION_PARAMETERS]:{initAction:()=>{this.open(e.WW.MODULES.LOCATION_PARAMETERS)},name:this.tLang(e.WW.MODULES.LOCATION_PARAMETERS)}})}init(){this.initWindow(),this.centerWindow(),this.createTabs()}createTabs(){const t={tabsEl:{navEl:this.wndEl.querySelector(".world-window__tabs"),contentsEl:this.wndEl.querySelector(".world-window__contents")}};this.TabsInstance=new n.default(this.cards,t)}open(t,i){this.closeOthers(t);const n=this.getEngine();switch(this.TabsInstance&&this.TabsInstance.activateCard(t),this.currentTab=t,this.closeOtherWindows(),this.windowOpen(),t){case e.WW.MODULES.PLAYERS_ONLINE:n.worldWindow.playersOnline||(n.worldWindow.playersOnline=new s.default(this.wndEl,i));break;case e.WW.MODULES.SERVER_PARAMETERS:n.worldWindow.serverParameters||(n.worldWindow.serverParameters=new r.default(this.wndEl));break;case e.WW.MODULES.LOCATION_PARAMETERS:n.worldWindow.locationParameters||(n.worldWindow.locationParameters=new l.default(this.wndEl));break;case e.WW.MODULES.HUNTING_STATISTICS:n.worldWindow.huntingStatistics||(n.worldWindow.huntingStatistics=new o.default(this.wndEl))}}closeAll(){this.getEngine().worldWindow.playersOnline&&this.getEngine().worldWindow.playersOnline.close(),this.getEngine().worldWindow.serverParameters&&this.getEngine().worldWindow.serverParameters.close(),this.getEngine().worldWindow.locationParameters&&this.getEngine().worldWindow.locationParameters.close(),this.getEngine().worldWindow.huntingStatistics&&this.getEngine().worldWindow.huntingStatistics.close()}closeOthers(t){this.getEngine().worldWindow.playersOnline&&t!==e.WW.MODULES.PLAYERS_ONLINE&&this.getEngine().worldWindow.playersOnline.close(),this.getEngine().worldWindow.serverParameters&&t!==e.WW.MODULES.SERVER_PARAMETERS&&this.getEngine().worldWindow.serverParameters.close(),this.getEngine().worldWindow.locationParameters&&t!==e.WW.MODULES.LOCATION_PARAMETERS&&this.getEngine().worldWindow.locationParameters.close(),this.getEngine().worldWindow.huntingStatistics&&t!==e.WW.MODULES.HUNTING_STATISTICS&&this.getEngine().worldWindow.huntingStatistics.close()}manageVisible(){this.opened?this.windowClose():(this.closeOtherWindows(),this.windowOpen())}windowOpen(){this.wnd.show(),this.opened=!0,this.wnd.setWndOnPeak()}windowClose(){this.wnd.hide(),this.opened=!1}initWindow(){this.content=a.get("world-window"),this.getEngine().windowManager.add({content:this.content,title:this.tLang("title"),nameWindow:this.getEngine().windowsData.name.WORLD,widget:this.getEngine().widgetsData.name.WORLD,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.windowClose(),this.wndEl=this.wnd.$[0]}centerWindow(){this.wnd.center()}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world_window"):""}closeOtherWindows(){const t=this.getEngine(),e=t.windowsData.windowCloseConfig.WORLD_WINDOW;t.windowCloseManager.callWindowCloseConfig(e)}close(){this.closeAll(),this.windowClose()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FILTER_KEYS=e.SORT_ORDER=e.TABLE_HEADERS=void 0;e.TABLE_HEADERS=[{key:"name",sort:!0},{key:"level",sort:!0,default:!0},{key:"kills",sort:!0},{key:"unique",sort:!0},{key:"heroic",sort:!0},{key:"legendary",sort:!0}];e.SORT_ORDER={ASC:"asc",DESC:"desc"};e.FILTER_KEYS={FILTER_NAME:"FILTER_NAME",FILTER_VAL:"FILTER_VAL",MIN_LEVEL:"MIN_LEVEL",PROF:"PROF",MAX_LEVEL:"MAX_LEVEL",RARITY:"RARITY",MIN_PRICE:"MIN_PRICE",MAX_PRICE:"MAX_PRICE",AUCTION_TYPE:"AUCTION_TYPE",NAME_ITEM:"NAME_ITEM"}},function(t,e,i){let n=i(1),a=i(66);t.exports=function(){let t=null,e=null,i=null,s=null,r=null,o=null;this.alwaysDraw=!0,this.rx,this.ry;const l=e=>{t=e},c=()=>Math.round((new Date).getTime()/1e3),d=t=>{s=t},h=t=>{e=t},u=t=>{i=t},p=()=>{switch(e){case n.HERO:return getEngine().hero;case n.NPC:return getEngine().npcs.getById(i)}},g=t=>t>60?"#ffffff":t>0?"#ffa500":"#ff0000",f=()=>{getEngine().interfaceTimerManager.removeCharacterTimer(t,e)};this.init=()=>{r=new a},this.updateData=(t,e,i,n)=>{null!=t&&l(t),h(i),d(n+c()),getEngine().interfaceTimerManager.isHero()||u(e)},this.update=e=>{if(o=s,o-=c(),null!=t&&o<0)return void f();let i=p();i&&(this.rx=i.rx,this.ry=i.ry)},this.draw=t=>{let i=p();if(!i)return;switch(e){case n.HERO:break;case n.NPC:if(!i.onloadProperImg)return}if(o<0)return;let a=void 0!==i.leftPosMod?i.leftPosMod:0;const s=i.checkEmoExist()?20:0;let l=Engine.mapShift.getShift(),c=this.rx*CFG.tileSize-Engine.map.offset[0]-l[0]+a+16,d=this.ry*CFG.tileSize-Engine.map.offset[1]-l[1]+CFG.tileSize-i.fh-s,h=o<0?0:o,u=Math.floor(h),f=getSecondLeft(u,{noVar:!0}),m=g(u);t.save(),r.draw(t,f,c,d,11,m),t.restore()},this.getOrder=()=>500,this.getId=()=>t}},function(t,e){t.exports={action:{CREATE:"CREATE",REMOVE:"REMOVE",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST",REMOVE_IF_EXIST:"REMOVE_IF_EXIST"},behavior:{IDLE:"IDLE",WALK:"WALK",TP:"TP",WALK_START:"WALK_START",TP_START:"TP_START",WALK_AND_TP_START:"WALK_AND_TP_START"},defaultData:{BEHAVIOR_REPEAT:1,BEHAVIOR_DURATION:5}}},function(t,e){const i=(t,e)=>{let i=[];for(let n of t)for(let t of e)n.name==t&&i.push(n);return i},n=(t,e)=>{let i=getRandomElementFromArray(e)._tempIndex,n=t.length,a=[];console.log("newIndex",i);for(let e=i;e<n;e++){let i=t[e];if(a.push(i),a.length==n)return a;e+1==n&&(e=-1)}};t.exports={updateRandomFirstIndex:t=>{let e=t.list,a=t.randomFirstIndex.forActions;for(let t=0;t<e.length;t++){e[t]._tempIndex=t}t.list=n(e,a?i(e,a):e),console.log(e,t.list)}}},function(t,e,i){var n=i(369),a=i(370),s=i(371),r=i(372),o=i(13);t.exports=function(){var t=this,e=[];this.init=function(){t.emotionsDefinitions=new a,t.initJumpCondition()},this.updateData=function(e){for(var i=0;i<e.length;i++){var n=e[i],a=n.name,s=n.source_id,r=isset(n.target_id)?n.target_id:0,l=isset(n.end_ts)?n.end_ts:0;this.prepareData(n);let c=n.source_type,d=n.target_type;t.ignoreEmo(a,c,s)||t.checkSourceObjectExist(n)&&(t.addEmo(a,c,s,d,r,l),c==o.OBJECT_TYPE.NPC&&Engine.npcs.manageDisplayOfNpcEmo(s))}},this.initJumpCondition=()=>{},this.addJumpCondition=(e,i)=>{var n=t.emotionsDefinitions.get(e);n?(n.jump=!0,i&&(n.jumpCondition=i)):errorReport("EmotionManager.js","addJumpCondition","Type Emo not exist",e)},this.setDisplayOfEmoFromArray=(t,e)=>{for(let i in t)t[i].setDisplay(e)},this.prepareData=t=>{let e=Engine.hero.d.id;t.source_type==o.OBJECT_TYPE.OTHER&&e==t.source_id&&(t.source_type=o.OBJECT_TYPE.HERO),t.target_type==o.OBJECT_TYPE.OTHER&&e==t.target_id&&(t.target_type=o.OBJECT_TYPE.HERO)},this.checkSourceObjectExist=t=>{switch(t.source_type){case o.OBJECT_TYPE.HERO:return Engine.hero.d.id==t.source_id;case o.OBJECT_TYPE.NPC:return!!Engine.npcs.check()[t.source_id];case o.OBJECT_TYPE.OTHER:return!!Engine.others.check()[t.source_id];case o.OBJECT_TYPE.PET:return!!Engine.hero.havePet()}return!1},this.ignoreEmo=function(t,e,i){if(t==o.NAME.VISUAL_EFFECTS)return!1;var n=this.dontAddBattle(t,i);let a=!1;switch(e){case o.OBJECT_TYPE.NPC:case o.OBJECT_TYPE.OTHER:case o.OBJECT_TYPE.HERO:case o.OBJECT_TYPE.PET:a=!0;break;default:errorReport("EmotionsManager.js","ignoreEmo","Incorrect type of sourceType Emo!",e)}return n||!a},this.update=function(t){for(var i in e)e[i].update(t)},this.dontAddBattle=function(t,e){let i=o.NAME.BATTLE;return t==i&&!!this.getEmoByIdSource(e,i)},this.deleteAllSourceEmo=function(i,n){for(var a in e){var s=e[a];s.sourceId==i&&s.type==n&&(s.delete(),t.removeEmoFromList(s),s.fadeOutEmo(),t.manageDisplayOfNpcEmo(s.sourceType,s.sourceId))}},this.deleteEmoByType=function(i){for(var n in e){var a=e[n];a.type==i&&(a.delete(),t.removeEmoFromList(a),a.fadeOutEmo(),t.manageDisplayOfNpcEmo(a.sourceType,a.sourceId))}},this.manageDisplayOfNpcEmo=(t,e)=>{t==o.OBJECT_TYPE.NPC&&Engine.npcs.manageDisplayOfNpcEmo(e)},this.removeEmoFromList=function(t){var i=e.indexOf(t);-1!=i&&e.splice(i,1)},this.renderStrategy=function(t){return t.height?new s.getSpriteObject:new s.getGifObject},this.kindOfAction=function(t){let e=t.action;switch(e){case o.ACTION.ON_SELF:return new r.getActionOnSelf;case o.ACTION.CHAR_TO_CHAR:return new r.getActionCharToChar;case o.ACTION.STICK_TO_PLAYER:return new r.getActionStickToAnotherPlayer;case o.ACTION.STICK_TO_MAP:return new r.getActionStickToMap;case o.ACTION.FIRE:return new r.getActionFire;case o.ACTION.BETWEEN_PLAYERS:return new r.getActionBetweenPlayers;case o.ACTION.LANTERN:return new r.getActionLantern;default:errorReport("EmotionsManager","kindOfAction",`Incorrect action ${e}!`)}},this.getEmoByIdSource=function(t,i){for(var n in e){var a=e[n];if(a.sourceId==t&&a.type==i)return a}return null},this.getEmoByTargetSourceType=function(t,i,n,a){for(var s in e){var r=e[s];if(r.sourceId==t&&r.type==n&&r.targetId==i&&r.sourceType==a)return r}return null},this.removeAllFromSourceId=function(i){for(var n=0;n<e.length;n++){var a=e[n];a.sourceId==i&&(a.delete(),e.splice(n,1),n--,a.fadeOutEmo(),t.manageDisplayOfNpcEmo(a.sourceType,a.sourceId))}},this.removeEmotionBySourceIdAndEmoType=function(i,n){for(var a=0;a<e.length;a++){var s=e[a];if(s.sourceId==i&&s.type==n)return s.delete(),e.splice(a,1),s.fadeOutEmo(),void t.manageDisplayOfNpcEmo(s.sourceType,s.sourceId)}},this.emoClear=function(e,i){for(var n in i)t.deleteAllSourceEmo(e,i[n])},this.addEmo=function(i,a,s,r,l,c){var d=t.emotionsDefinitions.get(i);if(null==d){let t=Engine.rajEmoDefinitions.getDefinition(i);if(!t)return void errorReport("EmotionsManager","addEmo",`name emo: ${i} not exist!`);d=t}var h={sourceType:a,sourceId:s,targetType:r,targetId:l,endTime:0===c&&isset(d.timeout)?Engine.getEv()+d.timeout/1e3:c,type:i};if(isset(d.clear)&&t.emoClear(s,d.clear),i!=o.NAME.NO_EMO){if(d.action==o.ACTION.ON_SELF){var u=t.getEmoByTargetSourceType(s,l,i,a);if(null!=u)return void u.renew()}var p=new n(d,h,t.removeEmoFromList);(p=$.extend(p,t.renderStrategy(d),t.kindOfAction(d))).withCreateObject(),e.push(p)}},this.onClear=function(){for(var t in e)e[t].delete();e=[]},this.setEmotionsAnimationsState=function(t){for(var i in e)e[i].setStaticAnimation(t)},this.getList=()=>e,this.getDrawableList=function(){var t=[];for(var i in e)t.push(e[i]);return t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),a=i(385);e.default=class{constructor(t,e){this.radiosData=t,this.defaultOptions={isInline:!1,elementBeforeLabel:null,label:null,elementAfterLabel:null},this.options=Object.assign(Object.assign({},this.defaultOptions),e),this.radioListEl=n.get("radio-list")[0],this.createContent()}createContent(){this.createRadioInfo(),this.createRadios()}createRadios(){let t=0;for(const e of this.radiosData.radios){e.name=this.radiosData.name,e.i=t++;const i=this.radiosData.onSelected?this.radiosData.onSelected:null,n=new a.default(e,i).getRadio();this.radioListEl.appendChild(n),this.options.isInline&&this.radioListEl.classList.add("radio-list--inline")}}createRadioInfo(){let t=null;if(null==this.options.elementBeforeLabel&&null==this.options.label&&null==this.options.elementAfterLabel||(t=n.get("radio-info")[0],this.radioListEl.appendChild(t)),null!=this.options.label){let e=t.querySelector(".radio-label");e.innerText=this.options.label,e.style.display="inline-block"}if(null!=this.options.elementBeforeLabel){let e=t.querySelector(".radio-before-label");e.append(this.options.elementBeforeLabel),e.style.display="inline-block"}if(null!=this.options.elementAfterLabel){let e=t.querySelector(".radio-after-label");e.append(this.options.elementAfterLabel),e.style.display="inline-block"}}getList(){return this.radioListEl}}},function(t,e){t.exports={weather:{SNOW:"Snow",RAIN:"Rain",BUBBLE:"Bubble",FISH:"Fish",LIGHT:"Light",BAT:"Bat",HALLOWEEN_BAT:"HalloweenBat",LATERN:"Latern"},filter:{OCEAN:"Ocean",NIGHT:"Night"}}},function(t,e){t.exports={ON_OPEN:"ON_OPEN",ON_UPDATE:"ON_UPDATE",ON_FIRST_UPDATE:"ON_FIRST_UPDATE"}},function(t,e){let i={getNewVectorsFromDestinyAndPowerOfVectors:(t,e,i)=>{let n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return n+a==0?{newXVector:0,newYVector:0}:{newXVector:n*i/(n+a)*(t.x<=e.x?1:-1),newYVector:a*i/(n+a)*(t.y<=e.y?1:-1)}},getNewPositionFromVectors:(t,e,i,n,a)=>{let s=CFG.tileSize;return{newX:(t*s+i*a*100)/s,newY:(e*s+n*a*100)/s}},checkReachCord:(t,e,i)=>{let n=!1,a=!1;return 0==i.xVector?n=!0:i.xVector>0?t.x>e.x&&(n=!0):t.x<e.x&&(n=!0),0==i.yVector?a=!0:i.yVector>0?t.y>e.y&&(a=!0):t.y<e.y&&(a=!0),n&&a},getReachEdge:(t,e,i)=>{let n=CFG.tileSize,a=!1,s=(Engine.map.size.x+2)*n,r=(Engine.map.size.y+2)*n,o=t.newX*n,l=t.newY*n;return o<0-e&&(a=!0),o>s&&(a=!0),l<0-i&&(a=!0),l>r&&(a=!0),a}};t.exports=i},function(t,e,i){let n=i(124);t.exports=function(){let t=null,e=null,i=null,a=null,s=null,r=null,o=null,l=null,c=null,d=null,h=null;const u=()=>{g();let t=k();t&&(b(t.x),w(t.y),t.speed&&I(t.speed),p())},p=()=>{let r=n.getNewVectorsFromDestinyAndPowerOfVectors({x:t,y:e},{x:i,y:a},s);T(r.newXVector),y(r.newYVector)},g=()=>{if(null!=l){if(m(l+1),o.length<l+1){if(!0===r)return void m(0);if(A(r-1),r<=0)return;m(0)}}else m(0)},f=()=>{let t=c.getActualBehavior();return t&&t.attachMoveNoise?t.attachMoveNoise:null},m=t=>{l=t},v=t=>{o=t},E=e=>{t=e},_=t=>{e=t},b=t=>{i=t},w=t=>{a=t},C=t=>{c=t},T=t=>{d=t},y=t=>{h=t},I=t=>{s=t},A=t=>{r=t},k=()=>o[l];this.init=t=>{C(t),E(0),_(0),I(2),A(1)},this.getXMoveNoise=()=>t,this.getYMoveNoise=()=>e,this.startMoveNoiseBehavior=()=>{let t=f(),e=t.vals,i=t.repeat;null!=i&&A(i),m(null),v(e),u()},this.updateMoveNoise=s=>{let r=n.getNewPositionFromVectors(t,e,d,h,s);E(r.newX),_(r.newY),n.checkReachCord({x:t,y:e},{x:i,y:a},{xVector:d,yVector:h})&&(E(i),_(a),u())}}},function(t,e,i){const n=i(22),a=(i(79),i(4)),s=i(3);t.exports=function(){const t="RajTemplate.js";let e=null,i=null;const r=()=>{i=new a,i.init(t,null,s.GROUP_NAME.DEFINITIONS_OBJECT)},o=(t,i)=>{e[t]=i},l=t=>{for(let e in t)if(elementIsObject(t[e]))l(t[e]);else if(elementIsArray(t[e])){let i=t[e];for(let t in i)l(i[t])}else;isset(t.getTpl)&&c(t)},c=t=>{let i=d(t.getTpl,t.tplVars);delete t.getTpl,t.tplVars&&delete t.tplVars;let n=i.tplIdArray,a=i.tplVarsArray;for(let i=0;i<n.length;i++){let s=n[i],r=a[i];if(elementIsObject(s))continue;if(!e[s])return void errorReport("CharacterEffectsManager.js","fillDataFromTemplate",`tplId ${s} not exist!`,t);let o=u(s,t,r);for(let e in o)t[e]=o[e];h(s,t,r)}},d=(t,e)=>{let i=null,n=[];if(elementIsArray(t)){i=t;for(let t=0;t<i.length;t++){let i=null;i=e&&isset(e[t])?e[t]:{},n.push(i)}return{tplIdArray:i,tplVarsArray:n}}i=[t];let a=e||{};return n.push(a),{tplIdArray:i,tplVarsArray:n}},h=(t,e,i)=>{let n=u(t,e,i);for(let t in n)e[t]=n[t]},u=(t,i,n)=>{let a=(t=>copyStructure(e[t]))(t);if(a)return l(a),n&&p(a,n),deepMergeData(a,i);errorReport("RajController","getMergeTemplateWithData","tpl not exist",t)},p=(t,e)=>{for(let i in t){let n=t[i];if(elementIsObject(n))n.getTplVar?t[i]=g(n.getTplVar,e,n.modify):p(t[i],e);else if(elementIsArray(t[i])){let n=t[i];for(let t in n)p(n[t],e)}else;}if(!isset(t.getTplVar))return;let i=g(t.getTplVar,e,t.modify);if(lengthObject(i)){delete t.getTplVar,t.modify&&delete t.modify;for(let e in i)t[e]=i[e]}},g=(e,i,n)=>{if(!isset(i[e]))return errorReport(t,"getTplVar",`getTplVar ${e} not exist!`,[e,i,n]),null;if(null==i[e])return{};let a=i[e];if(n){if(!(e=>{const i="checkCorrectModify";return isset(e.kind)?isset(e.v)?!!["STR_ADD","MATH_ADD"].includes(e.kind)||(errorReport(t,i,"possible val of kind is MATH_ADD or STR_ADD!",e),!1):(errorReport(t,i,"modify have to v attr!",e),!1):(errorReport(t,i,"modify have to kind attr! possible val of kind is MATH_ADD or STR_ADD",e),!1)})(n))return a;let e=n.v;if(elementIsObject(a)){a=copyStructure(a);let t=copyStructure(n);a.modify={};for(let e in t)a.modify[e]=t[e]}else switch(n.kind){case"STR_ADD":case"MATH_ADD":a+=e}}return a};this.getReplaceDataGetTplFullReplaceJson=t=>{e={};let a=t[n.TEMPLATE];if(!i.checkCorrectMainData(a))return t;(t=>{for(let e in t)o(e,t[e])})(t[n.TEMPLATE]);for(let t in e)l(e[t]);let s=copyStructure(t);return delete s[n.TEMPLATE],l(s),s},this.init=()=>{r()}}},function(t,e){t.exports={GET_FUNC_KEY:"getFunc",kind:{LINEAR:"linear"},defaultData:{outputXVarName:"x",outputYVarName:"y"},resultType:{INT:"int",FLOAT:"float"}}},function(t,e){t.exports={defaultData:{REPEAT:1,DURATION:5,DELAY_BEFORE:0}}},function(t,e){t.exports={defaultData:{DELAY_BEFORE:0,DELAY_AFTER:0,REPEAT:1},action:{CREATE:"CREATE",CREATE_IF_NOT_EXIST:"CREATE_IF_NOT_EXIST",REMOVE:"REMOVE",UPDATE:"UPDATE"}}},function(t,e){t.exports={defaultData:{BEHAVIOR_REPEAT:1,BEHAVIOR_DURATION:5},behavior:{IDLE:"IDLE",MOVE_TO_CORDS:"MOVE_TO_CORDS",TRANSITION:"TRANSITION",TRANSITION_AND_MOVE_TO_CORDS:"TRANSITION_AND_MOVE_TO_CORDS"}}},function(t,e){t.exports={ON_START_FIGHT_WITH_NPC:"ON_START_FIGHT_WITH_NPC",ON_DIE_NPC:"ON_DIE_NPC"}},function(t,e,i){window.cdnUrl="https://micc.garmory-cdn.cloud",window.cdncrUrl="https://mwcr.garmory-cdn.cloud",window.CFG={oimg:"/img",a_imgpath:cdnUrl+"/obrazki/",a_opath:cdnUrl+"/obrazki/postacie/",a_npath:cdnUrl+"/obrazki/npc/",a_mpath:cdnUrl+"/obrazki/miasta/",a_ipath:cdnUrl+"/obrazki/itemy/",a_ppath:cdnUrl+"/obrazki/pets/",a_vpath:cdnUrl+"/obrazki/interface/",a_epath:cdnUrl+"/obrazki/interface/emo/",a_fpath:cdnUrl+"/obrazki/interface/environmentalEffects/",a_bpath:cdnUrl+"/obrazki/battle/",a_rajGraphics:cdnUrl+"/obrazki/grafikiRaj/",r_opath:"/obrazki/postacie/",r_npath:"/obrazki/npc/",r_mpath:"/obrazki/miasta/",r_ipath:"/obrazki/itemy/",r_ppath:"/obrazki/pets",r_vpath:"/obrazki/interface/",r_epath:"/obrazki/interface/emo/",r_fpath:"/obrazki/interface/environmentalEffects/",r_bpath:"/obrazki/battle/",r_rajGraphics:"/obrazki/grafikiRaj/",r_battleEffectsGif:"/battleEffects/gif/",r_battleEffectsSound:"/battleEffects/sound/",r_srajSound:"/obrazki/grafikiRaj/sounds/",sl_multipler:{en:75,pl:75},LANG:{PL:"pl",EN:"en"},DOMAIN:{PL:"pl",COM:"com"},tileSize:32,halfTileSize:16,quarterTileSize:8,chest:!1,storage:{version:2,keysToRemove:["questLog","padController","whoIsHere","HANDHELD_WINDOW","PAD_CONTROLLER","PARTY","QUESTS_PANEL","QUEST_OBSERVE","WANTED_LIST","WHO_IS_HERE","charlist"]},serverStorage:{version:1.4,keysToRemove:["hotKeys"]},enhancedItemId:-1,debug:!1,webSocketVersion:void 0===__build.websocket||__build.websocket},window.IE=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0,i(133),i(84),window.$=window.jQuery=i(42),i(134),window.linkify=i(86),i(140),i(141),i(142),window.Vue=i(143),i(146),i(150),i(151),i(0),i(152),i(153),i(154),i(155),i(156),window.API=i(90),i(157)},function(t,e){if(!(function(){try{return new Function("(a) => a"),!0}catch(t){return!1}}()&&function(){try{return new Function("a","b","return { ...a, ...b}"),!0}catch(t){return!1}}()||"pl"!==__build.lang)){var i=new Date;i.setTime(i.getTime()+2592e6),n="interface",a="si",s=i,r="/",o="margonem.pl",document.cookie=n+"="+escape(a)+(s?"; expires="+s.toGMTString():"")+(r?"; path="+r:"")+(o?"; domain="+o:"")+(l?"; secure":""),window.location.reload()}var n,a,s,r,o,l},function(t,e,i){var n,a,s;
/*! jQuery UI - v1.11.1 - 2014-09-28
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, menu.js, progressbar.js, selectmenu.js, slider.js, spinner.js, tabs.js, tooltip.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */a=[i(42)],void 0===(s="function"==typeof(n=function(t){function e(e,n){var a,s,r,o=e.nodeName.toLowerCase();return"area"===o?(s=(a=e.parentNode).name,!(!e.href||!s||"map"!==a.nodeName.toLowerCase())&&!!(r=t("img[usemap='#"+s+"']")[0])&&i(r)):(/input|select|textarea|button|object/.test(o)?!e.disabled:"a"===o&&e.href||n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter((function(){return"hidden"===t.css(this,"visibility")})).length}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=a(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",(function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")})).delegate(i,"mouseover",s)}function s(){t.datepicker._isDisabledDatepicker(u.inline?u.dpDiv.parent()[0]:u.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function r(e,i){for(var n in t.extend(e,i),i)null==i[n]&&(e[n]=i[n]);return e}function o(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),n="absolute"===i,a=e?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter((function(){var e=t(this);return(!n||"static"!==e.css("position"))&&a.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))})).eq(0);return"fixed"!==i&&s.length?s:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each((function(){this.id||(this.id="ui-id-"+ ++t)}))}}(),removeUniqueId:function(){return this.each((function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")}))}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo((function(e){return function(i){return!!t.data(i,e)}})):function(e,i,n){return!!t.data(e,n[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var n=t.attr(i,"tabindex"),a=isNaN(n);return(a||n>=0)&&e(i,!a)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],(function(e,i){function n(e,i,n,s){return t.each(a,(function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),s&&(i-=parseFloat(t.css(e,"margin"+this))||0)})),i}var a="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?r["inner"+i].call(this):this.each((function(){t(this).css(s,n(this,e)+"px")}))},t.fn["outer"+i]=function(e,a){return"number"!=typeof e?r["outer"+i].call(this,e):this.each((function(){t(this).css(s,n(this,e,!0,a)+"px")}))}})),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each((function(){var e=this;setTimeout((function(){t(e).focus(),n&&n.call(e)}),i)})):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",(function(t){t.preventDefault()}))}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var i,n,a=t(this[0]);a.length&&a[0]!==document;){if(("absolute"===(i=a.css("position"))||"relative"===i||"fixed"===i)&&(n=parseInt(a.css("zIndex"),10),!isNaN(n)&&0!==n))return n;a=a.parent()}return 0}}),t.ui.plugin={add:function(e,i,n){var a,s=t.ui[e].prototype;for(a in n)s.plugins[a]=s.plugins[a]||[],s.plugins[a].push([i,n[a]])},call:function(t,e,i,n){var a,s=t.plugins[e];if(s&&(n||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(a=0;s.length>a;a++)t.options[s[a][0]]&&s[a][1].apply(t.element,i)}};var l=0,c=Array.prototype.slice;t.cleanData=function(e){return function(i){var n,a,s;for(s=0;null!=(a=i[s]);s++)try{(n=t._data(a,"events"))&&n.remove&&t(a).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,n){var a,s,r,o,l={},c=e.split(".")[0];return e=e.split(".")[1],a=c+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][a.toLowerCase()]=function(e){return!!t.data(e,a)},t[c]=t[c]||{},s=t[c][e],r=t[c][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new r(t,e)},t.extend(r,s,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),(o=new i).options=t.widget.extend({},o.options),t.each(n,(function(e,n){return t.isFunction(n)?void(l[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},a=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,s=this._superApply;return this._super=t,this._superApply=a,e=n.apply(this,arguments),this._super=i,this._superApply=s,e}}()):void(l[e]=n)})),r.prototype=t.widget.extend(o,{widgetEventPrefix:s&&o.widgetEventPrefix||e},l,{constructor:r,namespace:c,widgetName:e,widgetFullName:a}),s?(t.each(s._childConstructors,(function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,r,i._proto)})),delete s._childConstructors):i._childConstructors.push(r),t.widget.bridge(e,r),r},t.widget.extend=function(e){for(var i,n,a=c.call(arguments,1),s=0,r=a.length;r>s;s++)for(i in a[s])n=a[s][i],a[s].hasOwnProperty(i)&&void 0!==n&&(e[i]=t.isPlainObject(n)?t.isPlainObject(e[i])?t.widget.extend({},e[i],n):t.widget.extend({},n):n);return e},t.widget.bridge=function(e,i){var n=i.prototype.widgetFullName||e;t.fn[e]=function(a){var s="string"==typeof a,r=c.call(arguments,1),o=this;return a=!s&&r.length?t.widget.extend.apply(null,[a].concat(r)):a,s?this.each((function(){var i,s=t.data(this,n);return"instance"===a?(o=s,!1):s?t.isFunction(s[a])&&"_"!==a.charAt(0)?(i=s[a].apply(s,r))!==s&&void 0!==i?(o=i&&i.jquery?o.pushStack(i.get()):i,!1):void 0:t.error("no such method '"+a+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+a+"'")})):this.each((function(){var e=t.data(this,n);e?(e.option(a||{}),e._init&&e._init()):t.data(this,n,new i(a,this))})),o}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var n,a,s,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},n=e.split("."),e=n.shift(),n.length){for(a=r[e]=t.widget.extend({},this.options[e]),s=0;n.length-1>s;s++)a[n[s]]=a[n[s]]||{},a=a[n[s]];if(e=n.pop(),1===arguments.length)return void 0===a[e]?null:a[e];a[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,n){var a,s=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=a=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,a=this.widget()),t.each(n,(function(n,r){function o(){return e||!0!==s.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?s[r]:r).apply(s,arguments):void 0}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||t.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+s.eventNamespace,d=l[2];d?a.delegate(d,c,o):i.bind(c,o)}))},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){var i=this;return setTimeout((function(){return("string"==typeof t?i[t]:t).apply(i,arguments)}),e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var a,s,r=this.options[e];if(n=n||{},(i=t.Event(i)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],s=i.originalEvent)for(a in s)a in i||(i[a]=s[a]);return this.element.trigger(i,n),!(t.isFunction(r)&&!1===r.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},(function(e,i){t.Widget.prototype["_"+e]=function(n,a,s){"string"==typeof a&&(a={effect:a});var r,o=a?!0===a||"number"==typeof a?i:a.effect||i:e;"number"==typeof(a=a||{})&&(a={duration:a}),r=!t.isEmptyObject(a),a.complete=s,a.delay&&n.delay(a.delay),r&&t.effects&&t.effects.effect[o]?n[e](a):o!==e&&n[o]?n[o](a.duration,a.easing,s):n.queue((function(i){t(this)[e](),s&&s.call(n[0]),i()}))}})),t.widget;var d=!1;t(document).mouseup((function(){d=!1})),t.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,(function(t){return e._mouseDown(t)})).bind("click."+this.widgetName,(function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0})),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!d){this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,a=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(n&&!a&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){i.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),d=!0,0)))}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):e.which?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),d=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function e(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var a,s,r=Math.max,o=Math.abs,l=Math.round,c=/left|center|right/,d=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,p=/%$/,g=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==a)return a;var e,i,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=n.children()[0];return t("body").append(n),e=s.offsetWidth,n.css("overflow","scroll"),e===(i=s.offsetWidth)&&(i=n[0].clientWidth),n.remove(),a=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),a="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:a?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]),a=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:a,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n||a?i.width():i.outerWidth(),height:n||a?i.height():i.outerHeight()}}},t.fn.position=function(a){if(!a||!a.of)return g.apply(this,arguments);a=t.extend({},a);var p,f,m,v,E,_,b=t(a.of),w=t.position.getWithinInfo(a.within),C=t.position.getScrollInfo(w),T=(a.collision||"flip").split(" "),y={};return _=n(b),b[0].preventDefault&&(a.at="left top"),f=_.width,m=_.height,v=_.offset,E=t.extend({},v),t.each(["my","at"],(function(){var t,e,i=(a[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):d.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=d.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),y[this]=[t?t[0]:0,e?e[0]:0],a[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]})),1===T.length&&(T[1]=T[0]),"right"===a.at[0]?E.left+=f:"center"===a.at[0]&&(E.left+=f/2),"bottom"===a.at[1]?E.top+=m:"center"===a.at[1]&&(E.top+=m/2),p=e(y.at,f,m),E.left+=p[0],E.top+=p[1],this.each((function(){var n,c,d=t(this),h=d.outerWidth(),u=d.outerHeight(),g=i(this,"marginLeft"),_=i(this,"marginTop"),I=h+g+i(this,"marginRight")+C.width,A=u+_+i(this,"marginBottom")+C.height,k=t.extend({},E),S=e(y.my,d.outerWidth(),d.outerHeight());"right"===a.my[0]?k.left-=h:"center"===a.my[0]&&(k.left-=h/2),"bottom"===a.my[1]?k.top-=u:"center"===a.my[1]&&(k.top-=u/2),k.left+=S[0],k.top+=S[1],s||(k.left=l(k.left),k.top=l(k.top)),n={marginLeft:g,marginTop:_},t.each(["left","top"],(function(e,i){t.ui.position[T[e]]&&t.ui.position[T[e]][i](k,{targetWidth:f,targetHeight:m,elemWidth:h,elemHeight:u,collisionPosition:n,collisionWidth:I,collisionHeight:A,offset:[p[0]+S[0],p[1]+S[1]],my:a.my,at:a.at,within:w,elem:d})})),a.using&&(c=function(t){var e=v.left-k.left,i=e+f-h,n=v.top-k.top,s=n+m-u,l={target:{element:b,left:v.left,top:v.top,width:f,height:m},element:{element:d,left:k.left,top:k.top,width:h,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>s?"top":n>0?"bottom":"middle"};h>f&&f>o(e+i)&&(l.horizontal="center"),u>m&&m>o(n+s)&&(l.vertical="middle"),l.important=r(o(e),o(i))>r(o(n),o(s))?"horizontal":"vertical",a.using.call(this,t,l)}),d.offset(t.extend(k,{using:c}))}))},t.ui.position={fit:{left:function(t,e){var i,n=e.within,a=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=t.left-e.collisionPosition.marginLeft,l=a-o,c=o+e.collisionWidth-s-a;e.collisionWidth>s?l>0&&0>=c?(i=t.left+l+e.collisionWidth-s-a,t.left+=l-i):t.left=c>0&&0>=l?a:l>c?a+s-e.collisionWidth:a:l>0?t.left+=l:c>0?t.left-=c:t.left=r(t.left-o,t.left)},top:function(t,e){var i,n=e.within,a=n.isWindow?n.scrollTop:n.offset.top,s=e.within.height,o=t.top-e.collisionPosition.marginTop,l=a-o,c=o+e.collisionHeight-s-a;e.collisionHeight>s?l>0&&0>=c?(i=t.top+l+e.collisionHeight-s-a,t.top+=l-i):t.top=c>0&&0>=l?a:l>c?a+s-e.collisionHeight:a:l>0?t.top+=l:c>0?t.top-=c:t.top=r(t.top-o,t.top)}},flip:{left:function(t,e){var i,n,a=e.within,s=a.offset.left+a.scrollLeft,r=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,c=t.left-e.collisionPosition.marginLeft,d=c-l,h=c+e.collisionWidth-r-l,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,g=-2*e.offset[0];0>d?(0>(i=t.left+u+p+g+e.collisionWidth-r-s)||o(d)>i)&&(t.left+=u+p+g):h>0&&((n=t.left-e.collisionPosition.marginLeft+u+p+g-l)>0||h>o(n))&&(t.left+=u+p+g)},top:function(t,e){var i,n,a=e.within,s=a.offset.top+a.scrollTop,r=a.height,l=a.isWindow?a.scrollTop:a.offset.top,c=t.top-e.collisionPosition.marginTop,d=c-l,h=c+e.collisionHeight-r-l,u="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>d?(n=t.top+u+p+g+e.collisionHeight-r-s,t.top+u+p+g>d&&(0>n||o(d)>n)&&(t.top+=u+p+g)):h>0&&(i=t.top-e.collisionPosition.marginTop+u+p+g-l,t.top+u+p+g>h&&(i>0||h>o(i))&&(t.top+=u+p+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,a,r,o=document.getElementsByTagName("body")[0],l=document.createElement("div");for(r in e=document.createElement(o?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"}),n)e.style[r]=n[r];e.appendChild(l),(i=o||document.documentElement).insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",a=t(l).offset().left,s=a>10&&11>a,e.innerHTML="",i.removeChild(e)}()}(),t.ui.position,t.widget("ui.draggable",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.document[0],n=this.options;try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&t(i.activeElement).blur()}catch(t){}return!(this.helper||n.disabled||t(e.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(e),!this.handle||(t(!0===n.iframeFix?"iframe":n.iframeFix).each((function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")})),0)))},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(!1===this._trigger("drag",e,n))return this._mouseUp({}),!1;this.position=n.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,n=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==i._trigger("stop",e)&&i._clear()})):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each((function(){this.parentNode.removeChild(this)})),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.element.focus(),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,a=this.options,s=this.document[0];return this.relativeContainer=null,a.containment?"window"===a.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===a.containment?void(this.containment=[0,0,t(s).width()-this.helperProportions.width-this.margins.left,(t(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):a.containment.constructor===Array?void(this.containment=a.containment):("parent"===a.containment&&(a.containment=this.helper[0].parentNode),void((n=(i=t(a.containment))[0])&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:n?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:n?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,n,a,s,r=this.options,o=this._isRootNode(this.scrollParent[0]),l=t.pageX,c=t.pageY;return o&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(n=this.relativeContainer.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),r.grid&&(a=r.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,c=i?a-this.offset.click.top>=i[1]||a-this.offset.click.top>i[3]?a:a-this.offset.click.top>=i[1]?a-r.grid[1]:a+r.grid[1]:a,s=r.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,l=i?s-this.offset.click.left>=i[0]||s-this.offset.click.left>i[2]?s:s-this.offset.click.left>=i[0]?s-r.grid[0]:s+r.grid[0]:s),"y"===r.axis&&(l=this.originalPageX),"x"===r.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:o?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:o?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n,this],!0),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,n){var a=n.options,s=t.extend({},i,{item:n.element});n.sortables=[],t(a.connectToSortable).each((function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,s))}))},stop:function(e,i,n){var a=t.extend({},i,{item:n.element});t.each(n.sortables,(function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,a))}))},drag:function(e,i,n){var a=this;t.each(n.sortables,(function(){var s=!1,r=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,t.each(n.sortables,(function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==r&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(r.instance.element[0],this.instance.element[0])&&(s=!1),s}))),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(a).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)}))}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,n){var a=t("body"),s=n.options;a.css("cursor")&&(s._cursor=a.css("cursor")),a.css("cursor",s.cursor)},stop:function(e,i,n){var a=n.options;a._cursor&&t("body").css("cursor",a._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,n){var a=t(i.helper),s=n.options;a.css("opacity")&&(s._opacity=a.css("opacity")),a.css("opacity",s.opacity)},stop:function(e,i,n){var a=n.options;a._opacity&&t(i.helper).css("opacity",a._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,n){var a=n.options,s=!1,r=n.scrollParentNotHidden[0],o=n.document[0];r!==o&&"HTML"!==r.tagName?(a.axis&&"x"===a.axis||(n.overflowOffset.top+r.offsetHeight-e.pageY<a.scrollSensitivity?r.scrollTop=s=r.scrollTop+a.scrollSpeed:e.pageY-n.overflowOffset.top<a.scrollSensitivity&&(r.scrollTop=s=r.scrollTop-a.scrollSpeed)),a.axis&&"y"===a.axis||(n.overflowOffset.left+r.offsetWidth-e.pageX<a.scrollSensitivity?r.scrollLeft=s=r.scrollLeft+a.scrollSpeed:e.pageX-n.overflowOffset.left<a.scrollSensitivity&&(r.scrollLeft=s=r.scrollLeft-a.scrollSpeed))):(a.axis&&"x"===a.axis||(e.pageY-t(o).scrollTop()<a.scrollSensitivity?s=t(o).scrollTop(t(o).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(o).scrollTop())<a.scrollSensitivity&&(s=t(o).scrollTop(t(o).scrollTop()+a.scrollSpeed))),a.axis&&"y"===a.axis||(e.pageX-t(o).scrollLeft()<a.scrollSensitivity?s=t(o).scrollLeft(t(o).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(o).scrollLeft())<a.scrollSensitivity&&(s=t(o).scrollLeft(t(o).scrollLeft()+a.scrollSpeed)))),!1!==s&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,n){var a=n.options;n.snapElements=[],t(a.snap.constructor!==String?a.snap.items||":data(ui-draggable)":a.snap).each((function(){var e=t(this),i=e.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})}))},drag:function(e,i,n){var a,s,r,o,l,c,d,h,u,p,g=n.options,f=g.snapTolerance,m=i.offset.left,v=m+n.helperProportions.width,E=i.offset.top,_=E+n.helperProportions.height;for(u=n.snapElements.length-1;u>=0;u--)c=(l=n.snapElements[u].left)+n.snapElements[u].width,h=(d=n.snapElements[u].top)+n.snapElements[u].height,l-f>v||m>c+f||d-f>_||E>h+f||!t.contains(n.snapElements[u].item.ownerDocument,n.snapElements[u].item)?(n.snapElements[u].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=!1):("inner"!==g.snapMode&&(a=f>=Math.abs(d-_),s=f>=Math.abs(h-E),r=f>=Math.abs(l-v),o=f>=Math.abs(c-m),a&&(i.position.top=n._convertPositionTo("relative",{top:d-n.helperProportions.height,left:0}).top-n.margins.top),s&&(i.position.top=n._convertPositionTo("relative",{top:h,left:0}).top-n.margins.top),r&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width}).left-n.margins.left),o&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c}).left-n.margins.left)),p=a||s||r||o,"outer"!==g.snapMode&&(a=f>=Math.abs(d-E),s=f>=Math.abs(h-_),r=f>=Math.abs(l-m),o=f>=Math.abs(c-v),a&&(i.position.top=n._convertPositionTo("relative",{top:d,left:0}).top-n.margins.top),s&&(i.position.top=n._convertPositionTo("relative",{top:h-n.helperProportions.height,left:0}).top-n.margins.top),r&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l}).left-n.margins.left),o&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[u].snapping&&(a||s||r||o||p)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=a||s||r||o||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,n){var a,s=n.options,r=t.makeArray(t(s.stack)).sort((function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)}));r.length&&(a=parseInt(t(r[0]).css("zIndex"),10)||0,t(r).each((function(e){t(this).css("zIndex",a+e)})),this.css("zIndex",a+r.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,n){var a=t(i.helper),s=n.options;a.css("zIndex")&&(s._zIndex=a.css("zIndex")),a.css("zIndex",s.zIndex)},stop:function(e,i,n){var a=n.options;a._zIndex&&t(i.helper).css("zIndex",a._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.11.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,n=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(n)?n:function(t){return t.is(n)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e||(e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var n=t.ui.ddmanager.droppables[this.options.scope];this._splice(n),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var n=i||t.ui.ddmanager.current,a=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===n.options.scope&&i.accept.call(i.element[0],n.currentItem||n.element)&&t.ui.intersect(n,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(a=!0,!1):void 0})),!a&&!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,n,a){if(!i.offset)return!1;var s=(e.positionAbs||e.position.absolute).left,r=(e.positionAbs||e.position.absolute).top,o=s+e.helperProportions.width,l=r+e.helperProportions.height,c=i.offset.left,d=i.offset.top,h=c+i.proportions().width,u=d+i.proportions().height;switch(n){case"fit":return s>=c&&h>=o&&r>=d&&u>=l;case"intersect":return s+e.helperProportions.width/2>c&&h>o-e.helperProportions.width/2&&r+e.helperProportions.height/2>d&&u>l-e.helperProportions.height/2;case"pointer":return t(a.pageY,d,i.proportions().height)&&t(a.pageX,c,i.proportions().width);case"touch":return(r>=d&&u>=r||l>=d&&u>=l||d>r&&l>u)&&(s>=c&&h>=s||o>=c&&h>=o||c>s&&o>h);default:return!1}}}(),t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var n,a,s=t.ui.ddmanager.droppables[e.options.scope]||[],r=i?i.type:null,o=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(n=0;s.length>n;n++)if(!(s[n].options.disabled||e&&!s[n].accept.call(s[n].element[0],e.currentItem||e.element))){for(a=0;o.length>a;a++)if(o[a]===s[n].element[0]){s[n].proportions().height=0;continue t}s[n].visible="none"!==s[n].element.css("display"),s[n].visible&&("mousedown"===r&&s[n]._activate.call(s[n],i),s[n].offset=s[n].element.offset(),s[n].proportions({width:s[n].element[0].offsetWidth,height:s[n].element[0].offsetHeight}))}},drop:function(e,i){var n=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),(function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance,i)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))})),n},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",(function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}))},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],(function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,a,s,r=t.ui.intersect(e,this,this.options.tolerance,i),o=!r&&this.isover?"isout":r&&!this.isover?"isover":null;o&&(this.options.greedy&&(a=this.options.scope,(s=this.element.parents(":data(ui-droppable)").filter((function(){return t(this).droppable("instance").options.scope===a}))).length&&((n=t(s[0]).droppable("instance")).greedyChild="isover"===o)),n&&"isover"===o&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[o]=!0,this["isout"===o?"isover":"isout"]=!1,this["isover"===o?"_over":"_out"].call(this,i),n&&"isout"===o&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}}))},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseInt(t,10)||0},_isNumber:function(t){return!isNaN(parseInt(t,10))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return e[n]>0||(e[n]=1,a=e[n]>0,e[n]=0,a)},_create:function(){var e,i,n,a,s=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)n=t.trim(e[i]),(a=t("<div class='ui-resizable-handle ui-resizable-"+n+"'></div>")).css({zIndex:r.zIndex}),"se"===n&&a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(a);this._renderAxis=function(e){var i,n,a,s;for(i in e=e||this.element,this.handles)this.handles[i].constructor===String&&(this.handles[i]=this.element.children(this.handles[i]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=t(this.handles[i],this.element),s=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),a=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(a,s),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover((function(){s.resizing||(this.className&&(a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=a&&a[1]?a[1]:"se")})),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter((function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),s._handles.show())})).mouseleave((function(){r.disabled||s.resizing||(t(this).addClass("ui-resizable-autohide"),s._handles.hide())}))),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,n,a=!1;for(i in this.handles)((n=t(this.handles[i])[0])===e.target||t.contains(n,e.target))&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(e){var i,n,a,s=this.options,r=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),n=this._num(this.helper.css("top")),s.containment&&(i+=t(s.containment).scrollLeft()||0,n+=t(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalPosition={left:i,top:n},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===a?this.axis+"-resize":a),r.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,n,a=this.originalMousePosition,s=this.axis,r=e.pageX-a.left||0,o=e.pageY-a.top||0,l=this._change[s];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[e,r,o]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),n=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,n,a,s,r,o,l,c=this.options,d=this;return this._helper&&(a=(n=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:d.sizeDiff.height,s=n?0:d.sizeDiff.width,r={width:d.helper.width()-s,height:d.helper.height()-a},o=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(t.extend(r,{top:l,left:o})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,n,a,s,r=this.options;s={minWidth:this._isNumber(r.minWidth)?r.minWidth:0,maxWidth:this._isNumber(r.maxWidth)?r.maxWidth:1/0,minHeight:this._isNumber(r.minHeight)?r.minHeight:0,maxHeight:this._isNumber(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=s.minHeight*this.aspectRatio,n=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,a=s.maxWidth/this.aspectRatio,e>s.minWidth&&(s.minWidth=e),n>s.minHeight&&(s.minHeight=n),s.maxWidth>i&&(s.maxWidth=i),s.maxHeight>a&&(s.maxHeight=a)),this._vBoundaries=s},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,n=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,n=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,s=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,r=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,o=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(i),d=/nw|ne|n/.test(i);return s&&(t.width=e.minWidth),r&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight),s&&c&&(t.left=o-e.minWidth),n&&c&&(t.left=o-e.maxWidth),r&&d&&(t.top=l-e.minHeight),a&&d&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],n=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],a=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseInt(n[e],10)||0,i[e]+=parseInt(a[e],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize;return{left:this.originalPosition.left+e,width:i.width-e}},n:function(t,e,i){var n=this.originalSize;return{top:this.originalPosition.top+i,height:n.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},sw:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,n]))},ne:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},nw:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,n]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),n=i.options,a=i._proportionallyResizeElements,s=a.length&&/textarea/i.test(a[0].nodeName),r=s&&i._hasScroll(a[0],"left")?0:i.sizeDiff.height,o=s?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-r},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,d=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,d&&c?{top:d,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&t(a[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,n,a,s,r,o,l=t(this).resizable("instance"),c=l.options,d=l.element,h=c.containment,u=h instanceof t?h.get(0):/parent/.test(h)?d.parent().get(0):h;u&&(l.containerElement=t(u),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(u),i=[],t(["Top","Right","Left","Bottom"]).each((function(t,n){i[t]=l._num(e.css("padding"+n))})),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},n=l.containerOffset,a=l.containerSize.height,s=l.containerSize.width,r=l._hasScroll(u,"left")?u.scrollWidth:s,o=l._hasScroll(u)?u.scrollHeight:a,l.parentData={element:u,left:n.left,top:n.top,width:r,height:o}))},resize:function(e){var i,n,a,s,r=t(this).resizable("instance"),o=r.options,l=r.containerOffset,c=r.position,d=r._aspectRatio||e.shiftKey,h={top:0,left:0},u=r.containerElement,p=!0;u[0]!==document&&/static/.test(u.css("position"))&&(h=l),c.left<(r._helper?l.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-l.left:r.position.left-h.left),d&&(r.size.height=r.size.width/r.aspectRatio,p=!1),r.position.left=o.helper?l.left:0),c.top<(r._helper?l.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-l.top:r.position.top),d&&(r.size.width=r.size.height*r.aspectRatio,p=!1),r.position.top=r._helper?l.top:0),a=r.containerElement.get(0)===r.element.parent().get(0),s=/relative|absolute/.test(r.containerElement.css("position")),a&&s?(r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top):(r.offset.left=r.element.offset().left,r.offset.top=r.element.offset().top),i=Math.abs(r.sizeDiff.width+(r._helper?r.offset.left-h.left:r.offset.left-l.left)),n=Math.abs(r.sizeDiff.height+(r._helper?r.offset.top-h.top:r.offset.top-l.top)),i+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-i,d&&(r.size.height=r.size.width/r.aspectRatio,p=!1)),n+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-n,d&&(r.size.width=r.size.height*r.aspectRatio,p=!1)),p||(r.position.left=r.prevPosition.left,r.position.top=r.prevPosition.top,r.size.width=r.prevSize.width,r.size.height=r.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,n=e.containerOffset,a=e.containerPosition,s=e.containerElement,r=t(e.helper),o=r.offset(),l=r.outerWidth()-e.sizeDiff.width,c=r.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(s.css("position"))&&t(this).css({left:o.left-a.left-n.left,width:l,height:c}),e._helper&&!i.animate&&/static/.test(s.css("position"))&&t(this).css({left:o.left-a.left-n.left,width:l,height:c})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance").options,i=function(e){t(e).each((function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})}))};"object"!=typeof e.alsoResize||e.alsoResize.parentNode?i(e.alsoResize):e.alsoResize.length?(e.alsoResize=e.alsoResize[0],i(e.alsoResize)):t.each(e.alsoResize,(function(t){i(t)}))},resize:function(e,i){var n=t(this).resizable("instance"),a=n.options,s=n.originalSize,r=n.originalPosition,o={height:n.size.height-s.height||0,width:n.size.width-s.width||0,top:n.position.top-r.top||0,left:n.position.left-r.left||0},l=function(e,n){t(e).each((function(){var e=t(this),a=t(this).data("ui-resizable-alsoresize"),s={},r=n&&n.length?n:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(r,(function(t,e){var i=(a[e]||0)+(o[e]||0);i&&i>=0&&(s[e]=i||null)})),e.css(s)}))};"object"!=typeof a.alsoResize||a.alsoResize.nodeType?l(a.alsoResize):t.each(a.alsoResize,(function(t,e){l(t,e)}))},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.options,n=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),n=i.options,a=i.size,s=i.originalSize,r=i.originalPosition,o=i.axis,l="number"==typeof n.grid?[n.grid,n.grid]:n.grid,c=l[0]||1,d=l[1]||1,h=Math.round((a.width-s.width)/c)*c,u=Math.round((a.height-s.height)/d)*d,p=s.width+h,g=s.height+u,f=n.maxWidth&&p>n.maxWidth,m=n.maxHeight&&g>n.maxHeight,v=n.minWidth&&n.minWidth>p,E=n.minHeight&&n.minHeight>g;n.grid=l,v&&(p+=c),E&&(g+=d),f&&(p-=c),m&&(g-=d),/^(se|s|e)$/.test(o)?(i.size.width=p,i.size.height=g):/^(ne)$/.test(o)?(i.size.width=p,i.size.height=g,i.position.top=r.top-u):/^(sw)$/.test(o)?(i.size.width=p,i.size.height=g,i.position.left=r.left-h):((0>=g-d||0>=p-c)&&(e=i._getPaddingPlusBorderDimensions(this)),g-d>0?(i.size.height=g,i.position.top=r.top-u):(g=d-e.height,i.size.height=g,i.position.top=r.top+s.height-g),p-c>0?(i.size.width=p,i.position.left=r.left-h):(p=d-e.height,i.size.width=p,i.position.left=r.left+s.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.11.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(e=t(i.options.filter,i.element[0])).addClass("ui-selectee"),e.each((function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})}))},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,n=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(n.filter,this.element[0]),this._trigger("start",e),t(n.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each((function(){var n=t.data(this,"selectable-item");n.startselected=!0,e.metaKey||e.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",e,{unselecting:n.element}))})),t(e.target).parents().addBack().each((function(){var n,a=t.data(this,"selectable-item");return a?(n=!e.metaKey&&!e.ctrlKey||!a.$element.hasClass("ui-selected"),a.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),a.unselecting=!n,a.selecting=n,a.selected=n,n?i._trigger("selecting",e,{selecting:a.element}):i._trigger("unselecting",e,{unselecting:a.element}),!1):void 0})))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,n=this,a=this.options,s=this.opos[0],r=this.opos[1],o=e.pageX,l=e.pageY;return s>o&&(i=o,o=s,s=i),r>l&&(i=l,l=r,r=i),this.helper.css({left:s,top:r,width:o-s,height:l-r}),this.selectees.each((function(){var i=t.data(this,"selectable-item"),c=!1;i&&i.element!==n.element[0]&&("touch"===a.tolerance?c=!(i.left>o||s>i.right||i.top>l||r>i.bottom):"fit"===a.tolerance&&(c=i.left>s&&o>i.right&&i.top>r&&l>i.bottom),c?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element})))))})),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each((function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",e,{unselected:n.element})})),t(".ui-selecting",this.element[0]).each((function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",e,{selected:n.element})})),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===t.axis||this._isFloating(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,(function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")}))},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var n=null,a=!1,s=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(e),t(e.target).parents().each((function(){return t.data(this,s.widgetName+"-item")===s?(n=t(this),!1):void 0})),t.data(e.target,s.widgetName+"-item")===s&&(n=t(e.target)),!n||this.options.handle&&!i&&(t(this.options.handle,n).find("*").addBack().each((function(){this===e.target&&(a=!0)})),!a)||(this.currentItem=n,this._removeCurrentsFromItems(),0)))},_mouseStart:function(e,i,n){var a,s,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",r.cursor),this.storedStylesheet=t("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(s)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,a,s,r=this.options,o=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+r.scrollSpeed:e.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(e.pageY-t(document).scrollTop()<r.scrollSensitivity?o=t(document).scrollTop(t(document).scrollTop()-r.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<r.scrollSensitivity&&(o=t(document).scrollTop(t(document).scrollTop()+r.scrollSpeed)),e.pageX-t(document).scrollLeft()<r.scrollSensitivity?o=t(document).scrollLeft(t(document).scrollLeft()-r.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<r.scrollSensitivity&&(o=t(document).scrollLeft(t(document).scrollLeft()+r.scrollSpeed))),!1!==o&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(a=(n=this.items[i]).item[0],(s=this._intersectsWithPointer(n))&&n.instance===this.currentContainer&&a!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==a&&!t.contains(this.placeholder[0],a)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],a))){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,a=this.placeholder.offset(),s=this.options.axis,r={};s&&"x"!==s||(r.left=a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(r.top=a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(r,parseInt(this.options.revert,10)||500,(function(){n._clear(e)}))}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each((function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))})),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each((function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")})),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,a=n+this.helperProportions.height,s=t.left,r=s+t.width,o=t.top,l=o+t.height,c=this.offset.click.top,d=this.offset.click.left,h="x"===this.options.axis||n+c>o&&l>n+c,u="y"===this.options.axis||e+d>s&&r>e+d,p=h&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>s&&r>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>o&&l>a-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=e&&i,a=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return!!n&&(this.floating?s&&"right"===s||"down"===a?2:1:a&&("down"===a?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&i||"left"===a&&!i:n&&("down"===n&&e||"up"===n&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){o.push(this)}var n,a,s,r,o=[],l=[],c=this._connectWith();if(c&&e)for(n=c.length-1;n>=0;n--)for(a=(s=t(c[n])).length-1;a>=0;a--)(r=t.data(s[a],this.widgetFullName))&&r!==this&&!r.options.disabled&&l.push([t.isFunction(r.options.items)?r.options.items.call(r.element):t(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return t(o)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,(function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0}))},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,a,s,r,o,l,c,d=this.items,h=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(n=(a=t(u[i])).length-1;n>=0;n--)(s=t.data(a[n],this.widgetFullName))&&s!==this&&!s.options.disabled&&(h.push([t.isFunction(s.options.items)?s.options.items.call(s.element[0],e,{item:this.currentItem}):t(s.options.items,s.element),s]),this.containers.push(s));for(i=h.length-1;i>=0;i--)for(r=h[i][1],n=0,c=(o=h[i][0]).length;c>n;n++)(l=t(o[n])).data(this.widgetName+"-item",r),d.push({item:l,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var i,n,a,s;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(n=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(a=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=a.outerWidth(),n.height=a.outerHeight()),s=a.offset(),n.left=s.left,n.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)s=this.containers[i].element.offset(),this.containers[i].containerCache.left=s.left,this.containers[i].containerCache.top=s.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){var i,n=(e=e||this).options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),a=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?e.currentItem.children().each((function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(a)})):"img"===n&&a.attr("src",e.currentItem.attr("src")),i||a.css("visibility","hidden"),a},update:function(t,a){(!i||n.forcePlaceholderSize)&&(a.height()||a.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_contactContainers:function(e){var i,n,a,s,r,o,l,c,d,h,u=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&t.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(a=1e4,s=null,r=(d=u.floating||this._isFloating(this.currentItem))?"left":"top",o=d?"width":"height",h=d?"clientX":"clientY",n=this.items.length-1;n>=0;n--)t.contains(this.containers[p].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(l=this.items[n].item.offset()[r],c=!1,e[h]-l>this.items[n][o]/2&&(c=!0),a>Math.abs(e[h]-l)&&(a=Math.abs(e[h]-l),s=this.items[n],this.direction=c?"up":"down"));if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;s?this._rearrange(e,s,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,a=this.options;"parent"===a.containment&&(a.containment=this.helper[0].parentNode),("document"===a.containment||"window"===a.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===a.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||(e=t(a.containment)[0],i=t(a.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:a.scrollLeft())*n}},_generatePosition:function(e){var i,n,a=this.options,s=e.pageX,r=e.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),a.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/a.grid[1])*a.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-a.grid[1]:i+a.grid[1]:i,n=this.originalPageX+Math.round((s-this.originalPageX)/a.grid[0])*a.grid[0],s=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-a.grid[0]:n+a.grid[0]:n)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:o.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:o.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay((function(){a===this.counter&&this.refreshPositions(!n)}))},_clear:function(t,e){function i(t,e,i){return function(n){i._trigger(t,n,e._uiHash(e))}}this.reverting=!1;var n,a=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&a.push((function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))})),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||a.push((function(t){this._trigger("update",t,this._uiHash())})),this!==this.currentContainer&&(e||(a.push((function(t){this._trigger("remove",t,this._uiHash())})),a.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),a.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)e||a.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(a.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),n=0;a.length>n;n++)a[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(n=0;a.length>n;n++)a[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.accordion",{version:"1.11.1",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||!1!==this.options.active||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void("disabled"===t&&(this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e))))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,n=this.headers.length,a=this.headers.index(e.target),s=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:s=this.headers[(a+1)%n];break;case i.LEFT:case i.UP:s=this.headers[(a-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:s=this.headers[0];break;case i.END:s=this.headers[n-1]}s&&(t(e.target).attr("tabIndex",-1),t(s).attr("tabIndex",0),s.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=t()):!1===e.active?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var e,i=this.options,n=i.heightStyle,a=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each((function(){var e=t(this),i=e.uniqueId().attr("id"),n=e.next(),a=n.uniqueId().attr("id");e.attr("aria-controls",a),n.attr("aria-labelledby",i)})).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===n?(e=a.height(),this.element.siblings(":visible").each((function(){var i=t(this),n=i.css("position");"absolute"!==n&&"fixed"!==n&&(e-=i.outerHeight(!0))})),this.headers.each((function(){e-=t(this).outerHeight(!0)})),this.headers.next().each((function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))})).css("overflow","auto")):"auto"===n&&(e=0,this.headers.next().each((function(){e=Math.max(e,t(this).css("height","").height())})).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),(function(t,e){i[e]="_eventHandler"})),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,n=this.active,a=t(e.currentTarget),s=a[0]===n[0],r=s&&i.collapsible,o=r?t():a.next(),l=n.next(),c={oldHeader:n,oldPanel:l,newHeader:r?t():a,newPanel:o};e.preventDefault(),s&&!i.collapsible||!1===this._trigger("beforeActivate",e,c)||(i.active=!r&&this.headers.index(a),this.active=s?t():a,this._toggle(c),n.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),s||(a.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&a.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),a.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,n=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,e):(n.hide(),i.show(),this._toggleComplete(e)),n.attr({"aria-hidden":"true"}),n.prev().attr("aria-selected","false"),i.length&&n.length?n.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter((function(){return 0===t(this).attr("tabIndex")})).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(t,e,i){var n,a,s,r=this,o=0,l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},d=l&&c.down||c,h=function(){r._toggleComplete(i)};return"number"==typeof d&&(s=d),"string"==typeof d&&(a=d),a=a||d.easing||c.easing,s=s||d.duration||c.duration,e.length?t.length?(n=t.show().outerHeight(),e.animate(this.hideProps,{duration:s,easing:a,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:s,easing:a,complete:h,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?o+=i.now:"content"!==r.options.heightStyle&&(i.now=Math.round(n-e.outerHeight()-o),o=0)}})):e.animate(this.hideProps,s,a,h):t.animate(this.showProps,s,a,h)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.widget("ui.menu",{version:"1.11.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay((function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)}))},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each((function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()})),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,a,s,r,o,l=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:l=!1,a=this.previousFilter||"",s=String.fromCharCode(e.keyCode),r=!1,clearTimeout(this.filterTimer),s===a?r=!0:s=a+s,o=RegExp("^"+i(s),"i"),n=this.activeMenu.find(this.options.items).filter((function(){return o.test(t(this).text())})),(n=r&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n).length||(s=String.fromCharCode(e.keyCode),o=RegExp("^"+i(s),"i"),n=this.activeMenu.find(this.options.items).filter((function(){return o.test(t(this).text())}))),n.length?(this.focus(e,n),n.length>1?(this.previousFilter=s,this.filterTimer=this._delay((function(){delete this.previousFilter}),1e3)):delete this.previousFilter):delete this.previousFilter}l&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(t):this.select(t))},refresh:function(){var e,i=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each((function(){var e=t(this),i=e.parent(),a=t("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(a),e.attr("aria-labelledby",i.attr("id"))})),(e=a.add(this.element).find(this.options.items)).not(".ui-menu-item").each((function(){var e=t(this);i._isDivider(e)&&e.addClass("ui-widget-content ui-menu-divider")})),e.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),e.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},focus:function(t,e){var i,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),n=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay((function(){this._close()}),this.delay),(i=e.children(".ui-menu")).length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,n,a,s,r,o;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,a=e.offset().top-this.activeMenu.offset().top-i-n,s=this.activeMenu.scrollTop(),r=this.activeMenu.height(),o=e.outerHeight(),0>a?this.activeMenu.scrollTop(s+a):a+o>r&&this.activeMenu.scrollTop(s+a-r+o))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay((function(){this._close(),this._open(t)}),this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay((function(){var n=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(e),this.activeMenu=n}),this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay((function(){this.focus(t,e)})))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var n;this.active&&(n="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.find(this.options.items)[e]()),this.focus(i,n)},nextPage:function(e){var i,n,a;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each((function(){return 0>(i=t(this)).offset().top-n-a})),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,n,a;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each((function(){return(i=t(this)).offset().top-n+a>0})),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}}),t.widget("ui.autocomplete",{version:"1.11.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,n,a=this.element[0].nodeName.toLowerCase(),s="textarea"===a,r="input"===a;this.isMultiLine=!!s||!r&&this.element.prop("isContentEditable"),this.valueMethod=this.element[s||r?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return e=!0,n=!0,void(i=!0);e=!1,n=!1,i=!1;var s=t.ui.keyCode;switch(a.keyCode){case s.PAGE_UP:e=!0,this._move("previousPage",a);break;case s.PAGE_DOWN:e=!0,this._move("nextPage",a);break;case s.UP:e=!0,this._keyEvent("previous",a);break;case s.DOWN:e=!0,this._keyEvent("next",a);break;case s.ENTER:this.menu.active&&(e=!0,a.preventDefault(),this.menu.select(a));break;case s.TAB:this.menu.active&&this.menu.select(a);break;case s.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(a),a.preventDefault());break;default:i=!0,this._searchTimeout(a)}},keypress:function(n){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&n.preventDefault());if(!i){var a=t.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:this._move("previousPage",n);break;case a.PAGE_DOWN:this._move("nextPage",n);break;case a.UP:this._keyEvent("previous",n);break;case a.DOWN:this._keyEvent("next",n)}}},input:function(t){return n?(n=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur}));var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay((function(){var e=this;this.document.one("mousedown",(function(n){n.target===e.element[0]||n.target===i||t.contains(i,n.target)||e.close()}))}))},menufocus:function(e,i){var n,a;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",(function(){t(e.target).trigger(e.originalEvent)}))):(a=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:a})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(a.value),void((n=i.item.attr("aria-label")||a.value)&&t.trim(n).length&&(this.liveRegion.children().hide(),t("<div>").text(n).appendTo(this.liveRegion))))},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay((function(){this.previous=n,this.selectedItem=i}))),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,n=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,n){n(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,a){n.xhr&&n.xhr.abort(),n.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){a(t)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay((function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),n=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!n)&&(this.selectedItem=null,this.search(null,t))}),this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):!1!==this._trigger("search",e)?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy((function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")}),this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,(function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})}))},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var n=this;t.each(i,(function(t,i){n._renderItemData(e,i)}))},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").text(i.label).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var n=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,(function(t){return n.test(t.label||t.value||t)}))}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var h,u,p="ui-button ui-widget ui-state-default ui-corner-all",g="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var e=t(this);setTimeout((function(){e.find(":ui-button").button("refresh")}),1)},m=function(e){var i=e.name,n=e.form,a=t([]);return i&&(i=i.replace(/'/g,"\\'"),a=n?t(n).find("[name='"+i+"'][type=radio]"):t("[name='"+i+"'][type=radio]",e.ownerDocument).filter((function(){return!this.form}))),a};t.widget("ui.button",{version:"1.11.1",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,f),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var e=this,i=this.options,n="checkbox"===this.type||"radio"===this.type,a=n?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,(function(){i.disabled||this===h&&t(this).addClass("ui-state-active")})).bind("mouseleave"+this.eventNamespace,(function(){i.disabled||t(this).removeClass(a)})).bind("click"+this.eventNamespace,(function(t){i.disabled&&(t.preventDefault(),t.stopImmediatePropagation())})),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),n&&this.element.bind("change"+this.eventNamespace,(function(){e.refresh()})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){return!i.disabled&&void 0})):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){if(i.disabled)return!1;t(this).addClass("ui-state-active"),e.buttonElement.attr("aria-pressed","true");var n=e.element[0];m(n).not(n).map((function(){return t(this).button("widget")[0]})).removeClass("ui-state-active").attr("aria-pressed","false")})):(this.buttonElement.bind("mousedown"+this.eventNamespace,(function(){return!i.disabled&&(t(this).addClass("ui-state-active"),h=this,void e.document.one("mouseup",(function(){h=null})))})).bind("mouseup"+this.eventNamespace,(function(){return!i.disabled&&void t(this).removeClass("ui-state-active")})).bind("keydown"+this.eventNamespace,(function(e){return!i.disabled&&void((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"))})).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,(function(){t(this).removeClass("ui-state-active")})),this.buttonElement.is("a")&&this.buttonElement.keyup((function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()}))),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+g).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),void(e&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")))):void this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?m(this.element[0]).each((function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")})):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var e=this.buttonElement.removeClass(g),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),n=this.options.icons,a=n.primary&&n.secondary,s=[];n.primary||n.secondary?(this.options.text&&s.push("ui-button-text-icon"+(a?"s":n.primary?"-primary":"-secondary")),n.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+n.primary+"'></span>"),n.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+n.secondary+"'></span>"),this.options.text||(s.push(a?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):s.push("ui-button-text-only"),e.addClass(s.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),t.widget("ui.buttonset",{version:"1.11.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),n=i.filter(":ui-button");i.not(":ui-button").button(),n.button("refresh"),this.buttons=i.map((function(){return t(this).button("widget")[0]})).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map((function(){return t(this).button("widget")[0]})).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.11.1"}}),t.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return r(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var n,a,s;a="div"===(n=e.nodeName.toLowerCase())||"span"===n,e.id||(this.uuid+=1,e.id="dp"+this.uuid),(s=this._newInst(t(e),a)).settings=t.extend({},i||{}),"input"===n?this._connectDatepicker(e,s):a&&this._inlineDatepicker(e,s)},_newInst:function(e,i){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var n=t(e);i.append=t([]),i.trigger=t([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var n,a,s,r=this._get(i,"appendText"),o=this._get(i,"isRTL");i.append&&i.append.remove(),r&&(i.append=t("<span class='"+this._appendClass+"'>"+r+"</span>"),e[o?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),("focus"===(n=this._get(i,"showOn"))||"both"===n)&&e.focus(this._showDatepicker),("button"===n||"both"===n)&&(a=this._get(i,"buttonText"),s=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:s,alt:a,title:a}):t("<button type='button'></button>").addClass(this._triggerClass).html(s?t("<img/>").attr({src:s,alt:a,title:a}):a)),e[o?"before":"after"](i.trigger),i.trigger.click((function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1})))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,n,a,s=new Date(2009,11,20),r=this._get(t,"dateFormat");r.match(/[DM]/)&&(e=function(t){for(i=0,n=0,a=0;t.length>a;a++)t[a].length>i&&(i=t[a].length,n=a);return n},s.setMonth(e(this._get(t,r.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(e(this._get(t,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),t.input.attr("size",this._formatDate(t,s).length)}},_inlineDatepicker:function(e,i){var n=t(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,n,a,s){var o,l,c,d,h,u=this._dialogInst;return u||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),(u=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},t.data(this._dialogInput[0],"datepicker",u)),r(u.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(u,i):i,this._dialogInput.val(i),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(l=document.documentElement.clientWidth,c=document.documentElement.clientHeight,d=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+d,c/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",u),this},_destroyDatepicker:function(e){var i,n=t(e),a=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(a.append.remove(),a.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&n.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var i,n,a=t(e),s=t.data(e,"datepicker");a.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!1,s.trigger.filter("button").each((function(){this.disabled=!1})).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&((n=a.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,(function(t){return t===e?null:t})))},_disableDatepicker:function(e){var i,n,a=t(e),s=t.data(e,"datepicker");a.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!0,s.trigger.filter("button").each((function(){this.disabled=!0})).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&((n=a.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,(function(t){return t===e?null:t})),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,n){var a,s,o,l,c=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):c?"all"===i?t.extend({},c.settings):this._get(c,i):null:(a=i||{},"string"==typeof i&&((a={})[i]=n),void(c&&(this._curInst===c&&this._hideDatepicker(),s=this._getDateDatepicker(e,!0),o=this._getMinMaxDate(c,"min"),l=this._getMinMaxDate(c,"max"),r(c.settings,a),null!==o&&void 0!==a.dateFormat&&void 0===a.minDate&&(c.settings.minDate=this._formatDate(c,o)),null!==l&&void 0!==a.dateFormat&&void 0===a.maxDate&&(c.settings.maxDate=this._formatDate(c,l)),"disabled"in a&&(a.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),c),this._autoSize(c),this._setDate(c,s),this._updateAlternate(c),this._updateDatepicker(c))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,n,a,s=t.datepicker._getInst(e.target),r=!0,o=s.dpDiv.is(".ui-datepicker-rtl");if(s._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),r=!1;break;case 13:return(a=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",s.dpDiv))[0]&&t.datepicker._selectDay(e.target,s.selectedMonth,s.selectedYear,a[0]),(i=t.datepicker._get(s,"onSelect"))?(n=t.datepicker._formatDate(s),i.apply(s.input?s.input[0]:null,[n,s])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(s,"stepBigMonths"):-t.datepicker._get(s,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(s,"stepBigMonths"):+t.datepicker._get(s,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),r=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),r=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?1:-1,"D"),r=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(s,"stepBigMonths"):-t.datepicker._get(s,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),r=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?-1:1,"D"),r=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(s,"stepBigMonths"):+t.datepicker._get(s,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),r=e.ctrlKey||e.metaKey;break;default:r=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):r=!1;r&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,n,a=t.datepicker._getInst(e.target);return t.datepicker._get(a,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(a,"dateFormat")),n=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">n||!i||i.indexOf(n)>-1):void 0},_doKeyUp:function(e){var i=t.datepicker._getInst(e.target);if(i.input.val()!==i.lastVal)try{t.datepicker.parseDate(t.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,t.datepicker._getFormatConfig(i))&&(t.datepicker._setDateFromField(i),t.datepicker._updateAlternate(i),t.datepicker._updateDatepicker(i))}catch(t){}return!0},_showDatepicker:function(e){var i,n,a,s,o,l,c;"input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),t.datepicker._isDisabledDatepicker(e)||t.datepicker._lastInput===e||(i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),!1!==(a=(n=t.datepicker._get(i,"beforeShow"))?n.apply(e,[e,i]):{})&&(r(i.settings,a),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),s=!1,t(e).parents().each((function(){return!(s|="fixed"===t(this).css("position"))})),o={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),o=t.datepicker._checkOffset(i,o,s),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":s?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),i.inline||(l=t.datepicker._get(i,"showAnim"),c=t.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function(t){for(var e,i;t.length&&t[0]!==document;){if(("absolute"===(e=t.css("position"))||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?i.dpDiv.show(l,t.datepicker._get(i,"showOptions"),c):i.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i)))},_updateDatepicker:function(e){this.maxRows=4,u=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,n=this._getNumberOfMonths(e),a=n[1],r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&s.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),a>1&&e.dpDiv.addClass("ui-datepicker-multi-"+a).css("width",17*a+"em"),e.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout((function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null}),0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,n){var a=e.dpDiv.outerWidth(),s=e.dpDiv.outerHeight(),r=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(n?0:t(document).scrollLeft()),c=document.documentElement.clientHeight+(n?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?a-r:0,i.left-=n&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=n&&i.top===e.input.offset().top+o?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+a>l&&l>a?Math.abs(i.left+a-l):0),i.top-=Math.min(i.top,i.top+s>c&&c>s?Math.abs(s+o):0),i},_findPos:function(e){for(var i,n=this._getInst(e),a=this._get(n,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[a?"previousSibling":"nextSibling"];return[(i=t(e).offset()).left,i.top]},_hideDatepicker:function(e){var i,n,a,s,r=this._curInst;!r||e&&r!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(r,"showAnim"),n=this._get(r,"duration"),a=function(){t.datepicker._tidyDialog(r)},t.effects&&(t.effects.effect[i]||t.effects[i])?r.dpDiv.hide(i,t.datepicker._get(r,"showOptions"),n,a):r.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,a),i||a(),this._datepickerShowing=!1,(s=this._get(r,"onClose"))&&s.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),n=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==n)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,n){var a=t(e),s=this._getInst(a[0]);this._isDisabledDatepicker(a[0])||(this._adjustInstDate(s,i+("M"===n?this._get(s,"showCurrentAtPos"):0),n),this._updateDatepicker(s))},_gotoToday:function(e){var i,n=t(e),a=this._getInst(n[0]);this._get(a,"gotoCurrent")&&a.currentDay?(a.selectedDay=a.currentDay,a.drawMonth=a.selectedMonth=a.currentMonth,a.drawYear=a.selectedYear=a.currentYear):(i=new Date,a.selectedDay=i.getDate(),a.drawMonth=a.selectedMonth=i.getMonth(),a.drawYear=a.selectedYear=i.getFullYear()),this._notifyChange(a),this._adjustDate(n)},_selectMonthYear:function(e,i,n){var a=t(e),s=this._getInst(a[0]);s["selected"+("M"===n?"Month":"Year")]=s["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(a)},_selectDay:function(e,i,n,a){var s,r=t(e);t(a).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||((s=this._getInst(r[0])).selectedDay=s.currentDay=t("a",a).html(),s.selectedMonth=s.currentMonth=i,s.selectedYear=s.currentYear=n,this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var n,a=t(e),s=this._getInst(a[0]);i=null!=i?i:this._formatDate(s),s.input&&s.input.val(i),this._updateAlternate(s),(n=this._get(s,"onSelect"))?n.apply(s.input?s.input[0]:null,[i,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],"object"!=typeof s.input[0]&&s.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,n,a,s=this._get(e,"altField");s&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),a=this.formatDate(i,n,this._getFormatConfig(e)),t(s).each((function(){t(this).val(a)})))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,n){if(null==e||null==i)throw"Invalid arguments";if(""==(i="object"==typeof i?""+i:i+""))return null;var a,s,r,o,l=0,c=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,d="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),h=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,u=(n?n.dayNames:null)||this._defaults.dayNames,p=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,g=(n?n.monthNames:null)||this._defaults.monthNames,f=-1,m=-1,v=-1,E=-1,_=!1,b=function(t){var i=e.length>a+1&&e.charAt(a+1)===t;return i&&a++,i},w=function(t){var e=b(t),n="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,a=RegExp("^\\d{"+("y"===t?n:1)+","+n+"}"),s=i.substring(l).match(a);if(!s)throw"Missing number at position "+l;return l+=s[0].length,parseInt(s[0],10)},C=function(e,n,a){var s=-1,r=t.map(b(e)?a:n,(function(t,e){return[[e,t]]})).sort((function(t,e){return-(t[1].length-e[1].length)}));if(t.each(r,(function(t,e){var n=e[1];return i.substr(l,n.length).toLowerCase()===n.toLowerCase()?(s=e[0],l+=n.length,!1):void 0})),-1!==s)return s+1;throw"Unknown name at position "+l},T=function(){if(i.charAt(l)!==e.charAt(a))throw"Unexpected literal at position "+l;l++};for(a=0;e.length>a;a++)if(_)"'"!==e.charAt(a)||b("'")?T():_=!1;else switch(e.charAt(a)){case"d":v=w("d");break;case"D":C("D",h,u);break;case"o":E=w("o");break;case"m":m=w("m");break;case"M":m=C("M",p,g);break;case"y":f=w("y");break;case"@":f=(o=new Date(w("@"))).getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"!":f=(o=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"'":b("'")?T():_=!0;break;default:T()}if(i.length>l&&(r=i.substr(l),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(-1===f?f=(new Date).getFullYear():100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d>=f?0:-100)),E>-1)for(m=1,v=E;!((s=this._getDaysInMonth(f,m-1))>=v);)m++,v-=s;if((o=this._daylightSavingAdjust(new Date(f,m-1,v))).getFullYear()!==f||o.getMonth()+1!==m||o.getDate()!==v)throw"Invalid date";return o},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var n,a=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,s=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,o=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},c=function(t,e,i){var n=""+e;if(l(t))for(;i>n.length;)n="0"+n;return n},d=function(t,e,i,n){return l(t)?n[e]:i[e]},h="",u=!1;if(e)for(n=0;t.length>n;n++)if(u)"'"!==t.charAt(n)||l("'")?h+=t.charAt(n):u=!1;else switch(t.charAt(n)){case"d":h+=c("d",e.getDate(),2);break;case"D":h+=d("D",e.getDay(),a,s);break;case"o":h+=c("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=c("m",e.getMonth()+1,2);break;case"M":h+=d("M",e.getMonth(),r,o);break;case"y":h+=l("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":h+=e.getTime();break;case"!":h+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":u=!0;break;default:h+=t.charAt(n)}return h},_possibleChars:function(t){var e,i="",n=!1,a=function(i){var n=t.length>e+1&&t.charAt(e+1)===i;return n&&e++,n};for(e=0;t.length>e;e++)if(n)"'"!==t.charAt(e)||a("'")?i+=t.charAt(e):n=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":a("'")?i+="'":n=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),n=t.lastVal=t.input?t.input.val():null,a=this._getDefaultDate(t),s=a,r=this._getFormatConfig(t);try{s=this.parseDate(i,n,r)||a}catch(t){n=e?"":n}t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),t.currentDay=n?s.getDate():0,t.currentMonth=n?s.getMonth():0,t.currentYear=n?s.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,n){var a=null==i||""===i?n:"string"==typeof i?function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(t){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,a=n.getFullYear(),s=n.getMonth(),r=n.getDate(),o=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=o.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":s+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(a,s));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(a,s))}l=o.exec(i)}return new Date(a,s,r)}(i):"number"==typeof i?isNaN(i)?n:function(t){var e=new Date;return e.setDate(e.getDate()+t),e}(i):new Date(i.getTime());return(a=a&&"Invalid Date"==""+a?n:a)&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var n=!e,a=t.selectedMonth,s=t.selectedYear,r=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=r.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=r.getMonth(),t.drawYear=t.selectedYear=t.currentYear=r.getFullYear(),a===t.selectedMonth&&s===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(n?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map((function(){var e={prev:function(){t.datepicker._adjustDate(n,-i,"M")},next:function(){t.datepicker._adjustDate(n,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(n)},selectDay:function(){return t.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(n,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])}))},_generateHTML:function(t){var e,i,n,a,s,r,o,l,c,d,h,u,p,g,f,m,v,E,_,b,w,C,T,y,I,A,k,S,O,M,N,R,x,L,D,P,B,F,W,$=new Date,H=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth(),$.getDate())),G=this._get(t,"isRTL"),V=this._get(t,"showButtonPanel"),U=this._get(t,"hideIfNoPrevNext"),j=this._get(t,"navigationAsDateFormat"),q=this._getNumberOfMonths(t),K=this._get(t,"showCurrentAtPos"),Y=this._get(t,"stepMonths"),z=1!==q[0]||1!==q[1],X=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-K,tt=t.drawYear;if(0>Z&&(Z+=12,tt--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-q[0]*q[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(tt,Z,1))>e;)0>--Z&&(Z=11,tt--);for(t.drawMonth=Z,t.drawYear=tt,i=this._get(t,"prevText"),i=j?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,Z-Y,1)),this._getFormatConfig(t)):i,n=this._canAdjustMonth(t,-1,tt,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"e":"w")+"'>"+i+"</span></a>",a=this._get(t,"nextText"),a=j?this.formatDate(a,this._daylightSavingAdjust(new Date(tt,Z+Y,1)),this._getFormatConfig(t)):a,s=this._canAdjustMonth(t,1,tt,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+a+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(G?"w":"e")+"'>"+a+"</span></a>",r=this._get(t,"currentText"),o=this._get(t,"gotoCurrent")&&t.currentDay?X:H,r=j?this.formatDate(r,o,this._getFormatConfig(t)):r,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",c=V?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(G?l:"")+(this._isInRange(t,o)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+(G?"":l)+"</div>":"",d=parseInt(this._get(t,"firstDay"),10),d=isNaN(d)?0:d,h=this._get(t,"showWeek"),u=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),g=this._get(t,"monthNames"),f=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),E=this._get(t,"selectOtherMonths"),_=this._getDefaultDate(t),b="",C=0;q[0]>C;C++){for(T="",this.maxRows=4,y=0;q[1]>y;y++){if(I=this._daylightSavingAdjust(new Date(tt,Z,t.selectedDay)),A=" ui-corner-all",k="",z){if(k+="<div class='ui-datepicker-group",q[1]>1)switch(y){case 0:k+=" ui-datepicker-group-first",A=" ui-corner-"+(G?"right":"left");break;case q[1]-1:k+=" ui-datepicker-group-last",A=" ui-corner-"+(G?"left":"right");break;default:k+=" ui-datepicker-group-middle",A=""}k+="'>"}for(k+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+A+"'>"+(/all|left/.test(A)&&0===C?G?s:n:"")+(/all|right/.test(A)&&0===C?G?n:s:"")+this._generateMonthYearHeader(t,Z,tt,Q,J,C>0||y>0,g,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",S=h?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)S+="<th scope='col'"+((w+d+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[O=(w+d)%7]+"'>"+p[O]+"</span></th>";for(k+=S+"</tr></thead><tbody>",M=this._getDaysInMonth(tt,Z),tt===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,M)),N=(this._getFirstDayOfMonth(tt,Z)-d+7)%7,R=Math.ceil((N+M)/7),x=z&&this.maxRows>R?this.maxRows:R,this.maxRows=x,L=this._daylightSavingAdjust(new Date(tt,Z,1-N)),D=0;x>D;D++){for(k+="<tr>",P=h?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(L)+"</td>":"",w=0;7>w;w++)B=m?m.apply(t.input?t.input[0]:null,[L]):[!0,""],W=(F=L.getMonth()!==Z)&&!E||!B[0]||Q&&Q>L||J&&L>J,P+="<td class='"+((w+d+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(L.getTime()===I.getTime()&&Z===t.selectedMonth&&t._keyEvent||_.getTime()===L.getTime()&&_.getTime()===I.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!v?"":" "+B[1]+(L.getTime()===X.getTime()?" "+this._currentClass:"")+(L.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(F&&!v||!B[2]?"":" title='"+B[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+L.getMonth()+"' data-year='"+L.getFullYear()+"'")+">"+(F&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+L.getDate()+"</span>":"<a class='ui-state-default"+(L.getTime()===H.getTime()?" ui-state-highlight":"")+(L.getTime()===X.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+L.getDate()+"</a>")+"</td>",L.setDate(L.getDate()+1),L=this._daylightSavingAdjust(L);k+=P+"</tr>"}++Z>11&&(Z=0,tt++),T+=k+="</tbody></table>"+(z?"</div>"+(q[0]>0&&y===q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}b+=T}return b+=c,t._keyEvent=!1,b},_generateMonthYearHeader:function(t,e,i,n,a,s,r,o){var l,c,d,h,u,p,g,f,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),E=this._get(t,"showMonthAfterYear"),_="<div class='ui-datepicker-title'>",b="";if(s||!m)b+="<span class='ui-datepicker-month'>"+r[e]+"</span>";else{for(l=n&&n.getFullYear()===i,c=a&&a.getFullYear()===i,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",d=0;12>d;d++)(!l||d>=n.getMonth())&&(!c||a.getMonth()>=d)&&(b+="<option value='"+d+"'"+(d===e?" selected='selected'":"")+">"+o[d]+"</option>");b+="</select>"}if(E||(_+=b+(!s&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",s||!v)_+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(h=this._get(t,"yearRange").split(":"),u=(new Date).getFullYear(),g=(p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?u+parseInt(t,10):parseInt(t,10);return isNaN(e)?u:e})(h[0]),f=Math.max(g,p(h[1]||"")),g=n?Math.max(g,n.getFullYear()):g,f=a?Math.min(f,a.getFullYear()):f,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f>=g;g++)t.yearshtml+="<option value='"+g+"'"+(g===i?" selected='selected'":"")+">"+g+"</option>";t.yearshtml+="</select>",_+=t.yearshtml,t.yearshtml=null}return _+=this._get(t,"yearSuffix"),E&&(_+=(!s&&m&&v?"":"&#xa0;")+b),_+"</div>"},_adjustInstDate:function(t,e,i){var n=t.drawYear+("Y"===i?e:0),a=t.drawMonth+("M"===i?e:0),s=Math.min(t.selectedDay,this._getDaysInMonth(n,a))+("D"===i?e:0),r=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(n,a,s)));t.selectedDay=r.getDate(),t.drawMonth=t.selectedMonth=r.getMonth(),t.drawYear=t.selectedYear=r.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),n=this._getMinMaxDate(t,"max"),a=i&&i>e?i:e;return n&&a>n?n:a},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,n){var a=this._getNumberOfMonths(t),s=this._daylightSavingAdjust(new Date(i,n+(0>e?e:a[0]*a[1]),1));return 0>e&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(t,s)},_isInRange:function(t,e){var i,n,a=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),r=null,o=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),n=(new Date).getFullYear(),r=parseInt(i[0],10),o=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(r+=n),i[1].match(/[+\-].*/)&&(o+=n)),(!a||e.getTime()>=a.getTime())&&(!s||e.getTime()<=s.getTime())&&(!r||e.getFullYear()>=r)&&(!o||o>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return{shortYearCutoff:e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,n){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var a=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(n,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),a,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each((function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)})):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new n,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.11.1",t.datepicker,t.widget("ui.dialog",{version:"1.11.1",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i,n=this;if(this._isOpen&&!1!==this._trigger("beforeClose",e)){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{(i=this.document[0].activeElement)&&"body"!==i.nodeName.toLowerCase()&&t(i).blur()}catch(t){}this._hide(this.uiDialog,this.options.hide,(function(){n._trigger("close",e)}))}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var n=!1,a=this.uiDialog.siblings(".ui-front:visible").map((function(){return+t(this).css("z-index")})).get(),s=Math.max.apply(null,a);return s>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",s+1),n=!0),n&&!i&&this._trigger("focus",e),n},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,(function(){e._focusTabbable(),e._trigger("focus")})),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement;this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),a=i.filter(":last");e.target!==a[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==n[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay((function(){a.focus()})),e.preventDefault()):(this._delay((function(){n.focus()})),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(t.each(i,(function(i,n){var a,s;n=t.isFunction(n)?{click:n,text:i}:n,n=t.extend({type:"button"},n),a=n.click,n.click=function(){a.apply(e.element[0],arguments)},s={icons:n.icons,text:n.showText},delete n.icons,delete n.showText,t("<button></button>",n).button(s).appendTo(e.uiButtonSet)})),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,a){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,e(a))},drag:function(t,n){i._trigger("drag",t,e(n))},stop:function(a,s){var r=s.offset.left-i.document.scrollLeft(),o=s.offset.top-i.document.scrollTop();n.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(o>=0?"+":"")+o,of:i.window},t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",a,e(s))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,n=this.options,a=n.resizable,s=this.uiDialog.css("position"),r="string"==typeof a?a:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:r,start:function(n,a){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,e(a))},resize:function(t,n){i._trigger("resize",t,e(n))},stop:function(a,s){var r=i.uiDialog.offset(),o=r.left-i.document.scrollLeft(),l=r.top-i.document.scrollTop();n.height=i.uiDialog.height(),n.width=i.uiDialog.width(),n.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(l>=0?"+":"")+l,of:i.window},t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",a,e(s))}}).css("position",s)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,n=!1,a={};t.each(e,(function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(n=!0),t in i.resizableRelatedOptions&&(a[t]=e)})),n&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(t,e){var i,n,a=this.uiDialog;"dialogClass"===t&&a.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&((i=a.is(":data(ui-draggable)"))&&!e&&a.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&((n=a.is(":data(ui-resizable)"))&&!e&&a.resizable("destroy"),n&&"string"==typeof e&&a.resizable("option","handles",e),n||!1===e||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),e=Math.max(0,n.minHeight-t),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-t):"none","auto"===n.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map((function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay((function(){e=!1})),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),t.widget("ui.progressbar",{version:"1.11.1",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=!1===t,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectmenu",{version:"1.11.1",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var e=this,i=this.element.attr("tabindex");this.label=t("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:i||this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),t("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=t("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",(function(){e.menuItems||e._refreshMenu()})),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(t,i){t.preventDefault(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var n=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&n.index!==e.focusIndex&&(e._trigger("focus",t,{item:n}),e.isOpen||e._select(n,t)),e.focusIndex=n.index,e.button.attr("aria-activedescendant",e.menuItems.eq(n.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var t,e=this.element.find("option");e.length&&(this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(e,i){var n=this,a="";t.each(i,(function(i,s){s.optgroup!==a&&(t("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(s.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:s.optgroup}).appendTo(e),a=s.optgroup),n._renderItemData(e,s)}))},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var n=t("<li>");return i.disabled&&n.addClass("ui-state-disabled"),this._setText(n,i.label),n.appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,n,a=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),a+=":not(.ui-state-disabled)"),(n="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](a).eq(-1):i[t+"All"](a).eq(0)).length&&this.menuInstance.focus(e,n)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(e))}},_buttonEvents:{mousedown:function(t){t.preventDefault()},click:"_toggle",keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex);e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this._setText(this.buttonText,t.label),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){"icons"===t&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(e.button),this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"disabled"===t&&(this.menuInstance.option("disabled",e),this.button.toggleClass("ui-state-disabled",e).attr("aria-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===t&&this._resizeButton()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;t||(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(e){var i=[];e.each((function(e,n){var a=t(n),s=a.parent("optgroup");i.push({element:a,index:e,value:a.attr("value"),label:a.text(),optgroup:s.attr("label")||"",disabled:s.prop("disabled")||a.prop("disabled")})})),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),t.widget("ui.slider",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,n=this.options,a=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s=[];for(i=n.values&&n.values.length||1,a.length>i&&(a.slice(i).remove(),a=a.slice(0,i)),e=a.length;i>e;e++)s.push("<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>");this.handles=a.add(t(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each((function(e){t(this).data("ui-slider-handle-index",e)}))},_createRange:function(){var e=this.options,i="";e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,n,a,s,r,o,l,c=this,d=this.options;return!d.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each((function(e){var i=Math.abs(n-c.values(e));(a>i||a===i&&(e===c._lastChangedValue||c.values(e)===d.min))&&(a=i,s=t(this),r=e)})),!1!==this._start(e,r)&&(this._mouseSliding=!0,this._handleIndex=r,s.addClass("ui-state-active").focus(),o=s.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-o.left-s.width()/2,top:e.pageY-o.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,r,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,a,s;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(n=i/e)>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),a=this._valueMax()-this._valueMin(),s=this._valueMin()+n*a,this._trimAlignValue(s)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,a,s;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&!0===this.options.range&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&((a=this.values())[e]=i,s=this._trigger("slide",t,{handle:this.handles[e],value:i,values:a}),n=this.values(e?0:1),!1!==s&&this.values(e,i))):i!==this.value()&&!1!==(s=this._trigger("slide",t,{handle:this.handles[e],value:i}))&&this.value(i)},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var n,a,s;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,a=arguments[0],s=0;n.length>s;s+=1)n[s]=this._trimAlignValue(a[s]),this._change(null,s);this._refreshValue()},_setOption:function(e,i){var n,a=0;switch("range"===e&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(a=this.options.values.length),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!i),this._super(e,i),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;a>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;i.length>n;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,n,a,s,r=this.options.range,o=this.options,l=this,c=!this._animateOff&&o.animate,d={};this.options.values&&this.options.values.length?this.handles.each((function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,d["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[c?"animate":"css"](d,o.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:o.animate}))),e=i})):(n=this.value(),a=this._valueMin(),s=this._valueMax(),i=s!==a?(n-a)/(s-a)*100:0,d["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](d,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))},_handleEvents:{keydown:function(e){var i,n,a,s=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),!1===this._start(e,s)))return}switch(a=this.options.step,i=n=this.options.values&&this.options.values.length?this.values(s):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(i===this._valueMax())return;n=this._trimAlignValue(i+a);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i===this._valueMin())return;n=this._trimAlignValue(i-a)}this._slide(e,s,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}}),t.widget("ui.spinner",{version:"1.11.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],(function(t,n){var a=i.attr(n);void 0!==a&&a.length&&(e[n]=a)})),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay((function(){this.spinning&&this._stop(t)}),100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=n,this._delay((function(){this.previous=n})))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur,i.call(this)})),!1!==this._start(e)&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?!1!==this._start(e)&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,n=t.ui.keyCode;switch(e.keyCode){case n.UP:return this._repeat(null,1,e),!0;case n.DOWN:return this._repeat(null,-1,e),!0;case n.PAGE_UP:return this._repeat(null,i.page,e),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return!(!this.spinning&&!1===this._trigger("start",t)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay((function(){this._repeat(40,e,i)}),t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",e,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,n=this.options;return i=t-(e=null!==n.min?n.min:0),t=e+(i=Math.round(i/n.step)*n.step),t=parseFloat(t.toFixed(this._precision())),null!==n.max&&t>n.max?n.max:null!==n.min&&n.min>t?n.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(i))}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable"))},_setOptions:o((function(t){this._super(t)})),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&null!==(i=this._parse(t))&&(e||(i=this._adjustValue(i)),t=this._format(i)),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:o((function(t){this._stepUp(t)})),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:o((function(t){this._stepDown(t)})),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:o((function(t){this._stepUp((t||1)*this.options.page)})),pageDown:o((function(t){this._stepDown((t||1)*this.options.page)})),value:function(t){return arguments.length?void o(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.widget("ui.tabs",{version:"1.11.1",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,n;i=(e=e.cloneNode(!1)).href.replace(t,""),n=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(t){}try{n=decodeURIComponent(n)}catch(t){}return e.hash.length>1&&i===n}}(),_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),(function(t){return e.tabs.index(t)})))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,n=location.hash.substring(1);return null===e&&(n&&this.tabs.each((function(i,a){return t(a).attr("aria-controls")===n?(e=i,!1):void 0})),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=!!this.tabs.length&&0)),!1!==e&&-1===(e=this.tabs.index(this.tabs.eq(e)))&&(e=!i&&0),!i&&!1===e&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(this.document[0].activeElement).closest("li"),n=this.tabs.index(i),a=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:n++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:a=!1,n--;break;case t.ui.keyCode.END:n=this.anchors.length-1;break;case t.ui.keyCode.HOME:n=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(n);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(n!==this.options.active&&n);default:return}e.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,a),e.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay((function(){this.option("active",n)}),this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){for(var n=this.tabs.length-1;-1!==t.inArray((e>n&&(e=0),0>e&&(e=n),e),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,e){return"active"===t?void this._activate(e):"disabled"===t?void this._setupDisabled(e):(this._super(t,e),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",e),e||!1!==this.options.active||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),(function(t){return i.index(t)})),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,(function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()})).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,(function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()})),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map((function(){return t("a",this)[0]})).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each((function(i,n){var a,s,r,o=t(n).uniqueId().attr("id"),l=t(n).closest("li"),c=l.attr("aria-controls");e._isLocal(n)?(r=(a=n.hash).substring(1),s=e.element.find(e._sanitizeSelector(a))):(a="#"+(r=l.attr("aria-controls")||t({}).uniqueId()[0].id),(s=e.element.find(a)).length||(s=e._createPanel(r)).insertAfter(e.panels[i-1]||e.tablist),s.attr("aria-live","polite")),s.length&&(e.panels=e.panels.add(s)),c&&l.data("ui-tabs-aria-controls",c),l.attr({"aria-controls":r,"aria-labelledby":o}),s.attr("aria-labelledby",o)})),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,n=0;i=this.tabs[n];n++)!0===e||-1!==t.inArray(n,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),(function(t,e){i[e]="_eventHandler"})),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,n=this.element.parent();"fill"===e?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each((function(){var e=t(this),n=e.css("position");"absolute"!==n&&"fixed"!==n&&(i-=e.outerHeight(!0))})),this.element.children().not(this.panels).each((function(){i-=t(this).outerHeight(!0)})),this.panels.each((function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))})).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each((function(){i=Math.max(i,t(this).height("").height())})).height(i))},_eventHandler:function(e){var i=this.options,n=this.active,a=t(e.currentTarget).closest("li"),s=a[0]===n[0],r=s&&i.collapsible,o=r?t():this._getPanelForTab(a),l=n.length?this._getPanelForTab(n):t(),c={oldTab:n,oldPanel:l,newTab:r?t():a,newPanel:o};e.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||!1===this._trigger("beforeActivate",e,c)||(i.active=!r&&this.tabs.index(a),this.active=s?t():a,this.xhr&&this.xhr.abort(),l.length||o.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),o.length&&this.load(this.tabs.index(a),e),this._toggle(e,c))},_toggle:function(e,i){function n(){s.running=!1,s._trigger("activate",e,i)}function a(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),r.length&&s.options.show?s._show(r,s.options.show,n):(r.show(),n())}var s=this,r=i.newPanel,o=i.oldPanel;this.running=!0,o.length&&this.options.hide?this._hide(o,this.options.hide,(function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a()})):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o.hide(),a()),o.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),r.length&&o.length?i.oldTab.attr("tabIndex",-1):r.length&&this.tabs.filter((function(){return 0===t(this).attr("tabIndex")})).attr("tabIndex",-1),r.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,n=this._findActive(e);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return!1===e?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each((function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")})),this.tabs.each((function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")})),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;!1!==i&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,(function(t){return t!==e?t:null})):t.map(this.tabs,(function(t,i){return i!==e?i:null}))),this._setupDisabled(i))},disable:function(e){var i=this.options.disabled;if(!0!==i){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setupDisabled(i)}},load:function(e,i){e=this._getIndex(e);var n=this,a=this.tabs.eq(e),s=a.find(".ui-tabs-anchor"),r=this._getPanelForTab(a),o={tab:a,panel:r};this._isLocal(s[0])||(this.xhr=t.ajax(this._ajaxSettings(s,i,o)),this.xhr&&"canceled"!==this.xhr.statusText&&(a.addClass("ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.success((function(t){setTimeout((function(){r.html(t),n._trigger("load",i,o)}),1)})).complete((function(t,e){setTimeout((function(){"abort"===e&&n.panels.stop(!1,!0),a.removeClass("ui-tabs-loading"),r.removeAttr("aria-busy"),t===n.xhr&&delete n.xhr}),1)}))))},_ajaxSettings:function(e,i,n){var a=this;return{url:e.attr("href"),beforeSend:function(e,s){return a._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:s},n))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.widget("ui.tooltip",{version:"1.11.1",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var n=(e.attr("aria-describedby")||"").split(/\s+/);n.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(n.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),n=(e.attr("aria-describedby")||"").split(/\s+/),a=t.inArray(i,n);-1!==a&&n.splice(a,1),e.removeData("ui-tooltip-id"),(n=t.trim(n.join(" ")))?e.attr("aria-describedby",n):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(e,i){var n=this;return"disabled"===e?(this[i?"_disable":"_enable"](),void(this.options[e]=i)):(this._super(e,i),void("content"===e&&t.each(this.tooltips,(function(t,e){n._updateContent(e)}))))},_disable:function(){var e=this;t.each(this.tooltips,(function(i,n){var a=t.Event("blur");a.target=a.currentTarget=n[0],e.close(a,!0)})),this.element.find(this.options.items).addBack().each((function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).removeAttr("title")}))},_enable:function(){this.element.find(this.options.items).addBack().each((function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}))},open:function(e){var i=this,n=t(e?e.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&n.parents().each((function(){var e,n=t(this);n.data("ui-tooltip-open")&&((e=t.Event("blur")).target=e.currentTarget=this,i.close(e,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))})),this._updateContent(n,e))},_updateContent:function(t,e){var i,n=this.options.content,a=this,s=e?e.type:null;return"string"==typeof n?this._open(e,t,n):void((i=n.call(t[0],(function(i){t.data("ui-tooltip-open")&&a._delay((function(){e&&(e.type=s),this._open(e,t,i)}))})))&&this._open(e,t,i))},_open:function(e,i,n){function a(t){c.of=t,s.is(":hidden")||s.position(c)}var s,r,o,l,c=t.extend({},this.options.position);if(n){if((s=this._find(i)).length)return void s.find(".ui-tooltip-content").html(n);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),s=this._tooltip(i),this._addDescribedBy(i,s.attr("id")),s.find(".ui-tooltip-content").html(n),this.liveRegion.children().hide(),n.clone?(l=n.clone()).removeAttr("id").find("[id]").removeAttr("id"):l=n,t("<div>").html(l).appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:a}),a(e)):s.position(t.extend({of:i},this.options.position)),this.hiding=!1,this.closing=!1,s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(o=this.delayedShow=setInterval((function(){s.is(":visible")&&(a(c.of),clearInterval(o))}),t.fx.interval)),this._trigger("open",e,{tooltip:s}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var n=t.Event(e);n.currentTarget=i[0],this.close(n,!0)}}},i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(s)}),e&&"mouseover"!==e.type||(r.mouseleave="close"),e&&"focusin"!==e.type||(r.focusout="close"),this._on(!0,i,r)}},close:function(e){var i=this,n=t(e?e.currentTarget:this.element),a=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),this.hiding=!0,a.stop(!0),this._hide(a,this.options.hide,(function(){i._removeTooltip(t(this)),this.hiding=!1,this.closing=!1})),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,(function(e,n){t(n.element).attr("title",n.title),delete i.parents[e]})),this.closing=!0,this._trigger("close",e,{tooltip:a}),this.hiding||(this.closing=!1))},_tooltip:function(e){var i=t("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),n=i.uniqueId().attr("id");return t("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[n]=e,i},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,(function(i,n){var a=t.Event("blur");a.target=a.currentTarget=n[0],e.close(a,!0),t("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title")||n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})),this.liveRegion.remove()}});var v="ui-effects-",E=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var n=d[e.type]||{};return null==t?i||!e.def?null:e.def:(t=n.floor?~~t:parseFloat(t),isNaN(t)?e.def:n.mod?(t+n.mod)%n.mod:0>t?0:t>n.max?n.max:t)}function n(i){var n=l(),a=n._rgba=[];return i=i.toLowerCase(),p(o,(function(t,s){var r,o=s.re.exec(i),l=o&&s.parse(o),d=s.space||"rgba";return l?(r=n[d](l),n[c[d].cache]=r[c[d].cache],a=n._rgba=r._rgba,!1):e})),a.length?("0,0,0,0"===a.join()&&t.extend(a,s.transparent),n):s[i]}function a(t,e,i){return 1>6*(i=(i+1)%1)?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var s,r=/^([\-+])=\s*(\d+\.?\d*)/,o=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,n,a){return new t.Color.fn.parse(e,i,n,a)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=l.support={},u=t("<p>")[0],p=t.each;u.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=u.style.backgroundColor.indexOf("rgba")>-1,p(c,(function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}})),l.fn=t.extend(l.prototype,{parse:function(a,r,o,d){if(a===e)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=t(a).css(r),r=e);var h=this,u=t.type(a),g=this._rgba=[];return r!==e&&(a=[a,r,o,d],u="array"),"string"===u?this.parse(n(a)||s._default):"array"===u?(p(c.rgba.props,(function(t,e){g[e.idx]=i(a[e.idx],e)})),this):"object"===u?(p(c,a instanceof l?function(t,e){a[e.cache]&&(h[e.cache]=a[e.cache].slice())}:function(e,n){var s=n.cache;p(n.props,(function(t,e){if(!h[s]&&n.to){if("alpha"===t||null==a[t])return;h[s]=n.to(h._rgba)}h[s][e.idx]=i(a[t],e,!0)})),h[s]&&0>t.inArray(null,h[s].slice(0,3))&&(h[s][3]=1,n.from&&(h._rgba=n.from(h[s])))}),this):e},is:function(t){var i=l(t),n=!0,a=this;return p(c,(function(t,s){var r,o=i[s.cache];return o&&(r=a[s.cache]||s.to&&s.to(a._rgba)||[],p(s.props,(function(t,i){return null!=o[i.idx]?n=o[i.idx]===r[i.idx]:e}))),n})),n},_space:function(){var t=[],e=this;return p(c,(function(i,n){e[n.cache]&&t.push(i)})),t.pop()},transition:function(t,e){var n=l(t),a=n._space(),s=c[a],r=0===this.alpha()?l("transparent"):this,o=r[s.cache]||s.to(r._rgba),h=o.slice();return n=n[s.cache],p(s.props,(function(t,a){var s=a.idx,r=o[s],l=n[s],c=d[a.type]||{};null!==l&&(null===r?h[s]=l:(c.mod&&(l-r>c.mod/2?r+=c.mod:r-l>c.mod/2&&(r-=c.mod)),h[s]=i((l-r)*e+r,a)))})),this[a](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),a=l(e)._rgba;return l(t.map(i,(function(t,e){return(1-n)*a[e]+n*t})))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,(function(t,e){return null==t?e>2?1:0:t}));return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),(function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t}));return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),n=i.pop();return e&&i.push(~~(255*n)),"#"+t.map(i,(function(t){return 1===(t=(t||0).toString(16)).length?"0"+t:t})).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,n=t[0]/255,a=t[1]/255,s=t[2]/255,r=t[3],o=Math.max(n,a,s),l=Math.min(n,a,s),c=o-l,d=o+l,h=.5*d;return e=l===o?0:n===o?60*(a-s)/c+360:a===o?60*(s-n)/c+120:60*(n-a)/c+240,i=0===c?0:.5>=h?c/d:c/(2-d),[Math.round(e)%360,i,h,null==r?1:r]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],n=t[2],s=t[3],r=.5>=n?n*(1+i):n+i-n*i,o=2*n-r;return[Math.round(255*a(o,r,e+1/3)),Math.round(255*a(o,r,e)),Math.round(255*a(o,r,e-1/3)),s]},p(c,(function(n,a){var s=a.props,o=a.cache,c=a.to,d=a.from;l.fn[n]=function(n){if(c&&!this[o]&&(this[o]=c(this._rgba)),n===e)return this[o].slice();var a,r=t.type(n),h="array"===r||"object"===r?n:arguments,u=this[o].slice();return p(s,(function(t,e){var n=h["object"===r?t:e.idx];null==n&&(n=u[e.idx]),u[e.idx]=i(n,e)})),d?((a=l(d(u)))[o]=u,a):l(u)},p(s,(function(e,i){l.fn[e]||(l.fn[e]=function(a){var s,o=t.type(a),l="alpha"===e?this._hsla?"hsla":"rgba":n,c=this[l](),d=c[i.idx];return"undefined"===o?d:("function"===o&&(a=a.call(this,d),o=t.type(a)),null==a&&i.empty?this:("string"===o&&(s=r.exec(a))&&(a=d+parseFloat(s[2])*("+"===s[1]?1:-1)),c[i.idx]=a,this[l](c)))})}))})),l.hook=function(e){var i=e.split(" ");p(i,(function(e,i){t.cssHooks[i]={set:function(e,a){var s,r,o="";if("transparent"!==a&&("string"!==t.type(a)||(s=n(a)))){if(a=l(s||a),!h.rgba&&1!==a._rgba[3]){for(r="backgroundColor"===i?e.parentNode:e;(""===o||"transparent"===o)&&r&&r.style;)try{o=t.css(r,"backgroundColor"),r=r.parentNode}catch(t){}a=a.blend(o&&"transparent"!==o?o:"_default")}a=a.toRgbaString()}try{e.style[i]=a}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}}))},l.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),t.cssHooks.borderColor={expand:function(t){var e={};return p(["Top","Right","Bottom","Left"],(function(i,n){e["border"+n+"Color"]=t})),e}},s=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(E),function(){function e(e){var i,n,a=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,s={};if(a&&a.length&&a[0]&&a[a[0]])for(n=a.length;n--;)"string"==typeof a[i=a[n]]&&(s[t.camelCase(i)]=a[i]);else for(i in a)"string"==typeof a[i]&&(s[i]=a[i]);return s}function i(e,i){var n,s,r={};for(n in i)s=i[n],e[n]!==s&&(a[n]||(t.fx.step[n]||!isNaN(parseFloat(s)))&&(r[n]=s));return r}var n=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],(function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(E.style(t.elem,i,t.end),t.setAttr=!0)}})),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(a,s,r,o){var l=t.speed(s,r,o);return this.queue((function(){var s,r=t(this),o=r.attr("class")||"",c=l.children?r.find("*").addBack():r;c=c.map((function(){return{el:t(this),start:e(this)}})),(s=function(){t.each(n,(function(t,e){a[e]&&r[e+"Class"](a[e])}))})(),c=c.map((function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this})),r.attr("class",o),c=c.map((function(){var e=this,i=t.Deferred(),n=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,n),i.promise()})),t.when.apply(t,c.get()).done((function(){s(),t.each(arguments,(function(){var e=this.el;t.each(this.diff,(function(t){e.css(t,"")}))})),l.complete.call(r[0])}))}))},t.fn.extend({addClass:function(e){return function(i,n,a,s){return n?t.effects.animateClass.call(this,{add:i},n,a,s):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,n,a,s){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},n,a,s):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,n,a,s,r){return"boolean"==typeof n||void 0===n?a?t.effects.animateClass.call(this,n?{add:i}:{remove:i},a,s,r):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},n,a,s)}}(t.fn.toggleClass),switchClass:function(e,i,n,a,s){return t.effects.animateClass.call(this,{add:i,remove:e},n,a,s)}})}(),function(){function e(e,i,n,a){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(a=i,n=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(a=n,n=i,i={}),t.isFunction(n)&&(a=n,n=null),i&&t.extend(e,i),n=n||i.duration,e.duration=t.fx.off?0:"number"==typeof n?n:n in t.fx.speeds?t.fx.speeds[n]:t.fx.speeds._default,e.complete=a||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||"string"==typeof e&&!t.effects.effect[e]||!!t.isFunction(e)||"object"==typeof e&&!e.effect}t.extend(t.effects,{version:"1.11.1",save:function(t,e){for(var i=0;e.length>i;i++)null!==e[i]&&t.data(v+e[i],t[0].style[e[i]])},restore:function(t,e){var i,n;for(n=0;e.length>n;n++)null!==e[n]&&(void 0===(i=t.data(v+e[n]))&&(i=""),t.css(e[n],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,n;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=t[1]/e.width}return{x:n,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},n=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:e.width(),height:e.height()},s=document.activeElement;try{s.id}catch(t){s=document.body}return e.wrap(n),(e[0]===s||t.contains(e[0],s))&&t(s).focus(),n=e.parent(),"static"===e.css("position")?(n.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],(function(t,n){i[n]=e.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")})),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(a),n.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,n,a){return a=a||{},t.each(i,(function(t,i){var s=e.cssUnit(i);s[0]>0&&(a[i]=s[0]*n+s[1])})),a}}),t.fn.extend({effect:function(){function i(e){function i(){t.isFunction(s)&&s.call(a[0]),t.isFunction(e)&&e()}var a=t(this),s=n.complete,o=n.mode;(a.is(":hidden")?"hide"===o:"show"===o)?(a[o](),i()):r.call(a[0],n,i)}var n=e.apply(this,arguments),a=n.mode,s=n.queue,r=t.effects.effect[n.effect];return t.fx.off||!r?a?this[a](n.duration,n.complete):this.each((function(){n.complete&&n.complete.call(this)})):!1===s?this.each(i):this.queue(s||"fx",i)},show:function(t){return function(n){if(i(n))return t.apply(this,arguments);var a=e.apply(this,arguments);return a.mode="show",this.effect.call(this,a)}}(t.fn.show),hide:function(t){return function(n){if(i(n))return t.apply(this,arguments);var a=e.apply(this,arguments);return a.mode="hide",this.effect.call(this,a)}}(t.fn.hide),toggle:function(t){return function(n){if(i(n)||"boolean"==typeof n)return t.apply(this,arguments);var a=e.apply(this,arguments);return a.mode="toggle",this.effect.call(this,a)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),n=[];return t.each(["em","px","%","pt"],(function(t,e){i.indexOf(e)>0&&(n=[parseFloat(i),e])})),n}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],(function(t,i){e[i]=function(e){return Math.pow(e,t+2)}})),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,(function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}}))}(),t.effects,t.effects.effect.blind=function(e,i){var n,a,s,r=t(this),o=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(r,e.mode||"hide"),c=e.direction||"up",d=/up|down|vertical/.test(c),h=d?"height":"width",u=d?"top":"left",p=/up|left|vertical|horizontal/.test(c),g={},f="show"===l;r.parent().is(".ui-effects-wrapper")?t.effects.save(r.parent(),o):t.effects.save(r,o),r.show(),a=(n=t.effects.createWrapper(r).css({overflow:"hidden"}))[h](),s=parseFloat(n.css(u))||0,g[h]=f?a:0,p||(r.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),g[u]=f?s:a+s),f&&(n.css(h,0),p||n.css(u,s+a)),n.animate(g,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===l&&r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()}})},t.effects.effect.bounce=function(e,i){var n,a,s,r=t(this),o=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(r,e.mode||"effect"),c="hide"===l,d="show"===l,h=e.direction||"up",u=e.distance,p=e.times||5,g=2*p+(d||c?1:0),f=e.duration/g,m=e.easing,v="up"===h||"down"===h?"top":"left",E="up"===h||"left"===h,_=r.queue(),b=_.length;for((d||c)&&o.push("opacity"),t.effects.save(r,o),r.show(),t.effects.createWrapper(r),u||(u=r["top"===v?"outerHeight":"outerWidth"]()/3),d&&((s={opacity:1})[v]=0,r.css("opacity",0).css(v,E?2*-u:2*u).animate(s,f,m)),c&&(u/=Math.pow(2,p-1)),(s={})[v]=0,n=0;p>n;n++)(a={})[v]=(E?"-=":"+=")+u,r.animate(a,f,m).animate(s,f,m),u=c?2*u:u/2;c&&((a={opacity:0})[v]=(E?"-=":"+=")+u,r.animate(a,f,m)),r.queue((function(){c&&r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()})),b>1&&_.splice.apply(_,[1,0].concat(_.splice(b,g+1))),r.dequeue()},t.effects.effect.clip=function(e,i){var n,a,s,r=t(this),o=["position","top","bottom","left","right","height","width"],l="show"===t.effects.setMode(r,e.mode||"hide"),c="vertical"===(e.direction||"vertical"),d=c?"height":"width",h=c?"top":"left",u={};t.effects.save(r,o),r.show(),n=t.effects.createWrapper(r).css({overflow:"hidden"}),s=(a="IMG"===r[0].tagName?n:r)[d](),l&&(a.css(d,0),a.css(h,s/2)),u[d]=l?s:0,u[h]=l?0:s/2,a.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){l||r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()}})},t.effects.effect.drop=function(e,i){var n,a=t(this),s=["position","top","bottom","left","right","opacity","height","width"],r=t.effects.setMode(a,e.mode||"hide"),o="show"===r,l=e.direction||"left",c="up"===l||"down"===l?"top":"left",d="up"===l||"left"===l?"pos":"neg",h={opacity:o?1:0};t.effects.save(a,s),a.show(),t.effects.createWrapper(a),n=e.distance||a["top"===c?"outerHeight":"outerWidth"](!0)/2,o&&a.css("opacity",0).css(c,"pos"===d?-n:n),h[c]=(o?"pos"===d?"+=":"-=":"pos"===d?"-=":"+=")+n,a.animate(h,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===r&&a.hide(),t.effects.restore(a,s),t.effects.removeWrapper(a),i()}})},t.effects.effect.explode=function(e,i){function n(){v.push(this),v.length===d*h&&(u.css({visibility:"visible"}),t(v).remove(),p||u.hide(),i())}var a,s,r,o,l,c,d=e.pieces?Math.round(Math.sqrt(e.pieces)):3,h=d,u=t(this),p="show"===t.effects.setMode(u,e.mode||"hide"),g=u.show().css("visibility","hidden").offset(),f=Math.ceil(u.outerWidth()/h),m=Math.ceil(u.outerHeight()/d),v=[];for(a=0;d>a;a++)for(o=g.top+a*m,c=a-(d-1)/2,s=0;h>s;s++)r=g.left+s*f,l=s-(h-1)/2,u.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*f,top:-a*m}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:m,left:r+(p?l*f:0),top:o+(p?c*m:0),opacity:p?0:1}).animate({left:r+(p?0:l*f),top:o+(p?0:c*m),opacity:p?1:0},e.duration||500,e.easing,n)},t.effects.effect.fade=function(e,i){var n=t(this),a=t.effects.setMode(n,e.mode||"toggle");n.animate({opacity:a},{queue:!1,duration:e.duration,easing:e.easing,complete:i})},t.effects.effect.fold=function(e,i){var n,a,s=t(this),r=["position","top","bottom","left","right","height","width"],o=t.effects.setMode(s,e.mode||"hide"),l="show"===o,c="hide"===o,d=e.size||15,h=/([0-9]+)%/.exec(d),u=!!e.horizFirst,p=l!==u,g=p?["width","height"]:["height","width"],f=e.duration/2,m={},v={};t.effects.save(s,r),s.show(),n=t.effects.createWrapper(s).css({overflow:"hidden"}),a=p?[n.width(),n.height()]:[n.height(),n.width()],h&&(d=parseInt(h[1],10)/100*a[c?0:1]),l&&n.css(u?{height:0,width:d}:{height:d,width:0}),m[g[0]]=l?a[0]:d,v[g[1]]=l?a[1]:0,n.animate(m,f,e.easing).animate(v,f,e.easing,(function(){c&&s.hide(),t.effects.restore(s,r),t.effects.removeWrapper(s),i()}))},t.effects.effect.highlight=function(e,i){var n=t(this),a=["backgroundImage","backgroundColor","opacity"],s=t.effects.setMode(n,e.mode||"show"),r={backgroundColor:n.css("backgroundColor")};"hide"===s&&(r.opacity=0),t.effects.save(n,a),n.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&n.hide(),t.effects.restore(n,a),i()}})},t.effects.effect.size=function(e,i){var n,a,s,r=t(this),o=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["width","height","overflow"],c=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=t.effects.setMode(r,e.mode||"effect"),p=e.restore||"effect"!==u,g=e.scale||"both",f=e.origin||["middle","center"],m=r.css("position"),v=p?o:["position","top","bottom","left","right","overflow","opacity"],E={height:0,width:0,outerHeight:0,outerWidth:0};"show"===u&&r.show(),n={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},"toggle"===e.mode&&"show"===u?(r.from=e.to||E,r.to=e.from||n):(r.from=e.from||("show"===u?E:n),r.to=e.to||("hide"===u?E:n)),s={from:{y:r.from.height/n.height,x:r.from.width/n.width},to:{y:r.to.height/n.height,x:r.to.width/n.width}},("box"===g||"both"===g)&&(s.from.y!==s.to.y&&(v=v.concat(d),r.from=t.effects.setTransition(r,d,s.from.y,r.from),r.to=t.effects.setTransition(r,d,s.to.y,r.to)),s.from.x!==s.to.x&&(v=v.concat(h),r.from=t.effects.setTransition(r,h,s.from.x,r.from),r.to=t.effects.setTransition(r,h,s.to.x,r.to))),("content"===g||"both"===g)&&s.from.y!==s.to.y&&(v=v.concat(c).concat(l),r.from=t.effects.setTransition(r,c,s.from.y,r.from),r.to=t.effects.setTransition(r,c,s.to.y,r.to)),t.effects.save(r,v),r.show(),t.effects.createWrapper(r),r.css("overflow","hidden").css(r.from),f&&(a=t.effects.getBaseline(f,n),r.from.top=(n.outerHeight-r.outerHeight())*a.y,r.from.left=(n.outerWidth-r.outerWidth())*a.x,r.to.top=(n.outerHeight-r.to.outerHeight)*a.y,r.to.left=(n.outerWidth-r.to.outerWidth)*a.x),r.css(r.from),("content"===g||"both"===g)&&(d=d.concat(["marginTop","marginBottom"]).concat(c),h=h.concat(["marginLeft","marginRight"]),l=o.concat(d).concat(h),r.find("*[width]").each((function(){var i=t(this),n=i.height(),a=i.width(),r=i.outerHeight(),o=i.outerWidth();p&&t.effects.save(i,l),i.from={height:n*s.from.y,width:a*s.from.x,outerHeight:r*s.from.y,outerWidth:o*s.from.x},i.to={height:n*s.to.y,width:a*s.to.x,outerHeight:n*s.to.y,outerWidth:a*s.to.x},s.from.y!==s.to.y&&(i.from=t.effects.setTransition(i,d,s.from.y,i.from),i.to=t.effects.setTransition(i,d,s.to.y,i.to)),s.from.x!==s.to.x&&(i.from=t.effects.setTransition(i,h,s.from.x,i.from),i.to=t.effects.setTransition(i,h,s.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,(function(){p&&t.effects.restore(i,l)}))}))),r.animate(r.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===r.to.opacity&&r.css("opacity",r.from.opacity),"hide"===u&&r.hide(),t.effects.restore(r,v),p||("static"===m?r.css({position:"relative",top:r.to.top,left:r.to.left}):t.each(["top","left"],(function(t,e){r.css(e,(function(e,i){var n=parseInt(i,10),a=t?r.to.left:r.to.top;return"auto"===i?a+"px":n+a+"px"}))}))),t.effects.removeWrapper(r),i()}})},t.effects.effect.scale=function(e,i){var n=t(this),a=t.extend(!0,{},e),s=t.effects.setMode(n,e.mode||"effect"),r=parseInt(e.percent,10)||(0===parseInt(e.percent,10)||"hide"===s?0:100),o=e.direction||"both",l=e.origin,c={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},d="horizontal"!==o?r/100:1,h="vertical"!==o?r/100:1;a.effect="size",a.queue=!1,a.complete=i,"effect"!==s&&(a.origin=l||["middle","center"],a.restore=!0),a.from=e.from||("show"===s?{height:0,width:0,outerHeight:0,outerWidth:0}:c),a.to={height:c.height*d,width:c.width*h,outerHeight:c.outerHeight*d,outerWidth:c.outerWidth*h},a.fade&&("show"===s&&(a.from.opacity=0,a.to.opacity=1),"hide"===s&&(a.from.opacity=1,a.to.opacity=0)),n.effect(a)},t.effects.effect.puff=function(e,i){var n=t(this),a=t.effects.setMode(n,e.mode||"hide"),s="hide"===a,r=parseInt(e.percent,10)||150,o=r/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:a,complete:i,percent:s?r:100,from:s?l:{height:l.height*o,width:l.width*o,outerHeight:l.outerHeight*o,outerWidth:l.outerWidth*o}}),n.effect(e)},t.effects.effect.pulsate=function(e,i){var n,a=t(this),s=t.effects.setMode(a,e.mode||"show"),r="show"===s,o="hide"===s,l=r||"hide"===s,c=2*(e.times||5)+(l?1:0),d=e.duration/c,h=0,u=a.queue(),p=u.length;for((r||!a.is(":visible"))&&(a.css("opacity",0).show(),h=1),n=1;c>n;n++)a.animate({opacity:h},d,e.easing),h=1-h;a.animate({opacity:h},d,e.easing),a.queue((function(){o&&a.hide(),i()})),p>1&&u.splice.apply(u,[1,0].concat(u.splice(p,c+1))),a.dequeue()},t.effects.effect.shake=function(e,i){var n,a=t(this),s=["position","top","bottom","left","right","height","width"],r=t.effects.setMode(a,e.mode||"effect"),o=e.direction||"left",l=e.distance||20,c=e.times||3,d=2*c+1,h=Math.round(e.duration/d),u="up"===o||"down"===o?"top":"left",p="up"===o||"left"===o,g={},f={},m={},v=a.queue(),E=v.length;for(t.effects.save(a,s),a.show(),t.effects.createWrapper(a),g[u]=(p?"-=":"+=")+l,f[u]=(p?"+=":"-=")+2*l,m[u]=(p?"-=":"+=")+2*l,a.animate(g,h,e.easing),n=1;c>n;n++)a.animate(f,h,e.easing).animate(m,h,e.easing);a.animate(f,h,e.easing).animate(g,h/2,e.easing).queue((function(){"hide"===r&&a.hide(),t.effects.restore(a,s),t.effects.removeWrapper(a),i()})),E>1&&v.splice.apply(v,[1,0].concat(v.splice(E,d+1))),a.dequeue()},t.effects.effect.slide=function(e,i){var n,a=t(this),s=["position","top","bottom","left","right","width","height"],r=t.effects.setMode(a,e.mode||"show"),o="show"===r,l=e.direction||"left",c="up"===l||"down"===l?"top":"left",d="up"===l||"left"===l,h={};t.effects.save(a,s),a.show(),n=e.distance||a["top"===c?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(a).css({overflow:"hidden"}),o&&a.css(c,d?isNaN(n)?"-"+n:-n:n),h[c]=(o?d?"+=":"-=":d?"-=":"+=")+n,a.animate(h,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===r&&a.hide(),t.effects.restore(a,s),t.effects.removeWrapper(a),i()}})},t.effects.effect.transfer=function(e,i){var n=t(this),a=t(e.to),s="fixed"===a.css("position"),r=t("body"),o=s?r.scrollTop():0,l=s?r.scrollLeft():0,c=a.offset(),d={top:c.top-o,left:c.left-l,height:a.innerHeight(),width:a.innerWidth()},h=n.offset(),u=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:h.top-o,left:h.left-l,height:n.innerHeight(),width:n.innerWidth(),position:s?"fixed":"absolute"}).animate(d,e.duration,e.easing,(function(){u.remove(),i()}))}})?n.apply(e,a):n)||(t.exports=s)},,,,,,,function(t,e){
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011�2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(t){function e(t,e){if(!(t.originalEvent.touches.length>1)){t.cancelable&&t.preventDefault();var i=t.originalEvent.changedTouches[0],n=document.createEvent("MouseEvents");n.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n)}}if(t.support.touch="ontouchend"in document,t.support.touch){var i,n,a,s=t.ui.mouse.prototype,r=s._mouseInit,o=s._mouseDestroy;s._touchStart=function(t){//!e && b._mouseCapture(a.originalEvent.changedTouches[0]) && (e = !0, b._touchMoved = !1, f(a, "mouseover"), f(a, "mousemove"), f(a, "mousedown"))
if(!a&&this._mouseCapture(t.originalEvent.changedTouches[0])){"undefined"!=typeof Engine&&null!=Engine.zoomFactor&&Engine.zoomFactor;i=t.originalEvent.changedTouches[0].clientX,n=t.originalEvent.changedTouches[0].clientY,console.log("last",i,n),a=!0,this._touchMoved=!1,e(t,"mouseover"),e(t,"mousemove"),e(t,"mousedown")}},s._touchMove=function(t){"undefined"!=typeof Engine&&null!=Engine.zoomFactor&&Engine.zoomFactor;var s=t.originalEvent.changedTouches[0].clientX,r=t.originalEvent.changedTouches[0].clientY;s==i&&r==n||(i=s,n=r,a&&(this._touchMoved=!0,e(t,"mousemove")))},s._touchEnd=function(t){a&&(e(t,"mouseup"),e(t,"mouseout"),a=!1)},s._mouseInit=function(){var e=this;e.element.bind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),r.call(e)},s._mouseDestroy=function(){var e=this;e.element.unbind({touchstart:t.proxy(e,"_touchStart"),touchmove:t.proxy(e,"_touchMove"),touchend:t.proxy(e,"_touchEnd")}),o.call(e)}}}(jQuery)},function(t,e){},,,,function(module,exports,__webpack_require__){var averageTimeTestTool=__webpack_require__(147),slugify=__webpack_require__(148);let LayersData=__webpack_require__(32),ServerStorageData=__webpack_require__(7);var ItemState=__webpack_require__(12);const{decodeHtmlEntities:decodeHtmlEntities}=__webpack_require__(2),InputMaskData=__webpack_require__(16),{parseText:parseText}=__webpack_require__(45);var Helpers=new function(){let moduleData={fileName:"Helpers.js"};function recordCallback(t,e,i){e&&e[i]&&t.on("click",()=>{e[i]()})}function createSmallCurrencyIconWithCost(t,e){let i=$("<span>").addClass("small-currency-icon"),n=$("<div>").addClass("icon "+e),a=$("<span>").addClass("value").html(formNumberToNumbersGroup(t));return i.append(a),i.append(n),i}window.slugify=t=>slugify(t,{lower:!0}),window.log=t=>Engine.console.log(t),window.warn=t=>Engine.console.warn(t),window.error=t=>Engine.console.error(t),window.Lock=function(t,e,i){t=t;this.unlock=function(n){t.indexOf(n)>=0&&t.splice(t.indexOf(n),1),t.length||"function"!=typeof e||e(),"function"==typeof i&&i(t)},this.check=function(){return t}},window.averageTimeTestTool=new averageTimeTestTool,window.getNpcFramesAmount=t=>{var e=new RegExp(/_s_(.*?)_e_/g).exec(t);if(!e)return 1;if(e.length>2)return console.error("[Helpers.js, getNpcFramesAmount] Multiple declaration",t),1;let i=e[1];for(let t of i){let e=parseInt(t);if(!Number.isInteger(e))return console.error("[Helpers.js, getNpcFramesAmount] Argument is not integer"),1}return 5},window.getEngine=()=>Engine,window.isInterfaceAnimationOn=()=>Engine&&0==Engine.opt(8),window.checkBattleWindowActive=()=>Engine&&Engine.battle.getShow(),window.createTextGraphic=(t,e,i,n)=>{let a=document.createElement("canvas"),s=a.getContext("2d");a.width=200,a.height=50,s.font=e+"px Arimo regular";let r=s.measureText(t).width;return a.width=r,a.height=e+e/4,s.font=e+"px Arimo regular",s.fillStyle=n,s.fillRect(0,0,a.width,a.height),s.fillStyle=i,s.fillText(t,0,e),{img:a,url:a.toDataURL()}},window.createCheckBox=(t,e,i)=>{let n=__webpack_require__(0).get("one-checkbox");return n.addClass(e),n.find(".label").html(t),n.click((function(){let t=$(this).find(".checkbox");t.toggleClass("active");let e=t.hasClass("active");i(e,n)})),n},window.isFirefoxBrowser=function(){return navigator.userAgent.toLowerCase().includes("firefox")},window.round=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=isset(e)?e:1;var a=(t=Math.abs(parseFloat(t)))<0?"-":"",s="";switch(e){case 10:isset(i)||(i=" "),s=t.toString().length<4?t:t.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+i);break;default:var r=roundParser(t);if(isset(i)||(i="."),s=Math.round(r.val*Math.pow(10,e-1))/Math.pow(10,e-1),n&&(s=cutFloat(s,n)),s=(s+=r.postfix).replace(/\./,i),t<1e4)return a+t}return a+s},window.roundShorten=t=>round(t,9,".",2).replace(/^(\d*)[.](\d*)([kmg])$/g,(t,e,i,n,a,s)=>3===e.length&&2===i.length?`${e}${n}`:2===e.length&&2===i.length?`${e}.${i.slice(0,-1)}${n}`:s),window.cutFloat=function(t,e){if(!(t.toString().indexOf(".")>=0))return t;var i=Math.pow(10,12),n=(Math.floor(t*i)/i).toString();return n.substring(0,n.indexOf(".")+e+1)},window.mp=function(t){return t>0?"+"+formNumberToNumbersGroup(t):formNumberToNumbersGroup(t)},window.formNumberToNumbersGroup=function(t){var e=t.toString().split("").reverse(),i=[];if(t.toString().indexOf(".")>-1)return t;for(var n=0;n<e.length;n++){n%3==0&&0!=n&&i.push(" "),i.push(e[n])}return i.reverse(),i.join("")},window.changeViewOfHelper=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i?Engine.tpls.createViewIcon(e,Engine.itemsViewData.HELPER_VIEW,i)[0]:Engine.items.createViewIcon(e)[0];t.find(".canvas-icon").replaceWith(n)},window.getZoomFactor=function(){var t=$("body"),e=Engine.zoomFactor,i=t.width();return i/(e*i)},window.goToUrl=function(t){var e=window.escapeHTML(t);e=" "+e,mAlert(_t("url_chat_warning %url%",{"%url%":e}),[{txt:_t("yes"),callback:function(){return window.open(t).opener=null,!0}},{txt:_t("no"),callback:function(){return!0}}])},window.ts=function(){var t=new Date;return parseInt(t.getTime())},window.getTimeStampEv=function(){let t=Engine.getEv();if(!t)return null;var e=new Date(1e3*t),i="0"+e.getDate(),n="0"+(e.getMonth()+1),a="0"+e.getFullYear();return i.substr(-2)+"."+n.substr(-2)+"."+a.substr(-4)},window.getStartYear=function(t){return new Date(1e3*t).getFullYear()},window.getStartMonth=function(t){return new Date(1e3*t).getMonth()},window.getStartDay=function(t){return new Date(1e3*t).getDate()},window.createNiInput=t=>{let{val:e,cl:i,type:n,placeholder:a,changeClb:s,focusoutClb:r,clearClb:o,tipClearClb:l,keyUpClb:c,tip:d,readonly:h=!1,clear:u=!0}=t,p=__webpack_require__(0).get("ni-input-text"),g=p.find("input").val(e),f=p.find(".clear-cross");function m(){if(h)return;let t=p.hasClass("isClearCross");""===g.val()?t&&p.removeClass("isClearCross"):t||p.addClass("isClearCross")}return d&&g.tip(d),i&&p.addClass(i),setInputMask(g,n),u&&(f.tip(l||_t("delete")),f.on("click",()=>{let t=g.val();""!=g.val("")&&g.val(""),m(),isset(o)&&o(t)})),g.on("change input",(t,e)=>{if(u&&m(),!t.isTrigger&&isset(s)){let t=g.val();s(t)}}),g.keyup(t=>{if(u&&m(),isset(c)){let e=g.val();c(e,t)}}),g.focusout((function(t){if(isset(r)){let e=g.val();r(e,t)}})),a&&createInputPlaceholder(a,g),h&&g.prop("readonly",!0),p},window.getStartWeekDay=function(t){return new Date(1e3*t).getDay()},window.ut_date=function(t){var e=new Date(1e3*t),i=e.getFullYear();return`${zero(e.getDate())}.${zero(e.getMonth()+1)}.${i}`},window.ut_time=function(t,e,i){var n=new Date(1e3*t);let a=n.getHours(),s=null;if(i){let t=null;a>11?(a-=12,t="PM"):t="AM",a=0==a?12:a,s=zero(a)+":"+zero(n.getMinutes()),e&&(s+=":"+zero(n.getSeconds())),s+=t}else s=zero(a)+":"+zero(n.getMinutes()),e&&(s+=":"+zero(n.getSeconds()));return s},window.devConsoleLog=function(){CFG.debug&&"dev"==Engine.worldConfig.getWorldName()&&(arguments[0]&&arguments[1]&&arguments[2]?console.log("DEV MSG",arguments[0],arguments[1],arguments[2]):arguments[0]&&arguments[1]?console.log("DEV MSG",arguments[0],arguments[1]):console.log("DEV MSG",arguments[0]))},window.ut_fulltime=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?ut_time(t,e)+" "+ut_date(t):ut_date(t)+" "+ut_time(t,e)},window.getNIInfoIcon=function(t){let e=__webpack_require__(0).get("info-icon");return isset(t.tip)&&e.tip(t.tip),e},window.getRandomElementFromArray=function(t){let e=t.length-1;return t[Math.round(Math.random()*e)]},window.getCurrentDate=t=>{const e=new Date,i=zero(e.getDate()),n=zero(e.getMonth()+1),a=e.getFullYear();if(t){let e="";return t.day&&(e+=i+"."),t.month&&(e+=n+"."),t.year&&(e+=a+"."),e.slice(0,-1)}return`${i}.${n}.${a}`},window.zero=function(t,e){for(isset(e)||(e=2),t=t.toString();t.length<e;)t="0"+t;return t},window.isBooleanWithWarning=function(t){return!!isBoolean(t)||(errorReport("Helpers.js","isBooleanWithWarning","This is not boolean",t),!1)},window.pageReload=function(){location.reload()},window.hexToRgb=function(t){const e="hexToRgb";let i={r:0,g:0,b:0};return isStringVal(t)?7!=t.length?(errorReport(moduleData.fileName,e,"incorrect length!",t),i):"#"!=t[0]?(errorReport(moduleData.fileName,e,"hash not defined",t),i):(t=t.replace(/^#/,""),{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}):(errorReport(moduleData.fileName,e,"it is not string!",t),i)},window.calculateDiff=function(t,e){var i=Math.abs(isset(e)?t-e:t)/60;return i<110?_t("time_min %val%",{"%val%":Math.round(i)},"time_diff"):i<1440?_t("time_h %val%",{"%val%":Math.round(i/60)},"time_diff"):_t("time_days %val%",{"%val%":Math.round(i/1440)},"time_diff")},window.calculateDiffFull=function(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=1e3*(t-e),a=Math.floor(n/864e5),s=Math.floor(n%864e5/36e5),r=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);let l=a<1,c=l&&s<1,d=a>0,h="";return i&&(h="green",c&&r>4&&(h="orange"),c&&r<=4&&(h="red")),`\n\t\t\t<span class="${h}">\n\t\t\t\t${l?"":_t("time_days_short %val%",{"%val%":a},"time_diff")}\n\t\t\t\t${c?"":_t("time_h_short %val%",{"%val%":s},"time_diff")}\n\t\t\t\t${_t("time_min_short %val%",{"%val%":r},"time_diff")}\n\t\t\t\t${d?"":_t("time_sec_short %val%",{"%val%":o},"time_diff")}\n\t\t\t</span>\n\t\t`},window.secToParsedTime=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t,a=Math.floor(n/86400),s=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),o=Math.floor(n%60);let l=a<1,c=l&&s<1,d=a>0||!e,h="";return i&&(h="green",c&&r>4&&(h="orange"),c&&r<=4&&(h="red")),`\n\t\t\t<span class="${h}">\n\t\t\t\t${l?"":_t("time_days_short %val%",{"%val%":a},"time_diff")}\n\t\t\t\t${c?"":_t("time_h_short %val%",{"%val%":s},"time_diff")}\n\t\t\t\t${_t("time_min_short %val%",{"%val%":r},"time_diff")}\n\t\t\t\t${d?"":_t("time_sec_short %val%",{"%val%":o},"time_diff")}\n\t\t\t</span>\n\t\t`},window.getProfIcons=function(t){var e="";for(var i in t)e+='<div class="profs-icon '+t[i]+'"></div>';return e},window.getAllProfName=function(t){return{m:_t("prof_mag",null,"eq_prof"),w:_t("prof_warrior",null,"eq_prof"),p:_t("prof_paladyn",null,"eq_prof"),t:_t("prof_tracker",null,"eq_prof"),h:_t("prof_hunter",null,"eq_prof"),b:_t("prof_bladedancer",null,"eq_prof")}[t]},window.setPercentProgressBar=function(t,e){t[0].setAttribute("bar-percent",Math.floor(e))},window.getMobile=function(){var t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(t=!0),t},window.mobileCheck=function(){return isset(window.Engine)?Engine.mobile:getMobile()},window.getFirstElementInObject=t=>{for(let e in t)return t[e];return null},window.checkObjectIsEmpty=t=>0==Object.keys(t).length,window.blockMouseOnSpecificMap=function(){if([3714,3277,3278,3279,3280].indexOf(Engine.map.d.id)>-1)return!0},window.invertKeyInputOnSpecificMap=function(){if([3714].indexOf(Engine.map.d.id)>-1)return!0},window.crazyBodyOnSpecificMap=function(){if([3714].indexOf(Engine.map.d.id)>-1)return!0},window.errorReport=function(t,e,i,n,a){n=n||"",a?console.error(`[${t}, ${e}] ${i}`,n,a):console.error(`[${t}, ${e}] ${i}`,n)},window.warningReport=function(t,e,i,n){n=n||"",console.warn(`[${t}, ${e}] ${i}`,n)},window.getSecondLeft=function(t,e){var i=Math.floor(t/60),n=Math.floor(i/60),a=Math.floor(n/24),s=t-60*i,r=i-60*n,o=n-24*a;if(e&&e.noVar){return(o>9?o:"0"+o.toString())+":"+(r>9?r:"0"+r.toString())+":"+(s>9?s:"0"+s.toString())}if(e&&e.short)return 0==a&&0==n?r+"m "+s+"s":0==a?o+"h "+r+"m":a+"d "+o+"h";if(e&&(e.d||e.h||e.m||e.s)){let t="";return e.d&&(t+=e.h||e.m||e.s?a+"d ":a+"d"),e.h&&(t+=e.m||e.s?o+"h ":o+"h"),e.m&&(t+=e.s?r+"m ":r+"m"),e.s&&(t+=s+"s"),t}return a+"d "+o+"h "+r+"m "+s+"s"},window.datediff=function(t,e){void 0===e&&(e=unix_time());var i=["",0],n=Math.abs(Math.ceil((t-e)/60));return i[1]=t-e>0?"+":"-",i[0]=n<110?Math.round(n)+"min":n<1440?Math.round(n/60)+"h":Math.round(n/1440)+" dni",i},window.roundParser=function(t){var e=(t=Math.floor(t)).toString().length%3,i=t.toString().length,n="",a=t/Math.pow(10,i>9?9:i-(0==e?3:e)),s={0:"",3:"k",6:"m",9:"g"};for(var r in s)i>parseInt(r)&&(n=s[r]);return{val:a,postfix:n}},window.roundNumber=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},window.parsePrice=function(t){return t?""==(t+="")||" "==t?"":"g"==(t=t.split(",").join(".")).slice(-1)||"G"==t.slice(-1)?Math.round(1e9*parseFloat(t)):"m"==t.slice(-1)||"M"==t.slice(-1)?Math.round(1e6*parseFloat(t)):"k"==t.slice(-1)||"K"==t.slice(-1)?Math.round(1e3*parseFloat(t)):isNumberFunc(t)?parseInt(t):NaN:""},window.setTimeoutScroll=function(){setTimeout((function(){$(".scroll-wrapper").trigger("update")}),1e3)},window.setTipWhenNameToLong=function(t,e){t[0].scrollWidth>t.innerWidth()?t.tip(parseBasicBB(e)):t.tip()},window.unix_time=function(t){var e=(new Date).getTime()/1e3;return isset(t)?e:Math.round(e)},window.lengthObject=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},window.itemIsDisabled=t=>t.hasClass("disable-item-mark"),window.getSoundNotificationPatch=function(){return mobileCheck()?ServerStorageData.SOUND_NOTIFICATION_MOBILE:ServerStorageData.SOUND_NOTIFICATION_PC},window.getSoundParametersPatch=function(){return mobileCheck()?ServerStorageData.MARGO_SOUNDS_MOBILE:ServerStorageData.MARGO_SOUNDS_PC},window.setCursorAtInDraggable=function(t,e,i){let n=mobileCheck();n||(i.cursorAt={top:n?0:t,left:n?0:e})},window.reloadClient=function(){mAlert(_t("break_connection"),[{txt:_t("yes"),callback:function(){return location.reload(),!0}},{txt:_t("no"),callback:function(){let t=getMainDomain();window.location.href="https://margonem."+t}}])},window.hideInterface=function(){$(".top.positioner").css("display","none"),$(".bottom.positioner").css("display","none"),$(".right-column.main-column").css("display","none"),Engine.interface.get$gameLayer().css({top:"0px",right:"0px",bottom:"0px"})},window.getFreeIdOfObject=(t,e)=>{let i=isset(e)?e:0;for(;isset(t[i]);)i++;return i},window.getFreeIdOfArray=(t,e)=>{let i={};for(let e in t){i[t[e].id]=!0}return getFreeIdOfObject(i,e)},window.getCookie=function(t,e){var i=document.cookie,n=t+"=",a=i.indexOf("; "+n);if(-1==a){if(0!=(a=i.indexOf(n)))return null}else a+=2;var s=document.cookie.indexOf(";",a);-1==s&&(s=i.length);var r=i.substring(a+n.length,s);return e?unescape(r):decodeURI(r)},window.toggleFullScreen=function(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?turnOnFullScreen():turnOffFullScreen()},window.turnOnFullScreen=function(){document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),Engine.onResize()},window.turnOffFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),Engine.onResize()},window.getWidthOfBar=function(t){var e=getMaxWidgetIndex(t);return t.width()/6*e},window.getMaxWidgetIndex=function(t){for(var e=6;e>0;e--)if(t.find("[widget-index='"+e+"']").length>0)return e;return 0},window.tooBigScreen=function(t){var e=564*t,i=$("body").width()*t/2,n=$(".hud-container").width()*t/2,a=e/2;return getWidthOfBar($(".bottom-left.main-buttons-container"))*t+a>i?"leftDownWidgetW":getWidthOfBar($(".bottom-right.main-buttons-container"))*t+a>i?"rightDownWidgetW":getWidthOfBar($(".bg-additional-widget-left"))*t+a>i?"leftAddWidgetW":getWidthOfBar($(".bg-additional-widget-left"))*t+a>i?"rightAddWidgetW":getWidthOfBar($(".top-left.main-buttons-container"))*t+n>i?"leftUpWidgetW":getWidthOfBar($(".top-right.main-buttons-container"))*t+n>i&&"rightUpWidgetW"},window.setCookie=function(t,e,i,n,a,s){var r=t+"="+escape(e)+(i?"; expires="+i.toGMTString():"")+(n?"; path="+n:"")+(a?"; domain="+a:"")+(s?"; secure":"");document.cookie=r},window.isStringVal=t=>"string"==typeof t,window.isIntVal=t=>{let e=parseInt(t);return!Number.isNaN(parseInt(e))&&e==t},window.isSpecificIntVal=(t,e)=>{let i=parseInt(t);return!Number.isNaN(parseInt(i))&&e.indexOf(i)>-1},window.isFloatVal=t=>{let e=parseFloat(t);return!Number.isNaN(parseFloat(e))&&e==t},window.isIntOrFloatVal=t=>isInt(t)||isFloatVal(t),window.isIntOrBool=t=>isInt(t)||isBoolean(t),window.isIntsValWithSeperator=t=>{if(""==t)return!1;let e=t.split(",");for(let t in e){let i=e[t];if(!isIntVal(i))return!1}return!0},window.elementIsObject=t=>!elementIsArray(t)&&"object"==typeof t,window.elementIsArray=t=>Array.isArray(t),window.isset=function(t){return void 0!==t},window.ucfirst=function(t){return(t+="").charAt(0).toUpperCase()+t.substr(1)},window.addToArrayRecord=function(t,e,i){t.splice(e,0,i)},window.checkRGBAObject=function(t,e,i,n){return isset(i.r)&&isset(i.g)&&isset(i.b)&&isset(i.a)?isInt(i.r)&&isInt(i.g)&&isInt(i.b)?isFloatVal(n.color.a)?!(n.color.a<0||n.color.a>1)||(errorReport(t,e,"attr color.a have to 0-1 val!",n),!1):(errorReport(t,e,"attr color.a have to double val!",n),!1):(errorReport(t,e,"attr color.r or color.g or color.b have to integer!",n),!1):(errorReport(t,e,"attr color.r or color.g or color.b or color.a not exist!",n),!1)},window.checkRGBOrRGBAObject=function(t,e,i,n){return isset(i.r)&&isset(i.g)&&isset(i.b)?isInt(i.r)&&isInt(i.g)&&isInt(i.b)?!(isset(i.a)&&!isFloatVal(i.a))||(errorReport(t,e,"attr color.a have to double val!",n),!1):(errorReport(t,e,"attr color.r or color.g or color.b have to integer!",n),!1):(errorReport(t,e,"attr color.r or color.g or color.b not exist!",n),!1)},window.checkRGBObject=function(t,e,i,n){return isset(i.r)&&isset(i.g)&&isset(i.b)?!!(isInt(i.r)&&isInt(i.g)&&isInt(i.b))||(errorReport(t,e,"attr color.r or color.g or color.b have to integer!",n),!1):(errorReport(t,e,"attr color.r or color.g or color.b not exist!",n),!1)},window.createRecords=function(t,e,i){for(var n=$("<tr>"),a=0;a<t.length;a++){var s=$("<td>").html(t[a]);"object"==typeof e?s.addClass(e[a]):s.addClass(e),recordCallback(s,i,a),n.append(s)}return n},window.createImgStyle=function(t,e,i,n,a){Engine.imgLoader.onload(e,!1,!1,s=>{createImgStyleAfterOnload(s,t,e,i,n,a)},()=>{createImgStyle(t,"../img/def-npc-sprite.gif",i,n,a)})},window.createImgStyleAfterOnload=function(t,e,i,n,a,s){var r=e.find(".img-avatar-correct"),o=s||48;if(r.length<1){var l=$("<div>").addClass("table-img-avatar"),c=$("<div>").addClass("table-cell-img-avatar");r=$("<div>").addClass("img-avatar-correct"),c.append(r),l.append(c),e.append(l)}var d='url("'+i+'")';if(r.css("background-image")!=d){var h=t.width/4,u=t.height/4;n&&isset(n.sprite)&&!n.sprite&&(h=t.width,u=t.height),r.css("background-image",d),r.css("background-size",""),h>o?(r.css("background-size","400% 400%"),a&&r.css(a)):(r.width(h),r.height(u)),u<48&&!n||n&&(parseInt(n.width)>h&&(n.width=h+"px"),parseInt(n.height)>u&&(n.height=u+"px"),r.css(n))}},window.objectToString=t=>{let e=HARD_JSON_STRINGIFY(t);return e=removeFirstLetter(e),removeLastLetter(e)},window.removeFirstLetter=t=>t.substring(1),window.removeLastLetter=t=>t.slice(0,-1),window.createNpcIcon=(t,e,i,n,a,s,r,o)=>{let l=a,c=s,d=1;return r&&l>r&&(d=r/l),o&&c>o&&(d=o/c),l*=d,c*=d,`\n\t\t  <div class=${t}>\n\t\t\t  <div class=${e}\n          style="\n            \t  background : url(${i});\n\t\t\t      width      : ${l}px;\n\t\t\t      height     : ${c}px;\n\t\t\t      margin     : auto;\n\t\t\t      background-size: ${100*n}%;\n\t\t\t    "\n\t\t\t  </div>\n\t\t\t</div>`},window.getDescriptionOfKindMonster=function(t){let e=null;return t>99?e="tytan":t>89?e="colossus":t>79?e="heros":t>29?e="elita3":t>19?e="elita2":t>9&&(e="elita1"),e},window.createInputPlaceholder=(t,e)=>{e.attr("placeholder",t)},window.createCostIconComponent=function(t,e,i,n,a){var s,r=__webpack_require__(0).get("cost-icon-component"),o=!0===t?_t("cost",null,"recover"):t;r.find(".text").html(o),a?r.find(".icon").append(a):r.find(".icon").addClass(getClImageFromPath(n));var l=getClImageFromPath(n);return s=l&&"money-icon"==l?round(e,2):e,r.find(".cost").html(s).addClass(i),r},window.getClImageFromPath=function(t){switch(t){case"../img/goldIconNormal.png":return"money-icon";case"../img/draconiteIconNormal.gif":return"draconite-icon";case"../img/honorIconNormal.gif":return"honor-icon";default:return t}},window.specificElementsExist=function(){return Engine.mails||Engine.trade||Engine.depo||Engine.auctions||Engine.shop||Engine.bonusReselectWindow||Engine.crafting&&(Engine.crafting.salvage||Engine.crafting.enhancement||Engine.crafting.extraction)},window.getE=function(t,e){return mobileCheck()?isset(e)?(e.clientY=e.clientY/Engine.zoomFactor,e.clientX=e.clientX/Engine.zoomFactor,e):(t.clientY=t.clientY/Engine.zoomFactor,t.clientX=t.clientX/Engine.zoomFactor,t):t},window.isBoolean=t=>"boolean"==typeof t,window.isInt=function(t){return!isNaN(t)&&(0|(e=parseFloat(t)))===e;var e},window.createSmallDraconiteIcon=t=>createSmallCurrencyIconWithCost(t,"small-draconite"),window.createSmallGoldIcon=t=>createSmallCurrencyIconWithCost(t,"small-money"),window.isNumberFunc=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},window.setOnlyPositiveNumberInInput=function(t){t.mask("0#")},window.setOnlyPositiveFloatNumberInInput=function(t){t.mask("0999999999Y999",{translation:{Y:{pattern:/[.]/,optional:!0}}})},window.setOnlyPositiveNumberInInputWithLetter=t=>{t.mask("0999999999Y999K",{translation:{Y:{pattern:/[.|,]/,optional:!0},K:{pattern:/[k|m|g]/,optional:!0}}})},window.isIframe=()=>window.self!=window.top,window.setInputMask=(t,e)=>{switch(e){case InputMaskData.TYPE.NUMBER:setOnlyPositiveNumberInInput(t);break;case InputMaskData.TYPE.NUMBER_FLOAT:setOnlyPositiveFloatNumberInInput(t);break;case InputMaskData.TYPE.NUMBER_WITH_KMG:setOnlyPositiveNumberInInputWithLetter(t)}},window.askAlert=function(t){var e=[],i=t.re,n=t.clb,a=t.inputCheck,s=t.postName,r=null,o="",l="";const c=isset(t.m)?t.m:t.type,d=!isset(t.isConfirmHotkey)||t.isConfirmHotkey,h=!isset(t.isCancelHotkey)||t.isCancelHotkey;if(isset(t.ip)&&"inputClbAndUpdateCost"!=c&&"yesno4"!=c){var u=t.ik?CFG[t.ik]+""+t.ip:t.ip;if(l='<div class="icon" style="background-image: url('+(u=u.replace(/"/g,"&quot;"))+')"></div>',isset(t.it)){var p=t.it;"string"==typeof t.it&&(t.it=escapeHTML(t.it));var g=isInt(p)?round(p,10):p;l='<div class="text">'+_t("stamina_shop_cost")+"<b> "+g+"</b></div>"+l}l='<div class="icon-wrapper">'+l+"</div>"}switch(c){case"okcancel":e=[{txt:_t("ok",null,"buttons"),callback:function(){return _g(i+"1"),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){return _g(i+"0"),!0}}];break;case"yesno":e=[{txt:_t("yes",null,"buttons"),callback:function(){return Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,25),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,25),_g(i+"1"),n&&n(),!0}},{txt:_t("no",null,"buttons"),callback:function(){return _g(i+"0"),!0}}];break;case"yesno2":e=[{txt:_t("yes",null,"buttons"),callback:function(){return _g(i),!0}},{txt:_t("no",null,"buttons"),callback:function(){return!0}}];break;case"input":case"inputNumeric":o="inputNumeric"===c?'<div class="input-wrapper"><input class="default with-spin" value="0" type="number" /></div>':'<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:()=>{let t=r.$.find("input").val();return _g(i+esc(t)),!0}},{txt:_t("cancel",null,"buttons"),callback:()=>(_g(i+"&inputCancel=1"),!0)}];break;case"inputclb":o='<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){var t=r.$.find("input").val();let e=n(t);return!isset(e)||e}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"inputClbAndUpdateCost":o='<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){var t=r.$.find("input").val();return n(t),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"yesno4":e=[{txt:_t("ok",null,"buttons"),callback:function(){return n(),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"input2":o='<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){const t=r.$.find("input").val();return isset(a)&&!a(t)||(_g(i+t),!0)}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"inputPostData":o='<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){var t={},e=r.$.find("input").val();return Engine.codeProm.setCode(e),t[s]=Engine.codeProm.getCode(),_g(i,!1,t),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"inputDataCodeProm":o='<div class="input-wrapper"><input class="default" id="promo-code-input" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){var t=r.$.find("input").val();return Engine.codeProm.setCode(t),!checkInputValIsEmptyProcedure(t)&&(_g(i+Engine.codeProm.getCode()),!0)}},{txt:_t("cancel",null,"buttons"),callback:function(){return!0}}];break;case"buttons":const{buttons:l,hotkey:d}=t.config;e=l.map(t=>({txt:isset(t.title.text)?t.title.text:_t("ETK_"+t.title.key),...!d&&{hotkeyClass:""},callback:()=>(_g(i+t.opt),!0)}));break;case"no-quit":Engine.lock.add("ask-alert"),o='<div class="input-wrapper"><input class="default" placeholder="..." /></div>',e=[{txt:_t("ok",null,"buttons"),callback:function(){if("ok"===r.$.find("input").val().toLowerCase())return Engine.lock.remove("ask-alert"),!0}}]}const[f,m]=e;return!isset(f)||isset(f.hotkeyClass)||d||(f.hotkeyClass=""),!isset(m)||isset(m.hotkeyClass)||h||(m.hotkeyClass=""),mAlert(t.q+l+o,e,(function(e){if(r=e,"no-quit"==c&&r.$.addClass("no-exit-button"),r.$.addClass("askAlert"),t.tpl){var i=null,n=t.tpl[0],a=t.tpl[1];let e=Engine.itemsFetchData.M_ALERT_TPL.k;Engine.tpls.fetch({k:e,loc:n},(function(t){t.id==a&&(i=t.$.clone(),i=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.ALERT_ITEM_VIEW,t.loc)[0])})),Engine.tpls.removeCallback(e),null!=i&&(r.tpls||(r.tpls={}),r.tpls[a]=i)}"inputClbAndUpdateCost"==c&&t.it&&(t.tpl?r.$.find(".inner-content").append(createCostIconComponent(_t("stamina_shop_cost"),t.it,"",!1,r.tpls[a])):r.$.find(".inner-content").append(createCostIconComponent(_t("stamina_shop_cost"),t.it,"",t.ip,!1)),r.$.find(".default").keyup((function(){var e=r.$.find(".default").val();r.$.find(".cost").html(parseInt(e)*parseInt(t.it))}))),"yesno4"==c&&t.it&&(t.tpl?r.$.find(".inner-content").append(createCostIconComponent(_t("stamina_shop_cost"),t.it,"",!1,r.tpls[a])):r.$.find(".inner-content").append(createCostIconComponent(_t("stamina_shop_cost"),t.it,"",t.ip,!1)))})),r},window.checkInputValIsEmptyProcedure=(t,e)=>!!checkValIsEmpty(t)&&(sendEmptyAlertText(e),!0),window.checkParsePriceValueIsCorrect=t=>{let e=isNaN(t);return e&&mAlert(_t("split_bad_value",null,"item")),!e};const checkValIsEmpty=t=>""===String(t).trim(),sendEmptyAlertText=t=>{let e=t||_t("No_value_was_entered!");mAlert(e)};window.mAlert2=function(t){var e='<div style="text-align:center;"><span style="font-size:0.8em;color:#666;">'+_t("write_ok_to_confirm")+"</div>";askAlert({q:t+e,m:"no-quit"})},window.isOwnItem=t=>t.own===Engine.hero.d.id,window.notOwnItem=function(t,e){return!isOwnItem(e)&&(Engine.items.deleteItem(t),!!Engine.trade&&(Engine.trade.removeTradeItem(t),!0))},window.copyClipboard=function(t){var e=document.createElement("textarea");e.style.position="absolute",e.style.opacity="0",e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Your browser doesn't support copy button")}document.body.removeChild(e)},window.mAlert=function(t,e,i,n){if(isSameAlertExist(t))return;let a;switch(n?console.log(n):n=LayersData.$_M_ALERT_LAYER,n){case LayersData.$_M_ALERT_LAYER:a=Engine.interface.get$mAlertLayer();break;case LayersData.$_M_ALERT_MOBILE_LAYER:a=Engine.interface.get$mAlertMobileLayer();break;default:console.error("[Helpers.js, mAlert] Bad Name LAYER",n)}var s=Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.ALERT_WND,title:_t("alert_default_title"),backdrop:a,closeable:!1,addClass:"mAlert"});switch(n){case LayersData.$_M_ALERT_LAYER:s.addToMAlertLayer();break;case LayersData.$_M_ALERT_MOBILE_LAYER:s.addToMobileAlertLayer();break;default:console.error("[Helpers.js, mAlert] Bad Name LAYER",n)}if(void 0!==e&&e)for(var r=0;r<e.length;r++)!function(t,e){var i=s.addControll(t.txt,"small",(function(){t.callback()&&(s.close(),s.remove())}));if(t.hasOwnProperty("hotkeyClass")){if(""==t.hotkeyClass)return;return"alert-accept-hotkey"==t.hotkeyClass?(i.addClass("alert-accept-hotkey"),void i.find(".label").html(t.txt+" [↵]")):"alert-cancel-hotkey"==t.hotkeyClass?(i.addClass("alert-cancel-hotkey"),void i.find(".label").html(t.txt+" [Esc]")):void console.log("Bug! undefined c.hotkeyClass: ",t.hotkeyClass)}0==e?(i.addClass("alert-accept-hotkey"),i.find(".label").html(t.txt+" [↵]")):1==e&&(i.addClass("alert-cancel-hotkey"),i.find(".label").html(t.txt+" [Esc]"))}(e[r],r);else{let t=s.addControll("Ok","small",(function(){s.close(),s.remove()}));t.addClass("alert-accept-hotkey"),t.find(".label").html("Ok [↵]")}s.center(),"function"==typeof i&&i(s)},window.isSameAlertExist=function(t){var e=$("<div>").html(t),i=e.html(),n=$(".mAlert .inner-content"),a=!1;return n.length>0&&$(n).each((function(t,e){i===$(e).html()&&(a=!0)})),e.remove(),a},window.message=function(t,e){if(""!==t){t=decodeHtmlEntities(t),t=parseText(t),Engine.opt(8)&&(e=!0);var i=$(".loader-layer").css("display"),n=Engine.interface.get$mAlertLayer().find(".big-messages");if(e||"block"!=i){var a=function(){var t={top:$(window).height()/(Engine.dialogue?3:1.4)-n.height()/2};e&&(t.left=240),n.css(t)},s=$('<div class="message"><div class="inner">'+parseContentBB(t)+"</div></div>");n.append(s),s.click((function(){$(this).remove()})),e?(s.addClass("active"),setTimeout((function(){s.remove(),a()}),4e3)):setTimeout((function(){s.addClass("active").delay(4e3).fadeOut(300,(function(){$(this).remove(),a()}))}),100),a()}else setTimeout((function(){message(t)}),500)}},window.achMessage=function(t){var e=t.split(",");message(parsePopupBB(e[3]))},window.whichTransitionEvent=function(){var t,e=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)if(void 0!==e.style[t])return i[t]},window._l=function(){return __build.lang},window.getMainDomain=function(){let t=_l();switch(t){case CFG.LANG.PL:return CFG.DOMAIN.PL;case CFG.LANG.EN:return CFG.DOMAIN.COM;default:return console.warn("[Helper.js, getMainDomain] Incorrect lang",t),null}},window.isEn=function(){return _l()==CFG.LANG.EN},window.isPl=function(){return _l()==CFG.LANG.PL},window.strip_tags=function(html,allowed){if(arguments.length<3)html=html.replace(/<\/?(?!\!)[^>]*>/gi," ");else{var specified=eval("["+arguments[2]+"]");if(allowed){var regex="</?(?!("+specified.join("|")+"))\b[^>]*>";html=html.replace(new RegExp(regex,"gi")," ")}else{var regex="</?("+specified.join("|")+")\b[^>]*>";html=html.replace(new RegExp(regex,"gi")," ")}}var clean_string=html;return clean_string},window.htmlspecialchars=function(t){return t=(t=(t=t.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#039;")},window.deletePositionFixed=function(t){return t.replace(/position\s*:\s*(fixed|absolute)/gi,"")},window.esc=function(t){return t?encodeURIComponent(t):""},window.hideOrShowScrolbar=function(t,e,i){var n=0,a=e.find(".scroll-wrapper");e.find($(".scroll-pane")).children().each((function(t,e){"none"!=$(e).css("display")&&(n+=$(e).height())})),n>t?a.css("height",t+"px"):a.css("height","auto"),$(".scroll-wrapper",e).trigger("update"),i&&$(".scroll-wrapper",e).trigger("scrollTop")},window.strtotime=function(t,e){var i,n,a,s,r,o,l,c,d,h;if(!t)return!1;if((n=(t=t.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase()).match(/^(\d{1,4})([\-\.\/\:])(\d{1,2})([\-\.\/\:])(\d{1,4})(?:\s(\d{1,2}):(\d{2})?:?(\d{2})?)?(?:\s([A-Z]+)?)?$/))&&n[2]===n[4])if(n[1]>1901)switch(n[2]){case"-":return!(n[3]>12||n[5]>31)&&new Date(n[1],parseInt(n[3],10)-1,n[5],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3;case".":return!1;case"/":return!(n[3]>12||n[5]>31)&&new Date(n[1],parseInt(n[3],10)-1,n[5],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3}else if(n[5]>1901)switch(n[2]){case"-":case".":return!(n[3]>12||n[1]>31)&&new Date(n[5],parseInt(n[3],10)-1,n[1],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3;case"/":return!(n[1]>12||n[3]>31)&&new Date(n[5],parseInt(n[1],10)-1,n[3],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3}else switch(n[2]){case"-":return!(n[3]>12||n[5]>31||n[1]<70&&n[1]>38)&&(s=n[1]>=0&&n[1]<=38?+n[1]+2e3:n[1],new Date(s,parseInt(n[3],10)-1,n[5],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3);case".":return n[5]>=70?!(n[3]>12||n[1]>31)&&new Date(n[5],parseInt(n[3],10)-1,n[1],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3:n[5]<60&&!n[6]&&(!(n[1]>23||n[3]>59)&&(a=new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate(),n[1]||0,n[3]||0,n[5]||0,n[9]||0)/1e3));case"/":return!(n[1]>12||n[3]>31||n[5]<70&&n[5]>38)&&(s=n[5]>=0&&n[5]<=38?+n[5]+2e3:n[5],new Date(s,parseInt(n[1],10)-1,n[3],n[6]||0,n[7]||0,n[8]||0,n[9]||0)/1e3);case":":return!(n[1]>23||n[3]>59||n[5]>59)&&(a=new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate(),n[1]||0,n[3]||0,n[5]||0)/1e3)}if("now"===t)return null===e||isNaN(e)?(new Date).getTime()/1e3|0:0|e;if(!isNaN(i=Date.parse(t)))return i/1e3|0;function u(t){var e=t.split(" "),i=e[0],n=e[1].substring(0,3),a=/\d+/.test(i),s=("last"===i?-1:1)*("ago"===e[2]?-1:1);if(a&&(s*=parseInt(i,10)),l.hasOwnProperty(n)&&!e[1].match(/^mon(day|\.)?$/i))return r["set"+l[n]](r["get"+l[n]]()+s);if("wee"===n)return r.setDate(r.getDate()+7*s);if("next"===i||"last"===i)!function(t,e,i){var n,a=o[e];void 0!==a&&(0===(n=a-r.getDay())?n=7*i:n>0&&"last"===t?n-=7:n<0&&"next"===t&&(n+=7),r.setDate(r.getDate()+n))}(i,n,s);else if(!a)return!1;return!0}if(r=e?new Date(1e3*e):new Date,o={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},l={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},"([+-]?\\d+\\s"+(d="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)")+"|(last|next)\\s"+d+")(\\sago)?",!(n=t.match(new RegExp("([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)|(last|next)\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?))(\\sago)?","gi"))))return!1;for(h=0,c=n.length;h<c;h++)if(!u(n[h]))return!1;return r.getTime()/1e3},window.convertDateTime=function(t,e){var i;function n(t){return t<10&&(t="0"+t),t}return`${n((i=(e=void 0!==e&&e)?new Date(1e3*t):new Date(t)).getDate())}.${n(i.getMonth()+1)}.${i.getFullYear()} ${n(i.getHours())}:${n(i.getMinutes())}`},window.debounce=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null;return function(){const a=i&&!n,s=()=>t.apply(this,arguments);clearTimeout(n),n=setTimeout(s,e),a&&s()}},window.throttle=(t,e)=>{let i;return function(){const n=arguments,a=this;i||(t.apply(a,n),i=!0,setTimeout(()=>i=!1,e))}},window.capitalize=t=>"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1),window.removeSpaces=t=>t.replace(/\s/g,""),window.createButton=(t,e,i)=>{const n=__webpack_require__(0).get("button")[0];return n.classList.add(...e),n.querySelector(".label").innerHTML=t,n.addEventListener("click",i),n},window.createSmallButtonWithBackground=(t,e,i)=>{const n=__webpack_require__(0).get("button")[0],a=__webpack_require__(0).get("add-bck")[0];return n.append(a),n.classList.add("small"),n.classList.add("small-button-with-background"),n.classList.add(...e),a.classList.add(...t),n.addEventListener("click",i),n},window.setDebugMode=t=>{CFG.debug=t,afterDebugModeChanged()},window.afterDebugModeChanged=()=>{const t=Engine.npcs.check();for(const e in t)t[e].debugRefreshTip(),t[e].manageUpdateCollider();const e=Engine.items.test().items;for(const t in e)e[t].debugRefreshTip();const i=Engine.tpls.test().tpls;for(const t in i)for(const e in i[t])i[t][e].debugRefreshTip();Engine.skills&&Engine.skills.debugRefreshTip()},window.getCurrencyIcon=function(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e){case"zl":t="/img/currency/goldIcon16.gif";break;case"sl":t="/img/currency/draconiteIcon16.gif";break;case"ph":t="/img/currency/phIcon16.gif";break;default:e.includes("|")&&(e=e.split("|")[1]),t=`${window.CFG.a_ipath}/${e}`}return`<i class="prc-icon" style="background: url('${t}?v=${__build.version}') center / contain;"></i>`},window.convertTimeToSec=t=>{var e,i=t.replace(/[0-9]/g,""),n=t.replace(/\D/g,"");switch(i){case"d":e=60*n*60*24;break;case"h":e=60*n*60;break;case"m":e=60*n;break;case"s":e=n}return e},window.convertSecToTime=t=>{var e=Math.floor(t/86400);t-=86400*e;var i=Math.floor(t/3600);t-=3600*i;var n=Math.floor(t/60);return{d:e,h:i,m:n,s:t-=60*n}},window.stringToHtml=t=>{const e=document.createElement("template");return e.innerHTML=t,e.content},window.siblings=t=>[...t.parentElement.children].filter(e=>e!==t),window.removeFromArray=(t,e)=>{const i=t.indexOf(e);return i>-1&&(t.splice(i,1),!0)},window.count=(t,e,i)=>{switch(t){case"<":return e<i;case"<=":return e<=i;case">":return e>i;case">=":return e>=i;case"==":return e==i;case"===":return e===i;case"!==":return e!==i}},window.deleteElementFromArray=(t,e)=>{e.splice(t,1)},window.copyStructure=t=>GET_HARD_COPY_STRUCTURE(t),window.arrayEquals=(t,e)=>{const i=t.slice().sort(),n=e.slice().sort();return JSON.stringify(i)===JSON.stringify(n)},window.setAttributes=(t,e)=>{for(const i in e)t.setAttribute(i,e[i])},window.fixSrc=t=>""==t?"":"/"!=t[0]?t:t.slice(1,t.length),window.createTransVal=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return{"%val%":`${i}${t}${e}${n}`}},window.removeClassStartingWith=(t,e)=>{const i=new RegExp("\\b"+e+"[^ ]*[ ]?\\b","g");return t.className=t.className.replace(i,""),t},window.checkItemsAmount=t=>{let e=Engine.heroEquipment.getHItems(),i=0;for(let n in e){let a=e[n];ItemState.isEquippedSt(a.st)||a.tpl==t&&(i+=parseInt(a._cachedStats.amount))}return i},window.deepMergeData=function(){let t={},e=e=>{for(let i in e){if(!e.hasOwnProperty(i))continue;let n="[object Object]"===Object.prototype.toString.call(e[i]);t[i]=n?deepMergeData(t[i],e[i]):e[i]}};for(let t=0;t<arguments.length;t++)e(arguments[t]);return t},window.getCharCode=t=>{let e=null,i={186:";",188:",",190:".",191:"/",192:"`",189:"-",187:"=",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",109:"-",107:"+",110:","};return e=i[t]?i[t]:String.fromCharCode(t),e},window.confirmWithCallback=t=>{let{msg:e,clb:i,accept:n=_t("yes"),cancel:a=_t("no")}=t;mAlert(e,[{txt:n,callback:function(){return"function"==typeof i&&i(),!0}},{txt:a,callback:function(){return!0}}])},window.confirmWithTwoCallback=t=>{let{msg:e,clb1:i,clb2:n,accept:a=_t("yes"),cancel:s=_t("no")}=t;mAlert(e,[{txt:a,callback:function(){return"function"==typeof i&&i(),!0}},{txt:s,callback:function(){return"function"==typeof n&&n(),!0}}])},window.confirmWitchTextInput=(t,e,i)=>{askAlert({q:t,m:"inputclb",clb:function(t){return e(t)}}).$.find(".input-wrapper").find("input").attr("maxlength",i||20)},window.confirmWitchNumberTextInput=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=askAlert({q:t,m:"inputclb",clb:function(t){return e(t)}}),a=n.$.find(".input-wrapper").find("input");a.attr("maxlength",20),a.mask("0#"),isset(i.placeholder)&&a.attr("placeholder",i.placeholder),isset(i.value)&&a.val(i.value)},window.correctKey=t=>t?t.toUpperCase():t,window.fixCorsForTaintedCanvas=t=>{null==t.getAttribute("crossOrigin")&&t.setAttribute("crossOrigin","")},window.turnOnDebug=()=>{CFG.debug=!0},window.turnOffDebug=()=>{CFG.debug=!1},window.isDebug=()=>CFG.debug,window.isSeptemberEnd=()=>{const t=new Date(2023,8,30,23,0,0);return new Date>t},function(t){t.fn.removeClassStartingWith=function(e){return t(this).removeClass((function(t,i){return(i.match(new RegExp("\\S*"+e+"\\S*","g"))||[]).join(" ")})),this},t.event.special.destroyed={remove:function(t){t.handler&&t.handler()}},t.fn.tipOverflow=function(){t(this).one("mouseenter",(function(){this.offsetWidth<this.scrollWidth&&t(this).tip(t(this).text())}))}}(jQuery)};module.exports=Helpers},function(t,e){t.exports=function(){this.average={},this.setStartAverage=t=>{this.average[t]||(this.average[t]={a:[],min:1e6,max:0,sum:0}),this.average[t].start=performance.now()},this.setEndAverage=t=>{this.average[t].a.push(performance.now()-this.average[t].start)},this.countAverage=()=>{for(let t in this.average){let e=this.average[t];for(let t=0;t<e.a.length;t++){let i=e.a[t];e.min=Math.min(e.min,i),e.max=Math.max(e.max,i),e.sum+=i}}for(let t in this.average)console.warn(t,"min time call:",this.average[t].min),console.warn(t,"max time call:",this.average[t].max),console.warn(t,"average time call:",this.average[t].sum/this.average[t].a.length),console.log("")}}},,function(t,e){let i={};const n=()=>{if("undefined"==typeof RUNNING_UNIT_TEST)return _l()};i["border-window"]='<div class="border-window">\n        \x3c!--<div class="border-image"></div>--\x3e\n        <div class="header-label-positioner">\n            <div class="header-label">\n                <div class="left-decor"></div>\n                <div class="right-decor"></div>\n                <div class="text"></div>\n            </div>\n        </div>\n        <div class="content">\n            <div class="decoration-label">\n                <div class="decoration"></div>\n                <div class="label">\n                </div>\n            </div>\n            <div class="inner-content"></div>\n            <div class="window-controlls">\n            </div>\n        </div>\n        <div class="close-button-corner-decor">\n            <button type="button" class="close-button"></button>\n        </div>\n    </div>',i["stasis-incoming-overlay"]='<div class="stasis-incoming-overlay map-overlay">\n        <dev class="stasis-incoming-overlay__caption">\n            <div class="stasis-incoming-overlay__text" data-trans="stasis-incoming">\n            </div>\n        </dev>\n    </div>',i["stasis-overlay"]='<div class="stasis-overlay map-overlay">\n        <dev class="stasis-overlay__caption">\n            <div class="stasis-overlay__title" data-trans="stasis"></div>\n            <div class="stasis-overlay__text">\n                <div data-trans="stasis_overlay_text"></div>\n                <div class="stasis-overlay__time"></div>\n            </div>\n        </dev>\n    </div>',i["map-reloader-splash"]='<div class="map-reloader-splash map-overlay"></div>',i["dead-overlay"]='<div class="dead-overlay map-overlay">\n        <div class="positioner">\n            <div class="inner-text" data-trans="unconcious_info_txt"></div>\n            <div class="dazed-time"></div>\n        </div>\n    </div>',i["battle-bars-wrapper"]='<div class="battle-bars-wrapper">\n        <div class="battle-bar energy" data-trans="data-tip#stat-energy">\n            <div class="background"></div>\n            <div class="bar-overflow">\n                <div class="inner" bar-horizontal="true"></div>\n            </div>\n            <div class="overlay"></div>\n            <div class="values">0000/0000</div>\n        </div>\n        <div class="battle-bar mana" data-trans="data-tip#stat-mana">\n            <div class="background"></div>\n            <div class="bar-overflow">\n                <div class="inner" bar-horizontal="true"></div>\n            </div>\n            <div class="overlay"></div>\n            <div class="values">9999/9999</div>\n        </div>\n    </div>',i["popup-menu-layer"]='<div class="popup-menu-layer layer"> </div>',i["captcha-layer"]='<div class="captcha-layer layer"></div>',i["console-layer"]='<div class="console-layer layer">\n        <div class="big-messages"></div>\n    </div>',i["mAlert-layer"]='<div class="mAlert-layer layer">\n        <div class="big-messages"></div>\n    </div>',i["mAlert-mobile-layer"]='<div class="mAlert-mobile-layer layer"></div>',i["alerts-layer"]='<div class="alerts-layer layer">\n        <div class="big-messages"></div>\n        <div id="debug"></div>\n    </div>',i["sticky-tips-layer"]='<div class="sticky-tips-layer layer"></div>',i["drop-to-delete-widget-layer"]='<div class="drop-to-delete-widget-layer layer">\n        <div class="up-part"></div>\n        <div class="middle-part"></div>\n        <div class="down-part"></div>\n    </div>',i["tutorial-layer"]='<div class="tutorial-layer layer"></div>',i["chat-layer"]='<div class="chat-layer layer">\n        <div class="chat-overlay"></div>\n        <div class="mobile-magic-input-wrapper"></div>\n        <div class="send-mobile-message-wrapper"></div>\n        \x3c!--<div class="chat-mobile-input-wrapper">--\x3e\n            \x3c!--<div class="remaining-chars"></div>--\x3e\n            \x3c!--<textarea  class="mobile-input" data-trans="placeholder#chat_message#chat"></textarea>--\x3e\n        \x3c!--</div>--\x3e\n    </div>',i["loader-layer"]=`<div class="loader-layer layer">\n        <div class="bottom-info"></div>\n        <div class="progress-bar">\n            <div class="progress-bar-and-image-wrapper">\n                <img class="loader-image" src="${CFG.oimg}/gui/loader/loader-image${isPl()&&!isSeptemberEnd()?"-onc":""}.png" alt="Loading" />\n                \x3c!--<div class="text" data-trans="#loading_inprogressnew#static"></div>--\x3e\n                <div class="inner-wrapper">\n                    <div class="inner" bar-horizontal="true"></div>\n                </div>\n            </div>\n        </div>\n    </div>`,i["zoom-layer"]='<div class="zoom-layer layer">\n        <div class="zoom-overlay"></div>\n        <div class="minus">\n            <div class="m-graph"></div>\n        </div>\n        <div class="plus">\n            <div class="p-graph"></div>\n        </div>\n        <div class="btn-wrapper"> </div>\n    </div>',i["echh-layer"]='<div class="echh-layer layer"></div>',i["interface-layer"]='<div class="interface-layer layer">\n        <div class="game-layer">\n            <div class="map-overlay filter-map-fog"></div>\n            <div class="map-overlay filter-map-night"></div>\n            \x3c!--<canvas id="MAP_CANVAS"></canvas>--\x3e\n            <canvas id="GAME_CANVAS" oncontextmenu="return false;"></canvas>\n            <div class="map-overlay filter-map-weather"></div>\n        </div>\n        <div class="pre-captcha"></div>\n        <div class="quick_messages"></div>\n        <div class="left-column main-column">\n            <div class="inner-wrapper"></div>\n            <div class="border">\n                <div class="wanted-mini"></div>\n            </div>\n        </div>\n        <div class="right-column main-column">\n            <div class="inner-wrapper">\n                <div class="bottom-wrapper"></div>\n            </div>\n            <div class="border"></div>\n            <div class="extended-stats scroll-wrapper">\n                <div class="border"></div>\n            </div>\n        </div>\n        <div class="top positioner">\n            <div class="bg"></div>\n            <div class="wanted-mini"></div>\n            <div class="content">\n                <div class="omg-tutorial-handler"></div>\n                <div class="top-left main-buttons-container"></div>\n                <div class="hud-container"></div>\n                <div class="matchmaking-timer"></div>\n                <div class="top-right main-buttons-container"></div>\n            </div>\n        </div>\n        <div class="bottom positioner">\n            <div class="bg">\n            </div>\n            <div class="bg-additional-widget-left"></div>\n            <div class="bg-additional-widget-right"></div>\n            <div class="content">\n                <div class="bottom-left-additional main-buttons-container"></div>\n                <div class="bottom-right-additional main-buttons-container"></div>\n                <div class="bottom-left main-buttons-container"></div>\n                <div class="bottom-right main-buttons-container">\n                    <div class="version-info"></div>\n                    <div class="game-notifications"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["hud-container"]='<div class="hud-container">\n        <div class="btn-min gold-btn">+</div>\n        <div class="btn-min credits-btn">+</div>\n        <div class="map_ball"></div>\n        <div class="hero-data">\n            <span class="heroname"></span>\n        </div>\n        <div class="map-data"><span class="map-timer"></span><span class="location"></span><span class="coords"></span></div>\n        <div class="world-name"></div>\n        <div class="gold-tip" data-trans="data-tip#gold"></div>\n        <div class="credits-tip" data-trans="data-tip#stat-credits"></div>\n        <div class="herogold"></div>\n        <div class="herogold-difference"></div>\n        <div class="herocredits"></div>\n        <div class="herocredits-difference"></div>\n        <div class="bm-register"></div>\n        <div class="onc-btn"></div>\n    </div>',i["herogold-tip"]='<div class="herogold-tip">\n        <div class="h-gold"></div>\n        <div class="h-gold-limit"></div>\n    </div>',i["bottom-panel-of-bottom-positioner"]='<div class="bottom-panel-of-bottom-positioner bottom-panel">\n        <div class="helpers-numbers">\n            <span class="h-n-1">1</span>\n            <span class="h-n-2">2</span>\n            <span class="h-n-3">3</span>\n            <span class="h-n-4">4</span>\n            <span class="h-n-5">5</span>\n            <span class="h-n-6">6</span>\n            <span class="h-n-7">7</span>\n            <span class="h-n-8">8</span>\n        </div>\n\n        <div class="battle-bars-wrapper-template"></div>\n        <div class="exp-bar-wrapper-template"></div>\n        <div class="hp-indicator-wrapper-template"></div>\n\n        <div class="lagmeter">\n            <div class="lag"></div>\n        </div>\n        <div class="slots right" data-trans="data-tip#hot_items_info">\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n        </div>\n        <div class="slots left" data-trans="data-tip#hot_items_info">\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n            <div class="usable-slot"></div>\n        </div>\n        <div class="skill-usable-slots left">\n            <div class="skill-usable-slot" slot="0"></div>\n            <div class="skill-usable-slot" slot="1"></div>\n            <div class="skill-usable-slot" slot="2"></div>\n            <div class="skill-usable-slot" slot="3"></div>\n        </div>\n        <div class="skill-usable-slots right">\n            <div class="skill-usable-slot" slot="7"></div>\n            <div class="skill-usable-slot" slot="6"></div>\n            <div class="skill-usable-slot" slot="5"></div>\n            <div class="skill-usable-slot" slot="4"></div>\n        </div>\n        <div class="exp-bar"></div>\n        <div class="gained-exp-indicator"></div>\n        <div class="bottom-panel-pointer-bg">\n            <div class="pointer-exp" data-trans="data-tip#exp#exp-ttl-pointer"></div>\n            <div class="pointer-ttl" data-trans="data-tip#ttl#exp-ttl-pointer"></div>\n        </div>\n    </div>',i["mini-map-controller"]='<div class="mini-map-controller mini-map">\n        \x3c!--<div class="mini-map-header">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="mini-map-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="mini-map-map">\n            <div class="graphic"></div>\n            <div class="mini-local-map"></div>\n            <div class="mini-global-map-overflow">\n                <div class="mini-global-map"></div>\n            </div>\n            <div class="mini-map-mouse-move"></div>\n        </div>\n        <div class="mini-map-panel">\n            <div class="mini-map-buttons"></div>\n        </div>\n        <div class="mini-map-content"></div>\n    </div>',i["extended-stats-tpl"]='<div class="extended-stats-tpl scroll-pane">\n\n        <div class="stats-section">\n            <h3 data-trans="stats_attack"></h3>\n\n            <div class="damage-section">\n                \x3c!-- filled in runime from few values !--\x3e\n                <div class="stat-row damage-normal warrior-stats" data-herostat="damage-normal">\n                    <span class="label" data-trans="stat-damage-normal"></span>\n                    <span class="value">-</span>\n                </div>\n                <div class="stat-row damage-offhand warrior-stats" data-herostat="damage-offhand" data-trans="data-tip#herostat-tip-damage-offhand">\n                    <span class="label" data-trans="stat-damage-offhand"></span>\n                    <span class="value">-</span>\n                </div>\n                <div class="stat-row damage-fire warrior-stats" data-herostat="damage-fire"  data-trans="data-tip#herostat-tip-damage-fire">\n                    <span class="label" data-trans="stat-damage-fire"></span>\n                    <span class="value">-</span>\n                </div>\n                <div class="stat-row damage-lightning warrior-stats" data-herostat="damage-lightning" data-trans="data-tip#herostat-tip-damage-lightning">\n                    <span class="label" data-trans="stat-damage-lightning"></span>\n                    <span class="value">-</span>\n                </div>\n                <div class="stat-row damage-cold warrior-stats" data-herostat="damage-cold" data-trans="data-tip#herostat-tip-damage-cold">\n                    <span class="label" data-trans="stat-damage-cold"></span>\n                    <span class="value">-</span>\n                </div>\n                <div class="stat-row damage-poison warrior-stats" data-herostat="damage-poison" data-trans="data-tip#herostat-tip-damage-poison">\n                    <span class="label" data-trans="stat-damage-poison"></span>\n                    <span class="value">-</span>\n                </div>\n\n                <div class="stat-group">\n                    <h4 class="poison-header" data-trans="poison-header"></h4>\n                    <div class="wound-stat-group">\n                        <div class="stat-row damage-poison1 warrior-stats" data-herostat="poison1" data-trans="data-tip#herostat-tip-poison1">\n                            <span class="label" data-trans="stat-poison1"></span>\n                            <span class="value">-</span>\n                        </div>\n                        <div class="stat-row damage-of_poison1 warrior-stats" data-herostat="of_poison1" data-trans="data-tip#herostat-tip-of_poison1">\n                            <span class="label" data-trans="stat-of_poison1"></span>\n                            <span class="value">-</span>\n                        </div>\n                        <div class="stat-row damage-poison0 warrior-stats" data-herostat="poison0" data-trans="data-tip#herostat-tip-poison0">\n                            <span class="label" data-trans="stat-poison0"></span>\n                            <span class="value">-</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="stat-group">\n                    <h4 class="wound-header" data-trans="wound-header"></h4>\n                    <div class="wound-stat-group">\n                        <div class="stat-row damage-wound0 warrior-stats" data-herostat="wound0" data-trans="data-tip#herostat-tip-wound0">\n                            <span class="label" data-trans="stat-wound0"></span>\n                            <span class="value">-</span>\n                        </div>\n                        <div class="stat-row damage-wound1 warrior-stats" data-herostat="wound1" data-trans="data-tip#herostat-tip-wound1">\n                            <span class="label" data-trans="stat-wound1"></span>\n                            <span class="value">-</span>\n                        </div>\n                        <div class="stat-row damage-of_wound0 warrior-stats" data-herostat="of_wound0"  data-trans="data-tip#herostat-tip-of_wound0">\n                            <span class="label" data-trans="stat-of_wound0"></span>\n                            <span class="value">-</span>\n                        </div>\n                        <div class="stat-row damage-of_wound1 warrior-stats" data-herostat="of_wound1"  data-trans="data-tip#herostat-tip-of_wound1">\n                            <span class="label" data-trans="stat-of_wound1"></span>\n                            <span class="value">-</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n\n            <div class="stat-row warrior-stats" data-herostat="speed-attack" data-trans="data-tip#herostat-tip-speed-attack"><span class="label" data-trans="stat-speed-attack"></span><span class="value">-</span></div>\n\n            <div class="stat-row warrior-stats" data-herostat="crit-chance" data-trans="data-tip#herostat-tip-crit-chance"><span class="label" data-trans="stat-critic-chance"></span><span class="value">-</span></div>\n\n            <div class="stat-row warrior-stats" data-herostat="helper-crit-chance" data-trans="data-tip#herostat-tip-helper-crit-chance"><span class="label" data-trans="stat-helper-critic-chance"></span><span class="value">-</span></div>\n\n            <div class="stat-group">\n                <h4 class ="magic-crit-title" data-trans="magic-crit-title"></h4>\n\n                <div class="sub-stat-group">\n                \n                    <div class="stat-row warrior-stats" data-herostat="crit-power" data-trans="data-tip#herostat-tip-crit-power"><span class="label" data-trans="stat-critic-pow"></span><span class="value">-</span></div>\n\n                    <div class="stat-row warrior-stats" data-herostat="helper-crit-power" data-trans="data-tip#herostat-tip-helper-crit-power"><span class="label" data-trans="stat-helper-critic-pow"></span><span class="value">-</span></div>\n\n                    <div class="stat-row warrior-stats" data-herostat="mcrit-fire" data-trans="data-tip#herostat-tip-mcrit-fire"><span class="label" data-trans="mcrit-fire"></span><span class="value">-</span></div>\n\n                    <div class="stat-row warrior-stats" data-herostat="mcrit-lightning" data-trans="data-tip#herostat-tip-mcrit-lightning"><span class="label" data-trans="mcrit-light"></span><span class="value">-</span></div>\n\n                    <div class="stat-row warrior-stats" data-herostat="mcrit-cold" data-trans="data-tip#herostat-tip-mcrit-cold"><span class="label" data-trans="mcrit-cold"></span><span class="value">-</span></div>\n\n                </div>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="acdmg" data-trans="data-tip#herostat-tip-acdmg">\n                <span class="label" data-trans="stat-acdmg"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="slow" data-trans="data-tip#herostat-tip-slow">\n                <span class="label" data-trans="stat-slow"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="lowevade" data-trans="data-tip#herostat-tip-lowevade">\n                <span class="label" data-trans="stat-lowevade"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="acmdmg" data-trans="data-tip#herostat-tip-acmdmg">\n                <span class="label" data-trans="stat-acmdmg"></span>\n                <span class="value">-</span>\n            </div>\n        </div>\n\n        <div class="stats-section">\n            <h3 data-trans="stats_defence"></h3>\n\n            <div class="stat-row warrior-stats" data-herostat="armor-class" data-trans="data-tip#herostat-tip-armor-class">\n                <span class="label" data-trans="def-ac"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="lowcrit" data-trans="data-tip#herostat-tip-lowcrit">\n                <span class="label" data-trans="stat-lowcrit"></span>\n                <span class="value">-</span>\n            </div>\n\n\n            <div class="stat-row warrior-stats" data-herostat="evade" data-trans="data-tip#herostat-tip-evade">\n                <span class="label" data-trans="def-evade"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="block" data-trans="data-tip#herostat-tip-block"><span class="label" data-trans="def-block"></span><span class="value">-</span></div>\n\n            <div class="stat-row warrior-stats" data-herostat="heal" data-trans="data-tip#herostat-tip-heal"><span class="label" data-trans="def-heal"></span><span class="value">-</span></div>\n\n            <div class="stat-row warrior-stats" data-herostat="absorb" data-trans="data-tip#herostat-tip-absorb"><span class="label" data-trans="def-absorb"></span><span class="value">-</span></div>\n\n            <div class="stat-row warrior-stats" data-herostat="absorbm" data-trans="data-tip#herostat-tip-absorbm"><span class="label" data-trans="def-absorbm"></span><span class="value">-</span></div>\n\n            <div class="stat-group">\n                <h4 data-trans="def-res"></h4>\n\n                <div class="sub-stat-group">\n\n                    <div class="stat-row res-fire" data-herostat="res-fire" data-trans="data-tip#herostat-tip-res-fire"><span class="label" data-trans="res-fire"></span><span class="value">-</span></div>\n\n                    <div class="stat-row res-fire" data-herostat="res-lightning" data-trans="data-tip#herostat-tip-res-lightning"><span class="label" data-trans="res-light"></span><span class="value">-</span></div>\n\n                    <div class="stat-row res-fire" data-herostat="res-cold" data-trans="data-tip#herostat-tip-res-cold"><span class="label" data-trans="res-cold"></span><span class="value">-</span></div>\n\n                    <div class="stat-row res-fire" data-herostat="res-poison" data-trans="data-tip#herostat-tip-res-poison"><span class="label" data-trans="res-poison"></span><span class="value">-</span></div>\n                </div>\n            </div>\n            <div class="stat-row warrior-stats text-stat" data-herostat="fatigs-mana" data-trans="data-tip#herostat-tip-fatigs-mana">\n                <span class="value">-</span>\n            </div>\n            <div class="stat-row warrior-stats text-stat" data-herostat="fatigs-energy" data-trans="data-tip#herostat-tip-fatigs-energy">\n                <span class="value">-</span>\n            </div>\n            \n            <div class="stat-row warrior-stats" data-herostat="manadest" data-trans="data-tip#herostat-tip-manadest">\n                <span class="label" data-trans="stat-manadest"></span>\n                <span class="value">-</span>\n            </div>\n\n            <div class="stat-row warrior-stats" data-herostat="endest" data-trans="data-tip#herostat-tip-endest">\n                <span class="label" data-trans="stat-endest"></span>\n                <span class="value">-</span>\n            </div>\n        </div>\n\n        <div class="stats-section">\n            <h3 data-trans="stats_power"></h3>\n\n            <div class="stat-row warrior-stats" data-herostat="mana" data-trans="data-tip#herostat-tip-mana">\n                <span class="label" data-trans="stat-mana"></span>\n                <span class="value">-</span>\n            </div>\n            <div class="stat-row warrior-stats" data-herostat="energy" data-trans="data-tip#herostat-tip-energy">\n                <span class="label" data-trans="stat-energy"></span>\n                <span class="value">-</span>\n            </div>\n            <div class="stat-row warrior-stats" data-herostat="energygain" data-trans="data-tip#herostat-tip-energygain">\n                <span class="label" data-trans="stat-energygain"></span>\n                <span class="value">-</span>\n            </div>\n            <div class="stat-row warrior-stats" data-herostat="managain" data-trans="data-tip#herostat-tip-managain">\n                <span class="label" data-trans="stat-managain"></span>\n                <span class="value">-</span>\n            </div>\n        </div>\n\n        <div class="stats-section">\n            <h3 data-trans="stats_basic"></h3>\n\n            <div class="hand-out-points"></div>\n\n            <div class="stat-row warrior-stats" data-herostat="strength" data-trans="data-tip#herostat-tip-strength">\n                <span class="label" data-trans="stat-strength"></span>\n                <span class="value">-</span>\n            </div>\n            <div class="stat-row warrior-stats" data-herostat="dexterity" data-trans="data-tip#herostat-tip-dexterity">\n                <span class="label" data-trans="stat-dexterity"></span>\n                <span class="value">-</span>\n\n            </div>\n            <div class="stat-row warrior-stats" data-herostat="intelligence" data-trans="data-tip#herostat-tip-intelligence">\n                <span class="label" data-trans="stat-inteligence"></span>\n                <span class="value">-</span>\n            </div>\n        </div>\n\n        <div class="stats-section">\n            <h3 data-trans="stats_aux"></h3>\n\n            <div class="stat-row" data-herostat="honor-points" data-trans="data-tip#herostat-tip-honor-points"><span class="label" data-trans="stat-honor"></span><span class="value">-</span></div>\n            <div class="stat-row" data-herostat="dragonite-tmp" data-trans="data-tip#herostat-tip-dragonite-tmp"><span class="label" data-trans="stat-credits2"></span><span class="value">-</span></div>\n            <div class="stat-row" data-herostat="stamina" data-trans="data-tip#herostat-tip-stamina"><span class="label" data-trans="stat-stamina"></span><span class="value">-</span></div>\n            <div class="stat-group">\n                <h4 class="passive-stats-header" data-trans="passive-stats-header"></h4>\n                <div class="sub-stat-group">\n                    <div class="stat-row passive-stats" data-herostat="resp_reduction" data-trans="data-tip#herostat-tip-resp_reduction" data-unit="%"><span class="label" data-trans="stat-resp_reduction"></span><span class="value">-</span></div>\n                    <div class="stat-row passive-stats" data-herostat="after_heal-chance" data-trans="data-tip#herostat-tip-after_heal-chance" data-unit="%"><span class="label" data-trans="stat-after_heal-chance"></span><span class="value">-</span></div>\n                    <div class="stat-row passive-stats" data-herostat="after_heal-power" data-trans="data-tip#herostat-tip-after_heal-power"><span class="label" data-trans="stat-after_heal-power"></span><span class="value">-</span></div>\n                </div>\n            </div>\n           \n            \n        </div>\n\n        <div class="stats-section legends">\n            <h3 data-trans="legend_bonuses"></h3>\n            <span data-trans="#no_leg_bon" class="nolegbon-tmp"></span>\n            <div class="bonuses"></div>\n        </div>\n    </div>',i.character_wrapper='<div class="character_wrapper">\n        <div class="equipment-wrapper">\n            <div class="eq-slot" data-st="10"></div>\n            <div class="eq-slot" data-st="1"></div>\n            <div class="eq-slot" data-st="2"></div>\n            <div class="eq-slot" data-st="3"></div>\n            <div class="eq-slot" data-st="4"></div>\n            <div class="eq-slot" data-st="5"></div>\n            <div class="eq-slot" data-st="6"></div>\n            <div class="eq-slot" data-st="7"></div>\n            <div class="eq-slot" data-st="8"></div>\n            <div class="eq-slot" data-st="9"></div>\n            <div class="skill-switch"></div>\n        </div>\n        <div class="stats-wrapper">\n            <div class="header-title" data-trans="#stats-head-title#stats"></div>\n            <div class="stats-button"></div>\n            <ul class="stats-list">\n                <li class="attack" data-trans="data-tip#attack#stats"><span class="icon"></span><span class="value"></span></li>\n                <li class="attack-speed" data-trans="data-tip#attack-speed#stats"><span class="icon"></span><span class="value"></span></li>\n                <li class="defence" data-trans="data-tip#defence#stats"><span class="icon"></span><span class="value"></span></li>\n                <li class="resists" data-trans="data-tip#resists#stats">\n                    <span class="icon"></span>\n                    <span class="value">\n                        <span class="resist-stats">\n                            <span class="stat red js-res-fire"></span> / \n                            <span class="stat yellow js-res-light"></span> / \n                            <span class="stat blue js-res-frost"></span> / \n                            <span class="stat green js-res-poison"></span> %\n                        </span>\n                    </span>\n                </li>\n            </ul>\n        </div>\n        <div class="pvp-btn" data-trans="data-tip#pvp_tip#buttons" data-tip-type="t_static"></div>\n    </div>',i.stat='<span class="stat"></span>',i["battle-set-wrapper"]='<div class="battle-set-wrapper">\n        <div class="battle-set-choice"></div>\n        <div class="battle-set-choice"></div>\n        <div class="battle-set-choice"></div>\n    </div>',i.inventory_wrapper='<div class="inventory_wrapper">\n        <div class="bags-navigation">\n            <div class="tutorial-bag"></div>\n        </div>\n        <div class="inventory-grid-bg">\n            <div class="inventory-grid">\n                <div class="inner-grid">\n                    <div class="scroll-pane"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i.b_wrapper='<div class="b_wrapper">\n        <div class="all-b"></div>\n        <div class="left"></div>\n        <div class="right"></div>\n    </div>',i["captcha-pre-info"]='<div class="captcha-pre-info">\n        <span data-trans="#captcha_time"></span>\n        <span class="captcha-pre-info__time"></span>s\n        <div class="captcha-pre-info__button"></div>\n        <div class="captcha-pre-info__toggler">\n            <div class="captcha-pre-info__arrow"></div>\n        </div>\n    </div>',i["chat-tpl"]='<div class="chat-tpl section">\n        <div class="chat-pannel"></div>\n        <div class="tabs-pannel"></div>\n        <div class="right-tabs-wrapper connectedSortable"></div>\n        <div class="tabs-wrapper connectedSortable"></div>\n        <div class="messages-wrapper scroll-wrapper">\n            <div class="under-tab-decor"></div>\n            <div class="scroll-pane"></div>\n        </div>\n        <div class="input-wrapper">\n            <input data-trans="placeholder#enter_to_chat#chat" autocomplete="off" />\n        </div>\n        <div class="send-btn right"></div>\n        <div class="chat-plug"></div>\n    </div>',i["hp-indicator-wrapper"]='<div class="hp-indicator-wrapper">\n        <div class="hp-indicator">\n            <div class="blood-frame"></div>\n            <div class="blood" bar-horizontal="false"></div>\n            <div class="hpp"><span class="value">50</span></div>\n        </div>\n        <div class="glass"></div>\n    </div>',i["exp-bar-wrapper"]='<div class="exp-bar-wrapper">\n        <div class="exp-progress left">\n            <div class="progress">\n                <div class="inner" bar-horizontal="true"></div>\n            </div>\n            <div class="overlay"></div>\n            <div class="ribbon"></div>\n        </div>\n        <div class="exp-progress right">\n            <div class="progress">\n                <div class="inner" bar-horizontal="true"></div>\n            </div>\n            <div class="overlay"></div>\n            <div class="ribbon"></div>\n        </div>\n    </div>',i["one-legend-bonus"]='<div class="one-legend-bonus"></div>',i["widget-button"]='<div class="widget-button">\n        <div class="icon"></div>\n        <div class="amount"></div>\n    </div>',i["empty-slot-widget"]='<div class="empty-slot-widget"></div>',i.button='<div class="button">\n        <div class="background"></div>\n        <div class="label"></div>\n    </div>',i["settings-button"]='<div class="settings-button" data-trans="data-tip#option"></div>',i["toggle-size-button"]='<div class="toggle-size-button" data-trans="data-tip#change_size"></div>',i["change-visible-button"]='<div class="change-visible-button" data-trans="data-tip#change-visible-button"></div>',i["delete-button"]='<div class="delete-button" data-trans="data-tip#delete"></div>',i["tip-wrapper"]='<div class="tip-wrapper">\n        <div class="content"></div>\n    </div>',i.item='<div class="item">\n        <div class="highlight"></div>\n        <canvas class="icon canvas-icon" width="32" height="32"></canvas>\n        <canvas class="canvas-notice" width="32" height="32"></canvas>\n    </div>',i["alert-item"]='<div class="alert-item">\n        <div class="alert-item-name"></div>\n        <div class="alert-item-icon"></div>\n    </div>',i["new-item"]='<div class="new-item"></div>',i.afterUseBottonItem='<div class="afterUseBottonItem"></div>',i["right-column-notif"]='<div class="right-column-notif">\n        <span class="notif-value c-amount"></span>\n    </div>',i["popup-menu"]='<div class="popup-menu"></div>',i["menu-item"]='<div class="menu-item"></div>',i.bubbledialog='<div class="bubbledialog">\n        <div class="bg-layer">\n            <div class="top-frame"></div>\n            <div class="left-frame"></div>\n            <div class="right-frame"></div>\n            <div class="bottom-frame"></div>\n        </div>\n        <div class="content-layer">\n            <div class="inner">\n                <div class="container">\n                    <div class="message"></div>\n                    <ul class="answers"></ul>\n                </div>\n            </div>\n        </div>\n    </div>',i["bubbledialog-answer"]='<li class="bubbledialog-answer answer"></li>',i["console-window"]='<div class="console-window">\n        <div class="size-button toggle-size-button"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class=console-content></div>\n            </div>\n        </div>\n        <div class="input-wrapper">\n            <div class="gt_console">&gt;</div>\n            <input class="console-input" id="console_input" placeholder="Console input" autocomplete="off"/>\n        </div>\n        <div class="console-bottom-panel-wrapper">\n            <div class="console-bottom-panel">\n            </div>\n        </div>\n    </div>',i["console-message"]='<div class="console-message"></div>',i["wanted-list"]='<div class="wanted-list">\n        <div class="scroll-wrapper">\n            <div class="scroll-pane">\n                <div class="empty row-in-trans-window">----</div>\n            </div>\n        </div>\n    </div>',i["one-wanted"]='<div class="one-wanted tw-list-item">\n        <div class="nick"><div class="inner"></div></div>\n        <div class="city"><div class="inner"></div></div>\n        <div class="cords"></div>\n    </div>',i["one-baner"]='<div class="one-baner"></div>',i["mails-window"]='\n    <div class="mails-window">\n        <div class="how-mail-or-char"></div>\n        <div class="mails-window__tabs"></div>\n        <div class="mails-window__contents"></div>\n        <div class="bottom-mail-panel">\n            <div class="bottom-panel-graphics"></div>\n        </div>\n    </div>',i["mail-column"]='<div class="mail-column">\n        <div class="middle-graphic"></div>\n        <div class="content-header"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane"></div>\n        </div>\n        <div class="footer"></div>\n    </div>',i["new-message"]='<div class="new-message">\n        <div class="middle-graphic"></div>\n        <div class="new-message-wrapper">\n            <div class="content-header">\n                <div class="to">\n                    \x3c!--<div class="to-label to-item"></div>--\x3e\n                    <div class="wrapper-mail-to to-item">\n                        <input data-trans="placeholder#recipient#mails" class="mail-to default"/>\n                    </div>\n                    <div class="to-buttons to-item"></div>\n                </div>\n            </div>\n            <div class="text-area-wrapper">\n                <textarea data-trans="placeholder#msgtext#mails" class="mail-msg"></textarea>\n            </div>\n        </div>\n        <div class="footer">\n            <div class="atachments">\n                <div class="item-label foot-item"></div>\n                <div class="foot-item">\n                    <div class="send-item"></div>\n                </div>\n                <div class="money-label foot-item"></div>\n                <div class="wrapper-money-imput foot-item">\n                    <input class="money-amount default"/>\n                </div>\n                <div class="send-mail-buttons foot-item"></div>\n            </div>\n        </div>\n    </div>',i["one-mail-wraper"]='<div class="one-mail-wraper">\n        <div class="one-mail-head">\n            <span class="from"></span>\n            <span class="small"></span>\n            <span class="when"></span>\n        </div>\n        <div class="msg-content"></div>\n        <div class="mail-footer">\n            <div class="a-info"></div>\n            <div class="a-item">\n            </div>\n            <div class="a-money">\n                <div class="item">\n                    <div class="img"></div>\n                </div>\n            </div>\n            <div class="a-tears">\n                <div class="item">\n                    <div class="img"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["mail-fraud"]='<div class="mail-fraud fraud"></div>',i["mails-container"]='<div class="mails-container"></div>',i["mail-is-new"]='<span class="mail-is-new is-new"></span>',i["mail-box-empty"]='<div class="mail-box-empty is-new"></div>',i["recovery-item"]='<div class="recovery-item">\n        \x3c!--<div class="header-graphics"></div>--\x3e\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#item_recover_header"></div>--\x3e\n        \x3c!--</div>--\x3e\n        \x3c!--<div class="info-1"> </div>--\x3e\n        <div class="info-2"></div>\n        <div class="info-3">\n            <div class="table-wrapper">\n                <div class="text-1"></div>\n                <div class="img-wrapper">\n                    <div class="sl-graphics"></div>\n                </div>\n            </div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n                <div class="paper-graphics"></div>\n\x3c!--                <table class="recovery-items-table"></table>--\x3e\n            </div>\n            <table class="static-bar-table"></table>\n        </div>\n        <div class="recover-bottom-panel">\n            <div class="chest-wrapper">\n                <div class="chest"></div>\n            </div>\n            <div class="info-label"></div>\n            <div class="buy-sl"></div>\n        </div>\n    </div>',i["item-slot"]='<div class="item-slot"></div>',i.tutorial='<div class="tutorial">\n        \x3c!--<div class="paper-graphics"></div>--\x3e\n        \x3c!--<div class="avatar"></div>--\x3e\n        <div class="graphic-area"></div>\n        <div class="click-area"></div>\n        <div class="con"></div>\n        <div class="buttons">\n            <div class="off-tutorial"></div>\n            <div class="right-buttons">\n                <div class="skip-tutorial"></div>\n                <div class="finish-tutorial"></div>\n            </div>\n        </div>\n    </div>',i.depo='<div class="depo">\n        \x3c!--<div class="depo-header">--\x3e\n        \x3c!--<div class="header-graphic"></div>--\x3e\n        \x3c!--<div class="depo-header-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="depo-graphic-background"></div>\n        <div class="find-and-manage-money-section">\n            <div class="left-part">\n                <div class="search-wrapper default">\n                    <input class="search" data-trans="placeholder#search"/>\n                    <div class="search-x" data-trans="data-tip#delete"></div>\n                </div>\n                <div class="manage-money-wrapper">\n                    <div class="manage-money-wrapper-graphic"></div>\n                    <div class="payments-bar-wrapper">\n                        <div class="price-wrapper">\n                            <input class="price default2" data-trans="placeholder#fill-gold-value#depo"/>\n                            <div class="info-icon" data-tip-type="t-left" data-trans="data-tip#unit_tip#depo"></div>\n                        </div>\n                        <div class="give"></div>\n                        <div class="get"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="right-part">\n                <div class="money-info"></div>\n                <div class="gold-amound" data-trans="#gold-in-depo#depo"></div>\n                <div class="gold-value"></div>\n                <div class="date-available" data-trans="#date-available#depo"></div>\n                <div class="date-value"></div>\n            </div>\n        </div>\n        <div class="filter-section">\n            <div class="filter-section-graphic"></div>\n            <div class="all-menus-wrapper">\n                <div class="first"></div>\n                <div class="second"></div>\n            </div>\n        </div>\n        <div class="item-section grid-wrapper">\n            <div class="slots-background"></div>\n            \x3c!--<div class="grid"></div>--\x3e\n            <div class="depo-expired depo-expired--hidden">\n                <div class="depo-expired__text"></div>\n            </div>\n        </div>\n        <div class="green-bar-section"></div>\n        <div class="bottom-section">\n            <div class="cards-menu">\n                <div class="cards-background"></div>\n                <div class="midle-cards-overflow">\n                    <div class="cards-content"></div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-bar">\n            <div class="available-slots">\n                <span data-trans="#available-slots#depo"></span>:\n                <span class="available-slots-current"></span>/<span class="available-slots-all"></span>\n            </div>\n            <div class="actions-bar-content">\n                <div class="info-icon" data-trans="data-tip#depo-payment-info#depo"></div>\n                <div class="depo-buy but"></div>\n                <div class="depo-payment but"></div>\n                <div class="upgrade but"></div>\n                <div class="delete-deposit but"></div>\n            </div>\n        </div>\n    </div>',i["depo-item-grid"]='\n            <div class="grid"></div>\n    ',i.depo_backlight='<div class="depo_backlight"></div>',i["depo-filter"]='<div class="depo-filter">\n        <div class="menu-wrapper">\n            <div class="menu"></div>\n        </div>\n        <div class="back"></div>\n    </div>',i["mini-map-local-content"]='<div class="mini-map-local-content">\n        <div class="scroll-wrapper">\n            <div class="scroll-pane"></div>\n        </div>\n    </div>',i["border-wrapper-mini-map"]='<div class="border-wrapper-mini-map"></div>',i["element-mini-map"]='<div class="element-mini-map element">\n        <div class="border-wrapper"></div>\n    </div>',i["icon-wrapper-map"]='<div class="icon-wrapper-map icon-wrapper">\n        <div class="emo-npc-icon"></div>\n    </div>',i["one-location-on-map"]='<div class="one-location-on-map"></div>',i["mini-map-global-content"]='<div class="mini-map-global-content">\n        <div class="search-wrapper default">\n            <input class="search"/>\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n        <div class="scroll-wrapper">\n            <div class="scroll-pane"></div>\n        </div>\n    </div>',i["local-map-element"]='<div class="local-map-element">\n        <div class="table-wrapper">\n            <div class="left-side">\n                <div class="label"></div>\n                <div class="toggle"></div>\n            </div>\n            <div class="icon-wrapper">\n                <div class="emo-npc-icon"></div>\n            </div>\n        </div>\n        <div class="line"></div>\n    </div>',i["mini-map-window"]='<div class="mini-map-window">\n        <div class="mini-map-positioner">\n            <div class="hero-mark mark" data-trans="data-tip#my_character#map"></div>\n        </div>\n        <div class="search-wrapper search-item-wrapper">\n            <input class="search"/>\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n    </div>',i["handheld-mini-map"]='<div class="handheld-mini-map">\n           <canvas class="handheld-mini-map-canvas" ></canvas>\n           <div class="search-wrapper search-item-wrapper">\n               <input class="search"/>\n               <div class="search-x" data-trans="data-tip#delete"></div>\n           </div>\n       </div>',i["dynamic-bck"]='<div class="dynamic-bck bck"></div>',i["show-monsters-header"]='<div class="show-monsters-header"></div>',i["color-label-window-map"]='<div class="color-label-window-map color-label"></div>',i["show-label-window-map"]='<div class="show-label-window-map show-label"></div>',i["show-label-data-drawer-nick"]='<div class="show-label-data-drawer-nick show-label"></div>',i["show-label-data-drawer-prof-and-level"]='<div class="show-label-data-drawer-prof-and-level show-label"></div>',i["show-label-data-drawer-prof-and-level"]='<div class="show-label-data-drawer-prof-and-level show-label"></div>',i["show-label-who-is-here"]='<div class="show-label-who-is-here show-label"></div>',i["show-label-map-blur"]='<div class="show-label-map-blur show-label"></div>',i["icons-column-mini-map"]='<div class="icons-column-mini-map icons-column mm-mark-list"></div>',i["first-column-mini-map"]='<div class="first-column-mini-map first-column"></div>',i["second-column-mini-map"]='<div class="second-column-mini-map second-column"></div>',i["color-to-choose-mini-map"]='<div class="color-to-choose-mini-map color-to-choose"></div>',i["mini-map-other"]='<div class="mini-map-other other mark"></div>',i["mini-map-gateway"]='<div class="mini-map-gateway gateway mark"></div>',i["mini-map-rip"]='<div class="mini-map-rip rip mark"></div>',i["mini-map-monster"]='<div class="mini-map-monster monster mark"></div>',i["mini-map-recovery"]='<div class="mini-map-recovery recovery mark"></div>',i["hero-mark"]='<div class="hero-mark mark"></div>',i["border-war-shadow"]='<div class="border-war-shadow"></div>',i["event-calendar"]='<div class="event-calendar">\n        <div class="background">\n            <div class="matrix">\n                <div class="event-calendar-cell prev-week week-switch"></div>\n                <div class="event-calendar-cell next-week week-switch"></div>\n                <div class="days-wrapper"></div>\n            </div>\n            <div class="controlls">\n                <div class="month-switch prev-month"></div>\n                <div class="month-switch next-month"></div>\n                <div class="date-display"></div>\n                <div class="month-display"></div>\n            </div>\n        </div>\n    </div>',i["event-calendar-cell"]='<div class="event-calendar-cell">\n        <div class="inner-cell">\n            <div class="day-and-date"></div>\n            <div class="events-holder"></div>\n        </div>\n    </div>',i["chests-window"]='<div class="chests-window">\n        <div class="brown-background"></div>\n        <div class="chests-choice-wrapper"></div>\n        <div class="chests-bottom-panel">\n            <div class="chest-wrapper">\n                <div class="chest"></div>\n            </div>\n            <div class="info-wrapper">\n                <div class="info-label"></div>\n                <div class="buy-sl"></div>\n            </div>\n        </div>\n    </div>',i["promo-window"]='<div class="promo-window">\n        <div class="background-graphic"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="header-wrapper">\n                    <div class="promo" data-trans="promo"></div>\n                    <div class="promo-percent"></div>\n                </div>\n                <div class="items-wrapper"></div>\n            </div>\n        </div>\n        <div class="promo-bottom-panel">\n            <div class="chest-wrapper">\n                <div class="chest"></div>\n            </div>\n            <div class="info-wrapper">\n                <div class="buy-sl"></div>\n            </div>\n        </div>\n    </div>',i["promo-chest"]='<div class="promo-chest">\n        <div class="header-txt"></div>\n        <div class="img-wrapper">\n            <div class="chest-img"></div>\n        </div>\n        <div class="txt-wrapper">\n            <div class="txt-html"></div>\n        </div>\n        <div class="btn-wrapper btns-spacing"></div>\n        <div class="price-txt"></div>\n    </div>',i["shop-promo-item-wrapper"]='<div class="shop-promo-item-wrapper">\n        <div data-template="shop-promo-item img-wraper" class="img-wraper">\n            <div class="item-wrapper"></div>\n            <div class="item-price"></div>\n            <div class="item-price-new"></div>\n            <div class="btn-wrapper"></div>\n        </div>\n    </div>',i["shop-promo-item"]='<div class="shop-promo-item img-wraper">\n        <div class="item-wrapper">\n          <div class="item-slot-container"></div>\n          <div class="item-price"></div>\n          <div class="item-price-new"></div>\n        </div>\n        <div class="btn-wrapper"></div>\n    </div>',i["advent-calendar"]='<div class="advent-calendar">\n        <div class="background"></div>\n        <div class="cell-grid"></div>\n    </div>',i["advent-cell"]='<div class="advent-cell">\n        <div class="number"></div>\n        <div class="item-container"></div>\n    </div>',i.book='<div class="book">\n        <div class="bg">\n            <div class="left"></div>\n            <div class="right">\n                <div class="book-title"></div>\n                <div class="author"></div>\n                <div class="flower">\n                    <div class="book-info">\n                        <span class="which"></span>\n                        <span class="amount"></span>\n                    </div>\n                    <div class="prev"></div>\n                    <div class="next"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i.captcha='<div class="captcha">\n        <div class="captcha__question"></div>\n        <div class="captcha__image"></div>\n        <div class="captcha__buttons"></div>\n        <div class="captcha__confirm"></div>\n        <div class="captcha__triesleft"></div>\n    </div>',i.poll='<div class="poll">\n        <form>\n            <div class="poll__list"></div>\n            <div class="poll__confirm"></div>\n        </form>\n    </div>',i["poll__list-item"]='<div class="poll__list-item">\n        <div class="poll__question"></div>\n        <div class="poll__answers"></div>\n    </div>',i["code-manager-input"]='<div class="code-manager-input">\n        <input class="code default"/>\n    </div>',i["code-manager"]='<div class="code-manager">\n        <div class="wnd-dark-bg"></div>\n        <div class="wrapper">\n            <div class="info-box"></div>\n            <div class="info mt-3">\n                <div class="info-desc"></div>\n                <div class="promo-alert promo-alert-use"></div>\n                <div class="promo-alert promo-alert-expire"></div>\n            </div>\n            <div class="grid"></div>\n            <div class="info-label"></div>\n        </div>\n    </div>',i["chat-message"]='<div class="chat-message">\n        <span class="nick"></span>\n        <span class="info">i</span>\n        <span class="color-chat-msg"></span>\n    </div>',i["chat-tab"]='<div class="chat-tab tab">\n        <div class="icon"></div>\n        <div class="notif">\n            <span class="counter">0</span>\n        </div>\n        <div class="close" data-tip-type="t_chat_card"></div>\n    </div>',i["chat-ban"]='<div class="chat-ban">\n        <div class="question"></div>\n        <div class="days"></div>\n        <div class="ban-reason-label" data-trans="banday_reason_label"></div>\n        <div class="input-wrapper">\n            <input class="ban-reason default">\n        </div>\n        <div class="ban-btn"></div>\n    </div>',i["banday-row"]='<div class="banday-row">\n        <div class="table-wrapper">\n            <div class="checkbox-wrapper">\n                <div class="checkbox"></div>\n            </div>\n            <span class="nr"></span>\n        </div>\n    </div>',i["dialogue-window"]='<div class="dialogue-window" data-opacity-lvl="1">\n        \x3c!--<div class="dialogue-background-color"></div>--\x3e\n        \x3c!--<div class="dialogue-border"></div>--\x3e\n        <div class="content">\n            <div class="border-image"></div>\n            <div class="npc-dialogue-wrapper">\n                <div class="h_content"></div>\n                <div class="npc-message"></div>\n            </div>\n            <div class="inner scroll-wrapper small-bar">\n                <div class="scroll-pane">\n                    <ul class="answers"></ul>\n                </div>\n            </div>\n        </div>\n        \x3c!--<header>--\x3e\n\n        \x3c!--</header>--\x3e\n    </div>',i["dialogue-window-answer"]='<li class="dialogue-window-answer answer">\n        <div class="icon"></div>\n        <span class="answer-text"></span>\n    </li>',i["dialogue-window-rewards"]='<div class="dialogue-window-rewards">\n        <h2 class="rewards-header"></h2>\n        <div class="rewards-items"></div>\n    </div>',i["dialogue-window-reward-line"]='<div class="dialogue-window-reward-line rewardLine"></div>',i["dialogue-window-reward-el"]='<div class="dialogue-window-reward-el rewardElement">\n        <span class="label"></span>\n        \x3c!--<div class="container"></div>--\x3e\n    </div>',i["dialogue-window-reward-item"]='<div class="dialogue-window-reward-item container">\n        <div class="rew-item-slot"></div>\n    </div>',i["shop-wrapper"]='<div class="shop-wrapper">\n        <div class="shop-content">\n            \x3c!--<div class="header" data-trans="#shop_head#shop"></div>--\x3e\n            \x3c!--<div class="close-button"></div>--\x3e\n            <div class="for-you-plug"></div>\n            <div class="shop-items items-grid scroll-wrapper classic-bar">\n                <div class="scroll-pane"></div>\n            </div>\n            <div class="buy-items items-grid ">\n                <span class="label" data-trans="#buying_items#shop"></span>\n            </div>\n            <div class="sell-items items-grid">\n                \x3c!--<span class="label" data-trans="#selling_items#shop"></span>--\x3e\n                <span class="label"></span>\n\n                <canvas class="SHOP_CANVAS"></canvas>\n            </div>\n\n            <div class="for-you-txt" data-trans="#badged#extManager"></div>\n            <div class="for-you-plug-disabled">\n                <div class="disabled-text" data-trans="#for_you_alert"></div>\n            </div>\n\n            <div class="shop-info-wrapper"></div>\n            <div class="shop-balance">\n                <div class="sell">0</div>\n                <div class="buy">0</div>\n                <div class="balance">0</div>\n                <div class="total-price" data-trans="#total-price"></div>\n            </div>\n            <div class="finalize-button btns-spacing"></div>\n            <div class="more-gold-button"></div>\n            <div class="filters-heading" data-trans="#filters#shop"></div>\n            <div class="quick-sell-heading" data-trans="#quick_sell#shop"></div>\n            <div class="bag-heading" data-trans="#bag#shop"></div>\n            <div class="great-merchamp btns-spacing"></div>\n            <div class="show-items-filter">\n                <div class="wrapper" data-trans="data-tip#own-profession-tip">\n                    <div class="filter-label" data-trans="#own-profession-label"></div>\n                    <div class="checkbox own-profession"></div>\n                </div>\n                <div class="wrapper" data-trans="data-tip#own-level-tip">\n                    <div class="filter-label" data-trans="#own-level-label"></div>\n                    <div class="checkbox own-level"></div>\n                </div>\n                <div class="wrapper" data-trans="data-tip#can-afford-tip">\n                    <div class="filter-label" data-trans="#can-afford-label"></div>\n                    <div class="checkbox can-afford"></div>\n                </div>\n            </div>\n            <div class="shop-bottom-panel">\n                <div class="chest-wrapper">\n                    <div class="chest"></div>\n                </div>\n                <div class="table-wrapper">\n                    <div class="currency-label"></div>\n                    <div class="buy-currency"></div>\n                    <div class="recover-items"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["si-currency"]='<div class="si-currency">\n        <div class="si-currency__label"><b></b></div>\n        <div class="si-currency__icon"></div>\n        <div class="si-currency__desc"></div>\n    </div>',i["scrollbar-wrapper"]='<div class="scrollbar-wrapper">\n        <div class="background"></div>\n        <div class="arrow-up"></div>\n        <div class="arrow-down"></div>\n        <div class="track">\n            <div class="handle"></div>\n        </div>\n    </div>',i["mc-addon"]='<div class="mc-addon">\n        <div class="nick-header"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="mc-addon-content">\n                    <div class="all-texts"></div>\n                    <div class="times-of-mute"></div>\n                    <div class="unmute"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["mc-text"]=' <div class="mc-text">\n        <div class="label-wrapper">\n            <div class="label-text"></div>\n        </div>\n        <div class="send"></div>\n    </div>',i["battle-controller"]='<div class="battle-controller">\n        <div class="graphics">\n            <div class="header-graphic"></div>\n            <div class="middle-graphic"></div>\n            <div class="bottom-graphic"></div>\n        </div>\n        <div class="battle-content">\n            <div class="time-wrapper">\n                <div class="seconds"></div>\n                <div class="time-progress-bar">\n                    <div class="time-inner" bar-horizontal="true"></div>\n                </div>\n            </div>\n            <div class="nick"></div>\n            <div class="level-icon">\n                <div class="level"></div>\n                <div class="prof-wrapper"></div>\n            </div>\n            <div class="toggle-battle"></div>\n            <div class="attach-battle-log-help-window" data-trans="data-tip#attach-battle-log-help-window"></div>\n            <div class="attach-battle-prediction-help-window" data-trans="data-tip#attach-battle-prediction-help-window"></div>\n            <div class="surrender"></div>\n            <div class="left-column">\n                <div class="scroll-wrapper">\n                    <div class="scroll-pane"></div>\n                </div>\n            </div>\n            <div class="stats-wrapper"></div>\n            <div class="buffs-wrapper"></div>\n            <div class="buttons-wrapper"></div>\n            <div class="right-column">\n                <div class="scroll-wrapper">\n                    <div class="scroll-pane">\n                        <div class="turn-prediction"></div>\n                    </div>\n                </div>\n                <div class="battle-end-layer" data-trans="#battle_ended#battle"></div>\n            </div>\n        </div>\n        <div class="skill-usable-add-slots left">\n            <div class="skill-usable-slot" slot="8"></div>\n            <div class="skill-usable-slot" slot="9"></div>\n            <div class="skill-usable-slot" slot="10"></div>\n            <div class="skill-usable-slot" slot="11"></div>\n        </div>\n        <div class="skill-usable-add-slots right">\n            <div class="skill-usable-slot" slot="15"></div>\n            <div class="skill-usable-slot" slot="14"></div>\n            <div class="skill-usable-slot" slot="13"></div>\n            <div class="skill-usable-slot" slot="12"></div>\n        </div>\n        <div class="skill-hider"></div>\n        <div class="battle-watch right"></div>\n    </div>',i["battle-log-help-window"]='\n    <div class="battle-log-help-window">\n        <div class="toggle-size-button"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n            </div>\n        </div>\n    </div>',i["battle-prediction-help-window"]='\n    <div class="battle-prediction-help-window">\n        \x3c!--<div class="toggle-size-button"></div>--\x3e\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n            </div>\n        </div>\n    </div>',i["turn-prediction__item"]='<div class="turn-prediction__item">\n        <div class="turn-prediction__content">\n            <div class="turn-prediction__av"></div>\n            <div class="turn-prediction__name"></div>\n        </div>\n    </div>',i["combo-wrapper"]='<div class="combo-wrapper"></div>',i["combo-point"]='<div class="combo-point"></div>',i["current-arrow"]='<div class="current-arrow">\n        <div class="css-arrow"></div>\n        <div class="canvas-arrow"></div>\n    </div>',i["after-use-skill"]='<div class="after-use-skill"></div>',i["profs-icon"]='<div class="profs-icon"></div>',i.buff='<div class="buff"></div>',i.dmg='<div class="dmg"></div>',i["battle-msg"]='<div class="battle-msg"></div>',i["progress-bar-wrapper"]='<div class="progress-bar-wrapper">\n        <div class="background"></div>\n        <div class="bar-percentage" bar-horizontal="true"></div>\n        <div class="label"></div>\n    </div>',i["battle-skill"]='<div class="battle-skill">\n        <div class="background"></div>\n        <div class="icon"></div>\n        <div class="name"></div>\n        <div class="type"></div>\n    </div>',i["battle-window"]='<div class="battle-window">\n        <div class="battle-interface">\n            <div class="inner">\n            </div>\n        </div>\n        <div class="battle-area">\n            <div class="battle-background"></div>\n            \x3c!--<div class="background"></div>--\x3e\n        </div>\n        <canvas class="battle-effect-tint"></canvas>\n        <canvas class="character-effects"></canvas>\n        \x3c!--<div class="battle-night-layer"></div>--\x3e\n        <canvas class="battle-night2-layer"></canvas>\n    </div>',i["enemy-info"]='<div class="enemy-info">\n        <div class="avatar"></div>\n        <div class="enemy-info-inner">\n            <div class="w-name"></div>\n            <div class="w-lvl-prof"></div>\n            <div class="hp-wrapper">\n                <div class="hp-wrapper-percentage"></div>\n                <div class="hp-wrapper-inner"></div>\n            </div>\n            <div class="buffs-wrapper"></div>\n        </div>\n    </div>',i["copy-log"]='<div class="copy-log">\n        <div class="battle-interface">\n        </div>\n        <div class="battlelog scroll-wrapper red-bar">\n            <div class="scroll-pane"></div>\n        </div>\n        <textarea spellcheck="false"></textarea>\n\n        <div class="copylog-info">\n\n        </div>\n    </div>',i["battle-summary"]='<div class="battle-summary">\n        <div class="banner"></div>\n\n        <div class="relative-content">\n            <div class="scroll-wrapper">\n                <div class="scroll-pane">\n                    <div class="loot">\n                        <div class="loot-header" data-trans="#loot_header#battle"></div>\n                        <div class="loot-time"></div>\n                        <div class="loot-inner">\n                            <div class="loot-wrapper"></div>\n                        </div>\n                    </div>\n                    <div class="report"></div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-bar-wrapper">\n            <div class="bottom-bar">\n                <div class="settings-button">\n                    <div class="icon"></div>\n                </div>\n                <div class="close-fight-button"></div>\n            </div>\n            <div class="loot-time"></div>\n        </div>\n    </div>',i["battle-banner"]='<div class="battle-banner">\n        <div class="result"></div>\n        <div class="description"></div>\n        <div class="exp-text"></div>\n        <div class="exp"></div>\n    </div>',i["battle-summary-item-wrapper"]='<div data-state="want" class="battle-summary-item-wrapper">\n        <div class="slot">\n            <div class="item-wrapper"></div>\n            \x3c!--<div class="prof-icons-holder"></div>--\x3e\n        </div>\n        <div class="text-info"></div>\n        <div class="change-state-btn"></div>\n    </div>',i["battle-report"]='<div class="battle-report">\n        <div class="report-header"></div>\n    </div>',i["one-warrior"]='<div class="one-warrior">\n        <div class="warrior-info">\n            <div class="warrior-name"></div>\n            <div class="warrior-class"></div>\n        </div>\n        <div class="hover-selector"></div>\n        <div class="selector"></div>\n        <div class="warrior grave-warrior-npc"></div>\n        <div class="warrior grave-warrior-other"></div>\n        <div class="warrior canvas-warrior-icon"></div>\n        <div class="warrior canvas-warrior-effects"></div>\n        <div class="warrior-dmg"></div>\n        <div class="warrior-buffs-wrapper"></div>\n        <div class="progress-bar-wrapper"></div>\n        <canvas class="canvas-graphic-effect canvas-icon-wrapper-top"></canvas>\n        <canvas class="canvas-graphic-effect canvas-icon-wrapper-right"></canvas>\n        <canvas class="canvas-graphic-effect canvas-icon-wrapper-bottom"></canvas>\n        <canvas class="canvas-graphic-effect canvas-icon-wrapper-left"></canvas>\n        <canvas class="canvas-graphic-effect canvas-icon-wrapper-center"></canvas>\n    </div>',i["one-battle-skill-tip"]='\n      <div class="one-battle-skill-tip">\n       \n       <div class="skill-tip-header">\n         <div class="skill-graphic-wrapper">\n          <div class="battle-skill">\n            <div class="icon skill-icon"></div>\n          </div>\n         </div>\n         <div class="skill-name"></div>\n       </div>\n       \n       <div class="skill-attrs"></div>\n       <div class="skill-level"></div>\n       <div class="skill-cost"></div>\n      </div>>',i["one-warrior-tip"]='<div class="one-warrior-tip">\n        <div class="nick"></div>\n        <div class="cl"></div>\n\n        <div class="one-warrior-tip-content">\n            <div class="hp"></div>\n            <div class="ac-content">\n                <div class="line"></div>\n                <span data-trans="#def-ac"></span>:\n                <span class="ac"></span>\n                <span class="ac-destroyed" data-trans="#def-ac-destroyed"></span>\n            </div>\n            <div class="resist-content">\n                <div><span data-trans="#def-res"></span>:</div>\n                <div>\n                    <span class="resfire red"></span>\n                    <span class="reslight yellow"></span>\n                    <span class="resfrost blue"></span>\n                    <span class="act green"></span>\n                </div>\n            </div>\n            <div class="mana-energy-content">\n                <div class="line"></div>\n                <div class="mana-energy">\n                    <div class="energy"></div>\n                    <div class="mana"></div>\n                </div>\n            </div>\n            <div class="sc-content">\n                <div class="line"></div>\n                <div data-trans="#super-cast"></div>\n                <div>\n                  <span class="sc-content__name"></span>:\n                  <span class="sc-content__percent"></span>\n                  (<span class="sc-content__turns"></span>)\n                </div>\n            </div>\n        </div>\n    </div>',i["super-cast"]='<div class="super-cast">\n        <div class="inner" bar-horizontal="true"></div>\n    </div>',i["health-points"]='<div class="health-points">\n        <div class="inner" bar-horizontal="true"></div>\n    </div>',i["energy-points"]='<div class="energy-points">\n        <div class="inner" bar-horizontal="true"></div>\n    </div>',i["mana-points"]='<div class="mana-points">\n        <div class="inner" bar-horizontal="true"></div>\n    </div>',i["cooldown-left"]='<div class="cooldown-left"></div>',i["quest-log"]='<div class="quest-log">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#quests_wnd_title#quest"></div>--\x3e\n        \x3c!--</div>--\x3e\n        \x3c!--<div class="header-graphics"></div>--\x3e\n        \x3c!--<div class="header-big-label"></div>--\x3e\n        <div class="search-wrapper quest-search">\n            <input class="search"/>\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n            </div>\n        </div>\n    </div>',i["quest-box"]='<div class="quest-box">\n        <div class="info-wrapper">\n            <div class="quest-title"></div>\n            <div class="quest-buttons">\n                <div class="quest-buttons-wrapper"></div>\n            </div>\n        </div>\n        <div class="quest-content">\n            <div class="d-table">\n                <div class="d-cell">\n                    <div class="q_icon"></div>\n                </div>\n                <div class="d-cell">\n                    <span class="q_doit"></span>\n                    <span class="q_kill"></span>\n                </div>\n            </div>\n        </div>\n    </div>',i.quest='<div class="quest">\n        <div class="npc-icon"></div>\n        <div class="box">\n            <div class="info-btn"></div>\n            <div class="title"></div>\n            <div class="npc-name"></div>\n            <div class="text"></div>\n            <div class="auxinfo"></div>\n        </div>\n        <div class="buttons"></div>\n    </div>',i["loot-window"]='<div class="loot-window">\n        <div class="middle-graphics"></div>\n        <div class="items-wrapper"></div>\n        <div class="col button-wrapper"></div>\n        <div class="bottom-wrapper">\n            <div class="bottom-graphic"></div>\n            <div class="table-wrapper">\n                <div class="time-left"></div>\n                <div class="accept-button"></div>\n                <div class="bag-left"></div>\n            </div>\n        </div>\n    </div>',i["loot-icon"]='<div class="loot-icon icon"></div>',i["loot-item-wrapper"]='<div class="loot-item-wrapper" data-state="want">\n        <div class="slot"></div>\n        <div class="text-info"></div>\n        <div class="button-holder"></div>\n    </div>',i["help-window"]='<div class="help-window">\n        <div class="scroll-wrapper">\n            <div class="scroll-pane">\n                <div class="header">\n                    <h2 class="controls"></h2>\n\n                    <h2 class="symbols"></h2>\n                </div>\n                <div class="help-info-section">\n                    <div class="help-info-wrapper">\n                        <div class="help-info-img"></div>\n                    </div>\n                    <div class="help-info-text"></div>\n                    <div class="help-old-info-text"></div>\n                </div>\n                <div class="help-legend-section"></div>\n            </div>\n        </div>\n    </div>',i["help-window2"]='<div class="help-window2">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#move-and-fight#help"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="cards-header-wrapper">\n            <div class="header-background-graphic"></div>\n            <div class="cards-header">\n                <div class="card active" data-card="move-and-fight"><div class="label"></div></div>\n                <div class="card" data-card="environment"><div class="label"></div></div>\n                <div class="card" data-card="profs-and-items"><div class="label"></div></div>\n                <div class="card" data-card="premium"><div class="label"></div></div>\n            </div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="graphic-background"></div>\n            </div>\n        </div>\n    </div>',i["help-move-and-fight"]=`<div class="help-move-and-fight">\n        <div class="content-header margin" data-trans="#move-header#help"></div>\n        <div class="section-1 center margin">\n            <div class="move-ways-left">\n                <div class="move-ways-small-header margin" data-trans="#move-ways-small-header#help"></div>\n                <div class="move-ways" data-trans="#move-ways#help"></div>\n            </div>\n            <div class="move-ways-wrapper">\n                <div class="move-ways-graphic ${n()}"></div>\n            </div>\n        </div>\n        <div class="content-header margin" data-trans="#fight-header#help"></div>\n        <div class="section-2 center">\n            <div class="left-column">\n                <div class="uppercase-header" data-trans="#start-fight-h#help"></div>\n                <div class="kind-fight margin"></div>\n                <div class="uppercase-header" data-trans="#move-in-fight-h#help"></div>\n                <div class="move-in-fight margin"></div>\n                <div class="uppercase-header" data-trans="#exp-h#help"></div>\n                <div class="exp-in-fight margin justify" data-trans="#exp-in-fight#help"></div>\n                <div class="img-wrapper margin">\n                    <div class="level-img ${n()}"></div>\n                </div>\n                <div class="exp-level-info margin  justify" data-trans="#exp-level-info#help"></div>\n            </div>\n            <div class="right-column">\n                <div class="uppercase-header" data-trans="#skills-h#help"></div>\n                <div class="skill-desc margin justify" data-trans="#skills-desc#help"></div>\n                <div class="img-wrapper margin">\n                    <div class="skill-passive-active-img ${n()}"></div>\n                </div>\n                <div class="skill-passive-active-desc margin" data-trans="#skill-passive-active#help"></div>\n                <div class="img-wrapper">\n                    <div class="skill-in-bar ${n()}"></div>\n                </div>\n            </div>\n        </div>\n    </div>`,i["help-box-with-img"]=`<div class="help-box-with-img">\n        <div class="inner">\n            <div class="title"></div>\n            <div class="symbol ${n()}"></div>\n            <div class="text"></div>\n        </div>\n    </div>`,i["help-environment"]=`<div class="help-environment">\n        <div class="content-header margin" data-trans="#environment#help"></div>\n        <div class="left-column">\n            <div class="uppercase-header" data-trans="#dialog-h#help"></div>\n            <div class="margin" data-trans="#dialog-desc#help"></div>\n            <div class="uppercase-header" data-trans="#interface-customization-h#help"></div>\n            <div class="margin" data-trans="#interface-customization-desc#help"></div>\n            <div class="img-interface-customization margin ${n()}"></div>\n            <div class="uppercase-header" data-trans="#players_interaction-h#help"></div>\n            <div data-trans="#interaction-desc#help"></div>\n            <div class="uppercase-header" data-trans="#quests-h#help"></div>\n            <div class="margin" data-trans="#quests-desc#help"></div>\n            <div class="img-wrapper margin">\n                <div class="npc-img ${n()}"></div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="uppercase-header" data-trans="#quests-window-h#help"></div>\n            <div class="margin" data-trans="#quests-window-desc#help"></div>\n            <div class="img-wrapper margin">\n                <div class="quest-img ${n()}"></div>\n            </div>\n            <div class="uppercase-header" data-trans="#shop-h#help"></div>\n            <div data-trans="#shop-desc#help"></div>\n            <div class="img-wrapper margin">\n                <div class="shop-img ${n()}"></div>\n            </div>\n            <div class="uppercase-header" data-trans="#filter-bag-h#help"></div>\n            <div class="margin" data-trans="#filter-bag-desc#help"></div>\n            <div class="img-wrapper margin">\n                <div class="filter-loot-img ${n()}"></div>\n            </div>\n        </div>\n    </div>`,i["help-profs-and-items"]='<div class="help-profs-and-items">\n        <div class="content-header" data-trans="#profs#help"></div>\n        <div class="profs-content"></div>\n        <div class="content-header" data-trans="#items#help"></div>\n        <div class="items-content">\n            <div class="column-1">\n                <div class="column-header uppercase-header" data-trans="#items-cl#help"></div>\n                <div class="column-content"></div>\n            </div>\n            <div class="column-2">\n                <div class="column-header uppercase-header" data-trans="#items-type#help"></div>\n                <div class="column-content"></div>\n            </div>\n            <div class="column-3">\n                <div class="column-header uppercase-header" data-trans="#items-soulbound#help"></div>\n                <div class="column-content" data-trans="#items-soulbound-desc#help"></div>\n            </div>\n        </div>\n    </div>',i["help-one-prof"]='<div class="help-one-prof">\n        <div class="first-line">\n            <div class="symbol"></div>\n            <div class="name"></div>\n        </div>\n        <div class="second-line">\n            <div class="avatar-wrapper">\n                <div class="avatar"></div>\n            </div>\n            <div class="text"></div>\n        </div>\n        <div class="link-wrapper">\n            <a class="link" target="_blank"></a>\n        </div>\n    </div>',i["help-one-cl-item"]='<div class="help-one-cl-item">\n        <div class="wrapper">\n            <div class="icon cl-icon"></div>\n        </div>\n        <div class="text"></div>\n    </div>',i["help-premium"]=`<div class="help-premium">\n        <div class="content-header margin" data-trans="#premium#help"></div>\n        <div class="left-column">\n            <div class="uppercase-header margin" data-trans="#what-is-h#help"></div>\n            <div class="premium-offer margin" data-trans="#premium_offer#help"></div>\n            <div class="uppercase-header margin" data-trans="#boost-h#help"></div>\n            <div class="boost-account margin" data-trans="#boost-account#help"></div>\n            <div class="img-wrapper margin">\n                <div class="boost-img ${n()}"></div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="uppercase-header margin" data-trans="#where-is-shop-h#help"></div>\n            <div class="margin" data-trans="#where-is-shop-desc#help"></div>\n            <div class="img-wrapper margin">\n                <div class="premium-img ${n()}"></div>\n            </div>\n            <div class="uppercase-header margin" data-trans="#sl-investment-h#help"></div>\n            <div class="margin" data-trans="#sl-investment#help"></div>\n        </div>\n        <div class="center">\n            <div class="box-1 box">\n                <div class="margin bold" data-trans="#incredible_items#help"></div>\n                <div class="img-wrapper margin">\n                    <div class="premium-img ${n()}"></div>\n                </div>\n            </div>\n            <div class="box-2 box">\n                <div class="margin bold" data-trans="#great_items#help"></div>\n                <div class="img-wrapper margin">\n                    <div class="premium-img ${n()}"></div>\n                </div>\n            </div>\n            <div class="box-3 box">\n                <div class="margin bold" data-trans="#exceptional_items#help"></div>\n                <div class="img-wrapper margin">\n                    <div class="premium-img ${n()}"></div>\n                </div>\n            </div>\n        </div>\n    </div>`,i["help-icon"]='<div class="help-icon">\n        <div class="wrapper">\n            <div class="icon"></div>\n        </div>\n        <div class="text"></div>\n    </div>',i["bonus-reselect-wnd"]='<div class="bonus-reselect-wnd">\n        <div class="bonus-reselect-wnd__bg"></div>\n        <div class="bonus-reselect-wnd__content">\n            <div class="enhance__info enhance__info--1">\n                <div class="info-icon" data-tip-type="t-left" data-trans="data-tip#info_tip2#enhancement"></div>\n                <div class="enhance__info--top" data-trans="#bonus-reselect-info#enhancement"></div>\n            </div>\n            <div class="bonus-reselect-wnd__item"></div>\n            <div class="bonus-reselect-wnd__finalize">\n                <div class="enhance__info" data-trans="#bonus-reselect-info2#enhancement"></div>\n                <div class="bonus-reselect-wnd__require"></div>\n                <div class="bonus-reselect-wnd__buttons"></div>\n            </div>\n        </div>\n    </div>',i["bonus-selector-wnd"]='<div class="bonus-selector-wnd">\n        <div class="bonus-selector-wnd__bg"></div>\n        <div class="bonus-selector-wnd__content">\n            <div class="enhance__info enhance__info--1">\n                <div class="info-icon" data-tip-type="t-left" data-trans="data-tip#info_tip2#enhancement"></div>\n                <div class="enhance__info--top" data-trans="#info4#enhancement"></div>\n            </div>\n            <div class="enhance__bonus"></div>\n        </div>\n    </div>',i["bonus-selector"]='<div class="bonus-selector">\n        <div class="bonus-selector__bonuses"></div>\n        <div class="bonus-selector__submit"></div>\n    </div>',i["friend-enemy-list"]='<div class="friend-enemy-list">\n        \x3c!--<div class="friend-enemy-header">--\x3e\n        \x3c!--<div class="header-title"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="header-background-graphic"></div>\n        <div class="friend-enemy-cards cards-header"></div>\n        <div class="amound-wrapper">\n            <span class="amound-value"></span>\n        </div>\n        <div class="bottom-friend-panel">\n            <div class="input-wrapper">\n                <input class="add-person default"/>\n            </div>\n            <div class="add-wrapper"></div>\n            <div class="sort-wrapper"></div>\n            <div class="wanted-wrapper"></div>\n        </div>\n    </div>',i.column='<div class="column">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n                <div class="list"></div>\n            </div>\n        </div>\n    </div>',i["one-person"]='<div class="one-person">\n        \x3c!--<div class="online-symbol"></div>--\x3e\n        <div class="prof-and-level">\n            <div class="lvl-wrapper">\n                <span class="lvl"></span>\n            </div>\n        </div>\n        <div class="img-wrapper">\n            \x3c!--<div class="img"></div>--\x3e\n        </div>\n        <div class="info">\n            <span class="who"></span>\n            <span class="location"></span>\n            <span class="cords"></span>\n            <span class="online-text"></span>\n        </div>\n        <div class="buttons action-buttons btns-spacing">\n        </div>\n        <div class="buttons sort-buttons btns-spacing">\n        </div>\n        <div class="line"></div>\n    </div>',i.clan='<div class="clan">\n        <div class="left-column">\n            <div class="clan-info">\n                <div class="clan-name">\n                    <span class="name"></span>\n                </div>\n                <div class="clan-level"></div>\n                \x3c!--<div class="clan-emblem"></div>--\x3e\n                <div class="stats">\n                    <div class="clan-member-amount"></div>\n                    <div class="clan-recruit-state"></div>\n                </div>\n                \x3c!--<div class="clan-look-for-clan-btn"></div>--\x3e\n                <div class="clan-showcase-but"></div>\n                \x3c!--<div class="edit-logo-but"></div>--\x3e\n            </div>\n            <div class="clan-list-repeat"></div>\n            <div class="clan-list-bottom"></div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane"></div>\n            </div>\n        </div>\n        <div class="right-column">\n            \x3c!--<div class="header"></div>--\x3e\n            <div class="card-content"></div>\n        </div>\n    </div>',i["clan-list-content"]='<div class="clan-list-content">\n        <div class="clan-list-show-btn"></div>\n        <div class="search-wrapper">\n            <input class="search clan-name-input" data-trans="placeholder#search"/>\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n        <div class="table-header-wrapper">\n            <table class="table-header clan-list-table-header"></table>\n        </div>\n        <div class="first-scroll-wrapper scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <table class="clan-list-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-info-content"]='<div class="clan-info-content">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="first-text mtop" data-trans="#clan_info_txt#clan"></div>\n                <div class="heading" data-trans="#clan_info_first-text-header#clan"></div><br />\n                <div class="first-text" data-trans="#clan_info_first-text#clan"></div>\n                <div class="buttons">\n                    <div class="look-for-clan"></div>\n                    <div class="clan-look-for-clan-btn"></div>\n                </div>\n                <div class="heading" data-trans="#clan_info_ribbon#clan"></div>\n                <div class="second-text" data-trans="#clan_info_second-text#clan"></div>\n                <div class="ribbon"></div>\n            </div>\n        </div>\n    </div>',i["clan-list-find-panel"]='<div class="clan-list-find-panel">\n        <div class="scroll-wrapper classic-bar clan-list-find-content">\n            <div class="scroll-pane">\n                <div class="background-wrapper">\n                    <div class="clan-find-header-0"></div>\n                    <div class="clan-part-0"></div>\n                    <div class="clan-find-header-1"></div>\n                    <div class="clan-part-1"></div>\n                    <div class="clan-find-header-2"></div>\n                    <div class="clan-part-2"></div>\n                </div>\n            </div>\n        </div>\n        <div class="clan-list-butts-wrapper">\n            <div class="clan-list-butts">\n                <div class="clan-list-hide-btn"></div>\n                <div class="clan-list-find-btn"></div>\n            </div>\n        </div>\n    </div>',i["one-clan-atribute"]='<div class="one-clan-atribute">\n        <div class="atribute-name-wrapper">\n            <span class="atribute-name"></span>\n        </div>\n        <div class="atribute-value-wrapper">\n            <span class="atribute-value"></span>\n        </div>\n        <div class="input-wrapper"></div>\n        \x3c!--<div class="save-atribute-wrapper"></div>--\x3e\n    </div>',i["clan-recruit-content"]='<div class="clan-recruit-content">\n        <div class="clan-recruit-menu">\n            <div class="cards-header-wrapper">\n                <div class="header-background-graphic"></div>\n                <div class="cards-header"></div>\n            </div>\n        </div>\n        <div class="recruit-section section-recruit-main">\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="header-bar padd clan-recruit-header-option js-rank-hide"></div>\n                    <div class="green-box js-rank-hide">\n                        <div class="invite-to-clan">\n                            <div class="v-align">\n                                <div class="label-info v-item"></div>\n                                <div class="input-wrapper v-item">\n                                    <input class="player-nick default">\n                                </div>\n                                <div class="invite-but v-but v-item"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!--<div class="clan-recruit-header-0"></div>--\x3e\n                    <div class="header-bar padd clan-recruit-header-atribute"></div>\n                    <div class="green-box">\n                        <div class="clan-part-0"></div>\n                        \x3c!--<div class="clan-recruit-header-1"></div>--\x3e\n                        <div class="clan-part-1"></div>\n                        \x3c!--<div class="clan-recruit-header-2"></div>--\x3e\n                        <div class="clan-part-2"></div>\n                    </div>\n                    <div class="clan-list-butts-wrapper">\n                        <div class="save-atributes"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="recruit-section section-recruit-candidate">\n            <div class="table-header-wrapper">\n                <table class="table-header recruit-candidate-table-header"></table>\n            </div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <table class="recruit-candidate-table table-content"></table>\n                    <div class="buttons-wrapper"></div>\n                </div>\n            </div>\n        </div>\n        <div class="recruit-section section-recruit-invite">\n            <div class="table-header-wrapper">\n                <table class="table-header recruit-invite-table-header"></table>\n            </div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <table class="recruit-invite-table table-content"></table>\n                </div>\n            </div>\n        </div>\n    </div>',i["clan-recruit-buttons-wrapper"]='<div class="clan-recruit-buttons-wrapper buttons-wrapper btns-spacing"></div>',i["clan-other-recruit-content"]='<div class="clan-other-recruit-content">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="background-wrapper">\n                    <div class="clan-recruit-header-0"></div>\n                    <div class="clan-part-0"></div>\n                    <div class="clan-recruit-header-1"></div>\n                    <div class="clan-part-1"></div>\n                    <div class="clan-recruit-header-2"></div>\n                    <div class="clan-part-2"></div>\n                    <div class="save-atributes"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["clan-members-content"]='<div class="clan-members-content">\n        <div class="table-header-wrapper">\n            <table class="table-header clan-members-table-header"></table>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <table class="clan-members-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-other-members-content"]='<div class="clan-other-members-content">\n        <div class="table-header-wrapper">\n            <table class="table-header js-table-header"></table>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <table class="clan-other-members-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-quests-content"]='<div class="clan-quests-content">\n        <div class="header-bar padd">\n            <div class="complete-quest-amount"></div>\n            <div class="toggle-show"></div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="clan-quests-content-container">\n                    <div class="active-quests"></div>\n                    <div class="complete-and-unactive-quests">\n                        <div class="unactive-quests"></div>\n                        <div class="complete-quests"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',i["one-clan-quest"]='<div class="one-clan-quest">\n        <div class="left-side">\n            <div class="quest-header"></div>\n            <div class="quest-content"></div>\n            <div class="quest-bring-item-wrapper"></div>\n        </div>\n        <div class="right-side"></div>\n        <div class="quest-progress-wrapper">\n            <div class="quest-progress">\n                <div class="progress-text"></div>\n            </div>\n            <div class="clan-progress-bar">\n                <div class="background-bar" bar-horizontal="true"></div>\n            </div>\n            <div class="quest-percent"></div>\n        </div>\n        <div class="quest-state"></div>\n    </div>',i["use-lvl"]='<div class="use-lvl"></div>',i["empty-lvl"]='<div class="empty-lvl"></div>',i["increase-decrease-stamina"]='<div class="increase-decrease-stamina">\n        <div class="header-label" data-trans="#timeTicketsAlert1"></div>\n        <div class="stamina-pay-options">\n            <span class="st_pay_1"data-trans="#for_today_new"></span>\n        </div>\n    </div>',i["quest-bring-item"]='<div class="quest-bring-item v-align" >\n        <div class="item-wrapper v-item"></div>\n        <div class="input-wrapper v-item">\n            <input class="default">\n        </div>\n        <div class="give-item-btn v-item"></div>\n    </div>',i["clan-skills-content"]='<div class="clan-skills-content">\n        <div class="header-bar padd">\n            <div class="clan-skill-header"></div>\n        </div>\n        <div class="clan-skill-heading-text"></div>\n        \x3c!--<div class="clan-skill-reset"></div>--\x3e\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="clan-skills-container"></div>\n            </div>\n        </div>\n    </div>',i["clan-bless-content"]='<div class="clan-bless-content">\n        <div class="header-bar padd">\n            <div class="back-to-skill-btn"></div>\n        </div>\n        <div class="bless-header"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="clan-bless-container"></div>\n            </div>\n        </div>\n    </div>',i["one-bless-skill"]='<div class="one-bless-skill">\n        <div class="item-wrapper"></div>\n        <div class="info-wrapper">\n            <div class="bless-name"></div>\n            <div class="bless-description"></div>\n            \x3c!--<div class="bless-price"></div>--\x3e\n        </div>\n        <div class="bless-use">\n            <div class="bless-duration"></div>\n        </div>\n    </div>',i["one-clan-skill"]='<div class="one-clan-skill">\n        <div class="skill-icon-wrapper">\n            <div class="skill-icon"></div>\n            <div class="skill-level-bck">\n                <span class="skill-level"></span>\n            </div>\n            <div class="skill-increase-decrease"></div>\n        </div>\n        <div class="skill-clan-info">\n            <div class="skill-clan-name"></div>\n            <div class="skill-clan-description"></div>\n            <div class="skill-progress">\n                <div class="skill-slots-wrapper"></div>\n                <div class="skill-points-wrapper"></div>\n            </div>\n            <div class="skill-actual-val"></div>\n        </div>\n        <div class="skill-clan-buts-wrapper">\n            <div class="skill-clan-buts-label" data-trans="#use_clan_point"></div>\n            <div class="skill-clan-buts-add-point"></div>\n            <div class="skill-clan-buts-turn-on-off"></div>\n        </div>\n    </div>',i["clan-member"]='<div class="clan-member">\n        <div class="icon-wrapper">\n            \x3c!--<div class="icon"></div>--\x3e\n        </div>\n        <div class="char-info">\n            <div class="char-stats"></div>\n            <divn class="last-visit"></divn>\n        </div>\n        <div class="add-to-group"></div>\n        <div class="edit"></div>\n    </div>',i["clan-edit-content"]='<div class="clan-edit-content">\n        <div class="table-header-wrapper no-scroll">\n            <table class="table-header js-table-header"></table>\n        </div>\n        <table class="player-edit-table table-content"></table>\n        <div class="player-edit-pane">\n            <div class="edit-rank">\n                <div class="label"></div>\n                <div class="v-align">\n                    <div class="v-item">\n                        <div class="rank-menu menu default"></div>\n                    </div>\n                    <div class="change-rank-but v-but v-item"></div>\n                </div>\n            </div>\n            <div class="send-tears">\n                <div class="label"></div>\n                <div class="v-align">\n                    <div class="v-item">\n                        <div class="send-menu menu default"></div>\n                    </div>\n                    <div class="send-but v-but v-item"></div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-buttons">\n            <div class="remove-from-clan"></div>\n            <div class="back-to-members"></div>\n        </div>\n    </div>',i["clan-treasury-content"]='<div class="clan-treasury-content">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="left-part">\n                    <div class="gold-part">\n                        <div class="gold-info"></div>\n                        <div class="green-box">\n                            <div class="send-gold">\n                                <div class="label-info"></div>\n                                <div class="v-align">\n                                    <div class="input-wrapper v-item">\n                                        <input class="amount-send-gold default">\n                                    </div>\n                                    <div class="send-gold-but v-but v-item"></div>\n                                </div>\n                            </div>\n                            <div class="send-to-player">\n                                <div class="label-info"></div>\n                                <div class="v-align">\n                                    <div class="v-item">\n                                        <div class="choose-player menu default"></div>\n                                    </div>\n                                    <div class="send-gold-player-but v-but v-item"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="sl-info"></div>\n                        <div class="green-box">\n                            <div class="send-sl">\n                                <div class="label-info"></div>\n                                <div class="v-align">\n                                    <div class="input-wrapper v-item">\n                                        <input class="amount-send-sl default">\n                                    </div>\n                                    <div class="send-sl-but v-item v-but"></div>\n                                </div>\n                            </div>\n                            \x3c!--<div class="no-send-sl">--\x3e\n                            \x3c!--<div class="label-info"></div>--\x3e\n                            \x3c!--</div>--\x3e\n                            <div class="on-off-send-sl"></div>\n                        </div>\n                    </div>\n                </div>\n                <div class="right-part">\n                    <div class="header-bar padd outfit-header"></div>\n                    <div class="outfit-content">\n                        <div class="to-dress-available"></div>\n                        <div class="to-dress-but"></div>\n                        <div class="not-dress-but"></div>\n                        <canvas class="clan-outfit"></canvas>\n                    </div>\n                </div>\n                <table class="history-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-manage-content"]='<div class="clan-manage-content">\n        <div class="header-bar text-center padd" data-trans="#header-option#clan"></div>\n        <div class="green-box">\n            <div class="change-clan-name">\n                <div class="label-info"></div>\n                <div class="v-align">\n                    <div class="input-wrapper v-item">\n                        <input class="new-clan-name default">\n                    </div>\n                    <div class="v-item">\n                        <div class="paid-kind menu default"></div>\n                    </div>\n                    <div class="change-clan-name-but v-but v-item"></div>\n                </div>\n            </div>\n            <div class="inline">\n                <div class="dissolve-clan">\n                    <div class="label-info"></div>\n                    <div class="v-align">\n                        <div class="input-wrapper v-item">\n                            <input class="confirm-dissolve default">\n                        </div>\n                        <div class="dissolve-but v-but v-item"></div>\n                    </div>\n                </div>\n                <div class="leave-clan">\n                    <div class="label-info"></div>\n                    <div class="v-align">\n                        <div class="input-wrapper v-item">\n                            <input class="confirm-leave default">\n                        </div>\n                        <div class="leave-but v-but v-item"></div>\n                    </div>\n                </div>\n                \x3c!--<div class="invite-to-clan ">--\x3e\n                \x3c!--<div class="label-info"></div>--\x3e\n                \x3c!--<div class="v-align">--\x3e\n                \x3c!--<div class="input-wrapper v-item">--\x3e\n                \x3c!--<input class="player-nick default">--\x3e\n                \x3c!--</div>--\x3e\n                \x3c!--<div class="invite-but v-but v-item"></div>--\x3e\n                \x3c!--</div>--\x3e\n                \x3c!--</div>--\x3e\n            </div>\n            <div class="add-rank">\n                <div class="label-info"></div>\n                <div class="v-align">\n                    <div class="add-id-wrapper v-item">\n                        <input class="default add-id">\n                    </div>\n                    <div class="input-wrapper v-item">\n                        <input class="default add-name-rank">\n                    </div>\n                    <div class="add-id-but v-item"></div>\n                </div>\n            </div>\n            \x3c!--<div class="socplay">--\x3e\n            \x3c!--<div class="label-info"></div>--\x3e\n            \x3c!--<div class="v-align">--\x3e\n            \x3c!--<div class="input-wrapper v-item">--\x3e\n            \x3c!--<input class="soc-fill-gr default">--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="input-wrapper v-item">--\x3e\n            \x3c!--<div class="soc-group-name label-box v-item"></div>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="save-soc-gr-but v-but v-item"></div>--\x3e\n            \x3c!--<div class="remove-soc-gr-but v-but v-item"></div>--\x3e\n            \x3c!--<div class="input-wrapper v-item last">--\x3e\n            \x3c!--<input class="soc-fill-pass default">--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="input-wrapper v-item last">--\x3e\n            \x3c!--<div class="soc-pass-name label-box v-item"></div>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="save-soc-pass-but v-but v-item"></div>--\x3e\n            \x3c!--<div class="remove-soc-pass-but v-but v-item"></div>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--</div>--\x3e\n        </div>\n        <div class="header-bar text-center padd">\n            <div class="rank-edit-header"></div>\n        </div>\n        <div class="table-header-wrapper">\n            <table class="table-header rank-edit-table-header"></table>\n        </div>\n        <div class="scroll-wrapper classic-bar right-content">\n            <div class="scroll-pane">\n                <table class="rank-edit-table"></table>\n            </div>\n        </div>\n    </div>',i["clan-icon"]='<div class="clan-icon"></div>',i["clan-diplomacy-content"]='<div class="clan-diplomacy-content">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="header-bar js-rank-hide" data-trans="#header-option#clan"></div>\n                <div class="green-box js-rank-hide">\n                    <div class="friend">\n                        <div class="v-align">\n                            <div class="label-info v-item"></div>\n                            <div class="input-wrapper v-item">\n                                <input class="invite-friend default">\n                            </div>\n                            <div class="invite-friend-but v-item v-but"></div>\n                        </div>\n                    </div>\n                    <div class="enemy">\n                        <div class="v-align">\n                            <div class="label-info v-item"></div>\n                            <div class="input-wrapper v-item">\n                                <input class="add-enemy default">\n                            </div>\n                            <div class="add-enemy-but v-item v-but"></div>\n                        </div>\n                    </div>\n                </div>\n                <div class="table-header-wrapper">\n                    <table class="table-header friend-table-header"></table>\n                </div>\n                <table class="friend-table table-content"></table>\n                <div class="table-header-wrapper">\n                    <table class="table-header enemy-table-header"></table>\n                </div>\n                <table class="enemy-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-history-content"]='<div class="clan-history-content">\n        <div class="header-bar" data-trans="#filters#clan"></div>\n        <div class="chose-show">\n            <div class="v-align">\n                <div class="witch-depo v-item"></div>\n                <div class="without-depo v-item"></div>\n            </div>\n        </div>\n        <div class="table-header-wrapper">\n            <table class="table-header history-table-header"></table>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <table class="history-table table-content"></table>\n            </div>\n        </div>\n    </div>',i["clan-page-content"]='<div class="clan-page-content">\n        <div class="clan-page-header"></div>\n        <div class="header-bar">\n            <div class="d-inline-block">\n                <div class="edit-page-but"></div>\n            </div>\n            <span class="clan-desc"></span>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="page-wrapper">\n                    <div class="page-content"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["clan-edit-page-content"]='<div class="clan-edit-page-content">\n        <div class="header-bar">\n            <div class="action-buttons">\n                <div class="save-change-but"></div>\n                <div class="cancel-change-but"></div>\n            </div>\n        </div>\n        <div class="edit-area-wrapper">\n            <textarea class="edit-area"></textarea>\n        </div>\n    </div>',i["clan-rank-edit-content"]='<div class="clan-rank-edit-content">\n        <div class="header-bar">\n            <div class="bottom-buttons">\n                <div class="v-align">\n                    <div class="save-change v-item"></div>\n                    <div class="cancel-edit v-item"></div>\n                    <div class="remove-rank v-item"></div>\n                </div>\n            </div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="edit-rank-name-id">\n                    <div class="v-align">\n                        <div class="input-wrapper id-wrapper v-item right">\n                            <div class="label-id"></div>\n                            <input class="edit-id default">\n                        </div>\n                        <div class="input-wrapper name-wrapper v-item">\n                            <div class="label-name"></div>\n                            <input class="edit-name default">\n                        </div>\n                    </div>\n                </div>\n                <div class="check-rank">\n                    <div class="left-ranks"></div>\n                    <div class="right-ranks"></div>\n                </div>\n                <div class="numerable-ranks"></div>\n            </div>\n        </div>\n    </div>',i["iframe-window"]='<div class="iframe-window">\n        <div class="iframe-wrapper">\n            <iframe class="main-iframe" allow="clipboard-write"></iframe>\n        </div>\n    </div>',i["clan-socPlayGroup-content"]='<div class="clan-socPlayGroup-content">\n        <iframe class="socplay-iframe"></iframe>\n    </div>',i["clan-banner-name"]='<div class="clan-banner-name">\n        <div class="clan-emblem"></div>\n        <div class="clan-name"></div>\n        <div class="edit-logo-but"></div>\n    </div>',i.showcase='<div class="showcase">\n        <div class="header">\n            \x3c!--<div class="players-logo"></div>--\x3e\n            <div class="header-bar">\n                <span class="clan-level"></span>\n                <span class="amount-members"></span>\n                <span class="recruite-info"></span>\n            </div>\n        </div>\n        <div class="header-menu"></div>\n        <div class="card-content"></div>\n    </div>',i["one-rank"]='<div class="one-rank">\n        <div class="v-align">\n            <div class="label v-item"></div>\n            <div class="wrapper v-item">\n                <div class="clan-icon"></div>\n            </div>\n            <div class="check-box-wrapper v-item">\n                <div class="checkbox">\n                    <div class="bck"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["online-status"]='<span class="online-status"></span>',i["online-status-wrapper"]='<div class="online-status-wrapper"></div>',i["level-and-prof"]='<div class="level-and-prof"></div>',i["prof-wrapper"]='<div class="prof-wrapper">\n        <div class="profs-icon"></div>\n    </div>',i["member-rank"]='<div class="member-rank"></div>',i["member-lvl"]='<span class="member-lvl"></span>',i["logged-price"]='<div class="logged-price">\n        <div class="price-header"></div>\n        <div class="price-content"></div>\n        <div class="price-get-item"></div>\n    </div>',i["one-price"]='<div class="one-price">\n        <div class="item-wrapper"></div>\n        <div class="price-state"></div>\n        <div class="price-day"><span></span></div>\n    </div>',i["one-numerable-rank"]='<div class="one-numerable-rank">\n        <div class="v-align">\n            <div class="label v-item"></div>\n            <div class="wrapper v-item">\n                <div class="clan-icon"></div>\n            </div>\n            <div class="menu default"></div>\n        </div>\n    </div>',i["amount-label"]='<div class="amount-label">\n        <div class="label-wprapper">\n            <div class="label"></div>\n        </div>\n        <div class="amount-wprapper">\n            <div class="amount"></div>\n        </div>\n    </div>',i["premium-panel"]='<div class="premium-panel">\n        \x3c!--<div class="premium-header">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="premium-label">Premium</div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="premium-graphic"></div>\n        <div class="product-kind"></div>\n        <div class="premium-bottom-panel">\n            <div class="chest-wrapper">\n                <div class="chest"></div>\n            </div>\n            <div class="table-wrapper">\n                <div class="currency-label"></div>\n                <div class="buy-currency"></div>\n                <div class="recover-items"></div>\n            </div>\n        </div>\n    </div>',i["item-changer-group"]='<div class="item-changer-group">\n        <div class="header-wrapper"></div>\n        <div class="background-grid"></div>\n        <div class="grid"></div>\n    </div>',i["item-changer"]='<div class="item-changer">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="item-changer-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n\n        <div class="filter-wrapper">\n            <div class="filter-label" data-trans="#filter-level"></div>\n            <input class="start-lvl default"/>\n            <input class="stop-lvl default"/>\n            <div class="choose-prof-wrapper">\n                <div class="choose-prof menu"></div>\n            </div>\n            <div class="choose-item-type-wrapper">\n                <div class="choose-item-type menu"></div>\n            </div>\n            <div class="choose-cl-wrapper">\n                <div class="choose-cl menu"></div>\n            </div>\n        </div>\n\n        <div class="scroll-wrapper classic-bar">\n            <div class="main-scroll-pane scroll-pane">\n                <div class="middle-graphics"></div>\n                <div class="paper-graphics"></div>\n                \x3c!--                <table class="table-item-changer-content"></table>--\x3e\n            </div>\n            <table class="static-bar-table"></table>\n        </div>\n        <div class="bottom-item-changer-panel">\n            <div class="bottom-panel-graphics"></div>\n            \x3c!--<div class="do-recipe"></div>--\x3e\n        </div>\n    </div>',i["require-and-receive-item"]='<div class="require-and-receive-item">\n        <div class="require-wrapper">\n            <div class="require-wrapper-align"></div>\n        </div>\n        <div class="arrow"></div>\n        <div class="recive-wrapper">\n            <div class="recive-wrapper-align"></div>\n        </div>\n    </div>',i["require-item"]='<div class="require-item">\n        <div class="item-wrapper"></div>\n        <div class="require-state">\n            <div class="require-state-inner">\n                <span class="current-owned"></span><span class="seperator">/</span><span class="need-to-use"></span>\n            </div>\n        </div>\n    </div>',i["recive-item"]='<div class="recive-item">\n        <div class="item-wrapper"></div>\n    </div>',i["cost-item"]='<div class="cost-item">\n        <div class="item-wrapper"></div>\n        <div class="require-state">\n            <div class="require-state-inner">\n                <span class="current-owned"></span><span class="seperator">/</span><span class="need-to-use"></span>\n            </div>\n        </div>\n    </div>',i["cost-wrapper"]='<div class="cost-wrapper"></div>',i["cost-icon-component"]='<div class="cost-icon-component">\n        <div class="cost-icon-wrapper">\n            <div class="text"></div>\n            <div class="cost"></div>\n            <div class="icon"></div>\n        </div>\n    </div>',i["news-panel"]='<div class="news-panel">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="news-panel-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="middle-graphics"></div>\n        <div class="news-content">\n            <div class="crazy-bar"></div>\n            <div class="news-section">\n                <div class="section-content">\n                    <div class="news-section-overflow"></div>\n                </div>\n                <div class="left-news-btn news-graph-arrow news-arrow-element"></div>\n                <div class="right-news-btn news-graph-arrow news-arrow-element"></div>\n                <div class="news-pagination"></div>\n            </div>\n            <div class="news-for-you-section">\n                <div class="section-header" data-trans="#forYou#news"></div>\n                <div class="section-content">\n                    <div class="for-you"></div>\n                </div>\n                <div class="left-arrow news-arrow news-arrow-element"></div>\n                <div class="right-arrow news-arrow news-arrow-element"></div>\n            </div>\n            <div class="news-time-promo-section">\n                \x3c!--<div class="section-header" data-trans="#timePromo#news"></div>--\x3e\n                <div class="section-content">\n                    <div class="time-promo-background"></div>\n                    <div class="package-positioner">\n                        <div class="package-wrapper"></div>\n                    </div>\n                    <div class="requires-text-wrapper">\n                        <div class="requires-text"></div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n        <div class="bottom-panel-graphics"></div>\n    </div>',i["news-classic-tile"]='<div class="news-classic-tile">\n        <div class="tile-background">\n            <div class="graphic-bck"></div>\n            <div class="title-bck"></div>\n        </div>\n        <div class="tile-items-positioner">\n            <div class="tile-items-wrapper"></div>\n        </div>\n        <div class="requires-text-wrapper">\n            <div class="requires-level"></div>\n            <div class="requires-text"></div>\n        </div>\n        <div class="used-text"></div>\n        <div class="buy-button-wrapper"></div>\n        <div class="buy-info"></div>\n    </div>',i["news-time-promo-tile"]='<div class="news-time-promo-tile">\n        <div class="tile-background"></div>\n        <div class="title-time-promo-tile"></div>\n        <div class="price-time-promo-tile"></div>\n        <div class="tile-items-positioner">\n            <div class="tile-items-wrapper"></div>\n        </div>\n        <div class="used-text-wrapper">\n            <div class="used-text"></div>\n        </div>\n        <div class="buy-button-wrapper"></div>\n        <div class="buy-info"></div>\n    </div>',i["news-message"]='<div class="news-message">\n        <div class="news-date"></div>\n        <div class="news-text"></div>\n        <div class="news-author"></div>\n    </div>',i["buy-button-wrapper"]='<div class="buy-button-wrapper buy-button"></div>',i["buy-button-news"]='<div class="buy-button-news buy-button"></div>',i["label-news"]='<div class="label-news label"></div>',i["stamina-shop"]='<div class="stamina-shop">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#stat-stamina"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="background-graphic"></div>\n        <div class="description1" data-trans="#stamina_renew_4h#static"></div>\n        <div class="description" data-trans="#stamina_renew_4h#static"></div>\n        <div class="one-day">\n            <div class="info-label"></div>\n            <div class="but btns-spacing"></div>\n        </div>\n        <div class="one-week">\n            <div class="info-label"></div>\n            <div class="but btns-spacing"></div>\n        </div>\n        <div class="one-month">\n            <div class="info-label"></div>\n            <div class="but btns-spacing"></div>\n        </div>\n        \x3c!--<div class="cancel-but"></div>--\x3e\n        <div class="footer">\n            <div class="bottom-panel-graphics"></div>\n            <div class="chest-graphic"></div>\n            <div class="table-wrapper">\n                <div class="sl-label"></div>\n                <div class="buy-sl-btn"></div>\n                <div class="close-btn"></div>\n            </div>\n        </div>\n    </div>',i["trade-window"]='<div class="trade-window">\n        <div class="window-background">\n        </div>\n        <div class="content">\n            <div class="info-icon tip"></div>\n            <div class="info">\n                <div class="watch label"></div>\n                <div class="show label"></div>\n                <div class="buy label"></div>\n                <div class="sell label"></div>\n                <div class="gold-left label gold-label"></div>\n                <div class="gold-right label gold-label"></div>\n                <div class="credits-left label credits-label"></div>\n                <div class="credits-right label credits-label"></div>\n            </div>\n            <div class="other-buy-item"></div>\n            <div class="hero-sell-item"></div>\n            <div class="other-watch-item"></div>\n            <div class="hero-show-item"></div>\n            <div class="decision">\n                <div class="other_decision dec-item"></div>\n                <div class="other-result result refuse"></div>\n                <div class="hero_decision dec-item"></div>\n                <div class="hero-result result refuse"></div>\n            </div>\n            <div class="prize">\n                <div class="other-prize gold-prize">0</div>\n                <input class="hero-prize gold-prize" placeholder="0"/>\n            </div>\n            <div class="credits">\n              <span class="other-credits"></span>\n              <span class="hero-credits"></span>\n            </div>\n            <div class="buttons btns-spacing-y"></div>\n        </div>\n        <header>\n            <div class="h_background">\n                <div class="left"></div>\n                <div class="middle"></div>\n                <div class="right"></div>\n            </div>\n            <div class="h_content"></div>\n        </header>\n    </div>',i["divide-panel"]='<div class="divide-panel">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="green-panel-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="left-column">\n            <div class="top-left-column-graphics"></div>\n            <div class="middle-left-column-graphics"></div>\n            <div class="bottom-left-column-graphics"></div>\n            <div class="left-column-header"></div>\n            <div class="search-wrapper search-item-wrapper">\n                <input class="search search-item"/>\n                <div class="search-x" data-trans="data-tip#delete"></div>\n            </div>\n            <div class="left-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane"></div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="location-graphics"></div>\n            <div class="middle-graphics"></div>\n            <div class="right-column-header"></div>\n            <div class="right-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane"></div>\n            </div>\n        </div>\n        <div class="bottom-part">\n            <div class="bottom-panel-graphics"></div>\n        </div>\n    </div>',i["table-with-static-header"]='\n        <div class="table-with-static-header-wrapper">\n            <div class="table-with-static-header">\n                <table class="table-with-static-header-header"></table>\n                <div class="table-with-static-header-body scroll-wrapper classic-bar">\n                    <div class="table-with-static-header-scroll-pane scroll-pane">\n                        <table class="table-with-static-header-table"></table>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',i.party='<div class="party">\n        \x3c!--<div class="header"></div>--\x3e\n        <div class="players-number">\n            (<span class="num"></span>) <div class="info-icon small-header-info" data-trans="data-tip#amount#party"></div>\n        </div>\n        <div class="list"></div>\n        \x3c!--<div class="exp-info">--\x3e\n        <div class="exp-percent"></div>\n        <div class="exp-q"></div>\n        \x3c!--</div>--\x3e\n    </div>',i["crown-party"]='<div class="crown-party crown"></div>',i["kick-out-party"]='<div class="kick-out-party kick-out"></div>',i["give-lead-party"]='<div class="give-lead-party give-lead"></div>',i["destroy-group-party"]='<div class="destroy-group-party destroy-group"></div>',i["party-member"]='<div class="party-member tw-list-item">\n        <div class="border-blink"></div>\n        <div class="table-wrapper">\n            <div class="nickname">\n                <div class="nickname-text"></div>\n            </div>\n            <div class="party-options"></div>\n            <div class="crown-wrapper"></div>\n            <div class="stasis-icon" data-trans="data-tip#in_stasis#party"></div>\n            <div class="stasis-incoming-icon" data-trans="data-tip#in_stasis-incoming#party"></div>\n            <div class="hp">\n                <div class="hp-bck"></div>\n                <div class="hp-bar"></div>\n                <div class="hp-label hp-label-percent"></div>\n                <div class="hp-label hp-label-real"></div>\n            </div>\n            <div class="lvl"></div>\n        </div>\n    </div>',i.registration='<div class="registration">\n        <div class="main-header"></div>\n        <div class="short-info"></div>\n        <div class="reward-header"></div>\n        <div class="main-content">\n            \x3c!--<div class="section-wrapper login"></div>--\x3e\n            \x3c!--<div class="section-wrapper email"></div>--\x3e\n            \x3c!--<div class="section-wrapper consent"></div>--\x3e\n        </div>\n        <div class="buttons-wrapper">\n            <div class="save-button"></div>\n            <div class="collect-button"></div>\n        </div>\n    </div>',i["registration-section-wrapper"]='<div class="registration-section-wrapper">\n        <div class="inputs-column"></div>\n        <div class="reward-column"></div>\n    </div>',i["registration-inputs-wrapper"]='<div class="registration-inputs-wrapper"></div>',i["reward-box"]='<div class="reward-box">\n        <div class="rew-info-holder"></div>\n        <div class="item-slot item0"></div>\n        <div class="item-slot item1"></div>\n        <div class="item-slot item2"></div>\n    </div>',i["register-row"]='<div class="register-row">\n        <label></label>\n        <div class="input-wrapper">\n            <input class="default">\n        </div>\n        <div class="text"></div>\n    </div>',i["register-row-checkbox"]='<div class="register-row-checkbox">\n        <div class="text"></div>\n    </div>',i["add-bck"]='<div class="add-bck"></div>',i["label-input"]='<div class="label-input"></div>',i["between-arrow"]='<div class="between-arrow"></div>',i.container='<div class="container"></div>',i["button-handler"]='<div class="button-handler"></div>',i["info-icon"]='<div class="info-icon"></div>',i.icon='<div class="icon"></div>',i["post-input"]='<span class="post-input"></span>',i["auction-window"]='\n        <div class="auction-window">\n            <div class="middle-graphic"></div>\n            <div class="cards-header-wrapper">\n                <div class="header-background-graphic"></div>\n                <div class="cards-header"></div>\n            </div>\n\n            <div class="left-column-auction-and-main-column-auction">\n\n            </div>\n\n            <div class="left-column-auction">\n\x3c!--                <div class="scroll-wrapper left-column-scroll classic-bar">--\x3e\n\x3c!--                    <div class="scroll-pane">--\x3e\n                        <div class="all-categories-auction"></div>\n\x3c!--                    </div>--\x3e\n\x3c!--                </div>--\x3e\n            </div>\n            \n\n\n            <div class="main-column-auction">\n                <div class="all-auction-info-wrapper">\n                    <div class="all-auction-info" data-trans="#choose_category#auction"></div>\n                </div>\n                <div class="all-auction-section section middle">\n                    <table class="auction-table-header"></table>\n                    <div class="scroll-wrapper main-all-auction-scroll classic-bar">\n                        <div class="scroll-pane">\n                            <table class="auction-table"></table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="bottom-part">\n                <div class="bottom-panel-graphics"></div>\n\x3c!--                <div class="additional-soulbond-payment" data-trans="#filter_bound_price_info#auction"></div>--\x3e\n                <div class="auction-off-btn-wrapper"></div>\n                <div class="auction-renew-btn-wrapper"></div>\n                <div class="amount-of-auction"></div>\n            </div>\n        </div>',i["auction-off-item-panel"]='\n                <div class="auction-off-item-panel">\n                    <div class="middle-graphic"></div>\n                    <div class="auction-off-item-panel-wrapper">\n                        <div class="item-slot-wrapper">\n                            <div class="item-slot"></div>\n                        </div>\n                        <div class="all-field">\n                            <div class="one-record auction-bid"><div class="label"></div></div>\n                            <div class="one-record auction-additional-gold-payment"><div class="label"></div></div>\n                            <div class="one-record auction-buy-now"><div class="label"></div><div class="info-icon buy-info-icon"></div></div>\n                            <div class="one-record auction-duration"><div class="label"></div><div class="h-char">h</div></div>\n                        </div>\n                        <div class="one-info special-offer"></div>\n                        <div class="one-info auction-tax"><span class="first-span tax-label"></span><span class="second-span tax-val"></span></div>\n                        <div class="one-info auction-cost">\n                            <span class="first-span cost-label"></span>\n                            <span class="second-span currency-icons"></span>\n                        </div>\n                    </div>\n                    <div class="auction-off-btn-wrapper"></div>\n                </div>\n        ',i["auction-search-item"]='<div class="auction-search-item top">\n        <div class="first-column-bar-search column-bar-search">\n            <div class="item-name-wrapper one-record one-line">\n\x3c!--                <input class="default name-item-input"/>--\x3e\n            </div>\n            <div class="item-price-wrapper one-record one-line">\n\x3c!--                <input class="default min-price-input min-input"/>--\x3e\n                <div class="between-arrow"></div>\n\x3c!--                <input class="default max-price-input min-input"/>--\x3e\n            </div>\n            <div class="item-lvl-wrapper one-record one-line">\n\x3c!--                <input class="default min-level-input min-input"/>--\x3e\n                <div class="between-arrow"></div>\n\x3c!--                <input class="default max-level-input min-input"/>--\x3e\n            </div>\n        </div>\n\n        <div class="second-column-bar-search column-bar-search menu-bar-search">\n            <div class="auction-type-wrapper one-record one-line">\n                <div class="menu-wrapper menu default"></div>\n            </div>\n            <div class="item-rarity-wrapper one-record one-line">\n                <div class="menu-wrapper menu default"></div>\n            </div>\n            <div class="item-prof-wrapper one-record one-line">\n                <div class="menu-wrapper menu default"></div>\n            </div>\n        </div>\n\n        <div class="third-column-bar-search column-bar-search  menu-bar-search">\n            <div class="new-filter-wrapper one-record one-line">\n                <div class="menu-wrapper menu default"></div>\n            </div>\n            <div class="refresh-button-wrapper"></div>\n        </div>\n\n    </div>',i["auction-observe-action"]='\n        <div class="auction-observe-action">\n            <div class="observe-img"></div>\n        </div>\n    ',i["action-menu-item"]='\n        <div class="action-menu-item">\n            <div class="label"></div>\n        </div>\n    ',i["drop-down-menu-section"]='<div class="drop-down-menu-section">\n        <div class="type-header">\n            <div class="type-header-label"></div>\n        </div>\n        <div class="state-of-type up-arrow"></div>\n        <div class="content-wrapper">\n            <div class="item-category-wrapper">\n        \n            </div>\n        </div>\n      </div>',i["one-category-auction"]='<div class="one-category-auction">\n        <div class="icon"></div>\n      </div>',i["auction-but"]='<div class="auction-but">\n        <div class="label"></div>\n    </div>',i["auction-cost-ceil"]='\n        <div class="auction-cost-ceil">\n            <div class="auction-cost-label"></div>\n            <div class="auction-cost-btn-wrapper"></div>\n        </div>',i["auction-input-cost-ceil"]='\n        <div class="auction-input-cost-ceil">\n            <input class="default input-cost"/>\n            <div class="own-input-cost"></div>\n            <span class="auction-cost-currency"></span>\n            <div class="auction-cost-btn-wrapper"></div>\n        </div>',i["dropdown-menu"]='<div class="dropdown-menu">\n        <div class="arrow">\n            <div class="menu-arrow"></div>\n        </div>\n        <div class="reset" data-trans="data-tip#reset#ah_filter_history"></div>\n\n        <div class="scroll-wrapper menu-wrapper">\n            <div class="wrapper scroll-pane"></div>\n        </div>\n    </div>',i["gold-shop"]='<div class="gold-shop">\n        \x3c!--<div class="header-graphics"></div>--\x3e\n        <div class="header-big-label"></div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics"></div>\n            </div>\n        </div>\n        <div class="footer">\n            <div class="bottom-panel-graphics"></div>\n            <div class="chest-graphic"></div>\n            <div class="table-wrapper">\n                <div class="sl-label"></div>\n                <div class="buy-sl-btn"></div>\n                <div class="close-btn"></div>\n            </div>\n        </div>\n    </div>',i["one-offer"]='<div class="one-offer">\n        <div class="sl-header"></div>\n        <div class="gold-header"></div>\n        <div class="change-btn"></div>\n        <div class="save-money"></div>\n    </div>',i["gold-box"]='<div class="gold-box">\n        <div class="bg">\n            <span class="sl"></span>\n            <span class="gold-span"></span>\n        </div>\n    </div>',i["draconite-shop"]='<div class="draconite-shop">\n        <div class="draconite-shop-content">\n            <iframe class="sl-window"></iframe>\n        </div>\n    </div>',i["addons-panel"]='<div class="addons-panel">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#extend#extManager"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="main-header">\n            <div class="addon-list-label"></div>\n        </div>\n        <div class="left-column">\n            <div class="middle-left-column-graphics"></div>\n            <div class="search-wrapper addon-search">\n                <input class="search" data-trans="placeholder#search"/>\n                <div class="search-x" data-trans="data-tip#delete"></div>\n            </div>\n            <div class="bottom-left-column-graphics"></div>\n            <div class="left-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="addon-list"></div>\n                </div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="middle-right-column-graphics"></div>\n            <div class="addon-header">\n                <div class="img-wrapper">\n                    <div class="widget-button red no-hover">\n                        <div class="addon-header-img icon"></div>\n                    </div>\n                </div>\n                <div class="title-wrapper">\n                    <div class="addon-header-title"></div>\n                </div>\n            </div>\n            <div class="paper-graphics"></div>\n            <div class="right-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                </div>\n            </div>\n        </div>\n    </div>',i["border-blink"]='<div class="border-blink"></div>',i["one-addon-on-list"]='<div class="one-addon-on-list">\n        <div class="img-wrapper">\n            <div class="widget-button red no-hover">\n                <div class="addon-img icon"></div>\n            </div>\n        </div>\n        <div class="title-wrapper">\n            <div class="addon-title"></div>\n        </div>\n    </div>',i["one-addon-description"]='<div class="one-addon-description">\n        <div class="on-off-button"></div>\n        <div class="description-label" data-trans="#description#extManager"></div>\n        <div class="description-text"></div>\n        \x3c!--<div class="location-menu menu"></div>--\x3e\n        <div class="drag-info" data-trans="#drag-info#extManager"></div>\n    </div>',i["skills-window"]='<div class="skills-window">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label" data-trans="#clickSkills"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="left-column">\n            <div class="middle-graphic"></div>\n            <div class="list-label-wrapper">\n                <div class="list-border"></div>\n                <div class="list-label">\n                    <div class="label" data-trans="#skills_tip#buttons"></div>\n                </div>\n            </div>\n            <div class="scroll-wrapper classic-bar skills-wrapper">\n                <div class="scroll-pane">\n                    <div class="description-wrapper"></div>\n                </div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="middle-graphic"></div>\n            <div class="maku-wood"></div>\n            <div class="points-header-wrapper">\n                <div class="skills-points-wrapper">\n                    <div class="skills-points-description" data-trans="#skills_points_description#skills"></div>\n                    <div class="skills-points"></div>\n                </div>\n                \x3c!--<div class="operations-cost"></div>--\x3e\n                \x3c!--<div class="btn-wrapper"></div>--\x3e\n            </div>\n            <div class="scroll-wrapper classic-bar info-description">\n                <div class="scroll-pane">\n                    <div class="empty">\n                        <div class="center">\n                            <div class="info1" data-trans="#how_to_description#skills"></div>\n                            <div class="info2" data-trans="#how_to_description2#skills"></div>\n                            <div class="empty-reset-button"></div>\n                        </div>\n                    </div>\n                    <div class="description-wrapper"></div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-part">\n            <div class="bottom-panel-graphics"></div>\n            <div class="free-skills-label"></div>\n            <div class="MB-wrapper">\n                <div class="MB-label-1" data-trans="#available_label"></div>\n                <div class="info-icon" data-trans="data-tip#mb_tip"></div>\n                <div class="MB-label-2" data-trans="#mbattle"></div>\n                <div class="MB-button"></div>\n                <div class="MB-icon skill-icon pl icon-106"></div>\n            </div>\n            <div class="bottom-right"></div>\n        </div>\n    </div>',i.skill='<div class="skill">\n        <div class="skill-tip"></div>\n        <div class="skill-background"></div>\n        <div class="label-wrapper">\n            <div class="label-background">\n                <label></label>\n            </div>\n        </div>\n        <div class="active"></div>\n        <div class="quick-skill"></div>\n    </div>',i["skill-description"]='<div class="skill-description">\n        <div class="skill-learn">\n            <div class="skill-slider"></div>\n            <div class="skill-learn-price">\n                <span class="price"></span>\n                <span class="small-money"></span>\n            </div>\n            <div class="skill-learn-btn"></div>\n        </div>\n        <div class="header">\n            <div class="icon-wrapper"></div>\n            <div class="right-wrapper">\n                <div class="name"></div>\n                <div class="description"></div>\n                <div class="show-in-battle"></div>\n            </div>\n        </div>\n        <div class="board-wrapper">\n            <div class="board-graphic"></div>\n            <div class="requirements-wrapper stone">\n                <div class="title" data-trans="#lower_requirements#skills"></div>\n                <div class="icons"></div>\n            </div>\n            <div class="stats-wrapper stone">\n                <div class="stats-h" data-trans="#stats_header#skills"></div>\n                <div class="icon-tip" data-trans="data-tip#next_level_stat_info#buttons"></div>\n                <div class="all-stats"></div>\n            </div>\n        </div>\n    </div>',i["skills-description-wrapper"]='<div class="skills-description-wrapper description-wrapper"></div>',i["skills-notif"]='<div class="skills-notif notif"></div>',i["del-skill-middle-layer"]='<div class="del-skill-middle-layer"></div>',i["del-skill-left-layer"]='<div class="del-skill-left-layer"></div>',i["del-skill-right-layer"]='<div class="del-skill-right-layer"></div>',i["skill-background-tpl"]='<div class="skill-background-tpl background"></div>',i["battle-skill-in-skill-panel"]='<div class="battle-skill-in-skill-panel battle-skill"></div>',i.MBEditor='<div class="MBEditor">\n        <div class="list-name"></div>\n        <div class="buttons-wrapper">\n            \x3c!--<div class="close-btn"></div>--\x3e\n            <div class="save-btn"></div>\n            <div class="clear-btn"></div>\n            <div class="checkbox-wrapper">\n                <div class="mb-box-input checkbox"></div>\n                <div class="mb-label checkbox-label" data-trans="#repeat_list#skills"></div>\n            </div>\n        </div>\n        <div class="skills-list"></div>\n\n    </div>',i["additional-skill-panel"]='<div class="additional-skill-panel">\n        <div class="header-tip" data-trans="#dragSkills#skills"></div>\n        <div class="skill-usable-add-slots left">\n            <div class="skill-usable-slot" slot="8"></div>\n            <div class="skill-usable-slot" slot="9"></div>\n            <div class="skill-usable-slot" slot="10"></div>\n            <div class="skill-usable-slot" slot="11"></div>\n        </div>\n        <div class="skill-usable-add-slots right">\n            <div class="skill-usable-slot" slot="15"></div>\n            <div class="skill-usable-slot" slot="14"></div>\n            <div class="skill-usable-slot" slot="13"></div>\n            <div class="skill-usable-slot" slot="12"></div>\n        </div>\n    </div>',i["single-skill-row"]='<div class="single-skill-row">\n        <div class="number"></div>\n        <div class="skill-name"></div>\n        <div class="buy-wrapper">\n            <div class="money-buy"></div>\n            <div class="sl-buy"></div>\n        </div>\n        <div class="arrows-wrapper">\n            <div class="remove-cross pos-up"></div>\n            <div class="up-arrow pos-up"></div>\n            <div class="down-arrow pos-up"></div>\n        </div>\n    </div>',i["battle-pass-window"]='<div class="battle-pass-window">\n        <div class="cards-header-wrapper">\n            <div class="header-background-graphic"></div>\n            <div class="cards-header"></div>\n        </div>\n        <div class="battle-pass-header-wrapper">\n            <div class="battle-pass-banner-graphic"></div>\n            <div class="battle-pass-banner-icon"></div>\n            <div class="battle-pass-buttons"></div>\n        </div>\n        <div class="battle-pass-challenges section">\n            <div class="scroll-wrapper classic-bar">\n                <div class="battle-pass-bg"></div>\n                <div class="scroll-pane">\n                    <div class="daily-mission battle-pass-tiles-wrapper">\n                        <div class="tiles-wrapper-header" data-trans="#daily_chalanges"></div>\n                        <div class="tiles-wrapper-header-time"></div>\n                        <div class="tiles-wrapper"></div>\n                        <div class="roll-mission-wrapper">\n                            <div class="roll-mission-label" data-trans="#reload_mission"></div>\n                            <div class="roll-mission-icon"></div>\n                            <div class="line"></div>\n                        </div>\n                    </div>\n                    <div class="global-mission battle-pass-tiles-wrapper">\n                        <div class="tiles-wrapper-header" data-trans="#season_chalanges"></div>\n                        <div class="tiles-wrapper-header-time"></div>\n                        <div class="tiles-wrapper"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="battle-pass-rewards section">\n            <div class="scroll-wrapper classic-bar">\n                <div class="battle-pass-bg"></div>\n                <div class="scroll-pane">\n                    <div class="reward-header">\n                        <div class="free-label" data-trans="#free_rewards"></div>\n                        <div class="battle-pass-icon-wrapper">\n                            <div class="battle-pass-icon"></div>\n                        </div>\n                        <div class="premium-label" data-trans="#premium_rewards"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-row-panel">\n            <div class="bottom-panel-graphics"></div>\n            <div class="your-all-points-wrapper">\n                <div class="all-points-icon"></div>\n                <div class="points"></div>\n            </div>\n        </div>\n      </div>',i["battle-pass-mission-tile"]='<div class="battle-pass-mission-tile">\n         <div class="mission-reward-wrapper">\n            <div class="mission-reward-icon"></div>\n            <div class="mission-reward-label"></div>\n         </div>\n         <div class="mission-header"></div>\n         <div class="mission-stage"></div>\n         <div class="mission-prev-button"></div>\n         <div class="mission-next-button"></div>\n         <div class="mission-description"></div>\n         <div class="place-to-mission-progress-bar"></div>\n      </div>',i["battle-pass-reward-record"]='\n        <div class="battle-pass-reward-record">\n            <div class="battle-pass-table">\n                <div class="standard-reward-button-ceil"></div>\n                <div class="standard-reward-item-ceil reward-item-ceil">\n                    <div class="reward-item-wrapper"></div>\n                </div>\n                <div class="premium-reward-item-ceil reward-item-ceil">\n                    <div class="reward-item-wrapper"></div>\n                </div>\n                <div class="premium-reward-button-ceil"></div>\n            </div>\n            <div class="line"></div>\n            <div class="battle-pass-reward-progress-barr-wrapper">\n                <div class="vertical-progress-bar-wrapper">\n                    <div class="inner"></div>\n                    <div class="progress-bar-background"></div>\n                </div>\n                <div class="threshold amount-border"></div>\n            </div>\n        </div>\n    ',i["mission-progress-bar"]='\n        <div class="mission-progress-bar">\n            <div class="inner-wrapper">\n                <div class="inner" bar-horizontal="true"></div>\n                <div class="progress-bar-background"></div>\n                <div class="text"></div>\n            </div>\n        </div>',i["settings-window"]=`<div class="settings-window">\n        <div class="cards-header-wrapper">\n            <div class="header-background-graphic"></div>\n            <div class="cards-header"></div>\n        </div>\n        <div class="hero-options-config section">\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="graphic-background"></div>\n                    <div class="first-c">\n                        <h2 class="settings-notification"><span></span></h2>\n                        <ul class="hero-options">\n                            <li data-serveroption="1"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="6"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="3"><div class="checkbox"></div><span class="label"></span></li>\n                            \x3c!--<li data-serveroption="10"><div class="checkbox"></div><span class="label"></span></li>--\x3e\n                            <li data-serveroption="5"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="21"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="2"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="14"><div class="checkbox"></div><span class="label"></span></li>\n                            \x3c!--<li data-serveroption="20"><span class="checkbox"></span><span class="label"></span></li>--\x3e\n                            <li data-serveroption="9"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="15"><div class="checkbox"></div><span class="label"></span></li>\n                            <li data-serveroption="18"><div class="checkbox"></div><span class="label"></span></li>\n                        </ul>\n                    </div>\n                    <div class="seccond-c">\n                        <h2 class="settings-game"><span></span></h2>\n                        <ul class="hero-options">\n                            <li data-serveroption="8"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="7"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="16"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="11"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="23"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="24"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="17"><span class="checkbox"></span><span class="label"></span></li>\n                          \n            ${isEn()?"":'<li data-serveroption="26"><span class="checkbox"></span><span class="label"></span></li>'}\n                           \n                            <li data-serveroption="19"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="13"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="12"><span class="checkbox"></span><span class="label"></span></li>\n                            <li data-serveroption="4"><span class="checkbox"></span><span class="label"></span></li>\n                            \x3c!--<li data-serveroption="22"><span class="checkbox"></span><span class="label"></span></li>--\x3e\n                            <li data-serveroption="25"><span class="checkbox"></span><span class="label"></span></li>\n                            \x3c!--<li data-localoption="15"><span class="checkbox"></span><span class="label"></span></li>--\x3e\n                            <li data-serveroption="27"><span class="checkbox"></span><span class="label"></span></li>\n                        </ul>\n                    </div>\n                    \x3c!--<div class="options-config-buttons"></div>--\x3e\n                </div>\n            </div>\n        </div>\n        <div class="hot-keys-config section">\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="graphic-background"></div>\n                    \x3c!--<h2 class="settings-keys"></h2>--\x3e\n\n                    <div class="move-keys keys-section">\n                        <h2><span></span></h2>\n                        <table class="hot-keys-list"></table>\n                    </div>\n                    <div class="fight-keys keys-section">\n                        <h2><span></span></h2>\n                        <table class="hot-keys-list"></table>\n                    </div>\n                    <div class="map-keys keys-section">\n                        <h2><span></span></h2>\n                        <table class="hot-keys-list"></table>\n                    </div>\n                    <div class="social-keys keys-section">\n                        <h2><span></span></h2>\n                        <table class="hot-keys-list"></table>\n                    </div>\n                    <div class="other-keys keys-section">\n                        <h2><span></span></h2>\n                        <table class="hot-keys-list"></table>\n                    </div>\n                </div>\n                <table class="static-bar-table"></table>\n            </div>\n            \x3c!--<div class="hot-keys-config-buttons"></div>--\x3e\n        </div>\n        <div class="notifications-config section">\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="graphic-background"></div>\n                    <h2 class="settings-notifications"><span></span></h2>\n                    <div class="all-notification"></div>\n                    \x3c!--<div class="notifications-config-buttons"></div>--\x3e\n                    <h2 class="settings-sounds"><span></span></h2>\n                    <div class="display-table">\n                        <div class="middle music-manager-wrapper"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-bar">\n            <div class="options-config-buttons save-card-button"></div>\n            <div class="hot-keys-config-buttons save-card-button"></div>\n            <div class="notifications-config-buttons save-card-button"></div>\n        </div>\n    </div>`,i["sound-volume-bar"]='\n        <div class="display-table">\n            <div class="middle">\n                \x3c!--<div class="loudly-panel-txt" data-trans="#sound_notification_level"></div>--\x3e\n                <div class="loudly-panel-txt" data-trans="#sound_notification_level"></div>\n                <div class="loudly-panel">\n                    <div class="center">\n                        <div class="icon-wrapper">\n                            <div class="loudly-icon"></div>\n                        </div>\n                        <div class="slider-wrapper">\n                            <div class="volumeSlider">\n                                <div class="marker"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="loudly-panel-buttons"></div>\n            </div>\n        </div>',i["catch-char"]='<div class="catch-char">\n        <div class="give-char"></div>\n        <div class="cancel-char btns-spacing"></div>\n    </div>',i["pad-controller"]='<div class="pad-controller">\n        <div class="pad-bck"></div>\n    </div>',i["one-checkbox"]='<div class="one-checkbox">\n        <div class="checkbox"></div>\n        <span class="label"></span>\n    </div>',i["stat-row"]='<div class="stat-row" data-herostat="">\n        <span class="label" data-trans=""></span>\n        <span class="value">-</span>\n    </div>',i.input='<div class="input input-wrapper in-line">\n        <input class="default">\n    </div>',i["ni-input-text"]='<div class="ni-input">\n        <input class="default">\n        <div class="clear-cross"></div>\n    </div>',i["ability-points"]='<div class="ability-points">\n        <div class="ability-header"></div>\n        <div class="ability-content"></div>\n    </div>',i["ability-row"]='<div class="ability-row">\n        <div class="img-wrapper">\n            <div class="img"></div>\n        </div>\n        <div class="row-content">\n            <div class="row-header"></div>\n            <div class="description"></div>\n        </div>\n        <div class="points">\n            <div class="text"></div>\n            <div class="btn-wrapper"></div>\n        </div>\n    </div>',i["motel-window"]='<div class="motel-window">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="motel-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="desc"></div>\n        <div class="table-wrapper scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="yours-room-header rooms-header" data-trans="yours-room-header"></div>\n                <table class="yours-room">\n                    <thead>\n                    <tr>\n                        <th class="room-th"></th>\n                        <th class="state-th"></th>\n                        <th class="amount-th"></th>\n                        <th class="price-th"></th>\n                        <th class="action-th"></th>\n                    </tr>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n                <div class="rooms-to-rent-header rooms-header" data-trans="rooms-to-rent-header"></div>\n                <div class="rooms-description" data-trans="rooms-to-rent-header"></div>\n                <table class="to-rent-room">\n                    <thead>\n                    <tr>\n                        <th class="room-th"></th>\n                        <th class="state-th"></th>\n                        <th class="time-th"></th>\n                        <th class="price-th"></th>\n                        <th class="action-th"></th>\n                    </tr>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n                \x3c!--<div class="info-wrapper"></div>--\x3e\n            </div>\n        </div>\n    </div>',i["music-manager"]='<div class="music-manager">\n        <div class="loudly-panel-txt" data-trans="#clickMusic"></div>\n        <div class="loudly-panel">\n            <div class="center">\n                <div class="icon-wrapper">\n                    <div class="loudly-icon"></div>\n                </div>\n                <div class="slider-wrapper">\n                    <div class="volumeSlider">\n                        <div class="marker"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="loudly-panel-buttons">\n            <div class="quality-wrapper"></div>\n            <div class="list-wrapper"></div>\n            <div class="divide-wrapper"></div>\n        </div>\n    </div>',i.relogger='<div class="relogger">\n        <div class="relogger__success">\n            <div class="relogger__top">\n                <div class="relogger__characters"></div>\n                <div class="c-line mt-0 mb-0"></div>\n            </div>\n            <div class="relogger__collapse">\n                <div class="relogger__header mt-2 mb-2" data-trans="#select_world#change_player"></div>\n                <div class="scroll-wrapper">\n                    <div class="scroll-pane">\n                        <div class="relogger__worlds"></div>\n                    </div>\n                </div>\n                <div class="c-line mt-0"></div>\n                <div class="relogger__bottom"></div>\n            </div>\n        </div>\n        <div class="relogger__error"></div>\n    </div>',i["who-is-here"]='<div class="who-is-here">\n        <div class="open-edit-panel"></div>\n        <div class="players-number">\n            (<span class="num"></span>) <div class="info-icon small-header-info" data-tip=""></div>\n        </div>\n        <div class="header"></div>\n        <div class="scroll-wrapper">\n            <div class="scroll-pane">\n                <div class="empty">----</div>\n                <div class="player-list"></div>\n            </div>\n        </div>\n        <div class="search-wrapper">\n            <input class="search" data-trans="placeholder#search">\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n    </div>',i["quest-observe-window"]='<div class="quest-observe-window">\n        <div class="scroll-wrapper">\n            <div class="scroll-pane">\n                <div class="empty">----</div>\n                <div class="quest-observe-list"></div>\n            </div>\n        </div>\n        <div class="relogger__error"></div>\n    </div>',i["one-quest-observe"]='<div class="one-quest-observe">\n        <div class="title"></div>\n        <div class="quest-content"></div>\n        <div class="delete-observe-btn"></div>\n        <div class="end-line"></div>\n    </div>',i["outfit-selector-arrow"]='<div class="outfit-selector-arrow"></div>',i["outfit-selector-header"]='<div class="outfit-selector-header">\n        <span class="header-wrapper">\n            <span class="outfit-selector-index"></span> z <span class="outfit-selector-index-max"></span>\n        </span>\n    </div>',i["choose-outfit"]='<div class="choose-outfit">\n        <div class="middle-graphics"></div>\n        <div class="choose-outfit-info" data-trans="#choose-outfit-info"></div>\n        <div class="all-outfits"></div>\n        <div class="buttons-wrapper">\n            <div class="save-button"></div>\n            <div class="cancel-button"></div>\n        </div>\n    </div>',i["choose-outfit-wrapper"]='<div class="choose-outfit-wrapper">\n        <div class="outfit-name"></div>\n        \x3c!--<div class="outfit"></div>--\x3e\n    </div>',i["change-outfit"]='<div class="change-outfit">\n        <div class="middle-graphics"></div>\n\n        <div class="cards-header-wrapper">\n            <div class="header-background-graphic"></div>\n            <div class="cards-header"></div>\n        </div>\n\n        <div class="default-section scroll-wrapper section classic-bar">\n            <div class="scroll-pane default-outfits"></div>\n        </div>\n\n        <div class="equip-section scroll-wrapper section classic-bar">\n            <div class="scroll-pane equip-outfits">\n                <div class="empty-info" data-trans="#empty-info"></div>\n            </div>\n        </div>\n\n        <div class="your-outfit">\n            <div class="outfit-header"></div>\n            <div class="outfit-wrapper">\n                <div class="outfit-graphic"></div>\n            </div>\n        </div>\n\n        <div class="crazy-bar"></div>\n\n        <div class="preview-outfit">\n            <div class="outfit-header"></div>\n            <div class="outfit-wrapper">\n                <div class="outfit-graphic"></div>\n            </div>\n        </div>\n\n        <div class="bottom-change-outfit-panel">\n            <div class="bottom-panel-graphics"></div>\n            <div class="save-button"></div>\n        </div>\n    </div>',i["one-outfit"]='<div class="one-outfit">\n        <div class="outfit-border"></div>\n        <div class="outfit-wrapper"></div>\n        <div class="outfit-timelimit"></div>\n        <div class="requirements">\n            <span class="text"></span>\n        </div>\n        <div class="amount"></div>\n    </div>',i["who-is-here-one-type"]='<div class="who-is-here-one-type clearfix">\n        <div class="type"></div>\n        <div class="amount"></div>\n    </div>',i["log-off"]='<div class="log-off">\n        <div class="time-to-out"></div>\n        <div class="log-out-actions btns-spacing"></div>\n    </div>',i["wanted-skull-wrapper"]='<div class="wanted-skull-wrapper wanted-wrapper">\n        <div class="skull"></div>\n    </div>',i["who-is-here-edit"]='<div class="who-is-here-edit">\n        <div class="con">\n            \x3c!--<div class="header"></div>--\x3e\n            <div class="middle-graphics"></div>\n            <div class="show-label"></div>\n            <div class="color-label"></div>\n            <div class="show-map-label"></div>\n            <div class="all-colors"></div>\n        </div>\n        <div class="bottom-bar">\n            <div class="buttons">\n                <div class="save-colors"></div>\n            </div>\n        </div>\n    </div>',i["first-column-who-is-here"]='<div class="first-column-who-is-here first-column"></div>',i["second-column-who-is-here"]='<div class="second-column-who-is-here second-column"></div>',i["color-to-choose-who-is-here"]='<div class="color-to-choose-who-is-here color-to-choose"></div>',i["rewards-calendar"]='<div class="rewards-calendar">\n        <div class="calendar-background"></div>\n        <div class="calendar-year"></div>\n        <div class="calendar-month-header">\n            <div class="month-wrapper">\n                <div class="prev-month month-item"></div>\n                <div class="click-prev month-item direction"><</div>\n                <div class="actual-month"></div>\n                <div class="click-next month-item direction">></div>\n                <div class="next-month month-item"></div>\n            </div>\n        </div>\n        <div class="calendar-days-header"></div>\n        <div class="calendar-days-content"></div>\n    </div>',i["day-header"]='<div class="day-header"></div>',i["day-wrapper-reward-calendar"]='<div class="day-wrapper-reward-calendar day-wrapper">\n        <div class="day">\n            <div class="event-name"></div>\n            <div class="day-nr"></div>\n            <div class="reward">\n                <div class="item-wrapper"></div>\n            </div>\n        </div>\n    </div>',i["reward-reward-calendar"]='<div class="reward-reward-calendar"></div>',i["who-is-here-color"]='<div class="who-is-here-color">\n        <div class="txt-wrapper"><div class="text"></div></div>\n        <div class="show-checkbox-wrapper"></div>\n        <div class="glow-checkbox-wrapper"></div>\n        <div class="choose-color-wrapper"></div>\n        <div class="pick-color"></div>\n        <div class="gray"></div>\n    </div>',i["divide-and-color-edit"]='<div class="divide-and-color-edit">\n        <div class="middle-graphic"></div>\n        <div class="global-option-wrapper">\n            <div class="info-box visibility-header" data-trans="#visibility-header#edit-panel-option"></div>\n            <div class="global-option"></div>\n            <div class="info-box display-header" data-trans="#display-header#edit-panel-option"></div>\n        </div>\n        <div class="by-name-option"></div>\n        <div class="bottom-bar">\n            <div class="buttons save-colors"></div>\n        </div>\n    </div>',i["text-and-input"]='<div class="text-and-input">\n        <div class="text"></div>\n        \x3c!--<div class="input-wrapper">--\x3e\n            \x3c!--<input type="number" class="amount-val default">--\x3e\n        \x3c!--</div>--\x3e\n    </div>',i["divide-and-color-record"]='<div class="divide-and-color-record">\n        <div class="txt-wrapper"><div class="text"></div></div>\n        \x3c!--<div class="menu-wrapper"><div class="menu"></div></div>--\x3e\n        <div class="show-hand-held-mini-map-checkbox-wrapper"></div>\n        <div class="show-data-drawer-nick-checkbox-wrapper"></div>\n        <div class="show-data-drawer-prof-and-level-checkbox-wrapper"></div>\n        <div class="show-who-is-here-checkbox-wrapper"></div>\n        <div class="show-map-blur-checkbox-wrapper"></div>\n        <div class="choose-color-wrapper"></div>\n        <div class="pick-color"></div>\n    </div>',i["color-picker"]='\n        <div class="color-picker">\n            <div class="choose-color-wrapper">\n                <div class="choose-color-bck"></div>\n            </div>\n            <div class="choose-icon-wrapper">\n                <div class="choose-icon"></div>\n            </div>\n                <div class="pick-color-palette">\n                    <div class="first-column-icon"></div>\n                    <div class="first-column-color"></div>\n                    <div class="second-column-color"></div>\n                </div>\n        </div>\n    ',i["divide-edit-panel"]='<div class="divide-edit-panel">\n        <div class="header-wrapper">\n            <div class="graphic"></div>\n            <div class="edit-header-label"></div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphic"></div>\n                <div class="show-label"></div>\n            </div>\n        </div>\n        <div class="bottom-bar">\n            <div class="buttons save-colors"></div>\n        </div>\n    </div>',i["edit-panel-option"]='<div class="edit-panel-option">\n        <div class="icon-wrapper"><div class="icon-mark"></div></div>\n        <div class="txt-wrapper"><div class="text"></div></div>\n        <div class="menu-wrapper"><div class="menu"></div></div>\n    </div>',i["one-other"]='<div class="one-other tw-list-item">\n        <div class="tip-container"></div>\n        <div class="center">\n            <div class="name"><div class="inner"></div></div>\n            <div class="stasis" data-trans="data-tip#in_stasis#party"></div>\n            <div class="stasis-incoming" data-trans="data-tip#in_stasis-incoming#party"></div>\n            <div class="lvl"></div>\n        </div>\n    </div>',i["great-merchamp-menu"]='<div class="great-merchamp-menu">\n        <div class="header"></div>\n        <div class="info"></div>\n        <div class="checkbox-list">\n            <div class="one-group">\n                <div class="gr-1-label group-header" data-trans="#greatMerchampItemRank"></div>\n                <div class="gr-1"></div>\n            </div>\n            <div class="one-group">\n                <div class="gr-2-label group-header" data-trans="#greatMerchampItemSoulbound"></div>\n                <div class="gr-2"></div>\n            </div>\n            <div class="one-group">\n                <div class="gr-3-label group-header" data-trans="#greatMerchampItemKinds"></div>\n                <div class="gr-3"></div>\n            </div>\n        </div>\n        <div class="button-pannel btns-spacing"></div>\n    </div>',i["loot-filter-manager"]='<div class="loot-filter-manager">\n        <div class="text-wrapper">\n            <span class="loot-text"></span>\n        </div>\n        <div class="input-wrapper">\n            <input class="more-than default" maxlength ="12" placeholder="0"/>\n        </div>\n        <div class="button-wrapper"></div>\n        <div class="loot-info"></div>\n    </div>',i["details-progress"]='<div class="details-progress">\n        <div class="details-header"></div>\n        <div class="details-txt"></div>\n    </div>',i["matchmaking-overlay"]='<div class="matchmaking-overlay"></div>',i["matchmaking-summary"]='<div class="matchmaking-summary">\n        <div class="middle-graphics"></div>\n        <div class="summary-content">\n            <div class="difficult-stars wood-bar">\n                <div class="difficult-stars-val wood-bar-val">\n                    <div class="text" data-trans="#fight_dificult"></div>\n                    <div class="stars-wrapper">\n\n                    </div>\n                </div>\n            </div>\n            <div class="result-panel">\n                <div class="your-side">\n                    <div class="your-result"></div>\n                    <div class="your-name-and-level"></div>\n                    <div class="your-prof"></div>\n                    <div class="your-pr"></div>\n                </div>\n                <div class="middle-side">\n                    <div class="middle-wrapper">\n                        <div class="avatars-info-wrapper">\n                            <div class="your-outfit-wrapper">\n                                <div class="out-icon"></div>\n                            </div>\n                            <div class="vs-img-wrapper">\n                                <div class="vs-img"></div>\n                            </div>\n                            <div class="enemy-outfit-wrapper">\n                                <div class="out-icon"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pr-change"></div>\n                    <div class="arrow"></div>\n                </div>\n                <div class="enemy-side">\n                    <div class="enemy-result"></div>\n                    <div class="enemy-name-and-level"></div>\n                    <div class="enemy-prof"></div>\n                    <div class="enemy-pr"></div>\n                </div>\n            </div>\n            <div class="progress-points wood-bar">\n                <div class="progress-points-val wood-bar-val"></div>\n            </div>\n            <div class="current-stage"></div>\n            <div class="price-info" data-trans="#price_info#matchmaking"></div>\n            <div class="classification-match wood-bar">\n                <div class="classification-match-val wood-bar-val"></div>\n            </div>\n        </div>\n\n        <div class="bottom-panel-graphics">\n            <div class="tokens-amount"></div>\n            <div class="close-wrapper"></div>\n        </div>\n    </div>',i.card='<div class="card">\n        <div class="label">\n            <div class="number"></div>\n            <div class="icons">\n                <div class="cl-icon icon-soulbound"></div>\n            </div>\n        </div>\n        <div class="amount"></div>\n    </div>',i["achievement-section"]='<div class="achievement-section"></div>',i["achievement-panel"]='<div class="achievement-panel">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="cards-header-wrapper">\n            <div class="header-background-graphic"></div>\n            <div class="cards-header"></div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphics">\n                </div>\n            </div>\n        </div>\n        <div class="bottom-panel-graphics"></div>\n    </div>',i["one-achievement"]='<div class="one-achievement">\n        <div class="title-wrapper">\n            <div class="achievement-title"></div>\n            <div class="state-wrapper">\n                <span>[</span>\n                <span class="current"></span>\n                <span>/</span>\n                <span class="max"></span>\n                <span>]</span>\n            </div>\n        </div>\n        <div class="middle-wrapper">\n            <div class="icon-wrapper">\n                <div class="icon"></div>\n            </div>\n            <div class="info-wrapper">\n                <div class="description-wrapper"></div>\n            </div>\n            <div class="progress-bar-wrapper">\n                <div class="progress-bar"></div>\n            </div>\n        </div>\n    </div>',i["show-miniature"]='<div class="show-miniature">\n\x3c!--        <div class="info-icon pet-action-info" data-trans="data-tip#action_info#pet"></div>--\x3e\n        <div class="info-icon pet-action-info"></div>\n        <div class="canvas-wrapper">\n            \x3c!--<canvas class="show-miniature-canvas"></canvas>--\x3e\n        </div>\n        <div class="menu-wrapper"></div>\n    </div>',i["matchmaking-panel"]='<div class="matchmaking-panel">\n        <div class="header-wrapper">\n            <div class="graphic"></div>\n            <div class="edit-header-label"></div>\n        </div>\n        <div class="middle-graphics"></div>\n        <div class="bottom-panel-graphics"></div>\n        <div class="all-pages">\n            <div class="matchmaking-menu main-wnd">\n                <div class="show-reward-season-item"></div>\n                <div class="matchmaking-menu-bottom-panel">\n                    <div class="turn-on-off-tutorial"></div>\n                    <div class="warning-points" data-trans="data-tip#warning_point_desc">\n                        <div class="info-icon"></div>\n                        <div class="text"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="choose-eq main-wnd no-exit">\n                <div class="choose-eq-bottom-panel">\n                    <div class="time-ball">\n                        <div class="time">10 s</div>\n                    </div>\n                    <div class="blink-wait-label" data-trans="#wait-for-label#matchmaking"></div>\n                    <div class="you-info">\n                        <div class="avatar-wrapper">\n                            <div class="avatar-icon"></div>\n                        </div>\n                        <div class="attributes">\n                            <div class="name"></div>\n                            <div class="level-rating-wrapper">\n                                <div class="level-rating"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="vs-wrapper">\n                        <div class="vs-graphic"></div>\n                    </div>\n                    <div class="opponent-info">\n                        <div class="avatar-wrapper">\n                            <div class="avatar-icon hidden-prof"></div>\n                        </div>\n                        <div class="attributes">\n                            <div class="name"></div>\n                            <div class="level-rating-wrapper">\n                                <div class="level-rating"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="fight-button"></div>\n                </div>\n            </div>\n\n            <div class="stats-and-history main-wnd">\n                <div class="cards-header-wrapper">\n                    <div class="header-background-graphic"></div>\n                    <div class="cards-header"></div>\n                </div>\n                <div class="progress-wnd section">\n                    <div class="left-side">\n                        <div class="char-info"></div>\n                        <div class="outfit-wrapper">\n                            \x3c!--<div class="outfit-img"></div>--\x3e\n                        </div>\n                        \x3c!--<div class="tokens-amount"></div>--\x3e\n                        <div class="btns-wrapper">\n                            <div class="details-btn"></div>\n                            <div class="go-to-shop-btn"></div>\n                        </div>\n                    </div>\n                    <div class="right-side"></div>\n                    <div class="progress-bottom-panel">\n                        <div class="chempions-amount"></div>\n                        <div class="back-to-main"></div>\n                    </div>\n                </div>\n                <div class="stats-wnd section">\n                    <table class="stats-table"></table>\n                    <div class="stats-bottom-panel">\n                        <div class="back-to-main"></div>\n                        <div class="stats-info" data-trans="#statisticsinfo_tip#matchmaking"></div>\n                    </div>\n                </div>\n\n                <div class="history-wnd section">\n                    <table class="history-table"></table>\n                    <div class="history-bottom-panel">\n                        <div class="back-to-main"></div>\n                        <div class="page-info"></div>\n                        <div class="prev-page"></div>\n                        <div class="input-wrapper">\n                            <input class="page-number default">\n                        </div>\n                        <div class="next-page"></div>\n                    </div>\n                </div>\n\n                <div class="season-wnd section">\n\n                    <div class="middle-wood"></div>\n\n                    <div class="reward-header season-header" data-trans="#rewards_of_season#matchmaking"></div>\n                    <div class="reward-wrapper scroll-wrapper classic-bar">\n                        \x3c!--<div class="reward-graphic"></div>--\x3e\n                        <div class="scroll-pane"></div>\n                    </div>\n\n                    <div class="winners-header season-header" data-trans="#last_season_winners#matchmaking"></div>\n                    <div class="winners-wrapper">\n                        \x3c!--<div class="winners-not-exist" data-trans="#winners_not_exist#matchmaking"></div>--\x3e\n                        <div class="header-info"></div>\n                        <div class="txt-info"></div>\n                        <div class="outfits-wrapper">\n                            <div class="players-in-ranking-info"></div>\n                            <div class="amount-players-got-outfit-info"></div>\n                            <div class="wrapper-outfit-info"></div>\n                        </div>\n                    </div>\n\n                    <div class="season-bottom-panel">\n                        \x3c!--<div class="season-tip-info info-icon" data-trans="data-tip#rankingpoints#matchmaking"></div>--\x3e\n                        \x3c!--<div class="played-battle"></div>--\x3e\n                        <div class="back-to-main"></div>\n                        <div class="your-records">\n                            <div class="your-season-record"></div>\n                            <div class="your-career-record">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="statistics-detailed-wnd section">\n                    <table class="statistics-detailed-table"></table>\n                    <div class="statistics-detailed-bottom-panel">\n                        <div class="back-to-main"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="matchmaking-ranking main-wnd">\n                <div class="cards-header-wrapper">\n                    <div class="header-background-graphic"></div>\n                    <div class="cards-header"></div>\n                </div>\n                <div class="general-ranking-wnd section">\n                    <table class="ranking-table"></table>\n                    <div class="ladder_global-bottom-panel ranking-bottom-panel">\n                        <div class="refresh"></div>\n                        <div class="back-to-main"></div>\n                        <div class="page-info"></div>\n                        <div class="prev-page"></div>\n                        <div class="input-wrapper">\n                            <input class="page-number default">\n                        </div>\n                        <div class="next-page"></div>\n                    </div>\n                </div>\n                <div class="clan-ranking-wnd section">\n                    <table class="ranking-table"></table>\n                    <div class="text-info" data-trans="#clan_not_exist"></div>\n                    <div class="ladder_clan-bottom-panel ranking-bottom-panel">\n                        <div class="refresh"></div>\n                        <div class="back-to-main"></div>\n                        <div class="page-info"></div>\n                        <div class="prev-page"></div>\n                        <div class="input-wrapper">\n                            <input class="page-number default">\n                        </div>\n                        <div class="next-page"></div>\n                    </div>\n                </div>\n                <div class="friends-ranking-wnd section">\n                    <table class="ranking-table"></table>\n                    <div class="text-info" data-trans="#friend_not_exist"></div>\n                    <div class="ladder_friends-bottom-panel ranking-bottom-panel">\n                        <div class="refresh"></div>\n                        <div class="back-to-main"></div>\n                        <div class="page-info"></div>\n                        <div class="prev-page"></div>\n                        <div class="input-wrapper">\n                            <input class="page-number default">\n                        </div>\n                        <div class="next-page"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="wait-for-opponent no-exit main-wnd">\n                <div class="section">\n                    <div class="wait-for-graphic"></div>\n                    <div class="wait-for-label" data-trans="#wait-for-label#matchmaking"></div>\n                </div>\n            </div>\n\n            <div class="season-reward-main  main-wnd">\n                <div class="your-place"></div>\n                <div class="txt-info-1 txt-info" data-trans="#txt-info-1#matchmaking"></div>\n                <div class="txt-info-2 txt-info" data-trans="#txt-info-2#matchmaking"></div>\n                <div class="your-reward-wrapper">\n                    <div class="your-reward"></div>\n                    <div class="your-outfits"></div>\n                </div>\n                <div class="season-reward-bottom-panel">\n                    <div class="take-reward"></div>\n                    <div class="take-reward-now"></div>\n                </div>\n            </div>\n\n        </div>\n        \x3c!--<div class="time-ball">--\x3e\n        \x3c!--<div class="time"></div>--\x3e\n        \x3c!--</div>--\x3e\n    </div>',i["fight-result"]='<div class="fight-result"></div>',i["season-outfit"]='<div class="season-outfit">\n        <div class="place"></div>\n    </div>',i["rage-wrapper"]='<div class="rage-wrapper"></div>',i["place-matchmaking"]='<div class="place-matchmaking place"></div>',i["item-wrapper-matchmaking"]='<div class="item-wrapper-matchmaking item-wrapper"></div>',i["item-chest-slot-matchmaking"]='<div class="item-chest-slot-matchmaking item-chest-slot">\n        <div class="item-chest-border"></div>\n    </div>',i["measure-matchmaking"]='<div class="measure-matchmaking measure"></div>',i["matchmaking-tutorial-overlay"]='<div class="matchmaking-tutorial-overlay"></div>',i["first-cell-matchmaking"]='<div class="first-cell-matchmaking first-cell">\n        <div class="img-wrapper"></div>\n        <div class="info"></div>\n    </div>',i["skill-set-matchmaking"]='<div class="skill-set-matchmaking skill-set"></div>',i["outfit-check-wrapper"]=`<div class="outfit-check-wrapper">\n        \x3c!--<div data-template-inside="one-checkbox"></div>--\x3e\n        ${i["one-checkbox"]}\n        <div class="outfit-wrapper">\n            <div class="text-label"></div>\n        </div>\n    </div>`,i["star-matchmaking"]='<div class="star-matchmaking star"></div>',i["completed-matches"]='<div class="completed-matches">\n        <div class="info-icon"></div>\n        <div class="text"></div>\n    </div>',i["matchmaking-progress-stage"]='<div class="matchmaking-progress-stage">\n        <div class="points-side">\n            <div class="stage"></div>\n            <div class="ratio"></div>\n        </div>\n        <div class="bar-and-item-side">\n            <div class="progress-bar">\n                <div class="background-bar"></div>\n            </div>\n            <div class="items-wrapper"></div>\n        </div>\n    </div>',i["matchmaking-tile"]='<div class="matchmaking-tile">\n        <div class="matchmaking-tile-header-wrapper">\n            <div class="matchmaking-tile-header"></div>\n        </div>\n        \x3c!--<div class="matchmaking-tile-background"></div>--\x3e\n        <div class="matchmaking-tile-content"></div>\n        <div class="matchmaking-tile-bottom-label"></div>\n    </div>',i["cloud-tip"]='<div class="cloud-tip">\n        <div class="close">\n            <div class="cross"></div>\n        </div>\n        <div class="header"></div>\n        <div class="content"></div>\n        <div class="cloud-tail"></div>\n        <div class="next" data-trans="#next#tutorials"></div>\n\n    </div>',i["eq-items-set"]='<div class="eq-items-set">\n        <div class="eq-slot st-10"></div>\n        <div class="eq-slot st-1"></div>\n        <div class="eq-slot st-2"></div>\n        <div class="eq-slot st-3"></div>\n        <div class="eq-slot st-4"></div>\n        <div class="eq-slot st-5"></div>\n        <div class="eq-slot st-6"></div>\n        <div class="eq-slot st-7"></div>\n        <div class="eq-slot st-8"></div>\n        <div class="eq-slot st-9"></div>\n    </div>',i["premium-item-wrapper"]='<div class="premium-item-wrapper"></div>',i["premium-item"]='<div class="premium-item">\n        <div class="premium-text"></div>\n    </div>',i["crafting-description-header"]='<div class="crafting-description-header">\n        <div class="item-name-wrapper">\n            <div class="result-item item-slot"></div>\n            <div class="offer-name"></div>\n        </div>\n    </div>',i["crafting-description-reagents"]='<div class="crafting-description-reagents">\n        <div class="reagents-list"></div>\n    </div>',i["crafting-cost-panel"]='<div class="crafting-cost-panel">\n        <div class="cost-header-label" data-trans="#cost#recover"></div>\n        <div class="crafting-cost-wrapper"></div>\n    </div>',i["crafting-description-button"]='<div class="crafting-description-button">\n        <div class="use-recipe-btn"></div>\n    </div>',i["one-item-on-divide-list"]='<div class="one-item-on-divide-list">\n        \x3c!--<div class="item-wrapper">--\x3e\n        \x3c!--<div class="result-item item-slot"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="name-wrapper">\n            <div class="name"></div>\n        </div>\n    </div>',i["crafting-reagent"]='<div class="crafting-reagent">\n        <div class="reagent-wrapper">\n            <div class="item-reagent-wrapper">\n                <div class="item-reagent item-slot"></div>\n            </div>\n            <div class="reagent-info">\n                <div class="item-name"></div>\n                <div class="amount-items">\n                    <span class="have"></span>/<span class="need"></span>\n                </div>\n            </div>\n            <div class="owned-items"></div>\n        </div>\n    </div>',i.crafting='<div class="crafting">\n            <div class="crafting__tabs cards-header-wrapper">\n                <div class="header-background-graphic"></div>\n                <div class="cards-header"></div>\n            </div>\n            <div class="crafting__contents"></div>\n        </div>',i.salvage='<div class="salvage">\n        <div class="salvage__content">\n            <div class="scroll-wrapper classic-bar">\n                <div class="crafting__bg"></div>\n                <div class="scroll-pane">\n                    <div class="salvage__content-inner">\n                        <div class="salvage__info" data-trans="#info#salvager"></div>\n                        <div class="salvage__reagents items-grid">\n                            <div class="salvage__label" data-trans="#selected#salvager"></div>\n                        </div>\n                        <div class="salvage__arrows"></div>\n                        <div class="salvage__receives">\n                            <div class="salvage__label" data-trans="#result#salvager"></div>\n                        </div>\n                        <div class="salvage__submit"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',i.extraction='<div class="extraction">\n        <div class="extraction__content">\n            <div class="scroll-wrapper classic-bar">\n                <div class="crafting__bg"></div>\n                <div class="scroll-pane">\n                    <div class="extraction__content-inner">\n                        <div class="extraction__info" data-trans="#info#extraction"></div>\n                        <div class="extraction__item items-grid"></div>\n                        <div class="extraction__arrows"></div>\n                        <div class="extraction__receives">\n                            <div class="extraction__label" data-trans="#result#extraction"></div>\n                        </div>\n                        <div class="extraction__finalize">\n                            <div class="extraction__info" data-trans="#info2#extraction"></div>\n                            <div class="extraction__payment"></div>\n                            <div class="extraction__submit"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',i.extractionPaymentOption='\n        <div class="extraction__currency">\n            <div class="icon"></div>\n            <div class="amount"></div>\n        </div>\n    ',i.enhance='\n    <div class="enhance">\n        <div class="enhance__content">\n            <div class="scroll-wrapper classic-bar">\n                <div class="crafting__bg"></div>\n                <div class="scroll-pane">\n                    <div class="enhance__content-inner">\n                        <div class="enhance__info enhance__info--top">\n                            <div class="enhance__info--1">\n                                <div class="enhance__info--top" data-trans="#info#enhancement"></div>\n                            </div>\n                            <div class="enhance__info--3">\n                                <div class="enhance__info--top" data-trans="#info3#enhancement"></div>\n                            </div>\n                        </div>\n                        <div class="enhance__top">\n                            <div class="enhance__item enhance__item--current">\n                                <div class="slot"></div>\n                                <div class="lvl">\n                                    <div class="cl-icon icon-star-0"></div>\n                                </div>\n                            </div>\n                            <div class="enhance__progressbar">\n                                <div class="enhance__progress-bg"></div>\n                                <div class="enhance__progress enhance__progress--current"></div>\n                                <div class="enhance__progress enhance__progress--preview"></div>\n                                <div class="enhance__progress-text enhance__progress-text--current"></div>\n                                <div class="enhance__progress-text enhance__progress-text--preview"></div>\n                            </div>\n                            <div class="enhance__item enhance__item--receive">\n                                <div class="slot"></div>\n                                <div class="lvl">\n                                    <div class="cl-icon icon-star-0"></div>\n                                </div>\n                            </div>\n                        </div> \n                        \n                        <div class="enhance__enchant">\n                            <div class="enhance__wrapper">\n                                <div class="info-box mt-4">\n                                    <div data-trans="#info5#enhancement"></div>\n                                    <div class="info-icon" data-trans="data-tip#info_tip#enhancement"></div>\n                                </div>\n                                <div class="enhance__autofiller"></div>\n                                <div class="enhance__reagents items-grid disabled">\n                                    <div class="enhance__label" data-trans="#selected#enhancement"></div>\n                                </div>\n                            </div>\n                            <div class="enhance__limit">\n                                <span data-trans="#limit#enhancement"></span>:\n                                <span class="enhance__counter"></span>\n                            </div> \n                            <div class="enhance__submit"></div> \n                        </div>\n                        \n                        <div class="enhance__enhance">\n                            <div class="enhance__bonus"></div>\n                            <div class="enhance__requires">\n                                <div class="enhance__r-gold">\n                                    <div class="enhance__r-gold-icon"></div>\n                                    <div class="enhance__r-gold-amount"></div>\n                                </div>\n                                <div class="enhance__r-item"></div>\n                            </div>\n                            <div class="enhance__submit2"></div> \n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',i.autofiller='\n      <div class="autofiller"></div>\n    ',i["autofiller-config"]='<div class="autofiller-config">\n        <div class="autofiller-config__heading"></div>\n        <div class="autofiller-config__groups"></div>\n        <div class="autofiller-config__buttons btns-spacing"></div>\n    </div>',i["autofiller-config-group"]='<div class="autofiller-config__group">\n        <div class="autofiller-config__title"></div>\n        <div class="autofiller-config__checkboxes"></div>\n    </div>',i["world-window"]='\n    <div class="world-window">\n        <div class="world-window__tabs"></div>\n        <div class="world-window__contents"></div>\n    </div>',i["tabs-nav"]='\n    <div class="tabs__nav"></div>',i["tabs-content"]='\n    <div class="tabs__contents"></div>',i["players-online"]='\n    <div class="players-online">\n        <div class="players-online__content">\n            <div class="world-window__bg"></div>\n            <div class="players-online__header">\n                <div class="search-wrapper">\n                    <input class="search clan-name-input" data-trans="placeholder#search"/>\n                    <div class="search-x" data-trans="data-tip#delete"></div>\n                </div>\n                <div class="players-online__info world-window__info">\n                    \x3c!--<span data-trans="#players-online2#world_window"></span>:&nbsp;--\x3e\n                    \x3c!--<span class="players-online__amount"></span>&nbsp;--\x3e\n                    <span data-trans="data-from"></span>&nbsp;<span class="players-online__date"></span>\n                    <div class="info-icon" data-trans="data-tip#info_tip#world_window"></div>\n                </div>\n            </div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="players-online__items-container"></div>\n                </div>\n            </div>\n            <div class="bottom-bar">\n                <div class="filter-label" data-trans="#filter-level"></div>\n                <div class="start-lvl-wrapper"></div>\n                <div class="stop-lvl-wrapper"></div>\n                <div class="choose-prof menu"></div>\n                <div class="legend">\n                  <span data-trans="#player-ranks#world_window"></span>\n                  <span class="info-icon"></span>\n                </div>\n            </div>\n        </div>\n    </div>',i["players-online-item"]='\n    <div class="players-online__item">\n        <div class="players-online__nick"></div>\n        <div>\n          (<span class="players-online__lvl"></span><span class="players-online__prof"></span>)\n        </div>\n    </div>',i["server-parameters"]='\n    <div class="server-parameters">\n        <div class="server-parameters__content">\n            <div class="world-window__bg"></div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="server-parameters__items-container"></div>\n                </div>\n            </div>\n            <div class="bottom-bar"></div>\n        </div>\n    </div>',i["server-parameters-item"]='\n    <div class="server-parameters__item">\n      <div class="server-parameters__item-name"></div>\n      <div class="server-parameters__item-value"></div>\n    </div>',i["location-parameters"]='\n    <div class="location-parameters">\n        <div class="location-parameters__content">\n            <div class="world-window__bg"></div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="location-parameters__items-container"></div>\n                </div>\n            </div>\n            <div class="bottom-bar"></div>\n        </div>\n    </div>',i["location-parameters-item"]='\n    <div class="location-parameters__item">\n      <div class="location-parameters__item-name"></div>\n      <div class="location-parameters__item-value"></div>\n    </div>',i["hunting-statistics-table-header"]='\n    <table class="hunting-statistics-table-header">\n        <thead>\n            <tr class="hunting-statistics__head"></tr>\n        </thead>\n    </table>',i["hunting-statistics"]=`\n    <div class="hunting-statistics">\n        <div class="hunting-statistics__content">\n            <div class="world-window__bg"></div>\n            <div class="hunting-statistics__header">\n                <div class="search-wrapper">\n                    <input class="search clan-name-input" data-trans="placeholder#search"/>\n                    <div class="search-x" data-trans="data-tip#delete"></div>\n                </div>\n            </div>\n            <div class="hunting-statistics-table-header-wrapper">\n                ${i["hunting-statistics-table-header"]}\n            </div>\n            <div class="scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <table class="hunting-statistics-table"></table>\n                </div>\n            </div>\n            <div class="bottom-bar">\n                <div class="filter-label" data-trans="#filter-level"></div>\n                <div class="start-lvl-wrapper"></div>\n                <div class="stop-lvl-wrapper"></div>\n                <div class="choose-prof menu"></div>\n                <div class="choose-type menu"></div>\n                <div class="load"></div>\n                <div class="legend">\n                  <span class="info-icon" data-trans="data-tip#tip-info#hunting_statistics"></span>\n                </div>\n            </div>\n        </div>\n    </div>`,i["hunting-statistics-item"]='\n    <tr class="hunting-statistics-item">\n      <td class="hunting-statistics-item__name"></td>\n      <td class="hunting-statistics-item__level"></td>\n      <td class="hunting-statistics-item__kills"></td>\n      <td class="hunting-statistics-item__unique color-unique"></td>\n      <td class="hunting-statistics-item__heroic color-heroic"></td>\n      <td class="hunting-statistics-item__legendary color-legendary"></td>\n    </tr>',i["radio-info"]='\n    <div class="radio-info">\n        <div class="radio-before-label"></div>\n        <div class="radio-label"></div>\n        <div class="radio-after-label"></div>\n    </div>',i["radio-list"]='<div class="radio-list"></div>',i["radio-custom"]='\n        <div class="radio-custom">\n            <input type="radio" id="xxx" name="xxx">\n            <label for="xxx"></label>\n        </div>\n    ',i["checkbox-list"]='<div class="radio-list"></div>',i["checkbox-custom"]='\n        <div class="checkbox-custom">\n            <input type="checkbox" id="xxx" name="xxx">\n            <label for="xxx"></label>\n        </div>\n    ',i["checkbox-list"]='<div class="radio-list"></div>',i["checkbox-custom"]='\n        <div class="checkbox-custom">\n            <input type="checkbox" id="xxx" name="xxx">\n            <label for="xxx"></label>\n        </div>\n    ',i["left-grouped-list-and-right-description-window"]='<div class="left-grouped-list-and-right-description-window">\n        <div class="main-header">\n            <div class="left-column-list-label"></div>\n        </div>\n        <div class="left-column">\n            <div class="middle-left-column-graphics"></div>\n            <div class="search-wrapper search-in-left-column">\n                <input class="search" data-trans="placeholder#search"/>\n                <div class="search-x" data-trans="data-tip#delete"></div>\n            </div>\n            <div class="bottom-left-column-graphics"></div>\n            <div class="left-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="items-list"></div>\n                </div>\n            </div>\n        </div>\n        <div class="right-column">\n            <div class="middle-right-column-graphics"></div>\n            <div class="right-column-header"></div>\n            <div class="paper-graphics"></div>\n            <div class="right-scroll scroll-wrapper classic-bar">\n                <div class="scroll-pane">\n                    <div class="reagents-label"></div>\n                    <div class="reagents-list">\n                        <div class="board"></div>\n                        <div class="all-items-wrapper"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-row-panel">\n            <div class="bottom-panel-graphics"></div>\n            <div class="filter-label" data-trans="#filter-level"></div>\n            <div class="start-lvl-wrapper"></div>\n            <div class="stop-lvl-wrapper"></div>\n            <div class="choose-prof-wrapper">\n                <div class="choose-prof menu"></div>\n            </div>\n            <div class="choose-item-type-wrapper">\n                <div class="choose-item-type menu"></div>\n            </div>\n            <div class="do-recipe"></div>\n        </div>\n    </div>',i["divide-list-group"]='<div class="divide-list-group">\n        <div class="group-header">\n            <div class="card-graphic"></div>\n            <div class="label"></div>\n            <div class="direction"></div>\n            <div class="amount"></div>\n        </div>\n        <div class="group-list"></div>\n    </div>',i["window-list"]='<div class="window-list">\n        <div class="open-edit-panel"></div>\n        <div class="header"></div>\n        <div class="scroll-wrapper">\n            <div class="scroll-pane">\n                <div class="empty">----</div>\n                <div class="list"></div>\n            </div>\n        </div>\n    </div>',i["window-list-edit"]='<div class="window-list-edit">\n        <div class="con">\n            \x3c!--<div class="header"></div>--\x3e\n            <div class="middle-graphics"></div>\n            <div class="labels"></div>\n            <div class="all-options"></div>\n            <div class="buttons"></div>\n        </div>\n    </div>',i["window-list-option"]='<div class="window-list-option">\n        <div class="txt-wrapper"><div class="text"></div></div>\n        <div class="control-wrapper"><div class="control"></div></div>\n    </div>',i["window-list-color-pick"]='<div class="window-list-color-pick">\n        <div class="choose-color-wrapper">\n            \x3c!--<div class="open-palette"></div>--\x3e\n            \x3c!--<div class="back-color"></div>--\x3e\n        </div>\n        \x3c!--<div class="pick-color"></div>--\x3e\n    </div>',i["loot-preview"]='<div class="loot-preview">\n        <div class="open-item-header"></div>\n        <div class="item-container"></div>\n        <div class="items-txt"></div>\n        <div class="scroll-wrapper">\n            <div class="scroll-pane"></div>\n        </div>\n    </div>',i["loot-preview-one-item"]='<div class="loot-preview-one-item tw-list-item">\n        <div class="item-wrapper"></div>\n        <div class="name-wrapper"></div>\n        <div class="amount-wrapper"></div>\n    </div>',i["recipe-preview-content"]='<div class="recipe-preview-content">\n        <div class="content-txt"></div>\n        <div class="content-list"></div>\n        <div class="reagents-txt"></div>\n        <div class="reagents-list"></div>\n    </div>',i["ans-game"]='<div class="ans-game">\n        <div class="info" data-trans="#ans_game_new#battle"></div>\n        <div class="runs"></div>\n    </div>',i.unit='<div class="unit"></div>',i["ans-black-layer"]='<div class="ans-black-layer"></div>',i["show-eq"]='<div class="show-eq">\n        <div class="info-icon"></div>\n        <div class="show-eq-bck">\n            <div class="player-info"></div>\n            <div class="table-wrapper">\n                <div class="left-side">\n                    <div class="prof-image"></div>\n                </div>\n                <div class="right-side">\n                    <div class="other-items-wrapper">\n                        <div class="other-items">\n                            <div class="other-eq-slot st-10"></div>\n                            <div class="other-eq-slot st-1"></div>\n                            <div class="other-eq-slot st-2"></div>\n                            <div class="other-eq-slot st-3"></div>\n                            <div class="other-eq-slot st-4"></div>\n                            <div class="other-eq-slot st-5"></div>\n                            <div class="other-eq-slot st-6"></div>\n                            <div class="other-eq-slot st-7"></div>\n                            <div class="other-eq-slot st-8"></div>\n                            <div class="other-eq-slot st-9"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',i["conquer-stats"]='<div class="conquer-stats">\n        \x3c!--<div class="header-wrapper">--\x3e\n        \x3c!--<div class="graphic"></div>--\x3e\n        \x3c!--<div class="edit-header-label"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div class="middle-graphics"></div>\n        <div class="search-wrapper conquer-stats-search">\n            <input class="search" data-trans="placeholder#search" />\n            <div class="search-x" data-trans="data-tip#delete"></div>\n        </div>\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="conquer-stats-items"></div>\n            </div>\n        </div>\n    </div>',i["conquer-stat-one"]='<div class="conquer-stat-one">\n        <div class="map-name"></div>\n        <div class="flex">\n            <div class="rep-percent"></div>\n            <div class="pb-fifty">\n                <div class="pb-fifty__one pb-fifty__one--left">\n                    <div class="progress"></div>\n                </div>\n                <div class="pb-fifty__one pb-fifty__one--right">\n                    <div class="progress"></div>\n                </div>\n            </div>\n        </div>\n    </div>',i["item-details"]='\n    <div class="item-details">\n        <div class="item-details__slot"></div>\n        <div class="item-details__rows"></div>\n    </div>',i["item-details-row"]='\n    <div class="item-details__row row">\n        <div class="col col--f-width">\n            <div class="item-details__content"></div>\n        </div>\n        <div class="col">\n            <div class="item-details__copy-btn"></div>\n        </div>\n    </div>',i["item-details-special-row"]='\n    <div class="row align-items-center justify-content-between">\n        <div class="col">\n            <div class="item-details__txt"></div>\n        </div>\n        <div class="col d-flex align-items-center">\n            <div class="item-details__val"></div>\n            <div class="item-details__ico"></div>\n        </div>\n    </div>',i["chat-input-wrapper"]='\n    <div class="chat-input-wrapper">\n        <div class="control-wrapper">\n            <div class="menu-card">\n                <div class="card-name"></div>\n                <div class="card-remove close-button"></div>\n                <div class="card-list"></div>\n            </div>\n            <div class="private-nick"></div>\n            <div class="style-message"></div>\n            <div class="chat-notification-wrapper"></div>\n            <div class="chat-info-wrapper">\n                <div class="info-icon" data-trans="data-tip#info_tip#chat_lang"></div>\n            </div>\n            <div class="chat-config-wrapper"></div>\n        </div>\n        <div class="magic-input-wrapper">\n            <div class="type-mobile-message" data-trans="#chat_placeholder#chat_lang"></div>\n        </div>\n    </div>',i["chat-notification-wrapper"]='\n    <div class="chat-notification-wrapper">\n\n    </div>',i["chat-message-wrapper"]='\n    <div class="scroll-wrapper chat-message-wrapper">\n        <div class="scroll-pane"></div>\n    </div>',i["chat-channel-card"]='\n    <div class="chat-channel-card">\n        <div class="chat-channel-card-icon"></div>\n        <div class="chat-channel-not-read-counter"></div>\n    </div>',i["chat-channel-card-wrapper"]='\n    <div class="chat-channel-card-wrapper">\n\n    </div>',i["new-chat-window"]='\n    <div class="new-chat-window">\n        <div class="chat-channel-card-wrapper"></div>\n        <div class="chat-message-wrapper"></div>\n        <div class="chat-input-wrapper"></div>\n    </div>\n',i["chat-configure-window"]='\n    <div class="chat-configure-window">\n        <div class="scroll-wrapper classic-bar">\n            <div class="scroll-pane">\n                <div class="middle-graphic"></div>\n                <div class="chat-option-header mt-2" data-trans="#notifications#chat_lang"></div>\n                <div class="notification-text" data-trans="#notifications_on_global_chat#chat_lang"></div>\n                <div class="notification-configuration"></div>\n                <div class="chat-option-header" data-trans="#formatting#chat_lang"></div>\n                <div class="color-configuration"></div>\n                <div class="default-colors-wrapper"></div>\n                <div class="time-configuration"></div>\n                <div class="tag-configuration"></div>\n                <div class="emo-configuration"></div>\n                <div class="enemy-msg-configuration" data-serveroption="28"></div>\n                <div class="get-legendary-item-clan-notification" data-serveroption="29"></div>\n            </div>\n        </div>\n    </div>\n',i["new-chat-message"]='\n    <div class="new-chat-message">\n        <span class="information-part">\n            <span class="ts-section"></span>\n            <span class="channel-section"></span>\n            <span class="author-section"></span>\n            <span class="receiver-arrow-section">-></span>\n            <span class="receiver-section"></span>\n        </span>\n        <span class="message-part">\n            <span class="message-section"></span>\n        </span>\n\n    </div>\n',i["copy-btn"]='<div class="copy-btn"></div>',t.exports=i},function(t,e){var i=[],n=null;const a=__translations;function s(){i=[]}function r(t){return"%"==t[0]&&"%"==t[t.length-1]}function o(t){let e=t.substring(0,t.length-1);return e=e.substring(1),e}function l(t,e,i){for(let n in i){let a=i[n].split(":"),s=i[n],r=a[0],o=null,l=null;if(0!=a.length)if(1!=a.length){if(a.length>2){let t=[];r=a[0]+"%";for(let e=1;e<a.length;e++)t.push(a[e]);let e=t.join(":"),i=new RegExp("\\(\\{(.*?)\\}\\)%","g"),n=e.match(i);if(n){let t=n[0];l=e.replace(t,""),t=t.slice(1),t=t.replace(")%",""),o=t}}2==a.length&&(r=a[0]+"%",l=a[1].slice(0,-1)),c(e,s,r,l,o)}else c(e,s,r,l,o);else errorReport("Translations","manageOneAttrData","split error",t)}}function c(t,e,i,n,a){t[i]||(t[i]=[]),t[i].push({fullStr:e,strAttr:i,modify:n,jsonFromFunc:a})}function d(t,e,i){switch(e){case"GET_LEFT":return getSecondLeft(t,{short:!0});case"GET_CURRENCY":return h(t,t=>{let e=t.split("=");if(2!=e.length)return errorReport("Translations.js","getCurrency","Incorrect currency data",t),"";let i=e[0];return e[1]+" "+function(t){switch(t){case"z":return _t("cost_gold");case"s":return _t("sl");default:return errorReport("Translations.js","getCurrencyTextByChar","Currency not exist",t),""}}(i)});case"GET_JSON_SWITCH":return function(t,e){let i;try{i=JSON.parse(e)}catch(t){return errorReport("Translations.js","getJsonSwitch","Incorrect JSON format!",e),"ERROR"}if(!isset(i[t]))return errorReport("Translations.js","getJsonSwitch","switch option "+t+" not exist",i),"ERROR";return i[t]}(t,i);case"ARRAY_PARAM":return h(t)}return errorReport("Translations","getNewValAfterModify","Unregistered translations modify:",e),t}function h(t,e){let i=t.split(";");if(1==i.length)return e?e(t):t;let n="";for(let t in i){let a=i[t];n+=e?e(a):a,n+=parseInt(t)+1==i.length-1?" i ":", "}return n.substring(0,n.length-2),n.substring(0,n.length-2)}window.getTranslationsWithParameters=function(t,e,i){let n=function(t,e){let i={};for(let n in e){if(!r(n))return errorReport("Translations.js","createTranslationsAttrData","Translations parameter name is incorrect!",n),i;let e=o(n),a=new RegExp("%"+e+"(.*?)%","g"),s=t.match(a);l(t,i,s)}return i}(t,e);for(let a in e){let s,r,o=n[a];if(o)for(let n=0;n<o.length;n++){let l=o[n];if(l&&l.modify){let t=l.fullStr,i=l.modify,n=l.jsonFromFunc;s=d(e[a],i,n),r=t}else s=e[a],r=a;t=i?t.replace(new RegExp(r,"g"),'<span class="damage">'+s+"</span>"):t.replaceAll(r,s)}}return t},window._t=function(t,e,r){var o=a,l=isset(r)?r:"default";if(isset(o[l])&&isset(o[l][t])){var c=o[l][t];return isset(e)&&(c=getTranslationsWithParameters(c,e)),c}for(var d=!1,h=0;h<i.length;h++)if(i[h].m==t&&l==i[h].c){d=!0;break}d||(i.push({m:t,c:l}),clearTimeout(n),n=setTimeout((function(){s()}),500))},window._t2=function(t,e,r){var o=a,l=isset(r)?r:"default";if(isset(o[l])&&isset(o[l][t])){var c=o[l][t];return isset(e)&&(c=getTranslationsWithParameters(c,e,!0)),c}for(var d=!1,h=0;h<i.length;h++)if(i[h].m==t&&l==i[h].c){d=!0;break}d||(i.push({m:t,c:l}),clearTimeout(n),n=setTimeout((function(){s()}),500))}},function(t,e,i){let n=i(1),a=i(15);t.exports=new function(t){var e=this;this.counter=0,this.target=null,this.tipBindToCanvas=!1,this.$tip=null,this.$eqTip=null,this.leftSideEqTip=!1,this.mousePos=null,this.vert=!1,this.timeout=null,this.allTips={},window.TIPS=e,$.fn.extend({getTipData:function(){let t=$(this).attr("tip-id");return e.allTips[t]},tip:function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var s=$(this);let r=s.attr("tip-id");if(t)if(!isset(r)||a.forceNewId)r=e.getId(),e.allTips[r]=t,s.attr("tip-id",r).trigger("tipupdate"),s.attr("data-tip-type",isset(i)?i:null),s.attr("data-item-type",isset(n)?n:null);else{if(e.allTips[r]==t)return this;e.allTips[r]=t,s.attr("tip-id",r).trigger("tipupdate")}else e.allTips[r]&&delete e.allTips[r],s.removeAttr("tip-id"),s.removeAttr("data-tip-type"),s.removeAttr("data-item-type");return $.isEmptyObject(a)?s.data("params",""):s.data("params",a),this},concatTip:function(t){let i=$(this).attr("tip-id");var n=e.allTips[i];e.allTips[i]=n+"<br>"+t},changeInTip:function(t,i){let n=$(this).attr("tip-id");var a=e.allTips[n],s=$("<div/>").html(a);s.find(t).length>0&&(s.find(t).html(i),e.allTips[n]=s.html())},checkAndRemoveEqTip:function(){var t=e.checkCanShowEqTip();e.removeEqTip(t)},tipShow:function(t,i){this.checkAndRemoveEqTip(),e._in(t,i),Engine.hero.d.opt&&Engine.opt(25)||e.showEqTip()},tipHide:function(t){e._out(t),Engine.opt(25)||this.checkAndRemoveEqTip()}}),this._in=function(t,i){i&&i.canvasObjectType==n.M_ITEM?(this.target=i.$,this.tipBindToCanvas=!0):(this.target=$(t.currentTarget),this.tipBindToCanvas=!1,this.target.bind("destroyed",(function(){e._out()}))),this._update(t),t.stopPropagation()},this._out=function(t){if(this.target){var i=e.checkCanShowEqTip(),n=this.target;this.target=null,this.removeEqTip(i),this.counter=0,this.$tip&&(this.$tip.detach(),(n.hasClass("item")||n.hasClass("linked-chat-item"))&&this.removeItemFromViews(n))}},this._move=function(t){null===this.$tip&&this._in(t),this.updateMainItemTipPosition(t)},this.updateMainItemTipPosition=function(t){var e=this.getPosition(t);this.$tip.css({top:e[1],left:e[0]})},this._update=function(t){if(null!==this.target){var i=this.target.data("params");this.$tip.attr("data-type",""),this.$tip.attr("data-tip-type",""),this.$tip.attr("data-item-type",""),this.$tip.attr("data-item-type",this.target.attr("data-item-type")),this.$tip.attr("data-type",this.target.attr("data-tip-type")),this.contentUpdate(),this.$tip.css("box-shadow",""),i&&i.borderColor&&this.$tip.css("box-shadow",this.border(i.borderColor));var n=e.checkCanShowEqTip();this.removeEqTip(n),$("body").append(this.$tip),this._move(t),this._eqTipMove(t,!0)}},this.contentUpdate=function(){const t=this.tipBindToCanvas?Engine.interface.get$GAME_CANVAS().attr("tip-id"):this.target.attr("tip-id"),e=this.parseTip(this.allTips[t]);this.$tip.find(".content").html(e),this.target&&(this.target.hasClass("item")||this.target.hasClass("linked-chat-item"))&&this.addItemToView(!1,this.target,this.$tip)},this.addItemToView=function(t,e,i){var n=t||e.data().item;if(n){var a,s=n.id;a=n.isItem()?Engine.items.createViewIcon(s,Engine.itemsViewData.TIP_ITEM_VIEW)[0]:Engine.tpls.createViewIcon(s,Engine.itemsViewData.TIP_TPL_ITEM_VIEW,n.loc)[0],i.find(".item-head").prepend(a)}},this.removeItemFromViews=function(t,e){var i=e||t.data().item;i&&(i.isItem()?Engine.items.deleteViewIconIfExist(i.id,Engine.itemsViewData.TIP_ITEM_VIEW):Engine.tpls.deleteViewIconIfExist(i.id,Engine.itemsViewData.TIP_TPL_ITEM_VIEW,i.loc))},this.parseTip=function(t){var e=new RegExp("#tdiff:([0-9]+?)#");if(e.test(t)){var i=e.exec(t);t=t.replace(e,calculateDiff(parseInt(i[1]),unix_time()))}return t},this.getPosition=function(t,e){const i=this.$tip.width()+14,n=this.findMaxHeight(),a=this.$tip.height()+14,s=Engine.zoomFactor,r=$(window).width()/s,o=$(window).height()/s;let l=0;e?l=i+6:this.leftSideEqTip=!1;var c=[t.clientX+20+l+10,t.clientY],d=c;function h(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e[0]=i?t.clientX+20+10:t.clientX-l-10,e[1]=t.clientY-n-6-10-3,e[1]<50&&(e[1]=t.clientY+a+40),e}if(e&&(this.vert=!1),c[0]+i>r&&(d[0]=t.clientX-6-i-10-l,e||(this.leftSideEqTip=!0),e&&!this.leftSideEqTip?(d[0]=t.clientX-l-10,e&&this.isTipOffCanvasHor(d,10)&&(d=h(d),this.vert=!0)):e&&this.isTipOffCanvasHor(d,10)&&(d=h(d,!1),this.vert=!0)),!this.vert&&c[1]+n>o-10){var u=t.clientY-n-10;d[1]=u<0?44:u}return d},this.isTipOffCanvasHor=(t,e)=>t[0]<e,this.findMaxHeight=function(){var t=this.$tip.height();if(this.$eqTip){var e=this.$eqTip.height();return Math.max(t,e)}return this.$tip.height()},this.initPosEqTip=function(){var t=this.getKeyDownPos(),e={clientX:t[0],clientY:t[1]},i=this.getPosition(e,!0);this.$eqTip.css({top:i[1],left:i[0]})},this.getKeyDownPos=function(){var t=this.$tip.position(),e=Engine.zoomFactor,i=t.left/e-25;return this.leftSideEqTip&&(i+=55+this.$tip.width()),[i,t.top/e]},this.showEqTip=function(){if(this.target&&(!this.target||this.target.attr("data-cl"))&&!this.$eqTip){var t=this.checkCanShowEqTip();if(t){t.on("delete",(function(){e.removeEqTip(t)}));var i=this.target.data("item");if(i){var n=i.parseStats(),a=t.getTipContent(n);this.createEqTip(a,t),this.initPosEqTip()}}}},this.checkCanShowEqTip=function(){if(!this.target)return!1;var t=Engine.heroEquipment.getEqItems(),e=this.target.data("cl"),i=[[a.CL.ORB_WEAPON,a.CL.SHIELD]];for(const n of i)if($.inArray(e,n)>=0)for(let e=0;e<n.length;e++)if(t[n[e]])return t[n[e]];return t[e]},this.createEqTip=function(t,e){var i=e.itemType,n=this.parseTip(t);this.$eqTip=this.getTemplateTipWrapper("cmp-tip"),this.$eqTip.attr("data-type","t_item"),4096&Engine.hero.d.opt||this.$eqTip.attr("data-item-type",i),this.$tip.css("display","block"),this.$eqTip.find(".content").html(n),this.addItemToView(e,!1,this.$eqTip),this.appendEqTip(),this.addLabelEqTip()},this.addLabelEqTip=function(){var t=this.getTemplateTipWrapper("tip-wrapper");this.$eqTip.append(t),t.find(".content").html(_t("own",null,"item")),t.addClass("own")},this.appendEqTip=function(){this.$eqTip&&$("body").append(this.$eqTip)},this.removeEqTip=function(t){t&&this.$eqTip&&(e.removeItemFromViews(t.$),this.$eqTip.remove(),this.$eqTip=null)},this._eqTipMove=function(t){if(this.$eqTip){var e=this.getPosition(t,!0);this.$eqTip.css({top:e[1],left:e[0]})}},this.getId=()=>{let t=0;for(;this.allTips[t];)t++;return t},this.border=function(t){return"0px 0px 0px 0px #2b282a, 0px 0px 0px 1px #353131, 0px 0px 0px 2px #191311, 0px 0px 0px 3px #2b2727, 0px 0px 0px 4px #59595a, 0px 0px 0px 5px "+t+", 0px 0px 0px 6px #5a585b, 0px 0px 0px 7px #2c2625"};const i=mobileCheck()?"touchstart touchend":"mouseenter mouseleave";$(document).on(i+" pointermove tipupdate","[tip-id]",(function(t){var i=Engine.zoomFactor;switch("tipupdate"!==t.type&&"touchend"!==t.type&&(t.clientX=isNaN(t.clientX)?t.touches[0].clientX/i:t.clientX/i,t.clientY=isNaN(t.clientY)?t.touches[0].clientY/i:t.clientY/i),t.type){case"touchstart":case"mouseenter":if(e._in(t),Engine.hero.d.opt&&Engine.opt(25))break;e.showEqTip();break;case"touchend":case"mouseleave":var n=e.checkCanShowEqTip();if(e._out(t),Engine.opt(25))break;e.removeEqTip(n);break;case"pointermove":e.mousePos=[t.clientX,t.clientY],e._move(t),e._eqTipMove(t);break;case"tipupdate":e.$eqTip?e.target?e.contentUpdate():console.warn("TIP CAN CRASH!"):e._update(t)}})).on("keydown keyup",(function(t){if(Engine&&Engine.hero&&Engine.hero.d&&Engine.hero.d.hasOwnProperty("opt")&&Engine.opt(25))switch(t.type){case"keyup":if(!t.ctrlKey){var i=e.checkCanShowEqTip();e.removeEqTip(i)}break;case"keydown":t.ctrlKey&&e.showEqTip()}})),this.checkTipExist=()=>!!this.$tip,this.checkTipHasClass=t=>!!this.$tip&&!!this.$tip.find("."+t).length,this.getTemplateTipWrapper=t=>$('<div class="tip-wrapper '+t+'"><div class="content"></div></div>'),e.$tip=this.getTemplateTipWrapper("normal-tip"),$.event.special.destroyed={remove:function(t){t.handler&&t.handler()}}}},function(t,e){window.blockRemoveMobileMenu=!1;function i(){return(new Date).getTime()}function n(t,e){if(t.hasClass("clickable"))return!0;if(t.hasClass("click-area"))return!0;if(!t.hasClass("ui-draggable"))return!1;if(!t.hasClass("item"))return!1;var i=$._data(t[0],"events");return i&&i[e]}if(mobileCheck()){var a=null,s=null,r=null;$(document).on("mousedown",(function(t){r=i(),a=setTimeout((function(){s=null;var e=$(t.target);n(e,"contextmenu")&&e.trigger("contextmenu",t),blockRemoveMobileMenu=!0}),200)})),$(document).on("mousemove",(function(t){null==s&&(s=t.clientX),a&&(t.clientX>s+6||t.clientX<s-6)&&(clearTimeout(a),a=null,s=null)})),$(document).on("mouseup",(function(t){if(a){var e=i(),o=r+200>e,l=$(t.target);n(l,"click")&&o&&l.trigger("click",t),r=null,clearTimeout(a),a=null,setTimeout((function(){blockRemoveMobileMenu=!1,s=null}),10)}}))}},function(t,e,i){var n=i(0);t.exports=new function(){$.fn.createMenu=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s={fileName:"CreateMenuScroll.js"},r=$(this);e=e||!1;const o="ADD_NEW_ITEM",l="menu-item-id",c={capitalize:!0,parseHTML:!0},d=$.extend({},c,a);let h=[],u=null,p=null,g=null,f=!1,m=null,v=null,E=null,_=null,b=null,w=null,C=null;function T(){if(!r.hasClass("menu")||!$.isArray(t))return errorReport(s.fileName,"checkCorrectMenuData","menu data incorrect",t),!1;let e=a.addNewOption;return!(e&&!y(e))}function y(t){const e=s.fileName,i="checkCorrectAddNewOptionData";let n=t.addItemConfirmText,a=t.removeItemConfirmText,r=t.addItemConfirmClb,o=t.removeItemConfirmClb;if(!n)return errorReport(e,i,"attr addItemConfirmText not exist",t),!1;if(!a)return errorReport(e,i,"attr removeItemConfirmText not exist",t),!1;if("function"!=typeof a)return errorReport(e,i,"attr removeItemConfirmText is not function",t),!1;if(!r)return errorReport(e,i,"attr addItemConfirmClb not exist",t),!1;if("function"!=typeof r)return errorReport(e,i,"attr addItemConfirmClb is not function",t),!1;if(!o)return errorReport(e,i,"attr removeItemConfirmClb not exist",t),!1;if("function"!=typeof o)return errorReport(e,i,"attr removeItemConfirmClb is not function",t),!1;let l=t.menuToAddAndRemove;if(!l)return errorReport(e,i,"attr menuToAddAndRemove not exist",t),!1;for(let n in l)if(!isset(l[n].id))return errorReport(e,i,"in element of menuToAddAndRemove not exist id attr",t),!1;return!0}function I(){for(var i in g=Engine.interface.get$gameWindowPositioner().find(".mAlert-layer"),a.addNewOption&&A(),t){let e=O(t[i]);h.push(e)}r.addClass("menu-list"),C=$("<div>").addClass("bck button small green no-hover"),C.append($("<span>").addClass("menu-option")),r.append(C),w=n.get("dropdown-menu"),r.append(w),b=r.find(".menu-arrow"),_=w,E=r.find(".menu-wrapper"),v=r.find(".wrapper"),d.capitalize||E.addClass("menu-wrapper--no-capitalize"),v.append($("<div>").addClass("bck-wrapper").html(h)),E.css({display:"none",width:r.outerWidth()-8}),E.addScrollBar({track:!0}),E.on("mousewheel DOMMouseScroll",L),m=E.find(".scrollbar-wrapper"),m.on("mousedown",L),e&&(F(h[0][0]),ct()),r.off(),r.on("click",()=>{M()}),r.find(".reset").on("click",t=>{t.stopPropagation(),ht()}),r.find(".option").hover((function(){null!==p&&p.removeClass("selected")})),gt()}function A(){let e=a.addNewOption,i=e.menuToAddAndRemove,n=e.configAddItemIdAndName?e.configAddItemIdAndName:{};for(var s in i){let e=i[s];e.text=Y(n,e.text,e.id),e.remove=J(),t.push(i[s])}let r={text:"+",disableSelected:!0,val:o};e.addTipText&&(r.tip=e.addTipText),t.push(r)}function k(t){return isset(t.txt)?!!isset(t.clb)||(errorReport("CreateMenuScroll.js","checkRemoveDataIsCorrect","Remove data incorrect! attr clb undefined!",t),!1):(errorReport("CreateMenuScroll.js","checkRemoveDataIsCorrect","Remove data incorrect! attr txt undefined!",t),!1)}function S(t,e){let i=$("<div>").addClass("remove-wrapper"),n=$("<div>").addClass("remove");n.tip(e.remove.txt),i.append(n),n.on("mousedown",t=>{t.stopPropagation(),ht(),N(),e.remove.clb(e)}),t.append(i),t.addClass("option-with-remove")}function O(t){let e=$("<div/>"),i=$("<div/>");return e.append(i),i.addClass("text"),e.addClass("option"),e.attr("value",null==t.val?"":t.val),d.parseHTML?i.html(t.text):i.text(t.text),isset(t.id)&&e.attr(l,t.id),isset(t.selectedText)&&e.attr("selectedText",t.selectedText),isset(t.disableSelected)&&e.attr("disableSelected",!0),isset(t.blockClick)&&e.attr("blockClick",!0),isset(t.tip)&&e.tip(t.tip),isset(t.remove)&&k(t.remove)&&S(e,t),e}function M(){f||(f=!0,b.addClass("close-menu"),E.detach(),E.appendTo(g),E.show(),nt(),E.hide(),E.slideDown({duration:"fast",start:function(){m.trigger("update"),null!==p&&(p.addClass("selected"),m.trigger("setScroll",[p[0].offsetTop-3])),$(r).on("close",R),$(window).on("mousedown",(function(t){H(t.target)||N()})),$(window).on("mousewheel",R),$(window).on("resize",nt)},complete:nt}))}function N(t){at(),E.slideUp("fast",(function(){f=!1,E.detach(),_.append(E),b.removeClass("close-menu")}))}function R(t){at(),E.hide(),f=!1,E.detach(),_.append(E),b.removeClass("close-menu")}function x(t){p=t;let e=r.find(".menu-option"),i=t.attr("selectedText"),n=i||t.find(".text").html();W(),e.html(n),e.attr("value",t.attr("value"))}function L(t){t.stopPropagation()}function D(t){if(!H(t.target))return;L(t);let e=G(t.target);if(B(e)){if(!P(e)){let t=q($(e));return N(),void K(t)}F(e),console.log(e),V(t)}}function P(t){return!$(t).attr("disableSelected")}function B(t){return!$(t).attr("blockClick")}function F(t){u=t}function W(){h[0].attr("value")==p.attr("value")?(st(),lt()):(rt(),ot())}function H(t){let e=$(t);return!!e.hasClass("option")||e.closest(".option").length>0}function G(t){let e=$(t);return e.hasClass("option")?e[0]:e.closest(".option").length>0?e.closest(".option")[0]:(errorReport("CreateMenuScroll.js","getOptionFromTarget","Incorrect target",t),null)}function V(t){if(!H(t.target))return;let e=G(t.target);u==e&&U(e)}function U(t){let e=j();x($(t)),N(),K(e)}function j(){return q($(u))}function q(t){return t.attr("value")}function K(t){if(i&&"function"==typeof i){if(t==o)return void z();i(t)}}function Y(t,e,i){let n;if(t.nameFromInputVal)n=e;else{let e=t.namePrefix,a=i-(t.showFirstPossibleIdUserFriendly?t.firstPossibleId-1:0);n=(isset(e)?e:"")+a}return n}function z(){let e=a.addNewOption;confirmWitchTextInput(e.addItemConfirmText,i=>{if(e.addItemConfirmValidate&&!e.addItemConfirmValidate(i))return;let n=e.configAddItemIdAndName?e.configAddItemIdAndName:{},a=e.menuToAddAndRemove,s=n.firstPossibleId;s=isset(s)?s:0;let r=getFreeIdOfArray(a,s),o=Y(n,i,r),l={text:o,tip:i,val:r,id:r,remove:J()},c=O(l);if(t.splice(t.length-1,0,l),h.splice(h.length-1,0,c),e.menuToAddAndRemove.push({text:o,val:r,tip:i,id:r}),ft(c[0]),e.addItemConfirmClb){let t={val:i,id:r,newItemText:o};e.addItemConfirmClb(t)}X(c,r),e.autoSelect&&(F(c),U(c))},300)}function X(t,e){let i=!1,n=v.find(".bck-wrapper").find(".option").last();e=parseInt(e),v.find(".option-with-remove").each((function(){let n=$(this).attr(l);parseInt(n)>e&&!i&&(i=!0,t.insertBefore($(this)))})),i||t.insertBefore(n)}function Q(t){v.find(".bck-wrapper").find(".option-with-remove").each((function(){let e=$(this);e.attr(l)==t&&e.remove()}))}function J(){return{txt:_t("delete"),clb:Z}}function Z(t){let e=a.addNewOption;confirmWithCallback({msg:e.removeItemConfirmText(t.text),clb:()=>{tt(t.id),et(t.id),it(t.id),Q(t.id),e.removeItemConfirmClb(t)}})}function tt(t){for(let e in h){let i=h[e];if(i.hasClass("option-with-remove")&&i.attr(l)==t)return void removeFromArray(h,i)}}function et(e){for(let i in t){let n=t[i];if(n.id==e)return void removeFromArray(t,n)}}function it(t){let e=a.addNewOption.menuToAddAndRemove;for(let i in e){let n=e[i];if(n.id==t)return void removeFromArray(e,n)}}function nt(){var t=r.outerWidth()-8;E.css({width:t});var e=r.offset();e.left+=5;var i=v.find(".bck-wrapper").outerHeight(),n=v.outerHeight(),a=e.top+(i>n?n:i),s=27;a+s>$(window).height()&&(e.top-=a-$(window).height(),s=-6),t>$(window).width()&&(e.left-=t-$(window).width()),E.css({top:e.top>0?e.top/Engine.zoomFactor+s:0,left:e.left>0?e.left/Engine.zoomFactor-3:0})}function at(){$(window).off("mousedown",N),$(window).off("mousewheel",R),$(window).off("resize",nt)}function st(){r.find(".arrow").css("display","block")}function rt(){r.find(".arrow").css("display","none")}function ot(){r.find(".reset").css("display","block")}function lt(){r.find(".reset").css("display","none")}function ct(){x(h[0])}function dt(){let t=h.length-1;x(h[t])}function ht(){ct(),F(h[0][0]),K(j())}function ut(t){for(let e in h){if(t==q(h[e]))return x(h[e]),void F(h[e][0])}errorReport("CreateMenuScroll","setOptionWithoutCallbackByValue",`Value ${t} not exist!`)}function pt(){let t=q($(r).find(".menu-option"));return null==t?null:t}function gt(){r.find(".option").each((function(){ft(this)}))}function ft(t){t.addEventListener("click",t=>{D(t)})}this.getValue=pt,this.setFirst=ct,this.setOptionWithoutCallbackByValue=ut,this.setLast=dt,T()&&I()}}},function(t,e,i){i(0);t.exports=new function(){var t=this;$.fn.createDivideButton=function(e,i,n,a){$(this).addClass("divide-button input-val-"+i);for(var s=lengthObject(e),r=100/s,o=0;o<s;o++){var l=e[o],c=t.getBckClass(o,s,n),d=$("<div>").addClass("option button small "+c),h=$("<div>").html(l.text).addClass("label");d.attr("value",l.val),d.append(h),$(this).append(d),d.css("width",r+"%"),d.click((function(){if($(this).siblings(".option").removeClass("active"),$(this).addClass("active"),a){var t=$(this).attr("value");a(t)}}))}},this.getBckClass=function(t,e,i){return 0==t?"left "+(i?"active":""):e==t+1?"right":"middle"}}},function(t,e,i){var n=i(0);t.exports=new function(){$.fn.addScrollBar=function(t){var e=this,i=$(".scroll-pane",this),a=!1,s=!0,r=null,o=null,l=null,c=null,d=t.wheelSpeed?t.wheelSpeed:20,h=(!!t.addScrollableClassToAnotherEl&&t.addScrollableClassToAnotherEl,function(t,e){const n=i[0];var a=n.scrollTop+(t?-e:e),s=n.scrollHeight-n.clientHeight;a>s&&(a=s),a<0&&(a=0);var r=a/s;f(r),v(r)}),u=function(){$(".handle",r).draggable({axis:"y",scroll:!1,start:function(){s=!1},drag:function(t,e){if(s)return!1;var i=e.position.top/(r.height()-$(this).height());i<0&&(i=0),i>1&&(i=1),e.position.top<0&&(e.position.top=0);var n=e.helper.parent().height()-45;e.position.top>n&&(e.position.top=n),v(i)},stop:function(){s=!0}})},p=function(){var t=i.scrollTop(),e=i[0].scrollHeight-i.height();t>e&&(t=e),t<0&&(t=0);var n=t/e;f(n),v(n)},g=function(){i[0].scrollHeight-i.height()>1?($(e).addClass("scrollable"),t.addScrollableClassToAnotherEl&&t.addScrollableClassToAnotherEl.addClass("scrollable")):($(e).removeClass("scrollable"),t.addScrollableClassToAnotherEl&&t.addScrollableClassToAnotherEl.removeClass("scrollable")),a&&v(1)},f=function(e){const i=r[0],n=$(".handle",r)[0];if(!t.track)return;const a=Math.round((i.clientHeight-n.clientHeight)*e);n.style.top=a+"px"},m=!0,v=function(e){const n=i[0];n.scrollTop=Math.round((n.scrollHeight-n.clientHeight)*e),a=e>.99,f(e),a&&void 0!==t.callback&&m?(t.callback(),m=!1):1!=a&&(m=!0)},E=function(){l&&(clearTimeout(l),l=null),o&&(clearInterval(o),o=null)},_=function(t){$(e).find(t).mouseleave((function(){E()})).mouseup((function(){E()}))},b=function(t,i){$(e).find(t).mousedown((function(){h(i,20),l=setTimeout((function(){o=setInterval((function(){h(i,10)}),50)}),500)}))};return $(this).on("mousewheel DOMMouseScroll",(function(t){var e="undefined"!=typeof InstallTrigger?t.originalEvent.detail:t.originalEvent.deltaY;h(e<0,d)})).on("update",(function(){g(),p()})).on("scrollBottom",(function(){v(1)})).on("scrollTop",(function(){v(0)})).on("stopDragBar",(function(){s=!0})).on("updateBarPos",(function(){p()})).on("setScroll",(function(t,e){!function(t){var e=i[0].scrollHeight-i.height();t>e&&(t=e),t<0&&(t=0);var n=t/e;f(n),v(n)}(e)})).on("updateWhenBottom",(function(){var t=$(e).hasClass("scrollable");g(),p(),t?a&&v(1):v(1)})),mobileCheck()&&$(this).bind("touchstart",(function(t){c||(c=t.originalEvent.touches[0].clientY)})).bind("touchmove",(function(t){t.target.classList.contains("c-slider__input")||t.preventDefault();var e=t.originalEvent.touches[0].clientY,i=function(t){return t>c||!(t<c)&&void 0}(e),n=function(t){return Math.abs(c-t)}(e)/Engine.zoomFactor;h(i,n),c=e})).bind("touchend",(function(t){c=null})),t.track&&($(e).append(n.get("scrollbar-wrapper")),r=$(".scrollbar-wrapper .track",e),$(".scrollbar-wrapper",e).click((function(t){return t.stopPropagation(),!1})),u(),b(".arrow-up",!0),b(".arrow-down",!1),_(".arrow-up"),_(".arrow-down")),g(),this}}},function(t,e){$.ui.ddmanager.prepareOffsets=function(t,e){var i,n,a=$.ui.ddmanager.droppables[t.options.scope]||[],s=e?e.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();t:for(i=0;i<a.length;i++)if(!(a[i].options.disabled||t&&!a[i].accept.call(a[i].element[0],t.currentItem||t.element))){for(n=0;n<r.length;n++)if(r[n]===a[i].element[0]){a[i].proportions().height=0;continue t}a[i].visible="none"!==a[i].element.css("display"),a[i].visible&&("mousedown"===s&&a[i]._activate.call(a[i],e),a[i].offset=a[i].element.offset(),a[i].proportions({width:a[i].element[0].offsetWidth*Engine.zoomFactor,height:a[i].element[0].offsetHeight*Engine.zoomFactor}))}},$.Widget.prototype._trigger=function(t,e,i){var n,a,s=this.options[t];if(i=i||{},(e=$.Event(e)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),e.target=this.element[0],a=e.originalEvent)for(n in a)n in e||(e[n]=a[n]);if(isset(i.position)){var r="undefined"!=typeof Engine&&null!=Engine.zoomFactor?Engine.zoomFactor:1;if("sort"==t||"change"==t){var o=i.position.left-i.originalPosition.left,l=i.originalPosition.left+o/r-i.item.parent().offset().left,c=i.position.top/r;i.helper.css({left:l,top:c})}else i.position.top=Math.round(i.position.top/r),i.position.left=Math.round(i.position.left/r)}return this.element.trigger(e,i),!($.isFunction(s)&&!1===s.apply(this.element[0],[e].concat(i))||e.isDefaultPrevented())},$.extend($.ui.draggable.prototype.options,{cursor:`url(../img/gui/cursor/1n.png?v=${__build.version}), auto`})},function(t,e,i){API=i(90),window.Engine=new(i(158)),t.exports=new function(){this.stop=function(){Engine.stop()},$((function(){Engine.init()}))}},function(t,e,i){let n=i(159),a=i(91),s=i(160),r=i(161),o=i(162);var l=i(163),c=i(164);let d=i(165);var h=i(166),u=i(7),p=i(167),g=i(168),f=i(169),m=i(171),v=i(193),E=i(194),_=i(196),b=i(197),w=i(198),C=i(202),T=i(203),y=i(204),I=i(205),A=(i(206),i(207)),k=i(69),S=i(209);let O=i(212);var M=i(213),N=i(215),R=i(216),x=i(217),L=i(218),D=i(219),P=i(220),B=i(221),F=i(309),W=i(313),H=i(352),G=i(353),V=i(354),U=i(356),j=i(358),q=i(362),K=i(363),Y=i(364),z=i(366),X=i(368),Q=i(373),J=i(120),Z=(i(48),i(376)),tt=i(378),et=i(394),it=i(395),nt=i(396),at=i(397),st=i(398),rt=i(399),ot=i(400),lt=i(106),ct=i(401),dt=i(403),ht=i(404),ut=i(405),pt=i(406),gt=i(407),ft=i(425),mt=i(427),vt=(i(53),i(428)),Et=i(432),bt=i(433),wt=i(435),Ct=i(436),Tt=i(437),yt=i(438),It=i(439),At=i(440),kt=i(441),St=i(5),Ot=i(442);const{getStatsForTips:Mt}=i(71),Nt=i(447),Rt=i(451),xt=i(463),Lt=i(464),Dt=i(465);var Pt=i(466),Bt=i(468),Ft=i(471),Wt=i(472),$t=i(474),Ht=i(476),Gt=i(479);const Vt=i(115),Ut=i(481),jt=i(482),qt=i(487),Kt=i(491),Yt=i(492),zt=i(494),Xt=i(496),Qt=i(497),Jt=i(498),Zt=i(501),te=i(502),ee=i(504),ie=i(505),ne=i(507),ae=i(508),se=i(510),re=i(512),oe=i(514),le=i(515),ce=i(516),de=i(517),he=i(518),ue=i(522),pe=i(524),ge=i(527),fe=i(528),me=i(530),ve=i(531),Ee=i(532),_e=i(534),be=i(535),we=i(536),Ce=(i(11),i(553)),Te=i(554),ye=i(73),Ie=i(555),{isMobileApp:Ae}=i(2);t.exports=function(){var t,e,ke,Se,Oe=this,Me=!1,Ne=!1,Re=null,xe=!0,Le=0,De=0;this.mode=null,this.ev=null;var Pe=null;let Be,Fe=60,We=null,$e=null;this.initCanvasContext=()=>{t=this.interface.get$GAME_CANVAS()[0].getContext("2d")},this.initMapCanvasContext=()=>{e=this.interface.get$MAP_CANVAS()[0].getContext("2d")},this.init=function(){this.resetEvAndLastEv(),this.resolution=new Te,this.resolution.init(),this.ResolutionData=ye,this.browserCardManager=new x,this.browserCardManager.init(),this.requestCorrect=new c,this.requestCorrect.init(),this.worldConfig=new Ce,this.imgLoader=Gt,this.canvasCharacterWrapperManager=new pe,this.canvasCharacterWrapperManager.init(),this.imgLoader.init(),this.apiData=n,this.itemsFetchData=a,this.itemsViewData=s,this.itemsMovedData=r,this.itemsDisableData=o,this.rajController=new jt,this.rajController.init(),this.rajZoomManager=new f,this.rajZoomManager.init(),this.mapAreaCordTriggerManager=new E,this.mapAreaCordTriggerManager.init(),this.rajAreaTriggerManager=new Yt,this.rajAreaTriggerManager.init(),this.rajSoundManager=new zt,this.rajSoundManager.init(),this.rajMapMusicManager=new Xt,this.rajMapMusicManager.init(),this.rajSequenceManager=new qt,this.rajSequenceManager.init(),this.rajRandomCallerManager=new Kt,this.rajRandomCallerManager.init(),this.rajYellowMessage=new ve,this.rajYellowMessage.init(),this.rajCase=new te,this.rajCase.init(),this.rajEmoActions=new Qt,this.rajEmoActions.init(),this.screenEffectsManager=new Jt,this.screenEffectsManager.init(),this.rajEmoDefinitions=new Zt,this.rajEmoDefinitions.init(),this.rajProgrammer=new ie,this.rajProgrammer.init(),this.rajDialogue=new ee,this.rajDialogue.init(),this.rajExtraLight=new ne,this.rajExtraLight.init(),this.rajCamera=new oe,this.rajCamera.init(),this.rajTracking=new le,this.rajTracking.init(),this.zoomManager=new g,this.zoomManager.init(),this.rajCharacterHide=new ce,this.rajCharacterHide.init(),this.windowsData=Lt,this.widgetsData=Dt,this.windowCloseManager=new xt,this.windowCloseManager.init(),this.windowManager=new Pt,this.windowManager.init(),this.interface=new W,this.interface.init(),this.colorInterfaceNotificationManager=new A,this.colorInterfaceNotificationManager.init(),this.colorInterfaceNotificationManager.updateData({action:k.ACTION.CREATE,id:k.NAME.LOW_HEALTH,color:"#b71212"}),this.widgetManager=new H,this.widgetManager.init(),this.console=new l,this.console.init(),this.globalAddons=new d,this.globalAddons.init(),this.initCanvasContext(),this.mobile=getMobile(),Ae()&&je(30),this.themeController=new p,this.themeController.init(),this.serverStorage=new h,this.crossStorage=new Nt,this.crossStorage.init(),this.eventCollider=new rt,this.idleJSON=new L,this.loader=new P,this.lock=new R,this.canvasTip=new D,this.canvasTip.init(),this.stepsToSend=new N,this.renderer=new st,this.GA=new kt,this.setInterface(),this.communication=new B,this.businessCardManager=new Z,this.codeMessageManager=new F,this.codeMessageManager.init(),this.deadController=new Ut,CFG.webSocketVersion&&(this.webSocketConnect=!1,this.communication.initWebSocket()),this.soundManager=new ut,this.heroesRespManager=new j,this.heroesRespManager.init(),this.npcIconManager=new q,this.npcIconManager.init(),this.npcTplManager=new K,this.npcTplManager.init(),this.npcs=new Y,this.fakeNpcs=new z,this.fakeNpcs.init(),this.others=new X,this.wraithCharacterManager=new G,this.wraithObjectManager=new V,this.items=new et,this.items.init(),this.tpls=at,this.tpls.init(),this.chatLinkedItemsManager=new it,this.chatLinkedItemsManager.init(),lt.init(),this.emotions=new J,this.emotions.init(),this.firstLoadInit1=!0,this.firstLoadInit2=!0,this.firstLoadInit4=!0,St.checkToResetLocalStorage(),this.chatController=new tt,this.chatController.init(),this.overrideDayNightCycle=new Ft,this.overrideDayNightCycle.init(),this.nightController=new Bt,this.nightController.init(),this.dynamicLightsManager=new ae,this.dynamicLightsManager.init(),this.dynamicDirCharacterLightsManager=new se,this.dynamicDirCharacterLightsManager.init(),this.behaviorDynamicLightsManager=new re,this.behaviorDynamicLightsManager.init(),this.hero=new w,this.hero.init(),this.interfaceTimerManager=new Wt,this.interfaceTimerManager.init(),this.canvasMultiGlow=new C,this.canvasMultiGlow.init(),this.htmlMultiGlow=new T,this.htmlMultiGlow.init(),this.canvasFocus=new y,this.canvasFocus.init(),this.htmlFocus=new I,this.htmlFocus.init(),this.widgetNoticeManager=new O,this.widgetNoticeManager.init(),this.specificAnimationManager=new S,this.specificAnimationManager.init(),this.heroEquipment=new M,this.heroEquipment.init(),this.interfaceItems=new nt,this.interfaceItems.init(),this.mapShift=new _,this.mapShift.init(),this.earthQuakeManager=new b,this.earthQuakeManager.init(),this.map=new m,this.map.init(),this.mapGoMark=new v,this.mapGoMark.init(),this.tutorialManager=new Ot,this.tutorialManager.init(),this.tutorials=null,this.tutorialValue=null,this.miniMapController=new gt,this.miniMapController.init(),this.blockSendNextInit=null,this.targets=new U,this.weather=ct,this.weather.init(),this.mapFilter=new dt,this.mapFilter.init(),this.floatForegroundManager=new $t,this.floatForegroundManager.init(),this.floatObjectManager=new Ht,this.floatObjectManager.init(),this.reconnect=ot,this.whoIsHere=new Q,this.dialogue=!1,this.shop=!1,this.shopFilters=null,this.mails=!1,this.recoveryItems=!1,this.society=!1,this.trade=!1,this.codeProm=!1,this.depo=!1,this.eventCalendar=!1,this.adventCalendar=!1,this.book=!1,this.premium=!1,this.goldShop=!1,this.staminaShop=!1,this.draconiteShop=!1,this.quests=!1,this.roadDisplay=!1,this.allInit=null,this.bags=[[0,0,0],[0,0,0],[0,0,0],!1,!1,!1,[0,0]],this.setAts(0),this.lag=0,this.help=!1,this.bonusSelector=!1,this.hotKeys=new ht,this.hotKeys.init(),this.musicPanel=null,this.crafting=new Rt,this.crafting.init(),this.loggedPrice=null,this.addons=null,this.addonsPanel=null,this.banners=null,this.itemsMarkManager=new Tt,this.itemsMarkManager.init(),this.itemsMovedManager=new yt,this.itemsMovedManager.init(),this.greatMerchamp=!1,this.showEqManager=new ge,this.iframeWindowManager=new fe,this.changePlayer=null,this.changeOutfit=null,this.chooseOutfit=null,this.conquerStats=!1,this.catchChar=null,this.dead=!1,this.mcAddon=!1,this.smcAddon=!1,this.auctions=!1,this.worldWindow=new Vt.default,this.worldWindow.init(),this.interfaceStart=!1,this.reload=!1,this.zoomFactor=null,this.canEditWidget=!1,this.padController=!!mobileCheck()&&new pt,this.matchmaking=new ft,this.matchmaking.init(),this.matchmakingTutorial=new mt,this.matchmakingTutorial.init(),this.lootPreview=null,this.questsObserve=new At,this.questsObserve.init(),this.disableItemsManager=new It,this.disableItemsManager.init(),this.tickSuccess=!0,this.battlePass=null,this.showMiniature=!1,this.news=!1,this.tpScroll=!1,this.questTracking=new vt,this.questTracking.init(),this.stickyTips=new Et,this.stickyTips.init(),this.captcha=new bt,this.poll=new wt,this.rewardsCalendar=!1,this.rewardsCalendarActive=!1,this.battlePassActice=!1,this.warShadow=new Ct,this.initChanger=null,this.windowMaxZIndex=0,Ue(null),this.getStatsForTips=Mt,this.bonusReselectWindow=!1,this.itemDetailWindows=[],this.rajBattleEvents=new me,this.rajBattleEvents.init(),this.rajCharacterImageChangerManager=new Ee,this.rajCharacterImageChangerManager.init(),this.rajMapEvents=new _e,this.rajMapEvents.init(),this.rajWindowEvents=new be,this.rajWindowEvents.init(),this.battle=new we,this.battle.init(),this.characterEffectsManager=new de,this.characterEffectsMapManager=new he,this.characterEffectsBattleManager=new ue,this.characterEffectsManager.init(),this.characterEffectsMapManager.init(),this.characterEffectsBattleManager.init(),this.questMapBorderManager=new Ie,this.questMapBorderManager.init(),Engine.imgLoader.preLoadImages(),this.onClear(),CFG.webSocketVersion||this.reCallInitQueue(),this.setCTXScaleMode(3);var t=Engine.interface.get$gameWindowPositioner().find(".loader-layer .progress-bar .inner");setPercentProgressBar(t,0),this.initTickWorker();let e=document.createElement("script");e.type="text/javascript",e.innerHTML="\n\t\t\tconst ___ADD_FROM_SCRIPT_HEIGHT = document.documentElement.clientHeight\n\t\t\tconst ___ADD_FROM_SCRIPT_TIME = new Date().getTime()\n\t\t",document.documentElement.appendChild(e),He()},this.setAts=t=>{this.ats=t},this.getAts=()=>this.ats;const He=()=>{let t={[u.M_CLIENT_DATA]:{WIDTH:(___M_WIDTH_0+___M_WIDTH_1+___M_WIDTH_2+___M_WIDTH_3+___M_WIDTH_4+document.documentElement.clientWidth)/6,HEIGHT:(___M_HEIGHT_0+___M_HEIGHT_1+___M_HEIGHT_2+___M_HEIGHT_3+___M_HEIGHT_4+document.documentElement.clientHeight)/6,TIME:(___M_TIME_0+___M_TIME_1+___M_TIME_2+___M_TIME_3+___M_TIME_4+(new Date).getTime())/6,ZOOM:(___M_ZOOM_0+___M_ZOOM_1+___M_ZOOM_2+___M_ZOOM_3+___M_ZOOM_4+devicePixelRatio)/6,MOBILE:mobileCheck()}};getEngine().serverStorage.sendData(t)};this.setWebSocketConnect=t=>{this.webSocketConnect=t},this.initAfterServerStorageLoaded=()=>{this.whoIsHere.init(),this.soundManager.init(),Engine.hotKeys.rebuildHotKeys(),Engine.chatController.getChatDataUpdater().setDataFromServerStorage()},this.afterServerStorageReloaded=t=>{t.includes("hotKeys")&&Engine.hotKeys.rebuildHotKeys(),t.includes("whoIsHere")&&Engine.whoIsHere.updateWhoIsHereAfterSaveInServerStorage(),(t.includes("hotWidget_pc")||t.includes("hotWidget_mobile"))&&Engine.widgetManager.addWidgetButtons(!0)},this.fetchURISteps=function(){var t="",e=Engine.hero.dirMapping(),i=this.stepsToSend.steps.join(";"),n=this.stepsToSend.times.join(";");return Oe.requestCorrect.checkStepsToSendCorrect(this.stepsToSend.steps)&&Oe.requestCorrect.checkTimesToSendCorrect(this.stepsToSend.times)?(i&&n?t="&ml="+i+"&mts="+n:this.hero.setCorrectDir(e)&&(t="&pdir="+e.indexOf(this.hero.dir)),t):""},this.initTickWorker=()=>{this.tickWorker=new Worker("js/Margonem/workers/TickWorker.js?v="+__build.version),this.tickWorker.onmessage=function(t){if(Me&&t)switch(t.data){case"tick":Oe.idleJSON.tick();break;default:console.warn(t.data)}}},this.startGameThread=function(){this.reload=!1,this.idleJSON.reset(),Engine.interface.lock.unlock("game_init"),Engine.map.lock.unlock("game_init"),this.startJSONInterval(),Re&&cancelAnimationFrame(Re),Ve()};this.updateScreenSize=function(){if(!Oe.map.getDrawable())return void Oe.renderer.updateScreenSize(!1,!0);Engine.renderer.updateScreenSize({x:Engine.map.minX-5,y:Engine.map.minY-6,maxX:Engine.map.maxX+4,maxY:Engine.map.maxY+7})};let Ge=[];var Ve=function(){var e=(new Date).getTime();Se=(e-(ke||e))/1e3,ke||(ke=e);if(Se>1/Fe-.004){if(Engine.requestAnimationFrameUpdateFinished=!1,ke=e,Ge.push(Se),50==Ge.length){let t=0;for(let e in Ge)t+=Ge[e];Ge=[]}Se<=.2&&(!function(t){let e=checkBattleWindowActive();Oe.zoomManager.update(t),Oe.fakeNpcs.update(t),Oe.hero.update(t),Oe.others.update(t),Oe.npcs.update(t),Oe.map.rip.update(t),Oe.colorInterfaceNotificationManager.update(t),Oe.characterEffectsMapManager.update(t),Engine.rajCamera.update(t),Engine.rajSequenceManager.update(t),Engine.screenEffectsManager.update(t),Engine.rajSoundManager.update(t),Oe.interfaceTimerManager.update(t),e||(Oe.map.update(t),Oe.mapGoMark.update(t),Oe.floatForegroundManager.update(t),Oe.floatObjectManager.update(t),Oe.rajCharacterImageChangerManager.update(t),Oe.dynamicLightsManager.update(t,"MAP"),Oe.dynamicDirCharacterLightsManager.update(t,"MAP"),Oe.emotions.update(t),Oe.weather.update(t),Oe.nightController.update(t),Oe.behaviorDynamicLightsManager.update(t),Oe.wraithCharacterManager.update(t),Oe.wraithObjectManager.update(t),Oe.questTracking.update(t),Oe.targets.update(t),Oe.warShadow.update(t)),Oe.canvasCharacterWrapperManager.update(t),Oe.htmlMultiGlow.update(t),Oe.canvasMultiGlow.update(t),Oe.htmlFocus.update(t),Oe.canvasFocus.update(t),Oe.dialogue&&Oe.dialogue.update(),Engine.opt(8)||(Oe.items.update(t),Oe.tpls.update(t),Oe.battle&&(Oe.battle.warriors.updateAllWarriors(t),Oe.battle.battleNight.update(t),Oe.battle.battleEffectsController.getBattleBackgroundTintAction().update(t),Oe.battle.battleEffectsController.getBattleWarriorsActionController().updateAllEffects(t),Oe.characterEffectsBattleManager.update(t))),API.callEvent(Oe.apiData.CALL_DRAW_UPDATE,t),Oe.colorInterfaceNotificationManager.draw(),Oe.htmlFocus.draw(),Oe.specificAnimationManager.draw(t),Oe.renderer.add.apply(Oe.renderer,Oe.canvasFocus.getCanvasFocus()),Oe.renderer.add.apply(Oe.renderer,Oe.canvasMultiGlow.getCanvasMultiGlow()),e||(Oe.renderer.add(Oe.map,Oe.mapGoMark,Oe.hero),Oe.renderer.add.apply(Oe.renderer,Oe.questMapBorderManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.warShadow.getWarShadow()),Oe.renderer.add.apply(Oe.renderer,Oe.screenEffectsManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.floatForegroundManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.floatObjectManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.rajCharacterImageChangerManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.nightController.getNight()),Oe.renderer.add.apply(Oe.renderer,Oe.others.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.emotions.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.npcs.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.fakeNpcs.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.hero.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.wraithCharacterManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.wraithObjectManager.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.targets.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.weather.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.map.groundItems.getDrawableItems()),Oe.renderer.add.apply(Oe.renderer,Oe.map.gateways.getDrawableItems()),Oe.renderer.add.apply(Oe.renderer,Oe.map.rip.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.map.questProgressBar.getDrawableList()),Oe.renderer.add.apply(Oe.renderer,Oe.characterEffectsMapManager.getDrawableList()),Oe.roadDisplay&&Oe.renderer.add(Oe.hero.roadDisplay)),Oe.canvasCharacterWrapperManager.draw(),Engine.opt(8)||(Oe.items.drawItems(),Oe.tpls.drawItems(),Oe.battle&&(Oe.battle.warriors.drawAllWarriors(),Oe.battle.battleEffectsController.getBattleBackgroundTintAction().draw(),Oe.battle.battleEffectsController.getBattleWarriorsActionController().drawAllEffects(),Oe.characterEffectsBattleManager.draw(t),Oe.battle.getShow()&&Oe.battle.battleNight.draw())),Engine.miniMapController.handHeldMiniMapController.updateAndDraw(t),Oe.updateScreenSize(),API.callEvent(Oe.apiData.CALL_DRAW_ADD_TO_RENDERER)}(Se),function(e){t.clearRect(0,0,Le,De);let i=getEngine().zoomManager.getActualZoom(),n=1!=i;n&&(t.save(),t.scale(i,i)),Oe.renderer.draw(t),n&&t.restore(),xe=!xe}(),Engine.mapAreaCordTriggerManager.draw(t),Engine.requestAnimationFrameUpdateFinished=!0)}Re=requestAnimationFrame(Ve)};this.onResize=function(){if(console.log("onResize"),Engine.mobile!=getMobile())return void location.reload();if(!Engine.interfaceStart)return;this.interface.setInterfaceSize(),this.resizeScreen();let t=Le,e=De;this.ctxResize(),this.nightController.resizeMainCanvas(),this.screenEffectsManager.resize();let i={width:window.innerWidth-Le+t,height:window.innerHeight-De+e},n={width:window.innerWidth,height:window.innerHeight},a=null;n.width==i.width&&n.height==i.height||(a=n.width>i.width||n.height>i.height),this.battle&&this.battle.onResize(),this.dialogue&&this.dialogue.onResize(),this.banners&&this.banners.onResize(),this.quests&&this.quests.onResize(),this.miniMapController&&this.miniMapController.onResize(),this.miniMapController.handHeldMiniMapController.onResize(),this.colorInterfaceNotificationManager&&this.colorInterfaceNotificationManager.onResize(),this.setPosOfAllWindow(),$(".scroll-wrapper").trigger("update"),this.tutorials&&this.tutorials.onResize(),Engine.hero.onResize(),Engine.map.onResize(),Engine.weather.onResize(n,i,a),Engine&&Engine.dialogue&&Engine.dialogue.updateBubblePos(),Engine.addonsPanel.onResize(),getEngine().map.setForceRender(!0)},this.setPosOfAllWindow=function(){let t=i(32);Engine.windowManager.updatePosOfWindowsInSpecificLayer(t.$_ALERTS_LAYER),Engine.windowManager.updatePosOfWindowsInSpecificLayer(t.$_M_ALERT_LAYER),Engine.windowManager.updatePosOfWindowsInSpecificLayer(t.$_CONSOLE_LAYER)},this.resizeScreen=function(){const t=Engine.zoomFactor?Engine.zoomFactor:1,e=$("body");e.width(window.innerWidth/t),e.height(window.innerHeight/t),e.css("transform","scale("+t+")")},this.setCTXScaleMode=function(t){1===t?this.mode=function(t,e){var i=1;isset(window.devicePixelRatio)&&(i=Math.round(100*window.devicePixelRatio)/100);var n=Math.round(t*i),a=Math.round(e*i);n+=n%2,a+=a%2;var s=Math.round(n/i),r=Math.round(a/i);return{canvas:{width:n,height:a},css:{width:s,height:r},store:{width:s,height:r},scale:i}}:2===t?this.mode=function(t,e){var i=Math.round(t),n=Math.round(e);return{canvas:{width:i+=i%2,height:n+=n%2},css:{width:i,height:n},store:{width:i,height:n},scale:1}}:3===t&&(this.mode=function(t,e){var i=t,n=e;return{canvas:{width:i+=i%2,height:n+=n%2},css:{width:i,height:n},store:{width:i,height:n},scale:1}})},this.ctxResize=function(){let e=Engine.interface.get$gameLayer(),i=e.width(),n=e.height(),a=this.mode(i,n);this.interface.get$GAME_CANVAS().attr("width",a.canvas.width).attr("height",a.canvas.height).css({width:a.css.width+"px",height:a.css.height+"px"}),1!==a.scale&&t.scale(a.scale,a.scale),Le=a.store.width,De=a.store.height,Engine.warShadow.setSizeCanvas()},this.setDefaultInterfaceCookie=function(){var t=new Date;t.setTime(t.getTime()+2592e6),setCookie("interface","ni",t,"/","margonem."+getMainDomain())},this.setInterface=function(){var t=getCookie("interface");(null==t||"ni"!=t)&&Oe.setDefaultInterfaceCookie()},this.setBlockSendNextInit=t=>{this.blockSendNextInit=t},this.setFirstLoadInit1=t=>{this.firstLoadInit1=t},this.setFirstLoadInit2=t=>{this.firstLoadInit2=t},this.setFirstLoadInit4=t=>{this.firstLoadInit4=t},this.opt=function(t,e){return e?e&1<<t-1:Engine&&Engine.hero&&Engine.hero.d&&Engine.hero.d.hasOwnProperty("opt")?Engine.hero.d.opt&1<<t-1:void 0},this.setAllObjectsAnimationState=function(t){this.hero.setStaticAnimation(t),this.hero.pet&&this.hero.pet.setStaticAnimation(t),this.battle&&this.battle.warriors.setWarriorsAnimationState(t),this.others.setOthersAnimationState(t),this.npcs.setNpcsAnimationState(t),this.fakeNpcs.setFakeNpcAnimationState(t),this.emotions.setEmotionsAnimationsState(t),this.map.groundItems.setGroundItemsAnimationsState(t),this.colorInterfaceNotificationManager.setBlink(!t)},this.setFirstNotInit=t=>{We=t},this.getFirstNotInit=()=>We,this.getWebdriver=()=>navigator.webdriver,this.isInitLoadTime=()=>!this.allInit;this.reCallInitQueue=function(t){if(Oe.getWebdriver())mAlert(_t("forbidden_webdriver"));else if(Engine.tickSuccess){$e=1,Oe.allInit=!1,Oe.setFirstNotInit(null),this.stopJSONInterval();var e=!1,i=function(){if(Ne)return;var n="&clientTs="+unix_time(!0);let a="",s="",r=null,o="";1==$e&&(Engine.firstLoadInit1?(Oe.setBlockSendNextInit(!1),Oe.setFirstLoadInit1(!1),t&&(s=t),a="&configGet=1"):Engine.deadController.unset(!1)),Engine.firstLoadInit2&&2==$e&&(Oe.setFirstLoadInit2(!1),Engine.serverStorage.getReloadServerStorageAfterAnswerInInit1()&&(a="&configSet=1",r=Engine.serverStorage.prepareMergeObjToSend(),Engine.serverStorage.createOldDataAndResetNewData())),4==$e&&(Engine.firstLoadInit4?Oe.setFirstLoadInit4(!1):o="&ignoreChat=1");let l=[function(){e||(Oe.onClear(),e=!0)},function(t){"stop"!=t.t&&(1==$e&&Engine.blockSendNextInit||($e++,2==$e&&(Engine.loader.load("players"),Engine.loader.load("npc")),$e>4?(Oe.allInit=!0,Oe.afterAllInitData(),Engine.map.getDrawable()&&Oe.startGameThread(),Oe.lock.remove("change_location")):i()))}];CFG.webSocketVersion?Engine.communication.send2("init&initlvl="+$e+n+a+o+s+"&mucka="+Math.random(),l,r||!1):Engine.communication.send("init&initlvl="+$e+n+a+o+s+"&mucka="+Math.random(),l,r||!1)};i()}else console.log("reCallInitQueue BUG!")},this.afterAllInitData=()=>{Engine.fakeNpcs.serveRayControllerData(),Engine.questTracking.startTrackingIfActiveTrackingQuestExist()},this.stop=function(){Ne=!0,this.stopJSONInterval()},this.start=function(){Ne=!1},this.startJSONInterval=function(){Me=!0},this.stopJSONInterval=function(){Me=!1},this.getEv=()=>this.ev,this.getLastEv=()=>Pe,this.setEv=t=>{this.ev=t},this.setLastEv=t=>{Pe=t},this.onClear=function(){this.rajCharacterImageChangerManager.onClear(),this.rajZoomManager.onClear(),this.questMapBorderManager.onClear(),this.rajCamera.onClear(),this.rajTracking.onClear(),this.rajCharacterHide.onClear(),this.rajDialogue.onClear(),this.rajSequenceManager.onClear(),this.rajEmoDefinitions.onClear(),this.mapAreaCordTriggerManager.onClear(),this.rajEmoActions.onClear(),this.rajAreaTriggerManager.onClear(),this.rajSoundManager.onClear(),this.rajMapMusicManager.onClear(),this.hero.onClear(),this.map.onClear(),this.npcTplManager.onClear(),this.npcIconManager.onClear(),this.mapGoMark.onClear(),this.npcs.onClear(),this.fakeNpcs.onClear(),this.wraithObjectManager.onClear(),this.others.onClear(!1),this.heroesRespManager.onClear(),this.interfaceTimerManager.onClear(),this.emotions.onClear(),this.weather.onClear(),this.mapFilter.onClear(),this.items.onClear(),this.zoomManager.onClear(),this.nightController.onClear(),this.screenEffectsManager.onClear(),this.rajExtraLight.resetExtraLight(),this.dynamicLightsManager.onClear(),this.dynamicDirCharacterLightsManager.onClear(),this.behaviorDynamicLightsManager.onClear(),this.floatForegroundManager.onClear(),this.floatObjectManager.onClear(),this.renderer.onClear(),Engine.miniMapController.handHeldMiniMapController.clearMiniMap(),this.characterEffectsMapManager.onClear(),this.characterEffectsBattleManager.onClear(),this.questTracking.onClear(),this.earthQuakeManager.onClear(),this.themeController.onClear(),this.stepsToSend.reset(),Engine.tutorialManager.onClear(),this.rajProgrammer.onClear(),this.resetEvAndLastEv(),this.rajBattleEvents.onClear(),this.rajMapEvents.onClear(),this.rajWindowEvents.onClear(),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,10)},this.resetEvAndLastEv=()=>{this.setEv(""),this.setLastEv(0)},this.getCollisionAtEvent=function(t){var e=Engine.zoomFactor;t.clientX=t.clientX/e,t.clientY=t.clientY/e;let i=this.interface.get$GAME_CANVAS();return Engine.eventCollider.dispatch(t,t.clientX-i.offset().left/e+Oe.map.offset[0],t.clientY-i.offset().top/e+Oe.map.offset[1])},this.getCanvasViewSize=function(){return{width:Le,height:De}},this.getWorldTime=()=>this.worldTime;const Ue=t=>{Be=t},je=t=>{Fe=t};this.setLastClickOnCanvas=Ue,this.getLastClickOnCanvas=()=>Be,this.getInitLvl=()=>$e,this.setFramePerSecond=je,this.getCtxMap=()=>e}},function(t,e){t.exports={NEW_MSG:"newMsg",UPDATE_MSG:"updateMsg",HERO_UPDATE:"heroUpdate",NEW_ASK:"newAsk",LOOT_UPDATE:"loot_update",AUCTIONS_UPDATE:"auctions_update",DEPO_INIT:"depo_init",DEPO_UPDATE:"depo_update",CLAN_DEPO_INIT:"clan_depo_init",CLAN_DEPO_UPDATE:"clan_depo_update",HERO_DEAD:"heroDead",CALL_DRAW_UPDATE:"call_draw_update",CALL_DRAW_ADD_TO_RENDERER:"call_draw_add_to_renderer",SHOW_CLOSE_BATTLE:"show_close_battle",CLOSE_BATTLE:"close_battle",OPEN_BATTLE_WINDOW:"open_battle_window",UPDATE_WARRIOR:"updateWarrior",NEW_WARRIOR:"newWarrior",HERO_MOVE:"heroMove",AFTER_CHARACTER_TIP_UPDATE:"afterCharacterTipUpdate",REMOVE_NPC:"removeNpc",NEW_NPC:"newNpc",CLEAR_MAP_NPCS:"clear_map_npcs",REMOVE_OTHER:"removeOther",NEW_OTHER:"newOther",UPDATE_OTHER:"updateOther",ITEM_USED:"itemUsed"}},function(t,e){t.exports={BAG_VIEW:"BAG_VIEW",RECOVER_VIEW:"RECOVER_VIEW",NEWS_VIEW:"NEWS_VIEW",CHAT_LINKED_VIEW:"CHAT_LINKED_VIEW",BARTER_ITEM_VIEW:"BARTER_ITEM_VIEW",BATTLE_PASS_ITEM_VIEW:"BATTLE_PASS_ITEM_VIEW",BARTER_REAGENT_ITEM_VIEW:"BARTER_REAGENT_ITEM_VIEW",BARTER_RECIVED_ITEM_VIEW:"BARTER_RECIVED_ITEM_VIEW",DEPO_ITEM_VIEW:"DEPO_ITEM_VIEW",TIP_ITEM_VIEW:"TIP_ITEM_VIEW",TIP_TPL_ITEM_VIEW:"TIP_TPL_ITEM_VIEW",SELL_ITEM_IN_BASKET_VIEW:"SELL_ITEM_IN_BASKET_VIEW",BUY_ITEM_IN_BASKET_VIEW:"BUY_ITEM_IN_BASKET_VIEW",LOOT_ITEM_VIEW:"LOOT_ITEM_VIEW",CODE_PROMO_ITEM_VIEW:"CODE_PROMO_ITEM_VIEW",DIALOGUE_ITEM_VIEW:"DIALOGUE_ITEM_VIEW",ALERT_ITEM_VIEW:"ALERT_ITEM_VIEW",OPEN_PREVIEW_ITEM_VIEW:"OPEN_PREVIEW_ITEM_VIEW",PREVIEW_ITEM_VIEW:"PREVIEW_ITEM_VIEW",REGISTRATION_ITEM_VIEW:"REGISTRATION_ITEM_VIEW",PROGRESS_ITEM_VIEW:"PROGRESS_ITEM_VIEW",SEASON_REWARD_ITEM_VIEW:"SEASON_REWARD_ITEM_VIEW",SEASON_ITEM_VIEW:"SEASON_ITEM_VIEW",MM_BATTLE_SUMMARY_VIEW:"MM_BATTLE_SUMMARY_VIEW",REWARD_CALENDAR_ITEM_VIEW:"REWARD_CALENDAR_ITEM_VIEW",SHOP_PROMO_ITEM_VIEW:"SHOP_PROMO_ITEM_VIEW",ITEM_DETAILS_VIEW:"ITEM_DETAILS_VIEW",STICKY_ITEM_VIEW:"STICKY_ITEM_VIEW",CLAN_BLESS_ITEM_VIEW:"CLAN_BLESS_ITEM_VIEW",BRING_ITEM_CLAN_VIEW:"BRING_ITEM_CLAN_VIEW",AUCTION_ITEM_VIEW:"AUCTION_ITEM_VIEW",AUCTION_SELL_ITEM_VIEW:"AUCTION_SELL_ITEM_VIEW",BOTTOM_ITEM_VIEW:"BOTTOM_ITEM_VIEW",BONUS_RESELECT_COST_ITEM_VIEW:"BONUS_RESELECT_COST_ITEM_VIEW",BONUS_RESELECT_ITEM_VIEW:"BONUS_RESELECT_ITEM_VIEW",NO_SELL_ITEM_VIEW:"NO_SELL_ITEM_VIEW",FOR_YOU_ITEM_VIEW:"FOR_YOU_ITEM_VIEW",MAIL_ATTACHMENT_ITEM_VIEW:"MAIL_ATTACHMENT_ITEM_VIEW",MAIL_ITEM_TO_SEND_VIEW:"MAIL_ITEM_TO_SEND_VIEW",ITEM_TO_BUY_VIEW:"ITEM_TO_BUY_VIEW",SHOW_EQ_ITEM_VIEW:"SHOW_EQ_ITEM_VIEW",TUTORIAL_ITEM_VIEW:"TUTORIAL_ITEM_VIEW",TUTORIAL_TPL_ITEM_VIEW:"TUTORIAL_TPL_ITEM_VIEW",CHANGE_EQ_ITEM_NR_0_VIEW:"CHANGE_EQ_ITEM_NR_0_VIEW",CHANGE_EQ_ITEM_NR_1_VIEW:"CHANGE_EQ_ITEM_NR_1_VIEW",CHANGE_EQ_ITEM_NR_2_VIEW:"CHANGE_EQ_ITEM_NR_2_VIEW",ENHANCE_REAGENT_VIEW:"ENHANCE_REAGENT_VIEW",ENHANCE_REQUIRE_ITEM_VIEW:"ENHANCE_REQUIRE_ITEM_VIEW",ENHANCE_ITEM_VIEW:"ENHANCE_ITEM_VIEW",EXTRACTION_RECEIVED_ITEM_VIEW:"EXTRACTION_RECEIVED_ITEM_VIEW",EXTRACTION_ITEM_VIEW:"EXTRACTION_ITEM_VIEW",SALVAGE_ITEM_VIEW:"SALVAGE_ITEM_VIEW",SALVAGE_VIEW:"SALVAGE_VIEW",GROUND_ADDON_ITEM_VUE_VIEW:"GROUND_ADDON_ITEM_VUE_VIEW",GROUND_ADDON_ITEM_VIEW:"GROUND_ADDON_ITEM_VIEW",RECIPE_ITEM_VIEW:"RECIPE_ITEM_VIEW",HELPER_VIEW:"HELPER_VIEW",TRADE_ITEM_T_VIEW:"TRADE_ITEM_T_VIEW",TRADE_ITEM_S_VIEW:"TRADE_ITEM_S_VIEW"}},function(t,e){t.exports={ITEM_TO_AUCTION:"ITEM_TO_AUCTION",MAIL_ITEM_TO_SEND:"MAIL_ITEM_TO_SEND",BARTER_ITEM_REAGENT:"BARTER_ITEM_REAGENT",ITEM_TO_SELL:"ITEM_TO_SELL",SALVAGE:"SALVAGE",BONUS_RESELECT:"BONUS_RESELECT",ENHANCE:"ENHANCE",ENHANCE_INGR:"ENHANCE_INGR",EXTRACTION:"EXTRACTION"}},function(t,e){t.exports={MAIL:"MAIL",SHOP:"SHOP",BARTER:"BARTER",DEPO:"DEPO",DEPO_CLAN:"DEPO_CLAN",AUCTION:"AUCTION",SALVAGE:"SALVAGE",ENHANCE:"ENHANCE",ENHANCE_INGR:"ENHANCE_INGR",EXTRACTION:"EXTRACTION",BONUS_RESELECT:"BONUS_RESELECT"}},function(module,exports,__webpack_require__){var log,warn,error,tpl=__webpack_require__(0),Templates=__webpack_require__(0);let ThemeData=__webpack_require__(33);module.exports=function(){var _this=this,self=this,game=null,queue=[];let list=[],buttonLastCommandAttach=!1;this.init=function(){this.initWindow(),this.initContent(),this.initInputKeyCodes(),this.initScrollBar(),this.initSizeButton()};const initCommandButton=()=>{if(!mobileCheck())return;if(buttonLastCommandAttach)return;let t=createButton("PREV_CMD",["small","prev-cmd-button"],(function(){self.commandLine.previous()})),e=createButton("NEXT_CMD",["small","next-cmd-button"],(function(){self.commandLine.next()})),i=this.wnd.$.find(".console-bottom-panel-wrapper")[0];i.appendChild(t),i.appendChild(e),buttonLastCommandAttach=!0};this.initSizeButton=function(){this.wnd.$.find(".console-window").find(".size-button").click((function(){self.wnd.$.find(".console-window").toggleClass("big-size"),$(".scroll-wrapper",self.wnd.$).trigger("update"),self.wnd.center()}))},this.setVisibleOnSizeButton=function(){this.wnd.$.find(".console-window").find(".size-button").css("display","block")},this.initWindow=function(){Engine.windowManager.add({content:tpl.get("console-window"),title:_t("iconconsole"),nameWindow:Engine.windowsData.name.CONSOLE,widget:Engine.widgetsData.name.CONSOLE,objParent:this,nameRefInParent:"wnd",addClass:"console-wnd",onclose:()=>{self.close()}}),this.wnd.hide()},this.initContent=function(){this.displayMsg("Margonem console."),this.displayMsg("Client version: "+__build.serviceVersion)},this.initInputKeyCodes=function(){this.wnd.$.find("input").on("keydown",(function(t){38==t.keyCode&&self.commandLine.previous(t),40==t.keyCode&&self.commandLine.next(t),13==t.keyCode&&self.commandLine.sendMessage($(this).val())}))},this.newEquipItem=function(t,e){list.push(t),e&&self.showEquipItems()},this.showEquipItems=()=>{var t=location.host.split(".")[0];0==t.indexOf("game")&&(t=t.substr(4));for(let e in list)parent.log(list[e].name+" ITEM#"+list[e].hid+"."+t);list=[],Engine.items.removeCallback(Engine.itemsFetchData.NEW_EQUIP_ITEM)},this.initScrollBar=function(){$(".scroll-wrapper",self.wnd.$).addScrollBar({track:!0})},this.putMsg=function(t,e){e||this.showConNotif(),void 0===this.wnd?queue.splice(0,0,t):this.displayMsg(t),this.wnd.$.find(".scroll-pane").trigger("updateHTML",!0)},this.displayMsg=function(t){var e=tpl.get("console-message");e.html(t),this.wnd.$.find(".console-content").append(e),this.scrollBottom()},this.scrollBottom=function(){$(".scroll-wrapper",this.wnd.$).trigger("update").trigger("scrollBottom")},this.log=function(t){this.sendMessage(t,null,!0)},this.showConNotif=function(){var t=Engine.interface;t.alreadyInitialised?this.wnd.isShow()||t.showConsoleNotif():this.open()},this.deleteConsoleNotif=function(){var t=Engine.interface;t.alreadyInitialised&&t.deleteNotif("consoleNotif")},this.warn=function(t){this.sendMessage(t,"yellow")},this.error=function(t){this.sendMessage(t,"red"),self.open()},this.createMessage=(t,e)=>{let i=$("<span/>",{class:e});return i.html(parseContentBB(t,!1)),i},this.sendMessage=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t))for(const n of t){let t=_this.createMessage(n,e);_this.putMsg(t,i)}else{let n=_this.createMessage(t,e);_this.putMsg(n,i)}},this.open=function(){if(this.wnd.isShow())return!1;this.wnd.addToConsoleLayer(),mobileCheck()||setTimeout((function(){$("#console_input").focus().val("")}),50),this.wnd.center(),this.wnd.show(),this.scrollBottom(),this.deleteConsoleNotif()},this.close=function(){this.wnd.detachFromLayer()},this.toggle=function(t){this.wnd.isShow()&&void 0===t?this.close():this.open()},this.dump=function(t,e){var i="";if(e||(e=0),e>3)return"";for(var n="",a=0;a<e+1;a++)n+="&nbsp;&nbsp;";if("object"==typeof t)for(var s in t){var r=t[s];"object"==typeof r?(i+=n+"'"+s+"' :<BR>",i+=dump(r,e+1)):i+=void 0===r?n+"'"+s+'\' => "undefinied"<BR>':n+"'"+s+"' => \""+r.toString().replace(/</g,"&lt;")+'"<BR>'}else i="===>"+t+"<===("+typeof t+")";return i},this.commandLine=new function(p){var parent=p,commands=[],custom=null,activeIdx=null;this.next=function(t){t&&t.preventDefault(),null!=activeIdx&&(++activeIdx>=commands.length?(activeIdx=null,$("#console_input").val(custom),custom=null):(this.setCustom(),$("#console_input").val(commands[activeIdx])))},this.previous=function(t){t&&t.preventDefault(),null==activeIdx?activeIdx=commands.length-1:activeIdx>0&&activeIdx--,this.setCustom(),$("#console_input").val(commands[activeIdx])},this.setCustom=function(){null==custom&&(custom=$("#console_input").val())},this.sendMessage=function(msg){if(""!=msg){var c=msg.split(" "),cmd=c[0];c[0]="";var par=c.join(" ").substr(1);if(parent.log('<i style="color:white">&gt; '+msg+"</i>"),(null==activeIdx||null!=activeIdx&&commands[activeIdx]!=msg)&&commands.push(msg),"."==cmd.substr(0,1))_g("console&custom="+esc(msg));else switch(cmd){case"cls":$(".console-content").html("");break;case"dump":parent.log("<b>Dumping variable "+par+"</b><br>"+self.dump(eval(par)));break;case"show":if("battle"==par){if(!Engine.battle.getfirstLogsExist())return mAlert(_t("noLogs",null,"battle"));Engine.battle.toogleBattleLogs()}break;case"hide":$("#"+par).hide();break;case"stop":Engine.stop(),parent.log("Engine stopped.");break;case"skin":$("#hero").css("backgroundImage","url("+par+")");break;case"changelog":_g("gm&a=changelog");break;case"noclip":Engine.map.col.check=function(){return 0};break;case"equip":Engine.items.fetch(Engine.itemsFetchData.NEW_EQUIP_ITEM,self.newEquipItem);break;case"group":break;case"cols":for(var cols=[[],[],[]],x1=-1;x1<2;x1++)for(var y1=-1;y1<2;y1++)cols[y1+1][x1+1]=map.isCol(hero.realX()+x1,hero.realY()+x1);parent.log(dump(cols));break;case"respnpc":_g("gm&a=respnpc");break;case"testskin":Engine.themeController.updateData(par,ThemeData.THEME_KIND.EVENT);break;case"resetskin":parent.log("deprecated! interfaceSkin you can use only rom SRAJ!");break;case"loc":_g("gm&a=locate&who="+esc(par),(function(t){}));break;case"nloc":_g("gm&a=npclocate&who="+esc(par),(function(t){}));break;case"tp":_g("gm&a=teleport&target="+par,(function(t){Engine.interface.checkTeleport(t)}));break;case"ver":parent.log("Margonem MMORPG ver 3.0");break;case"about":parent.log("Margonem MMORPG (c) by Thinker 2005-2014 [www.margonem.pl, thinker@margonem.pl]");break;case"cls":$("#contxt").empty();break;case"show":$("#"+par).show(),"battle"==par&&g.lock.add("battle");break;case"hide":$("#"+par).hide();break;case"outfit":Engine.hero.onUpdate.img(par,Engine.hero.d.img,{insecureSource:!0});break;case"ff":_g("fight&a=f");break;case"":break;default:try{eval(msg)}catch(t){parent.log(t.toString())}}$("#console_input").val(""),custom=null,activeIdx=null}}}(this),this.initCommandButton=initCommandButton}},function(t,e){t.exports=function(){let t=null;const e=()=>{t={captcha:{start:t=>isIntVal(t),answerId:t=>a(t)},moveitem:{st:t=>isIntVal(t),set:t=>isIntVal(t),tpl:t=>isIntVal(t),id:t=>isIntVal(t),answer:t=>isIntVal(t),x:t=>isIntVal(t),y:t=>isIntVal(t),town_id:t=>isIntVal(t),town_x:t=>isIntVal(t),town_y:t=>isIntVal(t),bonusIdx:t=>isIntVal(t),put:t=>isIntVal(t),findslot:t=>isIntVal(t),ans:t=>isIntVal(t),outfit_id:t=>isIntVal(t),split:t=>isIntVal(t),skillshop:t=>isIntVal(t),locationId:t=>isIntVal(t)},talk:{id:t=>isIntVal(t)||r(t,["player","pet"]),c:t=>isPl()?isFloatVal(t):isStringVal(t),inputId:t=>isIntVal(t),inputData:t=>isStringVal(t),inputCancel:t=>isIntVal(t)},shop:{buy:t=>n(t),sell:t=>o(t),can_sell:t=>isIntVal(t),npc:t=>isIntVal(t),filters:t=>isIntVal(t)},codeprom:{code:t=>isStringVal(t),opt:t=>isIntVal(t)},skills:{learn:t=>isIntVal(t),lvl:t=>isIntVal(t),reset:t=>isIntVal(t),show:t=>isIntVal(t),answer:t=>isIntVal(t),battleaction:t=>r(t,["set","show","learn"]),battleskills:t=>a(t),selectedskills:t=>s(t),rpt:t=>isIntVal(t),set:t=>isIntVal(t),credits:t=>isIntVal(t)},promotions:{a:t=>r(t,["use","show"]),id:t=>isIntVal(t),answer:t=>isIntVal(t)},clan:{nrid:t=>isIntVal(t),a:t=>r(t,["wear","confirm","disband","invite_cancel","recruit_applications_reject","recruit_applications_accept","set_attrs","rank","join","apply","leave","skills_use","skills_upgrade","buy_quest","credits","invite_show","recruit_applications_show","invite","set_attrs","bring","myclan","list","member","members","dipl","quests_show","getclan","skills_show","save","depo","create"]),a2:t=>r(t,["add","del","edit"]),f:t=>r(t,["gold","credits","info","official","logo","name"]),agree:t=>isStringVal(t),n:t=>isStringVal(t),name:t=>isStringVal(t),page:t=>isIntVal(t),rid:t=>i(t),r:t=>isIntVal(t),inv:t=>isIntVal(t),pid:t=>isIntVal(t),dismiss:t=>isIntVal(t),v:t=>!0,sort:t=>isIntVal(t),ascending:t=>isIntVal(t),id:t=>isIntVal(t),rank:t=>isIntVal(t),allow:t=>isIntVal(t),leader:t=>isIntVal(t),op:t=>r(t,["confirm","cancel_e","cancel_a","close","ally","enemy","item_put","item_move","item_get","upgrade"]),pay:t=>r(t,["z","s","self"]),x:t=>isIntVal(t),y:t=>isIntVal(t),filters:t=>isStringVal(t),search:t=>isStringVal(t),answer:t=>isIntVal(t),ans:t=>isIntVal(t),opt:t=>isIntVal(t),amount:t=>isIntVal(t),inputCancel:t=>isIntVal(t)},skillshop:{},minimap:{},friends:{a:t=>r(t,["faccept","edown","eup","fdown","fup","finvite","fdel","inv","show","edel","eadd"]),id:t=>isIntVal(t),nick:t=>isStringVal(t),answer:t=>isIntVal(t)},config:{opt:t=>isIntVal(t),set:t=>isIntVal(t),clear:t=>isIntVal(t),remove:t=>!0},craft:{a:t=>r(t,["list","use"]),id:t=>isIntVal(t),ans:t=>isIntVal(t)},quests:{a:t=>r(t,["observe_add","use","cancel","observe_remove"]),cancel:t=>isIntVal(t),quest_id:t=>isIntVal(t)},emo:{a:t=>r(t,["flag-anglia.gif","flag-chorwacja.gif","flag-czechy.gif","flag-dania.gif","flag-francja.gif","flag-grecja.gif","flag-hiszpania.gif","flag-holandia.gif","flag-irlandia.gif","flag-niemcy.gif","flag-polska.gif","flag-portugalia.gif","flag-rosja.gif","flag-skull.gif","flag-szwecja.gif","flag-ukraina.gif","flag-wlochy.gif","bat","spider","banki","curse","emonutki","guma1","guma2","guma3","guma4","kuciak","ptaszek","emosnow","ghost","water","buzia1","buzia2","roza","cocos","emohug1","emohug2","emohug3","gift","holly","snowball","pillow","fire_1","fire_2","fire_3","fire_4","fire_5","fire_6","fire_7","fire_8","fire_9","fireworks","stars","termofor","lampion1","lampion2","lampion3","lampion4","lampion5","noemo","zombie","kiss","kiss2","angry","acceptbless","bless"]),id:t=>isIntVal(t),iid:t=>isIntVal(t),ans:t=>isIntVal(t)},logoff:{a:t=>r(t,["start","stop"])},mail:{action:t=>r(t,["refresh","send","get","delete","showSent"]),page:t=>isIntVal(t),id:t=>isIntVal(t),gold:t=>i(t),item:t=>i(t),recipient:t=>isStringVal(t),msg:t=>isStringVal(t),lastPage:t=>isIntVal(t)},match:{a:t=>r(t,["prepared","battleset","accept_opp","main","profile","statistics","history","season","statistics_detailed","signin","signout","ladder_global","ladder_clan","ladder_friends","summary"]),ans:t=>isIntVal(t),player_id:t=>isIntVal(t),page:t=>isIntVal(t),reward_stage:t=>isIntVal(t),reward_season:t=>isIntVal(t),reward_idx:t=>isIntVal(t),outfit_idx:t=>isIntVal(t)},bonus_reselect:{action:t=>r(t,["status","apply","select"]),item:t=>isIntVal(t),bonusIdx:t=>isIntVal(t)},enhancement:{action:t=>r(t,["progress_preview","progress","status","upgrade","open","show"]),item:t=>isIntVal(t),ingredients:t=>isIntsValWithSeperator(t),bonusIdx:t=>isIntVal(t)},salvager:{action:t=>r(t,["preview","salvage"]),selectedItems:t=>isIntsValWithSeperator(t)},extractor:{action:t=>r(t,["preview","extract"]),items:t=>isIntVal(t),item:t=>isIntVal(t),currency:t=>r(t,["z","s"])},loot:{final:t=>isIntVal(t),want:t=>a(t),not:t=>a(t),must:t=>a(t)},rewards_calendar:{action:t=>r(t,["show","open"]),day_no:t=>isIntVal(t),id:t=>isIntVal(t),answer:t=>isIntVal(t)},takeitem:{id:t=>isIntVal(t)},recovery:{item:t=>isIntVal(t)},setpvp:{mode:t=>isIntVal(t)},tutorial:{opt:t=>isIntVal(t)},depo:{upgrade:t=>isIntVal(t),answer:t=>isIntVal(t),move:t=>isIntVal(t),get:t=>isIntVal(t),put:t=>isIntVal(t),x:t=>isIntVal(t),y:t=>isIntVal(t),goldin:t=>isIntVal(t),goldout:t=>isIntVal(t),time:t=>isIntVal(t),pay:t=>r(t,["z","s"]),remove:t=>r(t,["OK"])},ah:{cat:t=>isIntVal(t),filter:t=>isStringVal(t),sort:t=>isStringVal(t),auction:t=>isStringVal(t),action:t=>r(t,["sell","end","change_time","change_time_all","bid","buyout","observation_add","observation_remove"]),item:t=>isIntVal(t),price:t=>i(t),buy_out:t=>i(t),time:t=>isIntVal(t),is_featured:t=>isIntVal(t)},wanted:{show:t=>isIntVal(t)},party:{a:t=>r(t,["acceptsummon","inv","disband","give","rm","accept"]),id:t=>isIntVal(t),answer:t=>isIntVal(t)},battlepass:{action:t=>r(t,["buy_premium","reroll","status","collect_reward"]),level:t=>isIntVal(t),type:t=>r(t,["standard","premium"])},barter:{id:t=>isIntVal(t),offerId:t=>isIntVal(t),selectedItems:t=>isIntsValWithSeperator(t),usesCount:t=>isIntVal(t),available:t=>isIntVal(t),action:t=>r(t,["use"]),desiredItem:t=>isIntVal(t)},creditshop:{filters:t=>isIntVal(t),npc:t=>isIntVal(t),filterlvlunder:t=>isIntVal(t),filterlvlabove:t=>isIntVal(t),credits_gold:t=>isIntVal(t),ttl_days:t=>isIntVal(t),ttl_del:t=>isIntVal(t)},chat:{a:t=>r(t,["ban"]),ans:t=>r(t,["OK","null"]),getContent:t=>isStringVal(t),tab:t=>isIntVal(t),channel:t=>r(t,["local","global","trade","personal","party","clan","system"]),style:t=>r(t,["special","nar","me"]),receiver:t=>isStringVal(t)},rooms:{room:t=>isIntVal(t),keydup:t=>isIntVal(t),delkeys:t=>isIntVal(t),rent:t=>isIntVal(t),m:t=>isIntVal(t)},trade:{a:t=>r(t,["gold","cancel","ask","confirm","add","sid","del","accept","noaccept"]),id:t=>isIntVal(t),buy:t=>isIntsValWithSeperator(t),sell:t=>isIntsValWithSeperator(t),tid:t=>isIntVal(t),sid:t=>isIntVal(t),ans:t=>isIntVal(t),val:t=>isIntVal(t),acceptGoldOverflow:t=>isIntVal(t)},pet:{a:t=>isIntVal(t)},fight:{a:t=>r(t,["attack","f","exit","strike","move","surrender","spell","nextmatch"]),auto:t=>isIntVal(t),id:t=>isIntVal(t),s:t=>isIntVal(t),answer:t=>isIntVal(t),ff:t=>isIntVal(t)},registernoob:{collect:t=>isIntVal(t)},artisanship:{action:t=>r(t,["open","close"])},hunting_statistics:{sort:t=>isStringVal(t),filter:t=>isStringVal(t)}}},i=t=>""==t||isIntVal(t),n=t=>{if(""==t)return!0;let e=t.split(";");for(let t in e){let i=e[t].split(",");if(2!=i.length)return!1;if(!(isIntVal(i[0])&&isIntVal(i[1])))return!1}return!0},a=t=>{if(""==t)return!0;let e=t.split(",");for(let t in e){let i=e[t];if(!isIntVal(i))return!1}return!0},s=t=>{if(""==t)return!0;let e=t.split(",");for(let t in e){let i=e[t];if(!isIntVal(i)&&""!=i)return!1}return!0},r=(t,e)=>!!t&&e.includes(t),o=t=>{if(""==t)return!0;let e=t.split(",");for(let t in e)if(!isIntVal(e[t]))return!1;return!0},l=(e,i,n)=>{let a=i[0],s=i[1],r=null;if((t=>new RegExp("answer([0-9]{7})").exec(t))(a))r=isIntVal(s);else{if(!t[e][a])return warningReport("RequestCorrect.js","checkActionIsCorrect","Unregistered action: "+a+", in task:"+e,"Val:"+s+"|"+n),message("Unregistered action: "+a+", in task:"+e+"|"+n),!1;r=t[e][a](s)}return!!r||(errorReport("Communication.js","checkTaskIsCorrect","Incorrect val in request task:"+e+", in action:"+a,"Val:"+s+"|"+n),message("Incorrect val in request task:"+e+", in action:"+a+"|Val:"+s+"|"+n),!1)};this.init=()=>{e()},this.checkStepsToSendCorrect=t=>{for(let e in t){let i=t[e].split(",");if(!(isIntVal(i[0])&&isIntVal(i[1])))return errorReport("Engine.js","checkStepsToSendCorrect","Val in stepsToSend is incorrect:",i),!1}return!0},this.checkTimesToSendCorrect=t=>{for(let e in t){let i=t[e];if(!isFloatVal(i))return errorReport("Engine.js","checkTimesToSendCorrect","Val in timesToSend is incorrect:",i),!1}return!0},this.checkTaskIsCorrect=e=>{if(!Engine.communication.getGlobalAddonsWasReceived())return!0;if("_"==e)return!0;let i=e.split("&");if(1==i.length)return!0;let n=i[0];if(!t[n]){return["gm","console"].includes(n)||(warningReport("RequestController.js","checkTaskIsCorrect","unregistered task request:",n+" REQUEST:"+e),message("unregistered task request:"+n+"|"+e)),!0}for(let t=1;t<i.length;t++){let a=i[t].split("=");if(2==a.length&&!l(n,a,e))return!0}return!0}}},function(t,e,i){let n=i(5),a=i(20);var s=i(0);t.exports=function(){let t=null;const e=()=>{let t=n.get(a.GLOBAL_ADDONS.mainKey);return null===t||t},i=(t,e)=>{let i=Engine.console.wnd.$,r=s.get("button");i.addClass("global-addons-exist"),r.addClass("small green global-addons-state-button"),r.find(".label").text(t?_t("global-addons-off"):_t("global-addons-on")),r.css("display","none"),e&&r.addClass(e),r.click(()=>{(()=>{let t=n.get(a.GLOBAL_ADDONS.mainKey),e=null!==t&&!t;n.set(a.GLOBAL_ADDONS.mainKey,e)})(),location.reload()}),i.find(".console-bottom-panel-wrapper").append(r)},r=i=>{t=i,e()&&$.ajax({type:"GET",url:t,success:function(){log("Addons "+t+" loaded successfully."),console.log("Addons "+t+" loaded successfully."),Engine.communication.startCallInitAfterRecivedAddons()},error:function(){log("Addons "+t+" loaded fail."),console.log("Addons "+t+" loaded fail."),Engine.communication.startCallInitAfterRecivedAddons()},dataType:"script",cache:!0})};this.init=()=>{},this.initGlobalAddonLink=t=>{Engine.globalAddons.checkAddonsTurnOn()&&(""==t?Engine.communication.startCallInitAfterRecivedAddons():r(t))},this.checkAddonsTurnOn=e,this.checkIsGlobalAddonRequestAnswer=t=>isset(t.addon),this.setMsgInConsoleAndCreateButtonInConsole=()=>{let n=e(),a="Global addons status: "+(n?"on":"off");t?(log("Global addons: "+t),log(a),i(n)):i(n)},this.setVisibleOfTurnOnOffAddonButton=t=>{let e=t?"block":"none";Engine.console.wnd.$.find(".global-addons-state-button").css("display",e)}}},function(t,e,i){var n=i(7);t.exports=function(){let t,e,i,a=!1,s={},r=[],o=!1;const l=()=>{o=!0},c=(t,e)=>t.hasOwnProperty(e)?t[e]:null,d=(t,e)=>{h(t),!Engine.interface.alreadyInitialised&&t[n.M_CLIENT_DATA]&&l(),s=m(s,t),e&&r.push(e)},h=t=>{for(let e in t){let t=!1;for(let i in n){if(n[i]==e){t=!0;break}}t||warningReport("ServerStorage.js","checkKeysIsCorrect","Key not exist in ServerStorageData:",e)}},u=t=>{t.w&&(v(),console.warn("[ServerStorage.js, notSaveInServerStorageManage] Error request ignored"))},p=()=>{let e={};for(let i in s)t[i]?e[i]=!!s[i]&&m(t[i],s[i]):e[i]=!!s[i]&&m({},s[i]);return e},g=()=>{if(!Object.keys(s).length)return!1;let t=!0;for(let e in s)if(Object.keys(s[e]).length||!1===s[e]){t=!1;break}return!t},f=e=>{t=null!=e?e:{}},m=function(){let t={},e=e=>{for(let i in e){if(!e.hasOwnProperty(i))continue;let n="[object Object]"===Object.prototype.toString.call(e[i]);t[i]=n?m(t[i],e[i]):e[i]}};for(let t=0;t<arguments.length;t++)e(arguments[t]);return t},v=()=>{i=[],e={}};this.prepareMergeObjToSend=p,this.createOldDataAndResetNewData=()=>{e=s,i=r,s={},r=[]},this.sendDataToServerStorage=t=>{_g("config&set=1",u,t)},this.sendData=d,this.updateData=s=>{a=!0,isset(s.data)&&((t=>{f(t);let e=CFG.serverStorage,i=e.version,a=n.STORAGE_CONFIG;if(!t||!t.hasOwnProperty(a)||t[a].version!=i){l();let n={};t||(t={});for(let i=0;i<e.keysToRemove.length;i++){let a=e.keysToRemove[i];n[a]=!1,t.hasOwnProperty(a)&&(t[a]=!1)}n[a]={version:i},l(),d(n,(function(){getEngine().afterServerStorageReloaded(e.keysToRemove)}))}})(s.data),h(s.data),getEngine().initAfterServerStorageLoaded()),isset(s.set)&&(s.set,t=m(t,e),(t=>{if(i)for(let t=0;t<i.length;t++)i[t]()})(s.set),v()),isset(s.removed)&&(delete t[s.removed],console.log("removed"))},this.clearDataBySpecificKey=e=>{isset(t[e])&&_g("config&remove="+e,(function(){}))},this.clearAllData=()=>{_g("config&clear=1",(function(){location.reload()}))},this.get=function(){let e=t;if(!e)return null;for(let t=0;t<arguments.length;t++)if(e=c(e,arguments[t]),null==e)return null;return e},this.getDataLoaded=()=>a,this.getReloadServerStorageAfterAnswerInInit1=()=>o,this.getPackageToSendToServerStorage=()=>{if(!Engine.interfaceStart)return null;if(g()){return p()}return null}}},function(t,e,i){let n=i(33),a=i(4),s=i(3);t.exports=function(){let t,e={fileName:"ThemeController.js"},i=null,r=null,o=null,l=null;const c=()=>{t=new a,t.init(e.fileName,{createFunc:u,clearFunc:p,createRequire:{name:{specificVal:["redscale","grayscale","bluescale"]}}},s.GROUP_NAME.OVERRIDE_OBJECT)};function d(t){switch(t){case n.THEME_KIND.EVENT:return!!i;case n.THEME_KIND.CITY:return!!r;default:console.error("checkThemeExist: BAD KIND OF THEME",t)}}function h(t){switch(t){case n.THEME_KIND.EVENT:o.remove(),o=null,i=null;break;case n.THEME_KIND.CITY:l.remove(),l=null,r=null;break;default:console.error("removeTheme: BAD KIND OF THEME",t)}}const u=(t,e)=>{f(e),function(t,e){let a=$(`<link rel="stylesheet" type="text/css" href="https://mwcr.garmory-cdn.cloud/skins/${t}/style.css"></link>`);switch(e){case n.THEME_KIND.EVENT:i=t,o=a;break;case n.THEME_KIND.CITY:r=t,l=a;break;default:console.error("addTheme: BAD KIND OF THEME",e)}a.appendTo("head")}(t.name,e)},p=(t,e)=>{f(e)},g=t=>elementIsObject(t)?!!t.clear||!!t.name:(errorReport(e.fileName,"checkCorrectData","data is not object!",t),!1);function f(t){d(t)&&h(t)}this.init=function(){c()},this.updateData=function(i,a){(function(t){for(let e in n.THEME_KIND)if(n.THEME_KIND[e]==t)return!0;return errorReport(e.fillName,"checkCorrectKind","BAD KIND OF THEME",t),!1})(a)&&g(i)&&t.updateData(i,a)},this.onClear=()=>{f(n.THEME_KIND.EVENT),f(n.THEME_KIND.CITY)}}},function(t,e){t.exports=function(){let t=1,e=1,i=2;const n=e=>{t=e},a=t=>{i=t},s=t=>{e=t},r=()=>{n(1),a(2)};this.init=()=>{},this.update=n=>{if(t==e)return;getEngine().map.setForceRender(!0);let a=null;if(t<e){let s=e-i*n;a=t<s?s:t}else{let s=e+i*n;a=t>s?s:t}s(a)},this.getActualZoom=()=>e,this.getZoom=()=>t,this.setZoom=n,this.setSpeed=a,this.clearZoom=r,this.onClear=()=>{r(),s(1)}}},function(t,e,i){var n=i(170);let a=i(4),s=i(3);t.exports=function(){let t="RajZoomManager.js",e=null,i=null,r=null;const o=()=>{r=new a;const e=s.TYPE;r.init(t,{createFunc:d,clearFunc:g,createRequire:{zoom:{type:e.NUMBER,optional:!0},speed:{type:e.NUMBER,optional:!0},duration:{type:e.NUMBER,optional:!0}}},s.GROUP_NAME.OVERRIDE_OBJECT)},l=()=>{clearTimeout(e),e=null},c=()=>!!e,d=t=>{f(p(t)),u(),h()},h=()=>{Engine.zoomManager.setZoom(i.zoom),Engine.zoomManager.setSpeed(i.speed)},u=()=>{var t;1!=i.duration&&(t=1e3*i.duration,e=setTimeout((function(){m(),l()}),t))},p=t=>{let e=n.defaultData,i={zoom:e.ZOOM,speed:e.SPEED,duration:e.DURATION};return isset(t.zoom)&&(i.zoom=t.zoom),isset(t.speed)&&(i.speed=t.speed),isset(t.duration)&&(i.duration=t.duration),i},g=t=>{i&&(m(),c()&&l())},f=t=>{i=t},m=()=>{f(null),Engine.zoomManager.clearZoom()};this.init=()=>{o()},this.updateData=(t,e)=>{r.checkCorrectMainData(t,e)&&r.updateData(t)},this.onClear=()=>{m(),c()&&l()}}},function(t,e){t.exports={defaultData:{ZOOM:2,DURATION:!0,SPEED:2}}},function(t,i,n){var a=n(46),s=n(172),r=n(26),o=n(185),l=n(186),c=n(188),d=n(191),h=n(34),u=n(26);let p=n(1);n(33),n(8);var g=n(22);const f=n(192);var m=function(){var t=this,i=!1;this.d={},this.$worldPane,this.$mapLoaderSplash,this.canvasObjectType=p.MAP,this.focusTarget=null,this.focusNow=null,this.collider=!0,this.offset=[0,0],this.mode=null,this.water=[],this.src=null,this.imgLoaded=!1,this.offsetIsSet=!1,this.size={x:null,y:null},this.goMark=null;let n={minLeft:null,maxLeft:null,minTop:null,maxTop:null};this.alwaysDraw=!0;let a={r:null,g:null,b:null,a:null};var m=!1,v=!1,E=!1;this.col=new s;var _=null;let b=null,w=!1;this.init=function(){this.config=new f,this.$worldPane=Engine.interface.get$gameLayer(),this.$mapLoaderSplash=Engine.interface.get$gameLayer().find(".map-reloader-splash"),this.lock=new Lock(["game_init"],(function(){Engine.lock.remove("mapLoadedAndAllInit"),E=!0,t.hideLoaderSplash(),getEngine().map.setForceRender(!0),t.update(0),t.serveRayControllerData([g.PROGRAMMER,g.WEATHER,g.CONNECT_SRAJ,g.RANDOM_CALLER,g.SCREEN_EFFECTS,g.SEQUENCE,g.FLOAT_OBJECT,g.FLOAT_FOREGROUND,g.NIGHT,g.MAP_FILTER,g.EARTHQUAKE,g.TUTORIAL,g.SOUND,g.AREA_TRIGGER,g.MAP_MUSIC,g.ZOOM,g.TRACKING])})),this.gateways=new l(t),this.groundItems=new c,this.groundItems.init(),this.rip=new o(t),this.questProgressBar=new d},this.setExternalProperties=t=>{b=t},this.getExternalProperties=()=>b,this.getSpecificKeyFromExternalProperties=t=>b[t],this.getMapMusicFromSraj=()=>b&&b[g.MAP_MUSIC]?b[g.MAP_MUSIC]:null,this.blockMove=function(){m=!0},this.getMoveBlock=function(){return m},this.getDrawable=function(){return v},this.isFocusSet=()=>null!==t.focusNow&&null!==T,this.getUnlock=function(){return E},this.setUnlock=function(t){E=Boolean(t)},this.unBlockMove=function(){m=!1},this.setSetings=function(){var e=Engine.opt(19);t.setAnimated(!!e)},this.setAnimated=function(t){i=t},this.beforeUpdate=function(e){t.setExternalProperties(null),e.params&&(t.config.setDefaults(),t.config.update(e.params))},this.showLoaderSplash=function(){t.setOffsetIsSet(!1),Engine.opt(23)||(Engine.interface.get$GAME_CANVAS().css("display","none"),t.$mapLoaderSplash.html("<div>"+_t("changing_location",null,"map")+"</div>"),t.$mapLoaderSplash.stop(!0,!0),t.$mapLoaderSplash.css({display:"block",opacity:1}))},this.hideLoaderSplash=function(){E&&(Engine.interface.get$GAME_CANVAS().css("display","block"),Engine.opt(8)?t.$mapLoaderSplash.css("display","none"):t.$mapLoaderSplash.fadeOut(300))},this.getBackgroundColor=()=>a;const C=()=>{this.config.getIsQuestFogEnabled()&&getEngine().questMapBorderManager.prepareBorderCanvas({r:a.r,g:a.g,b:a.b})};this.setBackgroundColor=function(t){let e;if(isset(t))e=t;else{var i=document.createElement("canvas").getContext("2d");i.drawImage(_,0,0),e=i.getImageData(0,0,1,1).data}a.r=e[0],a.g=e[1],a.b=e[2],a.a=1,Engine.interface.get$gameLayer().css("background","rgba("+e[0]+", "+e[1]+", "+e[2]+", 1)")},this.createCollisionMap=function(){null!==t.size.x&&null!==t.size.y&&(h.createMap(t.size),t.col.setMapSize(t.size))},this.refreshRayControllerData=t=>{if(this.getExternalProperties())if(Array.isArray(t))for(let e in t)this.refreshOneKeyInMapExternalProperties(t[e]);else errorReport("Map.js","this.refreshRayControllerData","mapExternalPropertiesRefresh must be array!",t);else errorReport("Map.js","this.refreshRayControllerData","external_properties not exist in this map!")},this.refreshOneKeyInMapExternalProperties=t=>{if(!Engine.rajController.checkRajKeyExist(t))return void errorReport("Map.js","refreshRayControllerData","Key: "+t+" not exist in RajData!");if(!this.keyExistInExternalProperties(t))return void errorReport("Map.js","refreshRayControllerData","Key: "+t+"not exist in map external_properties!");let e=this.getSpecificKeyFromExternalProperties(t);Engine.rajController.parseObject({[t]:e})},this.keyExistInExternalProperties=t=>!!b[t],this.serveRayControllerData=e=>{b&&Engine.rajController.parseObject(b,e,{mapId:t.d.id})},this.afterOnload=()=>{t.imgLoaded=!0,Engine.loader.load("map"),t.width=_.width,t.height=_.height,t.size={x:t.width/CFG.tileSize,y:t.height/CFG.tileSize},u.setKeyboardSystem(t.d.id),Engine.map.centerOn(Engine.hero.rx,Engine.hero.ry),v=!0,Engine.allInit&&Engine.startGameThread(),t.hideLoaderSplash(),t.setBackgroundColor(),C(),Engine.miniMapController.updateMiniMapWindow(),Engine.miniMapController.showMyLoc(),Engine.hero.updateCollider(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,15),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,15)},this.onUpdate=new function(){this.file=function(e,i){t.src=CFG.a_mpath+e,Engine.lock.add("mapLoadedAndAllInit"),Engine.imgLoader.onload(t.src,!1,e=>{fixCorsForTaintedCanvas(e),m=!1,t.imgLoaded=!1,_=e},e=>{t.afterOnload()})},this.external_properties=function(e){t.setExternalProperties(e)},this.x=function(e,i){t.size.x=e,t.createCollisionMap()},this.y=function(e,i){t.size.y=e,t.createCollisionMap()},this.name=function(t,e){const i=Engine.interface.get$interfaceLayer().find(".location"),n=_t("location_name");i.html(escapeHTML(t)).tip(n+parseBasicBB(t))},this.pvp=function(t){var e={0:"green",1:"yellow",2:"red",4:"orange"},i=_t("pvp_mode",null,"map"),n=_t("click_to_show_killers",null,"map"),a=_t("conquer-stats-tip"),s=Engine.map.config.getIsPartiesDisabled()?_t("party_off"):_t("party_on"),r=`${_t("party",null,"map")}: ${s}`,o=Engine.worldConfig.getPvp()?a:n;Engine.interface.get$interfaceLayer().find(".map_ball").removeClass("yellow green red orange").addClass(e[t]).tip(i+" "+_t("pvp_"+e[t])+"<br/>"+r+"<br/><br/>"+o)},this.mode=function(e){t.mode=e},this.conquer=function(t){if(!t){var e=Engine.interface.get$interfaceLayer().find(".map_ball"),i=e.getTipData(),n="<br /><br />"+_t("location_conquer_possible");e.tip(i+n)}},this.visibility=function(t){Engine.warShadow.setWarRange(t)},this.water=function(e){var i=e.split("|"),n=null;for(var a in i)for(var s=1*(n=i[a].split(","))[0];s<=1*n[1];s++)t.water[s+256*n[2]]=4*n[3]},this.welcome=function(t){message(t)}},this.afterUpdate=function(e){t.updateCanvasSizeMinMaxWHClipOffset(0),b&&t.serveRayControllerData([g.CHARACTER_EFFECT,g.YELLOW_MESSAGE,g.FAKE_NPC,g.EMO_DEFINITIONS,g.EMO_ACTIONS,g.DYNAMIC_LIGHT,g.DYNAMIC_DIR_CHARACTER_LIGHT,g.BEHAVIOR_DYNAMIC_LIGHT,g.MAP_EVENTS,g.CHARACTER_IMAGE_CHANGER]),t.getMapMusicFromSraj()||Engine.soundManager.setMusic(),Engine.worldWindow.locationParameters&&Engine.worldWindow.locationParameters.updateParameters()},this.getTranslatedMousePos=function(t,e){return this.getCorrectAutoGoPos(Math.floor(t/CFG.tileSize),Math.floor(e/CFG.tileSize))},this.getCorrectAutoGoPos=function(e,i){return{x:e=Math.max(0,Math.min(t.size.x,e)),y:i=Math.max(0,Math.min(t.size.y,i))}},this.getTranslatedPixelMousePos=function(i,n){return{x:e.clientX-$(this).offset().left+t.map.offset[0],y:e.clientY-$(this).offset().top+t.map.offset[1]}},this.setNpcCollision=function(){},this.setCollisions=function(t){this.col.setCl(t),isset(Engine.hero.pet)&&Engine.hero.pet.calculatePosition()},this.centerOn=function(t,e){if(!m)return null==this.focusTarget&&null==this.focusNow?(this.focusTarget=[t,e],void(this.focusNow=[t,e])):void(this.focusTarget=[t,e])};var T=null;this.setFocusNowLikeFocusTager=()=>{t.focusNow=t.focusTarget},this.setfocusNowAndFocusTarget=e=>{let i=t.focusNow,n=t.focusTarget,a=Math.sqrt(Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)),s=a/50,r=[n[0]-i[0],n[1]-i[1]];if(a<.05)t.setFocusNowLikeFocusTager();else{let i=Math.min(5*e,.4);t.focusNow[0]+=r[0]*(s>1?1:i),t.focusNow[1]+=r[1]*(s>1?1:i)}},this.updateCanvasSizeMinMaxWHClipOffset=e=>{var a=this.getEngine().getCanvasViewSize();if(null==t.focusNow||null==t.focusTarget)return;i?t.setfocusNowAndFocusTarget(e):t.setFocusNowLikeFocusTager();let s=Engine.zoomManager.getActualZoom(),r=CFG.tileSize,o=CFG.halfTileSize,l=a.width?a.width:window.innerWidth,c=a.height?a.height:window.innerHeight,d=t.size.y*r*s,h=t.size.x*r*s;var u=t.focusNow[0]*r+o,p=t.focusNow[1]*r+o,g=Math.min(d/2,c/s/2),f=Math.min(h/2,l/s/2),m=Math.max(0,u-f),E=Math.max(0,p-g);T=[Math.min(m,Math.max(h/s-l/s,0)),Math.min(E,Math.max(d/s-c/s,0)),Math.min(l,h),Math.min(c,d)],t.offset=[T[0]-(l/2-T[2]/2),T[1]-(c/2-T[3]/2)],t.minX=t.offset[0]/r,t.minY=t.offset[1]/r,t.maxX=this.minX+l/r,t.maxY=this.minY+c/r,n.minLeft=T[0]-Engine.map.offset[0],n.maxLeft=T[0]+T[2]-Engine.map.offset[0],n.minTop=T[1]-Engine.map.offset[1],n.maxTop=T[1]+T[3]-Engine.map.offset[1],v&&!t.offsetIsSet&&t.setOffsetIsSet(!0)},this.update=function(e){if(Engine.allInit)return t.updateCanvasSizeMinMaxWHClipOffset(e),t.getGroundItems().update(e),t.getGateways().update(e),!0},this.setOffsetIsSet=t=>{this.offsetIsSet=t},this.getOffsetIsSet=()=>this.offsetIsSet,this.getOrder=function(){return 0},this.blockDrawable=function(){v=!1};let y=null;this.drawold=function(e){if(v&&t.isFocusSet()){var i=Engine.getCanvasViewSize();let t=Engine.mapShift.getShift(),e=[T[0]+t[0],T[1]+t[1],T[2]+t[0],T[3]+t[1]];var n=e[2],a=e[3];let s=getEngine().getCtxMap(),r=Engine.zoomManager.getActualZoom(),o=r!=s.globalAlpha;if(!(()=>{if(!y)return!0;if(w)return!0;return!(T[0]==y[0]&&T[1]==y[1]&&T[2]==y[2]&&T[3]==y[3])})())return;A(!1);let l=s;y=[T[0],T[1],T[2],T[3]],o&&l.save(),l.clearRect(0,0,l.canvas.width,l.canvas.height),o&&l.scale(r,r),l.drawImage(_,Math.round(e[0]),Math.round(e[1]),n,a,Math.round(i.width/2-e[2]/2),Math.round(i.height/2-e[3]/2),n,a),o&&l.restore()}};this.partial=!1,this.draw=function(e){if(v&&t.isFocusSet()){var i=Engine.getCanvasViewSize();let s=Engine.mapShift.getShift(),r=[T[0]+s[0],T[1]+s[1],T[2]+s[0],T[3]+s[1]];var n=r[2],a=r[3];if(t.partial){let s=n/2,o=a/2;t.drawImage(e,s,o,0,0,r,i),t.drawImage(e,s,o,s,0,r,i),t.drawImage(e,s,o,0,o,r,i),t.drawImage(e,s,o,s,o,r,i)}else t.drawImage(e,n,a,0,0,r,i)}},this.drawImage=(t,e,i,n,a,s,r)=>{t.drawImage(_,Math.round(s[0]+n),Math.round(s[1]+a),e,i,Math.round(r.width/2-s[2]/2+n),Math.round(r.height/2-s[3]/2+a),e,i)};this.onclick=function(e){let i=Engine.zoomFactor,n=Engine.zoomManager.getActualZoom();if(!Engine.opt(7)){let a=Engine.interface.get$gameLayer().offset(),s=t.getTranslatedMousePos(e.clientX-a.left/i/n+t.offset[0],e.clientY-a.top/i/n+t.offset[1]);Engine.hero.autoGoTo(s,!1),r.setMoveDirection(null)}-1,Engine.dialogue&&Engine.dialogue.checkIsBubbleCloud()};var I=!1;this.mousePos=null,this.moveDir=null,this.onmousedown=t=>{(new Date).getTime(),blockMouseOnSpecificMap()||(1==t.which&&(Engine.hero.blockMove=!1,I=!0,this.mousePos={clientX:t.clientX,clientY:t.clientY}),3==t.which&&(Engine.hero.blockMove=!1))},this.onmouseup=t=>{I=!1,this.mousePos=null,r.setMoveDirection(null)},this.onmousemove=t=>{I&&!Engine.opt(7)&&(this.mousePos={clientX:t.clientX,clientY:t.clientY},this.setDirFromMousePosition())},this.setDirFromMousePosition=function(){if(!Engine.map.mousePos)return;let t=Engine.interface.get$GAME_CANVAS();var e=Math.atan2((Engine.hero.d.y-Math.floor(Engine.map.offset[1]/CFG.tileSize))*CFG.tileSize+t.offset().top-Engine.map.mousePos.clientY,(Engine.hero.d.x-Math.floor(Engine.map.offset[0]/CFG.tileSize))*CFG.tileSize+t.offset().left-Engine.map.mousePos.clientX);e>2.25||e<=-2.25?Engine.map.moveDir=Engine.map.col.check(Engine.hero.d.x+1,Engine.hero.d.y)?e>=0?"N":"S":"E":e>.75&&e<=2.25?Engine.map.moveDir=Engine.map.col.check(Engine.hero.d.x,Engine.hero.d.y-1)?e>=1.5?"E":"W":"N":e>-.75&&e<=.75?Engine.map.moveDir=Engine.map.col.check(Engine.hero.d.x-1,Engine.hero.d.y)?e>=0?"N":"S":"W":e>-2.25&&e<=-.75&&(Engine.map.moveDir=Engine.map.col.check(Engine.hero.d.x,Engine.hero.d.y+1)?e>=-1.5?"W":"E":"S"),r.setMoveDirection(Engine.map.moveDir)};this.setDrawable=function(t){v=t},this.onClear=function(){this.setBackgroundColor([0,0,0]),this.goMark=null,this.focusTarget=null,this.focusNow=null,this.water=[],this.d={},this.size={x:null,y:null},this.col.onClear(),this.getGroundItems().clear(),this.getGateways().clear(),this.getRips().clear(),this.getQuestProgressBar().clear()},this.onResize=()=>{let t=Engine.interface.get$GAME_CANVAS();t.width()<=0||t.height()<=0?this.blockDrawable():this.setDrawable(!0)},this.getGroundItems=()=>{if(!isset(this.groundItems))throw Error("this.groundItems is not defined");return this.groundItems},this.getGateways=()=>{if(!isset(this.gateways))throw Error("this.gateways is not defined");return this.gateways},this.getRips=()=>{if(!isset(this.rip))throw Error("this.rip is not defined");return this.rip},this.getQuestProgressBar=()=>{if(!isset(this.questProgressBar))throw Error("this.questProgressBar is not defined");return this.questProgressBar},this.getEngine=()=>Engine,this.getClip=()=>T,this.clipObject=(t,e,i,a)=>{let s=n.minLeft,r=n.maxLeft,o=n.minTop,l=n.maxTop,c={left:t,top:e,backgroundPositionX:0,backgroundPositionY:0,width:i,height:a};if(t>r)return null;if(e>l)return null;if(c.left<s){let t=Math.abs(c.left-s);if(c.width=c.width-t,c.width<=0)return null;c.backgroundPositionX=t,c.left=s}if(c.left+c.width>r&&(c.width=c.width-(c.left+c.width-r)),c.top<o){let t=Math.abs(c.top-o);if(c.height=c.height-t,c.height<=0)return null;c.backgroundPositionY=t,c.top=o}return c.top+c.height>l&&(c.height=c.height-(c.top+c.height-l)),c},this.getMinLeftMaxLeftAndMinTopMaxTop=()=>n;const A=t=>{w=t};this.getMinX=()=>this.minX,this.getMinY=()=>this.minY,this.getMaxX=()=>this.maxX,this.getMaxY=()=>this.maxY,this.setForceRender=A,this.getOffset=()=>this.offset};(m.prototype=Object.create(a.prototype)).constructor=m,t.exports=m},function(t,e,i){var n=i(34);t.exports=function(){var t=this,e=null,i=[],a=null,s=null,r=[],o=!1;let l={};var c=null;this.flushQueue=function(){for(var t=0;t<r.length;t++){var e=r[t];this.set(e.x,e.y,e.type)}r=[]},this.set=function(t,e,s){null!=a?(o&&n.changeCollision(t,e,s),i[e*a+t]|=s):r.push({x:t,y:e,type:s})},this.unset=function(t,e,s){var r=e*a+t;i[r]&=~s,n.changeCollision(t,e,i[r])},this.check=function(t,e,n){if(t<0||e<0||t>a-1||e>s-1)return 4;var r=i[t+e*a];return isset(r)?isset(n)?r&n:r:0},this.setMapSize=function(t){a=t.x,s=t.y,c.unlock("map")},this.setCl=function(t){e=t,c.unlock("cl"),Engine.lock.remove("cl")},this.setStaticCols=function(){for(var t=0,i=new Array,n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s>95&&s<123)for(var r=95;r<s;r++)for(var o=0;o<6;o++)i[t++]=0;else{s-=32;for(r=0;r<6;r++)i[t++]=s&Math.pow(2,r)?1:0}}for(n=0;n<i.length;n++)this.set(n%a,Math.floor(n/a),i[n])},this.setStaticColsCache=function(){let t=Engine.map.d.id;if(l[t])i=JSON.parse(JSON.stringify(l[t].col));else{l[t]={col:null,index:[]};for(var n=0,s=new Array,r=0;r<e.length;r++){var o=e.charCodeAt(r);if(o>95&&o<123)for(var c=95;c<o;c++)for(var d=0;d<6;d++)s[n++]=0;else{o-=32;for(c=0;c<6;c++)s[n++]=o&Math.pow(2,c)?1:0}}for(r=0;r<s.length;r++){let e=r%a,n=Math.floor(r/a),o=e+n*a;this.set(e,n,s[r]),i[o]&&l[t].index.push(o)}l[t].col=JSON.parse(JSON.stringify(i))}},this.onClear=function(){e=null,i=[],a=null,s=null,r=[],"undefined"==typeof RUNNING_UNIT_TEST&&(c=new Lock(["map","cl"],(function(){o=!1,t.setStaticCols(),t.setStaticColsCache(),t.flushQueue(),n.readCollisions(t),n.readCollisions(l[Engine.map.d.id].index,!0),o=!0})))},this.test=function(){for(var t="",e=0;e<i.length;e++)t+=(e%a?"":"\n")+this.check(e%a,Math.floor(e/a));console.log(t),console.log(a),console.log("length: "+i.length)}}},function(t,e,i){var n=i(92),a=function(t){n.call(this,t.x,t.y,8);for(var e=[],i=[],a=0;a<this.getHeight();a++)for(var s=0;s<this.getWidth();s++){var r=this.createNode(s,a);e[r.id]=r}this.setNodes(e);for(a=0;a<this.getChunksRows();a++)for(s=0;s<this.getChunksInRow();s++)i.push(this.createChunk(s,a));this.setChunks(i),this.createNeighborConnections()};(a.prototype=Object.create(n.prototype)).constructor=a,t.exports=a},function(t,e,i){var n=i(175),a=function(t,e,i,n,a){this.id=t,this.x=e,this.y=i,this.size=n,this.map=a,this.nodes=[],this.zones=[],this.blockedZone=this.map.createChunkZone(this,!0),this.blockedZone.setCorruption(),this.awaitingReload=!1,this.boundary={sx:this.x*this.size,mx:(this.x+1)*this.size-1,sy:this.y*this.size,my:(this.y+1)*this.size-1}};a.prototype.getId=function(){return this.id},a.prototype.setNodes=function(t){this.nodes=t;for(var e=0;e<this.nodes.length;e++){this.nodes[e].setChunk(this)}this.awaitingReload=!0},a.prototype.reloadGroups=function(){if(this.awaitingReload){this.awaitingReload=!1;for(var t=0;t<this.zones.length;t++){var e=this.zones[t];e.isCorrupted()&&(this.removeZone(e),t--)}this.reloadBlockedZone();for(var i=this.findEmptyNode();null!==i;){var a=new n(i);a.finalize(),this.connectNodesInZone(a.matched),i=this.findEmptyNode()}}},a.prototype.removeZone=function(t){var e=this.zones.indexOf(t);this.map.removeChunkZone(t),-1!==e&&this.zones.splice(e,1)},a.prototype.reloadBlockedZone=function(){this.blockedZone.clear();for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];e.isBlocked()?this.addNodeToZone(e,this.blockedZone):e.clearIgnore()}},a.prototype.connectNodesInZone=function(t){for(var e={sx:[],sy:[],mx:[],my:[]},i=this.map.createChunkZone(this,!1),n=0;n<t.length;n++){var a=t[n];a.x===this.boundary.sx&&e.sx.push(a),a.x===this.boundary.mx&&e.mx.push(a),a.y===this.boundary.sy&&e.sy.push(a),a.y===this.boundary.my&&e.my.push(a),this.addNodeToZone(a,i)}i.setEdges(e),this.zones.push(i)},a.prototype.createConnection=function(){for(var t in this.zones){var e=this.zones[t];if(!e.hasEdges())continue;e.nodes.find(t=>7===t.x&&8===t.y);var i=e.getEdges();this.connectWithOffset(i.sx,{x:-1,y:0}),this.connectWithOffset(i.mx,{x:1,y:0}),this.connectWithOffset(i.sy,{x:0,y:-1}),this.connectWithOffset(i.my,{x:0,y:1}),e.isConnected()||this.map.createSingleConnectionChunkZone(e)}},a.prototype.connectWithOffset=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(!n.isBlocked()){var a=n.x+e.x,s=n.y+e.y;if(this.map.isCorrectPosition(a,s)){var r=this.map.getNode(a,s);r.isBlocked()||this.map.connectNodesChunkZone(n,r)}}}},a.prototype.findEmptyNode=function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(e.isChunkZoneEmpty()&&!e.isBlocked())return e}return null},a.prototype.addNodeToZone=function(t,e){null!==t.chunkZone&&t.chunkZone!==this.blockedZone&&this.removeZone(t.chunkZone),e.addNode(t),t.setChunkZone(e)},a.prototype.setToReload=function(){this.awaitingReload=!0},a.prototype.findZoneForNode=function(t,e){for(var i in this.zones){var n=this.zones[i];if(n.containsNode(t,e))return n}return null},t.exports=a},function(t,e,i){var n=i(64),a=function(t){n.call(this),this.node=t,this.matched=[]};(a.prototype=Object.create(n.prototype)).constructor=a,a.prototype.prepare=function(){this.node.isBlocked()||(this.node.setIgnore(),this.openSet.push(this.node))},a.prototype.checkNode=function(){this.currentNode.setIgnore(),this.matched.push(this.currentNode);var t=this.currentNode.neighbors;for(var e in t){var i=t[e];i.isBlocked()||i.isIgnored()||!i.isOnSameChunk(this.node)||(i.setIgnore(),this.openSet.push(i))}},t.exports=a},function(t,e){var i=function(t,e,i){this.parent=t,this.closeFlag=e,this.idProvider=i,this.nodes=[],this.edges={sx:[],sy:[],mx:[],my:[]},this.connectionId=null,this.corrupted=!1};i.prototype.setCorruption=function(){this.corrupted=!0,this.parent.setToReload()},i.prototype.isCorrupted=function(){return this.corrupted},i.prototype.clear=function(){this.unassignNodes(),this.connectionId=null,this.edges={sx:[],sy:[],mx:[],my:[]}},i.prototype.addNode=function(t){this.nodes.push(t)},i.prototype.unassignNodes=function(){this.nodes.forEach(t=>{t.setChunkZone(null)}),this.nodes=[]},i.prototype.setEdges=function(t){this.edges=t},i.prototype.hasEdges=function(){return this.edges.sx.length>0||this.edges.mx.length>0||this.edges.sy.length>0||this.edges.my.length>0},i.prototype.getEdges=function(){return this.edges},i.prototype.isConnectedWith=function(t){return null!==this.connectionId&&this.connectionId===t.connectionId},i.prototype.setConnectionId=function(t){this.releaseConnectionId(),this.connectionId=this.idProvider.use(t)},i.prototype.isConnected=function(t){return null!==this.connectionId},i.prototype.releaseConnectionId=function(){null!==this.connectionId&&this.idProvider.release(this.connectionId),this.connectionId=null},t.exports=i},function(t,e){var i=function(){this.set=[0]};i.prototype.getFree=function(){for(var t=0;t<this.set.length;t++)if(this.set[t]<=0)return this.set[t],t;return this.set.push(0),this.set.length-1},i.prototype.use=function(t){return this.set[t]++,t},i.prototype.release=function(t){return this.set[t]--,null},t.exports=i},function(t,e,i){var n=i(179),a=function(t,e,i){n.call(this),this.x=t,this.y=e,this.id=e*i.getWidth()+t,this.mapCollision=!1,this.ignored=!1,this.neighbors=[]};(a.prototype=Object.create(n.prototype)).constructor=a,a.prototype.findAndSetNeighbors=function(t){this.neighbors=t.getNeighbors(this)},a.prototype.getId=function(){return this.id},a.prototype.isNeighbor=function(t){return Math.abs(t.x-this.x)<=1&&Math.abs(t.y-this.y)<=1},a.prototype.getHCETo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},a.prototype.getHCE8To=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},a.prototype.isPosition=function(t){return t.x===this.x&&t.y===this.y},a.prototype.getPosition=function(){return{x:this.x,y:this.y}},a.prototype.setCollision=function(t){this.mapCollision=t>0,null!==this.chunkZone&&this.chunkZone.setCorruption()},a.prototype.isBlocked=function(){return this.mapCollision},a.prototype.clearIgnore=function(){this.ignored=!1},a.prototype.setIgnore=function(){this.ignored=!0},a.prototype.isIgnored=function(){return this.ignored},t.exports=a},function(t,e){var i=function(){this.chunk=null,this.chunkZone=null};i.prototype.setChunk=function(t){this.chunk=t},i.prototype.setChunkZone=function(t){this.chunkZone=t},i.prototype.isChunkZoneEmpty=function(){return null===this.chunkZone},i.prototype.isOnChunk=function(t){return this.chunk===t},i.prototype.isOnSameChunk=function(t){return null!==this.chunk&&(null!==t.chunk&&this.chunk===t.chunk)},i.prototype.isConnectedWith=function(t){return null!==this.chunkZone&&(null!==t.chunkZone&&this.chunkZone.isConnectedWith(t.chunkZone))},i.prototype.getChunkId=function(){return null!==this.chunk?this.chunk.getId():null},t.exports=i},function(t,e){var i=function(t){this.node=t,this.fScore=null};i.prototype.setScore=function(t){var e=this.node.getHCETo(t);this.fScore=this.node.getGScore()+e},i.prototype.isLowerScore=function(t){return this.fScore<t.fScore},t.exports=i},function(t,e,i){var n=i(182),a=i(183),s=(i(94),i(93),function(t,e){this.map=t,this.destinationPosition=e,this.endNode=null,this.map.clearDisables()});s.prototype.getRoad=function(t,e,i){var n=this.map.getNode(t,e),s=this.getNearestDestination(n);this.map.clearContext();var r=new a(n,s);r.finalize();var o=this.reconstructRoad(r.endNode,n);return 0===o.length&&(o=this.breakRoad(n,i)),o.length>0&&(this.endNode=o[0]),o},s.prototype.disableNode=function(t,e){this.map.getNode(t,e).disableNode()},s.prototype.getNearestDestination=function(t){var e=this.map.getNode(this.destinationPosition.x,this.destinationPosition.y);if(!e.isConnectedWith(t)){var i=new n(e,t);return i.finalize(),this.map.clearContext(),i.getLowerCostNodes()}return[e]},s.prototype.breakRoad=function(t,e){for(var i=[],n=!1,a=e.length-1;a>0;a--){var s=e[a];if(s.isBlocked())break;n&&i.unshift(s),n||s!=t||(n=!0)}return i},s.prototype.reconstructRoad=function(t,e){var i=[],n=t;if(null===n)return i;for(;n!=e;)i.push(n),n=n.getFrom();return i},t.exports=s},function(t,e,i){var n=i(64),a=function(t,e){n.call(this),this.node=t,this.destination=e,this.probably=[],this.lastDistance=null};(a.prototype=Object.create(n.prototype)).constructor=a,a.prototype.prepare=function(){this.node.setStartNodes([this.destination]),this.openSet.push(this.node)},a.prototype.isOpenSetNoEmpty=function(){return this.openSet.length>0},a.prototype.checkNode=function(){this.addToCloseSet(),this.checkNeighbors()},a.prototype.checkNeighbors=function(){var t=this.currentNode.neighbors;for(var e in t){var i=t[e];-1===this.openSet.indexOf(i)&&-1===this.closeSet.indexOf(i)&&this.checkNeighbor(i)}},a.prototype.checkNeighbor=function(t){t.setGScore(this.currentNode.getGScore()+1),null!==this.lastDistance&&this.lastDistance<t.getGScore()||(t.isConnectedWith(this.destination)&&(this.probably.push(t),null===this.lastDistance&&(this.lastDistance=t.getGScore())),this.openSet.push(t))},a.prototype.getLowerCostNodes=function(){var t=[],e=null;for(var i in this.probably){var n=this.probably[i],a=this.getDistance(n);(null===e||e>a)&&(e=a),t.push({node:n,dist:a})}return(t=t.filter((function(t){return t.dist<=e}))).map((function(t){return t.node}))},a.prototype.getDistance=function(t){return t.getHCE8To(this.node)},t.exports=a},function(t,e,i){var n=i(64),a=function(t,e){n.call(this),this.endNode=null,this.source=t,this.destinations=e,this.destinations.length>0&&this.openSet.push(t)};(a.prototype=Object.create(n.prototype)).constructor=a,a.prototype.prepare=function(){this.source.setStartNodes(this.destinations)},a.prototype.isOpenSetNoEmpty=function(){return this.openSet.length>0&&null===this.endNode},a.prototype.getFirstNode=function(){if(this.openSet.length>0){for(var t=0,e=1;e<this.openSet.length;e++)this.openSet[e].isLowerCostThan(this.openSet[t])&&(t=e);var i=this.openSet[t];return this.openSet.splice(t,1),i}return null},a.prototype.checkNode=function(){for(var t in this.destinations)if(this.destinations[t].getId()==this.currentNode.getId())return void(this.endNode=this.currentNode);this.addToCloseSet(),this.checkNeighbors()},a.prototype.checkNeighbors=function(){var t=this.currentNode.neighbors;for(var e in t){var i=t[e];i.isBlocked()||-1!==this.closeSet.indexOf(i)||this.checkNeighbor(i)}},a.prototype.checkNeighbor=function(t){var e=t.getGScore()+1;if(-1===this.openSet.indexOf(t))this.openSet.push(t);else if(e>=t.getGScore())return;t.setPreviousNodes(this.currentNode,this.destinations)},t.exports=a},function(t,e,i){let n=i(1);t.exports=function(t,e,i){let a="Road.js";this.context=e,this.road=[],this.roadNodes=[],this.lastPathCorrupted=!1,this.count=function(){return this.road.length},this.clear=function(){this.road=[],this.free()},this.pop=function(){var t=this.road.pop();return 0===this.road.length&&this.free(),t},this.get=function(t){return this.road[t]},this.free=function(){this.lastPathCorrupted=!1,i()},this.changeCollision=function(t,e,i){i&&(this.context.disableNode(t,e),this.isCollidedNode(t,e)&&(this.road=[],this.lastPathCorrupted=!0))},this.reloadConnections=function(){this.lastPathCorrupted&&(this.lastPathCorrupted=!1,this.findWay())},this.findWay=function(){var t=this.getCharacterPosition();this.roadNodes=this.context.getRoad(t.x,t.y,this.roadNodes),this.createPointsRoad(),0===this.road.length&&this.free()},this.isCollidedNode=function(t,e){var i=this.createPoint(t,e);for(var n in this.roadNodes){if(this.roadNodes[n].isPosition(i))return!0}return!1},this.getCharacterPosition=function(){switch(t.canvasObjectType){case n.FAKE_NPC:case n.HERO:return this.createPoint(t.d.x,t.d.y)}return errorReport(a,"getCharacterPosition","undefined canvasObjectType",t.canvasObjectType),null},this.createPoint=function(t,e){return{x:t,y:e}},this.createPointsRoad=function(){var t=[];for(var e in this.roadNodes)t.push(this.roadNodes[e].getPosition());this.road=t}}},function(t,e){t.exports=function(t){let e={};var i=t;this.updateData=function(t){for(var i=0;i<t.length;i+=8){var a=new n(this);a.init(t.slice(i,i+8)),e[a.d.id]=a,Engine.miniMapController.updateWindowMiniMapRipsPos([a])}},this.update=function(t){for(var i in e)e[i].update(t)},this.clear=function(){e={}},this.delete=function(t,i){let n=slugify(i)+t;Engine.miniMapController.handHeldMiniMapController.getMiniMapRipController().deleteRip(n),delete e[n]},this.getRipByLeftAnd=(t,i)=>{let n=slugify(t);return e[n+i]},this.getRipById=t=>e[t],this.getDrawableList=function(){let t=[];for(let i in e)t.push(e[i]);return t};var n=function(t){var e=this;this.init=function(t){this.slugifiedNick=slugify(t[0]),this.nick=t[0],this.lev=t[1]+t[2],this.rx=t[3],this.ry=t[4],this.left=t[5],this.info=t[6],this.quote=t[7],this.fw=40,this.fh=52,this.img=null,this.warShadowOpacity=0,this.imgLoaded=!1,this.d={id:this.slugifiedNick+this.left,x:this.rx,y:this.ry},this.createObject(),this.createTip(),this.collider={box:[32*e.rx+16-e.fw/2,32*e.ry+32-e.fh,32*e.rx+16+e.fw/2,32*e.ry+32]}},this.changeWarShadowOpacity=function(t){if(1!=e.warShadowOpacity&&e.imgLoaded){if(Engine.opt(8))return e.warShadowOpacity=1;if(e.warShadowOpacity>1)return e.warShadowOpacity=1;e.warShadowOpacity+=2*t}},this.createTip=function(){var t="<b>"+_t("rip_prefix")+" "+this.nick+" ("+this.lev+")</b><br><i>"+this.info+"</i><br><i>"+this.quote+"</i>";this.tip=[t,"t_rip"]},this.setLeft=function(){var t=unix_time(),i=1e3*(300+1*e.left-t);e.opacity=1,setTimeout(e.fadeOut,i)},this.getOrder=function(){return this.ry-.1},this.update=function(t){this.changeWarShadowOpacity(t)},this.fadeOut=function(){var i=setInterval((function(){e.opacity-=.1,e.opacity<.1&&(t.delete(e.left,e.nick),clearInterval(i))}),100)},this.draw=function(t){let n=Engine.mapShift.getShift();var a=32*this.rx+16-this.fw/2-i.offset[0]-n[0],s=32*this.ry-this.fh+32-i.offset[1]-n[1];a=Math.round(a),s=Math.round(s),t.globalAlpha=this.opacity,this.img&&(t.globalAlpha=e.warShadowOpacity,t.drawImage(this.img,0,0,this.fw,this.fh,a,s,this.fw,this.fh),t.globalAlpha=1),t.globalAlpha=1},this.createObject=function(){Engine.imgLoader.onload("/img/rip2.gif",!1,!1,t=>{e.imgLoaded=!0,e.fw=t.width,e.fh=t.height,e.img=t,e.setLeft()})}}}},function(t,e,i){var n=i(47);let a=i(1);t.exports=function(t){var e=this,i=t;this.townnames={};var s=[],r=[];let o,l,c=!1,d=!1,h=!1;Engine.imgLoader.onload("/img/exit.png",!1,t=>{o=t},()=>{c=!0,c&&d&&(h=!0)}),Engine.imgLoader.onload("/img/exit-highlight.png",!1,t=>{l=t},()=>{d=!0,c&&d&&(h=!0)});var u=function(t){this.d=t,this.rx=t.x,this.ry=t.y,this.fw=32,this.fh=32,this.canvasObjectType=a.GATEWAY,this.highlight=!1,this.overMouse=!1,this.warShadowOpacity=0,this.d.affectedId=this.d.id+"x"+this.d.x+"y"+this.d.y;var s=this;let r=null;this.init=()=>{c()};const c=()=>{r=new n,r.init(getEngine().hero,s)};this.getFollowController=function(){return r},this.changeWarShadowOpacity=function(t){if(1!=s.warShadowOpacity){if(Engine.opt(8))return s.warShadowOpacity=1;if(s.warShadowOpacity>1)return s.warShadowOpacity=1;s.warShadowOpacity+=2*t}},this.update=function(t){s.changeWarShadowOpacity(t)},this.getFar=()=>Engine.hero.rx!=this.d.x||Engine.hero.ry!=this.d.y,this.draw=function(t){if(h){let e=Engine.mapShift.getShift();t.globalAlpha=s.warShadowOpacity,t.drawImage(this.highlight?l:o,0,1,32,32,Math.round(32*this.d.x-i.offset[0]-e[0]),Math.round(32*this.d.y-i.offset[1]-e[1]),32,32),t.globalAlpha=s.warShadowOpacity}},this.onhover=function(t,e){this.overMouse=e,getEngine().interface.setDoActionCursor(e)},this.onclick=t=>{t.stopPropagation();let e=this.getFar(),i=Engine.hero;if(e){let t=Engine.map.gateways.getOpenGtwAtPosition(i.d.x,i.d.y);i.addAfterFollowAction(this,(function(){Engine.opt(12)||t&&i.getTroughGateway()}))}else i.getTroughGateway();return e},this.oncontextmenu=t=>{const e=[],i=getEngine().hero;return e.push([_t("go",null,"menu"),function(){i.addAfterFollowAction(s,(function(){i.getTroughGateway()}))}]),getEngine().interface.showPopupMenu(e,t,!0),!0},this.getOrder=function(){return.1},this.addHightlight=function(){this.highlight=!0},this.removeHightlight=function(){this.highlight=!1},this.collider={box:[32*this.d.x,32*this.d.y,32*this.d.x+32,32*this.d.y+32]};var d=escapeHTML(e.townnames[this.d.id])+(this.d.key?"<br>("+_t("require_key",null,"gtw")+")":""),u={min:65535&this.d.lvl,max:this.d.lvl>>16&65535},p=!0;0!=this.d.lvl&&(u.min!=u.max?(d+="<br>"+_t("gateway_availavle",null,"gtw")+(0!=u.min?_t("from_lvl %lvl%",{"%lvl%":u.min},"gtw"):"")+(u.max>=1e3?"":_t("to_lvl %lvl%",{"%lvl%":u.max},"gtw"))+_t("lvl_lvl",null,"gtw"),(0!=u.min&&u.min>Engine.hero.d.lvl||u.max<1e3&&u.max<Engine.hero.d.lvl)&&(p=!1)):(d+="<br>"+_t("gateway_availavle_for %lvl%",{"%lvl%":u.max},"gtw"),u.max!=Engine.hero.d.lvl&&(p=!1)));let g=CFG.debug?" "+this.d.id:"";this.tip=[d+g,""],this.available=p};this.update=function(t){for(var e=0;e<s.length;e++)s[e].update(t)},this.updateData=function(t,i){isset(i)&&(e.townnames=i);for(var n=0;n<t.length;n+=5){var a=new u({id:t[n],x:t[n+1],y:t[n+2],key:t[n+3],lvl:t[n+4]},this.townnames[t[n]]);a.init(),a.d.x==Engine.hero.d.x&&a.d.y==Engine.hero.d.y&&(Engine.hero.autoWalkLock=!0),s.push(a)}},this.clear=function(){s=[]},this.setLockFor=function(t){r.indexOf(t)<0&&r.push(t),this.addHightlight(t)},this.removeLock=function(){r=[]},this.addHightlight=function(t){for(var e=0;e<s.length;e++)s[e].d.id==t&&s[e].addHightlight()},this.removeHightlights=function(t){var e;if(t){if(r.indexOf(t)>=0)return;for(e=0;e<s.length;e++)s[e].d.id==t&&s[e].removeHightlight()}else for(e=0;e<s.length;e++)s[e].removeHightlight()},this.getGtwById=function(t){for(var e=[],i=0;i<s.length;i++)s[i].d.id==t&&e.push(s[i]);return!!e.length&&e},this.getOpenGtwAtPosition=function(t,e){var i=this.getGtwAtPosition(t,e);return i&&i.available?i:null},this.getGtwAtPosition=function(t,e){for(var i=0;i<s.length;i++)if(s[i].d.x==t&&s[i].d.y==e)return s[i]},this.getList=()=>s,this.getDrawableItems=function(){let t=[];for(let e=0;e<s.length;e++){t.push(s[e]);let i=s[e].getFollowController();i.checkFollowGlow()&&t.push(i.getFollowGlow())}return t}}},function(t,e){t.exports=function(){var t=this;this.master=null,this.d={},this.color=null,this.mask=null,this.drawMask=null,this.maskLoad=!1,this.getOrder=function(){return t.master.ry+.1},this.update=function(){this.rx=t.master.rx-.025,this.ry=t.master.ry,this.d.x=t.master.d.x,this.d.y=t.master.d.y},this.createImg=function(){Engine.imgLoader.onload("/img/mask.png",!1,e=>{t.mask=e},()=>{t.fw=t.master.fw+4,t.fh=t.master.fh+4,t.maskLoad=!0})},this.draw=function(e){var i=32*this.rx+16-this.fw/2+(isset(this.offsetX)?this.offsetX:0)-Engine.map.offset[0]+(void 0!==this.leftPosMod?this.leftPosMod:0),n=32*this.ry-this.fh+32+(isset(this.offsetY)?this.offsetY:0)-Engine.map.offset[1];t.createMaskColor(1);var a=Math.round(this.rx)+256*Math.round(this.ry),s=isset(Engine.map.water[a])?n+this.master.waterTopModify:n;i=Math.round(i),s=Math.round(s),t.drawMask&&e.drawImage(t.drawMask,i,s,this.fw,this.fh)},this.updateColor=function(e){var i=e||t.master.d.whoIsHere;t.color=i,t.drawMask=null},this.createMaskColor=function(){if(!t.drawMask&&t.maskLoad){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=32,e.height=48,i.drawImage(t.mask,0,0,t.mask.width,t.mask.height),i.globalCompositeOperation="source-in",i.fillStyle=t.color,i.fillRect(0,0,e.width,e.height),t.drawMask=e}return t.drawMask},this.createObject=function(e,i){t.master=e,t.d.id=t.master.d.id,t.master.leftPosMod&&(t.leftPosMod=t.master.leftPosMod),t.update(),t.updateColor(i),t.createImg()}}},function(t,e,i){var n=i(96);let a=i(47),s=i(1),r=i(12);t.exports=function(){var t=[],e=this,i="/img/gui/it_borders.png",o=0;this.init=function(){e.initFetch(),e.initDrop()},this.initDrop=function(){Engine.map.$worldPane.droppable({accept:".item:not(.shop-item)",drop:function(t,e){var i=e.draggable.data("item");if(!(Engine.trade||Engine.depo||Engine.shop||Engine.auctions||Engine.mails||Engine.bonusReselectWindow||Engine.crafting&&(Engine.crafting.salvage||Engine.crafting.enhancement||Engine.crafting.extraction)))if(i.cl&&r.isBlessSt(i.st))Engine.heroEquipment.dropBless(i.id);else if(e.draggable.hasClass("bottomItem"))Engine.interfaceItems.deleteExistItem(i.id,i);else if(!e.draggable.hasClass("shop-item")){var a=Engine.items.parseItemStat(i.stat),s="Śnieżka"==i.name?"snowball":a.emo,o=Engine.getCollisionAtEvent(t)[0];if(o&&o instanceof n&&void 0!==s){var l=o.d.id;return _g("emo&a="+s+"&id="+l+"&iid="+i.id),!0}var c=_t("item_drop_question",null,"static")+"<br>",d=[];if(isPl()){let t="";Engine.map.d.is_drop_item_tax&&(c+="<br>"+_t("item_throw_*info",null,"static"),t="*"),d.push({txt:_t("item_drop_throw",null,"static")+t,hotkeyClass:"alert-accept-hotkey",callback:function(){return _g("moveitem&st=-1&id="+i.id),Engine.heroEquipment.checkQuestTrack(),!0}})}d.push({txt:_t("item_drop_destroy",null,"static"),hotkeyClass:"",callback:function(){return _g("moveitem&st=-2&id="+i.id),Engine.heroEquipment.checkQuestTrack(),!0}},{txt:_t("item_drop_nothing",null,"static"),hotkeyClass:"alert-cancel-hotkey",callback:function(){return!0}}),mAlert(c,d)}}})},this.getDrawableItems=function(){for(var e=[],i=t.length-1;i>-1;i--){e.push(t[i]);let n=t[i].getFollowController();n.checkFollowGlow()&&e.push(n.getFollowGlow())}return e},this.setGroundItemsAnimationsState=function(e){for(var i in t)t[i].setStaticAnimation(e)},this.getItemById=function(e){for(var i in t)if(t[i].i.id==e)return t[i]},this.getItemsByStatAndVal=function(e,i){let n=[];for(var a in t){let s=t[a].i._cachedStats;s.hasOwnProperty(e)&&s[e]==i&&n.push(t[a])}return n.length?n:null},this.clear=function(){t=[],Engine.items.deleteMessItemsByLoc(Engine.itemsFetchData.NEW_GROUND_ITEM.loc)};var l=function(e){var n=this;this.i=e,this.$=e.$,this.overMouse=!1,this.canvasObjectType=s.M_ITEM,this.frames=null,this.sprite=null,this.activeFrame=0,this.$.data("item",e),this.warShadowOpacity=0,this.imgLoaded=!1,this.tutorialOrder=0,this.waterTopModify=0,this.d={id:e.id},this.hlImg=null,this.drawHl=!1,this.hlLoad=!1;var r=new Lock(["image"],(function(){}));let l=null;this.init=()=>{c()};const c=()=>{l=new a,l.init(getEngine().hero,n)};this.getFollowController=function(){return l},this.createImage=function(){Engine.imgLoader.onload(i,!1,t=>{this.beforeOnloadHL(t)},t=>{this.afterOnloadHL(t)})},this.beforeOnloadHL=t=>{n.fw=32,n.fh=32,n.hlImg=t},this.afterOnloadHL=t=>{n.hlLoad=!0},this.createHl=function(){if(!this.drawHl&&this.hlLoad){this.hlImg.src=i;var t=document.createElement("canvas"),e=t.getContext("2d");t.width=32,t.height=32;var n=this.i.hlPos*this.fw,a=o*this.fh;e.drawImage(this.hlImg,n,a,this.fw,this.fh,0,0,this.fw,this.fh),this.drawHl=t}return this.drawHl},this.updateHl=function(){this.drawHl=!1},this.changeWarShadowOpacity=function(t){if(1!=n.warShadowOpacity&&n.imgLoaded){if(Engine.opt(8))return n.warShadowOpacity=1;if(n.warShadowOpacity>1)return n.warShadowOpacity=1;n.warShadowOpacity+=2*t}},this.increaseTutorialOrder=()=>{this.tutorialOrder=0},this.clearTutorialOrder=()=>{this.tutorialOrder=0},this.draw=function(t){if(this.frames&&this.sprite){t.globalAlpha=n.warShadowOpacity;let e=Engine.mapShift.getShift();this.createHl(),!this.drawHl||4096&Engine.hero.d.opt||t.drawImage(this.drawHl,0,0,32,32,Math.round(32*this.i.x-Engine.map.offset[0]-e[0]),Math.round(32*this.i.y-Engine.map.offset[1]-e[1]),32,32),t.drawImage(this.sprite,0,this.staticAnimation?0:32*this.activeFrame,32,32,Math.round(32*this.i.x-Engine.map.offset[0]-e[0]),Math.round(32*this.i.y-Engine.map.offset[1]-e[1]),32,32),t.globalAlpha=1}},this.onhover=function(t,e){n.overMouse=e,getEngine().interface.setPickUpCursor(e),n.updateExpireItems(e)},this.updateExpireItems=function(t){var i=Engine.interface.get$GAME_CANVAS();e.stat.match(/expires=([0-9]+)/)&&(t?(this.tip=e.getTipData(),e.interval=setInterval((function(){e.setTip(i),i.trigger("tipupdate")}),1e3)):(e.setTip(i,null),clearInterval(e.interval)))},this.setStaticAnimation=function(t){IE?this.staticAnimation=!0:this.staticAnimation=t},this.oncontextmenu=t=>{var e=[];return e.push([_t("take",null,"menu"),function(){Engine.hero.addAfterFollowAction(n,(function(){_g("takeitem&id="+n.d.id)}))}]),Engine.interface.showPopupMenu(e,t,!0),!0},this.getFar=()=>Engine.hero.d.x!=n.i.x||Engine.hero.d.y!=n.i.y;var d=0;this.update=function(t){this.changeWarShadowOpacity(t),this.frames&&this.frames.length>1&&!IE&&(d+=100*t,this.frames[this.activeFrame].delay<d&&(d-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.getOrder=function(){return.1+this.tutorialOrder},this.afterOnloadItem=(t,i)=>{n.fw=32,n.fh=32,n.frames=t.frames,n.activeFrame=0,n.sprite=i,n.collider={box:[32*e.x,32*e.y,32*e.x+32,32*e.y+32]},n.imgLoaded=!0,r.unlock("image"),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,20)},this.gifFetch=function(){let t=CFG.r_ipath+e.icon;Engine.imgLoader.onload(t,{speed:!1,externalSource:cdnUrl},!1,(t,e)=>{n.afterOnloadItem(e,t)})},e.on("delete",(function(){t.splice(t.indexOf(n),1)})),this.createImage(),this.gifFetch(),this.tip=e.getTipData(),this.setStaticAnimation(Engine.opt(8))};this.update=function(e){for(var i=0;i<t.length;i++)t[i].update(e)},this.getGroundItemOnPosition=function(e,i){var n=[];for(var a in t)t[a].i.x==e&&t[a].i.y==i&&n.push(t[a].i);return n},this.initFetch=function(){Engine.items.fetch(Engine.itemsFetchData.NEW_GROUND_ITEM,e.newGroundItem)},this.newGroundItem=function(e){if(e.own==Engine.map.d.id){var i=new l(e);i.init(),i.d={id:e.id,x:e.x,y:e.y},i.rx=e.x,i.ry=e.y,t.push(i)}},this.changeFrames=function(e,n){i=e,o=n;for(let e of t)isset(e.hlImg)&&e.updateHl()}}},function(t,e,i){let n=i(66),a=i(99);i(1);t.exports=function(){this.rx=null,this.ry=null;let t=null,e=null,i=null,s=null;const r="DataDrawer.js",o=()=>{i=new n},l=t=>{e=t},c=()=>{const t=e.getLevel(),i=e.getElasticLevel&&e.getElasticLevel();return t||i?t||(i||void 0):null},d=t=>{(()=>{if(!e.getNick())return errorReport(r,"canCreateDataToDraw","nick not exist",e),!1;const t=e.getKind(),i=getEngine().miniMapController.handHeldMiniMapController,n=i.getDataDrawerNickOfKindByName(t),a=i.getDataDrawerProfAndLevelOfKindByName(t),s=c();return!(!n&&!a)&&!(!n&&a&&!s)})()?E(p(t)):E(!1)},h=i=>{const n=getEngine(),r=n.mapShift.getShift(),o=void 0!==e.leftPosMod?e.leftPosMod:0;let l=0;l+=a.addOffsetOfEmo(e,s.oneLine),l+=a.addOffsetOfKillTimer(e,s.oneLine),l+=a.addOffsetOfCharacterTimer(e);let c=this.rx*CFG.tileSize-n.map.offset[0]-r[0]+o+16,d=this.ry*CFG.tileSize-n.map.offset[1]-r[1]+CFG.tileSize-e.fh-l;t||(t=u()),c=Math.round(c)-t.width/2,d=Math.round(d)-t.height,i.drawImage(t,c,d)},u=()=>{const t=document.createElement("canvas"),n=t.getContext("2d"),a=getEngine().miniMapController.handHeldMiniMapController,r=parseInt(a.getWidthDataDrawer()),o=parseInt(getEngine().miniMapController.handHeldMiniMapController.getFontSizeDataDrawer()),l=a.getColorByKind(e.getKind()),c=s.oneLine?1:2,d=-1*i.getTopTrans(o,c,o);t.width=r+4+20,t.height=d+4;let h=d+2,u=t.width/2;return i.draw(n,s.txt,u,h,o,l,s.maxWidthBorder,2,2),t},p=t=>{const i=getEngine().miniMapController.handHeldMiniMapController,n=parseInt(i.getWidthDataDrawer()),a=i.getFontSizeDataDrawer(),s=e.getNick(),r=e.getKind(),o=e.getProf(),l=c(),d=i.getDataDrawerNickOfKindByName(r),h=i.getDataDrawerProfAndLevelOfKindByName(r);return t.font=a+"px Arial regular",!d&&h?g(t,l,o,n):d&&!h?m(t,s,n):v(t,s,l,o,n)},g=(t,e,i,n)=>{let a=`(${e}${i||""})`,s=f(t,a);return{txt:a,width:s.width,height:s.height,maxWidthBorder:n,oneLine:!0}},f=(t,e)=>{let i=t.measureText(e);return{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent}},m=(t,e,i)=>{let n=e;for(;Math.ceil(t.measureText(n).width)>i;)n=n.slice(0,-1);let a=f(t,n);return{txt:n,width:a.width,height:a.height,maxWidthBorder:i,oneLine:!0}},v=(t,e,i,n,a)=>{let s=null,r=e;for(;Math.ceil(t.measureText(r).width)>a;)r=r.slice(0,-1);" "==r[r.length-1]&&(r=r.slice(0,-1)),i&&(s=Math.ceil(t.measureText(r).width),r+=` (${i}${n||""})`);let o=Math.ceil(t.measureText(r).width);return i&&o<a&&(a=s),{txt:r,width:o,height:f(t,r).height,maxWidthBorder:a,oneLine:!1}},E=t=>{s=t};this.draw=t=>{null===s&&d(t),!1!==s&&h(t)},this.update=t=>{e?(this.rx=e.rx,this.ry=e.ry):errorReport(r,"update","master not exist!")},this.getOrder=()=>getEngine().renderer.getHighestOrderWithoutSort(),this.clearDataToDraw=()=>{E(null),t=null},this.init=t=>{o(),l(t)}}},function(t,e,i){var n=i(0),a=(i(5),i(27));t.exports=function(){var t=this,e=null;this.init=function(){this.initContent(),this.initWindow(),this.initScroll()},this.initWindow=function(){Engine.windowManager.add({content:e,nameWindow:Engine.windowsData.name.WANTED_LIST,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,managePosition:{x:200,y:100},manageOpacity:3,title:_t("wanted",null,"pklist"),manageShow:!0,onclose:()=>{this.closePanel()}}),this.wnd.addToAlertLayer(),this.wnd.updatePos(),this.setStateOfWantedList()},this.initContent=function(){e=n.get("wanted-list")},this.onResize=function(){this.wnd.updatePos()},this.setSize=function(){var i=t.wnd.$.find(".scroll-pane .one-wanted").length;e.css({height:25*i-25})},this.update=function(e,i){var a=n.get("one-wanted").addClass("row-in-trans-window");t.wnd.$.find(".scroll-pane").append(a);var s=a.find(".city .inner"),r=i.town;s.tip(r,"t_static"),s.html(r);a.index();a.find(".nick .inner").html(i.nick),a.find(".cords").html(" ("+i.x+","+i.y+")"),t.createWantedTip(a,i)},this.createWantedTip=function(t,e){var i=isset(e.prof)?e.prof:"",n=0==e.lvl?"":"("+e.lvl+i+")",a='<div class="nick">'+e.nick+" "+n+"</div>";const s=$('<div class="avatar-icon" />');createImgStyle(s,CFG.a_opath+e.icon);var r='<div class="info-wrapper">'+a+"</div>";t.tip("<div class=wanted></div>"+r+'<div class="buffs-wrapper"><div class="wanted-i"></div></div>'+s.prop("outerHTML"),"t_other",null)},this.setVisibleEmptyRecord=function(){var e=t.wnd.$.find(".scroll-pane").children().length>1;t.wnd.$.find(".empty").css("display",e?"none":"block")},this.initScroll=function(){var e=t.wnd.$.find(".scroll-wrapper");t.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0}),e.css("position","absolute")},this.scrollUpdate=function(){$(".scroll-wrapper",e).trigger("update")},this.openPanel=function(){t.wnd.show(),t.wnd.setWndOnPeak()},this.closePanel=function(){t.wnd.hide()},this.toggleVisible=function(){this.wnd.isShow()?this.closePanel():this.openPanel()},this.setStateOfWantedList=function(){a.getShowWindow(Engine.windowsData.name.WANTED_LIST)?this.openPanel():this.closePanel()},this.onResize=function(){t.wnd.updatePos()}}},function(t,e){t.exports=function(){var t,e,i,n=0,a=1,s=!1;this.alwaysDraw=!0,this.setProgress=function(t,e){n=76-t/e*76},this.updateData=function(n){t&&e&&i||(this.setPos(),a=1,Engine.lock.add("progressBar"),t=!0),0===n[0]&&(Engine.lock.remove("progressBar"),this.fadeOut()),this.setProgress(n[0],n[1])},this.fadeOut=function(){if(!s){s=!0;var e=setInterval((function(){(a-=.05)<.1&&(t=!1,s=!1,clearInterval(e))}),50)}},this.clear=function(){t=!1},this.getDrawableList=function(){if(t)return[this]},this.setPos=function(){e=Engine.hero.rx,i=Engine.hero.ry},this.getOrder=function(){return getEngine().renderer.getHighestOrderWithoutSort()},this.draw=function(t){var s=32*e+16-35-Engine.map.offset[0],r=32*i-70+30-Engine.map.offset[1];t.globalAlpha=a,t.beginPath(),t.lineCap="round",t.lineWidth="10",t.strokeStyle="white",t.moveTo(s,r),t.lineTo(s+70,r),t.stroke(),t.beginPath(),t.lineCap="round",t.lineWidth="8",t.strokeStyle="black",t.moveTo(s,r),t.lineTo(s+70,r),t.stroke(),t.fillStyle="green",t.fillRect(s-3,r-3,n,6),t.globalAlpha=1}}},function(t,e,i){"use strict";var n,a,s=this&&this.__classPrivateFieldSet||function(t,e,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(t,i):a?a.value=i:e.set(t,i),i},r=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};t.exports=(a=class{constructor(){n.set(this,void 0),this.setDefaults()}setDefaults(){s(this,n,{lvlMin:null,lvlMax:null,isLvlAddLootRangeEnabled:!1,isPrivRoom:!1,isTeleportBlocked:!1,isRespawnShortened:!1,isClearEnabled:!1,isTimeticketsUsageDisabled:!1,isTpOutAfterOffline:!1,isPartiesDisabled:!1,isChangeOutfitAtDie:!1,isTeleportAt5AM:!1,isPvpLvlAdvantageDisabled:!1,isAlwaysPvpForced:!1,isMakeNoobImmune:!1,isQuestFogEnabled:!1,isBattlePvPQuickModeEnabled:!1,respawn:""},"f")}update(t){s(this,n,Object.assign(Object.assign({},r(this,n,"f")),t),"f")}getLvlMin(){return r(this,n,"f").lvlMin}getLvlMax(){return r(this,n,"f").lvlMax}getIsLvlAddLootRangeEnabled(){return r(this,n,"f").isLvlAddLootRangeEnabled}getIsPrivRoom(){return r(this,n,"f").isPrivRoom}getIsTeleportBlocked(){return r(this,n,"f").isTeleportBlocked}getIsRespawnShortened(){return r(this,n,"f").isRespawnShortened}getIsClearEnabled(){return r(this,n,"f").isClearEnabled}getIsTimeticketsUsageDisabled(){return r(this,n,"f").isTimeticketsUsageDisabled}getIsTpOutAfterOffline(){return r(this,n,"f").isTpOutAfterOffline}getIsPartiesDisabled(){return r(this,n,"f").isPartiesDisabled}getIsChangeOutfitAtDie(){return r(this,n,"f").isChangeOutfitAtDie}getIsTeleportAt5AM(){return r(this,n,"f").isTeleportAt5AM}getIsPvpLvlAdvantageDisabled(){return r(this,n,"f").isPvpLvlAdvantageDisabled}getIsAlwaysPvpForced(){return r(this,n,"f").isAlwaysPvpForced}getIsMakeNoobImmune(){return r(this,n,"f").isMakeNoobImmune}getIsQuestFogEnabled(){return r(this,n,"f").isQuestFogEnabled}getIsBattlePvPQuickModeEnabled(){return r(this,n,"f").isBattlePvPQuickModeEnabled}getRespawn(){return r(this,n,"f").respawn}},n=new WeakMap,a)},function(t,e){t.exports=function(){let t=!1,e=null,i=null,n=null,a=null;this.alwaysDraw=!0;const s=()=>{getEngine().imgLoader.onload("/img/cross.gif",!1,t=>{a=t})},r=()=>{o(!1),l(null),c(null),d(null)},o=e=>{t=e},l=t=>{e=t},c=t=>{i=t},d=t=>{n=t};this.init=()=>{s(),r()},this.update=e=>{if(!t)return;(new Date).getTime()-n>1e3&&r()},this.draw=s=>{if(!t)return;if(!a)return;let r=getEngine().map.getOffset(),o=CFG.tileSize,l=(new Date).getTime()-n,c=Math.max(0,1-l/1e3);s.globalAlpha=c,s.drawImage(a,Math.round(e*o-r[0]),Math.round(i*o-r[1])),s.globalAlpha=1},this.onClear=()=>{r()},this.createMapGoMark=(t,e)=>{o(!0),l(t),c(e),d((new Date).getTime())},this.getOrder=()=>.02}},function(t,e,i){const n=i(195),a=i(49);t.exports=function(){let t="MapAreaCordTriggerManager.js",e=null,i={};const s=()=>{e={}},r=(t,e,i)=>!!t[i]&&!!t[i][e],o=t=>{let e={};for(let i=0;i<t.length;i++){let n=t[i][0],a=t[i][1];e[a]||(e[a]={}),e[a][n]=!0}return e},l=(t,i)=>e[i]&&e[i][t]?!!e[i][t].length:null,c=i=>{let n=i.getXPos(),a=i.getYPos();if(!l(n,a))return void errorReport(t,"removeMapAreaCordTrigger",`cord ${n},${a} not exist not erxist`,e);let s=i.getMapAreaTriggerId(),r=d(n,a);if(r.length)for(let t=0;t<r.length;t++)r[t].getMapAreaTriggerId()==s&&(deleteElementFromArray(t,r),t--);else errorReport(t,"removeMapAreaCordTrigger",`mapAreaCordTriggerArray from cord ${n},${a} is empty!`)},d=(t,i)=>e[i][t],h=(t,i,a)=>{let s=new n;((t,i,n)=>{e[i]||(e[i]={}),e[i][t]||(e[i][t]=[]),e[i][t].push(n)})(t,i,s),s.init(),s.updateData(t,i,a)},u=t=>{let e=t.getSourceXPos(),i=t.getSourceYPos(),n=t.getSourceCols(),a=t.getSourceRows(),s=t.getMapAreaTriggerId(),r=[];for(let t=0;t<n;t++)for(let n=0;n<a;n++){let a=e+t,o=i+n;if(!l(a,o))continue;let c=d(a,o);for(let t=0;t<c.length;t++){let e=c[t];e.getMapAreaTriggerId()==s&&r.push(e)}}return r};this.checkMapAreaColor=t=>!!i[t],this.getMapAreaColor=t=>i[t],this.addMapAreaColor=(t,e)=>{let n=`rgba(${this.round(255)}, ${this.round(255)}, ${this.round(255)}, 40%)`;i[t]=n},this.round=t=>Math.round(Math.random()*t);this.init=()=>{s()},this.updateData=t=>{let e=t.x,i=t.y,n=isset(t.cols)?t.cols:a.defaultData.COLS,s=isset(t.rows)?t.rows:a.defaultData.ROWS,l=isset(t.exceptionCords)?t.exceptionCords:[],c=isset(t.additionalCords)?t.additionalCords:[],d=o(l),u=i+s,p=e+n;for(let n=i;n<u;n++)for(let i=e;i<p;i++)r(d,i,n)||h(i,n,t);for(let e=0;e<c.length;e++){let i=c[e],n=i[0],a=i[1];r(d,n,a)||h(n,a,t)}},this.checkMapAreaCordTrigger=l,this.getMapAreaCordTriggerArrayByPos=d,this.getMapAreaCordTriggerArray=()=>e,this.afterCall=t=>{let e;e=t.getActionOnEachCord()?[t]:u(t);for(let t=0;t<e.length;t++){let i=e[t];i.increaseActualRepeat(),i.checkRepeatIsOver()&&c(i)}},this.removeMapAreaTriggerById=t=>{for(let i in e){let n=e[i];for(let e in n){let i=n[e];for(let e=0;e<i.length;e++)i[e].getMapAreaTriggerId()==t&&(deleteElementFromArray(e,i),e--)}}},this.draw=t=>{if(!CFG.debug)return;let e=Engine.mapAreaCordTriggerManager.getMapAreaCordTriggerArray(),i=Engine.map;for(let n in e){let a=e[n];for(let e in a){let s=a[e];if(s.length)for(let a=0;a<s.length;a++){let r=s[a],o=r.getMapAreaTriggerId();this.checkMapAreaColor(o)||this.addMapAreaColor(o,r),t.fillStyle=this.getMapAreaColor(o),t.fillRect(32*e-i.offset[0],32*n-i.offset[1],32,32)}}}},this.onClear=()=>{s()},this.checkMapAreaTriggerById=t=>{for(let i in e){let n=e[i];for(let e in n){let i=n[e];for(let e=0;e<i.length;e++)if(i[e].getMapAreaTriggerId()==t)return!0}}return!1}}},function(t,e,i){const n=i(49);t.exports=function(){let t,e,i,a,s,r,o,l,c,d,h,u;const p=t=>{i=t},g=t=>{a=t},f=e=>{t=e},m=t=>{e=t},v=t=>{s=t},E=t=>{r=t},_=t=>{o=t},b=t=>{l=t},w=t=>{c=t},C=t=>{h=t},T=t=>{d=t},y=t=>{u=t};this.init=()=>{T(n.defaultData.REPEAT),C(n.defaultData.REPEAT),p(n.defaultData.COLS),g(n.defaultData.ROWS),w(n.defaultData.ACTION_ON_EACH_CORD),y(n.defaultData.kind)},this.updateData=(t,e,i)=>{v(t),E(e),f(i.x),m(i.y),_(i.id),b(i.mapAreaTriggerCallback),isset(i.cols)&&p(i.cols),isset(i.rows)&&g(i.rows),isset(i.repeat)&&T(i.repeat),isset(i.actionOnEachCord)&&w(i.actionOnEachCord),isset(i.kind)&&y(i.kind)},this.callMapAreaTriggerCallback=()=>{l()},this.increaseActualRepeat=()=>{C(h+1)},this.checkIsInfiniteRepeat=()=>!0===d,this.checkRepeatIsOver=()=>!0!==d&&h>d,this.getMapAreaTriggerId=()=>o,this.getActionOnEachCord=()=>c,this.getXPos=()=>s,this.getYPos=()=>r,this.getSourceXPos=()=>t,this.getSourceYPos=()=>e,this.getSourceCols=()=>i,this.getSourceRows=()=>a,this.getKind=()=>u}},function(t,e){t.exports=function(){let t=[0,0];this.init=()=>{},this.getShift=()=>[t[0],t[1]],this.setShift=(e,i)=>{t[0]=e,t[1]=i}}},function(t,e,i){const n=i(4),a=i(3);t.exports=function(){let t="EarthQuakeManager.js",e=0,i=0,s=0,r=null,o=null,l=null;const c=10,d=()=>{l=new n;const e=a.TYPE;l.init(t,{createFunc:f,clearFunc:m,createRequire:{duration:{type:e.NUMBER},quantity:{type:e.INT},frequency:{type:e.NUMBER},power:{type:e.NUMBER,optional:!0}}},a.GROUP_NAME.OVERRIDE_OBJECT)},h=t=>{r&&u();let e=0;r=setInterval(()=>{Engine.mapShift.setShift(w(),w()),e++,e>100*t&&u()},10)},u=()=>{r&&(clearInterval(r),r=null,Engine.mapShift.setShift(0,0))},p=()=>{o&&(clearInterval(o),o=null)},g=()=>{p(),u(),_(c)},f=t=>{g(),v(t.quantity),E(t.duration),b(t.frequency),isset(t.power)&&_(t.power),h(i)},m=()=>{g()},v=t=>{e=t},E=t=>{i=t},_=t=>{s=t},b=t=>{if(0==t)return;let n=1;o=setInterval(()=>{0!=e?n>=e?p():(h(i),n++):h(i)},1e3*t)},w=()=>{let t=Math.random()*s;return Math.round(Math.random())?-t:t};this.init=()=>{d()},this.onClear=g,this.updateData=(t,e)=>{l.checkCorrectMainData(t,e)&&l.updateData(t)}}},function(t,e,i){var n=i(35),a=i(26),s=i(0),r=i(100),o=i(34),l=i(37),c=i(199),d=i(200),h=i(13);let u=i(1),p=i(11);var g=i(8),f=i(9);const m=i(14),v=i(201),{showProfile:E,isMan:_}=i(2),b=i(69);var w=function(){var t,e=this;let i,n,w,C={};this.d={},this.frame=0,this.isPlayer=!0,this.autoPath=o.getEmptyRoad(),this.roadDisplay=new d,this.markOtherObj=!1,this.autoWalkLock=!1,this.canvasObjectType=u.HERO,this.overMouse=!1,this.damageSum="",this.stop=!0,this.onSelfMarginEmo=0,this.goldLimit=!1,this.st,this.tutorialOrder=0,this.waitForDialog=!1,this.teleportLessThan5=!1,this.previewOutfit=!1,this.previewOutfitTimeout=null,this.outfitData={original:null,preview:null};var T=4.9,y=null,I=0,A=!1,k=null,S=null;let O=0,M=null;var N=[p.S,p.W,p.E,p.N],R=null;let x=null,L=null;const D=t=>{n=t};this.getStartClickOnMapMove=()=>n;const P=t=>{w=t},B=t=>{i=t};this.dirMapping=()=>N,this.resetIdleTime=()=>{this.setIdleTime(0)},this.setIdleTime=t=>{O=t},this.incrementIdleTimeByTd=t=>{O+=t},this.getIdleTime=()=>O,this.update=function(t){if(!Engine.allInit)return;this.changeWarShadowOpacity(t),this.calculateNextStep();let i=Engine.lock.check();i||Engine.map.centerOn(this.rx,this.ry),this.animate(t),this.rx!=this.d.x||this.ry!=this.d.y?(this.resetIdleTime(),Engine.canvasFocus.getActive()&&Engine.tutorials.setPosition(),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,1),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,1),e.callCheckCanFinishExternalTutorialMove(),this.move(t),this.stop=!1):(this.incrementIdleTimeByTd(t),this.stop=!0,this.dir!=this.ndir&&(this.frame=0,isset(this.ndir)?this.dir=this.ndir:this.ndir=this.dir)),isset(this.pet)&&this.pet.update(t),isset(this.whoIsHereGlow)&&this.whoIsHereGlow.update(),i||Engine.map.centerOn(this.rx,this.ry)},this.callCheckCanFinishExternalTutorialMove=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(g.ON_FINISH_REQUIRE.MOVE_REQUIRE,g.ON_FINISH_TYPE.REQUIRE,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.callCheckCanFinishExternalTutorialTalkNpc=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(g.ON_FINISH_REQUIRE.TALK_NPC_ID,g.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.callCheckCanFinishExternalTutorialAttackNpc=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(g.ON_FINISH_REQUIRE.ATTACK_NPC_ID,g.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.getAutoGw=function(){return k},this.isMan=()=>_(this.d.gender),this.setCorrectDir=function(t){return!(!this.stop||!isset(this.dir))&&this.dir!=t[this.d.dir]},this.move=function(t){const e=Math.abs(this.rx-this.d.x)+Math.abs(this.ry-this.d.y);if(e>1&&e<=5&&(this.teleportLessThan5=!0),e>5)this.rx=this.d.x,this.ry=this.d.y,this.frame=0,isset(this.pet)&&this.pet.calculatePosition(),this.updateCollider();else{var i=T*t;this.run(i),k&&(clearInterval(k),k=null),A&&(this.teleportLessThan5&&(isset(this.pet)&&this.pet.calculatePosition(),this.teleportLessThan5=!1),this.heroAtackOtherRequest(),this.locationInfo(),A=!1,y=Math.abs(this.rx-this.d.x)||Math.abs(this.ry-this.d.y),this.rx=this.d.x,this.ry=this.d.y,S&&(F(S),S=null),this.calculateNextStep(y)?this.run(y):this.onPositionChange(this.d.x,this.d.y),x.manageTileReach(this.d.x,this.d.y,Engine.mapAreaCordTriggerManager),API.callEvent(Engine.apiData.HERO_MOVE)),this.frame=this.d.x==this.rx&&this.d.y==this.ry?0:Math.floor(2*(this.rx+this.ry))%4}},this.run=function(t){this.rx<this.d.x?(this.rx+=t,A=this.rx>=this.d.x):this.rx>this.d.x&&(this.rx-=t,A=this.rx<=this.d.x),this.ry<this.d.y?(this.ry+=t,A=this.ry>=this.d.y):this.ry>this.d.y&&(this.ry-=t,A=this.ry<=this.d.y),Engine.map.setDirFromMousePosition(),this.updateCollider()},this.autoGoTo=function(t,e){if(blockMouseOnSpecificMap())return mAlert(_t("block_mouse_move"));Engine.hero.rx!=Engine.hero.d.x||Engine.hero.ry!=Engine.hero.d.y?(e||(Engine.hero.blockMove=!1),S=t):(e||(Engine.hero.blockMove=!1),Engine.hero.searchPath(t))},this.samePosWithHero=(t,e)=>Math.floor(Engine.hero.rx)==Math.floor(t)&&Math.floor(Engine.hero.ry)==Math.floor(e),this.setInputParser=()=>{Engine.inputParser=a},this.calculateNextStep=function(t){var e=Engine.stepsToSend.steps,i=Engine.stepsToSend.steps.length;if(i>9)return!1;if(this.rx!=this.d.x||this.ry!=this.d.y||Engine.lock.check())return!1;var n=!0,s=this.d.x,r=this.d.y,o=a.getMoveDirection();if(o)switch(this.clearAutoPathOfHero(),o){case p.W:this.dir==p.W?s=this.d.x-1:this.ndir=p.W;break;case p.E:this.dir==p.E?s=this.d.x+1:this.ndir=p.E;break;case p.N:this.dir==p.N?r=this.d.y-1:this.ndir=p.N;break;case p.S:this.dir==p.S?r=this.d.y+1:this.ndir=p.S}if(this.blockMove&&!t)return!1;if(this.autoPath.count()>0){var l=this.autoPath.pop();o=this.getDirectionFromNextPos(l),this.ndir=this.dir,s=l.x,r=l.y}else this.doActionAfterFinishRoadOfSearchPath();if(i){var c=e[i-1].split(",");Math.abs(s-parseInt(c[0]))+Math.abs(r-parseInt(c[1]))>1&&(n=!1,Engine.stepsToSend.reset())}return!(!n||!this.checkNextTileFromDirection(o))&&(Engine.map.gateways.getOpenGtwAtPosition(this.d.x,this.d.y)||(this.autoWalkLock=!1),this.d.x==s&&this.d.y==r||this.nextStep(s,r),this.d.x=s,this.d.y=r,isset(this.pet)&&this.pet.calculatePosition(),!0)},this.getDirectionFromNextPos=function(t){var e=this.d.x-t.x,i=this.d.y-t.y,n=null;return 0!=e?n=e>0?p.W:p.E:0!=i&&(n=i>0?p.N:p.S),n&&(this.dir=n),n},this.getRefFollowObj=()=>i,this.clearRefFollowObj=()=>{i.getFollowController().clearFollowGlow(),B(null)},this.doActionAfterFinishRoadOfSearchPath=()=>{if(!n)return;D(!1);let t=getEngine().getLastClickOnCanvas();if(i)if(w)w(),this.clearAfterFollowAction();else{if(i.getFar())return void this.clearAfterFollowAction();if(i.canvasObjectType!==u.NPC)return;"click"===t[0].type&&i.onclick(t[0]),"contextmenu"===t[0].type&&i.oncontextmenu(t[0])}},this.addAfterFollowAction=(t,e)=>{let i=t.getFar(),n=t.d.x,a=t.d.y;t.getFollowController&&t.getFollowController().addFollowGlow(),i?(this.autoGoTo({x:n,y:a}),D(!0),P(e)):(this.clearAfterFollowAction(),e())},this.clearAfterFollowAction=()=>{P(null),i&&this.clearRefFollowObj()},this.checkNextTileFromDirection=function(t){var e=null,i={x:Math.floor(this.rx),y:Math.floor(this.ry)};switch(t){case p.N:e=!Engine.map.col.check(i.x,i.y-1);break;case p.S:e=!Engine.map.col.check(i.x,i.y+1);break;case p.W:e=!Engine.map.col.check(i.x-1,i.y);break;case p.E:e=!Engine.map.col.check(i.x+1,i.y)}return e},this.nextStep=function(t,e){Engine.stepsToSend.append({x:t,y:e}),this.d.x=t,this.d.y=e},this.animate=function(t){this.frames&&this.frames.length>1&&t&&(I+=100*t,this.frames[this.activeFrame].delay<I&&(I-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.clearAnimationAndGw=function(){this.activeFrame=0,I=0};var F=function(t){if(Engine.hero.autoPath.clear(),e.roadDisplay.clear(),!isNaN(t.x)&&!isNaN(t.y)&&(e.autoPath=o.find(e,t),Engine.roadDisplay&&e.roadDisplay.setRoad(e.autoPath),e.autoPath.count()>0)){var i=e.autoPath.get(0);getEngine().mapGoMark.createMapGoMark(i.x,i.y)}};this.searchPath=F,this.getHeroNode=()=>o.map.getNode(Engine.hero.d.x,Engine.hero.d.y),this.afterUpdate=function(t,i,n){if(t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&Engine.miniMapController.updateWindowMiniMapHeroPos(t.x,t.y),e.updateTip(),1==t.back||(i.x!=this.d.x||i.y!=this.d.y)&&Engine.lock.check()&&Engine.stepsToSend.steps.length>0)console.log("back"),Engine.stepsToSend.reset(),this.clearAutoPathOfHero(),this.onPositionChange(t.x,t.y);else if(Engine.stepsToSend.steps.length>0&&isset(t.x)&&isset(t.y))if(Engine.stepsToSend.checkAndSlice({x:this.d.x,y:this.d.y}))this.d.x=i.x,this.d.y=i.y;else{var a=Engine.stepsToSend.steps[0].split(",");Math.abs(a[0]-this.d.x)+Math.abs(a[1]-this.d.y)>1&&(Engine.stepsToSend.reset(),this.rx=this.d.x,this.ry=this.d.y,this.pet&&this.pet.calculatePosition())}if(isset(n.d)&&isset(t.dir)){var s=[p.S,p.W,p.E,p.N];e.dir=s[t.dir],e.ndir=e.dir}isset(t.warrior_stats)&&isset(t.warrior_stats.hp)&&(Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,19),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,19),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,19),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,19)),isset(t.lvl)&&isset(i.lvl)&&t.lvl!==i.lvl&&(Engine.widgetManager.rebuildWidgetButtons(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,16)),this.locationInfo(),isset(this.petLock)&&this.petLock.unlock("petUpdate"),e.d.ttl<0?Engine.interface.get$interfaceLayer().find(".exp-progress .progress").addClass("noexp"):Engine.interface.get$interfaceLayer().find(".exp-progress .progress").removeClass("noexp"),this.updateWhoIsHereGlow()},this.clearAutoPathOfHero=()=>{D(!1),this.clearAfterFollowAction(),this.autoPath.clear(),this.roadDisplay.clear()},this.updateTip=function(){var t=e.createStrTip();this.tip=[t,"t_other"]},this.removeBless=function(){delete this.d.is_blessed,this.updateTip()},this.createStrTip=function(){var t="";let i=e.d.uprawnienia;if(i){var n=-1;n=1&i?0:16&i?1:2&i?2:4&i?4:3;var a=[_t("admin",null,"heroranks"),_t("super_mg",null,"heroranks"),_t("mg",null,"heroranks"),_t("chat_mod",null,"heroranks"),_t("super_chat_mod",null,"heroranks")];t+='<div class="rank">'+_t("my_character",null,"map")+" ["+a[n]+"]</div>"}else t+='<div class="rank">'+_t("my_character",null,"map")+"</div>";isset(e.d.guest)&&parseInt(e.d.guest)&&(t+='<div class="rank">'+_t("deputy")+"</div>"),t+=e.setTipHeader(e),isset(e.wanted)&&parseInt(e.wanted)>=90&&(t+="<div class=wanted></div>"),e.d.clan&&(t+='<div class="clan-in-tip">'+escapeHTML(e.d.clan.name)+"</div>");var s={text:t+=e.setBuffsSections(),object:e};return API.callEvent(Engine.apiData.AFTER_CHARACTER_TIP_UPDATE,s),s.text},this.setTipHeader=function(t){var e=isset(t.d.prof)?t.d.prof:"";let i=CFG.debug?" "+t.d.id:"";return'<div class="info-wrapper">'+('<div class="nick">'+t.nick+i+" ("+t.d.lvl+e+")</div>")+"</div>"},this.updateWhoIsHereGlow=function(){e.whoIsHere&&!isset(e.whoIsHereGlow)&&e.imgLoaded&&(e.whoIsHereGlow=new l,e.whoIsHereGlow.createObject(e),e.whoIsHereGlow.updateColor(e.whoIsHere))},this.setBuffsSections=function(){var t="",i=isset(e.d.is_blessed)&&e.d.is_blessed?'<div class="bless"></div>':"",n=1&e.d.attr?'<div class="mute"></div>':"",a=isset(e.d.vip)&&"1"==e.d.vip?'<div class="k-b"></div>':"",s=2&e.d.attr?'<div class="warn"></div>':"",r=e.d.clan?'<div class="line"></div>':"",o=e.d.wanted?'<div class="wanted-i"></div>':"";return""==i&&""==n&&""==a&&""==s&&""==o||(t='<div class="buffs-wrapper">'+r+o+i+n+a+s+"</div>"),t},this.updateGainedExp=function(t){if(t&&t.exp&&t.lvl){if(null!==R){var i=t.exp-R;0!==i&&e.showGainedExp(i,t.lvl)}R=t.exp}},this.showGainedExp=function(t,e){const i=Engine.interface.get$interfaceLayer().find(".gained-exp-indicator");var n=Math.round(Math.pow(e,4)+10),a=Math.round(Math.pow(e-1,4)+10);1==e&&(a=0);var s=t/(n-a),r=Math.round(1e4*s)/100,o=(t>0?"+":"-")+round(t)+" ("+Math.abs(r)+"%)";t>0?i.css("color","lime"):i.css("color","orangered"),i.finish().text(o),i.show().delay(3e3).fadeOut()},this.showDifference=(t,e,i)=>{if(!i||e===i)return;let n,a=formNumberToNumbersGroup(e-i);e>i?(n="+"+a,t.css("color","lime")):(n=a,t.css("color","orangered")),t.finish().text(n),t.show().delay(3e3).fadeOut()},this.beforeOnload=(t,e)=>{const i=t.hdr.width/4,n=t.hdr.height/4,a={kind:"original",fw:i,fh:n,halffw:i/2,halffh:n/2,frames:t.frames,activeFrame:0,sprite:e};this.setOutfitData(a),this.updateCollider()},this.afterLoadImage=()=>{delete e.whoIsHereGlow,e.updateWhoIsHereGlow()},this.onUpdate=new function(){this.id=function(){Engine.loader.load("hero")},this.dir=function(t){this.dir=N[t]},this.lvl=function(t,i){t&&i&&t>i&&Engine.banners.update(!0),Engine.hero.oldLvl=i,e.setLowLvlClass(t),Engine.itemsMarkManager.heroLvlChanged(t)},this.img=function(t,i,n){if(t==i)return;let a,s;null!=Engine.hero.d.img&&(M=Engine.hero.d.img);let r={speed:!0};n.hasOwnProperty("insecureSource")?(a=t,s=e.d.opt,r.insecureSource=!0):(a=CFG.r_opath+fixSrc(t),s=n.opt,r.externalSource=cdnUrl),e.setPlaceHolderIcon(),e.setStaticAnimation(Engine.opt(8,s)),Engine.imgLoader.onload(a,r,(t,i)=>{e.beforeOnload(i,t)},t=>{e.afterLoadImage()},()=>{e.fetchError()})},this.x=function(t,i){this.lastServerX=t,void 0===i&&(e.rx=t)},this.y=function(t,i){this.lastServerY=t,void 0===i&&(e.ry=t)},this.pvp=function(t,e){var i=Engine.interface.get$interfaceLayer().find(".pvp-btn");1==t?i.addClass("fight"):i.removeClass("fight")},this.cur_skill_set=function(t){e.cur_skill_set=t;var i="skill-switch";i+=" skill-set-"+Engine.hero.cur_skill_set,Engine.interface.get$interfaceLayer().find(".skill-switch").attr("class",i)},this.cur_battle_set=function(t){Engine.interface.setActiveInBattleSet(t)},this.credits=function(t){this.showDifference(Engine.interface.get$interfaceLayer().find(".herocredits-difference"),t,Engine.hero.d.credits);const e=t.toString().length>9?4:10,i=round(t,e),n=Engine.interface.get$interfaceLayer().find(".herocredits");n.html(i),n.tip(_t("dragonites")+" "+i),Engine.premium&&Engine.premium.updateSl()},this.mails=function(t){Engine.interface.mailsElements.mailsRefresh(t)},this.mails_all=function(t){Engine.interface.mailsElements.newMail(t)},this.mails_last=function(t){Engine.interface.mailsElements.setRecipient(t)},this.daily_bonus=function(){},this.gold=function(t){this.showDifference(Engine.interface.get$interfaceLayer().find(".herogold-difference"),t,Engine.hero.d.gold);let i=e.getParseGold(t);Engine.interface.get$interfaceLayer().find(".herogold").html(i),e.updateGoldTip(_t("gold")+": "+round(t,10),"gold")},this.clan=function(t){Engine.chatController.getChatChannelsAvailable().setAvailable(f.CHANNEL.CLAN,!0)},this.goldlim=function(t){var i=_t("goldlimit",null,"player");Engine.interface.get$interfaceLayer().find(".herogold"),e.updateGoldTip(i+" "+round(t,10),"goldLimit")},this.nick=function(t,i,n){const a=n.lvl||e.d.lvl,s=n.prof||e.d.prof,r=`${_t("hero_name")}: ${t}</br>${_t("hero_lvl")} ${a}</br>${_t("prof")}: ${getAllProfName(s)}`,o=Engine.interface.get$interfaceLayer().find(".heroname");o.html(`${t} (${a}${s})`),o.tip(r),e.nick=t},this.prof=function(t){},this.hp=function(t,i,n){var a=n.maxhp,s=n.hp,r=parseFloat(s)/parseFloat(a);const o=b.ACTION,l=b.NAME.LOW_HEALTH,c=r<.3?o.SHOW:o.HIDE;getEngine().colorInterfaceNotificationManager.updateData({action:c,id:l}),Engine.interface.heroElements.setHp(t,a||e.d.maxhp),Engine.itemsMarkManager.heroHpChanged(r)},this.exp=function(t,i,n){null==R&&(R=t);var a=Math.round(Math.pow(n.lvl,4)+10),s=Math.round(Math.pow(n.lvl-1,4)+10);1==n.lvl&&(s=0),Engine.interface.heroElements.checkAndSetEndGamePanel(n.lvl);var r=Math.min(Math.max((n.exp-s)/(a-s),.001),1);Engine.interface.heroElements.setXp(r,t,a,s,n.lvl);var o=a-s;0==o&&(o=1);var l=(t-s)/o;l>1&&(l=1),l<0&&(l=0);var c=(l=Math.round(1e4*l))%100,d=(l-c)/100;c<10&&(c="0"+c),Engine.interface.get$interfaceLayer().find(".pointer-exp").text(d+","+c+"%"),e.updateGainedExp(n)},this.ac=function(t){e.updateStat("armor-class",t),Engine.interface.get$interfaceLayer().find(".stats-list .defence .value").text(formNumberToNumbersGroup(t))},this.sa=function(t){e.updateStat("speed-attack",t),Engine.interface.get$interfaceLayer().find(".stats-list .attack-speed .value").text(t)},this.st=function(t){e.updateStat("strength",t)},this.ag=function(t){e.updateStat("dexterity",t)},this.it=function(t){e.updateStat("intelligence",t)},this.crit=function(t){e.updateStat("crit-chance",t,"%")},this.critval=function(t){e.updateStat("crit-power",Math.round(100*t),"%")},this.pttl=function(t){},this.ttl_value=function(t){},this.ttl_end=function(t,e,i){Engine.staminaShop&&0!=t&&Engine.staminaShop.updateDescription(t,i.ttl_del)},this.attack=function(i){let n=0;for(const a in i){const s=i[a],r=`${formNumberToNumbersGroup(s.min)} - ${formNumberToNumbersGroup(s.max)}`,o={formNumber:!1};switch(s.average=Math.round((s.min+s.max)/2),a){case"physicalMainHand":const{prof:i}=Engine.hero.d,l=i===m.HUNTER||i===m.TRACKER?"herostat-tip-damage-normal-distance":"herostat-tip-damage-normal";e.updateStat("damage-normal",r,null,null,_t(l),o),e.damageSum+=e.createDmgStat(s.average);break;case"physicalOffHand":e.updateStat("damage-offhand",r,null,null,null,o),e.damageSum+=e.createDmgStat(s.average,"orange");break;case"lightning":e.updateStat("damage-lightning",r,null,null,null,o),e.damageSum+=e.createDmgStat(s.average,"yellow");break;case"fire":e.updateStat("damage-fire",r,null,null,null,o),e.damageSum+=e.createDmgStat(s.average,"red");break;case"frost":e.updateStat("damage-cold",r,null,null,null,o),e.damageSum+=e.createDmgStat(s.average,"blue");break;case"poisonMainHand":t.find(".poison-header").css("display","block"),e.updateStat("poison1",r,null,null,null,o),n+=s.average;break;case"poisonOffHand":t.find(".poison-header").css("display","block"),e.updateStat("of_poison1",r,null,null,null,o),n+=s.average;break;default:console.log(`Error: "${a}" attack stat is not exist.`)}}n&&(e.damageSum+=e.createDmgStat(n,"green"))},this.fatigs=function(t){for(const i in t){const n=t[i],a={"%power%":n.power,"%chance%":n.chance},s=_t("stat-fatigs-"+i,a),r={formNumber:!1};switch(i){case"mana":e.updateStat("fatigs-mana",s,null,null,_t("herostat-tip-fatigs-mana",a),r);break;case"energy":e.updateStat("fatigs-energy",s,null,null,_t("herostat-tip-fatigs-energy",a),r);break;default:console.log(`Error: "${i}" fatigs stat is not exist.`)}}},this.uprawnienia=function(t){if(!t)return;const e=Engine.console;e.setVisibleOnSizeButton(),e.initCommandButton()},this.poison0=function(i){t.find(".poison-header").css("display","block"),e.updateStat("poison0",roundNumber(i/100,2))},this.wound0=function(i){t.find(".wound-header").css("display","block"),e.updateStat("wound0",i,"%")},this.wound1=function(i){t.find(".wound-header").css("display","block"),e.updateStat("wound1",Math.round(i))},this.of_wound0=function(i){t.find(".wound-header").css("display","block"),e.updateStat("of_wound0",i,"%")},this.of_wound1=function(i){t.find(".wound-header").css("display","block"),e.updateStat("of_wound1",Math.round(i))},this.manadest=function(t){e.updateStat("manadest",t)},this.endest=function(t){e.updateStat("endest",t)},this.acdmg=function(t){e.updateStat("acdmg",t)},this.slow=function(t){e.updateStat("slow",roundNumber(t/100,2))},this.lowevade=function(t){e.updateStat("lowevade",t)},this.acmdmg=function(t){e.updateStat("acmdmg",t,"%")},this.energygain=function(t){e.updateStat("energygain",t)},this.managain=function(t){e.updateStat("managain",t)},this.lowcrit=function(t){e.updateStat("lowcrit",t)},this.critmval_c=function(t){e.updateStat("mcrit-cold",Math.round(100*t),"%")},this.critmval_f=function(t){e.updateStat("mcrit-fire",Math.round(100*t),"%")},this.critmval_l=function(t){e.updateStat("mcrit-lightning",Math.round(100*t),"%")},this.of_crit=function(t){e.updateStat("helper-crit-chance",t,"%")},this.of_critval=function(t){e.updateStat("helper-crit-power",Math.round(100*t),"%")},this.critmval=function(t){e.updateStat("magic-crit-power",t)},this.mana=function(t){e.updateStat("mana",t)},this.energy=function(t){e.updateStat("energy",t)},this.evade=function(t){e.updateStat("evade",t[0]," ("+t[1]+"%)",!1)},this.blok=function(t){var i=Math.round(20*t/Math.min(e.d.lvl,300)),n=" ("+(i>50?50:i)+"%)";e.updateStat("block",t,n)},this.act=function(t){e.updateStat("res-poison",t,"%"),Engine.interface.get$interfaceLayer().find(".stats-list .resists .js-res-poison").html(t)},this.resfire=function(t){e.updateStat("res-fire",t,"%"),Engine.interface.get$interfaceLayer().find(".stats-list .resists .js-res-fire").html(t)},this.resfrost=function(t){e.updateStat("res-cold",t,"%"),Engine.interface.get$interfaceLayer().find(".stats-list .resists .js-res-frost").html(t)},this.reslight=function(t){e.updateStat("res-lightning",t,"%"),Engine.interface.get$interfaceLayer().find(".stats-list .resists .js-res-light").html(t)},this.honor=function(t){e.updateStat("honor-points",t)},this.runes=function(t){e.updateStat("dragonite-tmp",t)},this.ttl=function(t){var i=Math.max(t,0);e.updateStat("stamina",i),Engine.interface.get$interfaceLayer().find(".pointer-ttl").text(i+" min")},this.absorb=function(t){e.updateStat("absorb",t)},this.absorbm=function(t){e.updateStat("absorbm",t)},this.heal=function(t){e.updateStat("heal",t)},this.wanted=function(t){e.wanted=t},this.whoIsHere=function(t){e.whoIsHere=t,e.whoIsHereGlow&&e.whoIsHereGlow.updateColor(e.whoIsHere)},this.preview_acc=function(t){e.previewAcc=t},this.guest=function(t){},this.warrior_stats=function(i){t.find(".warrior-stats").css("display","none"),t.find(".wound-header").css("display","none"),t.find(".poison-header").css("display","none"),Engine.interface.get$interfaceLayer().find(".legends .nolegbon-tmp").css("display","block"),Engine.interface.get$interfaceLayer().find(".legends .bonuses").find(".one-legend-bonus").remove();for(var n in e.damageSum="",i)this.onUpdate[n]&&this.onUpdate[n](i[n],e.d[n],i);Engine.interface.get$interfaceLayer().find(".stats-list .attack .value").html(e.damageSum)},this.passive_stats=function(i){t.find(".passive-stats, .passive-stats-header").css("display","none"),null!==i&&t.find(".passive-stats-header").css("display","block");const n=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(const a in t){if("object"==typeof t[a]){n(t[a],a);continue}const s=(i?i+"-":"")+a,r=e.getUnit(s);e.updateStat(s,t[a],r)}};n(i)},this.legbon_verycrit=function(t){e.updateLegendStat("legbon_verycrit",t)},this.legbon_holytouch=function(t){e.updateLegendStat("legbon_holytouch",t)},this.legbon_holytouch_hp=function(t){e.updateLegendStat("legbon_holytouch_hp",t)},this.legbon_curse=function(t){e.updateLegendStat("legbon_curse",t)},this.legbon_glare=function(t){e.updateLegendStat("legbon_glare",t)},this.legbon_cleanse=function(t){e.updateLegendStat("legbon_cleanse",t)},this.legbon_lastheal=function(t){e.updateLegendStat("legbon_lastheal",t)},this.legbon_critred=function(t){e.updateLegendStat("legbon_critred",t)},this.legbon_facade=function(t){e.updateLegendStat("legbon_facade",t)},this.legbon_anguish=function(t){e.updateLegendStat("legbon_anguish",t)},this.legbon_retaliation=function(t){e.updateLegendStat("legbon_retaliation",t)},this.legbon_puncture=function(t){e.updateLegendStat("legbon_puncture",t)},this.legbon_frenzy=function(t){e.updateLegendStat("legbon_frenzy",t)},this.legbon_resgain=function(t){e.updateLegendStat("legbon_resgain",t)},this.legbon_dmgred=function(t){e.updateLegendStat("legbon_dmgred",t)},this.stasis_incoming_seconds=(t,i,n)=>{e.stasisIncomingInfo(t),e.setStasisEmo(t,n,!0)},this.stasis=function(t,i,n){e.setStasisOverlay(t),e.setRequestDiff(t),t&&t!==i&&e.stasisNotif(t),e.setStasisEmo(t,n)}},this.setStasisEmo=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.d.id?e.d.id:i.id,s=Engine.emotions,r=n?h.NAME.STASIS_INCOMING:h.NAME.STASIS;t>0?s.updateData([{name:r,source_id:a,source_type:h.OBJECT_TYPE.HERO}]):s.removeEmotionBySourceIdAndEmoType(a,r)},this.createDmgStat=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"+";const a=e.damageSum?n:"",r=s.get("stat")[0];return r.classList.add(i),r.innerText=a+t,r.outerHTML},this.setStasisOverlay=t=>{t?Engine.interface.get$gameLayer().find(".stasis-overlay").show():Engine.interface.get$gameLayer().find(".stasis-overlay").hide()},this.stasisIncomingInfo=t=>{let e=t;const i=Engine.interface.get$gameLayer().find(".stasis-incoming-overlay"),n=i.find(".stasis-incoming-overlay__text"),a=()=>{n.html(_t("stasis-incoming",{"%val%":e--})),0===e&&s()},s=()=>{L&&clearInterval(L)};s(),t?(a(),L=setInterval(a,1e3),i.show()):i.hide()},this.checkStasis=()=>e.d.stasis,this.setRequestDiff=function(t){t?Engine.idleJSON.setStasisDiff():Engine.idleJSON.setDefaultDiff()},this.stasisNotif=t=>{var e=Engine.soundManager;e&&t&&!e.getStateSoundNotifById(8)&&e.createNotifSound(9)},this.getParseGold=t=>{var e=t.toString().length>9?12:10,i=t.toString().length>9?".":" ";return round(t,e,i,3)},this.updateGoldTip=function(t,e){var i=s.get("herogold-tip");if("gold"==e){i.find(".h-gold").html(t);let e=Engine.hero.d.goldlim;e&&i.find(".h-gold-limit").html(_t("goldlimit",null,"player")+" "+round(e,10)),Engine.interface.get$interfaceLayer().find(".herogold").tip(i.html(),"t-right")}"goldLimit"==e&&(i.find(".h-gold-limit").html(t),Engine.interface.get$interfaceLayer().find(".herogold").changeInTip(".h-gold-limit",t))},this.updateStat=function(t,i,n,a,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o={formNumber:!0},l={...o,...r};let c=e.getStat(t);var d=c.parent();"none"==d.css("display")&&d.css("display","flex"),s&&d.tip(s);let h=(a||"")+(l.formNumber?formNumberToNumbersGroup(i):i)+(n||""),u=c.html();u!=h&&c.html(h)},this.getStat=e=>(C[e]||(C[e]=Engine.interface.get$interfaceLayer().find('[data-herostat="'+e+'"] .value',t)),C[e]),this.getUnit=t=>e.getStat(t).closest("[data-herostat]").data("unit")||"",this.updateLegendStat=function(t,e){var i;if(isset(e.length)){for(var n={},a=t,r=0;r<e.length;r++){var o="%val"+r+"%";n[o]=e[r],a+=" "+o}i=_t(a,n,"legendary_stats")}else i=_t(t+" %val0%",{"%val0%":e},"legendary_stats");var l=s.get("one-legend-bonus").html(i);Engine.interface.get$interfaceLayer().find(".legends .nolegbon-tmp").css("display","none"),Engine.interface.get$interfaceLayer().find(".legends .bonuses").append(l)},this.updateStatsScrollbar=function(){Engine.interface.get$interfaceLayer().find(".extended-stats").trigger("update")},this.locationInfo=function(){Engine.interface.get$interfaceLayer().find(".coords").html("("+this.d.x+","+this.d.y+")")},this.setLowLvlClass=t=>{if("berufs"!==Engine.worldConfig.getWorldName()){var e,i=$("body");t<7?e=7:t<10?e=10:t<20?e=20:t<25?e=25:t<26&&(e=26),e?i.attr("data-lvl",e):i.attr("data-lvl","")}},this.changeSkillSet=function(){var t=e.cur_skill_set>2?1:e.cur_skill_set+1,i=Engine.skills?"&show=1":"";_g("skills&set="+t+i)},this.onhover=function(t,i){e.overMouse=i,getEngine().interface.setDoActionCursor(i)},this.onClear=function(){Engine.stepsToSend.reset(),x.onClear(),this.getObjectDynamicLightManager().removeAllDynamicLights(),this.getObjectDynamicLightManager().removeAllDynamicDirCharacterLights(),this.deletePet(),this.clearAutoPathOfHero(),this.frame=0,delete this.lastServerX,delete this.lastServerY,delete this.d.x,delete this.d.y,delete this.rx,delete this.ry},this.onResize=function(){Engine.interface.get$interfaceLayer().find(".extended-stats").trigger("update")},this.setHeroInLastServerPos=()=>{this.clearAutoPathOfHero(),this.d.x=this.lastServerX,this.d.y=this.lastServerY,this.onPositionChange(this.lastServerX,this.lastServerY),Engine.map.centerOn(this.lastServerX,this.lastServerY)},this.oncontextmenu=function(t){t.stopPropagation();var i=[],n=Engine.hero.d;n.lvl>19&&i.push([_t("emo_mad",null,"menu"),function(){_g("emo&a=angry")}]),i.push([_t("change_outfit"),()=>{this.getOutfits()}]),i.push([_t("show_profile",null,"menu"),()=>E(n.account,n.id)]),e.addDebugOptionMenu(i),Engine.interface.showPopupMenu(i,t,!0)},this.onPositionChange=function(t,i){if(!(Engine.lock.check("change_location")||Engine.lock.check("npcdialog")||Engine.lock.check("logoff")||Engine.lock.check("battle"))&&(Engine.map.gateways.getGtwAtPosition(t,i)&&!Engine.opt(12))){if(this.autoWalkLock)return;if(k)return;k=setTimeout((function(){if(Engine.hero.waitForDialog||Engine.dialogue||Engine.shop)return clearInterval(k),void(k=null);e.getTroughGateway()}),200)}},this.getTroughGateway=function(){Engine.lock.check("npcdialog")||Engine.lock.check("battle")||(Engine.lock.add("change_location"),Engine.map.blockMove(),_g("walk",(function(t){k=null,isset(t.t)&&"reload"===t.t?Engine.map.showLoaderSplash():Engine.map.unBlockMove(),Engine.lock.remove("change_location")})))},this.updatePet=function(t,i){var n=jQuery.isEmptyObject(t);("reload"!=i.t||n)&&(t.afterReload=!Engine.allInit,!n&&this.pet&&this.pet.d.name!=t.name&&this.deletePet(),isset(this.pet)?n?this.deletePet():(isset(i.h)&&(t.action=t.action>>0&15),isset(t.elite)||(t.elite=null),t.isNew=!1,e.pet.updateDATA(t)):(t.own=!0,t.master=e,t.isNew=!0,this.pet=new r,this.pet.init(),this.pet.updateDATA(t),this.petLock=new Lock(["petUpdate"],(function(){e.pet.updateDATA({master:e}),delete e.petLock}))))},this.deletePet=function(){isset(this.pet)&&(this.pet.removePet(),delete this.pet)},this.havePet=()=>isset(this.pet),this.getPet=()=>this.pet,this.getDrawableList=function(){var t=[];const e=u.HERO;let i=getEngine().interfaceTimerManager;return isset(this.pet)&&this.pet.getOrder&&t.push(this.pet),isset(this.whoIsHereGlow)&&!Engine.rajCharacterHide.checkHideObject(this)&&t.push(this.whoIsHereGlow),i.check(e)&&t.push(i.getCharacterTimer(e)),t},this.getData=()=>this.d,this.getOrder=function(){return this.ry+this.tutorialOrder+.5},this.increaseTutorialOrder=()=>{this.tutorialOrder=301},this.clearTutorialOrder=()=>{this.tutorialOrder=0},this.atackNearMob=function(t){var e=Engine.npcs.check(),i=null;for(var n in e){var a=e[n];if(2==a.d.type||3==a.d.type){var s=this.d.x-2<a.d.x&&this.d.x+2>a.d.x,r=this.d.y-2<a.d.y&&this.d.y+2>a.d.y;if(s&&r&&(i=a.d.id,this.getCharacterFrontOfHero(a)))return this.heroAtackRequest(i,t)}}if(i)return this.heroAtackRequest(i,t)},this.addToPartyNearPlayer=function(){var t=Engine.others.check(),i=[],n=[],a=Engine.party;if(a){var s=a.getMembers();for(var r in s)n.push(r)}for(var o in t){var l=t[o],c=this.d.x-2<l.d.x&&this.d.x+2>l.d.x,d=this.d.y-2<l.d.y&&this.d.y+2>l.d.y,h=n.indexOf(o)<0;c&&d&&h&&i.push(l.d.id)}0!=i.length?e.inviteToParty(i):console.log("none")},this.inviteToParty=function(t){_g("party&a=inv&id="+t[0],(function(){t.shift(),0!=t.length&&e.inviteToParty(t)}))},this.atackNearPlayer=function(){let t=W();null!=t&&_g("fight&a=attack&id="+t,(function(){}))};const W=()=>{let t=Engine.others.check(),e=null,i=[],n=Engine.party;if(n){var a=n.getMembers();for(var s in a)i.push(s)}for(var r in t){let n=t[r],a=this.d.x-3<=n.d.x&&this.d.x+3>=n.d.x,s=this.d.y-3<=n.d.y&&this.d.y+3>=n.d.y,o=i.indexOf(r)<0;if(a&&s&&o&&(e=n.d.id,this.getCharacterFrontOfHero(n)))return e}return e};this.checkPlayerIdIsHeroId=t=>e.d.id==t,this.talkNearMob=function(){var t=Engine.npcs.check(),e=null;for(var i in t){var n=t[i];if(0==n.d.type||5==n.d.type||6==n.d.type||7==n.d.type){var a=this.d.x-2<n.d.x&&this.d.x+2>n.d.x,s=this.d.y-2<n.d.y&&this.d.y+2>n.d.y;if(a&&s&&(e=n.d.id,this.getCharacterFrontOfHero(n)))return this.sendRequestToTalk(e)}}if(e)return this.sendRequestToTalk(e)},this.sendRequestToTalk=t=>{this.waitForDialog=!0,_g("talk&id="+t,(function(i){e.waitForDialog=!1,isset(i.d)||Engine.hero.clearAutoPathOfHero(),Engine.interface.checkTeleport(i),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,2,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,2,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,4,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,5,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,9,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,9,{idNpc:t}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,10,{idNpc:t}),e.callCheckCanFinishExternalTutorialTalkNpc(t)}))},this.getCharacterFrontOfHero=function(t){switch(this.dir){case p.N:if(t.d.x==this.d.x&&t.d.y==this.d.y-1)return!0;break;case p.S:if(t.d.x==this.d.x&&t.d.y==this.d.y+1)return!0;break;case p.W:if(t.d.x==this.d.x-1&&t.d.y==this.d.y)return!0;break;case p.E:if(t.d.x==this.d.x+1&&t.d.y==this.d.y)return!0}return!1},this.heroAtackOtherRequest=function(){if(this.markOtherObj){var t=this.markOtherObj;Math.abs(t.d.x-e.rx)<=2&&Math.abs(t.d.y-e.ry)<=2&&_g("fight&a=attack&id="+t.d.id,(function(t){isset(t.alert)&&Engine.hero.markOtherObj.deleteRedMark()}))}},this.heroAtackRequest=function(t,i){i?_g("fight&a=attack&id=-"+t+"&ff=1",(function(){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,5,{idNpc:e.d.id}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,5,{idNpc:e.d.id}),e.callCheckCanFinishExternalTutorialAttackNpc(t)})):_g("fight&a=attack&id=-"+t,(function(){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,5,{idNpc:e.d.id}),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,5,{idNpc:e.d.id}),e.callCheckCanFinishExternalTutorialAttackNpc(t)}))},this.init=function(){e.initOnSelfEmoList(),D(!1),P(null),B(null),e.createPlaceHolderCharacter(),t=Engine.interface.get$interfaceLayer().find(".extended-stats .stats-section"),Engine.interface.get$interfaceLayer().find(".extended-stats").addScrollBar({track:!0}),e.setInputParser(),this.initDynamicLightCharacterManager(),x=new v,x.init()},this.getOutfits=()=>{if(Engine.changeOutfit)Engine.changeOutfit.close();else{const t=getMainDomain(),e=isPl()?"www.":"";$.ajax({type:"post",url:`https://${e}margonem.${t}/ajax/getoutfits`,xhrFields:{withCredentials:!0},data:{world:Engine.worldConfig.getWorldName(),id:Engine.hero.d.id,h2:getCookie("hs3")},success:t=>{Engine.changeOutfit=new c,Engine.changeOutfit.init(),Engine.changeOutfit.update(JSON.parse(t))}})}},this.getNick=()=>this.d.nick,this.getRX=()=>this.rx,this.getRY=()=>this.ry,this.getX=()=>this.d.x,this.getY=()=>this.d.y,this.getNDir=()=>this.ndir,this.getDir=()=>[p.S,p.W,p.E,p.N][this.d.dir],this.getImg=()=>this.d.img,this.getOldImg=()=>M,this.getId=()=>this.d.id,this.outfitPreview=t=>{let i,n={speed:!1};i=CFG.r_opath+fixSrc(t),n.externalSource=cdnUrl,Engine.imgLoader.onload(i,n,(i,n)=>{e.previewOutfit=t,e.beforeOnloadPreview(n,i)},t=>{e.afterLoadImage()},()=>{})},this.beforeOnloadPreview=(t,e)=>{const i=t.hdr.width/4,n=t.hdr.height/4,a={kind:"preview",fw:i,fh:n,halffw:i/2,halffh:n/2,frames:t.frames,activeFrame:0,sprite:e};this.setOutfitData(a)},this.setOutfitData=t=>{this.outfitData[t.kind]=t,this.setKindOutfit(t.kind)},this.setKindOutfit=t=>{this.fw=this.outfitData[t].fw,this.fh=this.outfitData[t].fh,this.halffw=this.outfitData[t].halffw,this.halffh=this.outfitData[t].halffh,this.frames=this.outfitData[t].frames,this.activeFrame=this.outfitData[t].activeFrame,this.sprite=this.outfitData[t].sprite,clearTimeout(this.previewOutfitTimeout),"original"===t?(this.previewOutfit&&message(_t("preview_end")),this.previewOutfit=!1):(message(_t("preview_start")),this.previewOutfitTimeout=setTimeout(()=>{this.setKindOutfit("original")},6e4)),Engine.battle.updateHeroOutfit()},this.setRefFollowObj=B,this.setStartClickOnMapMove=D,this.setSpeed=t=>{T=t}};(w.prototype=Object.create(n.prototype)).constructor=w,t.exports=w},function(t,e,i){let n=i(0);t.exports=function(){let t=0,e=null,i={your:null,preview:null},a={your:null,preview:null},s=!1,r=null,o={x:0,y:0},l=!1,c=!1,d={};this.init=()=>{this.initWindow(),this.initCards(),this.initSaveButton(),this.initScrollBar(),this.initYourOutfit(),this.initAnimUpdate(),this.initFetch(),this.initLabels()},this.initLabels=()=>{this.wnd.$.find(".your-outfit").find(".outfit-header").html(_t("your_outfit")),this.wnd.$.find(".preview-outfit").find(".outfit-header").html(_t("preview_outfit"))},this.initYourOutfit=()=>{let t=CFG.a_opath+"/"+Engine.hero.d.img,e=this.wnd.$.find(".your-outfit").find(".outfit-graphic");this.setOutfitInPreview(e,t,"your")},this.initFetch=()=>{Engine.items.fetch(Engine.itemsFetchData.NEW_OUTFIT_ITEM,this.newOutfitItem)},this.prepareData=t=>{let e={requirements:{},relativeUrl:t._cachedStats.outfit.split(",")[1]};if(t._cachedStats.lvl&&(e.requirements.level=t._cachedStats.lvl),t._cachedStats.timelimit){let i=t._cachedStats.timelimit.split(",");if(i[1]){let n=i[1];this.getMinutes(n)>-1&&(e.requirements.timelimit={id:t.id,timelimit:n},this.addInterval(t,n))}}return e},this.newOutfitItem=(t,e)=>{if(!t._cachedStats.outfit)return;let i=this.prepareData(t),n=this.createOneOutfit(i,t);this.wnd.$.find(".equip-section").find(".scroll-pane").append(n),this.checkOutfitIsYourOutfit(n.find(".outfit-border"),i.relativeUrl),t.on("delete",(function(){n.remove(),clearInterval(d[t.id]),delete d[t.id]})),t.on("afterUpdate",function(){this.setAmount(t,n)}.bind(this)),this.wnd.$.find(".empty-info").css("display","none")},this.getMinutes=t=>Math.floor((parseInt(t)-unix_time())/60),this.addInterval=(t,e)=>{d[t.id]=setInterval(()=>{let i=this.getMinutes(e);if(i<0)return clearInterval(d[t.id]),delete d[t.id],void this.wnd.$.find(".outfit-item-id-"+t.id).removeClass("it-is-not-time");let n=(i<1?"<1":i)+"min";this.wnd.$.find(".outfit-item-id-"+t.id).find(".outfit-timelimit").html(n)},1e3)},this.initAnimUpdate=()=>{this.updateFrames(),this.draw(),r=setInterval(()=>{this.updateFrames(),this.draw()},200)},this.updateFrames=()=>{o.x++,4==o.x&&(o.x=0,s?(s=!1,o.y++):s=!0,4==o.y&&(o.y=0))},this.draw=()=>{if(l){let t=this.wnd.$.find(".your-outfit").find(".outfit-graphic");this.setOutfitPosition(t,"your")}if(e&&c){let t=this.wnd.$.find(".preview-outfit").find(".outfit-graphic");this.setOutfitPosition(t,"preview")}},this.initWindow=()=>{Engine.windowManager.add({content:n.get("change-outfit"),title:_t("outfits"),nameWindow:Engine.windowsData.name.CHANGE_OUTFIT,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()},this.initScrollBar=()=>{this.wnd.$.find(".default-section").addScrollBar({track:!0}),this.wnd.$.find(".equip-section").addScrollBar({track:!0})},this.initCards=()=>{let t=this.wnd.$.find(".cards-header"),e=_t("default"),i=_t("equip");this.newCard(t,e,()=>{}),this.newCard(t,i,()=>{}),this.setFirstCard()},this.setFirstCard=()=>{this.wnd.$.find(".section").eq(0).addClass("visible"),this.wnd.$.find(".card").eq(0).addClass("active")},this.updateScroll=()=>{this.wnd.$.find(".default-section").trigger("update"),this.wnd.$.find(".equip-section").trigger("update")},this.newCard=(t,e,i)=>{let a=n.get("card");a.find(".label").html(e),t.append(a);let s=this;a.click((function(){let t=$(this).index();s.setVisible(t),s.updateScroll(),i&&i()}))},this.setVisible=e=>{let i=this.wnd.$.find(".card").removeClass("active"),n=this.wnd.$.find(".bottom-bar"),a=this.wnd.$.find(".section").removeClass("visible");i.eq(e).addClass("active"),a.eq(e).addClass("visible"),n.children().css("display","none"),n.children().eq(e).css("display","block"),t=e},this.update=t=>{for(let e=0;e<t.length;e++){let i=this.createOneOutfit(t[e]);this.wnd.$.find(".default-section").find(".scroll-pane").append(i)}this.updateScroll(),this.wnd.center()},this.createOneOutfit=(t,i)=>{let a=n.get("one-outfit"),s=a.find(".text"),r=t.requirements.level,o=t.requirements.kb,l=t.requirements.timelimit,c=t.relativeUrl,d=CFG.a_opath+"/"+c;if(i&&(a.addClass("outfit-item outfit-item-id-"+i.id),a.data("item",i),this.setAmount(i,a)),l){let t=l.timelimit,e=this.getMinutes(t);a.find(".outfit-timelimit").html(e),a.addClass("it-is-not-time")}return r&&(Engine.hero.d.lvl>=r?s.addClass("green"):a.addClass("disable"),s.html(r+"lvl")),o&&(s.addClass("green"),s.html("KB")),this.checkOutfitIsYourOutfit(a.find(".outfit-border"),c),createImgStyle(a.find(".outfit-wrapper"),d),a.find(".requirements").html(s),a.on("click",(function(){Engine.changeOutfit.wnd.$.find(".save-button").find(".button").removeClass("disable"),Engine.changeOutfit.wnd.$.find(".outfit-border").removeClass("preview"),e=c,$(this).find(".outfit-border").addClass("preview");let t=Engine.changeOutfit.wnd.$.find(".preview-outfit").find(".outfit-graphic");Engine.changeOutfit.setOutfitInPreview(t,d,"preview")})),a},this.setAmount=(t,e)=>{let i=isset(t.parseStats().amount)?t.parseStats().amount:"";e.find(".amount").text(i)},this.checkOutfitIsYourOutfit=(t,e)=>{Engine.hero.d.img=="/"+e&&t.find(".outfit-border").addClass("active")},this.setOutfitInPreview=(t,e,i)=>{Engine.imgLoader.onload(e,!1,!1,n=>{this.afterOnloadOutfitInPreview(n,i,t,e)})},this.afterOnloadOutfitInPreview=(t,e,i,n)=>{let a=t.width/4,s=t.height/4;switch(i.css({backgroundImage:"url("+n+")",width:a,height:s}),this.setAnimFrames(a,s,e),e){case"your":l=!0;break;case"preview":c=!0;break;default:console.error("[ChangeOutfit.js, afterOnloadOutfitInPreview] Bad kind:",e)}},this.setAnimFrames=(t,e,n)=>{i[n]=[0,-t,2*-t,3*-t],a[n]=[0,-e,3*-e,2*-e]},this.setOutfitPosition=(t,e)=>{t.css("background-position",i[e][o.x]+"px "+a[e][o.y]+"px")},this.initSaveButton=()=>{let t=n.get("button").addClass("green disable small");this.wnd.$.find(".save-button").append(t),t.find(".label").html(_t("privPage_save")),t.on("click",()=>{if(null===e)return;let t=this.wnd.$.find(".outfit-border.preview").parent();if(t.hasClass("outfit-item")){let e=t.data("item");console.log(e),Engine.heroEquipment.sendUseRequest(e),this.close()}else this.sendSaveRequest()})},this.sendSaveRequest=()=>{const t=getMainDomain(),i=isPl()?"www.":"";$.ajax({type:"post",url:`https://${i}margonem.${t}/ajax/saveoutfit`,xhrFields:{withCredentials:!0},data:{world:Engine.worldConfig.getWorldName(),id:Engine.hero.d.id,h2:getCookie("hs3"),outfit:e},success:()=>{this.close()}})},this.clearAllInterval=()=>{for(let t in d)clearInterval(d[t]),delete d[t]},this.close=()=>{this.clearAllInterval(),this.wnd.remove(),clearInterval(r),Engine.changeOutfit=null,Engine.items.removeCallback(Engine.itemsFetchData.NEW_OUTFIT_ITEM)}}},function(t,e){var i=function(){this.road=[],this.running=!1};i.prototype.draw=function(t){var e=Engine.map;for(var i in t.save(),t.fillStyle="rgba(255, 0, 0, 0.5)",this.road){var n=this.road[i];this.drawPoint(t,n,e.offset,10)}t.restore()},i.prototype.getOrder=function(){return isset(Engine.map)?Engine.map.getOrder()+1:1},i.prototype.drawPoint=function(t,e,i,n){var a=32*e.x-i[0]+16,s=32*e.y-i[1]+16;t.beginPath(),t.arc(a,s,n,0,2*Math.PI),t.fill()},i.prototype.setRoad=function(t){for(var e in this.road=[],t.road){var i=t.road[e];this.road.push({x:i.x,y:i.y})}t.road=[],this.running=!0},i.prototype.clear=function(){this.road=[],this.running=!1},t.exports=i},function(t,e,i){const n=i(49);t.exports=function(){let t,e;const i=(t,e)=>{for(let i=0;i<t.length;i++){let n=t[i];n.callMapAreaTriggerCallback(),n.checkIsInfiniteRepeat()||e.afterCall(n)}},a=t=>{let e=s();e.length&&i(e,t)},s=()=>{let i=[];for(let a in e){let s=e[a];s.getKind()==n.kind.ON_OUT&&(t[a]?s.getActionOnEachCord()&&i.push(s):i.push(s))}return i};let r=e=>!!t[e];const o=(e,i)=>{t[e]=i},l=e=>{delete t[e]},c=()=>{e={};for(let i in t)e[i]=t[i]},d=()=>{for(let e in t)l(e)};this.init=()=>{t={}},this.manageTileReach=(t,e,s)=>{if(!s.checkMapAreaCordTrigger(t,e))return c(),d(),void a(s);let l=s.getMapAreaCordTriggerArrayByPos(t,e),h=[];for(let t=0;t<l.length;t++){let e=l[t],i=e.getMapAreaTriggerId();r(i)&&!e.getActionOnEachCord()||e.getKind()==n.kind.ON_IN&&h.push(e)}c(),d();for(let t=0;t<l.length;t++){let e=l[t],i=e.getMapAreaTriggerId();o(i,e)}a(s),i(h,s)},this.getActualMapTrigger=()=>t,this.onClear=()=>{d(),e={}}}},function(t,e,i){var n=i(37),a=i(8);t.exports=function(){this.target={},this.active=!1,this.glow={},this.val=0,this.maxVal=3.14,this.blink=!1,this.alwaysDraw=!0,this.init=()=>{},this.setGlow=t=>{this.target[t].imgLoaded?(this.glow[t]=new n,this.glow[t].createObject(this.target[t],"#3ed1de")):setTimeout(()=>{this.setGlow(t)},500)},this.clearGlow=()=>{this.glow={}},this.addMultiGlowTarget=(t,e)=>{for(let i in t){let n=this.getTargetFromTutorialData(t[i]);if(!n)return;Array.isArray(n)||(n=[n]);for(let t=0;t<n.length;t++){this.setBlink(e);let i=n[t].d.id;this.addTarget(n[t]),this.setGlow(i)}}this.setActive(!0)},this.setBlink=t=>{this.blink=!!t},this.setCollider=()=>{this.collider={box:[32*this.xStart,32*this.yStart,32*this.size[0],32*this.size[1]]}},this.onclick=()=>!1,this.getTarget=()=>this.target,this.getTargetFromTutorialData=t=>{let e=null;switch(t.typeObject){case a.TYPE_OBJECT.HERO:e=Engine.hero;break;case a.TYPE_OBJECT.NPC:e=Engine.npcs.getById(t.id);break;case a.TYPE_OBJECT.GROUND_ITEM_COLLECTIONS:isPl()&&(e=Engine.map.groundItems.getItemsByStatAndVal("szablon",t.szablon)),isEn()&&(e=Engine.npcs.getByArrayId(t.allId));break;default:return console.warn("[CanvasMultiGlow.js, getTargetFromTutorialData] Unsupported typeObject: ",t.typeObject),null}return null==e&&console.warn("[CanvasMultiGlow.js, getTargetFromTutorialData] Object not exist",t.id),e},this.removeMultiGlowTarget=()=>{this.getActive()&&(this.clearGlow(),this.clearTarget(),this.setActive(!1),this.setBlink(!1))},this.removeMultiGlowTargetById=t=>{this.getActive()&&this.glow[t]&&(delete this.glow[t],delete this.target[t])},this.addTarget=t=>{this.target[t.d.id]=t,t.increaseTutorialOrder()},this.clearTarget=()=>{for(let t in this.target)this.target[t].clearTutorialOrder();this.target={}},this.getOrder=()=>300,this.update=t=>{if(!this.active||Object.keys(this.glow).length!=Object.keys(this.target).length)return;this.val+=t,this.val>this.maxVal&&(this.val=0);let e=Math.round(100*Math.sin(this.val))/100;if(this.blink)for(let t in this.glow)this.glow[t].setAlpha(e);for(let t in this.glow)this.glow[t].update()},this.draw=t=>{if(Object.keys(this.glow).length)for(let e in this.glow)this.glow[e].draw(t)},this.setActive=t=>{this.active=t},this.getActive=()=>this.active,this.getCanvasMultiGlow=()=>this.active?[this]:[]}},function(t,e){t.exports=function(){this.active=!1,this.blink=!1,this.val=0,this.maxVal=3.14,this.target=[],this.init=()=>{},this.addMultiGlowTarget=(t,e)=>{this.setBlink(e);let i=this.blink?this.getAlpha():1;for(let e=0;e<t.length;e++){let n="object"==typeof t[e]?t[e]:$(t[e]);if(!n.length)return void console.warn("[HtmlMultiGlow.js, addMultiGlowTarget] Not exist element: ",t[e]);this.addTargetWhenAttachToBody(n,i)}this.setActive(!0)},this.addTargetWhenAttachToBody=(t,e)=>{if(!t.parent().length)return void setTimeout(()=>{this.addTargetWhenAttachToBody(t,e)},500);let i=this.getNewTargetId();this.addTarget(t),this.setAlpha(i,e)},this.getNewTargetId=()=>this.target.length,this.update=t=>{if(!this.active||!this.target.length)return;this.val+=t,this.val>this.maxVal&&(this.val=0);let e=this.getAlpha();if(this.blink)for(let t=0;t<this.target.length;t++)this.setAlpha(t,e)},this.getAlpha=()=>Math.round(100*Math.sin(this.val))/100,this.setBlink=t=>{this.blink=!!t},this.setAlpha=(t,e)=>{this.target[t].css("border-left-width")?this.target[t].css("box-shadow","0px 0px 20px 0 rgba(62, 209, 222, "+e+")"):this.target[t].css("box-shadow","inset 0px 0px 8px 0 rgba(62, 209, 222, "+e+"), 0px 0px 20px 0 rgba(62, 209, 222, "+e+")")},this.addTarget=t=>{this.target.push(t),t.addClass("multi-glow-target")},this.clearTarget=()=>{for(let t=0;t<this.target.length;t++){let e=this.target[t];e.removeClass("multi-glow-target"),e[0].style.boxShadow=""}this.target=[]},this.removeMultiGlowTarget=()=>{this.getActive()&&(this.clearTarget(),this.setBlink(!1),this.setActive(!1))},this.setActive=t=>{this.active=t},this.getActive=()=>this.active}},function(t,e,i){var n=i(37);t.exports=function(){this.target=null,this.active=!1,this.xStart=-100,this.yStart=-100,this.size=[400,400],this.glow=null,this.val=0,this.maxVal=3.14,this.blink=!1,this.init=()=>{this.setCollider()},this.setGlow=()=>{this.target.imgLoaded?(this.glow=new n,this.glow.createObject(this.target,"#3ed1de")):setTimeout(()=>{this.setGlow()},500)},this.clearGlow=()=>{this.glow=null},this.addOverlayAndTarget=(t,e)=>{let i=this.getTargetFromTutorialData(t);i&&(this.setBlink(e),this.addTarget(i),this.setGlow(),this.setActive(!0))},this.setBlink=t=>{this.blink=!!t},this.setCollider=()=>{this.collider={box:[32*this.xStart,32*this.yStart,32*this.size[0],32*this.size[1]]}},this.onclick=()=>!1,this.getTarget=()=>this.target,this.getTargetFromTutorialData=t=>{let e=null;switch(t.typeObject){case"hero":e=Engine.hero;break;case"npc":e=Engine.npcs.getById(t.id);break;default:return console.error("[CanvasFocus.js, getTargetFromTutorialData] Unsupported typeObject: ",t.typeObject),null}return null==e&&console.error("[CanvasFocus.js, ]Object not exist",t.id),e},this.removeOverlayAndTarget=()=>{this.getActive()&&(this.clearGlow(),this.clearTarget(),this.setActive(!1),this.setBlink(!1))},this.addTarget=t=>{this.target=t,this.target.increaseTutorialOrder()},this.clearTarget=()=>{this.target.clearTutorialOrder(),this.target=null},this.getOrder=()=>300,this.update=t=>{if(!this.active||!this.glow)return;this.val+=t,this.val>this.maxVal&&(this.val=0);let e=Math.round(100*Math.sin(this.val))/100;this.blink&&this.glow.setAlpha(e),this.glow.update()},this.draw=t=>{t.globalAlpha=.5,t.fillStyle="black";var e=32*this.xStart-Engine.map.offset[0],i=32*this.yStart-Engine.map.offset[1];t.fillRect(e,i,32*this.size[0],32*this.size[1]),t.globalAlpha=1,this.glow&&this.glow.draw(t)},this.setActive=t=>{this.active=t},this.getActive=()=>this.active,this.getCanvasFocus=()=>this.active?[this]:[]}},function(t,e,i){var n=i(5);t.exports=function(){this.ctx=null,this.active=!1,this.canvas=null,this.target=null,this.focusCollider=null,this.val=0,this.maxVal=3.14,this.alpha=1,this.blink=!1,this.glow=!1,this.init=function(){},this.update=t=>{this.active&&this.blink&&(this.val+=t,this.val>this.maxVal&&(this.val=0),this.alpha=Math.round(100*Math.sin(this.val))/100)},this.draw=()=>{this.active&&(this.drawOverlay(),this.glow&&this.setGlow(),this.drawMask())},this.getProportionalVal=t=>{if(null!=Engine.zoomFactor)return t/(Engine.zoomFactor/1);if(!mobileCheck())return t;let e=n.get("ZoomFactor");return null!=e?t/(e/1):t},this.createCanvas=()=>{let t=this.getProportionalVal(window.innerWidth),e=this.getProportionalVal(window.innerHeight);this.canvas=$("<canvas>").attr({width:t,height:e}),this.ctx=this.canvas[0].getContext("2d"),this.canvas.addClass("tutorial-overlay"),this.canvas.css({position:"absolute",left:0,top:0,opacity:.5}),mobileCheck()&&this.canvas.css("pointer-events","none"),Engine.interface.get$tutorialLayer().before(this.canvas),this.canvas.css("z-index",12)},this.drawOverlay=()=>{let t=this.canvas[0].width,e=this.canvas[0].height;this.ctx.clearRect(0,0,t,e),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,e)},this.htmlFocusMouseEventsInit=()=>{$(document).mouseenter(this.mouseEnter),$(document).mousemove(this.mouseMove),$(document).mouseout(this.mouseOut)},this.htmlFocusMouseEventsRemove=()=>{$(document).off("mouseenter",this.mouseEnter),$(document).off("mousemove",this.mouseMove),$(document).off("mouseout",this.mouseOut)},this.collideWithMask=t=>{let e=t.clientX,i=t.clientY;t.touches&&(e=t.touches[0].clientX,i=t.touches[0].clientY);let n=this.focusCollider[0]<e&&e<this.focusCollider[2],a=this.focusCollider[1]<i&&i<this.focusCollider[3];return t.touches&&t.stopPropagation(),n&&a},this.manageCanvasPointerEvents=t=>{let e=$(".tutorial-overlay");this.collideWithMask(t)||mobileCheck()?e.css("pointer-events","none"):e.css("pointer-events","auto")},this.mouseMove=t=>{this.manageCanvasPointerEvents(t)},this.mouseOut=t=>{this.manageCanvasPointerEvents(t)},this.mouseEnter=t=>{this.manageCanvasPointerEvents(t)},this.mouseDown=t=>{console.log("mouseDown1",t.target,this.collideWithMask(t)),this.manageCanvasPointerEvents(t)},this.mouseDown2=t=>{console.log("mouseDown2",t.target,this.collideWithMask(t)),this.manageCanvasPointerEvents(t)},this.create=(t,e,i)=>{this.addTarget(t),this.createCanvas(),this.htmlFocusMouseEventsInit(),this.drawOverlay(),this.setBlink(i),this.alpha=1,this.glow=e;let n=this.target.width(),a=this.target.height(),s=this.target.offset(),r=this.getProportionalVal(s.left),o=this.getProportionalVal(s.top);this.createFocusCollider(r,o,n,a),this.glow&&this.setGlow(),this.drawMask(),this.setActive(!0)},this.setBlink=t=>{this.blink=!!t},this.drawMask=()=>{let t=this.focusCollider[0],e=this.focusCollider[1],i=this.focusCollider[4],n=this.focusCollider[5];this.ctx.save(),this.ctx.globalCompositeOperation="xor",this.ctx.fillRect(t,e,i,n),this.ctx.fill(),this.ctx.restore()},this.createFocusCollider=(t,e,i,n)=>{this.focusCollider=[t,e,t+i,e+n,i,n]},this.setGlow=()=>{let t=this.focusCollider[0],e=this.focusCollider[1],i=this.focusCollider[4],n=this.focusCollider[5];this.ctx.save(),this.ctx.globalAlpha=this.alpha,this.ctx.shadowBlur=20,this.ctx.fillStyle="#3ed1de",this.ctx.shadowColor="#3ed1de",this.ctx.fillRect(t-0,e-0,i+0,n+0),this.ctx.fillStyle="#3ed1de",this.ctx.shadowColor="#3ed1de",this.ctx.fillRect(t-0,e-0,i+0,n+0),this.ctx.fillStyle="#3ed1de",this.ctx.shadowColor="#3ed1de",this.ctx.fillRect(t-0,e-0,i+0,n+0),this.ctx.restore()},this.setActive=t=>{this.active=t},this.getActive=()=>this.active,this.getCanvasFocus=()=>this.active?[this]:[],this.addTarget=t=>{this.target=t},this.clearTarget=()=>{this.target=null},this.clearCanvas=()=>{this.canvas.remove(),this.canvas=null},this.clearFocusCollider=()=>{this.focusCollider=null},this.removeOverlayAndTarget=()=>{this.getActive()&&(this.clearTarget(),this.clearCanvas(),this.clearFocusCollider(),this.htmlFocusMouseEventsRemove(),this.setBlink(!1),this.setActive(!1))}}},function(t,e){t.exports=function(){this.ctx=null,this.active=!1,this.canvas=null,this.blink=!1,this.glow=!0,this.initialized=!1,this.shouldDraw=!0;let t=0,e=0,i=!0,n=[];this.init=function(){};const a=()=>{let t=getEngine().interface.get$GAME_CANVAS()[0],e=t.width,i=t.height;for(let t in n)n[t].canvas.width=e,n[t].canvas.height=i},s=()=>{for(let t in n)n[t].toDraw=!1};this.update=a=>{this.active&&this.blink&&(t+=80*a,t<3.14||(t-=3.14,i?e++:e--,0!=e&&e+1!=n.length||(i=!i)))},this.draw=()=>{this.active&&this.glow&&this.shouldDraw&&this.setGlow()},this.createCanvas=()=>{this.canvas=document.createElement("canvas"),this.canvas.id="low-health-layer",this.canvas.classList.add("low-health-layer");let t=getEngine().interface.get$GAME_CANVAS();this.setSizeCanvas(t.width(),t.height()),Engine.interface.get$gameLayer().append(this.canvas),this.ctx=this.canvas.getContext("2d")},this.create=()=>{document.getElementById("low-health-layer")||(this.createCanvas(),this.setBlink(!Engine.opt(8)),(()=>{for(let t=0;20!=t;t++)n.push({canvas:document.createElement("canvas"),toDraw:null});a()})(),s(),this.initialized=!0,this.isLowHealth()&&this.setActive(!0))},this.isLowHealth=()=>{let t=Engine.hero.d.warrior_stats.maxhp,e=Engine.hero.d.warrior_stats.hp;return parseFloat(e)/parseFloat(t)<.3},this.setBlink=t=>{this.blink=!!t},this.setGlow=()=>{let t=n[e],i=t.canvas;t.toDraw||r(),this.clearCanvas(),this.ctx.drawImage(i,0,0)};const r=()=>{let t=n[e],i=t.canvas,a=i.getContext("2d"),s=i.width,r=i.height;a.clearRect(0,0,s,r),a.save(),a.beginPath(),a.rect(-120,-120,s+240,r+240),a.clip(),a.globalAlpha=Math.floor(.05*e*100)/100,a.lineWidth=240,a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=120,a.shadowColor="#b71212",a.strokeRect(-120,-120,s+240,r+240),a.restore(),t.toDraw=!0};this.onResize=()=>{a(),s()},this.setActive=t=>{this.active=t,t||this.clearCanvas()},this.getActive=()=>this.active,this.clearCanvas=()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},this.getCanvas=()=>this.canvas,this.setSizeCanvas=(t,e)=>{this.canvas&&(this.canvas.width=t,this.canvas.height=e)}}},function(t,e,i){const n=i(69),a=i(208);t.exports=function(){const t="ColorInterfaceNotificationManager.js",e=n.ACTION.CREATE,i=n.ACTION.SHOW,s=n.ACTION.HIDE;let r=null,o=null,l=null,c=null;const d=()=>{r={}},h=e=>{let i=e.id,n=e.color;if(p(i))return void errorReport(t,"createColorInterfaceNotification","id exist!",e);let s=new a;((t,e)=>{r[t]=e})(i,s),s.init(n)},u=(e,i)=>{let n=e.id;p(n)?(g(n).setActive(i),i||E()):errorReport(t,"createColorInterfaceNotification","id not exist!",e)},p=t=>!!r[t],g=t=>r[t],f=n=>{const a="checkCorrectData";return elementIsObject(n)?n.action?n.id?[e,i,s].includes(n.action)?!(n.action==e&&!n.color)||(errorReport(t,a,"attr color not exist!",n),!1):(errorReport(t,a,"unregistered action",n),!1):(errorReport(t,a,"attr id not exist!",n),!1):(errorReport(t,a,"attr action not exist!",n),!1):(errorReport(t,a,"data have to be object!",n),!1)},m=()=>{let t=getEngine().interface.get$GAME_CANVAS();o.width=t.width(),o.height=t.height()},v=()=>{if(!l)return!1;for(let t in r)if(r[t].getActive())return!0;return!1},E=()=>{l&&l.clearRect(0,0,o.width,o.height)},_=()=>{"none"!=o.style.display&&(o.style.display="none")},b=()=>{"block"!=o.style.display&&(o.style.display="block")};this.init=()=>{d()},this.updateData=t=>{if(f(t))switch(t.action){case e:h(t);break;case i:u(t,!0);break;case s:u(t,!1)}},this.onClear=()=>{d()},this.checkNotificationExist=p,this.onResize=()=>{m();for(let t in r)r[t].onResize()},this.createMainCanvas=()=>{o=document.createElement("canvas"),l=o.getContext("2d"),o.id="color-interface-notification",o.classList.add("color-interface-notification"),m(),Engine.interface.get$gameLayer().append(o)},this.getBlink=()=>c,this.setBlink=t=>{c=!!t},this.update=t=>{if(v())for(let e in r)r[e].update(t)},this.draw=()=>{if(v()){b(),E();for(let t in r)r[t].draw(l)}else l&&_()}}},function(t,e){t.exports=function(){let t=!1,e=0,i=0,n=!0,a=[],s=null;const r=t=>{s=t},o=()=>{for(let t=0;20!=t;t++)a.push({canvas:document.createElement("canvas"),toDraw:null});l()},l=()=>{let t=getEngine().interface.get$GAME_CANVAS()[0],e=t.width,i=t.height;for(let t in a)a[t].canvas.width=e,a[t].canvas.height=i},c=()=>{for(let t in a)a[t].toDraw=!1},d=t=>{let e=a[i],n=e.canvas;e.toDraw||h(),t.drawImage(n,0,0)},h=()=>{let t=a[i],e=t.canvas,n=e.getContext("2d"),r=e.width,o=e.height;n.clearRect(0,0,r,o),n.save(),n.beginPath(),n.rect(-120,-120,r+240,o+240),n.clip(),n.globalAlpha=Math.floor(.05*i*100)/100,n.lineWidth=240,n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=120,n.shadowColor=s,n.strokeRect(-120,-120,r+240,o+240),n.restore(),t.toDraw=!0};this.init=function(t){r(t),o(),c()},this.setActive=e=>{t=e},this.getActive=()=>t,this.update=s=>{t&&(Engine.opt(8)||(e+=80*s,e<3.14||(e-=3.14,n?i++:i--,0!=i&&i+1!=a.length||(n=!n))))},this.draw=e=>{t&&d(e)},this.onResize=()=>{l(),c()}}},function(t,e,i){let n=i(210),a=i(211);t.exports=function(){const t={};let e;this.getSpecificAnimationIdFromElement=t=>this.getSpecificAnimationFromElement(t).attr("specific-animation-id"),this.getSpecificAnimationFromElement=t=>t.find(".specific-animation"),this.deleteSpecificAnimationInElementIfExist=t=>{let e=this.getSpecificAnimationIdFromElement(t);if(null!=e){this.removeAnimation(e),this.getSpecificAnimationFromElement(t).remove()}},this.createBlinkedAnimation=(t,i,n,a,s,r)=>{let o=e.getBlinkData(i,n,a,!1,s),l=Engine.specificAnimationManager.createAnimation(o).get$Canvas();l.addClass(r),t.prepend(l)},this.init=()=>{e=new a},this.draw=e=>{for(let i in t)t[i].draw(e)},this.update=e=>{for(let i in t)t[i].update(e)},this.checkElementHaveSpecificAnimation=t=>!!t.find(".specific-animation").length,this.getById=e=>t[e]?t[e]:null,this.getSpecificAnimationMechanism=()=>e,this.createAnimation=e=>{let i=(()=>{let e=0;for(;t[e];)e++;return e})(),a=new n;return((e,i)=>{t[e]=i})(i,a),a.init(i,e),a},this.removeAnimation=e=>{(e=>{delete t[e]})(e)},this.getAnimation=()=>t}},function(t,e){t.exports=function(){let t,e,i,n,a;const s=()=>{e=$("<canvas>"),t=e[0].getContext("2d"),e.addClass("specific-animation"),e.attr("specific-animation-id",a)},r=()=>{e.attr({width:n.width,height:n.height})},o=t=>{l&&(n=t,i=t.drawCallback)},l=t=>isset(t.height)?isset(t.width)?!!isset(t.drawCallback)||(warningReport("SpecificAnimation.js","checkDataCorrect","drawCallback drawCallback not exist!"),!1):(warningReport("SpecificAnimation.js","checkDataCorrect","attr width not exist!"),!1):(warningReport("SpecificAnimation.js","checkDataCorrect","attr height not exist!"),!1);this.init=(t,e)=>{a=t,o(e),s(),r()},this.getId=()=>a,this.draw=a=>{i(a,e,t,n)},this.get$Canvas=()=>e}},function(t,e){t.exports=function(){this.getBlinkData=(t,e,i,n,a)=>({width:t,height:e,ts:ts()/1e3,drawCallback:(t,e,s,r)=>{let o=a||1,l=Math.floor(100*Math.abs(Math.sin(o*ts()/1e3-r.ts)))/100;n&&l>n&&(l=n);let c=Math.floor(10*l);l=10*l-c>.5?c+.5:c,l/=10,s.globalAlpha!=l&&(s.clearRect(0,0,r.width,r.height),s.fillRect(0,0,r.width,r.height),s.fillStyle=i,s.globalAlpha=l)}})}},function(t,e){t.exports=function(){let t=null,e=null;const i=i=>{if(t=i,Engine.widgetManager.getWidgetLoaded()&&t.length)for(let t in e){let i,s=e[t];i=a(s)?Engine.widgetsData.type.BLINK_VIOLET:Engine.widgetsData.type.VIOLET;let r=n(s);if(null==r)return;Engine.widgetManager.updateOneWidgetNoticeProcedure(r,i)}},n=t=>{let e=(t=>{for(let e in Engine.widgetsData.notice)if(Engine.widgetsData.notice[e].nameNotice==t)return Engine.widgetsData.notice[e];return null})(t);return null==e?(errorReport("WidgetNoticeManager.js","getWidgetNameFromWidgetNoticeName",""),null):e.nameWidget},a=e=>t.indexOf(e)>-1;this.init=()=>{t=[],e=[Engine.widgetsData.notice.NEWS.nameNotice,Engine.widgetsData.notice.REWARDS_CALENDAR.nameNotice]},this.getData=()=>t,this.update=i,this.checkAlwaysAvailableByWidgetName=t=>{let e=(t=>{for(let e in Engine.widgetsData.notice)if(Engine.widgetsData.notice[e].nameWidget==t)return Engine.widgetsData.notice[e];return null})(t);return null==e?(errorReport("WidgetNoticeManager.js","checkAlwaysAvailableByWidgetName","Notice object not found by nameWidget: "+t,Engine.widgetData.notice),!1):!isset(e.alwaysAvailable)||e.alwaysAvailable},this.forceUpdate=()=>{i(t)}}},function(t,e,i){var n=i(0),a=i(214),s=i(15),r=i(12),o=i(28),l=i(38),c=i(26),d=i(8);t.exports=function(){let t={filName:"HeroEquipment.js"};var e=this,i=20,h={},u={},p=0,g=0,f=0,m=0,v=0,E=0;let _={},b={},w=null,C=!1;var T=null,y=null,I=null;let A=0;var k={appendTo:"body",helper:"clone",cancel:".disable-item-mark",distance:24,cursorAt:{top:16,left:16},scroll:!1,zIndex:20,start:function(t,i){var n=i.helper;m=0,e.getTs(),changeViewOfHelper(i.helper,$(this).data().item.id),e.saveOldXAndY(t.offsetX,t.offsetY),$(this).addClass("when-item-is-clone-in-draggable"),(n=i.helper).css("background","none"),n.find(".highlight").css("background","none")},stop:function(t,i){$(this).removeClass("when-item-is-clone-in-draggable"),null,e.clearItemOverBagTimeout()},drag:function(t){m+=Math.abs(v-t.offsetX)+Math.abs(E-t.offsetY),e.saveOldXAndY(t.offsetX,t.offsetY)}};const S=t=>{if(!M(t))return null;let e=[],i=_[t].data;for(let t in i){let n=i[t];e.push(n.$highlight)}return e},O=()=>{let t=[];for(let e in _){let i=_[e].data;for(let e in i){let n=i[e];t.push(n.$highlight)}}return t},M=t=>isset(_[t]);this.canDraggableFix=function(){return mobileCheck()&&m<10},this.getTs=function(){return(new Date).getTime()},this.saveOldXAndY=function(t,e){v=t,E=e},this.getCountAbbyssCurrency=function(){return p},this.getCountChempionsCurrency=function(){return g},this.setItemsInHeroEquipmentWasChange=t=>{C=t},this.newInventoryItems=function(i,n){if(notOwnItem(i.id,i))return;e.setItemsInHeroEquipmentWasChange(!0);let a=Engine.items.createViewIcon(i.id,Engine.itemsViewData.BAG_VIEW),s=a[0];e.addHighlightNewItem(i,s),e.eqItemsTable(i),h[i.id]=i,s.addClass("inventory-item"),s.draggable(k),e.changeLocation(i,s),e.addToBag(i),e.updateBagAmount(),e.increaseAbbyssItemAmount(i),e.increaseChampionsItemAmount(i),(t=>{let e=t.tpl;isset(b[e])||(b[e]=0),b[e]++})(i),((t,e)=>{let i=t.getName(),n=t.getId();M(i)||(_[i]={data:{},amount:0});let a=1,s=t.getAmount();s&&(a=parseInt(s));let r=e.find(".highlight");_[i].amount+=a,_[i].data[n]||(_[i].data[n]={item:t,$icon:e,$highlight:r})})(i,s),getEngine().quests.checkItemIsQuestItemAndAddHigllight(i.getName(),i.id),Engine.disableItemsManager.manageItemDisableInHeroEQ(i,a),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,3),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,3),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,33),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,3),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,3),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,33),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,13),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,13),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,17,i),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,19),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,19),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,20),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,20),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,4),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,5),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,10),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,11),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,11),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,13),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,13),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,14),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,14),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,16),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,16),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,19),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,19),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,21),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,21),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,26),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,26),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,20),Engine.interface.alreadyInitialised&&n&&Engine.itemsMarkManager.compareAllItems(),i.on("afterUpdate",(function(n,a){n.st!=i.st||n.x!=i.x||n.y!=i.y?(e.setItemsInHeroEquipmentWasChange(!0),e.changeLocation(this,s),e.bagManage(n,i)):a&&Engine.itemsMarkManager.compareAllItems(),i.updadeViewAfterUpdateItem(s),e.updateBagAmount(),((e,i)=>{let n=e.parseStats(i).amount,a=e.getAmount(),s=e.getName();if(!isset(a))return;let r=a-parseInt(n);0!=r&&(isset(_[s])?_[s].amount+=r:errorReport(t.filName,`itemName ${s} not exist!`,_))})(i,n.stat),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,3),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,3),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,33),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,3),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,3),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,33),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,20),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,20),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,4),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,5)})),i.on("delete",(function(){(e=>{let i=e.getName(),n=e.getId();if(!M(i))return void errorReport(t.fillName,"removeItemFromAmountItems","item not exist!",_);let a=1,s=e.getAmount();s&&(a=parseInt(s)),_[i].amount-=a,delete _[i].data[n],_[i].amount<=0&&delete _[i]})(i),(t=>{let e=t.tpl;b[e]--,0==b[e]&&delete b[e]})(i);let n=e.getEqItemsName(i.cl);null==n&&(n=i.cl);var a=u[n];a&&a==i&&delete u[n],delete h[i.id],Engine.interface.alreadyInitialised&&Engine.itemsMarkManager.compareAllItems(),e.setItemsInHeroEquipmentWasChange(!0),e.checkQuestTrack(),e.removeFromBag(i),e.updateBagAmount(),e.rebuiltBagsState(i),e.removeBless(i),e.decreaseAbbyssItemAmount(i),e.decreaseChampionsItemAmount(i),e.manageDoubledClass()})),e.checkQuestTrack()},this.initBeforeUpdateItems=()=>{Engine.items.addToBeforeUpdateItemsCallback(Engine.itemsFetchData.NEW_INVENTORY_ITEM,()=>{e.setItemsInHeroEquipmentWasChange(!1)})},this.initAfterUpdateItems=()=>{Engine.items.addToAfterUpdateItemsCallback(Engine.itemsFetchData.NEW_INVENTORY_ITEM,()=>{C&&this.manageDoubledClass()})},this.checkBlessEquipped=t=>!(!Engine.hero.d.is_blessed||!o.isBlessCl(t.cl)||r.isBlessSt(t.st))&&("undefined"==t.id&&console.trace(),mAlert(_t("change_exist_bless_question",null,"item"),[{txt:_t("yes"),callback:function(){return _g("moveitem&st=1&id="+t.id),!0}},{txt:_t("no"),callback:function(){return!0}}]),!0),this.dropBless=t=>{mAlert(_t("drop_bless_question",null,"item"),[{txt:_t("yes"),callback:function(){return _g(`moveitem&id=${t}&st=-2`),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.removeBless=function(t){o.isBlessCl(t.cl)&&r.isBlessSt(t.st)&&(message(_t("bless_end")),Engine.hero.removeBless())},this.checkAbbyssItem=function(t){return/eterium/.test(t.name.toLowerCase())},this.decreaseAbbyssItemAmount=function(t){if(e.checkAbbyssItem(t)){var i=isset(t.parseStats().amount)?parseInt(t.parseStats().amount):1;p-=i}},this.increaseAbbyssItemAmount=function(t){if(e.checkAbbyssItem(t)){var i=isset(t.parseStats().amount)?parseInt(t.parseStats().amount):1;p+=i}},this.checkChampionsItem=function(t){return/y czempion/.test(t.name.toLowerCase())},this.decreaseChampionsItemAmount=function(t){if(e.checkChampionsItem(t)){var i=isset(t.parseStats().amount)?parseInt(t.parseStats().amount):1;g-=i}},this.increaseChampionsItemAmount=function(t){if(e.checkChampionsItem(t)){var i=isset(t.parseStats().amount)?parseInt(t.parseStats().amount):1;g+=i}},this.rebuiltBagsState=function(t){if(!(o.isBagCl(t.cl)&&l.isEquipItemLoc(t.loc)&&r.isBagSlotSt(t.st)))return;const e=t.st-20;if(Engine.bags[e][2]===parseInt(t.id)){const i=Engine.items.getItemById(t.id)?Engine.bags[e][1]:0;Engine.bags[e]=[0,i,0]}},this.bagManage=function(t,e){this.itemChangeBag(t,e)&&(this.removeFromBag(t),this.addToBag(e))},this.addToBag=function(t){if(r.isInBagSt(t.st)){var e=Math.floor(t.y/6);Engine.bags[e][1]++}},this.removeFromBag=function(t){if(r.isInBagSt(t.st)&&!isset(t.returned)){var e=Math.floor(t.y/6);Engine.bags[e][1]--}},this.itemChangeBag=function(t,e){return Math.floor(t.y/6)!=Math.floor(e.y/6)},this.updateBagAmount=function(){let t=Engine.bags,e=0;for(let i=0;i<t.length;i++){let n=t[i];if(!n)continue;let a=n[0]-n[1],s=a<0?0:a;i!==t.length-1&&(e+=s),I.find("[data-bag="+(i+20)+"]").find(".amount").html(s)}A=e,Engine.loots&&Engine.loots.updateFreeBagSlots()},this.getFreeSlots=()=>A,this.addHighlightNewItem=function(t,i){var a=!(o.isBlessCl(t.cl)||r.isBagSlotSt(t.st)),s=t.getNow,l=i.find(".highlight").find(".new-item").length>0;if(a&&s&&!l){var c=n.get("new-item");i.find(".highlight").append(c),f++,e.updateAmountOnWidget(),i.on("mouseenter",(function(){$(this).unbind("mouseenter"),c.remove(),f--,e.updateAmountOnWidget()}))}},this.updateAmountOnWidget=()=>{let t=f||"";Engine.widgetManager.widgets.updateAmount(Engine.widgetsData.name.EQ_TOGGLE,t)},this.eqItemsTable=function(t){if(r.isInBagSt(t.st)||r.isPurseSt(t.st)||o.isNotEquipCl(t.cl))return;let i=e.getEqItemsName(t.cl);null==i&&(i=t.cl),u[i]=t},this.getEqItemsName=t=>{let e=null;return o.isWeaponCl(t)&&(e="weapon"),o.isMagicWeaponCl(t)&&(e="magic"),e},this.checkItemCanEquip=function(t){let e=t._cachedStats.reqp,i=t._cachedStats.lvl;return!(!r.isInBagSt(t.st)||o.isNotEquipClWithoutBlessCl(t.cl)||isset(i)&&i>Engine.hero.d.lvl||isset(e)&&e.indexOf(Engine.hero.d.prof)<0)},this.getEqItems=function(){return u},this.countItemsByName=function(t){var e=0;for(var i in h)h[i].name==t&&e++;return e},this.changeLocation=function(t,i){if(i.detach(),i.unbind("click dblclick"),i.css({top:"",left:""}),i.removeAttr("data-bag"),t.st&&r.isInBagOrInEquipNotBagsSlotsSt(t.st))y.find('[data-st="'+t.st+'"]').append(i),i.click(()=>{this.afterOnClickEq(t,i)}),i.bind("dblclick",(function(){switch(t.st){case s.ST.BLESS:e.dropBless(t.id);break;case s.ST.PURSE:console.log("sakwa dbclick"),e.afterDoubleClick(t,i);break;default:_g("moveitem&findslot=1&st=0&id="+t.id)}})),r.isPurseSt(t.st)?i.bind("contextmenu",(function(e,n){itemIsDisabled(i)||t.createOptionMenu(getE(e,n))})):i.bind("contextmenu",(function(n,a){var s;s=r.isBlessSt(t.st)?{txt:_t("take off"),f:function(){e.dropBless(t.id)}}:{txt:_t("take off"),f:function(){_g("moveitem&findslot=1&st=0&id="+t.id)}},itemIsDisabled(i)||t.createOptionMenu(getE(n,a),s,{move:!0,use:!0})}));else if(r.isBagSlotSt(t.st)){var n=t.st-20>3?3:t.st-20;i.attr("data-bag",t.st),i.css({left:34*n+n+4,top:4}),i.appendTo(T.find(".bags-navigation")),i.bind("click",(function(i){i.stopPropagation(),e.showBag(t.st)})),i.bind("contextmenu",(function(i,n){var a={txt:_t("change_state"),f:function(){e.showBag(t.st)}};t.createOptionMenu(getE(i,n),a,{move:!0,use:!0})})),e.manageShowBagByItemOver(t,i),r.isBag_0_SlotSt(t.st)&&i.draggable("destroy"),20+Engine.hero.d.bag==t.st&&this.showBag(t.st,!1)}else i.css({top:32*t.y+t.y,left:32*t.x+t.x}).appendTo(T.find(".scroll-pane")),i.click((function(n){if("dev"===Engine.worldConfig.getWorldName()&&c.getAltAndCtrl())return _g("moveitem&st=-2&id="+t.id);e.afterOneClick(t,i)})),i.bind("dblclick",(function(){specificElementsExist()||e.afterDoubleClick(t,i)})),i.off("contextmenu"),i.on("contextmenu",(function(n,a){e.afterRightClick(t,n,a,i)}))},this.manageShowBagByItemOver=(t,i)=>{let n=t.st;r.isBagSlotSt(n)&&i.droppable({accept:".item:not(.shop-item)",over:function(){e.manageClearOfItemOverBagTimeout(n),e.createItemOverBagTimeout(n)},out:function(){e.manageClearOfItemOverBagTimeout(n)}})},this.manageClearOfItemOverBagTimeout=t=>{w&&w[1]==t&&this.clearItemOverBagTimeout()},this.createItemOverBagTimeout=t=>{let i=setTimeout((function(){e.showBag(t),w=null}),500);w=[i,t]},this.clearItemOverBagTimeout=()=>{w&&(clearTimeout(w[0]),w=null)},this.manageDoubledClass=()=>{let t=[];for(let e in h){let i=h[e],n=Engine.items.getViewByIdAndLoc(i.id,Engine.itemsViewData.BAG_VIEW);r.isEquippedSt(i.st)||(0==i.x&&0==i.y?t.push(n):n.hasClass("doubled")&&n.removeClass("doubled"))}if(t.length<=1)for(let e in t){let i=t[e];i.hasClass("doubled")&&i.removeClass("doubled")}else for(let e in t){let i=t[e];i.hasClass("doubled")||(i.addClass("doubled"),0===parseInt(e)&&mAlert(_t("doubled_items")))}},this.afterOnClickEq=function(t,e){return!(!Engine.crafting||!Engine.crafting.enhancement)&&(Engine.crafting.enhancement.onClickInventoryItem(t),!0)},this.afterOneClick=function(t,e){if(e&&!itemIsDisabled(e))return Engine.barter&&Engine.barter.checkShowAffectedOfferId()?(Engine.barter.setBarterItem(t),!0):Engine.mails?(Engine.mails.setSendItem(t),!0):Engine.trade?(Engine.trade.setSellItem(t),!0):Engine.depo?(Engine.depo.setDepoItem(t),!0):Engine.auctions?(Engine.auctions.putAuctionOffItem(t),!0):Engine.shop?(Engine.shop.basket.sellItem(t),!0):Engine.crafting&&Engine.crafting.salvage?(Engine.crafting.salvage.onClickInventoryItem(t),!0):Engine.crafting&&Engine.crafting.enhancement?(Engine.crafting.enhancement.onClickInventoryItem(t),!0):Engine.crafting&&Engine.crafting.extraction?(Engine.crafting.extraction.onClickInventoryItem(t),!0):!!Engine.bonusReselectWindow&&(Engine.bonusReselectWindow.onClickInventoryItem(t),!0)},this.afterRightClick=function(t,e,i,n){itemIsDisabled(n)||t.createOptionMenu(getE(e,i))},this.afterDoubleClick=function(t,i){itemIsDisabled(i)||e.soulboundAlert(t)||e.blockBadTutorialItem(t)||e.checkBlessEquipped(t)||(e.sendUseRequest(t),e.checkQuestTrack())},this.canPreviewStatMenu=function(t,i,n){var a=[[_t("canpreview"),function(){_g("moveitem&st=2&id="+i.id),Engine.tpls.deleteMessItemsByLoc("p"),Engine.tpls.deleteMessItemsByLoc("s")}],[_t("take_reward",null,"matchmaking"),function(){e.sendUseRequest(i)}]];Engine.interface.showPopupMenu(a,n)},this.sendUseRequest=function(t,i){"undefined"==t.id&&console.trace(),console.log("this.sendUseRequest",t.id,t.tpl),_g("moveitem&st=1&id="+t.id,(function(n){if(i&&i(),!isset(n.alert)){isset(n.t)&&Engine.interface.checkTeleport(n);var s=t._cachedStats;API.callEvent(Engine.apiData.ITEM_USED,t),s.animation&&(Engine.chestAnimation||(Engine.chestAnimation=new a,Engine.chestAnimation.init())),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,11,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,11,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,14,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,14,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,16,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,16,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,21,t),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,21,t),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,22,t),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,22,t),e.callCheckCanFinishExternalTutorial(t.tpl)}}))},this.callCheckCanFinishExternalTutorial=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(d.ON_FINISH_REQUIRE.USE_ITEM_TPL,d.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.createChest=function(){Engine.chestAnimation=new a},this.showBag=function(t,e){e=!isset(e)||e;var n=Engine.interface.get$interfaceLayer().find(".inventory_wrapper"),a=n.find('[data-bag="'+t+'"]');a.length&&(i!=t&&_p("bag="+(t-20)),i=t,n.find(".bags-navigation .item").removeClass("active"),a.addClass("active"),n.find(".scroll-pane").css({top:198*-(t-20)},e?300:0))},this.getActiveBag=()=>i,this.init=function(){let t=Engine.interface.get$gameWindowPositioner();y=t.find(".right-column").find(".inner-wrapper").find(".character_wrapper"),T=t.find(".right-column").find(".inner-wrapper").find(".inventory_wrapper"),I=t.find(".right-column").find(".inner-wrapper").find(".bags-navigation"),this.initBeforeUpdateItems(),this.initAfterUpdateItems(),Engine.items.fetch(Engine.itemsFetchData.NEW_INVENTORY_ITEM,e.newInventoryItems),y.find(".equipment-wrapper").droppable({accept:".item:not(.shop-item)",drop:function(t,i){var n=i.draggable.data("item");if(!Engine.dead||isset(n._cachedStats.revive)){var a=i.offset.left-$(this).offset().left,o=i.offset.top-$(this).offset().top;if(-11<a&&a<18&&(88<o&&o<116))if(Engine.hero.d.lvl<25)message(_t("need__lvl",{"%val%":25}));else{const t="moveitem&st=9&id="+n.id,i=Engine.heroEquipment.getItemBySt(s.ST.PURSE);if(r.isEquippedSt(n.st)&&!r.isPurseSt(n.st)&&i&&e.soulboundAlert(i,t))return;_g(t)}else{if(e.soulboundAlert(n))return;if(e.blockBadTutorialItem(n))return;if(e.checkBlessEquipped(n))return;e.sendUseRequest(n)}}}}),T.find(".inventory-grid").droppable({accept:".item:not(.shop-item)",drop:function(t,n){const a=n.draggable.data("item");if(n.draggable.hasClass("bottomItem"))return void Engine.interfaceItems.deleteExistItem(a.id,a);var s=$(this).offset(),o=Math.floor((n.offset.top-s.top+n.draggable.height()*Engine.zoomFactor/2)/33/Engine.zoomFactor)+6*(i-20),c=Math.floor((n.offset.left-s.left+n.draggable.width()*Engine.zoomFactor/2)/33/Engine.zoomFactor);const d=e.getItemBySlotCords(c,o);c>6&&(c=6),o<0&&(o=0);const h="moveitem&st=0&id="+a.id+"&x="+c+"&y="+o;if(a.stat.match(/amount/)&&t.shiftKey){let t=!!d;e.splitItem(a,c,o,t)}else{if(d){let t=Engine.items.getAllViewsByIdAndViewName(d.id,Engine.itemsViewData.BAG_VIEW)[0];if(itemIsDisabled(t))return;if(l.isEquipItemLoc(a.loc)&&l.isEquipItemLoc(d.loc)&&a.id!==d.id){if(e.checkBonusReselect(a,d,c,o))return;if(e.checkEnhancementAdd(a,d,c,o))return}if(r.isEquippedSt(a.st)&&!r.isPurseSt(a.st)&&l.isEquipItemLoc(d.loc)&&e.soulboundAlert(d,h))return}l.isPrivateDepoItemLoc(a.loc)?_g("depo&get="+a.id+"&x="+c+"&y="+o):l.isClanDepoItemLoc(a.loc)?_g("clan&a=depo&op=item_get&id="+a.id+"&x="+c+"&y="+o):_g(h)}}}),T.find(".bags-navigation").droppable({accept:".item:not(.shop-item)",drop:function(t,e){var i=e.draggable.data("item"),n=$(this).offset(),a=Math.floor((e.offset.left+e.draggable.height()*Engine.zoomFactor/2-n.left)/33/Engine.zoomFactor);a>=0&&a<4&&(a=3==a?6:a,isset(i._cachedStats.bag)&&(i.st<20||i.st>26)&&!isset(i._cachedStats.soulbound)&&!isset(i._cachedStats.permbound)?mAlert(_t("bag_drop_infotxt",null,"item"),[{txt:_t("yes"),callback:function(){return _g("moveitem&id="+i.id+"&st="+(20+a)+"&put=1"),!0}},{txt:_t("no"),callback:function(){return _g("moveitem&id="+i.id+"&st="+(20+a)+"&put=2"),!0}}]):_g("moveitem&id="+i.id+"&st="+(20+a)))}})},this.checkBonusReselect=(t,e,i,n)=>!(!isset(t._cachedStats.bonus_reselect)||!isset(e._cachedStats.bonus))&&(this.movedOnItemConfirm(_t("bonus_reselect_confirm",{"%val%":e.name}),t.id,i,n),!0),this.checkEnhancementAdd=(t,e,i,n)=>!(!isset(t._cachedStats.enhancement_add)&&!isset(t._cachedStats.enhancement_add_point)||!o.isEquipCl(e.cl))&&(this.movedOnItemConfirm(_t("enhancement_add_confirm"),t.id,i,n),!0),this.movedOnItemConfirm=(t,e,i,n)=>{mAlert(t,[{txt:_t("yes"),callback:function(){return _g("moveitem&st=0&id="+e+"&x="+i+"&y="+n),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.getItemBySlotCords=(t,e)=>{for(let i in h){let n=h[i];if(!r.isEquippedSt(n.st)&&(n.x==t&&n.y==e))return n}return!1},this.getItemBySt=t=>{for(let e in h){let i=h[e];if(r.isEquippedSt(i.st)&&i.st===t)return i}return!1},this.blockBadTutorialItem=t=>{if(!Engine.tutorials)return!1;return!!Engine.tutorialManager.getTutorialNeedItems()&&(!Engine.tutorialManager.checkUseItemIsRightWithTutorialItemsNeed(t)&&(message(_t("use_tutorial_item")),!0))},this.soulboundAlert=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i=t.parseStats();if(isset(i.binds)){if(isset(i.reqp)&&i.reqp.indexOf(Engine.hero.d.prof)<0)return mAlert(_t("bad_prof_to_use_item")),!0;if(isset(i.lvl)&&i.lvl>Engine.hero.d.lvl)return mAlert(_t("low_level_to_use_item")),!0;var n=_t("sure_soulbound",null,"item");return mAlert(n,[{txt:_t("yes"),callback:function(){return"undefined"==t.id&&console.trace(),e=e||"moveitem&st=1&id="+t.id,_g(e),!0}},{txt:_t("no"),callback:function(){return!0}}]),!0}return!1},this.splitItem=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a,s=[_t("quest_item_cant_split",null,"item"),_t("this_item_cant_split",null,"item"),_t("this_item_cant_split",null,"item"),_t("split_bad_value",null,"item")],r=Engine.items.parseItemStat(t.stat),l=r.amount;if(l>1){if(0==r.cansplit)return mAlert(s[1]);if(!r.capacity&&!o.isArrowsCl(t.cl))return mAlert(s[1]);a=n?"moveitem&findslot=1&st=0&id="+t.id+"&x="+e+"&y="+i+"&split=":"moveitem&st=0&id="+t.id+"&x="+e+"&y="+i+"&split=",this.alertWindow(l,a)}},this.alertWindow=function(t,i){var n,a=[_t("item_split %max%",{"%max%":t-1},"item"),_t("cancel",null,"buttons"),'<div class="input-wrapper"><input id="divide-items" class="default" placeholder="..." /></div>'];mAlert(a[0]+a[2],[{txt:"Ok",callback:function(){let a=n.val();return!checkInputValIsEmptyProcedure(a)&&(e.checkValue(a,t,i),!0)}},{txt:a[1],callback:function(){return!0}}],(function(t){n=t.$.find(".default"),t.$.addClass("askAlert"),setOnlyPositiveNumberInInput(t.$.find("input"))})),mobileCheck()||$("#divide-items").focus()},this.checkValue=function(t,e,i){var n=_t("split_bad_value",null,"item");isNaN(t)||parseInt(t)>=parseInt(e)?mAlert(n):_g(i+t)},this.checkQuestTrack=function(){},this.getHItems=function(){return h};const N=(t,e)=>{if(t)for(let i=0;i<t.length;i++){let n=t[i];n.hasClass(e)||n.addClass(e)}},R=(t,e)=>{if(t)for(let i=0;i<t.length;i++){let n=t[i];n.hasClass(e)&&n.removeClass(e)}};this.setClassInItemsHighlightIfExist=(t,e)=>{let i=S(t);i&&N(i,e)},this.unsetClassInItemsHighlightIfExist=(t,e)=>{let i=S(t);i&&R(i,e)},this.setClassInItemsHighlight=N,this.clearHighlightInItems=t=>{let e=O();R(e,t)},this.getAmountItemAmount=t=>M(t)?_[t].amount:null,this.getAmountItemData=t=>M(t)?_[t].data:null,this.getAmountItem$highlight=S,this.getAmountItem$highlightById=(t,e)=>{if(!M(t))return null;let i=_[t].data;return i[e]?i[e].$highlight:null},this.getHeroItemTpl=t=>!!b[t],this.getAmountItemAll$highlights=O}},function(t,e){t.exports=function(){var t=this;this.animation=!1,this.init=function(){this.animation&&this.doAnimation()},this.doAnimation=function(){this.initWindow(),t.wnd.center()},this.initWindow=function(){Engine.windowManager.add({content:void 0,nameWindow:Engine.windowsData.name.CHESTS_ANIMATION,nameRefInParent:"wnd",objParent:this,title:_t("loot_choose",null,"loot"),onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()},this.close=function(){Engine.chestAnimation=!1,t.wnd.remove(),Engine.chests=!1}}},function(t,e){t.exports=function(){this.steps=[],this.times=[],this.append=function(t){this.steps.push(t.x+","+t.y),this.times.push(unix_time(!1,!0))},this.correct=function(t,e){var i=this.steps.indexOf(t+","+e);i>=0&&(this.steps=this.steps.splice(i-1))},this.slice=function(t){this.steps=this.steps.slice(t),this.times=this.times.slice(t)},this.checkAndSlice=function(t){for(var e=null,i=this.steps.length;i>0;i--)if(this.steps[i-1]==t.x+","+t.y){e=i-1;break}return null!==e&&(this.slice(e+1),!0)},this.reset=function(){this.steps=[],this.times=[]},this.isStepsToSend=function(){return this.steps.length>0}}},function(t,e){t.exports=function(){this.list=[],this.add=function(t){Engine.hero.clearAutoPathOfHero(),this.list.indexOf(t)<0&&this.list.push(t),Engine.stepsToSend.reset(),Engine.hero.setHeroInLastServerPos()},this.remove=function(t){this.list.indexOf(t)>=0&&this.list.splice(this.list.indexOf(t),1)},this.check=function(t){return isset(t)?this.list.indexOf(t)>=0:this.list.length>0}}},function(t,e){t.exports=function(){let t=!0;const e=e=>{t=e},i=()=>{document.addEventListener("visibilitychange",t=>{document.hidden?e(!1):e(!0)})};this.init=function(){i()},this.getChromeCardActive=()=>t}},function(t,e){t.exports=function(){this.defaultDiff=150,this.stasisDiff=500,this.deactivatedCard=1e4,this.diff=this.defaultDiff,this.lastRequest=(new Date).getTime();let t=!1;this.tick=function(){if(this.checkCanSendRequest())if(Engine.communication.checkCanSendTaskFromTaskQueue())Engine.communication.sendTaskFromQueue();else{let t=Engine.serverStorage.getPackageToSendToServerStorage();t?(Engine.serverStorage.createOldDataAndResetNewData(),Engine.serverStorage.sendDataToServerStorage(t)):_g("_")}},this.checkCanSendRequest=function(){if(t)return!1;var e=(new Date).getTime();let i=Engine.browserCardManager.getChromeCardActive()?this.diff:this.deactivatedCard;return e-this.lastRequest>=i&&Engine.tickSuccess},this.reset=function(){this.lastRequest=(new Date).getTime()},this.setDiff=t=>{this.diff=t},this.setDefaultDiff=()=>{this.setDiff(this.defaultDiff)},this.setStasisDiff=()=>{this.setDiff(this.stasisDiff)},this.setBlockSend=e=>{t=e}}},function(t,e){t.exports=function(){var t;this.init=function(){t=Engine.interface.get$GAME_CANVAS()},this.show=function(e,i){t.tip(null),t.tip(i.tip[0],i.tip[1],null,i.tip[2]),t.tipShow(e,i)},this.hide=function(e){t.tip(null),t.tipHide(e)}}},function(t,e){t.exports=function(){var t={},e=0;this.load=function(i){1!=t[i]&&(t[i]=!0,e+=20,this.updateProgressBar())},this.updateProgressBar=function(){var t=Engine.interface.get$gameWindowPositioner().find(".loader-layer .progress-bar .inner");setPercentProgressBar(t,e),e>=100&&Engine.interface.lock.unlock("loader")}}},function(module,exports,__webpack_require__){var Dialogue=__webpack_require__(222),Loot=__webpack_require__(106),Shop=__webpack_require__(224),Loader=__webpack_require__(228),MailsManager=__webpack_require__(236),RecoveryItems=__webpack_require__(241);let SocietyData=__webpack_require__(17);var Society=__webpack_require__(242),Party=__webpack_require__(244),Trade=__webpack_require__(245),WantedController=__webpack_require__(68),Registration=__webpack_require__(246),Depo=__webpack_require__(247),Clan=__webpack_require__(248),EventCalendar=__webpack_require__(269),Book=__webpack_require__(270),Motel=__webpack_require__(271),GoldShop=__webpack_require__(272),Skills=__webpack_require__(273),QuestsManager=__webpack_require__(276),LogOff=__webpack_require__(279),Chests=__webpack_require__(280),Promo=__webpack_require__(282),AuctionManager=__webpack_require__(283),LootPreview=__webpack_require__(300),News=__webpack_require__(301),TpScroll=__webpack_require__(112),RewardsCalendar=__webpack_require__(302),Barter=__webpack_require__(303),ConquerStats=__webpack_require__(304),ChooseOutfit=__webpack_require__(111);const BonusSelectorWindow=__webpack_require__(305),BonusReselectWindow=__webpack_require__(306),BattlePass=__webpack_require__(307);let ThemeData=__webpack_require__(33),CodeMessageData=__webpack_require__(30);module.exports=function(){var self=this,callbacks=[];let fullDataPackage,webSocket,webSocketBefore,webSocketAfter,webSocketT0,webSocketInMove,webSocketTask;this.tmpParams=[],this.taskCallbacks={},this.taskPayload={},this.taskQueue=[],this.idleRequestCounter=0,this.heroIdle=!0;let globalAddonsInitWasReceived=!1;window._g=function(t,e,i){Engine.requestCorrect.checkTaskIsCorrect(t)?self.checkCanAddTaskToTaskQueue(t)?self.addToTaskQueue(t,e,i):(Engine.interface.heroElements.startLag(),CFG.webSocketVersion?Engine.communication.send2(t,e,i):Engine.communication.send(t,e,i)):errorReport("Communication.js","_g","Task is not correct",t)},window._p=function(t,e){self.addParams(t,e)},this.manageHeroIdle=t=>{t?(this.heroIdle=!1,this.idleRequestCounter=0):(this.idleRequestCounter++,this.idleRequestCounter>1&&(this.heroIdle=!0))},this.checkCanAddTaskToTaskQueue=function(t){if(!globalAddonsInitWasReceived)return!1;let e=(new Date).getTime();return"_"!=t&&(!Engine.tickSuccess||e-Engine.idleJSON.lastRequest<Engine.idleJSON.diff)},this.checkCanSendTaskFromTaskQueue=function(){return self.taskQueue.length},this.sendTaskFromQueue=function(){var t=self.taskQueue[0],e=self.taskCallbacks[t],i=self.taskPayload[t];return e&&i?_g(t,e,i):i?_g(t,!1,i):e?_g(t,e):void _g(t)},this.addToTaskQueue=function(t,e,i){self.taskQueue.indexOf(t)>-1||(self.taskQueue.push(t),self.taskCallbacks[t]=null==e?null:e,self.taskPayload[t]=null==i?null:i)},this.removeFromTaskQueue=function(t){var e=self.taskQueue.indexOf(t);e<0||(self.taskQueue.splice(e,1),delete self.taskCallbacks[t],delete self.taskPayload[t])},this.send=function(t,e,i){var n=null,a=Object.prototype.toString.call(e);i&&(n=i);var s=function(){},r=e||function(){};"[object Array]"==a?(s="function"==typeof e[0]?e[0]:s,r="function"==typeof e[1]?e[1]:s):r="function"==typeof e?e:r;var o=new Date,l=o.getTime();let c=Engine.oldTime?Engine.oldTime:Date.now();Engine.oldTime=l;let d=zero(o.getHours())+":"+zero(o.getMinutes())+":"+zero(o.getSeconds());l-c>15e3&&console.error("TIME BEETWEN SEND",l,d,l-c);let h=Engine.stepsToSend.isStepsToSend();$.ajax({url:"/engine?t="+t+this.prepareUrl(),type:"post",contentType:"application/json; charset=UTF-8",data:n?JSON.stringify(n):null,success:function(e,i,n){Engine.tickSuccess=!0,self.manageHeroIdle(h),"_"!=t&&self.removeFromTaskQueue(t),e.lag=Date.now()-l,s(e),self.parseJSON(e);for(var a=0;a<callbacks.length;a++)callbacks[a](e);callbacks=[],r(e),Engine.GA.onRequest(t,e)},error:function(e){if(504==e.status)return Engine.console.warn(_t("Request rejected")),Engine.tickSuccess=!0,void("_"!=t&&self.removeFromTaskQueue(t));Engine.reconnect.disconnect(e),console.error("[Communication.js, send] Ajax ERROR")}}),Engine.idleJSON.reset(),Engine.tickSuccess=!1},this.send2=function(t,e,i){let n=null,a=Object.prototype.toString.call(e);webSocketTask=t,i&&(n=i),webSocketBefore=function(){},webSocketAfter=e||function(){},"[object Array]"==a?(webSocketBefore="function"==typeof e[0]?e[0]:webSocketBefore,webSocketAfter="function"==typeof e[1]?e[1]:webSocketBefore):webSocketAfter="function"==typeof e?e:webSocketAfter,webSocketInMove=Engine.stepsToSend.isStepsToSend(),webSocketT0=Date.now();let s="t="+webSocketTask+this.prepareUrl();self.webSocketSendData(s,n),Engine.idleJSON.reset(),Engine.tickSuccess=!1},this.errorData=t=>{let e=webSocketTask;if(console.log(t),this.webSocketVarsClear(),504==t.status)return Engine.console.warn(_t("Request rejected")),Engine.tickSuccess=!0,void("_"!=e&&self.removeFromTaskQueue(e));Engine.reconnect.disconnect(t),console.error("[Communication.js, errorData] Communication websocket ERROR")},this.webSocketVarsClear=()=>{webSocketTask=null,webSocketBefore=null,webSocketAfter=null,webSocketT0=null,webSocketInMove=null},this.setGlobalAddonsWasReceived=t=>{globalAddonsInitWasReceived=t},this.getGlobalAddonsWasReceived=()=>globalAddonsInitWasReceived,this.successData=t=>{let e=webSocketTask,i=webSocketBefore,n=webSocketAfter,a=webSocketT0,s=webSocketInMove;this.webSocketVarsClear();let r=JSON.parse(t);self.resetFullDataPackage(),self.setFullDataPackage(r),Engine.tickSuccess=!0,self.manageHeroIdle(s),r.lag=Date.now()-a,"_"!=e&&self.removeFromTaskQueue(e),i(r),self.parseJSON(r);for(var o=0;o<callbacks.length;o++)callbacks[o](r);callbacks=[],n(r);let l=Engine.getFirstNotInit();Engine.allInit&&1==l&&Engine.setFirstNotInit(!1),Engine.allInit&&null===l&&Engine.setFirstNotInit(!0),Engine.GA.onRequest(e,r)},this.onOpenWebSocket=()=>{Engine.setWebSocketConnect(!0),Engine.globalAddons.checkAddonsTurnOn()?_g("addon"):(self.setGlobalAddonsWasReceived(!0),this.startCallInitAfterRecivedAddons())},this.startCallInitAfterRecivedAddons=()=>{Engine.tickSuccess=!0,Engine.globalAddons.setMsgInConsoleAndCreateButtonInConsole(),Engine.reCallInitQueue()},this.onMessageWebSocket=t=>{let e=t.data;if(!this.getGlobalAddonsWasReceived()){let t=JSON.parse(e);if(Engine.globalAddons.checkIsGlobalAddonRequestAnswer(t))return self.setGlobalAddonsWasReceived(!0),void Engine.globalAddons.initGlobalAddonLink(t.addon)}""!=e?self.successData(e):pageReload()},this.initWebSocket=()=>{let t=location.hostname.split(".")[0],e=new RegExp("local$|local([0-9]+)$","g"),i=t.match(e),n="https:"==location.protocol||i?"wss":"ws",a=location.origin.split(".").pop();t=i?"dev":t,webSocket=new WebSocket(n+"://"+t+".margonem."+a+"/ws-engine"),webSocket.onopen=function(t){self.onOpenWebSocket()},webSocket.onclose=function(t){setTimeout(()=>{location.reload()},300)},webSocket.onmessage=function(t){self.onMessageWebSocket(t)},webSocket.onerror=function(t){self.errorData(t)}},this.getFullDataPackage=()=>fullDataPackage,this.setFullDataPackage=t=>{fullDataPackage=t},this.resetFullDataPackage=()=>{fullDataPackage=null},this.webSocketSendData=(t,e)=>{let i={g:t,p:e?JSON.stringify(e):""},n=JSON.stringify(i);webSocket.send(n)},this.addParams=function(t,e){"function"==typeof e&&callbacks.push(e),this.tmpParams.push(t)},this.prepareUrl=function(){var t="";let e=Engine.getEv();return this.sendEv(),t+=Engine.fetchURISteps(),t+=""!=e?"&ev="+e:"",t+=isset(Engine.browserToken)?"&browser_token="+Engine.browserToken:"",t+=""!=this.tmpParams?"&"+this.tmpParams.join("&"):"",this.tmpParams=[],t},this.sendEv=function(){let t=Engine.getEv();""==t||Engine.reconnect.stateInterval()||(Engine.getLastEv()===t&&pageReload(),Engine.setLastEv(t))};let testJSONData={CLAN_SYSTEM_MESSAGE:{state:!1,getJSON:function(){return{businessCards:[{acc:1406394,clan:1325,icon:"/kuf/uni_xxvii_milosnik_u3.gif",id:0x6ffad60473b3,lvl:120,nick:"asdasdasdasd",prof:"p",sex:!0}],chat:{channels:{clan:{archivedIds:[],msg:[{code:'{"message":[{"id":4003001,"params":["asdasdasdasd","ITEM#f7eae61f2259dd385fab56056895d2a21ccbe216b0a40ad35bbcbde08bb4011f:\\"Palce wymuszonej symbiozy\\""]}]}',id:378,related:[0x6ffad60473b3],style:4,ts:1713268543}]}}}}}},FIGHT1:{state:!1,getJSON:function(){return{f:{init:"1",auto:"0",battleground:"dd4.jpg",skills_disabled:[],skills_combo_max:[],skills:["-1","","","","","","","","","","-2","","","","","","","","",""],w:{[Engine.hero.getId()]:{originalId:Engine.hero.getId(),name:"Jaon",lvl:333,prof:"p",gender:"m",npc:0,hpp:100,team:2,y:3,icon:"/pal/30/m_pal15.gif",buffs:0},17943:{originalId:17943,name:"wenrzagh",lvl:80,prof:"p",gender:"m",npc:0,hpp:62,team:2,y:3,icon:"/noob/pm.gif",buffs:0},17998:{originalId:17998,name:"Wyrewolwerowany Reys",lvl:300,prof:"p",gender:"m",npc:0,hpp:67,team:2,y:3,icon:"/noob/pm.gif",buffs:0},18156:{originalId:18156,name:"sasfss",lvl:33,prof:"w",gender:"m",npc:0,hpp:100,team:2,y:3,icon:"/woj/30/m_woj07.gif",buffs:0},18254:{originalId:18254,name:"Kabuvonxa",lvl:150,prof:"w",gender:"m",npc:0,hpp:100,team:2,y:3,icon:"/noob/wm.gif",buffs:0},123551:{originalId:123551,name:"majcin",lvl:300,prof:"b",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/crimson/bm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0,cooldowns:[],doublecastcost:[],combo:0},153620:{originalId:153620,name:"Trololololo tester",lvl:300,prof:"h",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/hm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154016:{originalId:154016,name:"kidos tester",lvl:300,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/pm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154017:{originalId:154017,name:"kaisrokok",lvl:300,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/pm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154019:{originalId:154019,name:"To nie koniec",lvl:300,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/wm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154020:{originalId:154020,name:"Trolek super ziomek",lvl:300,prof:"b",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/bm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154022:{originalId:154022,name:"hejka siemka",lvl:300,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/pm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154023:{originalId:154023,name:"Kareiusz Septyzar",lvl:1,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/wm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154025:{originalId:154025,name:"Dorran Bun",lvl:300,prof:"m",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/mm.gif",mana:0,energy:50,mana0:0,energy0:50,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},154028:{originalId:154028,name:"Uniwersum Arbuza",lvl:181,prof:"w",gender:"m",npc:0,hpp:98,team:2,y:3,icon:"/noob/wm.gif",buffs:0}},myteam:1,move:0,current:Engine.hero.getId(),turns_warriors:{1:Engine.hero.getId(),2:17998,3:Engine.hero.getId(),4:153620,5:Engine.hero.getId(),6:123551,7:154020,8:17998,9:154028,10:Engine.hero.getId()}}}}},FIGHT2:{state:!1,getJSON:function(){return{f:{init:"1",auto:"0",battleground:"034.jpg",skills_disabled:[58],skills_combo_max:[],skills:["-1","","","","","","","","","","-2","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","58","Lodowy pocisk","5","9","2","Wzmocnienie kryszta�u energii zimna w broni sprawia, �e spowolnienie celu zostaje zwi�kszone, a lodowy pocisk ma szans� zamrozi� przeciwnika.","reqp=m;reqw=frost;lvl=25","1/10","slowfreeze_per=30@2;freeze=10;mana=24;combo-skill=1;frostbon=0.1 ",""],w:{[Engine.hero.getId()]:{originalId:Engine.hero.getId(),name:"Abbyss tester t",lvl:300,prof:"m",gender:"m",npc:0,hpp:100,team:1,y:4,icon:"/kuf/kuf_krolo-snieg.gif",mana:0,energy:2e3,mana0:0,energy0:2e3,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0,cooldowns:[],doublecastcost:[],combo:0},"-148450":{originalId:148450,name:"Klon Klon Kr�lik do�wiadczalny P1",lvl:1,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"dom/krolik01.gif",ac:{cur:1,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:10,bonus:0},buffs:0},"-198229":{originalId:198229,name:"Klon Klon Hydrokora Chimeryczna",lvl:25,prof:"h",gender:"x",npc:1,wt:12,hpp:100,team:2,y:5,icon:"kol/hydrokora.gif",ac:{cur:147,bonus:0},resfire:{cur:42,bonus:0},resfrost:{cur:42,bonus:0},reslight:{cur:42,bonus:0},act:{cur:280,bonus:0},buffs:0},"-198556":{originalId:198556,name:"Klon Lusgrathera Kr�lowa Pramatka",lvl:17,prof:"m",gender:"x",npc:1,wt:1,hpp:100,team:2,y:4,icon:"e2/prakrolowa.gif",ac:{cur:46,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:6,bonus:0},buffs:0}},myteam:1,move:10,start_move:15,current:Engine.hero.getId(),turns_warriors:{3:Engine.hero.getId(),4:Engine.hero.getId(),5:Engine.hero.getId(),6:Engine.hero.getId(),7:Engine.hero.getId(),8:Engine.hero.getId(),9:Engine.hero.getId(),10:Engine.hero.getId(),11:-198229,12:Engine.hero.getId()},m:["-198229=100;0;surpass_bonus_total=40",Engine.hero.getId()+"=100;0;step",Engine.hero.getId()+"=100;0;step"],mi:[0,1,2]}}}},FIGHT3:{state:!1,getJSON:function(){return{f:{init:"1",auto:"0",battleground:"034.jpg",skills_disabled:[58],skills_combo_max:[],skills:["-1","","","","","","","","","","-2","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","0","","","","","","","","","","58","Lodowy pocisk","5","9","2","Wzmocnienie kryszta�u energii zimna w broni sprawia, �e spowolnienie celu zostaje zwi�kszone, a lodowy pocisk ma szans� zamrozi� przeciwnika.","reqp=m;reqw=frost;lvl=25","1/10","slowfreeze_per=30@2;freeze=10;mana=24;combo-skill=1;frostbon=0.1 ",""],w:{[Engine.hero.getId()]:{originalId:Engine.hero.getId(),name:"Abbyss tester t",lvl:300,prof:"m",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/kuf/kuf_krolo-snieg.gif",mana:0,energy:2e3,mana0:0,energy0:2e3,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0,cooldowns:[],doublecastcost:[],combo:0},"-279166":{originalId:279166,name:"Pradawny mag zniszczenia",lvl:166,prof:"m",gender:"x",npc:1,wt:11,hpp:100,team:2,y:4,icon:"hum/praork_mag2a.gif",ac:{cur:1769,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:51,bonus:0},act:{cur:26,bonus:0},buffs:0},"-279157":{originalId:279157,name:"Cytrusowa galareta",lvl:65,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"pot/bestia35.gif",ac:{cur:507,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:16,bonus:0},buffs:0},"-279158":{originalId:279158,name:"Cytrusowa galareta",lvl:65,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"pot/bestia35.gif",ac:{cur:507,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:16,bonus:0},buffs:0},"-279159":{originalId:279159,name:"Cytrusowa galareta",lvl:65,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"pot/bestia35.gif",ac:{cur:507,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:16,bonus:0},buffs:0},"-279160":{originalId:279160,name:"Cytrusowa galareta",lvl:65,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"pot/bestia35.gif",ac:{cur:507,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:16,bonus:0},buffs:0},"-279161":{originalId:279161,name:"Cytrusowa galareta",lvl:65,prof:"w",gender:"x",npc:1,wt:0,hpp:100,team:2,y:3,icon:"pot/bestia35.gif",ac:{cur:507,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:16,bonus:0},buffs:0},"-279162":{originalId:279162,name:"Pradawny mag zniszczenia",lvl:166,prof:"m",gender:"x",npc:1,wt:11,hpp:100,team:2,y:4,icon:"hum/praork_mag2a.gif",ac:{cur:1769,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:51,bonus:0},act:{cur:26,bonus:0},buffs:0},"-279163":{originalId:279163,name:"Pradawny mag zniszczenia",lvl:166,prof:"m",gender:"x",npc:1,wt:11,hpp:100,team:2,y:4,icon:"hum/praork_mag2a.gif",ac:{cur:1769,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:51,bonus:0},act:{cur:26,bonus:0},buffs:0},"-279164":{originalId:279164,name:"Pradawny mag zniszczenia",lvl:166,prof:"m",gender:"x",npc:1,wt:11,hpp:100,team:2,y:4,icon:"hum/praork_mag2a.gif",ac:{cur:1769,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:51,bonus:0},act:{cur:26,bonus:0},buffs:0},"-279165":{originalId:279165,name:"Pradawny mag zniszczenia",lvl:166,prof:"m",gender:"x",npc:1,wt:11,hpp:100,team:2,y:4,icon:"hum/praork_mag2a.gif",ac:{cur:1769,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:51,bonus:0},act:{cur:26,bonus:0},buffs:0}},myteam:1,move:15,start_move:15,current:Engine.hero.getId(),turns_warriors:{1:Engine.hero.getId(),2:Engine.hero.getId(),3:Engine.hero.getId(),4:Engine.hero.getId(),5:Engine.hero.getId(),6:Engine.hero.getId(),7:Engine.hero.getId(),8:Engine.hero.getId(),9:Engine.hero.getId(),10:-279166}}}}},FIGHT4:{state:!1,getJSON:function(){return{f:{init:"1",auto:"0",battleground:"004.jpg",skills_disabled:[],skills_combo_max:[],skills:["-1","","","","","","","","","","-2","","","","","","","","",""],w:{1021:{originalId:1021,name:"Ayaohchi",lvl:71,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/kuf/kuf_out-zil-artm.gif",mana:0,energy:5e3,mana0:0,energy0:5e3,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},1402:{originalId:1402,name:"coffeeholic",lvl:300,prof:"p",gender:"k",npc:0,hpp:100,team:1,y:2,icon:"/noob/pk.gif",mana:1200,energy:1500,mana0:1200,energy0:1500,fast:0,ac:{cur:11160,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:12,bonus:0},reslight:{cur:6,bonus:0},act:{cur:0,bonus:0},buffs:0},1603:{originalId:1603,name:"Profensja dla dzieci",lvl:210,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/spec/duch-out.gif",mana:10050,energy:5280,mana0:10050,energy0:5280,fast:0,ac:{cur:163320,bonus:0},resfire:{cur:6,bonus:0},resfrost:{cur:7,bonus:0},reslight:{cur:9,bonus:0},act:{cur:0,bonus:0},buffs:0},1640:{originalId:1640,name:"Testowa posta� �e�ska",lvl:222,prof:"b",gender:"k",npc:0,hpp:100,team:1,y:2,icon:"/bd/30/f_bd12.gif",mana:0,energy:5100,mana0:0,energy0:5100,fast:0,ac:{cur:44370,bonus:0},resfire:{cur:11,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:5,bonus:0},act:{cur:28,bonus:0},buffs:0},1656:{originalId:1656,name:"Grabarz",lvl:300,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/eve/h22_lega1_m.gif",mana:0,energy:1500,mana0:0,energy0:1500,fast:0,ac:{cur:4110,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},1668:{originalId:1668,name:"Garus Tyrak",lvl:232,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/paid/male_7.gif",mana:6630,energy:5940,mana0:6630,energy0:5940,fast:0,ac:{cur:129390,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:16,bonus:0},reslight:{cur:12,bonus:0},act:{cur:5,bonus:0},buffs:0},1674:{originalId:1674,name:"Lancu jeden",lvl:300,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/wm.gif",mana:240,energy:3660,mana0:240,energy0:3660,fast:0,ac:{cur:2370,bonus:0},resfire:{cur:3,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},[Engine.hero.getId()]:{originalId:Engine.hero.getId(),name:"majcin najman",lvl:300,prof:"w",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/paid/her_kocha_m.gif",mana:0,energy:2550,mana0:0,energy0:2550,fast:0,ac:{cur:5280,bonus:0},resfire:{cur:0,bonus:0},resfrost:{cur:5,bonus:0},reslight:{cur:0,bonus:0},act:{cur:8,bonus:0},buffs:0,cooldowns:[],doublecastcost:[],combo:0},1897:{originalId:1897,name:"Menda z Rabarbaru",lvl:500,prof:"b",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/spec/dragon.gif",mana:0,energy:8550,mana0:0,energy0:8550,fast:0,ac:{cur:146550,bonus:0},resfire:{cur:15,bonus:0},resfrost:{cur:6,bonus:0},reslight:{cur:0,bonus:0},act:{cur:36,bonus:0},buffs:0},1944:{originalId:1944,name:"Girgur Moryn",lvl:300,prof:"p",gender:"m",npc:0,hpp:100,team:1,y:2,icon:"/noob/pm.gif",mana:0,energy:1500,mana0:0,energy0:1500,fast:0,ac:{cur:0,bonus:0,destroyed:1},resfire:{cur:0,bonus:0},resfrost:{cur:0,bonus:0},reslight:{cur:0,bonus:0},act:{cur:0,bonus:0},buffs:0},"-257037":{originalId:257037,name:"Barbatos Smoczy Stra�nik",lvl:285,prof:"w",gender:"x",npc:1,wt:100,hpp:100,team:2,y:3,icon:"tyt/hebrehoth_smokoludzie.gif",ac:{cur:10219,bonus:0},resfire:{cur:180,bonus:0},resfrost:{cur:60,bonus:0},reslight:{cur:180,bonus:0},act:{cur:40,bonus:0},buffs:0}},myteam:1,move:0,current:1897,turns_warriors:{1:1897,2:1603,3:1668,4:1897,5:1640,6:1897,7:1603,8:1668,9:1897,10:1021}}}}},ASD0:{state:!1,getJSON:function(){return{}}},ASD1:{state:!1,getJSON:function(){return{}}},MM_PREPARATION:{state:!1,getJSON:()=>({matchmaking_preparation:{selected_battle_set:1,time_left:15,rating:0,opponent_prof:"p",battle_sets:{0:{skill_set:3,items:[1060201168,500051534,1060247398,1060247397,1060309428,1060002113,0,0]},1:{skill_set:2,items:[0,0,0,0,0,0,0,0]},2:{skill_set:3,items:[0,0,0,0,0,0,0,0]}}}})},MM_SUMMARY:{state:!1,getJSON:()=>({match_summary:{shop_id:127912,small_reward_tpl:47331,big_reward_tpl:47337,huge_reward_tpl:51583,opponent_prof:"p",status:0,placement_cur:1,placement_max:10,rating:0,result:1,rating_delta:0,points_gained:1,difficulty_rank:5,daily_stage:{id:0,points_cur:1,points_max:6,points_step:3,rewards_last:0,rewards_cur:0,rewards_max:2}}})}},testJSONDataQueue=[];this.setStateTestJSONData=t=>{for(let e in testJSONData)if(e==t)return void(testJSONData[e].state=!0);errorReport("Communication.js","setStateTestJSONData","notExist "+t,testJSONData)};const manageTestJSONAData=t=>{for(let e in testJSONData)if(testJSONData[e].state){testJSONData[e].state=!1;let i=testJSONData[e].getJSON();for(let e in i)t[e]=i[e];if(testJSONData[e].queue){testJSONData[e].queue.list}}};this.parseJSON=function(t){for(var e in manageTestJSONAData(t),self.setFirstCallEv(t),t){var i="before_on_"+e;t.hasOwnProperty(e)&&"function"==typeof this.dispatcher[i]&&self.dispatcher[i](t[e],t)}for(var e in t)if("ev"!=e){i="on_"+e;t.hasOwnProperty(e)&&"function"==typeof this.dispatcher[i]&&self.dispatcher[i](t[e],t)}for(var e in t){i="after_on_"+e;t.hasOwnProperty(e)&&"function"==typeof this.dispatcher[i]&&self.dispatcher[i](t[e],t)}Engine.interface.heroElements.endLag()},this.setFirstCallEv=t=>{t.ev&&this.dispatcher.on_ev(t.ev)},this.dispatcher={on_town:function(t){Engine.map.updateDATA(t)},before_on_businessCards:function(t){Engine.businessCardManager.updateData(t)},after_on_raj:function(t){if(elementIsArray(t))for(let e in t)Engine.rajController.parseJSON(t[e]);else Engine.rajController.parseJSON(t)},on_theme:function(t){Engine.themeController.updateData(t,ThemeData.THEME_KIND.EVENT)},on_h:function(t,e){Engine.hero.updateDATA(t,e),API.callEvent(Engine.apiData.HERO_UPDATE,Engine.hero)},on_cl:function(t){Engine.map.setCollisions(t)},on_js_script:function(v){eval(v)},on_ev:function(t){Engine.setEv(t),Engine.reconnect.stop()},on_browser_token:function(t){Engine.browserToken=t},before_on_icons:function(t){Engine.npcIconManager.updateData(t)},before_on_npc_tpls:function(t){Engine.npcTplManager.updateData(t)},before_on_npcs_del:function(t){Engine.npcs.updateData_npcs_del(t),Engine.miniMapController.handHeldMiniMapController.getMiniMapNpcController().updateData_npcs_del(t)},after_on_timer:function(t){Engine.interfaceTimerManager.updateData(t)},on_npcs:function(t){Engine.npcs.updateData(t),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,2),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,2),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,4),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,5),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,5),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,20)},on_other:function(t){Engine.others.updateData(t)},on_emo:function(t){Engine.emotions.updateData(t)},on_pet:function(t,e){Engine.hero.updatePet(t,e)},on_f:function(t,e){Engine.skills&&Engine.skills.close(t),1==t.init&&Engine.battle.getShow()&&Engine.battle.close(t),Engine.battle.updateData(t,e)},on_d:function(t,e){-1!=t&&(Engine.dialogue||(Engine.dialogue=new Dialogue,Engine.dialogue.init()),Engine.dialogue.talk(t,e))},on_gw2:function(t,e){Engine.map.gateways.updateData(t,e.townname),Engine.miniMapController.updateWindowMiniMapGatewaysPos(e)},on_msg:function(t,e){for(var i in t)"ach"==e.msg[i].substr(0,3)?achMessage(e.msg[i]):message(e.msg[i])},on_message:function(t){for(let e=0;e<t.length;e++)Engine.codeMessageManager.updateData(t[e],CodeMessageData.SOURCE.MESSAGE)},on_item:function(t){Engine.items.updateDATA(t)},on_item_tpl:function(t){(new Date).getTime();Engine.tpls.updateDATA(t)},on_lag:function(t){$("#lagometer").html("Ping: "+Math.min(t,9999)+"ms")},on_alert:function(t,e){var i=!1;e.redirect&&(i=[{txt:"OK",callback:function(){return window.location.href="https://"+e.redirect,!0}}]),mAlert(parsePopupBB(t),i)},on_ask:function(t,e){isset(t.q)&&(t.q=parsePopupBB(t.q));var i=askAlert(t);API.callEvent(Engine.apiData.NEW_ASK,[t,i])},on_alert2:function(t,e){mAlert2(parsePopupBB(t))},on_logoff_time_left:function(t){Engine.logOff||(Engine.logOff=new LogOff,Engine.logOff.init()),Engine.logOff.update(t)},on_t:function(t,e){switch(t){case"stop":if(isset(e.wait_for)){let t=isset(e.wait_for_sec)?1e3*e.wait_for_sec:1e3;return message(e.wait_for,!0),setTimeout((function(){Engine.start(),Engine.reCallInitQueue()}),t),!1}log("Engine stopped.",3),reloadClient(),Engine.stop();break;case"reload":if(Engine.reload=!0,Engine.onClear(),Engine.map.setDrawable(!1),Engine.map.setOffsetIsSet(!1),Engine.map.setUnlock(!1),Engine.logOff)return Engine.stop(),void Engine.logOff.out();Engine.reCallInitQueue()}const i=Engine.windowsData.windowCloseConfig.RELOAD;Engine.windowCloseManager.callWindowCloseConfig(i)},on_w:function(t){warn(t)},on_e:function(t){"ok"!=t&&error(t)},on_chat:function(t){Engine.chatController.getChatDataUpdater().updateData(t)},on_battle_pass:function(t){Engine.battlePass||(Engine.battlePass=new BattlePass,Engine.battlePass.init()),Engine.battlePass.updateData(t)},on_loot:function(t,e){Engine.loots&&Engine.loots.wnd.isShow()&&t.init&&Engine.allInit&&Engine.loots.deleteItemsAndCloseLootWindow(),Loot.update(t,e),Engine.loots=Loot;var i=t.endTs;API.callEvent(Engine.apiData.LOOT_UPDATE,t),0===i&&delete Engine.loots},on_shop:function(t){var e=isPl()?436:"",i=t.id,n=i==e,a=190==i;Engine.chests&&Engine.chests.close(),n||a?(n&&!Engine.chests&&(Engine.chests=new Chests(t),Engine.chests.init()),a&&!Engine.promo&&(Engine.promo=new Promo(t))):(Engine.shop?(Engine.shop.close(),Engine.shop=new Shop,Engine.shop.init(t,!0)):(Engine.shop=new Shop,Engine.shop.init(t)),479==i&&Engine.shop.callSuperMarket())},on_choose_outfit:function(t){Engine.chooseOutfit&&Engine.chooseOutfit.close(),Engine.chooseOutfit=new ChooseOutfit,Engine.chooseOutfit.init(),Engine.chooseOutfit.update(t)},on_game:function(t){Loader.initGame(t)},after_on_mails:function(t){Engine.mails||(Engine.mails=new MailsManager,Engine.mails.init()),Engine.mails.updateData(t)},on_recovery:function(t){Engine.recoveryItems=new RecoveryItems,Engine.recoveryItems.init(),Engine.recoveryItems.update(t)},on_friends:function(t){const e=SocietyData.KIND.FRIEND;Engine.society||(Engine.society=new Society,Engine.society.init(),Engine.society.setVisible(e,!0)),Engine.society.updateData(t,e)},on_enemies:function(t){const e=SocietyData.KIND.ENEMY;Engine.society||(Engine.society=new Society,Engine.society.init(),Engine.society.setVisible(e,!0)),Engine.society.updateData(t,e)},on_party:function(t,e){Engine.party||(Engine.party=new Party(e),Engine.party.init(e)),Engine.party.update(e)},on_trade:function(t){Engine.trade||(Engine.trade=new Trade(t.init),Engine.trade.init()),Engine.trade.update(t)},on_wanted:function(t){Engine.wantedController||(Engine.wantedController=new WantedController.WantedController,Engine.wantedController.init()),Engine.wantedController.updateList(t)},on_dead:function(t){Engine.deadController.update(t)},on_codeprom:function(t){Engine.codeProm.initPrize(t)},on_registration:function(t){Engine.registration||(Engine.registration=new Registration,Engine.registration.init()),Engine.registration.update(t)},on_force_regcomplete:function(){Engine.interface.registrationCall()},on_rip:function(t){Engine.map.rip.updateData(t)},on_auctions:function(t){Engine.auctions||(Engine.auctions=new AuctionManager,Engine.auctions.init()),Engine.auctions.updateData(t),API.callEvent(Engine.apiData.AUCTIONS_UPDATE,t)},on_depo:function(t){Engine.depo||(Engine.depo=new Depo(!1),Engine.depo.init(),API.callEvent(Engine.apiData.DEPO_INIT)),Engine.depo.updateData(t),API.callEvent(Engine.apiData.DEPO_UPDATE)},on_clan_depo:function(t){Engine.depo||(Engine.depo=new Depo(!0),Engine.depo.init(),API.callEvent(Engine.apiData.CLAN_DEPO_INIT)),Engine.depo.updateData(t),API.callEvent(Engine.apiData.CLAN_DEPO_UPDATE)},on_clanmap:function(t){Engine.clan||(Engine.clan=new Clan,Engine.clan.init()),Engine.clan.updateClanList(t)},on_myclan:function(t,e){Engine.clan||(Engine.clan=new Clan,Engine.clan.init()),Engine.clan.update(t,e),Engine.clan.updateClasses(t)},on_clan:function(t){Engine.clan.updateOtherClan(t),Engine.clan.updateOtherClanOfficialPage(t)},on_members:function(t){Engine.clan||(Engine.clan=new Clan,Engine.clan.init()),Engine.clan.updateMembers(t)},on_clan_fr:function(t,e){Engine.clan||(Engine.clan=new Clan,Engine.clan.init()),Engine.clan.updateDiplomacy(t,"Friend"),isset(e.myclan)&&(Engine.clan.showChooseCard("clan","clan-diplomacy"),Engine.clan.setActiveTab("diplomacy"))},on_clan_en:function(t,e){Engine.clan||(Engine.clan=new Clan,Engine.clan.init()),Engine.clan.updateDiplomacy(t,"Enemy"),isset(e.myclan)&&(Engine.clan.showChooseCard("clan","clan-diplomacy"),Engine.clan.setActiveTab("diplomacy"))},on_clan_skills:function(t){Engine.clan.updateClanSkills(t)},on_clan_quests:function(t){Engine.clan.updateClanQuests(t)},on_clan_skills_blessing:function(t){Engine.clan.updateClanBless(t)},on_clan_applications:function(t){Engine.clan.updateRecruit({clan_applications:t})},on_clan_invitations:function(t){Engine.clan.updateRecruit({clan_invitations:t})},on_calendar:function(t){Engine.eventCalendar||(Engine.eventCalendar=new EventCalendar,Engine.eventCalendar.init()),Engine.eventCalendar.updateData(t)},on_book:function(t){Engine.book||(Engine.book=new Book,Engine.book.init()),Engine.book.updateData(t)},on_motel:function(t){Engine.motel||(Engine.motel=new Motel,Engine.motel.init()),Engine.motel.updateData(t)},on_world_time:function(t){Engine.worldTime=t},"on_conquer-stats":function(t){Engine.conquerStats||(Engine.conquerStats=new ConquerStats),Engine.conquerStats.init(t)},on_gold_pricelist:function(t){Engine.goldShop||(Engine.goldShop=new GoldShop,Engine.goldShop.init()),Engine.goldShop.update(t)},on_skill_list:function(t,e){Engine.skills||(Engine.skills=new Skills,Engine.skills.init()),Engine.skills.MBEditor&&Engine.skills.MBEditor.saveAndClose(),Engine.skills.update(t,e)},on_skills_learnt:function(t){Engine.skills||(Engine.skills=new Skills),Engine.skills.updateSkillsLearnt(t)},on_selectedskills:function(t){Engine.skills.updateSelectedSkills(t)},on_freeskills_ts:function(t){Engine.skills||(Engine.skills=new Skills),Engine.skills.updateFreeSkills(t)},on_battleskills:function(t){Engine.skills&&(Engine.skills.MBEditor||Engine.skills.initBattleEditor(),Engine.skills.MBEditor.updateEditor(t))},before_on_quests:function(t,e){let i={};for(let e in t)i[e]=t[e];i.track&&delete i.track,i.set_track&&delete i.set_track,Engine.questsManager||(Engine.questsManager=new QuestsManager),Engine.questsManager.update(i,e),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,5),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,5)},after_on_quests:function(t,e){let i=t.set_track,n=t.track;if(n&&getEngine().questsManager.update({update_data_track:n}),getEngine().isInitLoadTime())return i&&getEngine().questsManager.update({update_data_set_track:i}),void(getEngine().interface.getInterfaceStart()&&getEngine().quests.refreshTrackQuestButtons());i?getEngine().questsManager.update({set_track:i},e):n&&getEngine().questsManager.update({track:n},e)},on_config:function(t){Engine.serverStorage.updateData(t)},before_on_tutorial:function(t){Engine.tutorialValue=t,Engine.settings&&Engine.settings.setLabelOfTutorialBtn()},on_progressbar:function(t){Engine.map.questProgressBar.updateData(t)},on_artisanship:function(t,e){t.open?(isset(e.enhancement.usages_preview)&&(Engine.crafting.enhanceUsages=e.enhancement.usages_preview),Engine.crafting.open(t.open)):t.close&&Engine.crafting.close()},on_recipes:function(t){Engine.crafting.open("recipes",t)},on_enhancement:function(t){Engine.crafting&&Engine.crafting.enhancement&&Engine.crafting.enhancement.update(t)},on_extractor:function(t){Engine.crafting&&Engine.crafting.extraction&&Engine.crafting.extraction.update(t)},after_on_extractor:function(t){Engine.crafting&&Engine.crafting.extraction&&isset(t.completed)&&Engine.crafting.extraction.update(t)},on_salvager_preview:function(t){isset(Engine.crafting.salvage)&&Engine.crafting.salvage.update(t)},on_battle_summary:function(t,e){},on_n:function(t){log(t)},on_minimap:function(t){Engine.miniMapController.updateGlobalMap(t)},on_matchmaking_history:function(t){Engine.matchmaking.updateHistory(t)},on_matchmaking_statistics:function(t){Engine.matchmaking.updateStatistics(t)},on_matchmaking_ladder_global:function(t){Engine.matchmaking.updateRanking(t,".general-ranking-wnd","global")},on_matchmaking_ladder_clan:function(t){Engine.matchmaking.updateRanking(t,".clan-ranking-wnd","clan")},on_matchmaking_ladder_friends:function(t){Engine.matchmaking.updateRanking(t,".friends-ranking-wnd","friends")},on_matchmaking_state:function(t){Engine.matchmaking.setMatchmakingState(t)},on_matchmaking_confirmation:function(t){Engine.matchmaking.setMatchmakingConfirmation(t)},on_matchmaking_preparation:function(t){Engine.matchmaking.setPreparation(t)},on_matchmaking_statistics_detailed:function(t){Engine.matchmaking.updateStatisticsDetailed(t)},on_matchmaking_search:function(t){Engine.matchmaking.updateSearch(t)},on_match_profile:function(t){Engine.matchmaking.updateProgressPanel(t)},on_match_season:function(t){Engine.matchmaking.updateSeasonPanel(t)},on_matchmaking_season_rewards:function(t){Engine.matchmaking.matchmakingSeasonPosition(t)},on_match_summary:function(t){Engine.matchmaking.summary.setShow(!0),Engine.matchmaking.summary.updateSummary(t)},on_loot_preview:function(t){Engine.lootPreview&&Engine.lootPreview.close(),Engine.lootPreview=new LootPreview("lootbox"),Engine.lootPreview.init(),Engine.lootPreview.update(t)},on_recipe_preview:function(t){Engine.lootPreview&&Engine.lootPreview.close(),Engine.lootPreview=new LootPreview("recipe"),Engine.lootPreview.init(),Engine.lootPreview.update(t)},on_match_main:function(t){Engine.matchmaking.warningPoints(t.warnings_cur,t.warnings_max),Engine.matchmaking.matchesPoints(t.matches_cur,t.matches_min)},on_promotions:function(t){isPl()&&(Engine.news&&Engine.news.close(),Engine.news=new News,Engine.news.init(),Engine.news.update(t))},on_promotion_changed:function(t){if(isPl())return Engine.news?void Engine.news.updateChanged(t):console.warn("NOOOOO!")},on_notices:function(t){Engine.widgetNoticeManager.update(t)},on_choose_teleport:function(t){isset(t.location_data)?Engine.tpScroll.showLocation(t.location_data):(Engine.tpScroll&&Engine.tpScroll.close(),Engine.tpScroll=new TpScroll,Engine.tpScroll.init(),Engine.tpScroll.update(t))},on_rewards_calendar_active:function(t){Engine.rewardsCalendarActive=!0},on_battle_pass_active:function(t){Engine.battlePassActive=!0},on_rewards_calendar:function(t){Engine.rewardsCalendar||(Engine.rewardsCalendar=new RewardsCalendar,Engine.rewardsCalendar.init()),Engine.rewardsCalendar.update(t)},on_barter:function(t,e){Engine.barter||(Engine.barter=new Barter,Engine.barter.init()),Engine.barter.update(t,e)},on_captcha:function(t){Engine.captcha.updateData(t)},on_login:function(t,e){isset(e.promotions)||Engine.poll.init()},on_choose_bonus_selector:t=>{Engine.bonusSelectorWindow&&Engine.bonusSelectorWindow.close(),Engine.bonusSelectorWindow=new BonusSelectorWindow(t)},on_bonus_reselect:(t,e)=>{if(isset(t.show)&&(Engine.bonusReselectWindow||(Engine.bonusReselectWindow=new BonusReselectWindow)),isset(t.status)&&(Engine.bonusReselectWindow||(Engine.bonusReselectWindow=new BonusReselectWindow),Engine.bonusReselectWindow.update(t)),isset(t.select)){const e=!0,i={...t.select,fromReselect:e};Engine.bonusSelectorWindow&&Engine.bonusSelectorWindow.close(),Engine.bonusSelectorWindow=new BonusSelectorWindow(i)}},on_worldConfig:t=>{Engine.worldConfig.update(t),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,53),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,53),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,1),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,1),1==Engine.worldConfig.getPrivWorld()&&Engine.globalAddons.setVisibleOfTurnOnOffAddonButton(!0)},on_play:t=>{isset(t.path)&&Engine.soundManager.createTmpSound(t.path),isset(t.stop)&&Engine.soundManager.finishPlayingTmpSound()},on_huntingStatistics:t=>{Engine.worldWindow.huntingStatistics&&Engine.worldWindow.huntingStatistics.update(t)},on_handheld_minimap:t=>{isset(t.hero_localizations)&&t.hero_localizations.length>0&&Engine.heroesRespManager.updateData(t.hero_localizations)}}}},function(t,e,i){var n=i(0),a=i(18),s=i(13),r=i(223),o=i(45);let l=i(1),c=i(105),d=i(70);const{nickUppercase:h}=i(45);t.exports=function(){var t,e=this,i=!1,u="",p=[],g=null,f=!1;let m=null;var v=0;let E,_,b=!1,w=0,C={};var T={id:0,soundId:0,rewardsExist:!1};let y=null;const I=(t,e,i)=>{y=t!=l.HERO?{kind:t,x:e,y:i}:{kind:t,x:null,y:null}};this.init=function(){e.$=n.get("dialogue-window");var t=whichTransitionEvent();t&&e.$[0].addEventListener(t,(function(){$(".scroll-wrapper",e.$).trigger("update").trigger("scrollTop"),!0}),!1),Engine.interfaceItems.setDisableSlots("dialogue"),Engine.items.fetch(Engine.itemsFetchData.NEW_QUEST_REWARD_ITEM,e.newQuestRewardItem),I(l.HERO),A(),k()};const A=()=>{E=new c,E.init(this,r.DIALOGUE_WINDOW,e.$),E.setManageOpacity(4)},k=()=>{_=new d,_.init(null,r.DIALOGUE_WINDOW,e.$,e.$.find(".scroll-wrapper"),[{h:55},{h:125},{h:225},{h:300}],S)};this.checkIfBubbleExist=()=>isset(Engine.dialogue)&&e.$.length>0&&e.$.hasClass("bubbledialog"),this.talk=function(t,n){if(e.checkIfBubbleExist())e.finish();else{Engine.lock.add("npcdialog"),e.clearTalkEmo(),i=!T.id;var a=null;u="",p=[];var s=0;if(4===parseInt(t[0])){if(!T.id)return void e.endTalk()}else this.closeOtherWindows();for(var r=0;r<t.length;r+=3){if(t[r]=parseInt(t[r]),g=null,"break"==(a=e.updateTalkProperties(t[r],t[r+1],t[r+2])))return;"continue"!=a&&(t[r+1]=e.fillNick(t[r+1]),t[r+1]=e.fillNickUppercase(t[r+1]),t[r+1]=e.fillSex(t[r+1]),t[r+1]=e.centerOnInterlocutor(t[r+1],n),t[r+1]=e.testBoxoff(t[r+1]),t[r+1]=e.testTown(t[r+1]),t[r+1]=e.testReward(t[r+1]),t[r+1]=e.testPlay(t[r+1]),t[r+1]=e.testShop(t[r+1]),t[r+1]=e.testSubStr(t[r+1]),t[r+1]=e.testSakwa(t[r+1]),t[r+1]=e.testImg(t[r+1]),e.checkNpcTalk(t[r],t[r+1],t[r+2]),e.checkPlayerOptions(t[r],t[r+1],t[r+2],g,s),s++)}f=!1,i?e.useBubbleDialog():e.useNormalDialog()}},this.useBubbleDialog=function(){switch(T.id){case r.PLAYER:T.npc=Engine.npcs.getById(T.id);break;case r.PET:Engine.hero.havePet()&&(T.npc=Engine.hero.getPet());break;default:Engine.npcs.checkNpc(T.id)&&(T.npc=Engine.npcs.getById(T.id))}T.npc&&T.npc.d.y>=5?e.createBubbleDialog():(i=!1,e.useNormalDialog())},this.setEmo=t=>{switch(t){case r.PLAYER:Engine.emotions.updateData([{name:s.NAME.NPC_TALK,source_id:Engine.hero.d.id,source_type:s.OBJECT_TYPE.HERO}]);break;case r.PET:return;default:Engine.npcs.checkNpc(T.id)&&Engine.emotions.updateData([{name:s.NAME.NPC_TALK,source_id:T.id,source_type:s.OBJECT_TYPE.NPC}])}},this.clearTalkEmo=()=>{Engine.emotions.deleteEmoByType(s.NAME.NPC_TALK)},this.useNormalDialog=function(){Engine.interface.getBottomPositioner().append(e.$),e.createNormalDialog(),e.setEmo(T.id),$(".scroll-wrapper .scrollbar-wrapper",e.$).length||$(".scroll-wrapper",e.$).addScrollBar({track:!0})},this.getBubble=function(){return i},this.checkNpcTalk=function(t,e,a){if(1&t){var s=_t("end_talk1",null,"talk"),r=n.get("dialogue-window-answer"),o=r.find(".icon"),l=r.find(".answer-text");4!=T.type&&5!=T.type||(s=_t("end_talk2",null,"talk")),T.bubbleEndLineCommand="talk&id="+T.id+"&c="+a,T.bubbleEndLineTxt=s,T.bubbleTxt=e,u=e,4&t?(r.addClass("line_exit"),o.addClass("line_exit"),l.text(s),p.push(r)):a&&(o.addClass("line_option"),l.text(_t("dialog_next",null,"talk")),i=!1,p.push(r)),r.on("click",(function(){return new function(){_g("talk&id="+T.id+"&c="+a,(function(t){}))}})),e.length>180&&(i=!1)}},this.checkPlayerOptions=function(t,a,s,r,o){if(2&t){var l=e.getLineClass(t),c=n.get("dialogue-window-answer");c.addClass(l);var d=c.find(".icon"),h=c.find(".answer-text"),u=o<10?o+". ":"";!(++v>1)&&4&t||(i=!1),T.bubbleEndLineCommand="talk&id="+T.id+"&c="+s,T.bubbleEndLineTxt=a,d.addClass(l),h.html(u+parseContentBB(a)),c.click((function(){e.clickLineDialog(T,s,r)})),p.push(c)}},this.clickLineDialog=function(t,e,i){_g("talk&id="+t.id+"&c="+e,(function(t){Engine.interface.checkTeleport(t)})),"gold"==i?Engine.goldShop||_g("creditshop&credits_gold=-1"):"sl"==i&&(Engine.draconiteShop||(Engine.draconiteShop=new a,Engine.draconiteShop.open()))},this.hotKeyLine=function(t){var i=e.$.find(".answers").children().eq(parseInt(t)-1);0!=i.length&&i.click()},this.getLineClass=function(t){for(var e={2:"line_option",4:"line_exit",8:"line_new_quest",16:"line_cont_quest",32:"line_shop",64:"line_attack",128:"line_game",256:"line_heal",512:"line_option",1024:"line_option",2048:"line_motel",4096:"line_auction",8192:"line_mail",16384:"line_depo",32768:"line_option",65536:"line_barter",131072:"line_bonus_reselect"},i=131072;i>1;){if(t&i)return e[i];i>>=1}return null},this.updateTalkProperties=function(t,i,n){return t?4==t?(e.endTalk(),"break"):void 0:(T.name=i,T.id=n,e.setTutorial(T.id,1),T.type=1,T.dialogCloud=n,T.rewardsExist=!1,"continue")},this.fillNick=function(t){return t.split("~").join(",").split("[NICK]").join(Engine.hero.d.nick)},this.fillNickUppercase=function(t){return h(t)},this.fillSex=function(t){return o.sexModify(t)},this.centerOnPlayer=function(t){let e=Engine.hero.d.x,i=Engine.hero.d.y;isset(t.h)&&isset(t.h.x)&&isset(t.h.y)&&(e=t.h.x,i=t.h.y),Engine.map.centerOn(e,i),I(l.HERO),T.npc=Engine.hero,T.name=Engine.hero.nick,T.dialogCloud=Engine.hero.d.id,T.id=r.PLAYER},this.centerOnPet=function(t){let e=Engine.hero.pet.d.x,i=Engine.hero.pet.d.y;isset(t.h)&&isset(t.h.x)&&isset(t.h.y)&&(e=t.h.x,i=t.h.y),Engine.map.centerOn(e,i),I(l.PET,e,i),T.npc=Engine.hero.pet,T.name=Engine.hero.pet.d.name,T.dialogCloud=Engine.hero.pet.d.id,T.id=r.PET},this.centerOnNpc=function(t){t=t==r.THIS?T.id:t;var e=Engine.npcs.getById(t);e&&(Engine.map.centerOn(e.d.x,e.d.y),I(l.NPC,e.d.x,e.d.y),T.npc=e,T.name=e.d.nick,T.id=t),T.dialogCloud=t},this.centerOnInterlocutor=function(t,i){let n=new RegExp("#([0-9]+|"+r.THIS+"|"+r.PLAYER+"|"+r.PET+")#");if(n.test(t)){let a=n.exec(t)[1];switch(a){case r.PLAYER:e.centerOnPlayer(i);break;case r.PET:if(!Engine.hero.havePet())return t.replace(n,"");e.centerOnPet(i);break;default:e.centerOnNpc(a)}return b=!0,t.replace(n,"")}return t},this.updateBubblePos=function(){if(!i||!T.npc)return;const t=Engine.interface.get$GAME_CANVAS(),n=Engine.interface.get$interfaceLayer().offset();let a={left:32*(T.npc.d.x-Math.round(Engine.map.offset[0])/32)-n.left+t.offset().left/Engine.zoomFactor,top:32*(T.npc.d.y-Math.floor(Engine.map.offset[1]/32))-n.top+t.offset().top/Engine.zoomFactor,"margin-left":16-e.$.width(),"margin-top":-(e.$.height()+T.npc.fh-16)};a.left<e.$.width()+t.offset().left?(e.$.find(".bg-layer").addClass("left"),a["margin-left"]=16):e.$.find(".bg-layer").removeClass("left"),a.left+="px",a.top+="px",a["margin-left"]+="px",a["margin-top"]+="px",w.left===a.left&&w.top===a.top||(w=a,e.$.css(a))},this.updateDialogAfterChangeNpc=function(t){T.id===t.d.id&&i&&(f?e.updateBubblePos():e.useBubbleDialog())},this.createNormalDialog=function(){let e=T.name.split("[br]")[0];const i=T.rewardsExist?u:parseContentBB(u);t=!0,f=!0,O(e),this.$.find(".content .npc-message").html(i),this.$.find(".content .answers").html(p),this.manageDialogHeaderText(),this.$.addClass("is-open"),this.setSizeAndPosOfNormalDialog(),$(".scroll-wrapper",this.$).trigger("update").trigger("scrollTop")};const S=()=>{$(".scroll-wrapper",this.$).trigger("update")},O=t=>{m=t},M=t=>{this.$.find(".h_content").html(parseBasicBB(t))};this.manageDialogHeaderText=()=>{let t=Engine.rajDialogue.getDialogName();M(t||m)},this.newQuestRewardItem=function(t){C[t.id]=t,e.createAndAppendQuestRewardItem(t),t.on("afterUpdate",(function(){e.createAndAppendQuestRewardItem(t,!0)}))},this.createAndAppendQuestRewardItem=function(t,i){var n=e.$.find("#rew-item"+t.id);if(!i||n.length){var a=Engine.items.createViewIcon(t.id,Engine.itemsViewData.DIALOGUE_ITEM_VIEW)[0];n.append(a)}},this.createBubbleDialog=function(){e.$=n.get("bubbledialog"),f=!0,Engine.interface.get$interfaceLayer().append(e.$);var t=n.get("bubbledialog-answer");t.addClass("endtalk2").html("1. "+parseContentBB(T.bubbleEndLineTxt)),t.on("click",(function(){return new function(){_g(T.bubbleEndLineCommand,(function(t){}))}})),e.$.find(".message").html(parseContentBB(T.bubbleTxt)),e.$.find(".answers").html(t),this.updateBubblePos()},this.checkIsBubbleCloud=function(){return!!i&&(_g(T.bubbleEndLineCommand,(function(t){})),!0)},this.testSakwa=function(t){return/<sakwa>/.test(t)?t.replace(/<sakwa>/,""):t},this.testBoxoff=function(t){return/#BOXOFF#/.test(t)?(i=!1,t.replace(/#BOXOFF#/,"")):t},this.testTown=function(t){return/#TOWN#/i.test(t)?(T.name=Engine.map.d.name,t.replace(/#TOWN#/i,"")):t},this.testImg=function(t){return/<img src=/.test(t)?t.replace(/<img src=/,"<img onload=setTimeoutScroll() src="):t},this.testReward=function(t){if(/#REWARD/.test(t)){T.rewardsExist=!0;for(var e=n.get("dialogue-window-rewards"),i=t.split("#REWARD").splice(1),a={},s=null,r=null,o=0;o<i.length;o++)for(var l=i[o].split(","),c=0;c<l.length;c++){var d=l[c].split(":");if("prof"==d[0]){var h=d[1].split(" ");r={};for(var u=0;u<h.length;u++)r[(s=h[u].replace(" ","").split("->"))[1]]=s[0]}else s=d[0].split("."),isset(a[s[1]])||(a[s[1]]=[]),"item"==s[0]?("object"!=typeof a[s[1]][s[0]]&&(a[s[1]][s[0]]=[]),a[s[1]][s[0]].push(d[1].replace(" ",""))):a[s[1]][s[0]]=d[1].replace(" ","")}var p=this.drawRewards(r,a);return e.find(".rewards-header").html(_t("reward_header",null,"talk")),e.find(".rewards-items").html(p),t.replace(/#REWARD.*/,e.prop("outerHTML"))}return t},this.drawRewards=function(t,e){var i=[];for(var a in e){var s=e[a],r=n.get("dialogue-window-reward-line");if(r.addClass(null!==t&&t[a].search(Engine.hero.d.prof)>=0||null===t?" mine":""),isset(s.item)){for(var o=[],l=0;l<s.item.length;l++){var c=n.get("dialogue-window-reward-item");c.addClass("rew_item_"+s.item[l]),c.find(".rew-item-slot").attr("id","rew-item"+s.item[l]),o.push(c)}r.append(this.addRewardElement("rew_item",o))}isset(s.gold)&&r.append(this.addRewardElement("rew_gold",s.gold)),isset(s.exp)&&r.append(this.addRewardElement("rew_exp",s.exp)),isset(s.ph)&&r.append(this.addRewardElement("rew_ph",s.ph)),i.push(r)}return i},this.addRewardElement=function(t,e){var i=n.get("dialogue-window-reward-el");return i.addClass(t),i.find(".label").html(_t(t,null,"talk")),i.append(e),i},this.testPlay=function(t){if(/#PLAY\(.*?\)/.test(t)){var e=/#PLAY\((.*?)\)/.exec(t)[1],i=soundManager.createSound({id:"dialogSound"+T.soundId++,url:e,autoPlay:!0,onfinish:function(){i.destruct()}});return t.replace(/#PLAY\((.*?)\)/,"")}return t},this.testShop=function(t){return/#SHOP\(.*?\)#/.test(t)?(g=/#SHOP\((.*?)\)#/.exec(t)[1],t.replace(/#SHOP\(.*?\)#/,"")):t},this.testSubStr=function(t){return"_"==t.substr(0,1)?t.substr(1):t},this.setTutorial=function(t,e){for(var i=[23085,21933,22310,21952,22172,17176],n=0;n<i.length;n++)if(i[n]==t)return},this.setSizeAndPosOfNormalDialog=()=>{this.getCssSize()},this.onResize=()=>{b=!0,t&&this.setSizeAndPosOfNormalDialog()},this.getCssSize=()=>{let t=Engine.interface.get$interfaceLayer().width(),e=null,i=null,n=null;return t>1600?(e=850,i=400,n="1.5em"):t>1400?(e=850,i=350,n="1.5em;"):t>1200?(e=700,i=350,n="1.2em"):(e=600,i=300,n="1.0em"),{width:e,height:i,fontSize:n}},this.getCssPosition=t=>{let e=Engine.interface.checkEqColumnIsShow(),i=Engine.interface.centerObjectCoverEqColumn(t),n=this.$.hasClass("is-open")?0:100,a=getEngine().ResolutionData.KEY._DEFAULT,s=getEngine().resolution.getResolutionKey();return e&&s==a&&i?{transform:"translate(0%, "+n+"%)",left:Engine.interface.getXPosOfObjectStickToEqColumn(t)}:{transform:"translate(-50%, "+n+"%)",left:"50%"}},this.endTalk=function(){this.finish(),T.id=0,T.soundId=0,Engine.lock.remove("npcdialog"),delete T.block},this.finish=function(){this.setTutorial(T.id,2),t&&(this.$.removeClass("is-open"),this.setSizeAndPosOfNormalDialog()),i=!1,Engine.items.removeCallback(Engine.itemsFetchData.NEW_QUEST_REWARD_ITEM),e.itemsClear(),T.npc={},Engine.lock.remove("npcdialog"),e.clearTalkEmo(),e.dialogRemove()},this.update=()=>{i&&(this.updateBubblePos(),b=!1)},this.dialogRemove=()=>{e.$.remove(),Engine.interfaceItems.setEnableSlots("dialogue"),Engine.dialogue=!1},this.itemsClear=()=>{for(let t in C)Engine.items.deleteItem(t),delete C[t];C={}},this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.DIALOGUE;Engine.windowCloseManager.callWindowCloseConfig(t)},this.getDialogueCenterPos=()=>y.kind==l.HERO?{x:Engine.hero.d.x,y:Engine.hero.d.y}:{x:y.x,y:y.y}}},function(t,e){t.exports={THIS:"this",PLAYER:"player",PET:"pet",TOWN:"town",DIALOGUE_WINDOW:"DIALOGUE_WINDOW"}},function(t,e,i){var n=i(0),a=i(18),s=i(7),r=i(225);let o=i(28),l=i(12);var c=i(8),d=i(227);t.exports=function(){var t=this,e=null;this.ctx=null,this.purchase=null,this.shopType=0,this.premiumShop=!1,this.goods;var i={};let h=null;var u={},p=0,g=null;let f=!1;var m=0,v=0,E={0:null,2:null,4:null};const _=[];var b={appendTo:"body",helper:"clone",distance:10,cursorAt:{top:16,left:16},scroll:!1,zIndex:20,start:function(e,i){0,startTs=t.getTs(),changeViewOfHelper(i.helper,$(this).data().item.id,"n"),t.saveOldXAndY(e.offsetX,e.offsetY),$(this).fadeTo(200,.5);var n=i.helper;n.css("background","none"),n.find(".highlight").css("background","none")},stop:function(t,e){$(this).fadeTo(200,1),startTs=null},drag:function(e){Math.abs(m-e.offsetX)+Math.abs(v-e.offsetY),t.saveOldXAndY(e.offsetX,e.offsetY)}};const w=()=>{h={}};this.getTs=function(){return(new Date).getTime()},this.getData=function(){return e},this.slotPos={0:[8,77],2:[67,77],4:[119,77]},this.saveOldXAndY=function(t,e){m=t,v=e},this.initGoods=()=>{this.goods={usual:{state:!0,gr:1},unique:{state:!1,gr:1},heroic:{state:!1,gr:1},upgraded:{state:!1,gr:1},legendary:{state:!1,gr:1},nosoulbound:{state:!0,gr:2},soulbound:{state:!0,gr:2},permbound:{state:!0,gr:2},neutral:{state:!0,gr:3},usable:{state:!1,gr:3},rkey:{state:!1,gr:3},talisman:{state:!1,gr:3},books:{state:!1,gr:3},bag:{state:!1,gr:3},quest:{state:!0,gr:3},teleports:{state:!1,gr:3}}},this.init=function(i,n){this.closeOtherWindows();var a="sl"==(e=i).cur?"sl":"zl";"sl"==a&&(t.premiumShop=!0),t.initWindow(),w(),t.initGoods(),t.createCloseAndAcceptBtns(),t.createShowItemsFilterCheckboxs(),this.basket=new r(e),Engine.tpls.fetch(Engine.itemsFetchData.NEW_SHOP_TPL,t.newShopItems),t.prepareDescription(i),t.initGreatMerchamp(),t.wnd.$.find(".shop-content").removeClass("normal-shop-zl normal-shop-sl pet-shop-zl pet-shop-sl"),t.wnd.$.find(".shop-content").addClass("normal-shop-"+a),t.createBottomPanel(),Engine.lock.add("shop"),t.wnd.$.find(".SHOP_CANVAS").attr("width","165px"),t.wnd.$.find(".SHOP_CANVAS").attr("height","115px"),t.initClickCanvas(),t.initDroppable(),C(),Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.SHOP),Engine.interfaceItems.setDisableSlots("shop")},this.getC_slots=function(){return E},this.createBottomPanel=function(){var i=n.get("button").addClass("small purple"),s="sl"==e.cur?"sl":"zl";i.find(".label").text(_t("buy_"+s+"_btn",null,"shop")),i.click((function(t){if(t.stopPropagation(),"sl"==e.cur){if(Engine.draconiteShop)return;Engine.draconiteShop=new a,Engine.draconiteShop.open()}else Engine.goldShop||_g("creditshop&credits_gold=-1")}));var r=n.get("button").addClass("small purple");r.find(".label").text(_t("recover_items",null,"shop")),r.click((function(){Engine.recoveryItems||_g("recovery")})),t.wnd.$.find(".buy-currency").append(i),t.wnd.$.find(".recover-items").append(r);var o=_t("buy_"+s+"_label",null,"shop");t.wnd.$.find(".currency-label").html(o),t.wnd.$.find(".chest").addClass(s)},this.createShowItemsFilterCheckboxs=function(){if(!e.canFilter)return t.wnd.$.find(".filters-heading").css("display","none"),void t.wnd.$.find(".show-items-filter").css("display","none");var i;Engine.shopFilters&&(i=Engine.shopFilters,Engine.shopFilters=null),i&&(t.setStateCheckboxFormStr(i,0,".can-afford"),t.setStateCheckboxFormStr(i,1,".own-level"),t.setStateCheckboxFormStr(i,2,".own-profession")),t.wnd.$.find(".checkbox").click((function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),t.sendOptions()}))},this.setStateCheckboxFormStr=function(e,i,n){"1"==e[i]&&t.wnd.$.find(n).addClass("active")},this.getStateCheckbox=function(e){return t.wnd.$.find(e).hasClass("active")?"1":"0"},this.sendOptions=function(){var i="";i+=t.getStateCheckbox(".can-afford"),i+=t.getStateCheckbox(".own-level"),i+=t.getStateCheckbox(".own-profession"),Engine.shopFilters=i,_g((e.canAccess>0?"creditshop":"shop")+"&npc="+e.id+"&filters="+parseInt(i,2))},this.getPurchase=()=>t.purchase,this.getPremiumShop=()=>t.premiumShop,this.isOnlyBuyShop=()=>""==t.purchase,this.prepareDescription=function(e){t.purchase=e.purchase;var i="";if("ph"==e.cur)i=_t("sell_for_ph")+"<br>";else if("sl"==e.cur)i=_t("sell_for_sl")+"<br>",$("#sl_shop_banner").css("display","block");else if("zl"==e.cur)t.wnd.$.find(".great-merchamp").css("display","block"),t.wnd.$.find(".quick-sell-heading, .bag-heading").css("display","block"),$("#gold_shop_banner").css("display","block"),i="<b>"+_t("sell_prices")+"</b>: ",e.sellp<150?i+=_t("sell_price_cheap"):e.sellp>299?i+=_t("sell_price_vExpensive"):e.sellp>199?i+=_t("sell_price_expensive"):i+=_t("sell_price_normal"),""!=e.purchase?i+=" | <b>"+_t("rebuy_price")+"</b> "+e.buyp+"%<br><b>"+_t("max_per_item")+"</b> "+formNumberToNumbersGroup(e.maxbuyp)+"<br />":i+="<br>";else{var a=e.cur.split("|"),s=n.get("si-currency");s.find(".si-currency__label b").text(_t("selling_for_info")),s.find(".si-currency__icon").css("background-image",`url(${CFG.a_ipath+a[1]})`),s.find(".si-currency__desc").text(a[0]),i=s.prop("outerHTML")}if(i+="<b>"+_t("shopper_buys")+"</b> ","*"==e.purchase)i+=_t("buys_all");else if(""==e.purchase)i+=_t("buys_nothing");else{var r=e.purchase.split(",");for(var o in r)r[o]=MargoTipsParser.getEq().classes[parseInt(r[o])];i+=r.join(", ")}$(".shop-info-wrapper",t.wnd.$).html(i)},this.initClickCanvas=function(){t.wnd.$.find(".SHOP_CANVAS").on("click",(function(e){var i=t.getCollisionAtEvent(e);i&&i.onClick&&i.onClick(e)}))},this.initWindow=function(){Engine.windowManager.add({content:n.get("shop-wrapper"),nameWindow:Engine.windowsData.name.SHOP_WRAPPER,nameRefInParent:"wnd",objParent:this,title:_t("shop_head",null,"shop"),onclose:()=>{t.hide()}}),this.wnd.addToAlertLayer(),this.wnd.center()},this.createCloseAndAcceptBtns=function(){var e=n.get("button").addClass("green small");e.find(".label").text(_t("shop_accept",null,"shop")),e.click((function(){t.basket.preFinalize()})),$(".finalize-button",t.wnd.$).append(e)},this.setLabel=function(){var e=_t(0==t.shopType?"selling_items":"preview",null,"shop");t.wnd.$.find(".sell-items>.label").html(e)},this.initGreatMerchamp=function(){var e=t.wnd.$.find(".great-merchamp"),i=n.get("button").addClass("green small btn-num"),a=$('<div class="add-bck config" />');i.append(a),i.tip(_t("config_tip",null,"buttons")),i.click((function(t){t.stopPropagation(),Engine.greatMerchamp?Engine.greatMerchamp.close():(Engine.greatMerchamp=new d,Engine.greatMerchamp.init())}));for(var s=0;s<3;s++){var r=n.get("button").addClass("green small btn-num");r.find(".label").html(s+1),e.append(r),r.tip(_t("great_merchamp_info %val%",{"%val%":s+1},"shop")),r.click((function(){var e=$(this).index();Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,29),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,29),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,30),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,30),t.greatMerchant(e)}))}e.append(i)},this.greatMerchant=function(e){var i=t.prepareNoSell(),n=6*e,a=n+6,s=Engine.heroEquipment.getHItems();for(var r in s){var l=s[r];if(o.isGoldCl(l.cl)||o.isQuestCl(l.cl)||o.isBlessCl(l.cl)||o.isUpgradeCl(l.cl)||o.isRecipeCl(l.cl))continue;if(t.checkGoodBag(l,n,a))continue;let e=l.parseStats();t.checkUsual(l,i)||(t.checkUsable(l,i)||t.checkCoinage(l,i)||t.checkTalisman(l,i)||t.checkBooks(l,i)||t.checkNeutral(l,i)||t.checkTeleports(l,i)||t.checkNosoulbound(l,i,e)||t.checkSoulbound(l,i,e)||t.checkPermbound(l,i,e)||this.findVal(l,i,e))}},this.prepareNoSell=function(){var t=[];let e=Engine.serverStorage.get(s.GREAT_MERCHAMP);if(e)for(let i in this.goods)isset(e[i])&&e[i]||t.push(i);else for(let e in this.goods)this.goods[e].state||t.push(e);return t},this.checkGoodBag=function(t,e,i){return!l.isInBagSt(t.st)||!(t.y>=e&&t.y<i)},this.checkMixture=function(t,e){var i=e.indexOf("mixture")>-1,n=t.name.toLowerCase();if(isPl()){var a=n.indexOf("mikstura")>-1,s=n.indexOf("preparat")>-1,r=n.indexOf("eliksir")>-1,o=n.indexOf("panaceum")>-1,l=n.indexOf("remedium")>-1,c=n.indexOf("preparat")>-1,d=n.indexOf("bukłak")>-1,h=n.indexOf("butelka")>-1;return i&&(a||s||r||o||l||c||d||h)}a=n.indexOf("potion")>-1,s=n.indexOf("mixture")>-1,r=n.indexOf("elixir")>-1,o=n.indexOf("syrup")>-1,l=n.indexOf("panacea")>-1,c=n.indexOf("remedy")>-1,d=n.indexOf("cure-all")>-1,h=n.indexOf("drink")>-1;var u=n.indexOf("bottle")>-1;return i&&(a||s||r||o||l||c||d||h||u)},this.checkUsual=function(t,e){let i=e.indexOf("usual")>-1,n="unique"===t.itemTypeName,a="heroic"===t.itemTypeName,s="upgraded"===t.itemTypeName,r="legendary"===t.itemTypeName,o="artefact"===t.itemTypeName;return i&&!n&&!a&&!s&&!r&&!o},this.checkUsable=function(t,e){var i=16==t.cl,n=e.indexOf("usable")>-1;return i&&n},this.checkCoinage=function(t,e){return 28==t.cl},this.checkTalisman=function(t,e){var i=22==t.cl,n=e.indexOf("talisman")>-1;return i&&n},this.checkBooks=function(t,e){var i=23==t.cl,n=e.indexOf("books")>-1;return i&&n},this.checkTeleports=function(t,e){var i=32==t.cl,n=e.indexOf("teleports")>-1;return i&&n},this.checkNeutral=function(t,e){var i=15==t.cl,n=e.indexOf("neutral")>-1;return i&&n},this.checkNosoulbound=function(t,e,i){var n=isset(i.soulbound)||isset(i.permbound),a=e.indexOf("nosoulbound")>-1;return!n&&a},this.checkSoulbound=function(t,e,i){var n=isset(i.soulbound),a=e.indexOf("soulbound")>-1;return n&&a},this.checkPermbound=function(t,e,i){var n=isset(i.permbound),a=e.indexOf("permbound")>-1;return n&&a},this.findVal=function(e,i,n){for(let t=0;t<i.length;t++){let a=i[t];if("soulbound"!=a&&"nosoulbound"!=a&&"permbound"!=a&&(isset(n[a])||e.isItemType(a)&&e.itemTypeName===a))return}t.basket.sellItem(e,!0)},this.hoverToItemInEq=function(t,e){t.hover((function(){e.$.addClass("addHoverFromBottomItem")}),(function(){e.$.removeClass("addHoverFromBottomItem")}))},this.setShopType=function(){0==t.shopType&&(t.wnd.$.find(".shop-content").addClass("pet-shop-"+("sl"==e.cur?"sl":"zl")),t.ctx=t.wnd.$.find(".SHOP_CANVAS")[0].getContext("2d"),t.shopType=1)},this.getCollisionAtEvent=function(t){var e,i=t.offsetX,n=t.offsetY-32;for(var a in E)if(E[a]&&E[a].collider&&i>(e=E[a].collider.box)[0]&&n>e[1]&&i<e[2]&&n<e[3])return E[a];return null},this.newSuperMargetItems=function(e,i,n){var a=Math.floor(n/3),s=n-3*a,r=Engine.tpls.createViewIcon(i.id,Engine.itemsViewData.FOR_YOU_ITEM_VIEW,Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_CHEST.loc)[0];r.css({left:15+50*s+s,top:22+37*a+a}).appendTo(e),r.click((function(e){t.basket.buyItem(i)}))},this.setSuperMarketHeader=function(){t.wnd.$.find(".for-you-plug").css("display","block"),t.wnd.$.find(".for-you-txt").css("display","block"),t.wnd.$.find(".filters-heading").css("display","none"),t.wnd.$.find(".show-items-filter").css("display","none"),t.wnd.$.find(".great-merchamp").css("display","none"),t.wnd.$.find(".quick-sell-heading, .bag-heading").css("display","none")},this.setSuperMarketWarrning=function(){t.wnd.$.find(".for-you-plug-disabled").css("display","block")},this.callSuperMarket=function(){t.setSuperMarketHeader(),$.ajax({url:"https://www.margonem.pl/ajax/shopapi.php?tids=&prof="+Engine.hero.d.prof+"&lvl="+Engine.hero.d.lvl,type:"POST",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){if(e.alsoBuyList,e.hotList,e.suggestedList)for(var n=0,a=t.wnd.$.find(".sell-items"),s=e.suggestedList,r=0;r<s.length;r++){var o=s[r];if(isset(i[o])){if(n>8)return;var l=i[o];t.newSuperMargetItems(a,l,n),n++}}},error:function(){t.setSuperMarketWarrning()}})},this.newShopItems=(t,i)=>{_[t.id]=t,i&&(this.createOffers(e.items_offers),this.addItemsToCompare(),T(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,17),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,17),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,29),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,29),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,31))},this.createOffers=t=>{t.map(t=>this.createSingleOffer(t))};const C=()=>{this.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})},T=()=>{$(".scroll-wrapper",this.wnd.$).trigger("update")};this.createSingleOffer=function(n){const a=t.wnd.$.find(".scroll-pane"),s=_[n.tplId];s.offerId=n.id,s.quantity=n.quantity,s.pr=n.price,s.x=n.x,s.y=n.y,s.prc=e.cur;const r=Engine.tpls.createViewIcon(s.id,Engine.itemsViewData.ITEM_TO_BUY_VIEW,Engine.itemsFetchData.NEW_SHOP_TPL.loc)[0];if(s.setTip(r),isset(s._cachedStats.amount)&&Engine.tpls.changeItemAmount(s,r,n.quantity),u[s.id]=s,((t,e)=>{h[t.name]={item:t,highlight:e}})(s,r.find(".highlight")),479==e.id){if(i[s.id]=s,!t.isSuperMarketItem(s.cl))return;t.modifyCounterIfChangeItemCl(s);var l=Math.floor(p/8),c=p-8*l;r.css({left:32*c+c,top:32*l+l}).appendTo(a),p++}else r.css({left:32*s.x+s.x,top:32*s.y+s.y}).appendTo(a);if(r.attr("data-item-type",s.itemType),r.click((function(e){e.stopPropagation(),t.basket.buyItem(s)})),r.contextmenu((function(t,e){s.createOptionMenu(getE(t,e))})),r.draggable(b),r.addClass("shop-item"),o.isShowPreviewItemInShop(s.cl)&&!f){t.setShopType();let e=$("<div>").addClass("info-icon shop-info-icon");f=!0,o.isOutfitCl(s.cl)&&e.tip(_t("action_info_outfit")),o.isPetCl(s.cl)&&e.tip(_t("action_info",null,"pet")),t.wnd.$.find(".shop-content").append(e)}t.setLabel()},this.buySeriallyItem=function(e,i){for(var n=0;n<e;n++)t.basket.buyItem(i)},this.unBuySeriallyItem=function(e,i,n,a){for(var s=0;s<e;s++)if(t.basket.unbuyItem(i,n,a),n.parent().length<1)return void $(".popup-menu").remove()},this.alertWindow=function(e){var i,n=[_t("how_want_to_buy",null,"item"),_t("cancel",null,"buttons"),'<div class="input-wrapper"><input class="default amount-input" placeholder="..." /></div>'];mAlert(n[0]+n[2],[{txt:"Ok",callback:function(){let n=i.val();if(!checkInputValIsEmptyProcedure(n))return n=t.chechValue(n),Engine.shop.buySeriallyItem(n,e),!0}},{txt:n[1],callback:function(){return!0}}],(function(t){const e=t.$.find(".amount-input");i=t.$.find(".default"),t.$.addClass("askAlert"),setOnlyPositiveNumberInInput(e),mobileCheck()||e.focus()}))},this.chechValue=function(t){var e=t<0?0:t;return e=e>100?100:e},this.modifyCounterIfChangeItemCl=function(t){null==g&&(g=t.cl),g!=t.cl&&(g=t.cl,p=8*(Math.floor(p/8)+1))},this.isSuperMarketItem=function(t){return t<15||22==t||24==t},this.initDroppable=function(){t.wnd.$.find(".buy-items").droppable({accept:".shop-item",drop:function(e,i){t.basket.buyItem(i.draggable.data("item"))}}),t.wnd.$.find(".sell-items").droppable({accept:".inventory-item",drop:function(e,i){i.draggable.css("opacity",""),t.basket.sellItem(i.draggable.data("item"),!1)}})},this.hide=function(e){for(var i in E)E[i]&&E[i].remove();t.close()},this.close=function(){t.basket.clearBasket(!0),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_SHOP_TPL),Engine.tpls.deleteMessItemsByLoc("n"),Engine.itemsMovedManager.removeItemsByTarget(Engine.itemsMovedData.ITEM_TO_SELL),i={},u={},w(),t.purchase=null,this.wnd.remove(),Engine.shop=!1,Engine.lock.remove("shop"),Engine.itemsMarkManager.compareAllItems(),Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.SHOP),Engine.interfaceItems.setEnableSlots("shop"),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,18),t.callCheckCanFinishExternalTutorialCloseShop()},this.callCheckCanFinishExternalTutorialCloseShop=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(c.ON_FINISH_BREAK.CLOSE_SHOP,c.ON_FINISH_TYPE.BREAK,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.addItemsToCompare=function(){Engine.shop.items=u,Engine.itemsMarkManager.compareAllItems(u)},this.getItems=function(){return u},this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.SHOP;Engine.windowCloseManager.callWindowCloseConfig(t)},this.getShopItemsNameHighlight=t=>{let e=[];for(let i in h){if(i!=t)continue;let n=h[i];e.push(n.highlight)}return e},this.removeClassInHighlighst=t=>{for(let e in h){let i=h[e].highlight;i.hasClass(t)&&i.removeClass(t)}}}},function(t,e,i){var n=i(226),a=i(0);let s=i(28),r=i(29);var o=i(8);const{checkPersonalItems:l,checkEnhancedItems:c}=i(2),d=i(50);t.exports=function(t){var e=this,i=0,h={},u={0:null,1:null,2:null,3:null,4:null},p={},g={};const f={0:null,2:null,4:null};var m=Engine.shop.wnd.$.find(".buy-items"),v=Engine.shop.wnd.$.find(".sell-items");this.addToCanvasCharacterSlots=(t,e)=>{f[t]=e},this.removeFromCanvasCharacterSlots=t=>{f[t]=null},this.getFromCanvasCharacterSlots=t=>f[t],this.clearCanvasCharacterSlots=()=>{for(let t in f){let e=this.getFromCanvasCharacterSlots(t);null!=e&&(Engine.canvasCharacterWrapperManager.removeCharacter(e),this.removeFromCanvasCharacterSlots(t))}};var E=function(){var e=0,n=0;for(var a in h)e+=h[a].amount*h[a].price;for(var a in p){const e=.01*t.buyp,i=Math.floor(p[a].price/p[a].amount),s=Math.min(i*e,t.maxbuyp);n+=Math.round(s*p[a].amount)}i=n-e,$(".shop-balance .buy",Engine.shop.wnd.$).text((0!=i?"-":"")+formNumberToNumbersGroup(e)),$(".shop-balance .sell",Engine.shop.wnd.$).text((0!=i?"+":"")+formNumberToNumbersGroup(n));var s="";switch(t.cur){case"zl":s=(0!=i?i>0?"+":"-":"")+round(i,2)+(-i>Engine.hero.d.gold?" (!)":"");break;case"sl":s=(0!=i?i>0?"+":"-":"")+round(i,2)+(-i>Engine.hero.d.credits?" (!)":"");break;case"ph":s=(0!=i?i>0?"+":"-":"")+round(i,2)+(-i>Engine.hero.d.honor?" (!)":"");break;default:var r=0,o=t.cur.split("|");let e=Engine.heroEquipment.getHItems();for(var l in e){var c=e[l];if(c.name==o[0]){var d=/amount=([0-9]+)/.exec(c.stat);null!==d&&isset(d[1])?r+=parseInt(d[1]):r++}}s=(0!=i?i>0?"+":"-":"")+round(i,2)+(-i>r?" (!)":"")}$(".shop-balance .balance",Engine.shop.wnd.$).text(s),i<0?$(".shop-balance .balance",Engine.shop.wnd.$).addClass("minus"):$(".shop-balance .balance",Engine.shop.wnd.$).removeClass("minus")};this.refuseBuyItem=function(t,i,n,a){var s=[];s.push([_t("unbuy 5"),function(){Engine.shop.unBuySeriallyItem(5,i,n,a)},{button:{cls:"not-close"}}]),s.push([_t("unbuy 1"),function(){Engine.shop.unBuySeriallyItem(1,i,n,a)},{button:{cls:"not-close"}}]),s.push([_t("unbuy all"),function(){for(;n.parent().length>0;)e.unbuyItem(i,n,a)}]),t.clientX-=80,Engine.interface.showPopupMenu(s,t)},this.buyItem=function(t){if(isset(h[t.id]))h[t.id].amount++;else{var i=parseInt(function(){for(var t in u)if((!Engine.shop.shopType||t%2!=1)&&null===u[t])return t;return null}());if(isNaN(i))return;var a=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.BUY_ITEM_IN_BASKET_VIEW,Engine.itemsFetchData.NEW_BASKET_TPL.loc)[0];if(a.data("item",t),isset(t._cachedStats.amount)&&Engine.tpls.changeItemAmount(t,a,t.quantity),h[t.id]={offerId:t.offerId,amount:1,price:t.pr,$:a},a.appendTo(m),a.click((function(n){e.unbuyItem(t,$(this),i)})),a.contextmenu((function(n,a){e.refuseBuyItem(getE(n,a),t,$(this),i)})),a.css({left:32*i+i,top:0}),u[i+""]=t.id,1==Engine.shop.shopType){var s=Engine.items.parseItemStat(t.stat),o=null;if(isset(s.outfit)||isset(s.outfit_selector)?(isset(s.outfit)&&(o="outfit"),isset(s.outfit_selector)&&(o="outfit_selector")):isset(s.pet)&&(o="pet"),"pet"==o){let t=s.pet.split(","),n=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:r.drawSystem.PET,path:t[1],actions:t[3]}),a=n.getId(),o=$(n.getCanvas());e.addToCanvasCharacterSlots(i,a),o.addClass("canvasCharacterWrapper slot-id-"+i),Engine.shop.wnd.$.find(".sell-items").append(o)}if("outfit"==o){let t=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:r.drawSystem.PLAYER_OUTFIT,path:s.outfit.split(",")[1]}),n=t.getId(),a=$(t.getCanvas());e.addToCanvasCharacterSlots(i,n),a.addClass("canvasCharacterWrapper slot-id-"+i),Engine.shop.wnd.$.find(".sell-items").append(a)}if("outfit_selector"==o){let e={slot:i,name:t.name,list:t.getOutfits()};(new n).init(e)}}}h[t.id].amount>1?(h[t.id].$.find(".amount").length||h[t.id].$.append('<div class="amount"></div>'),h[t.id].$.find(".amount").html(h[t.id].amount)):a.find(".amount").remove(),E(),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,17),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,17),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,31),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,18),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,18),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,32),e.callCheckCanFinishExternalTutorialItemsInBasket()},this.callCheckCanFinishExternalTutorialItemsInBasket=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(o.ON_FINISH_REQUIRE.ITEMS_IN_BASKET,o.ON_FINISH_TYPE.REQUIRE,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.unbuyItem=function(t,i,n){var a=Engine.shop.getC_slots();if(h[t.id].amount--,h[t.id].amount>1?i.find(".amount").html(h[t.id].amount):i.find(".amount").remove(),h[t.id].amount<=0){delete h[t.id],i.remove(),u[n]=null;let s=e.getFromCanvasCharacterSlots(n);null!=s&&(Engine.canvasCharacterWrapperManager.removeCharacter(s),e.removeFromCanvasCharacterSlots(n)),Engine.shop.wnd.$.find(".outfit-selector-slot-"+n).remove(),Engine.shop.wnd.$.find(".outfit-selector-arrow-"+n).remove(),a[n]&&a[n].remove(),Engine.tpls.deleteViewIcon(t.id,Engine.itemsViewData.BUY_ITEM_IN_BASKET_VIEW)}E()},this.sellItem=function(i,n){var r=function(){for(var t=null,n=0;n<4;n++){for(var a=0;a<5;a++)if(!isset(g[a+","+n])){t=[a,n];break}if(t)break}if(null!==t){g[t[0]+","+t[1]]=i.id;let n=Engine.items.createViewIcon(i.id,Engine.itemsViewData.SELL_ITEM_IN_BASKET_VIEW)[0];n.data("item",i),Engine.shop.hoverToItemInEq(n,i),n.css({top:32*t[1]+t[1],left:32*t[0]+t[0]}),n.appendTo(v).click((function(){e.unsellItem(i,$(this),t)})),i.on("afterUpdate",e.afterItemUpdate),i.on("delete",e.afterItemDelete),n.contextmenu((function(a,s){var r={txt:_t("unbuy all"),f:function(){e.unsellItem(i,n,t)}};i.createOptionMenu(getE(a,s),r,{move:!0,use:!0})}));let a=i.haveStat("amount")?i.getAmount():1;p[i.id]={price:i.pr,amount:a},Engine.itemsMovedManager.addItem(i,Engine.itemsMovedData.ITEM_TO_SELL,(function(){e.unsellItem(i,n,t)}))}E()};if(s.isGoldCl(i.cl)||s.isQuestCl(i.cl)||s.isBlessCl(i.cl)||s.isUpgradeCl(i.cl)||s.isRecipeCl(i.cl)){let t=a.get("alert-item");const e=i.id,n=i.isItem()?Engine.items:Engine.tpls,s=n.createViewIcon(e,Engine.itemsViewData.NO_SELL_ITEM_VIEW,"g")[0];return t.find(".alert-item-name").text(i.name),void mAlert(t.html()+_t("sell_cannot",null),[{txt:"Ok",callback:function(){return n.deleteViewIcon(e,Engine.itemsViewData.NO_SELL_ITEM_VIEW),!0}}],(function(t){t.$.find(".alert-item-icon").append(s)}))}if(""!=t.purchase){if("*"!==t.purchase){var o=t.purchase.split(","),l=!1;for(var c in o)i.cl==o[c]&&(l=!0);if(!l)return void(n||mAlert(_t("seller_wont_buy_this")))}isset(p[i.id])||(i.stat.search("quest=")>=0||i.stat.search("nodesc")>=0?_g("shop&can_sell="+i.id,(function(t){1==t.can_sell&&r()})):r())}else n||mAlert(_t("seller_wont_buy_anything"))},this.unsellItem=function(t,i,n){delete p[t.id],delete g[n[0]+","+n[1]],Engine.items.deleteViewIcon(t.id,Engine.itemsViewData.SELL_ITEM_IN_BASKET_VIEW),Engine.itemsMovedManager.removeItem(t.id),i.remove(),t.unregisterCallback("afterUpdate",e.afterItemUpdate),t.$.removeClass("addHoverFromBottomItem"),E()},this.afterItemUpdate=function(){const t=this,e=Engine.items.getAllViewsByIdAndViewName(t.id,Engine.itemsViewData.SELL_ITEM_IN_BASKET_VIEW)[0];t.updadeViewAfterUpdateItem(e),p[t.id]={price:t.pr},E()},this.afterItemDelete=function(){const t=this;Engine.items.deleteViewIconIfExist(t.id,Engine.itemsViewData.SELL_ITEM_IN_BASKET_VIEW),delete p[t.id];for(const e in g)g[e]===t.id&&delete g[e];e.debouncedCalcPrices()},this.debouncedCalcPrices=debounce(()=>{E()},10),this.preFinalize=()=>{const t=Object.keys(p);(new d.default).addCondition(()=>c(t),_t("enhanced-item-confirm")).addCondition(()=>l(t),_t("personal-item-confirm2")).processConditions(()=>{this.finalize()})},this.finalize=function(){if(0!==Object.keys(h).length||0!==Object.keys(p).length){switch(t.cur){case"ph":if(-i>Engine.hero.d.honor)return void mAlert(_t("shop_to_low_ph"));break;case"zl":if(-i>Engine.hero.d.gold)return void mAlert(_t("shop_to_low_gold"));break;case"sl":if(-i>Engine.hero.d.credits)return void mAlert(_t("shop_to_low_credits"));break;default:var n=0,a=t.cur.split("|");let e=Engine.heroEquipment.getHItems();for(var s in e){var r=e[s];if(r.name==a[0]){var o=/amount=([0-9]+)/.exec(r.stat);null!==o&&isset(o[1])?n+=parseInt(o[1]):n++}}if(-i>n)return void mAlert(_t("shop_to_low_items %type%",{"%type%":a[0]}))}var l=[],c=[];for(var d in h)l.push(h[d].offerId+","+h[d].amount);for(var d in p)c.push(d);_g("shop&buy="+l.join(";")+"&sell="+c.join(","),(function(t){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,18),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,18),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,30),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,30),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,32),e.callCheckCanFinishExternalTutorialAcceptBasket(),isset(t.item)&&e.clearBasket(),getEngine().shop.removeClassInHighlighst("track")}))}},this.callCheckCanFinishExternalTutorialAcceptBasket=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(o.ON_FINISH_REQUIRE.ACCEPT_BASKET,o.ON_FINISH_TYPE.REQUIRE,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.clearBasket=function(t){var i=Engine.shop.getC_slots();for(var n in e.clearBuyItems(),u={0:null,1:null,2:null,3:null,4:null},i)i[n]&&i[n].remove(),Engine.shop.wnd.$.find(".outfit-selector-slot-"+n).remove(),Engine.shop.wnd.$.find(".outfit-selector-arrow-"+n).remove();e.clearCanvasCharacterSlots(),e.clearSellItems(),479!=Engine.shop.getData().id&&(t||E())},this.clearSellItems=function(){for(let t in p){const i=Engine.items.getItemById(t);Engine.items.deleteViewIconIfExist(t,Engine.itemsViewData.SELL_ITEM_IN_BASKET_VIEW),i.unregisterCallback("afterUpdate",e.afterItemUpdate),delete p[t]}$(".sell-items .item",Engine.shop.wnd.$).remove(),p={}},this.clearBuyItems=function(){for(let t in h){const i=Engine.tpls.getTplByIdAndLoc(t,"n");Engine.tpls.deleteViewIcon(t,Engine.itemsViewData.BUY_ITEM_IN_BASKET_VIEW),i.unregisterCallback("afterUpdate",e.afterItemUpdate),delete h[t]}$(".buy-items .item",Engine.shop.wnd.$).remove(),h={}}}},function(t,e,i){let n=i(29),a=i(0);t.exports=function(){let t=this;this.list=[],this.$header=null,this.chooseOutfitFromList=0,this.init=t=>{this.slot=t.slot,this.prepareList(t.list),this.setHeader(),this.setOutfit()},this.removeOldOutfit=()=>{let t=this.getOutfitData(),e=$(t.canvasCharacterWrapper),i=t.canvasCharacterWrapperId;Engine.shop.basket.removeFromCanvasCharacterSlots(this.slot),e.remove(),Engine.canvasCharacterWrapperManager.removeCharacter(i)},this.setHeader=()=>{this.$header=a.get("outfit-selector-header"),this.$arrow=a.get("outfit-selector-arrow");let e=28*t.slot;this.$header.addClass("outfit-selector-slot-"+this.slot),this.$arrow.addClass("outfit-selector-arrow-"+this.slot),this.$header.css({left:e}),this.$arrow.css({left:e}),this.$arrow.on("click",this.changeOutfit),this.setOutfitSelectorIndex(),this.$header.find(".outfit-selector-index-max").html(this.list.length),Engine.shop.wnd.$.find(".sell-items").append(this.$header),Engine.shop.wnd.$.find(".sell-items").append(this.$arrow)},this.setOutfitSelectorIndex=()=>{this.$header.find(".outfit-selector-index").html(this.chooseOutfitFromList+1)},this.prepareList=t=>{for(let e in t)this.list.push({path:t[e].img,gender:t[e].gender,name:t[e].name,canvasCharacterWrapper:null,canvasCharacterWrapperId:null})},this.setOutfit=()=>{let t=this.getOutfitData();this.name=t.name,this.gender=t.gender,this.setAvatar()},this.getOutfitData=()=>this.list[this.chooseOutfitFromList],this.setCanvasCharacterWrapper=(t,e)=>{let i=this.getOutfitData();i.canvasCharacterWrapper=t,i.canvasCharacterWrapperId=e},this.setAvatar=()=>{let t=this.getOutfitData(),e=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:n.drawSystem.PLAYER_OUTFIT,path:t.path}),i=e.getId(),a=$(e.getCanvas());this.setCanvasCharacterWrapper(a,i),Engine.shop.basket.addToCanvasCharacterSlots(this.slot,i),a.addClass("canvasCharacterWrapper slot-id-"+this.slot),Engine.shop.wnd.$.find(".sell-items").append(a)},this.nextChooseOutfitFromList=()=>{this.chooseOutfitFromList++,this.chooseOutfitFromList+1>this.list.length&&(this.chooseOutfitFromList=0)},this.changeOutfit=()=>{this.removeOldOutfit(),this.nextChooseOutfitFromList(),this.setOutfit(),this.setOutfitSelectorIndex()}}},function(t,e,i){var n=i(0),a=i(7);t.exports=function(){var t,e=this,i={};this.init=function(){this.initGoods(),this.initWindow(),this.initButtonPanel(),this.initAllCheckbox(),this.initHeader(),this.wnd.center()},this.initHeader=function(){t.find(".header").html(_t("no_sell",null,"shop"))},this.initGoods=function(){let t=Engine.serverStorage.get(a.GREAT_MERCHAMP);for(var e in Engine.shop.goods){let n=null!=t&&isset(t[e])?t[e]:Engine.shop.goods[e].state;i[e]={state:n,gr:Engine.shop.goods[e].gr}}},this.initWindow=function(){t=n.get("great-merchamp-menu"),Engine.windowManager.add({content:t,title:_t("great_merchamp",null,"shop"),nameWindow:Engine.windowsData.name.GREAT_MERCHAMP,objParent:this,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",managePosition:{x:"251",y:"65"},addClass:"greatmerchamp-window",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),Engine.greatMerchamp=this},this.initButtonPanel=function(){var i=n.get("button"),s=n.get("button");i.add(s).addClass("small green"),i.find(".label").html(_t("save",null,"shop")),s.find(".label").html(_t("cancel",null,"shop")),t.find(".button-pannel").append(i,s),i.click((function(){let t={};e.saveGoodsToStorage(t),Engine.serverStorage.sendData({[a.GREAT_MERCHAMP]:t},(function(){e.close()}))})),s.click((function(){e.close()}))},this.initAllCheckbox=function(){var e=t.find(".checkbox-list");for(var n in i)this.createCheckbox(n,i[n].state,i[n].gr,e)},this.saveGoodsToStorage=function(e){for(var n=t.find(".one-checkbox"),a=n.length,s=0;s<a;s++){var r=n.eq(s),o=r.data("kind");if(isset(i[o])){var l=r.find(".checkbox").hasClass("active");i[o].state=l,e[o]=l}}},this.createCheckbox=function(t,e,i,a){var s=n.get("one-checkbox"),r=_t(t,null,"greatMerchamp");a.find(".gr-"+i).append(s),s.data("kind",t),s.find(".checkbox").addClass(e?"active":""),s.find(".label").html(r),s.click((function(){$(this).find(".checkbox").toggleClass("active")}))},this.close=function(){e.wnd.remove(),Engine.greatMerchamp=!1}}},function(t,e,i){var n=i(229),a=i(230),s=i(231),r=i(232),o=i(233),l=i(234),c=i(235);t.exports=new function(){this.game=null,this.v=null,this.data=null,this.loadedGames=[];var t=this,e=!1;this.loadImages=function(t){var e=[0];for(var i in t.list){let n="js/Margonem/minigames/"+this.data.name+"/img/"+t.list[i];this.setImgLoader(t,n,e)}},this.setImgLoader=(t,e,i)=>{Engine.imgLoader.onload(e,!1,!1,e=>{i[0]++,i[0]==t.amount&&this.start()})},this.loadCss=function(t){$("head").append('<link rel="stylesheet" type="text/css" href="js/Margonem/minigames/'+this.data.name+"/"+t+"?ts="+unix_time()+'" />')},this.initGame=function(t){this.v=t,this.task({c:"init"})},this.loadScripts=function(e){switch(this.data=e,t.game=null,e.name){case"crafting":t.game=new n(t);break;case"mastermind":t.game=new a(t);break;case"pipes":t.game=new s(t);break;case"questions":t.game=new r(t);break;case"saper":t.game=new o(t);break;case"memo":t.game=new l(t);break;case"hidden":t.game=new c(t)}t.game.initData=e,t.loadedGames.indexOf(e.name)<0?(isset(e.files)&&t.loadImages(e.files),isset(e.css)&&t.loadCss(e.css),t.loadedGames.push(e.name),isset(e.files)||t.start()):t.start()},this.start=function(){setTimeout((function(){$("#load_game").remove(),t.game.run(),e=!0}),500)},this.task=function(e){null!=this.game&&this.game.lock(),$.ajax({url:`${Engine.worldConfig.getApiDomain()}/minigames/${Engine.worldConfig.getWorldName()}`,type:"post",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",data:{d:e,g:t.v},success:function(e){null!=t.game&&t.game.unlock(),t.parseMessage(e)}})},this.parseMessage=function(t){if(!t)return!1;switch(t.t){case"init":this.loadScripts(t);break;case"nogame":null!=this.game?this.game.endGame():_g("endgame"),Engine.lock.remove("minigame");break;default:this.game.parseMessage(t)}},this.endGame=function(){e&&(_g("endgame",(function(t){isset(t.e)&&"ok"==t.e||(e=!0)})),e=!1)}}},function(t,e,i){var n=i(0);t.exports=function(t){this.initData=null,this.name="crafting",this.isLocked=!0,this.l=t,this.remainingTime=null,this.remainingTimeInterval=null,this.infobox=null,this.wnd=null;var e=this;this.init=function(){Engine.lock.add("minigames"),this.infobox=$("<div>").attr("id","crafting-info"),this.createInfoText(),this.createImageSlot(),this.createTimeLeft(),this.createIndicator(),this.startTimer(),Engine.windowManager.add({content:this.infobox,nameWindow:Engine.windowsData.name.CRAFTING_MINI_GAME,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,title:"",closeable:!1,onclose:()=>{e.cancelGame()}}),this.wnd.$.addClass("crafting-game-window"),this.wnd.addToAlertLayer(),this.wnd.addControll(_t("stop",null,"minigames"),"small",()=>{e.cancelGame()}),this.wnd.center(),this.unlock()},this.cancelGame=function(){e.l.task({c:"cancel"}),clearInterval(e.remainingTimeInterval)},this.initTimer=function(t){this.remainingTime=t,e.updateTimerView(),null!=this.remainingTimeInterval&&clearInterval(e.remainingTimeInterval),this.remainingTimeInterval=setInterval((function(){--e.remainingTime,e.remainingTime>=0&&e.updateTimerView(),e.remainingTime<=0&&(e.l.task({c:"check"}),clearInterval(e.remainingTimeInterval))}),1e3)},this.run=function(){this.init()},this.endGame=function(){Engine.lock.remove("minigames"),clearInterval(e.remainingTimeInterval),this.infobox.remove(),e.wnd.fadeAndRemove(),this.l.endGame()},this.parseMessage=function(t){switch(t.t){case"check":break;case"quit":this.endGame()}},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1},this.startTimer=function(){this.initData.time<=0?e.l.task({c:"check"}):this.initTimer(this.initData.time)},this.updateTimerView=function(){let t=(e.initData.stime-e.remainingTime)/e.initData.stime;0==e.remainingTime&&(t=1);const i=Math.floor(100*t)+"%";e.$timeLeft.text(e.remainingTime+"s"),e.$indicator.css("width",100*t+"%"),e.$indicatorText.text(i)},this.createIndicator=function(){var t=$("<div>").addClass("indicator-container");this.$indicator=$("<div>").addClass("indicator"),this.$indicatorText=$("<span>").addClass("progress-info"),t.append(this.$indicator),t.append(this.$indicatorText),this.infobox.append(t)},this.createTimeLeft=function(){this.$timeLeft=$("<div>").addClass("time-left"),this.infobox.append(this.$timeLeft)},this.createImageSlot=function(){var t=n.get("item-slot"),e=$("<img>");e.attr("src",`${cdnUrl}/${this.initData.i[1]}`),t.append(e),this.infobox.append(t)},this.createInfoText=function(){const t=$("<div>").addClass("info-text");t.text(this.initData.i[0]),this.infobox.append(t)}}},function(t,e){t.exports=function(t){this.initData=null,this.name="mastermind",this.isLocked=!0,this.l=t,this.files=[],this.steps=0,this.remainingTime=null,this.remainingTimeInterval=null,this.marked={},this.wnd=null;var e=this;this.init=function(){Engine.lock.add("minigames"),this.window=$(document.createElement("div")).attr("id","mastermind"),this.window.append('<div class="gameWrapper"><div class=gameinfo>'+_t("mastermind_infotxt",null,"minigames")+'</div><div class="timer"></div><div class="colorMatrix"></div><div class="attemptListWrapper"><div class="attemptList" id="mastermindAttemptList"></div><div class="scrollButton up"></div><div class="scrollButton down"></div></div><div class="infoPanel"><div class="infoA" tip="'+_t("masterming_infoA_tip",null,"minigames")+'"><span></span></div><div class="infoB" tip="'+_t("mastermind_infoB_tip",null,"minigames")+'"><span></span></div><div class="infoC" tip="'+_t("mastermind_infoC_tip",null,"minigames")+'"><span>'+e.initData.tries+'</span></div><div class="sendButton">'+_t("open")+"</div></div></div>"),this.window.find(".gameWrapper").css("background","url(js/Margonem/minigames/"+this.name+"/img/"+this.initData.files.list.bg+") no-repeat");for(var t=0;t<this.initData.colors.length;t++)for(var i=0;i<this.initData.columns;i++){var n=$(document.createElement("div")).addClass("cBox "+this.initData.colors[t]+" col"+i).attr("box",this.initData.colors[t]+"_"+i).css({top:29*t,left:29*i,opacity:.4});this.window.find(".colorMatrix").append(n)}for(this.remainingTime=this.initData.time-5,this.window.find(".timer").html(e.remainingTime+"s"),this.remainintTimeInterval=setInterval((function(){--e.remainingTime,e.window.find(".timer").html(e.remainingTime+"s"),e.remainingTime<=0&&(e.l.task({c:"endGame"}),clearInterval(e.remainintTimeInterval))}),1e3),this.window.find(".colorMatrix .cBox").click((function(){if(this.isLocked)return!1;var t=$(this).attr("box").split("_");$("#mastermind .cBox.col"+t[1]).removeClass("active").css("opacity",.4),$(this).addClass("active").css("opacity",1),e.marked[t[1]]=t[0]})),this.window.find(".infoPanel .sendButton").click((function(){e.isLocked||e.l.task({c:"check",data:e.marked})})),$("#centerbox").append(this.window),t=0;t<this.initData.attempts.length;t++)this.addStep(this.initData.attempts[t]);this.window.find(".attemptListWrapper .scrollButton").on("click",(function(){$("#mastermind .attemptList").scrollTop($("#mastermind .attemptList").scrollTop()+($(this).hasClass("up")?-10:10))})),this.window.find(".attemptList").on("mousewheel",(function(t){var e=null==t.wheelDelta?t.detail<0?10:-10:t.wheelDelta<0?10:-10;$("#mastermind .attemptList").scrollTop($("#mastermind .attemptList").scrollTop()+e)})),Engine.windowManager.add({content:this.window,nameWindow:Engine.windowsData.name.MASTERMIND_MINI_GAME,nameRefInParent:"wnd",objParent:this,title:_t("mastermind_title",null,"minigames"),onclose:()=>{e.l.task({c:"endGame"})}}),this.wnd.addToAlertLayer(),this.wnd.center(),this.unlock()},this.parseMessage=function(t){switch(t.t){case"check":this.window.find(".infoPanel .infoA span").text(t.step.g),this.window.find(".infoPanel .infoB span").text(t.step.b),this.window.find(".infoPanel .infoC span").text(t.tries),this.addStep(t.step),this.checkStatus(t.s);break;case"error":mAlert(t.msg);break;case"quit":this.endGame()}},this.checkStatus=function(t){t>1&&this.endGame()},this.addStep=function(t){var i='<div class="attempt"><span>'+_t("attempt")+" "+ ++this.steps+"</span>";for(var n in t.c)i+='<div class="mini_cBox '+t.c[n]+'"></div>';i+='<div class="step_info"><span>B: '+t.b+'</span></div><div class="step_info"><span>A: '+t.g+'</span></div><div style="clear:both;"></div></div>',this.window.find(".attemptList").append(i),this.steps>5&&$("#mastermind .scrollButton").css({display:"block"}),setTimeout((function(){e.window.find(".attemptList").scrollTop(1e3)}),50)},this.run=function(){this.init()},this.endGame=function(){clearInterval(e.remainintTimeInterval),this.wnd.fadeAndRemove(),this.l.game=null,Engine.lock.remove("minigames"),this.l.endGame()},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1}}},function(t,e){t.exports=function(t){this.initData=null,this.name="pipes",this.isLocked=!0,this.l=t,this.isLocked=!0,this.files=[],this.fields=null,this.remainingTime=null,this.remainingTimeInterval=null,this.ballAnimationInterval=null,this.wnd=null;var e=this,i=null;this.getZoomFactor=function(){return isset(Engine)&&isset(Engine.zoomFactor)?Engine.zoomFactor:1},this.init=function(){Engine.lock.add("minigames"),this.window=$(document.createElement("div")).attr("id","pipes"),this.window.append('<div class="gameWrapper"><div class=gameinfo>'+_t("pipes_desc",null,"minigames")+'</div><div class="array"></div><div class="timer"></div></div>'),this.window.find(".gameWrapper").css("background","url(js/Margonem/minigames/"+this.name+"/img/"+this.initData.files.list.bg+") no-repeat"),this.fields=this.initData.fields,this.parseFields(this.fields),this.remainingTime=this.initData.time-5,this.initData.status>1?e.l.task({c:"check"}):this.remainingTime<=0?e.l.task({c:"endGame"}):(this.window.find(".timer").html(e.remainingTime+"s"),this.remainintTimeInterval=setInterval((function(){--e.remainingTime,e.window.find(".timer").html(e.remainingTime+"s"),e.remainingTime<=0&&(e.animateBall(),clearInterval(e.remainintTimeInterval))}),1e3),this.unlock()),Engine.windowManager.add({content:this.window,nameWindow:Engine.windowsData.name.PIPES_MINI_GAME,nameRefInParent:"wnd",objParent:this,title:_t("pipes_title",null,"minigames"),onclose:()=>{e.l.task({c:"endGame"})}}),this.wnd.addToAlertLayer(),this.wnd.center()},this.parseFields=function(t){this.initData.fields=t,t=t.split(",");var n=[];for(var a in t){var s=!0,r=t[a],o=parseInt(a>=8?a%8:a),l=Math.floor(a/8),c=parseInt(r);if(isNaN(c)||(-2==c?r="bl":s=!1),s){var d=$(document.createElement("div")).css({top:29*l,left:29*o}).addClass("tile "+r).attr("id","pipecell_"+l+"_"+o);"bl"==r&&d.css("opacity",.3),n.push(d[0])}}this.window.find(".gameWrapper .array").html(n).append('<div class="ball"></div>'),setTimeout((function(){e.window.find(".gameWrapper .array .tile:not(.bl)").draggable({start:function(t,n){if(e.isLocked)return!1;$(this).css("opacity",.7);var a=$("#pipes .gameWrapper .array").offset(),s=e.getZoomFactor(),r=Math.floor((n.offset.top-a.top+n.helper.height()*s/2)/29/s),o=Math.floor((n.offset.left-a.left+n.helper.width()*s/2)/29/s);o>=0&&o<=7&&r>=0&&r<=8&&(i={x:o,y:r})},stop:function(t,n){if(e.isLocked)return!1;if(null==i)return!1;$(this).css("opacity",1);var a=$("#pipes .gameWrapper .array").offset(),s=e.getZoomFactor(),r=Math.floor((n.offset.top-a.top+n.helper.height()*s/2)/29/s),o=Math.floor((n.offset.left-a.left+n.helper.width()*s/2)/29/s),l={dstRow:r=Math.max(Math.min(8,r),0),dstCol:o=Math.max(Math.min(7,o),0),srcRow:i.y,srcCol:i.x};i=null,e.isLocked||e.l.task({c:"put",data:l})},cursorAt:{top:14,left:14}})}),200)},this.run=function(){this.init()},this.endGame=function(){clearInterval(e.remainintTimeInterval),clearInterval(e.ballAnimationInterval),this.wnd.fadeAndRemove(),this.l.endGame(),Engine.lock.remove("minigames")},this.parseMessage=function(t){switch(t.t){case"update":this.parseFields(t.fields),null!=t.ball&&this.checkBall(t);break;case"check":this.checkStatus(t.status);break;case"error":mAlert(t.msg);break;case"quit":this.endGame()}},this.checkBall=function(t){t.ball&&(clearInterval(e.remainintTimeInterval),this.animateBall(t.fields))},this.animateBall=function(){this.lock();var t=$(".gameWrapper .array .ball"),i=this.initData.fields.split(","),n="l",a="r",s=["u","l","d","r"],r=["d","r","u","l"],o=[6,0],l=188.5,c=0,d=14.5,h=null,u=null,p=0,g=0,f=!1,m=[null,null];this.ballAnimationInterval=setInterval((function(){if((o=[Math.floor(l/29),Math.floor(c/29)])[0]!=m[0]||o[1]!=m[1])if(m=o,(c<=0||c>=232||l<=0||l>=232)&&6!=o[0]&&0!=o[0])f=!0,clearInterval(e.ballAnimationInterval),e.l.task({c:"check"});else{for(var v=i[8*m[0]+m[1]],E=r[s.indexOf(a)],_=0;_<2;_++)E!=v[_]?a=v[_]:n=v[_];(1==o[0]&&8==o[1]||r[s.indexOf(E)]!=s[r.indexOf(n)]||!isNaN(parseInt(v))||c<0||c>232||l<0||l>232)&&(f=!0,clearInterval(e.ballAnimationInterval),e.l.task({c:"check"})),h=null,u=null,p=0,g=0}if(s.indexOf(n)==r.indexOf(a))"l"==n&&(c+=1),"r"==n&&(c-=1),"u"==n&&(l+=1),"d"==n&&(l-=1);else{var b=n,w=a;null==h&&("u"==w&&(h=.5*Math.PI,p=29*o[1]+("r"==b?29:0),g=29*o[0]),"d"==w&&(h=1.5*Math.PI,p=29*o[1]+("r"==b?29:0),g=29*o[0]+29),"r"==w&&(h=1*Math.PI,p=29*o[1]+29,g=29*o[0]+("d"==b?29:0)),"l"==w&&(h=0*Math.PI,p=29*o[1],g=29*o[0]+("d"==b?29:0)),u="l"==b&&"u"==w||"d"==b&&"l"==w||"r"==b&&"d"==w||"u"==b&&"r"==w?-1:1),h+=.06896551724137931*u,c=Math.cos(h)*d+p,l=Math.sin(h)*d+g}f||t.css({display:"block",top:l-d,left:c-d})}),10)},this.checkStatus=function(t){t>=1&&this.endGame()},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1}}},function(t,e){t.exports=function(t){this.initData=null,this.name="questions",this.isLocked=!0,this.l=t,this.remainingTime=null,this.remainingTimeInterval=null;var e=this,i=null;this.init=function(){Engine.lock.add("minigames");var t=!1,n=[{txt:_t("ok",null,"buttons"),callback:function(){if(!t)return t=!0,e.l.task({c:"check",a:i.$.find("input").val()}),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){if(!t)return t=!0,e.l.task({c:"endGame"}),!0}}];mAlert(parseContentBB(this.initData.q)+"<br />"+_t("questions_time",null,"minigames")+'<div class="input-wrapper"><input class=default placeholder="..." /></div>',n,(function(t){(i=t).$.addClass("askAlert"),i.$.addClass("no-exit-button"),i.$.width(300),mobileCheck()||i.$.find(".input-wrapper > input").focus()})),this.remainingTime=this.initData.time-5,this.remainingTimeInterval=setInterval((function(){--e.remainingTime,i.$.find(".timer").html(e.remainingTime+"s"),e.remainingTime<=0&&(e.l.task({c:"endGame"}),i.fadeAndRemove(),clearInterval(e.remainingTimeInterval),Engine.lock.remove("minigames"))}),1e3),this.unlock()},this.run=function(){this.init()},this.endGame=function(){clearInterval(e.remainingTimeInterval),null!==i&&i.fadeAndRemove(),Engine.lock.remove("minigames"),this.l.endGame()},this.parseMessage=function(t){switch(t.t){case"check":this.checkStatus(t.status);break;case"quit":this.endGame()}},this.checkStatus=function(t){t>=1&&this.endGame()},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1}}},function(t,e){t.exports=function(t){this.initData=null,this.name="saper",this.isLocked=!0,this.l=t,this.isLocked=!0,this.files=[],this.fields=null,this.remainingTime=null,this.remainingTimeInterval=null,this.wnd=null;var e=this;this.init=function(){Engine.lock.add("minigames"),this.window=$(document.createElement("div")).attr("id","saper"),this.window.append('<div class="gameWrapper"><div class=gameinfo>'+_t("saper_infotxt",null,"minigames")+'</div><div class="array"></div><div class="timer"></div><div class=fieldsleft>'+_t("saper_left_fields",null,"minigames")+'<div id="_saper_fieldsleft"></div></div><div class=fieldsleft style="top: 430px;">'+_t("saper_chance_left",null,"minigames")+'<div id="_saper_chanceleft"></div></div></div>'),this.window.find(".gameWrapper").css("background","url(js/Margonem/minigames/"+this.name+"/img/"+this.initData.files.list.bg+") no-repeat"),this.m=this.initData.m,this.parseFields(this.m),$(document.createElement("div")).attr("rollover",22).addClass("quitButton closebut").click((function(){e.l.task({c:"endGame"})})).appendTo(e.window.find(".label")),$("#centerbox").append(this.window),this.remainingTime=this.initData.time-5,$("#_saper_fieldsleft").html(this.initData.req),$("#_saper_chanceleft").html(this.initData.tries),this.window.find(".timer").html(e.remainingTime+"s"),this.remainintTimeInterval=setInterval((function(){--e.remainingTime,e.window.find(".timer").html(e.remainingTime+"s"),e.remainingTime<=0&&(e.l.task({c:"endGame"}),clearInterval(e.remainintTimeInterval))}),1e3),this.unlock(),Engine.windowManager.add({content:this.window,nameWindow:Engine.windowsData.name.SAPER_MINI_GAME,nameRefInParent:"wnd",objParent:this,title:_t("saper_title",null,"minigames"),onclose:()=>{e.l.task({c:"endGame"})}}),this.wnd.addToAlertLayer(),this.wnd.center()},this.parseFields=function(t){t=t.split(",");var i={r:-30,b:-59,g:0},n=102-34*e.initData.s/2;for(var a in t){var s=t[a][0],r=t[a][1];$("#jevel_"+a).remove();var o=$(document.createElement("div")).addClass("jvl "+r).attr("id","jevel_"+a);o.css({top:34*Math.floor(parseInt(a)/e.initData.s)+n,left:34*Math.floor(parseInt(a)%e.initData.s)+n,"background-position":-1*parseInt(s)*30+"px "+i[r]+"px"}).click((function(){var t=$(this).attr("id").split("_");e.l.task({c:"check",i:t[1]})})),this.window.find(".array").append(o)}},this.run=function(){this.init()},this.endGame=function(){clearInterval(e.remainintTimeInterval),this.wnd.fadeAndRemove(),Engine.lock.remove("minigames"),this.l.endGame()},this.parseMessage=function(t){switch(t.t){case"update":this.parseFields(t.m),$("#_saper_fieldsleft").html(t.r),$("#_saper_chanceleft").html(t.tr);break;case"check":this.checkStatus(t.status);break;case"error":mAlert(t.msg);break;case"quit":this.endGame()}},this.checkStatus=function(t){t>=1&&this.endGame()},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1}}},function(t,e){t.exports=function(t){var e=this,i=1e3;return this.name=null,this.initData=null,this.image=null,this.window=null,this.wnd=null,this.remainingTime=null,this.remainintTimeInterval=null,this.$attempText=null,this.$itemList=null,this.objects=[],this.discoveredCards=0,this.addElementToMap=function(t,i){var n=$("<div>").addClass("memoCard cardBack");return n.click((function(){e.checkCardId(n,i)})),n.appendTo(t),n},this.checkCardId=function(i,n){i.hasClass("cardFront")||i.hasClass("cardBlank")||e.isLocked||t.task({c:"check",id:n})},this.cardIdToPosition=function(t){var e=t%6,i=(t-e)/6;return"-"+(64*e+(e+1))+"px -"+(64*i+(i+1))+"px"},this.coverAllCards=function(t){for(var i in e.objects){var n=e.objects[i];n.hasClass("cardBack")||n.hasClass("cardBlank")||(n.clearQueue().empty().removeClass("cardFront"),n.addClass("cardBack"))}e.discoveredCards=0},this.updateCard=function(t){var n=t.id,a=t.c,s=e.objects[n];switch(a){case"d":s.empty().removeClass("cardBack"),s.addClass("cardFront cardBlank");break;case"d2":s.clearQueue().addClass("cardBlank"),s.delay(1e3).queue((function(t){$(this).empty().removeClass("cardBack"),$(this).addClass("cardFront"),t()}));break;case"b":s.clearQueue().delay(i).queue((function(t){$(this).empty().removeClass("cardFront"),$(this).addClass("cardBack"),t()}));break;case"s":s.removeClass("cardBack"),s.addClass("cardFront");var r=$("<div>").addClass("cardSymbol"),o=e.cardIdToPosition(t.src);r.css("background-position",o),s.empty().append(r),e.discoveredCards++}},this.timerTick=function(i){--e.remainingTime,i.html(e.remainingTime+"s"),e.remainingTime<=0&&(t.task({c:"endGame"}),clearInterval(e.remainintTimeInterval))},this.init=function(){Engine.lock.add("minigames"),e.window=$("<div>").attr("id","memocard");var n=$("<div>").addClass("gameWrapper").appendTo(e.window),a=$("<div>").addClass("timer").appendTo(n),s=$("<div>").addClass("itemMap").appendTo(n),r=$("<div>").addClass("infoGame").appendTo(n),o=_t("memo_info_header",null,"minigames"),l=_t("memo_info_content",null,"minigames");$("<div>").addClass("infoGameHeader").html(o).appendTo(r),$("<div>").addClass("infoGameContent").html(l).appendTo(r),e.objects=[];for(var c=e.initData.cols-1,d=0;d<e.initData.objects;d++){var h=e.addElementToMap(s,d);d%e.initData.cols==c&&$("<br>").appendTo(s),e.objects.push(h)}isset(e.initData.showedTime)&&(i=e.initData.showedTime),e.remainingTime=e.initData.time,a.html(e.remainingTime+"s"),e.remainintTimeInterval=setInterval((function(){e.timerTick(a)}),1e3),Engine.windowManager.add({content:e.window,nameWindow:Engine.windowsData.name.MEMO_MINI_GAME,nameRefInParent:"wnd",objParent:e,title:_t("memo_title",null,"minigames"),onclose:()=>{t.task({c:"endGame"})}}),e.wnd.addToAlertLayer(),e.wnd.center(),e.unlock()},this.run=function(){this.init(),e.checkStatus(e.initData)},this.endGame=function(){clearInterval(e.remainintTimeInterval),e.wnd.fadeAndRemove(),t.game=null,t.endGame(),Engine.lock.remove("minigames")},this.checkStatus=function(t){if(e.discoveredCards>=2&&e.coverAllCards(),isset(t.cards))for(var i in t.cards)e.updateCard(t.cards[i]);if(isset(t.time)&&(e.remainingTime=t.time),isset(t.end))return e.endGame()},this.parseMessage=function(t){switch(t.t){case"check":e.checkStatus(t);break;case"error":mAlert(_t("memo_err_"+t.msg,null,"minigames"));break;case"quit":e.endGame()}},this.lock=function(){e.isLocked=!0},this.unlock=function(){e.isLocked=!1},this}},function(t,e){t.exports=function(t){var e=this;this.name=null,this.initData=null,this.window=null,this.wnd=null,this.remainingTime=null,this.timeToUseHint=null,this.timeInterval=null,this.$attemptText=null,this.$itemList=null,this.$board=null,this.$hint=null,this.$hintContainer=null,this.$timerText=null,this.$waitingScreen=null,this.waitingInv=null;var i=null,n=null,a=[];return this.run=function(){this.init(),e.checkStatus(e.initData)},this.init=function(){Engine.lock.add("minigames"),n=null,a=[],e.remainingTime=e.initData.time,e.createUI(),e.lock(),e.loadBoardImage(),e.createBoardElements(),e.startTimeLoop(),$("#centerbox").append(e.window)},this.close=function(){t.task({c:"endGame"})},this.updateElements=function(t){for(var i in e.$itemList.empty(),t.sort((function(t,e){return t.length-e.length})),t){var n=t[i],a=$("<div>").addClass("itemName");a.text(n),a.tip(n),e.$itemList.append(a)}},this.boardClick=function(t){e.isLocked||e.checkPosition(t.offsetX,t.offsetY)},this.updateBoard=function(){for(var t in e.drawBackground(),e.initData.objects){var i=e.initData.objects[t];e.drawItem(i)}},this.endGame=function(){clearInterval(e.timeInterval),e.wnd.fadeAndRemove(),Engine.lock.remove("minigames"),t.endGame()},this.createBoardElements=function(){for(var t in e.initData.objects){var i=e.initData.objects[t];e.loadItem(i)}},this.loadItem=function(t){isset(a[t.src])||(a[t.src]=null,Engine.imgLoader.onload(e.getItemUrl(t),!1,!1,i=>{a[t.src]={image:i,width:i.width,height:i.height},e.onItemLoaded()}))},this.drawItem=function(t){if(isset(a[t.src])){var e=a[t.src],n=e.width*(t.size[2]/t.size[0]),s=e.height*(t.size[3]/t.size[1]);i.drawImage(e.image,-t.size[4],-t.size[5],n,s,t.pos[0],t.pos[1],t.size[2],t.size[3])}},this.createItemInHTML=function(t){var i=$("<div>").addClass("hiddenObject").appendTo(e.$board);return i.css({left:t.pos[0],top:t.pos[1],backgroundSize:t.size[0]+"px "+t.size[1]+"px",width:t.size[2],height:t.size[3],backgroundPosition:t.size[4]+"px "+t.size[5]+"px",backgroundImage:'url("'+e.getItemUrl(t)+'")'}),i},this.getItemUrl=function(t){return CFG.a_imgpath+t.src},this.loadBoardImage=function(){var t=e.getBoardUrl();Engine.imgLoader.onload(t,!1,!1,t=>{n=t,e.onBoardLoaded()})},this.drawBackground=function(){null!==n&&i.drawImage(n,e.initData.image[1],e.initData.image[2],n.width,n.height)},this.getBoardUrl=function(){return"js/Margonem/minigames/"+e.initData.name+"/img/map/"+e.initData.image[0]},this.onBoardLoaded=function(){e.isAllItemsLoaded()&&e.onAllImageLoaded()},this.onItemLoaded=function(){e.isAllItemsLoaded()&&null!==n&&e.onAllImageLoaded()},this.isAllItemsLoaded=function(){for(var t in a)if(null===a[t])return!1;return!0},this.onAllImageLoaded=function(){e.updateBoard(),e.unlock()},this.createElementWithContainer=function(t,e){var i=$("<div>").addClass(e+"Container");return{container:i,content:$(t).addClass(e).appendTo(i)}},this.createUITimer=function(t){var i=e.createElementWithContainer("<div>","timer");i.container.appendTo(t),e.$timerText=i.content},this.createUIBottom=function(t){var i=e.createElementWithContainer("<div>","bottom");i.container.appendTo(t),$("<div>").addClass("helpMessage").prependTo(i.container).text(_t("hiddenobject_infotxt",null,"minigames"));var n=$("<input>").addClass("hintButton").attr("type","button");n.prependTo(i.container),n.on("click",e.getHint),e.$hintText=n,e.timeToHint(!0);var a=e.createElementWithContainer("<div>","attemptText");a.container.addClass("block").prependTo(i.container),e.$attemptText=a.content;var s=e.createElementWithContainer("<div>","helpText");s.container.addClass("block").prependTo(i.container),s.content.text(_t("hiddenobject_info_header",null,"minigames")),i.content.addClass("itemsList"),e.$itemList=i.content},this.createUIBoard=function(t){var n=e.createElementWithContainer("<div>","board");n.container.appendTo(t),e.$hintContainer=$("<div>").addClass("hintContainer"),e.$hintContainer.appendTo(n.container),e.$board=n.content,e.$board.click(e.boardClick);var a=$("<canvas>").addClass("boardBackground");a[0].width=480,a[0].height=300,i=a[0].getContext("2d"),e.$board.append(a)},this.createUI=function(){e.window=$("<div>").attr("id","hiddenobject");var t=$("<div>").addClass("gameWrapper").appendTo(e.window);e.createUITimer(t),e.createUIBoard(t),e.createUIBottom(t),Engine.windowManager.add({content:this.window,nameWindow:Engine.windowsData.name.HIDDEN_MINI_GAME,nameRefInParent:"wnd",objParent:this,title:_t("hidden_title",null,"minigames"),onclose:()=>{e.close()}}),e.$waitingScreen=$("<div>").addClass("waiting").appendTo(t);var i=$("<div>").addClass("grid").appendTo(e.$waitingScreen);$("<div>").addClass("img").appendTo(i),e.wnd.addToAlertLayer(),e.wnd.center()},this.startTimeLoop=function(){e.$timerText.html(e.remainingTime+"s"),e.timeInterval=setInterval((function(){e.timeToHint(),e.showRemainingTime(),e.remainingTime<=0&&(e.timeToHint(!0),e.close(),clearInterval(e.timeInterval))}),1e3)},this.showRemainingTime=function(){--e.remainingTime,e.$timerText.html(e.remainingTime+"s")},this.getHint=function(){e.isLocked||t.task({c:"hint"})},this.timeToHint=function(t){if(-1==e.timeToUseHint)e.$hintText.val(_t("hint",null,"minigames")),e.$hintText.addClass("disable");else if(0==e.timeToUseHint)e.$hintText.val(_t("hint",null,"minigames")),e.$hintText.removeClass("disable");else{var i=Math.round(Math.abs(e.timeToUseHint))+" s";e.$hintText.val(_t("hint_timer %val%",{"%val%":i},"minigames")),e.$hintText.addClass("disable")}!t&&e.timeToUseHint>0&&--e.timeToUseHint},this.highlightObject=function(t){if(e.removeHint(),isset(e.initData.objects[t])){var i=e.initData.objects[t];e.highlightElement(i)}},this.animateHint=function(t,e,i,n){var a={top:e[1]+i,left:e[0]+i,width:n,height:n};t.animate(a,500,"linear"),$.fx.off&&t.delay(500)},this.highlightElement=function(t){var i=Math.min(t.size[2],t.size[3]),n=e.getCircleSizeByRect(1.5*i),a=e.getCircleSizeByRect(.5*i),s=e.getCircleOffsetToCenter(n,i),r=e.getCircleOffsetToCenter(a,i),o=t.pos;e.$hint=$("<div>").addClass("hintObject"),e.$hint.css({top:o[1]+s,left:o[0]+s,width:n+"px",height:n+"px"}),e.$hint.appendTo(e.$hintContainer);for(var l=0;l<5;l++)e.animateHint(e.$hint,o,r,a),e.animateHint(e.$hint,o,s,n);e.animateHint(e.$hint,o,r,a),e.$hint.fadeOut(200,(function(){e.$hint.remove(),e.$hint=null}))},this.getCircleSizeByRect=function(t){return 128*Math.sqrt(t*t*2)/120},this.getCircleOffsetToCenter=function(t,e){return-(t/2-e/2)},this.removeHint=function(){if(null!=e.$hint){var t=e.$hint;e.$hint=null,t.clearQueue("fx").fadeOut(200,(function(){t.remove()}))}},this.removeObject=function(t){var i=e.initData.objects[t];isset(i)&&(e.createItemInHTML(i).fadeOut("fast",(function(){e.removeHint(),$(this).remove()})),e.initData.objects.splice(t,1),e.updateBoard())},this.checkStatus=function(t){if(isset(t.removeObj)&&e.removeObject(t.removeObj),isset(t.clicks)&&isset(t.maxTry)){var i=_t("hiddenobject_attemp %val%/%val2%",{"%val%":t.clicks,"%val2%":t.maxTry},"minigames");e.$attemptText.text(i)}if(isset(t.elements)&&e.updateElements(t.elements),isset(t.hint)&&e.highlightObject(t.hint,e.hintTimes),isset(t.timeToUseHint)&&(e.timeToUseHint=t.timeToUseHint,e.timeToHint(!0)),isset(t.time)&&(e.remainingTime=t.time),isset(t.msg)){var n=_t("hiddenobject_message_"+t.msg,null,"minigames");message(n)}if(isset(t.end))return e.endGame()},this.checkPosition=function(e,i){t.task({c:"check",t:i,l:e})},this.parseMessage=function(t){switch(t.t){case"check":e.checkStatus(t);break;case"error":mAlert(t.msg);break;case"quit":e.endGame()}},this.lock=function(){e.isLocked=!0,e.showWaiting()},this.unlock=function(){e.isLocked=!1,e.hideWaiting()},this.showWaiting=function(){null!==e.waitingInv&&clearTimeout(e.waitingInv),e.waitingInv=setTimeout((function(){e.$waitingScreen.fadeIn("fast").delay(100),e.waitingInv=null}),300)},this.hideWaiting=function(){null!==e.waitingInv&&clearTimeout(e.waitingInv),e.waitingInv=null,e.$waitingScreen.fadeOut("fast")},this}},function(t,e,i){const n=i(237),a=i(51).default,s=i(238).default,r=i(239),o=i(240),l=i(0),c=i(23);t.exports=function(){let t,e={},i=null,d=null,h=null,u=null;const p={[a.RECEIVED]:null,[a.SENT]:null,[a.NEW_MAIL]:null},g=()=>{p[a.RECEIVED]=t.find(`.${a.RECEIVED}-content`),p[a.SENT]=t.find(`.${a.SENT}-content`),p[a.NEW_MAIL]=t.find(`.${a.NEW_MAIL}-content`),p[a.RECEIVED].append(l.get("mail-column")),p[a.SENT].append(l.get("mail-column")),p[a.NEW_MAIL].append(l.get("new-message").addClass("mail-column")),$(".scroll-wrapper",p[a.RECEIVED]).addScrollBar({track:!0,callback:m}),$(".scroll-wrapper",p[a.SENT]).addScrollBar({track:!0,callback:m}),f()},f=()=>{const t=p[a.RECEIVED].find(".footer"),e=new c.default({text:_t("refresh",null,"mails"),classes:["small","green"],action:()=>{_g("mail&action=refresh")}});t.append(e.getButton())},m=()=>{d.getNextPageAction()},v=(t,a)=>{const s=l.get("mails-container");let r=!1;t.map(t=>{if(isset(e[t.id]))return t;r=this.isNew(i),e[t.id]=new n,e[t.id].initMail(t,s,this,i),e[t.id].createBodyMail(r)}),t.length>0&&a.append(s.children())},E=t=>{t.html(""),e={}};this.isNew=t=>Engine.interface.mailsElements.counter>0&&t===a.RECEIVED&&(Engine.interface.mailsElements.counter--,!0);const _=()=>i===a.RECEIVED,b=t=>{const e=t.children(".one-mail-wraper").length;if(t.find(".mail-box-empty").remove(),0===e){const e=_t("no_msg",null,"mails"),i=l.get("mail-box-empty"),n=$("<span>").html(e);i.html(n),t.append(i)}},w=t=>{let{id:i,gold:n}=t;const a=e[i];if(a.money=n,0===a.money){const t=_t("attachments",null,"mails")+" "+_t("no_attach",null,"mails");a.$.find(".a-money").remove(),a.$.find(".a-tears ").remove(),a.$.find(".a-info").html("&nbsp;"+t);const e=_t("del_message",null,"mails");a.$.find(".removeMsg .label").text(e)}else{const t=_t("gold_att %amount%",{"%amount%":formNumberToNumbersGroup(a.money)},"mails");a.$.find(".a-money").tip(t)}a.$.find(".a-item").remove()},C=t=>{e[t].$.remove();const n=p[i].find(".scroll-pane");b(n),delete e[t]},T=()=>Engine;this.showMailCreator=t=>u.show(t),this.setSendItem=t=>u.setSendItem(t),this.getMailsPages=()=>d,this.getMailsWindow=()=>h,this.init=()=>{d=new r,h=new s,t=h.getWindow(),g(),u=new o(t),Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.MAIL)},this.updateData=e=>{if(isset(e.removeAttachments)&&e.removeAttachments.list.map(t=>w(t)),isset(e.remove)&&e.remove.list.map(t=>C(t.id)),isset(e.show)){h.manualSelectTab(e.show.tab);const n=p[i].find(".scroll-pane");(e=>{const n=t.find(".how-mail-or-char"),s=isset(e)?e:p[i].find(".one-mail-wraper").length,r=_t(1==s?"msg":"msgs",null,"mails");let o="";o=i===a.RECEIVED?_t("receive_amount_message",null,"mails"):_t("send_amount_message",null,"mails"),o+=s+" "+r;const l=$("<span>").html(o);n.html(l)})(e.show.totalMails),e.show.page&&d.updatePages(e.show.page,_());const s=d.getCurrentPage(),r=d.getMaxPage(),o=(1===s||0===r)&&!isset(e.remove);o&&(E(n),$(".scroll-wrapper",p[i]).trigger("scrollTop")),v(e.show.list,n),b(n),_()&&Engine.interface.deleteNotif("mailnotifier"),o&&$(".scroll-wrapper",p[i]).trigger("update"),$(".scroll-wrapper",p[i]).trigger("updateBarPos")}},this.changedTab=t=>{(t=>{i=t})(t),i===a.NEW_MAIL?u.countChars():u.clear()},this.stopDragBar=()=>{$(".scroll-wrapper",p[i]).trigger("stopDragBar")},this.removeInboxNotification=()=>{i===a.RECEIVED&&(t.find(".is-new").remove(),t.find(".amount-new-msg").empty())},this.close=()=>{e={},u.clear(),T().items.deleteMessItemsByLoc("b"),T().itemsMovedManager.removeItemsByTarget(Engine.itemsMovedData.MAIL_ITEM_TO_SEND),T().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.MAIL),T().mails=null}}},function(t,e,i){var n=i(0);let a=i(51).default;t.exports=function(){var t=this;this.$=null;var e=["Aukcjoner","Auctioneer","System","Grabarz","Baraki w Ithan","Zajazd u Makiny","Ratusz w Karka-han","Karczma pod Złotą Wywerną","Karczma Umbara","Karczma pod Fioletowym Kryształem","Karczma pod Posępnym Czerepem","Siedziba ergassaj","Alabastrowy Hotel","Knajpa pod Czarnym Tulipanem","Zajazd pod Tęczowym Żukiem","Zajazd pod Złamanym Dukatem","Kamienica Kandelia","Arena Gladiatorów","Zajazd pod Różą Wiatrów","Tawerna pod Bosmańskim Biczem","Kamienica Bursztynek","Zbójnicka spiżarnia","Oberża pod Złotym Kłosem","Austeria Karibiego","Kwatery u Morcera"];this.initMail=function(t,e,i,s){let{credits:r,gold:o,id:l,item:c,message:d,sender:h,recipientId:u,recipientNick:p,ts:g}=t;this.parent=i,this.id=l,this.$=n.get("one-mail-wraper"),this.$.data("id",this.id),this.ago=g,this.container=e,this.kind=s,this.kind===a.RECEIVED?(this.from=h,this.itemId=parseInt(c),this.money=parseInt(o),this.tear=parseInt(r),this.messageText=d,this.isSpecial=/\*/.test(this.from),this.checkSystemMsg()):(this.idPlayer=u,this.from=p,this.initMsgTextAndAtacment(d))},this.createBodyMail=function(t){this.createOneMail(),this.kind==a.RECEIVED&&(this.createRemoveButton(),this.createReplyButton(),this.createAtachments(),this.isNew(t))},this.initMsgTextAndAtacment=function(t){var e=t.split("\n\n[b]"),i=this.myFind(".a-info"),n="<b>"+_t("attachments",null,"mails")+" "+_t("no_attach",null,"mails"),a=e[1]?parseMailBB("[b]"+e[1]):n;this.messageText=e[0],i.html(a)},this.createAtachments=function(){var e=this.myFind(".a-info"),i="<b>"+_t("attachments",null,"mails")+"<b>";this.itemId&&this.createMailItem(),this.money&&(i=_t("gold_att %amount%",{"%amount%":formNumberToNumbersGroup(this.money)},"mails"),this.myFind(".a-money").addClass("atachment-exist").tip(i,"t_notif").click((function(){t.checkGoldLimit(!0)}))),this.tear&&(i=_t("sl_att %amount%",{"%amount%":this.tear},"mails"),this.myFind(".a-tears").addClass("atachment-exist").tip(i,"t_notif").click((function(){t.checkGoldLimit(!0)}))),this.money||this.itemId||this.tear||(i+=" "+_t("no_attach",null,"mails"),e.html("&nbsp;"+i))},this.createMailItem=function(){var e=t.myFind(".a-item").addClass("item-attachment-"+this.itemId),i=Engine.items.createViewIcon(this.itemId,Engine.itemsViewData.MAIL_ATTACHMENT_ITEM_VIEW)[0];if(!i)return;const n=i.data().item;e.addClass("atachment-exist mail-item-"+this.itemId),e.append(i),e.css("position","relative"),e.click((function(){t.checkGoldLimit(!0)})),e.contextmenu((function(e,i){var a={txt:_t("take_mail"),f:function(){t.checkGoldLimit(!0)}};n.createOptionMenu(getE(e,i),a)}))},this.createRemoveButton=function(){var e=n.get("button").addClass("small removeMsg"),i=this.$.find(".mail-footer"),a=this.money||this.itemId||this.tear?_t("mail_take_and_del"):_t("del_message",null,"mails");e.find(".label").text(a),i.append(e),e.click((function(){t.checkGoldLimit()}))},this.createReplyButton=()=>{if(!this.isSpecial){var t=n.get("button").addClass("small green"),e=this.$.find(".mail-footer");t.find(".label").text(_t("reply",null,"mails")),e.append(t),t.click(()=>{this.parent.removeInboxNotification(),this.parent.showMailCreator(this.from)})}},this.createOneMail=function(){var t=this.kind==a.RECEIVED?"from":"to",e=this.$.children(".msg-content"),i=calculateDiff(unix_time(),this.ago),n=_t("ago %ago%",{"%ago%":i},"mails"),s=this.from.replace(/\*/g,""),r=_t(t,null,"mails")+"<b>"+s+"</b>",o=ut_fulltime(this.ago);this.myFind(".from").html(r),this.isSpecial&&(this.myFind(".from").addClass("special"),this.myFind(".from").tip(_t("npc_msg"))),this.container.append(this.$),this.myFind(".when").html(n),this.myFind(".small").html(o),e.html(this.setMessageText())},this.checkGoldLimit=function(e){var i=parseInt(Engine.hero.d.goldlim),n=parseInt(Engine.hero.d.gold);if(!this.money)return this.requestAction(e),!1;this.money+n>i?t.requestAction(e):this.requestAction(e)},this.requestAction=function(t){if(t)_g("mail&action=get&id="+this.id);else{const t=Engine.mails.getMailsPages().getCurrentPage();_g(`mail&action=delete&id=${this.id}&lastPage=${t}`)}},this.checkFraud=function(t){if(new RegExp(["hasł","pass","login","logo","konto"].join("|"),"ig").test(t))return!0;var e=new RegExp("https?://([-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|])","ig"),i=new RegExp("^http://([a-z1-9.]*?)(margonem.pl)[^/\\?=a-z]?","ig"),n=null;if(e.test(t))do{if((n=e.exec(t))&&i.test(n[0]))return!0}while(n);return!1},this.setMessageText=function(){if(this.kind==a.RECEIVED){var t=_t("fraud_possible",null,"mails");if(this.checkFraud(this.messageText)&&e.indexOf(this.messageText)<0){var i=n.get("mail-fraud").html(t);this.$.find(".one-mail-head").after(i)}}return parseMailBB(deletePositionFixed(this.messageText))},this.checkSystemMsg=function(){this.isSpecial||e.indexOf(this.from)>-1&&(this.isSpecial=!0)},this.myFind=function(t){return this.$.children().children(t)},this.isNew=function(t){if(t){var e=n.get("mail-is-new").addClass(_l());this.$.prepend(e)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(107),a=i(51),s=i(0);e.default=class{constructor(){this.content="",this.TabsInstance=null,this.cards={[a.default.RECEIVED]:{name:this.tLang("receive_box"),initAction:()=>{_g("mail&page=1")}},[a.default.SENT]:{name:this.tLang("send_box"),initAction:()=>{_g("mail&action=showSent&page=1")}},[a.default.NEW_MAIL]:{name:this.tLang("new_message"),afterShowFn:()=>this.afterTabShow(a.default.NEW_MAIL)}},this.getEngine().lock.add("mails"),this.closeOtherWindows(),this.initWindow(),this.createTabs()}getWindow(){return this.wnd.$}createTabs(){const t={tabsEl:{navEl:this.wndEl.querySelector(".mails-window__tabs"),contentsEl:this.wndEl.querySelector(".mails-window__contents")}};this.TabsInstance=new n.default(this.cards,t)}manualSelectTab(t){this.TabsInstance&&this.TabsInstance.activateCard(t),this.afterTabShow(t)}afterTabShow(t){switch(this.currentTab=t,t){case a.default.RECEIVED:this.getEngine().mails.changedTab(a.default.RECEIVED);break;case a.default.SENT:this.getEngine().mails.changedTab(a.default.SENT);break;case a.default.NEW_MAIL:this.getEngine().mails.changedTab(a.default.NEW_MAIL)}}closeAll(){}initWindow(){this.content=s.get("mails-window"),this.getEngine().windowManager.add({content:this.content,title:this.tLang("title "),nameWindow:this.getEngine().windowsData.name.MAIL_BOX,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.setWndOnPeak(),this.wnd.center(),this.wndEl=this.wnd.$[0]}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mails"):""}closeOtherWindows(){const t=this.getEngine(),e=t.windowsData.windowCloseConfig.MAIL;t.windowCloseManager.callWindowCloseConfig(e)}close(){this.closeAll(),this.wnd.hide(),this.wnd.remove(),this.getEngine().lock.remove("mails"),this.getEngine().mails.close()}}},function(t,e){t.exports=function(){let t=null,e=null,i=null;const n=(t,e)=>{_g(`mail${i?"":"&action=showSent"}&page=${t}`,()=>{e()})};this.updatePages=(n,a)=>{t=n.number,e=n.total,i=a},this.getCurrentPage=()=>t,this.getMaxPage=()=>e,this.getNextPageAction=()=>{if(null===t||null===e||t===e)return;n(t+1,()=>{Engine.mails.stopDragBar()})}}},function(t,e,i){const n=i(16),a=i(0),s=i(51).default;t.exports=function(t){const e=()=>{const e=a.get("button").addClass("small green"),i=a.get("button").addClass("green small"),n=t.find(".send-mail-buttons"),s=t.find(".to-buttons"),r=t.find(".mail-to");h("clan",i),e.find(".label").text(_t("send",null,"mails")),e.click(()=>{o()}),i.click(()=>{r.val(_t("clanmsg_rcp_name",null,"mails"))}),n.append(e),s.append(i)},i=e=>{if(d(e))return void mAlert(_t("soulbound_item",null,"mails"));const i=e.id,n=Engine.items.createViewIcon(i,Engine.itemsViewData.MAIL_ITEM_TO_SEND_VIEW)[0],a=t.find(".send-item");n.css("position","relative"),n.css({top:"2px",left:"2px"}),n.data("item",e),n.click(()=>{c(i,n,a)}),n.contextmenu((function(t,i){const s={txt:_t("unbuy all"),f:function(){n.remove(),a.removeAttr("iid")}};e.createOptionMenu(getE(t,i),s,{move:!0,use:!0})})),a.empty(),Engine.itemsMovedManager.removeItemsByTarget(Engine.itemsMovedData.MAIL_ITEM_TO_SEND),a.removeAttr("iid").attr("iid",i),a.append(n),Engine.itemsMovedManager.addItem(e,Engine.itemsMovedData.MAIL_ITEM_TO_SEND,()=>{c(i,n,a)}),r()},r=e=>{e&&t.find(".mail-to").val(e),Engine.mails.getMailsWindow().manualSelectTab(s.NEW_MAIL)},o=()=>{const t=parsePrice(l(".money-amount",!0).replace(/ /gi,""));if(""!==t&&!checkParsePriceValueIsCorrect(t))return;const e="mail&action=send&recipient="+esc(l(".mail-to",!0))+"&gold="+t+"&item="+l(".send-item",!1,"iid")+"&msg="+esc(l(".mail-msg",!0));_g(e,t=>{isset(t.message)&&isset(t.message[3201002])&&p()})},l=(e,i,n)=>{const a=t.find(e);let s;return n&&(s=a.attr(n)),i&&(s=a.val()),""!=s&&s?s:""},c=(t,e,i)=>{e.remove(),i.removeAttr("iid"),Engine.itemsMovedManager.removeItem(t)},d=t=>isset(t._cachedStats.soulbound),h=(t,e)=>{const i=a.get("add-bck").addClass(t);e.append(i),e.tip(_t("clan_mail"))},u=()=>{const e=t.find(".mail-msg"),i=t.find(".how-mail-or-char"),n=e.val().length;n>1e3&&e.val(e.val().substring(0,1e3));const a=getCurrencyIcon("zl"),s=_t("chats_left %amount%",{"%amount%":n},"mails")+"<br>"+_t("send_cost")+a,r=$("<span>").html(s);i.html(r)},p=()=>{g(),t.find(".mail-to, .mail-msg, .money-amount").val("")},g=()=>{let e=t.find(".send-item"),i=e.attr("iid");i&&(e.removeAttr("iid").empty(),Engine.items.deleteViewIconIfExist(i,Engine.itemsViewData.MAIL_ITEM_TO_SEND_VIEW),Engine.itemsMovedManager.removeItem(i))},f=()=>{t.find(".mail-msg").keyup(()=>{u()})},m=()=>{t.find(".send-item").droppable({accept:".inventory-item",drop:(t,e)=>{e.draggable.css("opacity",""),i(e.draggable.data("item"))}})};this.countChars=u,this.setSendItem=i,this.show=r,this.clear=p,[[".to-label",_t("to",null,"mails")+" "],[".cost-label",_t("send_cost",null,"mails")],[".money-label",_t("gold_attachment",null,"mails")+" "],[".item-label",_t("item_attachment",null,"mails")],[".hr",_t("attachments",null,"mails")]].map(e=>{t.find(e[0]).html(e[1])}),setInputMask(t.find(".money-amount"),n.TYPE.NUMBER_WITH_KMG),e(),f(),m()}},function(t,e,i){var n=i(0),a=i(18);t.exports=function(){var t,e=this,i={},s=[];this.init=function(){this.initWindow(),this.initHeader(),this.initBottomPanel(),this.wnd.center(),Engine.lock.add("RecoveryItems")},this.initBottomPanel=function(){e.wnd.$.find(".info-label").html(_t("low_sl",null,"shop"));var t=n.get("button").addClass("small purple");t.find(".label").html(_t("buy_sl",null,"shop")),e.wnd.$.find(".buy-sl").append(t),t.click((function(t){t.stopPropagation(),Engine.draconiteShop||(Engine.draconiteShop=new a,Engine.draconiteShop.open())}))},this.update=function(t){t.length?this.createList(t):this.emptyList()},this.emptyList=function(){mAlert(_t("no_items_to_recover",null,"recover")),Engine.recoveryItems=!1},this.initWindow=function(){t=n.get("recovery-item"),$(".scroll-wrapper",t).addScrollBar({track:!0}),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.RECOVERY_ITEMS,nameRefInParent:"wnd",objParent:this,title:"Premium",startVH:60,cssVH:60,onclose:()=>{e.close()}}),this.wnd.center(),this.wnd.addToAlertLayer()},this.initHeader=function(){var t=this.wnd.$;t.find(".info-1").html(_t("item_recover_header")),t.find(".info-2").html(_t("item_recover_info2",null,"recover")),t.find(".text-1").html(_t("item_recover_info1",null,"recover"))},this.createList=function(t){for(var n=0;n<t.length;n+=2){var a=t[n],s=t[n+1];i[a]={ts:s,$:null}}Engine.items.fetch(Engine.itemsFetchData.NEW_RECOVERY_ITEM,e.newRecItem)},this.newRecItem=function(n){var a=$("<tr>"),r=n.id,o=i[r].ts;e.createClonItem(a,n),e.createNameTd(a,n.name),e.createInfoText(a,o),e.createConfirmButton(a,r,n.name),e.deleteCallback(n),i[r].$=a,s.push(a),s.length==lengthObject(i)&&(e.appendToWindow(),$(".scroll-wrapper",t).trigger("scrollTop"),e.addHeaderToTable(),e.scrollUpdate())},this.deleteCallback=function(t){t.on("delete",(function(){e.deleteRecItem(t.id)}))},this.addHeaderToTable=function(){for(var t=["item","name","destroy","action"],i=$("<tr>").addClass("table-header"),n=0;n<t.length;n++){var a=$("<td>").html(_t(t[n],null,"recover"));i.append(a)}e.wnd.$.find(".static-bar-table").prepend(i)},this.createNameTd=function(t,e){var i=$("<td>").addClass("centerText"),n=$("<span>").html(parseItemBB(e));i.append(n),t.append(i)},this.createInfoText=function(t,e){var i=$("<td>").addClass("centerText"),n=$("<span>"),a=calculateDiff(unix_time(),e),s=_t("item_destroyed_new %timeago%",{"%timeago%":a},"recover");n.addClass("when"),n.html(s),i.append(n),i.addClass("recoverInfo"),t.append(i)},this.createConfirmButton=function(t,e,i){var a=n.get("button").addClass("small"),s=$("<td>").addClass("recover-btn").append(a);t.append(s),a.addClass("green"),a.find(".label").text(_t("recover_label",null,"recover")),a.click((function(){var t={ik:"oimg",ip:"/draconite_small.gif",it:75,m:"yesno2",q:_t("alert_confirm",null,"recover")+"<br>"+parseItemBB(i),re:"recovery&item="+e};askAlert(t)}))},this.createClonItem=function(t,e){var a=Engine.items.createViewIcon(e.id,Engine.itemsViewData.RECOVER_VIEW)[0],s=i[e.id].ts,r=$("<td>").addClass("wrapper-to-slot"),o=n.get("item-slot");a.addClass("recoveryItem"),a.data("time",s),o.append(a),r.append(o),t.append(r),a.contextmenu((function(t,i){e.createOptionMenu(getE(t,i),!1,{canPreview:!0})}))},this.appendToWindow=function(){s.sort((function(t,e){let i=t.find(".item").data("time");return e.find(".item").data("time")-i}));let t=$("<table>").addClass("recovery-items-table");for(let e=0;e<s.length;e++)t.append(s[e]);e.wnd.$.find(".scroll-pane").append(t)},this.scrollUpdate=function(){$(".scroll-wrapper",t).trigger("update")},this.deleteRecItem=function(t){i[t].$.remove(),delete i[t]},this.close=function(){e.wnd.remove(),Engine.items.removeCallback(Engine.itemsFetchData.NEW_RECOVERY_ITEM),Engine.items.deleteMessItemsByLoc("r");for(let t in i)delete i[t];i=null,s=null,Engine.lock.remove("RecoveryItems"),Engine.recoveryItems=!1}}},function(t,e,i){var n=i(0),a=i(243),s=i(68);let r=i(17);t.exports=function(){var t,e,i=this,o=!1,l=r.KIND.FRIEND,c=[];this.init=function(){this.initWindow(),this.newCard(r.KIND.WANTED),this.newCard(r.KIND.ENEMY),this.newCard(r.KIND.FRIEND),this.createColumn(),this.createSortButton(),this.createsWantedButton()},this.initWindow=function(){t=n.get("friend-enemy-list"),Engine.windowManager.add({content:t,title:_t("society"),nameWindow:Engine.windowsData.name.SOCIETY_LIST,widget:Engine.widgetsData.name.COMMUNITY,objParent:this,nameRefInParent:"wnd",managePosition:{x:245,y:62},startVH:60,cssVH:60,onclose:()=>{i.close()}}),this.wnd.show(),this.wnd.addToAlertLayer(),this.wnd.updatePos()},this.createColumn=function(){e=n.get("column"),t.append(e),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.updateData=function(t,i){if(i==l){this.onClear(),this.bottomPanelVisible(i);for(var n=e,s=this.setHowRecordsOnPerson(i),d=t.length,h=0,u=null,p=0;p<d;p+=s){var g=t.slice(p,p+s),f=this.howSortButton(p,d,i,s);(u=new a).init(g,i,f);var m=isset(g[8])&&g[8].indexOf(r.STATE.ONLINE)>-1;!o&&m?c.unshift(u):c.push(u),h++}this.initPersons(n),this.setTitle(i),this.setAmount(i,h),this.setSortVisible(),this.scrollUpdate()}},this.setHowRecordsOnPerson=function(t){switch(t){case r.KIND.FRIEND:return 10;case r.KIND.ENEMY:return 6;case r.KIND.WANTED:return 9}},this.initPersons=function(t){for(var e in c)c[e].newElement(t)},this.setAmount=function(t,e){var i=_t(t+"amount %amount%",{"%amount%":e});this.wnd.$.find(".amound-value").html(i)},this.setTitle=function(t){var e;switch(t){case r.KIND.FRIEND:e=_t("friend");break;case r.KIND.ENEMY:e=_t("enemy");break;case r.KIND.WANTED:e=_t("wanted")}this.wnd.$.find(".header-title").html(e)},this.scrollUpdate=function(){$(".scroll-wrapper",e).trigger("update")},this.bottomPanelVisible=function(e){var i=t.find(".add-person"),a=t.find(".sort-wrapper"),s=t.find(".wanted-wrapper");if(this.wnd.$.find(".wanted-wrapper"),i.css("visibility","w"==e?"hidden":"initial"),a.css("display","w"==e?"none":"table-cell"),a.css("display","w"==e?"none":"table-cell"),s.css("display","w"==e?"table-cell":"none"),e!=r.KIND.WANTED){var o=[_t("enemyNick"),_t("friendNick")],l=n.get("button").addClass("add-btn small green"),c=e==r.KIND.FRIEND?"finvite":"eadd",d=e==r.KIND.FRIEND?1:0;i.attr("placeholder",o[d]),t.find(".add-wrapper").append(l),l.find(".label").text(_t("addPerson",!1,"buttons")),l.click((function(){_g("friends&a="+c+"&nick="+i.val().trim().split(" ").join("_"),(function(t){i.val("")}))}))}},this.removeAddPerson=function(){0!=lengthObject(e)&&(t.find(".add-btn").remove(),t.find(".add-person").val(""))},this.setSortVisible=function(){var e=t.find(".action-buttons"),i=t.find(".sort-buttons"),n=[["table-cell","none"],["none","table-cell"]],a=o?1:0;e.css("display",n[a][0]),i.css("display",n[a][1])},this.createSortButton=function(){var t=n.get("button").addClass("sort-btn small green");this.wnd.$.find(".sort-wrapper").append(t),t.find(".label").text(_t("sort",!1,"buttons")),t.click((function(){o=!o,_g("friends&a=show"),i.setSortVisible()}))},this.createsWantedButton=function(){var t=n.get("button").addClass("show-wanted small green");this.wnd.$.find(".wanted-wrapper").append(t),t.find(".label").text(_t("wantedList")),t.click((function(t){Engine.wantedController.getWantedList().toggleVisible(),t.stopPropagation()}))},this.onClear=function(){for(var t in c)c[t].$.remove(),delete c[t];this.removeAddPerson(),c=[]},this.howSortButton=function(t,e,i,n){return i==r.KIND.WANTED||10==e&&i==r.KIND.FRIEND||6==e&&i==r.KIND.ENEMY?null:0==t?["down"]:t+n==e?["up"]:0!=t&&t!=e?["down","up"]:void 0},this.close=function(){this.onClear(),this.wnd.remove(),Engine.society=!1},this.newCard=function(t){var e=n.get("card").addClass(t),a=this.wnd.$.find(".friend-enemy-cards");Engine.worldConfig.getWantedShow()||a.addClass("wanted-hide");var s=e.find(".label").html(_t(i.getAllName(t)));a.prepend(e),e.append(s),e.click((function(){i.setVisible(t)}))},this.getAllName=function(t){switch(t){case r.KIND.FRIEND:return"friend";case r.KIND.ENEMY:return"enemy";case r.KIND.WANTED:return"wanted"}},this.setVisible=function(t,n){var a=i.wnd.$.find(".card"),s=i.wnd.$.find("."+t);if(a.removeClass("active"),s.addClass("active"),o=!1,l=t,!n){if(l==r.KIND.WANTED)return i.getWantedPersons();$(".scroll-wrapper",e).trigger("scrollTop"),_g("friends&a=show")}},this.getWantedPersons=function(){_g("wanted&show=1",(function(t){Engine.wantedController||(Engine.wantedController=new s.WantedController,Engine.wantedController.updateList(t));var e=Engine.wantedController.getList(),n=[];for(var a in e){var o=e[a];n.push(o.id,o.nick,o.town,"3",o.x,o.y,o.lvl,o.prof,o.icon)}i.updateData(n,r.KIND.WANTED)}))},this.onResize=function(){i.wnd.updatePos()},this.getPersonById=function(t){for(var e=0;e<c.length;e++)if(c[e].id==t)return c[e];return null}}},function(t,e,i){var n=i(0);let a=i(17);t.exports=function(){var t=this;this.init=function(e,i,n){t.id=e[0],t.nick=e[1],t.kind=i,t.setImgLevelProf(e,i),t.setCityPosOnlineAgo(e),t.sortButton=n},this.setImgLevelProf=function(e,i){t.img=i==a.KIND.WANTED?e[8]:e[2],t.level=i==a.KIND.WANTED?e[6]:e[3],t.prof=i==a.KIND.WANTED?e[7]:e[4]},this.setCityPosOnlineAgo=function(e){t.kind==a.KIND.FRIEND&&(t.city=e[5],t.pos={x:e[6],y:e[7]},t.online=e[8],t.ago=parseInt(e[9])),t.kind==a.KIND.WANTED&&(t.city=e[2],t.pos={x:e[4],y:e[5]},t.online=a.STATE.ONLINE),t.kind==a.KIND.ENEMY&&(t.ago=parseInt(e[5]))},this.newElement=function(e){var i=n.get("one-person");e.find(".list").append(i),t.$=i,t.createImg(),t.createInfo(),t.createLoc(),t.createProfAndLevel(),t.createOnline(),t.createInviteButton(),t.createChatToButton(),t.createRemoveButton(),t.createSortButtons()},this.createImg=function(){var e=CFG.a_opath+t.img,i=t.$.find(".img-wrapper");createImgStyle(i,e)},this.createInfo=function(){var e=t.nick;t.$.find(".who").append(e)},this.createProfAndLevel=function(){t.$.find(".lvl").html(t.level+t.prof)},this.createOnline=function(){var e=t.$.find(".online-text");if(t.kind!=a.KIND.WANTED){if("offline"!=t.online&&t.online)t.online==a.STATE.ONLINE?e.addClass("green"):(t.online=a.STATE.ONLINE+", "+_t("unconscious",null,"default"),e.addClass("blue"));else if(t.kind==a.KIND.FRIEND)t.online=_t("offline_from %time%",{"%time%":calculateDiff(t.ago)},"default"),e.addClass("gray");else{var i=[{text:_t("active_sometime_ago",null,"default"),class:"blue"},{text:_t("active_fewdays_ago",null,"default"),class:"gray"},{text:_t("inactive_longtime",null,"default"),class:"gray"}];t.online=i[t.ago].text,e.addClass(i[t.ago].class)}t.online.length>22&&(e.tip(t.online,"t_static"),t.online=t.online.slice(0,22)+"..."),e.append(t.online)}},this.createLoc=function(){if(this.kind!=a.KIND.ENEMY){var e="("+t.pos.x+", "+t.pos.y+")",i=t.$.find(".location");t.$.find(".cords").html(e);var n=escapeHTML(t.city);n.length>35&&(i.tip(n,"t_static"),n=n.slice(0,35)+"..."),i.html(n)}},this.createChatToButton=function(){if("f"==t.kind){var e=n.get("button").addClass("small green"),i=n.get("add-bck").addClass("chat");e.append(i),e.click((function(){Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(t.nick)})),this.$.find(".action-buttons").append(e)}},this.createInviteButton=function(){if(t.kind==a.KIND.FRIEND){var e=n.get("button").addClass("small green"),i=n.get("add-bck").addClass("invite-friend");this.$.find(".action-buttons").append(e),e.append(i),e.click((function(){_g("party&a=inv&id="+t.id)}))}},this.createRemoveButton=function(){if("w"!=t.kind){var e=n.get("button").addClass("small"),i=t.$.find(".action-buttons"),a=n.get("add-bck").addClass("remove");e.append(a),i.append(e),e.click((function(){mAlert(_t("delete "+t.kind+" %person%",{"%person%":t.nick}),[{txt:_t("yes"),callback:function(){return _g("friends&a="+t.kind+"del&id="+t.id),!0}},{txt:_t("no"),callback:function(){return!0}}])}))}},this.createSortButtons=function(){if(this.sortButton)for(var e=0;e<t.sortButton.length;e++)t.createSortB(t.sortButton[e])},this.createWantedButton=function(){if(t.kind==a.KIND.WANTED){var e,i=[_t("hunt",null,"pklist"),_t("stop_hunt",null,"pklist")],s=t.$.find(".action-buttons"),r=n.get("button").addClass("small green wanted-state");Engine.wantedController.getWachList().indexOf(parseInt(t.id))>=0?(e=i[1],r.addClass("on-list")):(e=i[0],r.removeClass("on-list")),r.find(".label").html(e),s.append(r),r.click((function(){var e=Engine.wantedController.toggleWatch(parseInt(t.id));r.find(".label").html(i[e]),e&&Engine.wantedController.getWantedList().openPanel()}))}},this.createSortB=function(e){var i=n.get("button").addClass("small green"),a=t.$.find(".sort-buttons"),s=n.get("add-bck").addClass(e);i.append(s),i.append(s),a.append(i),i.click((function(){_g("friends&a="+t.kind+e+"&id="+t.id)}))}}},function(t,e,i){var n=i(0),a=i(9);const s=i(36);let r=i(27);i(48);t.exports=function(t){var e,i=null,o=this,l=null,c={};function d(t){var e=this;this.$=n.get("party-member"),this.isNew=!0,this.toRemove=!1,this.id=null,this.accountId=null,this.nick=null,this.icon=null,this.hp=[null,null],this.l=0,this.stasis=!1,this.stasisIncoming=!1,this.updateData=function(t,i,n,a,s,r,o,l,c){e.toRemove=!1,e.id=t,e.nick=i,e.icon=n,e.stasis=o,e.stasisIncoming=l,e.accountId=c,e.l=parseInt(r),e.hp=[a,s],e.$.addClass("other-party-id-"+t)}}this.getMemberFromHeroMapWithTheBigestLevel=()=>{let t=null,e=Engine.others.check();for(let i in c)e[i]&&(t?t.d.lvl<e[i].d.lvl&&(t=e[i]):e[i].d.lvl>Engine.hero.d.lvl&&(t=e[i]));return t},this.getLeaderId=function(){return i},this.setHId=function(t){e=isset(Engine.hero.d.id)?Engine.hero.d.id:t.h.id},this.getMembers=function(){return c},this.createActionsButtons=function(t){o.createKickOut(t),o.createDestroyGroup(t),o.createGiveLead(t)},this.createKickOut=function(t){var e=this.getLeaderId()==Engine.hero.d.id?_t("kick_out_from_party"):_t("leave_group"),i=n.get("kick-out-party").tip(e);$(".party-options",t.$).append(i),i.click((function(e){e.stopPropagation();o.getLeaderId()==Engine.hero.d.id?_t("kick_out_accept %name%",{"%name%":t.nick},"group"):_t("sure_leave_party");_g("party&a=rm&id="+t.id)}))},this.createGiveLead=function(t){var e=n.get("give-lead-party").tip(_t("give_leadership"));$(".party-options",t.$).append(e),e.click((function(e){e.stopPropagation();var i=_t("give_lead_accept %name%",{"%name%":t.nick},"group");mAlert(i,[{txt:_t("yes"),callback:function(){return _g("party&a=give&id="+t.id),!0}},{txt:_t("no"),callback:function(){return!0}}])}))},this.createDestroyGroup=function(t){var e=n.get("destroy-group-party").tip(_t("solve_group"));$(".party-options",t.$).append(e),e.click((function(t){t.stopPropagation();var e=_t("destroy_group_accept",null,"group");mAlert(e,[{txt:_t("yes"),callback:function(){return _g("party&a=disband"),!0}},{txt:_t("no"),callback:function(){return!0}}])}))},this.createCrown=function(t){if(t.l){if(!$(".crown",t.$).length){var e=n.get("crown-party");e.tip(_t("lider_group")),$(".crown-wrapper",t.$).append(e)}$(".crown-wrapper",t.$).css("display","block"),t.$.removeClass("enabled")}else $(".crown",t.$).remove(),$(".crown-wrapper",t.$).css("display","none"),t.$.addClass("enabled")},this.updateDisplay=function(t,e,i){t.isNew?(t.isNew=!1,o.createActionsButtons(t)):t.$.detach(),i.append(t.$),o.updateInfo(t,e),o.createCrown(t),o.updateHpBar(t)},this.setVisibleActionButton=function(t){var n=i==e,a=e==t.id&&!n||n&&t.id!=e?"block":"none",s=n?_t("kick_out_from_party"):_t("leave_group");t.$.find(".kick-out").css("display",a).tip(s),e==i?(t.$.find(".destroy-group").css("display","block"),e==t.id?t.$.find(".give-lead").css("display","none"):(t.$.find(".destroy-group").css("display","none"),t.$.find(".give-lead").css("display","block"))):(t.$.find(".destroy-group").css("display","none"),t.$.find(".give-lead").css("display","none"))},this.updateInfo=function(t,e){$(".nickname .nickname-text",t.$).html(t.nick),$(".nickname .nickname-text",t.$).tip(t.nick),$(".lvl",t.$).html("(255)"),t.stasis?t.$.addClass("stasis"):t.$.removeClass("stasis"),t.stasisIncoming?t.$.addClass("stasis-incoming"):t.$.removeClass("stasis-incoming"),t.id==Engine.hero.d.id&&t.$.addClass("yellow")},this.updateHpBar=function(t){if(t.hp){var e=t.hp[0]/t.hp[1]*100;e=e>0&&e<1?1:Math.ceil(e),$(".hp-label.hp-label-percent",t.$).text(e+"%");var i=round(t.hp[0],10)+" / "+round(t.hp[1],10);$(".hp-label.hp-label-real",t.$).text(i),$(".hp-bar",t.$).css({width:e/100*77})}},this.getIds=function(t){var e=[];for(var i in t)e.push(i);return e},this.updateData=function(t){var e={},n={},a=Engine.others.check(),s=[],r=l.$.find(".list");for(var u in c)c[u].toRemove=!0;for(var p in t){var g=t[p],f=parseInt(p),m=-1!==s.indexOf(f);isset(c[f])||(c[f]=new d(g.nick),a[f]&&(n[f]=a[f].d));var v=c[f];v.updateData(f,g.nick,g.icon,g.hp_cur,g.hp_max,g.commander?1:0,g.stasis?1:0,g.stasis_incoming_seconds?1:0,g.account),v.l?(i=parseInt(f),m||s.unshift(f)):m||s.push(f)}for(var E in c)c[E].toRemove&&(c[E].$.remove(),a[E]&&(e[E]=a[E].d),delete c[E]);for(var _=0;_<s.length;_++){var b=c[s[_]];o.actionOneOther(b),o.updateDisplay(b,_,r),o.setVisibleActionButton(b)}lengthObject(e)>0&&h(e),lengthObject(n)>0&&h(n)};const h=t=>{u(t),Engine.miniMapController.updateWindowMiniMapOthersPos(t)},u=t=>{let e=getEngine().others;for(let i in t){let t=e.getById(i);t?t.manageRefreshKind():errorReport("Party.js","refreshOthersKindFromParty","Other not exist",i)}};this.update=function(t){var e=o.getIds(c);0===lengthObject(c)&&this.open();var i=t.party.members,n=[];if(!Object.keys(t.party).length)return this.destroyParty(),n=o.getIds(c),void Engine.whoIsHere.comparePartyMembers(e,n);Engine.chatController.getChatChannelsAvailable().setAvailable(a.CHANNEL.GROUP,!0),o.updateData(i),t.party.partyexp&&o.setPercentAmount(t.party.partyexp),isset(t.party.partygrpkill)&&o.setPartyGrpKill(t.party.partygrpkill),n=o.getIds(c),l.$.find(".party").height(25*lengthObject(n)-25),Engine.whoIsHere.comparePartyMembers(e,n),this.updateAmountOnWidget()},this.actionOneOther=function(t){t.$.off("click"),t.$.off("contextmenu"),t.$.off("hover"),t.$.click((function(e){e.stopPropagation(),Engine.battle.getShow()?Engine.battle.clickCharacter(t.id,{type:"focus",preventDefault:function(){}}):Engine.hero.checkPlayerIdIsHeroId(t.id)||Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(t.nick)})),t.$.hover(()=>{this.setHoverSelector(t.id,!0)},()=>{this.setHoverSelector(t.id,!1)}),t.$.on("contextmenu",(function(e){e.preventDefault(),getEngine().battle.getShow()?(e.clientX-=100,getEngine().battle.clickCharacter(t.id,e),l.correctPositionMenuToRightEdgeOfWnd()):(getEngine().others.createOtherContextMenu(e,{nick:t.nick,charId:t.id,accountId:t.accountId},[s.SHOW_EQ,s.INVITE_TO_ENEMIES,s.INVITE_TO_PARTY]),l.correctPositionMenuToRightEdgeOfWnd(e))}))},this.setHoverSelector=function(t,e){Engine.battle.getShow()&&Engine.battle.$.find(".other-id-battle-"+t).find(".hover-selector").css("display",e?"block":"none")},this.toggle=function(){l.isShow()?(l.hide(),r.setShowWindow(!1,Engine.windowsData.name.PARTY),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.PARTY,!1)):this.open()},this.setPercentAmount=function(t){l.$.find(".exp-percent").html(t+"%")},this.setPartyGrpKill=function(t){var e=t?_t("group_kill_exp_count"):_t("group_kill_exp_nocount"),i=t?"count":"no-count";l.$.find(".exp-q").removeClass("count no-count"),l.$.find(".exp-q").addClass(i).tip(e)},this.open=function(){l.show(),r.setShowWindow(!0,Engine.windowsData.name.PARTY),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.PARTY,!0)},this.init=function(t){Engine.widgetManager.widgets.toggleWidgetDisplay(Engine.widgetsData.name.PARTY,!0),this.updateAmountOnWidget(),o.setHId(t),o.initWnd(),r.getShowWindow(Engine.windowsData.name.PARTY)&&r.setShowWindow(!0,Engine.windowsData.name.PARTY)},this.initWnd=function(){(l=Engine.windowManager.add({content:n.get("party"),title:_t("group-title",null,"group"),nameWindow:Engine.windowsData.name.PARTY,widget:Engine.widgetsData.name.PARTY,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:"200",y:"200"},onclose:()=>{o.toggle()}})).hide(),l.addToAlertLayer(),l.updatePos(),r.getShowWindow(Engine.windowsData.name.PARTY)&&l.show()},this.onResize=function(){l.updatePos()},this.destroyParty=function(){r.removeShowWindow(Engine.windowsData.name.PARTY);var t={},e=Engine.others.check();for(var i in c)c[i].$.remove(),e[i]&&(t[i]=e[i].d),delete c[i];h(t),Engine.widgetManager.widgets.toggleWidgetDisplay(Engine.widgetsData.name.PARTY,!1),Engine.chatController.getChatChannelsAvailable().setAvailable(a.CHANNEL.GROUP,!1),Engine.chatController.getChatChannelCardWrapper().showNotReadElement(a.CHANNEL.GROUP,!1),Engine.party=!1,l.remove()},this.countPartyPlayers=()=>Object.keys(this.getMembers()).length,this.updateAmountOnWidget=()=>{let t=this.countPartyPlayers();Engine.widgetManager.widgets.updateAmount(Engine.widgetsData.name.PARTY,t),l&&l.$.find(".players-number .num").text(t)},this.onInterfaceReady=function(){this.updateAmountOnWidget(),Engine.widgetManager.widgets.toggleWidgetDisplay(Engine.widgetsData.name.PARTY,!0),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.PARTY,this.isActive())},this.get$Wnd=function(){return l.$},this.isActive=()=>"block"==l.$.css("display")}},function(t,e,i){var n=i(0);const a=i(16),s=i(50),{checkPersonalItems:r}=i(2);t.exports=function(t){var e=this,i={},o=!1,l=!1,c=0,d=0;var h={h:0,o:0};let u=null;var p,g=!1;let f=.1;const m=t=>{u&&clearTimeout(u);let e=this.$.find(".accept-trade");v()||(e.addClass("inactive no-hover"),e.tip(_t("change_money_or_items"))),u=setTimeout(()=>{e.removeClass("inactive no-hover"),e.tip(""),e.tipHide()},1e3*t)},v=()=>this.$.find(".accept-trade").hasClass("inactive no-hover");this.update=function(t){t.close&&1==t.close&&this.closeTrade(t),isset(t.acceptLockSeconds)&&m(t.acceptLockSeconds),isset(t.gainedCreditsRatio)&&(f=t.gainedCreditsRatio),isset(t.mygold)&&(this.$.find(".hero-prize").val(0==t.mygold?"":round(t.mygold,3)),this.$.find(".hero-prize").attr("data-prize",t.mygold),this.$.find(".hero-prize").tip(formNumberToNumbersGroup(t.mygold)),this.acceptBtnActive());const e=100*(1-f);isset(t.credits)&&(this.$.find(".other-credits").text(t.credits),this.$.find(".other-credits").attr("other-credits",t.credits),this.$.find(".other-credits").tip(this.tLang("credits-tip",{"%val%":e}))),isset(t.mycredits)&&(this.$.find(".hero-credits").text(t.mycredits),this.$.find(".hero-credits").attr("data-credits",t.mycredits),this.$.find(".hero-credits").tip(this.tLang("credits-tip",{"%val%":e}))),isset(t.gold)&&(this.$.find(".other-prize").html(round(t.gold,3)),this.$.find(".other-prize").attr("data-prize",t.gold),this.$.find(".other-prize").tip(formNumberToNumbersGroup(t.gold))),this.tradeState(t.myaccept,t.accept),this.buttonState(t.myaccept,t.accept)},this.init=function(){this.closeOtherWindows(),Engine.lock.add("trade"),this.$=n.get("trade-window"),Engine.interface.getBottomPositioner().append(this.$),this.createTradeDialog(),this.createRightSide(),this.initButton(),this.initDropable("show","s"),this.initDropable("sell","t"),this.initGoldChange(),this.createButAcceptGold()},this.createTradeDialog=function(){var t=this.$.find(".tip"),i=["watch","show","buy","sell","gold-label","credits-label"];e.getDelayedNick(),t.tip(this.tLang("how_trade_info"),"t_static");for(var n=0;n<i.length;n++)this.setLabel(i[n])},this.getDelayedNick=function(){var i=setInterval((function(){var n=Engine.others.getById(t);if(n){var a=_t("trade_with %nick%",{"%nick%":n.nick},"trade");e.$.find("header .h_content").html(a),clearInterval(i)}}),100)},this.createRightSide=function(){for(var t=["other_decision","hero_decision"],e=0;e<t.length;e++)this.setLabel(t[e])},this.setLabel=function(t){var e=this.tLang(t);this.$.find("."+t).html(e)},this.initButton=function(){this.addButton("accept","green",this.tradeAccept),this.addButton("cancel",!1,(function(){_g("trade&a=cancel")}));var t=this.$.find(".cancel-trade").find(".label");t.html(t.html()+" [Esc]"),Engine.items.fetch(Engine.itemsFetchData.NEW_TRADE_ITEM_T,e.newTradeItem),Engine.items.fetch(Engine.itemsFetchData.NEW_TRADE_ITEM_S,e.newTradeItem)},this.initDropable=function(t,e){this.$.find(".hero-"+t+"-item").droppable({accept:".item",drop:function(t,i){t.stopPropagation();var n=i.draggable.data("item");_g("trade&a=add&"+e+"id="+n.id)}})},this.initGoldChange=function(){var t=this.$.find(".hero-prize"),i=t.data("value");setInputMask(t,a.TYPE.NUMBER_WITH_KMG),t.focus((function(){p=e.checkPrize(t.val()),$(this).keyup(e.acceptGold)})).focusout((function(){var t;$(this).off("keydown",e.acceptGold),e.$.find(".acceptMoney").is(":hover")||(0==p?(t="",e.acceptBtnDeactive()):(t=p,e.acceptBtnActive()),$(this).val(t))})).tip(i,"t_static")},this.acceptBtnActive=function(){this.$.find(".acceptMoney").addClass("active")},this.acceptBtnDeactive=function(){this.$.find(".acceptMoney").removeClass("active")},this.createButAcceptGold=function(){var t=e.tLang("press_enter"),i=n.get("add-bck"),a=n.get("button").addClass("green").tip(t);this.$.find(".info").append(a),a.append(i),a.click((function(){e.acceptGold()})).addClass("small acceptMoney")},this.acceptGold=function(t){var i=e.checkPrize(e.$.find(".hero-prize").val()),n=0==i?0:parsePrice(i);if(checkParsePriceValueIsCorrect(n)){var a,s="trade&a=gold&val="+n;t&&(a=t.keyCode),t&&(p!=i?e.acceptBtnDeactive():e.acceptBtnActive()),t&&13!=a||_g(s,(function(){p=i,e.$.find(".hero-prize").blur()}))}},this.tradeAccept=function(){if(!v())if(o)_g("trade&a=noaccept");else{var t=e.checkPrize(parsePrice(e.$.find(".other-prize").attr("data-prize"))),n=e.checkPrize(parsePrice(e.$.find(".hero-prize").attr("data-prize"))),a=[],s=[];for(var r in i){var l=i[r];"sell"===l.kind&&s.push(r),"buy"===l.kind&&a.push(r)}_g("trade&a=accept&buy="+t+e.formTab(a)+"&sell="+n+e.formTab(s))}},this.formTab=function(t){var e=t.toString();return""!=e&&(e=","+e),e},this.addButton=function(t,e,i){var a=n.get("button").addClass(e);this.$.find(".buttons").append(a),a.find(".label").text(_t(t,null,"trade")),a.click((function(){i()})).addClass(t+"-trade")},this.buttonState=function(t,e){var i=t?"refuse":"accept";this.$.find(".accept-trade").find(".label").text(this.tLang(i)),this.decision("hero",t),this.decision("other",e)},this.decision=function(t,e){var i=this.$.find("."+t+"-result"),n=e?"accept":"refuse";i.html(this.tLang(t+"-"+n)),e?i.addClass("accept"):i.removeClass("accept"),"hero"==t?o=e:l=e},this.hide=function(){Engine.items.removeCallback(Engine.itemsFetchData.NEW_TRADE_ITEM_S),Engine.items.removeCallback(Engine.itemsFetchData.NEW_TRADE_ITEM_T),e.refreshLoc(),i=null,Engine.trade=!1,Engine.lock.remove("trade"),this.$.remove()},this.tradeState=function(t,e){(t||e)&&(this.countTItem(),this.setTAmount(),this.setGold()),(!t&&o||!e&&l)&&this.countTItem()},this.countTItem=function(){for(var t in c=0,i)"t"==i[t].data[t].loc&&c++},this.setTAmount=function(){d||(d=c)},this.setGold=function(){h.h||h.o||(h.h=e.checkPrize(parsePrice(e.$.find(".hero-prize").val())),h.o=parsePrice(e.$.find(".other-prize").html()))},this.closeTrade=function(t){g=1==t.myaccept&&1==t.accept,this.hide()},this.checkPrize=function(t){return""==t?0:t},this.theLowestSlot=function(t){for(var e=0;e<10;e++){var n=!1;for(var a in i)if(i[a].kind==t&&i[a].slot==e){n=!0;break}if(!n)return e}},this.setSellItem=function(t){(new s.default).addCondition(()=>r(t),_t("personal-item-confirm2")).processConditions(()=>{_g("trade&a=add&tid="+t.id)})},this.setShowItem=function(t){_g("trade&a=add&sid="+t.id)},this.kindOfItem=function(t,e){return"hero"==t&&"s"==e?"show":"other"==t&&"s"==e?"watch":"hero"==t&&"t"==e?"sell":"other"==t&&"t"==e?"buy":void 0},this.createData=function(t){var e={cl:t.cl,icon:t.icon,loc:t.loc,name:t.name,own:t.own,pr:t.pr,prc:t.prc,st:t.st,stat:t.stat,x:t.x,y:t.y,unbindCost:t.unbindCost,enhancementPoints:t.enhancementPoints,salvageItems:t.salvageItems},i={};return i[t.id]=e,i},this.newTradeItem=function(t){var n=Engine.hero.d.id,a=t.loc,s="t"===t.loc?Engine.itemsViewData.TRADE_ITEM_T_VIEW:Engine.itemsViewData.TRADE_ITEM_S_VIEW,r=Engine.items.createViewIcon(t.id,s)[0],o=t.own==n?"hero":"other",l="t"==a?35.4:70.8,c=e.kindOfItem(o,a),d=e.theLowestSlot(c),h=2,u=e.createData(t);i[t.id]={},i[t.id].$=r,i[t.id].slot=d,i[t.id].kind=c,i[t.id].data=u,d>4&&(h=38,d-=5),r.css({left:1+d*l,top:h}),r.css("cursor",`url(../img/gui/cursor/5n.png?v=${__build.version}), auto`),e.$.find("."+o+"-"+c+"-item").append(r),e.tradeItemClick(t,o,r)},this.tradeItemClick=function(t,i,n){"hero"==i?e.yourItemEvents(t,n):e.otherItemEvents(t,n)},this.yourItemEvents=function(t,i){i.click((function(){e.actionAfterClick(t)})),i.contextmenu((function(i,n){e.moveEvent(getE(i,n),t)}))},this.otherItemEvents=function(t,e){e.contextmenu((function(e,i){t.createOptionMenu(getE(e,i),!1)}))},this.moveEvent=function(t,i){var n={txt:_t("move",null,"item"),f:function(){e.actionAfterClick(i)}};i.createOptionMenu(t,n)},this.actionAfterClick=function(t){var i="t"==t.loc?"tid":"sid";_g("trade&a=del&"+i+"="+t.id,(function(){e.removeTradeItem(t.id)}))},this.refreshLoc=function(){for(var t in i){var n=i[t].data[t];e.refreshOneLoc(n,"s",t),g||e.refreshOneLoc(n,"t",t)}},this.refreshOneLoc=function(t,e,n){t.loc==e&&(t.own!=Engine.hero.d.id?Engine.items.deleteItem(n):(t.loc=Engine.itemsFetchData.NEW_EQUIP_ITEM.loc,Engine.items.updateDATA(i[n].data)))},this.removeTradeItem=function(t){isset(i[t])&&(i[t].$.remove(),delete i[t])},this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.TRADE;Engine.windowCloseManager.callWindowCloseConfig(t)},this.tLang=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return _t(t,e,"trade")}}},function(t,e,i){var n=i(0);t.exports=function(){var t=this,e=null;this.tLang=function(t){return _t(t,null,"ingame_register")},this.createButtons=function(){let e=n.get("button").addClass("green"),i=n.get("button").addClass("green"),a=this.wnd.$,s=a.find(".one-checkbox").find(".checkbox");a.find(".save-button").append(e),a.find(".collect-button").append(i),e.find(".label").html(t.tLang("save_form")),i.find(".label").html(t.tLang("collect_form")),e.click(this.save),i.click(this.collect),s.click((function(){$(this).toggleClass("active")}))},this.createSection=function(t,e){let i=n.get("registration-section-wrapper").addClass("registration-background "+e),a=n.get("reward-box").attr("id","reward"+(t-1)),s=this.createInputSections(t);i.find(".inputs-column").append(s),i.find(".reward-column").append(a),this.wnd.$.find(".main-content").append(i)},this.createInputSections=function(t){let e=n.get("registration-inputs-wrapper");switch(t){case 1:e.append(this.createInputRow("r_login","Login:")),e.append(this.createInputRow("r_pass","Password:","password")),e.append(this.createInputRow("r_repeat_pass","Repeat Password:","password"));break;case 2:e.append(this.createInputRow("r_email","Email:")),e.append(this.createInputRow("r_repeat_email","Repeat Email:"));break;case 3:e.append(this.createCheckboxRow())}return e},this.createCheckboxRow=function(){let t=n.get("register-row-checkbox").addClass("row");t.find(".text").html('I consent to receiving commercial information via electronic communication services. <a target="_blank" rel="noopener noreferrer" href="https://margonem.com/art/view,2">Read more</a>');var e=n.get("one-checkbox");return t.append(e),t},this.createInputRow=function(t,e,i){var a=n.get("register-row").removeClass("register-row").addClass("row "+t);return a.find("label").attr("for",t).html(e),a.find("input").attr("id",t),i&&a.find("input").attr("type",i),a},this.collect=function(){_g("registernoob&collect=1",t=>{isset(t.msg)||message("Fill the fields and save changes before claiming your reward.")})},this.save=function(){var i={h2:getCookie("hs3"),user_id:getCookie("user_id")};if(!e.login){let e=$("#r_pass").val();if(e!=$("#r_repeat_pass").val())return void message("Your password and repeat password do not match");i.login=$("#r_login").val(),i.pass=e,i.pass2=e,t.sendAjax("regcomp",i)}if(e.login&&!e.email){let e=$("#r_email").val(),n=$("#r_repeat_email").val();if(e!=n)return void message("Your email and repeat email do not match");i.newmail=e,i.newmail2=n,t.sendAjax("chmail",i)}if(e.login&&e.email){if(!t.wnd.$.find(".one-checkbox").find(".active").length)return void message("You don't agree to receiving commercial information");i.commercialInformationAgreement=1,t.sendAjax("comagr",i)}},this.sendAjax=function(t,e){var i="dev"===Engine.worldConfig.getWorldName()?"https://vvv.margonem.com/ajax/":"https://margonem.com/ajax/";$.ajax({url:i+t,type:"post",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:e,success:function(t){message(t.msg),_g("registernoob")}})},this.addItem=function(t){var e=Engine.items.createViewIcon(t.id,Engine.itemsViewData.REGISTRATION_ITEM_VIEW)[0];Engine.interface.get$alertsLayer().find("#reward"+t.y+" .item"+t.x).html(e)},this.update=function(i){if(i.login>1&&i.email>1&&i.marketing_consent>1)return t.close(),Engine.interface.get$interfaceLayer().find(".bm-register").css("display","none"),void message("COMPLETED REGISTRATION!");e=i,t.updateSections(i),t.updateAvailableItems("#reward0",i.login),t.updateAvailableItems("#reward1",i.email),t.updateAvailableItems("#reward2",i.marketing_consent)},this.updateSections=function(e){let i=t.wnd.$;return i.find(".registration-section-wrapper").removeClass("finish"),i.find(".registration-section-wrapper").find(".disabled").removeClass("disabled"),i.find(".registration-section-wrapper").find(".disabled-lock").remove(),e.login||e.email?e.login&&!e.email?(i.find(".registration-section-wrapper.login").addClass("finish"),t.addDisabledToSection(".registration-section-wrapper.consent"),void this.updateLoginSection(e.accLogin)):e.login&&e.email&&!e.marketing_consent?(i.find(".registration-section-wrapper.login").addClass("finish"),i.find(".registration-section-wrapper.email").addClass("finish"),this.updateLoginSection(e.accLogin),void this.updateMailSection(e.accEmail)):void(e.marketing_consent&&(this.updateLoginSection(e.accLogin),this.updateMailSection(e.accEmail),i.find(".registration-section-wrapper.login").addClass("finish"),i.find(".registration-section-wrapper.email").addClass("finish"),i.find(".registration-section-wrapper.consent").addClass("finish"))):(t.addDisabledToSection(".registration-section-wrapper.email"),void t.addDisabledToSection(".registration-section-wrapper.consent"))},this.addDisabledToSection=function(e){let i=t.wnd.$.find(e);i.children().addClass("disabled"),i.append($("<div>").addClass("disabled-lock"))},this.updateAvailableItems=function(t,e){let i=$(t).removeClass("unavailable");switch(e){case 0:i.addClass("unavailable");break;case 1:break;case 2:i.addClass("collected");break;default:console.error("[Registration.js, updateAvailableItems] BUUUUG! BAD ITEMS STATE")}},this.updateLoginSection=function(e){t.wnd.$.find(".r_login").find(".text").html(e),t.wnd.$.find(".r_pass").find(".text").html("****"),t.wnd.$.find(".r_repeat_pass").find(".text").html("****")},this.updateMailSection=function(e){t.wnd.$.find(".r_email").find(".text").html(e),t.wnd.$.find(".r_repeat_email").find(".text").html(e)},this.close=function(){t.wnd.remove(),Engine.lock.remove("reg"),Engine.registration=!1},this.init=function(){this.initWindow(),this.initSections(),this.createButtons(),this.wnd.center(),this.initFetch(),Engine.lock.add("reg")},this.initSections=function(){this.createSection(1,"login"),this.createSection(2,"email"),this.createSection(3,"consent")},this.initWindow=function(){Engine.windowManager.add({content:n.get("registration"),nameWindow:Engine.windowsData.name.REGISTRATION,nameRefInParent:"wnd",objParent:t,title:t.tLang("reg_header"),onclose:()=>{t.close()}}),this.wnd.addToAlertLayer(),this.wnd.$.find(".main-header").html(t.tLang("complete_registration")),this.wnd.$.find(".reward-header").html("rewards"),this.wnd.$.find(".short-info").html("You're playing on temporary account that will be lost after you log out. if you enjoy the game, why not create a permanent account?")},this.initFetch=function(){Engine.items.fetch(Engine.itemsFetchData.NEW_REGISTRATION_ITEM,t.addItem)}}},function(t,e,i){var n=i(0);let a=i(14);var s=i(38);const r=i(16),{CL:o}=i(15);t.exports=function(t){var e,i,l,c,d,h=this,u=0,p={},g=0,f=0,m=!1,v=!1;let E=!0;var _=[],b=[],w=[],C=[],T=[];let y=null;var I={name:null,bind:null,prof:null,type:null,kstat:null,vstat:null,additionalParam:null},A=[{name:"stats",filter:[null,null]},{name:"fullheal",filter:["fullheal",null]},{name:"leczy",filter:["leczy",null]},{name:"perheal",filter:["perheal",null]},{name:"action_nloc",filter:["action","nloc"]},{name:"summonparty",filter:["summonparty",null]},{name:"action_flee",filter:["action","flee"]},{name:"action_mail",filter:["action","mail"]},{name:"action_auction",filter:["action","auction"]},{name:"action_shop",filter:["action","shop"]},{name:"action_deposit",filter:["action","deposit"]},{name:"action_clandeposit",filter:["action","clandeposit"]},{name:"revive",filter:["revive",null]},{name:"action_fatigue",filter:["action","fatigue"]},{name:"emo",filter:["emo",null]},{name:"expadd",filter:["expadd",null]},{name:"expired",filter:["expires",null,!0]},{name:"expires",filter:["expires",null,!1]},{name:"nodesc",filter:["nodesc",null]}],k={appendTo:"body",helper:"clone",delay:100,distance:6,cursorAt:{top:16,left:16},containment:$("body"),zIndex:20,start:function(t,e){changeViewOfHelper(e.helper,$(this).data().item.id)}};let S=!1,O="";this.setVisibleAttrToGrid=t=>{y.attr("card-visible",t)};const M=()=>{this.wnd.$.find(".grid-wrapper").append(y)};this.init=function(){this.closeOtherWindows(),y=n.get("depo-item-grid"),h.initWindow(),h.initItem(),h.initDropGrid(),h.addGrid(!0),h.initMenusBindArray(),t||h.initDeleteDepoBut(),t||h.initPaymentBut(),h.initUpgradeBut(),t||h.initBuyDepoBut(),h.initButtons(),h.createSearchPanel(),h.setVisibleAttrToGrid(0),t?(h.wnd.$.find(".gold-action").css("display","none"),h.wnd.$.find(".manage-money-wrapper").css("display","none"),h.wnd.$.find(".find-and-manage-money-section").find(".left-part").css("display","block"),h.wnd.$.find(".find-and-manage-money-section").find(".right-part").css("display","none"),Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.DEPO_CLAN)):Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.DEPO),h.wnd.center(),Engine.lock.add("depo")},this.resetPayments=function(){l={gold:null,credits:null},c={gold:null,credits:null},d={gold:null,credits:null}},this.escapeDia=function(t){return t.replace(/ą/g,"a").replace(/ć/g,"c").replace(/ę/g,"e").replace(/ł/g,"l").replace(/ń/g,"n").replace(/ó/g,"o").replace(/ś/g,"s").replace(/ż/g,"z").replace(/ź/g,"z")},this.createSearchInput=function(){var t=h.wnd.$.find(".search");t.attr("placeholder",_t("search")).keyup(h.txtSearch).change(h.txtSearch),h.wnd.$.find(".search-x").on("click",(function(){t.val("").blur().trigger("keyup")}))},this.txtSearch=function(){var t=h.wnd.$.find(".search").val().toLowerCase();""==t?t=null:(t=h.escapeDia(t).replace(/[^a-z0-9 ]/gi,"").split(" ").join(".*"),t=new RegExp(t)),t!=I.name&&(m=!0,I.name=t),h.searchDepoItem()},this.searchDepoItem=function(){if(m&&(m=!1,h.hideBacklight(),null!==I.name||null!==I.bind||null!==I.prof||null!==I.type||null!==I.kstat))for(var t in p)for(var e in p[t]){if(null==p[t][e])continue;let r=p[t][e];for(let t in r){var i=r[t].itemData,n=r[t].$itemClone,a=i.x%14,s=(i.x-a)/14;h.isMatch(i)?h.backlightCard(s):h.backlightSlot(n)}}},this.getDepoItemTable=function(){return p},this.backlightCard=function(t){$(".depo .card").eq(t).css({color:"rgb(255, 70, 30)"})},this.backlightSlot=function(t,e,i){t.find(".depo_backlight").css("display","block")},this.hideBacklight=function(){h.wnd.$.find(".depo_backlight").css("display","none"),h.wnd.$.find(".card").css({color:""})},this.createSearchPanel=function(){var t=h.wnd.$.find(".first"),e=h.wnd.$.find(".second");h.createSearchInput(),h.createMenu(_,"bind",t),h.createMenu(b,"prof",t),h.createMenu(w,"type",e),h.createMenu(C,"stat",e)},this.createMenu=function(t,e,i){var a=n.get("depo-filter");i.append(a);var s=a.find(".menu");s.addClass(e),s.createMenu(t,!0,(function(t){h.setValueInLastSearch(t,e),h.searchDepoItem()}))},this.prepareArrayToMenu=function(t,e,i){for(var n=0;n<i.length;n+=2){var a={text:_t(i[n],null,e),val:i[n+1]};t.push(a)}},this.setValueInLastSearch=function(t,e){void 0===t&&(t=null);if(["bind","prof","type"].lastIndexOf(e)>-1)0==t&&(t=null),t!=I[e]&&(m=!0,I[e]=t);else{var i=A[t].filter;(i[0]!=I.kstat||i[1]!=I.vstat||isset(i[2])&&I.additionalParam!==i[2])&&(m=!0,I.kstat=i[0],I.vstat=i[1],I.additionalParam=isset(i[2])?i[2]:null)}},this.initMenusBindArray=function(){h.prepareArrayToMenu(_,"depo_search",["bind_state",0,"unbound",1,"bound",2,"permbound",3]),h.prepareArrayToMenu(b,"eq_prof",["prof",0,"prof_warrior",a.WARRIOR,"prof_paladyn",a.PALADIN,"prof_mag",a.MAGE,"prof_hunter",a.HUNTER,"prof_bladedancer",a.BLADE_DANCER,"prof_tracker",a.TRACKER]),h.prepareArrayToMenu(w,"eq_cl",["type",0,"cl_onehanded",o.ONE_HAND_WEAPON,"cl_twohanded",o.TWO_HAND_WEAPON,"cl_bastard",o.ONE_AND_HALF_HAND_WEAPON,"cl_distance",o.DISTANCE_WEAPON,"cl_helpers",o.HELP_WEAPON,"cl_wands",o.WAND_WEAPON,"cl_staffs",o.ORB_WEAPON,"cl_armor",o.ARMOR,"cl_helmets",o.HELMET,"cl_boots",o.BOOTS,"cl_gloves",o.GLOVES,"cl_rings",o.RING,"cl_neclaces",o.NECKLACE,"cl_shield",o.SHIELD,"cl_neutral",o.NEUTRAL,"cl_usable",o.CONSUME,"cl_keys",o.KEYS,"cl_quests",o.QUEST,"cl_arrows",o.QUIVER,"cl_talisman",o.TALISMAN,"cl_books",o.BOOK,"cl_bags",o.BAG,"cl_bless",o.BLESS,"cl_improve",o.UPGRADE,"cl_coinage",o.COINAGE,"cl_outfits",o.OUTFITS,"cl_pets",o.PETS,"cl_teleports",o.TELEPORTS,"cl_gear",[o.ARMOR,o.HELMET,o.BOOTS,o.GLOVES,o.SHIELD],"cl_weapons",[o.ONE_HAND_WEAPON,o.TWO_HAND_WEAPON,o.ONE_AND_HALF_HAND_WEAPON,o.DISTANCE_WEAPON,o.HELP_WEAPON,o.WAND_WEAPON,o.ORB_WEAPON,o.QUIVER],"cl_jewellery",[o.RING,o.NECKLACE]]);var t=[],e=0;for(var i in A)t=t.concat([A[i].name,e]),e++;h.prepareArrayToMenu(C,"depo_search",t)},this.checkName=function(t,e){return null!==e&&e.test(h.escapeDia(t))},this.isMatch=function(t){if(null!==I.bind){var e=isset(t._cachedStats.soulbound),i=isset(t._cachedStats.permbound),n=1==I.bind&&(e||i),a=2==I.bind&&(!e||i),s=3==I.bind&&!i;if(n||a||s)return!1}if(null!==I.type){if(!I.type.split(",").map(Number).includes(t.cl))return!1}if(null!==I.name&&!h.checkName(t.name.toLowerCase(),I.name))return!1;if(null!==I.prof&&isset(t._cachedStats.reqp)&&-1==t._cachedStats.reqp.indexOf(I.prof))return!1;if(null!==I.kstat){let e=I.kstat.split("|"),i=!1;for(let n=0;n<e.length;n++)isset(t._cachedStats[e[n]])&&(i=!0,"expires"===e[n]&&(i=I.additionalParam?t.checkExpires():!t.checkExpires()));if(!i)return!1}return null===I.kstat||null===I.vstat||t._cachedStats[I.kstat].split(",")[0]==I.vstat},this.getUpgradePrice=function(){var t=c.gold,e=c.credits,i={};return t&&(i.gold=t),e&&(i.credits=e),i},this.updatePayments=function(t,e,i){if(this.resetPayments(),t)var n=t.gold,a=t.credits;if(e)var s=e.gold,r=e.credits;if(i)var o=i.gold,h=i.credits;n&&(l.gold=n),a&&(l.credits=a),s&&(c.gold=s),r&&(c.credits=r),o&&(d.gold=o),h&&(d.credits=h)},this.manageMultiZeroZero=t=>{if(t){message(_t("depoMultiZeroZero"));for(let t in p[0][0])p[0][0][t].$itemClone.addClass("doubled")}},this.updateData=function(e){for(S=e.is_debt_over_limit,O=e.next_expiration,this.manageMultiZeroZero(e.has_multi_items_at_zero_zero);T.length<e.size;)T.push(0);if(v=0===e.size,t){if(isset(e.myrights)&&this.updateRight(e.myrights))return}else this.updateGold(e.gold);this.updatePayments(e.cost_prolong,e.cost_upgrade,e.cost_create),this.updateAvailable(e.size,e.expire),this.updateUpgradeBut(e.size,e.msize,e.expire),this.setExpiredOverlay(e.size,e.expire),t||this.updatePaymentBut(e.size,e.expire),t||this.updateDeleteBut(e.size,e.expire),t||this.updateBuyBut(e.size,e.expire),this.updateCards(e.size,e.msize,e.expire),this.setSizeCardContent(),this.setVisibleArrows(),this.initMoveCardScroll();const i=this.wnd.$.find(".price");i.val(""),setInputMask(i,r.TYPE.NUMBER_WITH_KMG),!0},this.setSizeCardContent=function(){var t=h.wnd.$.find(".actions-bar-content").width();h.wnd.$.find(".bottom-section").width()},this.initMoveCardScroll=function(){h.wnd.$.find(".left-arrow").click((function(){h.changePosCardsOverflow(!1)})),h.wnd.$.find(".right-arrow").click((function(){h.changePosCardsOverflow(!0)}))},this.changePosCardsOverflow=function(t){var e,i,n=h.wnd.$.find(".cards-content").position().left,a=h.wnd.$.find(".cards-content"),s=h.wnd.$.find(".cards-content").width();if(t){e=n-35;var r=h.wnd.$.find(".midle-cards-overflow").width();(i=Math.abs(e)+r>s)&&(e=-1*(s-r)),a.css("left",e)}else i=(e=n+35)>=0,a.css("left",i?0:e)},this.updateBuyBut=function(t,e){var i=0==t||0==e?"inline-block":"none";this.wnd.$.find(".depo-buy").css("display",i)},this.updatePaymentBut=function(t,e){var i=0==t||0==e?"none":"inline-block";this.wnd.$.find(".depo-payment").css("display",i)},this.updateDeleteBut=function(t,e){var i="inline-block";0!=t&&0!==e||(i="none"),h.wnd.$.find(".delete-deposit").css("display",i)},this.updateCards=function(e,i,n){const a=this.wnd.$.find(".cards-content"),s=t?i:8;for(;f<s;)g<e?(this.addGrid(),this.newCard(a,s,!0),g++):this.newCard(a,s,!1),f++;g<e&&(this.setBoughtCard(e),this.addGrid(),g++),this.setVisible(u),this.setAmountOnCards()},this.setBoughtCard=function(t){let e=h.wnd.$.find(".card").eq(t-1);e.removeClass("disabled"),e.find(".amount").text(112)},this.setVisibleArrows=function(){var t=h.wnd.$,e=t.find(".cards-content").width()>t.find(".midle-cards-overflow").width(),i=e?17:2;t.find(".left-arrow, .right-arrow").css("display",e?"block":"none"),t.find(".midle-cards-overflow").css({left:i,right:i})},this.updateUpgradeBut=function(e,n,a){if(e==n)return this.setStateUpgradeCard(!0);t?(h.wnd.$.find(".upgrade").find(".label").html(v?_t("buydepo"):_t("increase")),1&i?this.setStateUpgradeCard(!1):this.setStateUpgradeCard(!0)):!(0==e||0===a)?this.setStateUpgradeCard(!1):this.setStateUpgradeCard(!0)},this.initUpgradeBut=function(){this.createBut("add_card","upgrade",(function(){var e=h.getUpgradePrice();if(t){var i="";i=v?_t("buydepoalert",{"%gold%":round(e.gold),"%credits%":e.credits},"depo"):_t("increasedepoalert",{"%gold%":round(e.gold),"%credits%":e.credits},"depo"),mAlert(i,[{txt:_t("pay_gold %val%",{"%val%":round(e.gold)},"depo"),hotkeyClass:"",callback:function(){return _g("clan&a=depo&op=upgrade&pay=z"),!0}},{txt:_t("pay_gold %val%",{"%val%":e.credits},"depo")+" "+_t("sl",null,"clan"),hotkeyClass:"",callback:function(){return _g("clan&a=depo&op=upgrade&pay=s"),!0}},{txt:_t("cancel"),hotkeyClass:"alert-cancel-hotkey",callback:function(){return!0}}])}else{i=_t("depo_upgrade_confirm_credits %val%",{"%val%":e.credits},"depo");mAlert(i,[{txt:_t("yes"),callback:function(){return _g("depo&upgrade=1"),!0}},{txt:_t("no"),callback:function(){return!0}}])}}),"green")},this.initBuyDepoBut=function(){t||this.createBut("buy_depo","depo-buy",(function(){h.paymentButActions("Create")}),"green")},this.initDeleteDepoBut=function(){t||this.createBut("delete-deposit","delete-deposit",(function(){h.deleteDeposit()}))},this.setStateUpgradeCard=function(t){var e=this.wnd.$.find(".upgrade");t?e.css("display","none"):e.css("display","inline-block")},this.newCard=function(e,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=f,r=s+1,o=n.get("card").addClass("active");a||o.addClass("disabled"),o.width(100/i+"%"),o.find(".label .number").html(r),r!==i||8!==i||t||o.find(".label .icons").append($("<div>",{class:"k-b"}));var l=null;e.append(o),o.click((function(){o.hasClass("disabled")||(h.setVisible(s),h.correctCardPos(s))})),o.droppable({over:function(t){t.target.classList.contains("disabled")||(l=setTimeout((function(){h.setVisible(s)}),1e3))},out:function(){clearTimeout(l),l=null},drop:function(t,e){if(!t.target.classList.contains("disabled")){l&&clearTimeout(l);var i=e.draggable.data("item");h.setDepoItem(i,s),l=null}}})},this.correctCardPos=function(t){var e=35*t,i=e+35,n=h.wnd.$.find(".cards-content"),a=h.wnd.$.find(".midle-cards-overflow").width(),s=Math.abs(n.position().left),r=e<s,o=i>s+a;if(r&&!o&&n.css("left",-1*e),!r&&o){var l=i-(a=h.wnd.$.find(".midle-cards-overflow").width());n.css("left",-1*l)}},this.setVisible=function(t){var e=h.wnd.$.find(".card");h.setVisibleAttrToGrid(t),y.css("left",-490*t),e.removeClass("active"),e.eq(t).addClass("active"),u=t},this.initWindow=function(){var i=t?this.tLang("clan_depo"):this.tLang("depo");e=n.get("depo"),t&&e.addClass("depo-clan"),Engine.windowManager.add({content:e,nameWindow:Engine.windowsData.name.DEPO,nameRefInParent:"wnd",objParent:this,title:i,onclose:()=>{h.close()}}),this.wnd.addToAlertLayer()},this.updateAvailable=function(t,e){var i=[this.tLang("depo-txt-rent"),this.tLang("depo_available_info"),this.tLang("depo_missing"),this.tLang("yes"),this.tLang("no")],n="",a=this.wnd.$.find(".date-value");n=0===e?i[2]:this.timeOut(e),a.html(n)},this.timeOut=function(t){var e=ut_fulltime(t);return t<unix_time()?"<span>"+e+"</span>":e},this.updateGold=function(t){this.wnd.$.find(".gold-value").html(formNumberToNumbersGroup(t))},this.updateRight=function(t){var e=(3584&t)>>9,n=this.tLang("no_rights_to_see_cd");return i=t,!(0!=e||1&t)&&(this.close(),mAlert(n),!0)},this.initPaymentBut=()=>{this.createBut("depo-payment","depo-payment",()=>{O?this.paymentButActions("Prolong"):mAlert(_t("max_next_expiration",null,"depo"))},"green")},this.initButtons=function(){var e=this.wnd.$,i=["pay-in","pay-out","but-actions",this.tLang("depo_monthcost"),this.tLang("depo_next_renew")],n=["depo&goldin=","depo&goldout="];t||(e.find(".info").html(i[3]+"<br>"+i[4]+ut_fulltime(void 0)),this.createBut(i[0],"give",(function(){var t=parsePrice(removeSpaces(e.find(".price").val()));checkInputValIsEmptyProcedure(t)||checkParsePriceValueIsCorrect(t)&&_g(n[0]+t)}),"green"),this.createBut(i[1],"get",(function(){var t=parsePrice(removeSpaces(e.find(".price").val()));checkInputValIsEmptyProcedure(t)||checkParsePriceValueIsCorrect(t)&&_g(n[1]+t)}),"green"))},this.getPayProlong=function(t){return l[t]},this.getPayCreate=function(t){return d[t]},this.paymentButActions=function(e){var i,n,a=roundParser(d.gold),s=roundParser(d.credits),r=a.val+a.postfix,o=s.val+s.postfix;if(!t)if(i=["depo&pay=z&time=1","depo&pay=s&time=1"],"Prolong"==e){let t=S?"depo_debt_cost":"depo_month_cost";n=this.tLang(t)+"<br>"+this.tLang("depo_next_renew")+ut_fulltime(O)}else n=_t("depo_create %gold% %credits%",{"%gold%":r,"%credits%":o},"depo");mAlert(n,[{txt:_t("cancel"),hotkeyClass:"alert-cancel-hotkey",callback:function(){return!0}}],(function(t){var n="getPay"+e,a=h[n]("gold"),s=h[n]("credits");if(a){var r=_t("pay_gold %val%",{"%val%":round(a)},"depo");h.addControlBut(t,r,(function(){_g(i[0])}),"small")}if(s){r=_t("pay_tears %val%",{"%val%":s},"depo");h.addControlBut(t,r,(function(){_g(i[1])}),"small")}var o=t.$.find(".button").first();o.parent().append(o)}))},this.addControlBut=function(t,e,i,n){var a=t.addControll(e,null,(function(){i(),t.close()}));n&&a.addClass(n)},this.deleteDeposit=function(){mAlert(h.tLang("depo_remove_confirm_txt"),[{txt:h.tLang("yes"),callback:function(){return _g("depo&remove=OK",(function(t){isset(t.msg)||h.itemTableDelete()})),!0}},{txt:h.tLang("no"),callback:function(){return!0}}])},this.createBut=function(t,e,i,a){var s=this.wnd.$,r=n.get("button").addClass("small "+a),o=s.find("."+e),l=this.tLang(t);r.find(".label").text(l),o.append(r),r.click(i)},this.initItem=function(){let e=t?Engine.itemsFetchData.NEW_CLAN_DEPO_ITEM:Engine.itemsFetchData.NEW_PRIVATE_DEPO_ITEM;Engine.items.fetch(e,h.newDepoItem)},this.newDepoItem=function(e,i){var a=Engine.items.createViewIcon(e.id,Engine.itemsViewData.DEPO_ITEM_VIEW)[0];let s=n.get("depo_backlight");h.setItem(a,e),h.itemCallbacks(a,e),a.prepend(s),a.data("item",e),a.draggable(k),a.click((function(t){h.clickDepoItem(getE(t),e)})),a.contextmenu((function(i,n){t?h.depoClanItemMenu(getE(i,n),e):h.depoItemMenu(getE(i,n),e)})),E||(m=!0,h.searchDepoItem()),e.on("delete",(function(){m=!0,h.searchDepoItem()})),e.on("afterUpdate",(function(){m=!0,h.searchDepoItem(),(e.x>0||e.y>0)&&a.removeClass("doubled")})),h.countItemsPerCard(e.x,!0),i&&(h.setAmountOnCards(),E&&M(),E=!1)},this.countItemsPerCard=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=parseInt(t/14);for(;null==T[i];)T.push(0);e?T[i]++:T[i]--},this.setAmountOnCards=function(){let t=h.wnd.$.find(".cards-content .card"),e=h.wnd.$.find(".available-slots .available-slots-current"),i=h.wnd.$.find(".available-slots .available-slots-all"),n=0,a=112*g;for(let e=0;e<T.length;e++){let i=112-T[e];t.eq(e).find(".amount").text(i),e<g&&(n+=i)}e.text(n),i.text(a)},this.clickDepoItem=function(e,i){t?_g("clan&a=depo&op=item_get&id="+i.id):_g("depo&get="+i.id)},this.depoClanItemMenu=function(t,e){var i={txt:_t("move",null,"item"),f:function(){_g("clan&a=depo&op=item_get&id="+e.id)}};e.createOptionMenu(t,i)},this.depoItemMenu=function(t,e){var i={txt:_t("move",null,"item"),f:function(){_g("depo&get="+e.id)}};e.createOptionMenu(t,i)},this.getAmountCards=function(){return g},this.getCardItems=function(){return T},this.addGrid=function(t){(t||0!=g)&&y.css("width",491*(g+1))},this.setItem=function(t,e){h.slotItemTable(e,t),h.setPos(t,e.x,e.y)},this.itemCallbacks=function(t,e){e.on("afterUpdate",(function(i){i.x==e.x&&i.y==e.y||(h.setItem(t,e),delete p[i.x][i.y],h.countItemsPerCard(i.x,!1),h.countItemsPerCard(e.x,!0),h.setAmountOnCards())})),e.on("delete",(function(){delete p[e.x][e.y],h.countItemsPerCard(e.x,!1),h.setAmountOnCards(),t.remove()}))},this.slotItemTable=function(t,e){var i=t.x,n=t.y,a=t.id;p[i]||(p[i]={}),p[i][n]||(p[i][n]={}),p[i][n][a]={itemData:t,$itemClone:e}},this.setPos=function(t,e,i,n){var a=n||0;t.css({left:35*e+2-a,top:35*i+2-a}),t.removeClassStartingWith("x-"),t.addClass("x-"+Math.floor(e/14)),y.append(t)},this.setExpiredOverlay=function(e,n){var a=h.wnd.$.find(".depo-expired"),s=a.find(".depo-expired__text");0==e||0==n?a.removeClass("depo-expired--hidden"):a.addClass("depo-expired--hidden");let r=t?1&i?"depo-clan-expired":"depo-clan-expired-others":"depo-expired";s.html(_t(r,null,"depo"))},this.close=function(){let e=t?Engine.itemsFetchData.NEW_CLAN_DEPO_ITEM:Engine.itemsFetchData.NEW_PRIVATE_DEPO_ITEM;Engine.items.removeCallback(e),h.wnd.remove(),this.itemTableDelete(),t&&_g("clan&a=depo&op=close"),Engine.lock.remove("depo"),Engine.depo=!1,t?Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.DEPO_CLAN):Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.DEPO)},this.itemTableDelete=function(){let e=t?Engine.itemsFetchData.NEW_CLAN_DEPO_ITEM.loc:Engine.itemsFetchData.NEW_PRIVATE_DEPO_ITEM.loc;Engine.items.deleteMessItemsByLoc(e,!1),p=null},this.setDepoItem=function(e,i){for(var n=14*((isset(i)?i:u)+1),a=n-14,r=s.isEquipItemLoc(e.loc)?"put":"move",o=0;o<8;o++)for(var l=a;l<n;l++)if(!p[l]||p[l]&&!p[l][o])return void(t?s.isEquipItemLoc(e.loc)?_g("clan&a=depo&op=item_put&id="+e.id+"&x="+l+"&y="+o):_g("clan&a=depo&op=item_move&id="+e.id+"&x="+l+"&y="+o):_g("depo&"+r+"="+e.id+"&x="+l+"&y="+o))},this.initDropGrid=function(){this.wnd.$.find(".grid-wrapper").droppable({accept:".item:not(.shop-item)",drop:function(e,i){var n=i.draggable.data("item"),a=$(this).offset(),s=Math.floor((i.offset.top+i.draggable.height()*Engine.zoomFactor/2-a.top)/35/Engine.zoomFactor),r=Math.floor((i.offset.left+i.draggable.width()*Engine.zoomFactor/2-a.left)/35/Engine.zoomFactor)+14*u;switch(n.loc){case Engine.itemsFetchData.NEW_PRIVATE_DEPO_ITEM.loc:_g("depo&move="+n.id+"&x="+r+"&y="+s);break;case Engine.itemsFetchData.NEW_EQUIP_ITEM.loc:t?_g("clan&a=depo&op=item_put&id="+n.id+"&x="+r+"&y="+s):_g("depo&put="+n.id+"&x="+r+"&y="+s);break;case Engine.itemsFetchData.NEW_CLAN_DEPO_ITEM.loc:_g("clan&a=depo&op=item_move&id="+n.id+"&x="+r+"&y="+s)}}})},this.tLang=function(t){return _t(t,null,"depo")},this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.DEPO;Engine.windowCloseManager.callWindowCloseConfig(t)};this.getVisible=()=>u}},function(t,e,i){var n=i(0),a=i(249),s=i(250),r=i(251),o=i(252),l=i(253),c=i(254),d=i(108),h=i(255),u=i(256),p=i(257),g=i(258),f=i(259),m=i(108),v=i(260),E=i(261),_=i(262),b=i(263),w=i(264),C=i(265),T=i(266),y=i(267),I=i(268);t.exports=function(t){var e,i,A,k,S,O,M,N,R,x,L,D,P,B,F,W,H,G,V,U,j,q,K,Y,z,X,Q,J,Z,tt=this,et=this,it={},nt={};this.initTable=function(){A=["clan_info","clan_list","clan-official-page","clan_priv-page","clan_recruit","clan_members","clan_treasury","clan_manage","clan_diplomacy","clan_history","clan_quests","clan_skills"],k=[this.tLang("th_nick"),this.tLang("th_location"),this.tLang("th_rank"),this.tLang("th_status"),this.tLang("th_levelAndProf"),this.tLang("th_lp")],S=[this.tLang("clan_name"),this.tLang("clan_level"),this.tLang("clan_amount_members"),this.tLang("clan_info")],O=[this.tLang("creator_th"),this.tLang("rank_rEdit"),this.tLang("rank_treasury"),this.tLang("rank_invite"),this.tLang("rank_dismiss"),this.tLang("rank_privatepage"),this.tLang("rank_officialpage"),this.tLang("rank_diplomate"),this.tLang("rank_outfit"),this.tLang("tabview_th"),this.tLang("tabuse_th"),this.tLang("tablimit_th")]},this.update=function(t,n){this.updateData(t),this.updateTitle(),this.updateRanks(t.ranks,n),this.updateGoldLog(t.goldlog),this.updateLabels(),this.updateLogo(i,e.logo),this.hideOrShowChangeLogoBut()},this.updateClasses=function(){et.updateTreasury(p),et.updateManage(g),et.updateHistory(f),et.updatePrivPage(m),et.updateOfficialPage(),et.updateRecruit(!1,!0)},this.updateData=function(t){if(!e){var i=this.wnd.$.find(".card");i.removeClass("active"),i.eq(2).addClass("active"),this.showChooseCard("clan","clan-official-page"),this.updateHeader(this.tLang("clan-official-page")),this.initD()}for(var n in t)e[n]=t[n]},this.updateRanks=function(t,i){var n;if(n=isset(i.h)&&isset(i.h.clan)&&isset(i.h.clan.rank)?i.h.clan.rank:Engine.hero.d.clan.rank,t){var a=t.split(";"),s=[];for(var r in a)a[r]=a[r].split(","),s[parseInt(a[r][0])]={name:a[r][1],r:parseInt(a[r][2])};e.ranks=s,e.myrank=s[n].r}else e.myrank=e.ranks[n].r},this.updateGoldLog=function(t){if(t){var i,n=t.split("<br>"),a=[];for(var s in n)i=n[s].split(";"),a[s]={kind:i[0],txt:i[1]};e.goldlog=a}},this.updateLogo=function(t,e,i){var n=t.find(".clan-emblem");this.updateShowcaseLogo(e),i||this.updateClasListLogo(e),this.setLogo(n,e)},this.updateClasListLogo=function(t){if(x){var e=this.wnd.$.find(".my-clan-list-clan>td>.logo");this.setLogo(e,t,!0)}},this.updateShowcaseLogo=function(t){var e=it[Engine.hero.d.clan];if(j&&e){var i=j.wnd.$,n=i.find(".clan-emblem");i.find(".clan-name>.val").html()==e.name&&this.setLogo(n,t)}},this.setLogo=function(t,e,i){var n=e?1:0;i&&0==n&&(n=2);var a=[["#000",""],["#000 url("+e+") center no-repeat"],["url()",""]];t.css({background:a[n][0]}),1===n?t.addClass("hasImage"):t.removeClass("hasImage")},this.updateClanList=function(t){x.update(t),et.updateClList(t)},this.updateTreasury=function(t){F||(F=new t(et)).init(),F.update()},this.updateManage=function(t){W||(W=new t(et)).init(),W.update()},this.updateHistory=function(t){G||(G=new t(et)).init(),G.update()},this.updatePrivPage=function(t){Y||(Y=new t(et,"priv-page","clan")).init(),Y.update()},this.updateClanQuests=function(t){Q.update(t)},this.updateClanSkills=function(t){J.update(t)},this.updateClanBless=function(t){Z||(Z=new I(et)).init(),Z.update(t)},this.updateRecruit=function(t,e){L||(L=new C(et)).init(),L.update(t,e)},this.updateAttributes=function(t){var e=t[3];R.createAllAtributs(e,!1,".atribute-value")},this.updateShowcase=function(t){j.updateInfo(t),this.updateAttributes(t),q.updateScroll()},this.updateMembers=function(t){M.update(t)},this.updateOtherClan=function(t){var e=et.getClanAtributs(),i=et.createSkills(t),n=e.getMapOfBits(t.attributes,t.level,t.depo_tabs,i,t.has_outfit),a=t.members.length/5,s=[t.name,t.level,a,n];this.updateShowcase(s),N.update(t),this.updateLogo(j.wnd.$,t.logo,!0)},this.updatePlayerEdit=function(t){B.update(t)},this.updateRankEdit=function(t){U.update(t)},this.updateDiplomacy=function(t,e){H["update"+e](t)},this.updateOfficialPage=function(){q.update()},this.updateOtherClanOfficialPage=function(t){K.showOtherClanOfficial(),K.update(t)},this.updateEditPrivPage=function(t){X.update(t)},this.updateEditOfficialPage=function(t){z.update(t)},this.updateClanOutfit=function(t){V?this.updateDataToOutfits(t):((V=[]).push(new v),V.push(new v),et.updateDataToOutfits(t))},this.updateDataToOutfits=function(t){t?(V[0].update(i,t[0],t[1]),V[1].update(i,t[2],t[3])):(V[0].remove(),V[1].remove())},this.updateTitle=function(){this.wnd.$.find(".clan-name>.name").removeClass("no-clan").text(e.name)},this.updateHeader=function(t){et.wnd.$.find(".header").html(t)},this.updateClList=function(t){it=t},this.init=function(){this.initWindow(),this.initTable(),this.createAllCards(),this.initButtons(),this.initClass(),this.wnd.center(),this.showChooseCard("clan","clan-info"),this.updateLabels(!0),this.updateLogo(i),this.initHoverLogo(this.wnd.$),$(".scroll-wrapper",i).trigger("update")},this.initD=function(){e={},i.find(".clan-look-for-clan-btn").css("display","none"),i.find(".clan-showcase-but").css("display","block"),i.find(".stats").css("display","block"),this.showCards(),$(".scroll-wrapper",i).trigger("update")},this.initHoverLogo=function(t){var e=t.find(".edit-logo-but");t.find(".clan-emblem").add(e).hover((function(){e.css("opacity",1)}),(function(){e.css("opacity",0)}))},this.initButtons=function(){var t=this.tLang("clan_showcase"),e=this.tLang("create_clan"),i=this.addControll(t,"clan-showcase-but",this.showcaseButClick),n=this.addControll(e,"clan-look-for-clan-btn",this.createClan);i.addClass("green small"),n.addClass("green small")},this.showcaseButClick=function(){var t=e.id;_g("clan&a=getclan&id="+t)},this.createClan=function(){_g("clan&a=create")},this.createEditLogoBut=function(t){var e=this.tLang("edit_logo");et.addControll(e,"edit-logo-but",this.changeLogo,t).addClass("small green")},this.changeLogo=function(){var t=et.tLang("logo_url");askAlert({q:t,re:"clan&a=save&f=logo&v=",m:"input2",inputCheck:this.checkHttps})},this.checkHttps=t=>{if(""===t)return!0;return!!t.startsWith("https://")||(mAlert(_t("https_alert",null,"clan")),!1)},this.hideOrShowChangeLogoBut=function(){var t=["none","block"],e=this.canChangeLogo();i.find(".edit-logo-but").css("display",e?t[1]:t[0])},this.canChangeLogo=function(){return 1&e.myrank},this.initClass=function(){(x=new b(et)).init(),P=new y(et),(D=new w(et)).init(),new u(et).init(),(H=new a(et)).init(),(j=new o(et)).init(),(B=new s(et)).init(),(U=new r(et)).init(),(M=new l(et)).init(),(N=new c(et)).init(),(q=new d(et,"official-page","clan")).init(),(K=new d(et,"official-page","showcase")).init(),X=new h(et,"priv-page","clan"),z=new h(et,"official-page","clan"),X.init(),z.init(),(R=new T(et,!0)).init(),(Z=new I(et)).init(),(J=new _(et)).init(),(Q=new E(et)).init()},this.updateLabels=function(t){if(t)i.find(".stats").css("display","none");else if(isset(e.bits)&&i.find(".clan-level").html(e.level).tip(this.tLang("clan_level")+": "+e.level),isset(e.mlist)&&i.find(".clan-member-amount").html(et.tLang("clan_amount_members")+"<span>"+e.mlist.length/2+"</span>"),isset(e.attributes)){var n=et.getProp("attributes")>>21&3,a=n?1==n?_t("open_recruit"):_t("free recruitment"):_t("close_recruit");i.find(".clan-recruit-state").html(et.tLang("rank_inviting")+"<br><span>"+a+"</span>")}},this.showChooseCard=function(t,e){var i;switch(t){case"clan":i=et.wnd.$;break;case"showcase":i=j.wnd.$}var n=i.find(".card-content").children();e=e.replace("_","-")+"-content";n.css("display","none"),i.find("."+e).css("display","block")},this.createAllCards=function(){for(var t=this.wnd.$.find(".scroll-pane"),e=0;e<A.length;e++)this.createCard("clan",t,A[e]),this.hideCards(e);this.wnd.$.find(".card").eq(0).addClass("active"),this.updateHeader(this.tLang(A[0]))},this.createCard=function(t,i,a){var s=et.tLang(a),r=n.get("card");r.find(".label").html(s),r.find(".label").attr("name",s);var o=a.substring(5);r.attr("data-card",o),i.append(r),r.click((function(){"clan"==t&&!e&&"clan_info"!=a&&"clan_list"!=a||et.breakSwitch(o)||(et.setActiveTab(o,i),"clan"==t&&et.updateHeader(s),et.showChooseCard(t,a),$(".scroll-wrapper",".clan-"+o+"-content").trigger("update"))}))},this.setActiveTab=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=null===e?tt.wnd.$.find(".left-column .scroll-pane"):e,e.find(`.card[data-card="${t}"]`).addClass("active").siblings(".card").removeClass("active")},this.breakSwitch=function(t){var e=et[t+"Click"];return!!e&&(!!e()||void 0)},this.recruitClick=function(){return L.showSection("recruit-main"),!1},this.listClick=function(){return _g("clan&a=list&page=1"),D.hideFindPanel(),!1},this.membersClick=function(){return _g("clan&a=members"),!1},this.diplomacyClick=function(){return _g("clan&a=dipl"),!1},this.skillsClick=function(){return _g("clan&a=skills_show"),!1},this.questsClick=function(){return _g("clan&a=quests_show"),!1},this.hideCards=function(t){0!=t&&1!=t&&i.find(".card").eq(t).hide()},this.showCards=function(){i.find(".card").show()},this.alert=function(t,e){mAlert(t,[{txt:et.tLang("yes"),callback:function(){return e(),!0}},{txt:et.tLang("no"),callback:function(){return!0}}])},this.createRecords=function(t,e){for(var i=$("<tr>"),n=0;n<t.length;n++){var a=$("<td>").html(t[n]);"object"==typeof e?a.addClass(e[n]):a.addClass(e),i.append(a)}return i},this.addControll=function(t,e,i,a){var s=n.get("button");return i&&s.click(i.bind(et)),s.find(".label").html(t),(a=a||this.wnd.$).find("."+e).append(s),s},this.createOneMember=function(t,i,a){let s,r=n.get("clan-member"),o=t[1],l=escapeHTML(t[4])+" ("+t[5]+", "+t[6]+")";if(0==t[8])s=n.get("online-status").addClass("online-status green").html("online");else{let e='<div class="online-status">offline</div><div class="time-offline" time-offline="'+t[8]+'">'+calculateDiff(t[8])+"</div>";s=n.get("online-status-wrapper").addClass("red v-item").html(e)}let c=e.ranks[t[7]].name,d=n.get("member-rank").html(c),h=CFG.a_opath+t[9],u=n.get("level-and-prof"),p=n.get("member-lvl").html(t[2]+t[3]);return d.tip(c),d.attr("id-rank",t[7]),u.append(p),createImgStyle(r.find(".icon-wrapper"),h),r.find(".char-stats").html(o),r.find(".last-visit").html(l),a&&M.createAddToGroup(r,t[0]),i&&M.createButRankEdit(r,t[7],t[0],t[1]),this.createRecords([r,u,d,s],"normal-td big-height-td")},this.createPlaceHolder=function(t,e,i){i.find(t).attr("placeholder",e)},this.amountNumericalRights=function(t,e){var i=0;switch(t){case 9:i=(3584&e)>>9;break;case 10:i=(28672&e)>>12;break;case 11:i=(98304&e)>>15}return i},this.initWindow=function(){i=n.get("clan"),Engine.windowManager.add({content:i,title:et.tLang("clan_title"),nameWindow:Engine.windowsData.name.CLAN_WND,widget:Engine.widgetsData.name.CLAN,objParent:et,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{et.close()}});let t=et.tLang("haveNotClan");et.wnd.show(),et.wnd.addToAlertLayer(),i.find(".clan-name>.name").addClass("no-clan").html(t),$(".scroll-wrapper",i).addScrollBar({track:!0})},this.close=function(){et.wnd.remove(),j.close(),Engine.clan=!1,Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_BRING_CLAN_QUEST_TPL),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_BLESS_TPL),Engine.tpls.deleteMessItemsByLoc("q"),Engine.tpls.deleteMessItemsByLoc("b")},this.createSkills=function(t){return{maxParticipants:{lvl:t.maxParticipants},expBonus:{lvl:t.expBonus},questExpBonus:{lvl:t.questExpBonus},allyEnemyCount:{lvl:t.allyEnemyCount},blessing:{lvl:t.blessing},cursedItem:{lvl:t.cursedItem},healPower:{lvl:t.healPower},timeTickets:{lvl:t.timeTickets}}},this.getProp=function(t){return!!e&&e[t]},this.getMemberList=function(){return nt},this.getOtherClan=function(t){for(var e={},i=it.id.length,n=0;n<i&&t!=it.id[n];n++);for(var a in it)e[a]=it[a][n];return e},this.getCharInf=function(){return k},this.getClanInf=function(){return S},this.getClanRankInf=function(){return O},this.getShowcaseWnd=function(){return j.wnd},this.getRecruit=function(){return L},this.getClanList=function(){return x},this.getOtherClanRecruit=function(){return R},this.getClanAtributs=function(){return P},this.tLang=function(t,e){return _t(t,null,e||"clan")}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i;this.updateFriend=function(t){this.updateEdit();var i=e.find(".friend-table-header"),n=e.find(".friend-table"),a=this.friendHeader();n.html("");for(var s=0;s<t.length;s+=4){var r=t.slice(s,s+4),o=this.createFriendTr(r);n.append(o)}i.html(a),$(".scroll-wrapper",e).trigger("update"),this.showOrHide()},this.updateEnemy=function(t){this.updateEdit();var i=e.find(".enemy-table-header"),n=e.find(".enemy-table"),a=this.enemyHeader();n.html("");for(var s=0;s<t.length;s+=6){var r=t.slice(s,s+6),o=this.createEnemyTr(r);n.append(o)}i.html(a),$(".scroll-wrapper",e).trigger("update"),this.showOrHide()},this.updateEdit=function(){var e=t.getProp("myrank");i=128&e},this.showOrHide=function(){var t=["block","none"];e.find(".js-rank-hide").css("display",i?t[0]:t[1])},this.createEnemyTr=function(e){var n=this.createDeletekBut(e[0],"e"),a=["normal-td","right-td","right-td","right-td","right-td","",""];return i?t.createRecords([escapeHTML(e[3]),e[1],e[2],formNumberToNumbersGroup(e[4]),e[5],n],a):t.createRecords([escapeHTML(e[3]),e[1],e[2],formNumberToNumbersGroup(e[4]),e[5]],a.slice(0,6))},this.createFriendTr=function(e){var n=this.createDeletekBut(e[0],"f"),a=["normal-td","right-td","right-td",""];return i?t.createRecords([escapeHTML(e[1]),formNumberToNumbersGroup(e[2]),e[3],n],a):t.createRecords([escapeHTML(e[1]),formNumberToNumbersGroup(e[2]),e[3]],a.slice(0,3))},this.friendHeader=function(){var e=[t.tLang("friend_clans"),t.tLang("clan_power"),t.tLang("plrs_amount"),t.tLang("del_friend_enemy_clan")],n=["medium-height-td table-header","table-header","table-header","table-header"];return i?t.createRecords(e,n):t.createRecords(e.slice(0,3),n.slice(0,3))},this.enemyHeader=function(){var e=[t.tLang("enemy_clans"),t.tLang("battle_wins"),t.tLang("battle_loses"),t.tLang("clan_power"),t.tLang("plrs_amount"),t.tLang("del_friend_enemy_clan")],n=["table-header","table-header","table-header","table-header","table-header","table-header "];return i?t.createRecords(e,n):t.createRecords(e.slice(0,5),n.slice(0,5))},this.initLabels=function(){var i=[t.tLang("invite_to_clan_alliance"),t.tLang("add_new_enemy")];e.find(".friend .label-info").html(i[0]+":"),e.find(".enemy .label-info").html(i[1]+":")},this.initPlaceHolders=function(){var i=t.tLang("clan_name");t.createPlaceHolder(".invite-friend",i,e),t.createPlaceHolder(".add-enemy",i,e)},this.initButs=function(){var e=[t.tLang("invite_to_alliance"),t.tLang("add_to_enemy_")];t.addControll(e[0],"invite-friend-but",this.inviteToAlliance).addClass("small green"),t.addControll(e[1],"add-enemy-but",this.addToEnemy).addClass("small green")},this.inviteToAlliance=function(){var t=e.find(".invite-friend");_g("clan&a=dipl&name="+esc(t.val().trim())+"&op=ally",(function(){t.val("")}))},this.addToEnemy=function(){var t=e.find(".add-enemy");_g("clan&a=dipl&name="+esc(t.val().trim())+"&op=enemy",(function(){t.val("")}))},this.createDeletekBut=function(e,i){var a=n.get("button").addClass("small"),s=n.get("add-bck");return a.append(s),a.click((function(){var n="cancel_"+("e"==i?"war":"alignment");t.alert(t.tLang(n),(function(){"f"==i&&(i="a"),_g("clan&a=dipl&id="+e+"&op=cancel_"+i)}))})),a},this.initContent=function(){e=n.get("clan-diplomacy-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.init=function(){this.initContent(),this.initLabels(),this.initPlaceHolders(),this.initButs()}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a,s=this;this.update=function(t){i=t[0],a=t[1],this.createHeaderAndTable(t),this.hideOrShow(),this.createMenu()},this.createHeaderAndTable=function(i){var n=this.createHeaderMemberList(),a=e.find(".js-table-header"),s=e.find(".player-edit-table"),r=t.createOneMember(i,!1,!1);a.html(""),s.html(""),a.append(n),s.append(r)},this.init=function(){var i=t.wnd.$.find(".card-content");e=n.get("clan-edit-content"),i.append(e),this.createBut()},this.createHeaderMemberList=function(){var e=t.getCharInf();return t.createRecords([e[0]+"/"+e[1],e[4],e[2],e[3]],"")},this.createBut=function(){var e=[t.tLang("cl_name_save"),t.tLang("cl_send"),t.tLang("del_member"),t.tLang("back")];t.addControll(e[0],"change-rank-but",this.changeRank).addClass("small green"),t.addControll(e[1],"send-but",this.changeBoss).addClass("small"),t.addControll(e[2],"remove-from-clan",this.removeFromClan).addClass("small"),t.addControll(e[3],"back-to-members",this.backToMemberList).addClass("small green")},this.changeRank=function(){var e=t.wnd.$.find(".rank-menu .menu-option").attr("value");_g("clan&a=member&id="+i+"&rank="+e,(function(){s.backToMemberList()}))},this.hideOrShow=function(){var i=t.getProp("myrank"),n=["block","none"];e.find(".send-tears").css("display",1&i?n[0]:n[1]),e.find(".edit-rank").css("display",2&i?n[0]:n[1]),e.find(".remove-from-clan").css("display",16&i?n[0]:n[1])},this.changeBoss=function(){var e=_t("give_clan_leadership_confirm %name%",{"%name%":a},"clan");t.alert(e,s.changeBossReq)},this.changeBossReq=function(){var e=t.wnd.$.find(".send-menu>.bck span").attr("value");_g("clan&a=member&id="+i+"&leader=1"+(parseInt(e)?"":"&pay=self"),(function(){s.backToMemberList()}))},this.removeFromClan=function(){var e=_t("player_dismiss_confirm",{"%name%":a},"clan");t.alert(e,(function(){_g("clan&a=member&dismiss=1&id="+i,(function(){s.backToMemberList()}))}))},this.backToMemberList=function(){var e=t.tLang("clan_members");t.updateHeader(e),t.showChooseCard("clan","clan-members"),$(".scroll-wrapper",".clan-members-content").trigger("update")},this.createMenu=function(){var n=[t.tLang("change_rank"),t.tLang("give_clan_leadership")],a=t.getProp("ranks"),s=Engine.hero.d.clan.rank,r=t.getMemberList()[i][7],o=[],l=[{text:t.tLang("clan_sl"),val:1},{text:t.tLang("private_sl"),val:0}];for(var c in a)c>=s||o.push({text:a[c].name,val:c});const d=e.find(".rank-menu");e.find(".edit-rank>.label").html(n[0]),e.find(".send-tears>.label").html(n[1]),d.empty().createMenu(o.reverse()),d.setOptionWithoutCallbackByValue(r),e.find(".send-menu").empty().createMenu(l,!0)}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a,s=this;this.update=function(t){this.clearValIntputs(),this.updateIdRank(t[0]),this.updateName(t[1]),this.updateCheckBox(),this.updatePlaceHolders(),this.updateAllMenu(t[2]),this.updateLabels(),this.showHideRemoveRankBut(),$(".scroll-wrapper",e).trigger("update")},this.initInputMask=()=>{e.find(".edit-id").mask("00")},this.showHideRemoveRankBut=function(){e.find(".remove-rank").css("display",100==i?"none":"table-cell")},this.init=function(){this.initWindow(),this.initLabels(),this.createButs(),this.initInputMask()},this.initWindow=function(){var i=t.wnd.$.find(".card-content");e=n.get("clan-rank-edit-content"),i.append(e),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.updateIdRank=function(t){t&&(i=t)},this.updateName=function(t){t&&(a=t)},this.updateCheckBox=function(){var n=e.find(".check-rank");if(e.find(".left-ranks, .right-ranks").html(""),n.hide(),100!=i){n.show();for(var a=t.getClanRankInf().slice(1,9),s=0;s<a.length;s++)this.createOneRank(a[s],s)}},this.updateLabels=function(){var t=100!=i&&0!=i?0:1;e.find(".id-wrapper").css("display",["block","none"][t])},this.createOneRank=function(t,i){var a=n.get("one-rank"),s=i%2?"right":"left";this.setOneRank(a,i,t),this.setActiveCheckBox(a,i),e.find("."+s+"-ranks").append(a)},this.setOneRank=function(t,e,i){var n=t.find(".bck"),a=t.find(".checkbox"),s=Math.pow(2,e+1);n.addClass("r"+s),t.find(".clan-icon").css("background",`url("../img/gui/clan_icons.png?v=${__build.version}") no-repeat `+-24*(e+1)+"px 0"),t.find(".label").html(i),t.click((function(){n.toggleClass("active"),a.toggleClass("active")}))},this.setActiveCheckBox=function(e,n){var a=e.find(".bck"),s=e.find(".checkbox"),r=t.getProp("ranks")[i].r&Math.pow(2,n+1)?"active":"";a.addClass(r),s.addClass(r)},this.initLabels=function(){var i=[t.tLang("rank_name"),t.tLang("rank_id_upper")];e.find(".label-name").html(i[0]),e.find(".label-id").html(i[1])},this.updatePlaceHolders=function(){t.createPlaceHolder(".edit-name",a,e),t.createPlaceHolder(".edit-id",i,e)},this.updateAllMenu=function(n){if(e.find(".numerable-ranks").html(""),100!=i)for(var a=t.getProp("ranks")[i].r,s=["rank_tabs_view","rank_tabs_usage","rank_tabs_itemlimit"],r=n>>2&5,o=[[5,0,t.tLang("tabs_view no_access")],[5,0,t.tLang("tabs_view no_usage")],[3,r,t.tLang("tabs_view no_limit")]],l=0;l<3;l++){var c=t.amountNumericalRights(l+9,a),d=this.createDataTabToMenu(o[l][0],o[l][1],o[l][2]);this.createOneNumerableRank(s[l],l,c,d)}},this.createDataTabToMenu=function(t,e,i){for(var n=[],a=0;a<=t;a++){var s=0==a?a+" "+i:a;n.push({text:s,val:a})}return n},this.createButs=function(){var e=[t.tLang("remove_rank"),t.tLang("cancel"),t.tLang("save")],i=t.addControll(e[0],"remove-rank",this.removeRank),n=t.addControll(e[1],"cancel-edit",this.backToManage),a=t.addControll(e[2],"save-change",this.saveChange);n.add(a).addClass("green small"),i.addClass("small")},this.removeRank=function(){var e=t.tLang("confirm_rank_delete");t.alert(e,(function(){_g("clan&a=rank&a2=del&rid="+i,s.backToManage)}))},this.backToManage=function(){var e="clan_manage";t.updateHeader(t.tLang(e)),t.showChooseCard("clan",e),$(".scroll-wrapper",".clan-manage-content").trigger("update")},this.saveChange=function(){var t=e.find(".edit-id").val(),n=e.find(".edit-name").val(),r=0;let o,l="";""!=t&&t!=i&&(l="&nrid="+t),o="&name="+esc(""==n?a:n);for(var c=1;c<12;c++)if(c<9){var d=".r"+Math.pow(2,c);e.find(d).hasClass("active")&&(r+=Math.pow(2,c))}else switch(c){case 9:r+=$(".rank_tabs_view>.bck span").attr("value")<<9;break;case 10:r+=$(".rank_tabs_usage>.bck span").attr("value")<<12;break;case 11:r+=$(".rank_tabs_itemlimit>.bck span").attr("value")<<15}_g("clan&a=rank&a2=edit&rid="+i+o+"&r="+r+l,s.backToManage)},this.clearValIntputs=function(){e.find(".edit-id").val(""),e.find(".edit-name").val("")},this.createOneNumerableRank=function(i,a,s,r){var o=n.get("one-numerable-rank");e.find(".numerable-ranks").append(o);const l=o.find(".menu");var c=$("<span>").addClass("small-header-info info-icon");c.tip(_t(i+"_tip",null,"clan")),o.find(".clan-icon").css("background",`url("../img/gui/clan_icons.png?v=${__build.version}") no-repeat `+-24*(a+9)+"px 0"),o.find(".label").html(t.tLang(i)+" "+c.prop("outerHTML")),l.addClass(i).createMenu(r),l.setOptionWithoutCallbackByValue(s)}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a=this,s=this;this.initTab=function(){i=["clan-official-page","clan_other-members","clan_other-recruit"]},this.initAllCards=function(){for(var n=e.find(".header-menu"),a=0;a<i.length;a++)t.createCard("showcase",n,i[a]);e.find(".card").eq(0).addClass("active")},this.updateInfo=function(i){if(i){this.showShowcase(),isset(i[0])&&this.setTitle(i[0]);var a=parseInt(i[3][21],2),s="",r=n.get("clan-banner-name");e.find(".clan-banner-name").remove(),e.find(".header").prepend(r),s=0==a?_t("close_recruit"):1==a?_t("open_recruit"):_t("free recruitment");for(var o=[".clan-name","",escapeHTML(i[0]),".clan-level",t.tLang("clan_level")+": ",i[1],".amount-members",t.tLang("clan_amount_members")+": ",i[2],".recruite-info",t.tLang("recruitment")+": ",s],l=0;l<o.length;l+=3){var c=o[l],d=o[l+1],h='<span class="val">'+o[l+2]+"</span>";e.find(c).html(d+h)}}},this.initHeader=function(){var i=t.tLang("clan_showcase");e.find(".header").html(i)},this.init=function(){this.initWindow(),this.initTab(),this.initAllCards()},this.initWindow=function(){e=n.get("showcase"),Engine.windowManager.add({content:e,nameWindow:Engine.windowsData.name.SHOWCASE,objParent:s,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{s.hide()}}),s.wnd.addToAlertLayer(),s.wnd.hide()},this.setTitle=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.tLang("clan_showcase");a.wnd.title(e)},this.showShowcase=function(){s.wnd.center();var e=$(window).width();s.wnd.$.css({display:"block",left:e/2+110}),t.wnd.$.css("left",e/2-640)},this.hide=function(){s.wnd.hide(),t.wnd.center()},this.close=function(){s.wnd.remove()}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a=this,s="invertrank";this.createTabHeaderMemberList=function(){var e=t.getCharInf(),i=$("<div>").html(e[0]+"/"+e[1]),n=$("<div>").html(e[4]),a=$("<div>").html(e[2]),s=$("<div>").html(e[3]);return i.tip(_t("sortForName")),n.tip(_t("sortForLvl")),a.tip(_t("sortForRank")),s.tip(_t("sortForStatus")),t.createRecords([i,n,a,s],"table-header hover-header header-sort")},this.update=function(e){this.clearTable();for(var n=0;n<e.length;n+=10){var a=e.slice(n,n+10),s=t.createOneMember(a,!0,!0),r=a[0],o=t.getMemberList();i.push(s),o[r]=a}this.createMembersListTable("invertrank")},this.clearTable=function(){i=[];for(var t=0;t<i.length;t++)i[t].remove(),delete i[t]},this.deleteTable=function(){e.find(".clan-members-table").detach(),e.find(".clan-members-table").remove()},this.createMembersListTable=function(t){var i=this.createTabHeaderMemberList(),n=e.find(".clan-members-table-header"),a=$("<table>").addClass("clan-members-table table-content"),s=this.getSortedTable(t);for(var r in this.deleteTable(),s){var o=s[r];a.append(o)}n.html(i),e.find(".scroll-pane").append(a),this.createHeaderSortButtons(),$(".scroll-wrapper",e).trigger("update")},this.createHeaderSortButtons=function(){for(var t=e.find(".clan-members-table-header tr"),i=0;i<4;i++)this.clickSort(t,i)},this.clickSort=function(t,e){var i=["name","lvl","rank","status"],n=t.children().eq(e);2===e&&a.setArrows(e,!1),n.click((function(){var t=i[e],n=s==t;s=n?"invert"+t:t,a.createClanListTable(s),a.setArrows(e,!n)}))},this.createClanListTable=function(t){var i=this.createTabHeaderMemberList(),n=e.find(".clan-members-table-header"),a=$("<table>").addClass("clan-members-table table-content"),s=this.getSortedTable(t);for(var r in this.deleteTable(),s){var o=s[r];a.append(o)}n.html(i),e.find(".scroll-pane").append(a),this.createHeaderSortButtons(),$(".scroll-wrapper",e).trigger("update")},this.getSortedTable=function(t){switch(t){case"name":return this.sortByName(i,".char-stats");case"invertname":return this.sortByName(i,".char-stats",!0);case"lvl":return this.sortByAmount(i,".member-lvl");case"invertlvl":return this.sortByAmount(i,".member-lvl",!0);case"rank":return this.sortByRank(i,".member-rank");case"invertrank":return this.sortByRank(i,".member-rank",!0);case"status":return this.sortByOnline(i,".online-status");case"invertstatus":return this.sortByOnline(i,".online-status",!0)}},this.sortByRank=function(t,e,i){var n=[];for(var a in t)n[a]=t[a];return n.sort((function(t,n){var a=parseInt(t.find(e).attr("id-rank")),s=parseInt(n.find(e).attr("id-rank"));return i?s-a:a-s})),n},this.sortByOnline=function(t,e,i){var n=[],s=[];for(var r in t)"online"!=t[r].find(e).html()?n.push(t[r]):s.push(t[r]);n.sort((function(t,e){return a.orderPlayerPerTimeOffline(t,e,i)}));for(var o=0;o<s.length;o++)i?n.push(s[o]):n.unshift(s[o]);return n},this.orderPlayerPerTimeOffline=function(t,e,i){var n=parseInt(t.find(".time-offline").attr("time-offline")),a=parseInt(e.find(".time-offline").attr("time-offline"));return i?a-n:n-a},this.sortByName=function(t,e,i){var n=[];for(var a in t)n[a]=t[a];return n.sort((function(t,n){var a=t.find(e).text().toLowerCase()[0],s=n.find(e).text().toLowerCase()[0];return i?a>s?-1:a<s?1:0:a<s?-1:a>s?1:0})),n},this.sortByAmount=function(t,e,i){var n=[];for(var a in t)n[a]=t[a];return n.sort((function(t,n){var a=parseInt(t.find(e).html()),s=parseInt(n.find(e).html());return i?s-a:a-s})),n},this.setArrows=(t,i)=>{const n=e.find(`.clan-members-table-header tr td:eq(${t})`),a=i?"header-sort--asc":"header-sort--desc";n.removeClass("header-sort--asc header-sort--desc").addClass(a),n.siblings("td").removeClass("header-sort--asc header-sort--desc")},this.createButRankEdit=function(e,i,a,s){var r=19&t.getProp("myrank"),o=Engine.hero.d.clan.rank;if(r&&!(i>=o)){var l=n.get("button").addClass("small green"),c=$("<div>").addClass("add-bck");e.find(".edit").append(l),l.tip(_t("memberManage")),l.append(c),l.tip(t.tLang("redit_td")),l.click((function(){var e=t.getMemberList()[a],i=$("<div>",{class:"player-edit-title"}).html(_t("player_edit",null,"clan")).prop("outerHTML")+s;t.updatePlayerEdit(e),t.showChooseCard("clan","clan-edit"),t.updateHeader(i)}))}},this.createAddToGroup=function(t,e){if(Engine.hero.d.id!=e){var i=n.get("button").addClass("small green"),a=$("<div>").addClass("add-bck");i.tip(_t("sendInviteToGroup")),t.find(".add-to-group").append(i),i.append(a),i.tip(_t("team_invite",null,"menu")),i.click((function(){_g("party&a=inv&id="+e)}))}},this.hideDisableCards=function(){var e=t.getShowcaseWnd().$.find(".card");e.eq(1).add(e.eq(3)).css("display","inline-block"),e.eq(4).css("display","none")},this.init=function(){e=n.get("clan-members-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".table-header-wrapper",e)})}}},function(t,e,i){var n=i(0);t.exports=function(t){var e;this.update=function(t){if(t.members)this.updateTable(t.members);else{var e=this.createMembersTableForCom(t.members);this.updateTable(e)}this.updateScroll()},this.createMembersTableForCom=function(t){for(var e=[],i=0;i<t.length;i++){e.push(t[i]),0!=i&&(i+1)%4==0&&e.push("/noob/wm.gif")}return e},this.updateTable=function(t){var i=1,n=this.createOtherTabHeader(),a=e.find(".js-table-header"),s=e.find(".clan-other-members-table");a.empty(),s.empty();for(var r=0;r<t.length;r+=5){var o=t.slice(r,r+5),l=this.otherMember(o,i);s.append(l),i++}a.prepend(n)},this.otherMember=function(e,i){var a=n.get("clan-member"),s=e[0],r=e[3],o=n.get("member-rank").html(r),l=CFG.a_opath+e[4],c=n.get("level-and-prof"),d=n.get("member-lvl").html(e[1]+e[2]);return createImgStyle(a.find(".icon-wrapper"),l),a.find(".char-stats").html(s),o.tip(r),c.append(d),t.createRecords([i+".",a,c,o],"normal-td big-height-td")},this.updateScroll=function(){$(".scroll-wrapper",e).trigger("update")},this.createOtherTabHeader=function(){var e=t.getCharInf();return t.createRecords([e[5],e[0],e[4],e[2]],"table-header")},this.init=function(){var i=t.getShowcaseWnd().$;e=n.get("clan-other-members-content"),i.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".table-header-wrapper",e)})}}},function(t,e,i){var n=i(0);t.exports=function(t,e,i){var a,s,r,o=this;this.update=function(t){s.find(".edit-area").val(t)},this.init=function(){this.initWindow(),this.initContent(),this.initButs()},this.initWindow=function(){r=i,s="clan"==i?t.wnd.$:t.getShowcaseWnd().$},this.initButs=function(){var e=[t.tLang("save"),t.tLang("cancel")];t.addControll(e[0],"save-change-but",this.saveChange,a).addClass("small green"),t.addControll(e[1],"cancel-change-but",this.cancelChange,a).addClass("small green")},this.saveChange=function(){var t=a.find(".edit-area");_g("clan&a=save&f="+("official-page"==e?"official":"info"),(function(t){}),{v:t.val()}),o.afterSave(t)},this.cancelChange=function(){t.showChooseCard(r,"clan_"+e)},this.afterSave=function(i){if("official-page"==e){var n={official:i.val(),name:t.getProp("name")};t.updateOfficialPage(n)}t.showChooseCard("clan","clan_"+e)},this.initContent=function(){(a=n.get("clan-edit-page-content")).addClass("clan-edit-"+e+"-content"),s.find(".card-content").append(a)}}},function(t,e,i){var n=i(0);t.exports=function(t,e,i){var a;this.init=function(){this.initWindow(),this.initBut()},this.initWindow=function(){a=n.get("clan-info-content"),t.wnd.$.find(".card-content").append(a),$(".scroll-wrapper",a).addScrollBar({track:!0})},this.initBut=function(){var e=t.tLang("look_for_clan"),i=t.tLang("create_clan");t.addControll(e,"look-for-clan",this.lookForClanAction,a).addClass("small green"),t.addControll(i,"clan-look-for-clan-btn",t.createClan,a).addClass("small green")},this.lookForClanAction=function(){var e=t.wnd.$.find(".card");e.removeClass("active"),e.eq(1).addClass("active"),t.showChooseCard("clan","clan-list")}}},function(t,e,i){var n=i(0);const a=i(16);t.exports=function(t){var e,i,s;this.update=function(){this.updateHistoryTable(),this.updateLabelAmount(i,t.getProp("gold")),this.updateLabelAmount(s,t.getProp("credits")),this.allowSendSl(),this.allowGetMoney(),this.allowSendSlBut(),this.availableOutfit(),this.createMenu(),$(".scroll-wrapper",e).trigger("update")},this.init=function(){this.createLabels(),this.createButs(),this.createOutfitHeader()},this.allowGetMoney=function(){var i=4&t.getProp("myrank")?1:0;e.find(".send-to-player").css("visibility",["hidden","initial"][i])},this.allowSendSlBut=function(){var i=t.getProp("myrank"),n=e.find(".on-off-send-sl"),a=e.find(".send-sl"),s=1&i?1:0;n.css("visibility",["hidden","initial"][s]),s?a.removeClass("mtop"):a.addClass("mtop")},this.updateHistoryTable=function(){var t=this.createHistoryHeader(),i=e.find(".history-table");i.html(""),i.append(this.createHistory()),i.prepend(t)},this.createHistoryHeader=function(){var e=t.tLang("treasury-history"),i=t.tLang("date_time");return t.createRecords([e,i],"table-header")},this.createHistory=function(){var e=t.getProp("goldlog"),i=0,n=[],a=[];for(var s in e){var r=e[s].kind;if(i<6&&("gold"==r||"credit"==r)){var o=e[s].txt.split("]"),l=o[0].substring(1),c=convertDateTime(l);n[i]=o.slice(1).join("]"),a.push(t.createRecords([n[i],c],["left-td normal-td","normal-td"])),i++}}return a},this.addAmountLabel=function(t,e){var i=n.get("amount-label");return i.find(".label").html(t),i.find(".amount").html(e),i},this.updateLabelAmount=function(t,e){t.find(".amount").html(formNumberToNumbersGroup(e))},this.createLabels=function(){var a=[t.tLang("gold_cl"),t.tLang("sl_cl"),t.tLang("to_dress"),_t("put_sl_turnedoff")],r=t.wnd.$.find(".card-content");e=n.get("clan-treasury-content"),i=this.addAmountLabel(a[0],0),s=this.addAmountLabel(a[1],0),r.append(e),e.find(".gold-info").html(i),e.find(".sl-info").html(s),e.find(".no-send-sl>.label-info").html(a[3]),setOnlyPositiveNumberInInput(e.find(".amount-send-sl")),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.createButs=function(){var i=[t.tLang("send_gold"),t.tLang("accept-send"),t.tLang("put_sl_on"),t.tLang("to_dress"),t.tLang("give_gold %amount%"),t.tLang("how_to_get")],n=t.addControll(i[0],"send-gold-but",this.sendMoneyToTreasure),s=t.addControll(i[4],"send-gold-player-but",this.sendMoneyToPlayer),r=t.addControll(i[1],"send-sl-but",this.sendSLToTreasure),o=t.addControll(i[2],"on-off-send-sl",this.onOffSendSl),l=t.addControll(i[3],"to-dress-but",this.toDressOutfit),c=t.addControll(i[5],"not-dress-but",this.openDoc);n.add(s).add(r).add(l).add(c).addClass("small green"),o.addClass("small green"),setInputMask(e.find(".amount-send-gold"),a.TYPE.NUMBER_WITH_KMG)},this.openDoc=function(){var t=isPl()?"https://pomoc.margonem.pl/index/view,322":"https://forum.margonem.com/topic/view,3116,1";window.open(t,"_blank").focus()},this.createMenu=function(){for(var i=[],n=t.getProp("mlist"),a=[t.tLang("send_gold_to_treasury"),t.tLang("send_gold_to_player"),t.tLang("send_sl_to_treasury")],s=0;s<n.length;s+=2){var r=n[s],o=n[s+1];i.push({text:o,val:r})}i.sort((t,e)=>t.text.localeCompare(e.text)),e.find(".send-gold>.label-info").html(a[0]),e.find(".send-to-player>.label-info").html(a[1]),e.find(".send-sl>.label-info").html(a[2]),e.find(".choose-player").empty().createMenu(i,!0,null,{capitalize:!1})},this.createOutfitHeader=function(){var i=t.tLang("clan_outfits");e.find(".outfit-header").html(i)},this.sendMoneyToTreasure=function(){var i=e.find(".amount-send-gold"),n=removeSpaces(i.val()),a=parsePrice(n);if(!checkInputValIsEmptyProcedure(a)&&checkParsePriceValueIsCorrect(a)){var s=_t("gold_deposit_confirm %amount%",{"%amount%":round(a,10)},"clan");t.alert(s,(function(){_g("clan&a=save&f=gold&v="+a,(function(){i.val("")}))}))}},this.sendMoneyToPlayer=function(){var i=e.find(".amount-send-gold"),n=t.wnd.$.find(".choose-player .menu-option"),a=n.attr("value"),s=removeSpaces(i.val()),r=n.html(),o=parsePrice(s);if(!checkInputValIsEmptyProcedure(o)&&checkParsePriceValueIsCorrect(o)){var l=_t("gold_widthdraw %amount% %player%",{"%amount%":round(o,10),"%player%":r},"clan");t.alert(l,(function(){_g("clan&a=save&f=gold&v=-"+o+"&pid="+a,(function(){i.val("")}))}))}},this.sendSLToTreasure=function(){const i=e.find(".amount-send-sl"),n=_t("credits_in %amount%",{"%amount%":i.val()},"clan"),a=removeSpaces(i.val());t.alert(n,(function(){_g("clan&a=save&f=credits&v="+a,(function(){i.val("")}))}))},this.toDressOutfit=function(){_g("clan&a=wear")},this.allowSendSl=function(){var i=[t.tLang("put_sl_off"),t.tLang("put_sl_on")],n=1&t.getProp("bits")?1:0,a=e.find(".send-sl");n?(a.find(".label-info").removeClass("disabled"),a.find(".send-sl-but .button").removeClass("disable"),a.find(".amount-send-sl").attr("disabled",!1)):(a.find(".label-info").addClass("disabled"),a.find(".send-sl-but .button").addClass("disable"),a.find(".amount-send-sl").attr("disabled",!0)),e.find(".on-off-send-sl").find(".label").html(i[+!n])},this.availableOutfit=function(){var i=[t.tLang("outfit_disable"),t.tLang("outfit_enable"),t.tLang("how-get")],n=["none","block"],a=2&t.getProp("bits")?1:0;e.find(".to-dress-but").css("display",n[a]),e.find(".to-dress-available").html(i[a]),e.find(".not-dress-but").css("display",n[+!a]),this.createOutfit(a)},this.createOutfit=function(e){var i=t.getProp("id"),n=isPl()?"":"com/",a=["clan/"+n+Engine.worldConfig.getWorldName()+"_"+i+"m.gif",0,"clan/"+n+Engine.worldConfig.getWorldName()+"_"+i+"f.gif",73],s=!!e&&a;t.updateClanOutfit(s)},this.onOffSendSl=function(){var e=t.getProp("bits");_g("clan&a=credits&allow="+(1&e?0:1))}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i=this;this.update=function(){this.createRankEditTable(),this.updateSocGroup(),this.updateSocPass(),this.showOrHideRight(),$(".scroll-wrapper",e).trigger("update")},this.initInputMask=()=>{setOnlyPositiveNumberInInput(e.find(".add-id"))},this.init=function(){e=n.get("clan-manage-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".table-header-wrapper",e)}),i.initLabels(),i.initPlaceHolders(),i.rankEditHeader(),i.createButs(),i.createMenu(),i.initInputMask()},this.updateSocPass=function(){var i=t.getProp("socplay_pass"),n=e.find(".soc-fill-pass").parent(),a=e.find(".soc-pass-name").parent(),s=e.find(".remove-soc-pass-but"),r=e.find(".save-soc-pass-but");this.showOrHide(i,n,a,s,r),a.find(".soc-pass-name").html("********")},this.updateSocGroup=function(){var i=t.getProp("socplay_group"),n=e.find(".soc-fill-gr").parent(),a=e.find(".soc-group-name").parent(),s=e.find(".remove-soc-gr-but"),r=e.find(".save-soc-gr-but");this.showOrHide(i,n,a,s,r),a.find(".soc-group-name").html(i)},this.showOrHide=function(t,e,i,n,a){var s=[["none","table-cell"],["table-cell","none"]],r=t?s[1]:s[0];e.css("display",r[1]),i.css("display",r[0]),n.css("display",r[0]),a.css("display",r[1])},this.showOrHideRight=function(){var i=["none","block"],n=t.getProp("myrank"),a=1&n?1:0;e.find(".change-clan-name").css("display",i[a]),e.find(".dissolve-clan").css("display",i[a]),e.find(".add-rank").css("display",i[a]),e.find(".right-content").css("top",a?"209px":"156px"),a=1&n?0:1,e.find(".leave-clan").css("display",i[a]),a=8&n?1:0,e.find(".invite-to-clan").css("display",i[a])},this.createRightRecords=function(){var i=e.find(".rank-edit-table"),n=t.getProp("ranks");for(var a in n){var s=this.createRightsTr(a,n[a]);i.prepend(s)}},this.createRightsTr=function(e,i){for(var n,a=[e,i.name],s=t.getProp("myrank"),r=0;r<12;r++){if(r<9){var o=i.r&Math.pow(2,r);n=$("<div>").addClass(o?"enable":"disable")}else{var l=t.amountNumericalRights(r,i.r);n=l||$("<div>").addClass("disabled")}a.push(n)}return 1&s&&a.push(this.createEditRankBut(e,i.name)),t.createRecords(a,"normal-td")},this.createButs=function(){var e=[t.tLang("cl_name_save"),t.tLang("dissolve"),t.tLang("inviteClan"),t.tLang("set_soclpay_group_url"),t.tLang("set_soclpay_group_pwd"),t.tLang("addClan"),t.tLang("unset_soclpay_group_pwd"),t.tLang("leave")],i=t.addControll(e[0],"change-clan-name-but",this.changeClanName),n=t.addControll(e[1],"dissolve-but",this.dissolveClan),a=t.addControll(e[4],"save-soc-pass-but",this.saveSocPass),s=t.addControll(e[5],"add-id-but",this.addNewRank),r=t.addControll(e[6],"remove-soc-gr-but",this.deleteSocGroup),o=t.addControll(e[6],"remove-soc-pass-but",this.deletePassGroup),l=t.addControll(e[7],"leave-but",this.leaveClan);i.add(a).add(s).addClass("small green"),n.add(r).add(o).add(l).addClass("small")},this.changeClanName=function(){var t=e.find(".new-clan-name"),i=e.find(".paid-kind>.bck span").attr("value"),n=parseInt(i)?"&pay=self":"";_g("clan&a=save&f=name&v="+esc(t.val())+n,(function(){t.val("")}))},this.dissolveClan=function(){if(t.getProp("gold")>0){var e=t.tLang("disband_gold_info");t.alert(e,i.dissolveClanReq)}else i.dissolveClanReq()},this.dissolveClanReq=function(){var i=e.find(".confirm-dissolve").val();_g("clan&a=disband&agree="+i,(function(){"OK"==i&&(t.close(),delete Engine.hero.d.clan)}))},this.leaveClan=function(){var i=e.find(".confirm-leave").val();_g("clan&a=leave&agree="+i,(function(){"OK"==i&&t.close(),delete Engine.hero.d.clan}))},this.deleteSocGroup=function(){_g("clan&a=save&f=socplay_group&v=")},this.saveSocPass=function(){var t=e.find(".soc-fill-pass");t.val()?_g("clan&a=save&f=socplay_pass&v="+t.val(),(function(){t.val("")})):_g("clan&a=save&f=socplay_pass&v=")},this.deletePassGroup=function(){_g("clan&a=save&f=socplay_pass&v=")},this.addNewRank=function(){var t=e.find(".add-id"),i=e.find(".add-name-rank");_g("clan&a=rank&a2=add&rid="+t.val()+"&name="+esc(i.val())+"&r=0",(function(){t.val(""),i.val("")}))},this.createMenu=function(){var i=[{text:t.tLang("clan_sl"),val:0},{text:t.tLang("private_sl"),val:1}];e.find(".paid-kind").createMenu(i,!0)},this.initPlaceHolders=function(){for(var i=[".new-clan-name",t.tLang("new_clan_name"),".confirm-dissolve",t.tLang("ok_to_confirm"),".player-nick",t.tLang("player_nick"),".add-id",t.tLang("rank_id"),".add-name-rank",t.tLang("rank_n"),".soc-fill-pass",t.tLang("soclpay_group_pwd"),".soc-fill-gr",t.tLang("soclpay_group_url"),".confirm-leave",t.tLang("ok_to_confirm")],n=0;n<i.length;n+=2)t.createPlaceHolder(i[n],i[n+1],e)},this.initLabels=function(){var i=[t.tLang("clan_name_change"),t.tLang("clan_resolve"),t.tLang("clan_invite_new"),t.tLang("socplay_opts"),t.tLang("clan_leave"),t.tLang("add_new_clan_rank")];e.find(".change-clan-name>.label-info").html(i[0]),e.find(".dissolve-clan>.label-info").html(i[1]),e.find(".leave-clan>.label-info").html(i[4]),e.find(".invite-to-clan>.label-info").html(i[2]),e.find(".add-rank>.label-info").html(i[5])},this.rankEditHeader=function(){var i=t.tLang("clan_rangs");e.find(".rank-edit-header").html(i)},this.createRankEditTable=function(){var t=e.find(".rank-edit-table-header"),i=e.find(".rank-edit-table"),n=this.createRankTabHeader();i.html(""),this.createRightRecords(),t.html(n)},this.createRankTabHeader=function(){for(var e=t.getProp("myrank"),i=[t.tLang("rank_id_upper"),t.tLang("rank_n")],a=t.getClanRankInf(),s=0;s<12;s++){var r=n.get("clan-icon");i.push(r),r.css("background",`url("../img/gui/clan_icons.png?v=${__build.version}") no-repeat `+-24*s+"px 0"),r.tip(a[s])}return 1&e&&i.push(""),t.createRecords(i,"table-header-icon")},this.createEditRankBut=function(e,i){var a=n.get("button").addClass("small green"),s=n.get("add-bck");return a.append(s),a.tip(t.tLang("redit_td")),a.click((function(){t.updateHeader(_t("edit_rank %name%",{"%name%":i},"clan")),t.showChooseCard("clan","clan-rank-edit"),t.updateRankEdit([e,i])})),a}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i=this;this.update=function(){i.showHistory(!0)},this.init=function(){this.initContent(),this.initButs()},this.initContent=function(){e=n.get("clan-history-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".table-header-wrapper",e)})},this.initButs=function(){var e=[t.tLang("hist_filter_depo"),"witch-depo",t.tLang("hist_filter_nodepo"),"without-depo"];t.addControll(e[0],e[1],(function(){i.showHistory(!0)})).addClass("green"),t.addControll(e[2],e[3],(function(){i.showHistory(!1)})).addClass("green")},this.showHistory=function(n){var a=e.find(".history-table-header"),s=e.find(".history-table"),r=i.createHeaderTable();s.html("");var o=t.getProp("goldlog");for(var l in o){var c=o[l];if(!i.checkContinue(c,n)){var d=i.splitString(c),h=convertDateTime(d[0]),u=t.createRecords([h,d[1]],"normal-td");s.append(u)}}a.html(r),i.setButDisable(n),$(".scroll-wrapper",e).trigger("update")},this.splitString=function(t){var e=t.txt.split(/](.+)/);return e[0]=e[0].replace("[",""),e},this.checkContinue=function(t,e){if(!isset(t.txt))return!0;var i=new RegExp("depozyt zak�|z depozytu|do depozytu,","gi");return t.txt.match(i)&&!e||"depo"==t.kind&&!e},this.setButDisable=function(t){var i=e.find(".witch-depo>.button"),n=e.find(".without-depo>.button"),a=t?i:n;i.add(n).removeClass("black").addClass("green"),a.removeClass("green").addClass("black")},this.createHeaderTable=function(){var e=[t.tLang("date_time"),t.tLang("clan_action")];return t.createRecords([e[0],e[1]],"table-header")}}},function(t,e){t.exports=function(){var t,e=this;this.frame=0,this.demoInterval=null,this.update=function(t,e,i){this.demoInterval||(this.initCanvas(t),this.initImg(e,i),this.startDemo())},this.initCanvas=function(e){t=e.find(".clan-outfit")[0].getContext("2d"),e.find(".clan-outfit").attr("width","165px"),e.find(".clan-outfit").attr("height","115px")},this.initImg=function(t,i){Engine.imgLoader.onload(CFG.a_opath+t,!1,t=>{e.slot=0,e.rotation=!0,e.rx=30+i,e.ry=55},t=>{e.fw=t.width/4,e.fh=t.height/4,e.img=t,(48<e.fw||75<e.fh)&&(e.rotation=!1)})},this.startDemo=function(){this.demoInterval=setInterval((function(){e.frame=e.frame+1&15;var t=(3&e.frame)*e.fw,i=e.frame>>2;2==i?i=3:3==i&&(i=2),i*=e.fh,e.sy=i,e.sx=t,e.draw()}),400)},this.draw=function(){var i=e.rx,n=e.ry;t.clearRect(i,n,e.fw,e.fh),e.img&&t.drawImage(e.img,e.sx,e.sy,e.fw,e.fh,i,n,e.fw,e.fh)},this.remove=function(){t&&(clearInterval(e.demoInterval),t.clearRect(e.rx,e.ry,e.fw,e.fh))}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a,s=this,r=!0;this.update=function(t){this.clearQuestsList(),this.resetLastQuestState(),this.createQuests(t),this.updateScroll(),this.hideOrShowFinished(),this.initQuestHeader()},this.initToogleShowBtn=function(){var t=n.get("button").addClass("small green");e.find(".toggle-show").append(t),t.click((function(){r=!r,s.hideOrShowFinished(),s.updateScroll()}))},this.hideOrShowFinished=function(){var i=r?"none":"block";e.find(".complete-and-unactive-quests").css("display",i);var n=e.find(".toggle-show").find(".label"),a=(r?"show":"hide")+"-finish";n.html(t.tLang(a))},this.createQuests=function(t){var n=e.find(".scroll-pane");for(var s in i=0,a=0,t)this.createOneQuest(s,t[s],n),t[s].finished&&a++,i++},this.clearQuestsList=function(){e.find(".one-clan-quest").remove()},this.createOneQuest=function(e,i,a){var s=n.get("one-clan-quest"),r=i.finished,o=1==i.active||"bring"==i.task&&!r,l=i.task,c=this.getQuestStatus(o,l,r),d=t.tLang(i.task),h=1==o?".active-quests":".complete-and-unactive-quests",u=i.done/i.todo;if(h=1==o?".active-quests":r?".complete-quests":".unactive-quests",s.addClass(c+" "+e),s.find(".quest-header").html(i.title),s.find(".quest-content").html(i.description),s.find(".progress-text").html(d+" "+i.done+" / "+i.todo),s.find(".quest-state").html(t.tLang(c)).addClass(c),s.find(".quest-percent").html(Math.round(100*u)+"%"),setPercentProgressBar(s.find(".background-bar"),100*u),this.createAllMeasure(s.find(".clan-progress-bar")),o&&isset(i.gold)&&this.buyQuest(i.gold,s),r||"bring"!=l||this.giveItem(e,i,s),"kill"==l){for(var p="",g=0;g<i.kill_names.length;g++)p+=i.kill_names[g]+", ";var f=p.slice(0,p.length-2),m=n.get("info-icon").addClass("small-info").tip(f);s.find(".quest-progress").append(m)}a.find(h).append(s)},this.createAllMeasure=function(t){for(var e=$("<div>").addClass("measure-wrapper"),i=0;i<9;i++)e.append($("<div>").addClass("measure"));t.append(e)},this.resetLastQuestState=function(){;""},this.getQuestStatus=function(t,e,i){return i?"quest_completed":t?"quest_active":"quest_unactive"},this.buyQuest=function(t,e){this.createBuyPanel(e,t)},this.createBuyPanel=function(e,i){var a="",r=!1,o=s.canUse(),l=round(i,5),c=e.find(".right-side");o||(a+=""!=a?"<br><br>":"",a+=t.tLang("clan_quests_can_use"),r=!0),t.getProp("gold")<i&&(a+=""!=a?"<br><br>":"",a+=_t("notEnoughGold"),r=!0);var d=r?"black":"",h=n.get("button").addClass("small green "+d),u=t.tLang("buy_quest")+'<span class="small-money"></span>'+l,p=$("<div>").addClass("quest-buy-wrapper");h.tip(a),h.find(".label").html(u),p.append(h),c.append(p),r||h.click(s.buyQuestAlert)},this.canUse=function(){return 1&t.getProp("myrank")?1:0},this.buyQuestAlert=function(){s.canUse()&&_g("clan&a=buy_quest&ans=-1")},this.giveItem=function(t,e,i){"bring"==e.task&&this.createGiveItemPanel(t,e,i)},this.createGiveItemPanel=function(e,i,a){var r=a.find(".quest-bring-item-wrapper"),o=n.get("quest-bring-item");r.append(o),setOnlyPositiveNumberInInput(o.find("input"));var l=o.find("input");l.attr("quest-clan-id",e),l.focusout((function(){var t=parseInt($(this).val());(!t||!Number.isInteger(t)||t<0)&&$(this).val("")}));var c=n.get("button").addClass("small green");o.find(".give-item-btn").append(c),o.find(".item-wrapper").addClass("item-id-"+i.bring_tpl),c.find(".label").html(t.tLang("give_item")),c.click((function(){s.giveItemAlert(l)}))},this.giveItemAlert=function(e){var i=e.val();if(0==i)return mAlert(_t("fill_area_how_items"));var n=_t("give_q_item"+(i>4?1:i>1?2:3)+" %amount%",{"%amount%":i},"clan");t.alert(n,(function(){var t=e.attr("quest-clan-id");_g("clan&a=bring&id="+t+"&amount="+i,(function(){e.val("")}))}))},this.updateScroll=function(){$(".scroll-wrapper",e).trigger("update")},this.init=function(){this.initContent(),this.initToogleShowBtn(),this.initFetch()},this.initQuestHeader=function(){e.find(".complete-quest-amount").html(_t("finishClanQuests")+" "+a+"/"+i);var t=$("<div>").addClass("small-header-info info-icon");t.tip(_t("one_quest_clan_skill_point")),e.find(".complete-quest-amount").append(t)},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_BRING_CLAN_QUEST_TPL,s.newBringItem)},this.newBringItem=function(t){e.find(".item-id-"+t.id).each((function(){let e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.BRING_ITEM_CLAN_VIEW,"q")[0];$(this).append(e)}))},this.initContent=function(){e=n.get("clan-quests-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0})}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i=this;this.amountPoint=0;var a=["expBonus","healPower","questExpBonus"],s=["timeTickets"];this.update=function(t){this.amountPoint=t.points,this.showOrHideResetBtn(),this.clearContent(),this.createSkills(t.quest_bonuses,t.quest_bonuses_use),this.updateHeader(),this.updateHeadingText(),this.showOrHideAddBtn(),this.updateScroll()},this.skillsWithMinutes=function(t){return s.indexOf(t)>-1?" min":""},this.skillsWithPercent=function(t,e){var i=a.indexOf(t)>-1,n=e.val;return i?100*n+"%":n},this.showOrHideResetBtn=function(){var t=i.canUse(),n=e.find(".clan-skill-reset>.button");n.css("display","none"),t&&n.css("display","block")},this.createSkills=function(t,i){var n=e.find(".clan-skills-container");for(var a in t)this.createOneSkill(a,t[a],i,n)},this.createOneSkill=function(e,i,a,s){var r,o=n.get("one-clan-skill"),l=this.addPointBtn(o,e,i),c=i.type,d=a[e],h=i.val;switch(r=this.skillsWithPercent(e,i),r+=this.skillsWithMinutes(e,i),this.createSklillBckLevel(o,i),this.createProgresLevel(o,i),o.addClass(e+"-skill"),o.find(".skill-icon").addClass(e),o.find(".skill-clan-name").html(t.tLang(e)),o.find(".skill-clan-description").html(t.tLang(e+"description")),o.find(".skill-actual-val").html("<b>"+t.tLang("skill-actual-val")+" "+r+"</b>"),o.find(".skill-clan-buts-add-point").append(l),c){case 0:break;case 1:var u=this.createShowBlessBtn(d);o.find(".skill-increase-decrease").empty().append(u);break;case 2:var p=this.onOffButton(e,i,d);o.find(".skill-clan-buts-turn-on-off").append(p);break;case 3:var g=this.increaseDecreaseButton(e,i,d,h);o.find(".skill-increase-decrease").append(g)}s.append(o)},this.createProgresLevel=function(t,e){for(var i=e.lvl,a=e.maxlvl,s=t.find(".skill-slots-wrapper"),r=t.find(".skill-points-wrapper"),o=0;o<a;o++){var l="";l=0==o?"left":o!=a-1?"middle":"right",(c=n.get("empty-lvl")).addClass(l),s.append(c)}for(o=0;o<i;o++){var c=n.get("use-lvl");r.append(c)}},this.increaseDecreaseButton=function(e,a,s,r){var o=n.get("button"),l="",c=!1;return o.find(".label").html(t.tLang("show_blesses")),o.addClass("green small"),s&&(c=!0,l+=_t("skillBonusUsed")+"<br>"),0==r&&(c=!0,l+=_t("notBuySkill")+"<br>"),c?(o.addClass("black"),o.tip(l),o):(o.click((function(){var t=n.get("increase-decrease-stamina"),a=t.find(".stamina-pay-options"),s=n.get("button").addClass("small green"),r=n.get("button").addClass("small green");a.append(r),a.append(s),s.find(".label").html(_t("decrease")),r.find(".label").html(_t("increase")),mAlert(t,[{txt:_t("cancel"),hotkeyClass:"alert-cancel-hotkey",callback:function(){return!0}}],(function(t){i.initClick(s,"sub",e,2,t),i.initClick(r,"add",e,1,t)}))})),o)},this.initClick=function(t,e,i,n,a){t.on("click",(function(t){t.stopPropagation(),mAlert(_t("new_stamina_alert_"+e),[{txt:_t("yes"),callback:function(){return _g("clan&a=skills_use&name="+i+"&opt="+n),a.close(),!0}},{txt:_t("cancel"),callback:function(){return!0}}])}))},this.onOffButton=function(t,e,i){var a,s=n.get("button").addClass("small"),r=0==e.lvl;return i?(s.find(".label").html(_t("turn_off",null,"loot")),a=2):(s.find(".label").html(_t("turn_on",null,"loot")),s.addClass("green"),a=1),r?(s.addClass("black"),s.tip(_t("notBuySkill")),s):(s.click((function(){_g("clan&a=skills_use&name="+t+"&opt="+a)})),s)},this.createSklillBckLevel=function(t,e){var i=t.find(".skill-level-bck"),n=t.find(".skill-level"),a=e.maxlvl,s=e.lvl,r=Math.round(6*s/a),o=s>0?"chosen":"";n.html(s+"/"+a).addClass(o),i.addClass("cl-"+r)},this.canUse=function(){return 1&t.getProp("myrank")?1:0},this.addPointBtn=function(e,a,s){var r=i.canUse(),o="",l=!1,c=s.maxlvl==s.lvl;if(r||(l=!0,o+=t.tLang("clan_skills_can_use")),c)return e.find(".skill-clan-buts-label").css("display","none"),null;0!=i.amountPoint||c||(l=!0,o+=""!=o?"<br><br>":"",o+=_t("skillPointsNotExist")),t.getProp("gold")<s.nextcost&&(l=!0,o+=""!=o?"<br><br>":"",o+=_t("notEnoughGold"));var d=l?"black":"",h=n.get("button").addClass("small green "+d);return h.tip(o),h.find(".label").html(_t("uprage_clan_skill")+'<span class="small-money"></span>'+round(s.nextcost,2)),l||h.click((function(){var t=[{txt:_t("yes",null,"buttons"),callback:function(){return _g("clan&a=skills_upgrade&name="+a),!0}},{txt:_t("cancel"),callback:function(){return!0}}],e=_t("acceptSkillupgrade",{"%cost%":round(s.nextcost,2)},"clan");mAlert(e,t,(function(t){}))})),h},this.clearContent=function(){e.find(".clan-skills-container").empty()},this.updateScroll=function(){$(".scroll-wrapper",e).trigger("update")},this.init=function(){this.initContent()},this.resetSkilsRequest=function(){i.canUse()&&_g("clan&a=skills_reset")},this.showOrHideAddBtn=function(){var t=["none","table-cell"],n=i.amountPoint>0?t[1]:t[0];e.find(".skill-upgrade").css("display",n)},this.initContent=function(){e=n.get("clan-skills-content"),t.wnd.$.find(".card-content").append(e),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.updateHeader=function(){var a=e.find(".clan-skill-header"),s='<span class="'+(i.amountPoint>0?"green":"red")+'">'+i.amountPoint+"</span>",r=n.get("info-icon").addClass("small-header-info"),o=t.tLang("points_left");r.tip(_t("one_clan_skill_point")),a.html(o+s),a.append(r)},this.updateHeadingText=function(){var i,n=e.find(".clan-skill-heading-text").hide().clone().show();i=this.canUse()?t.tLang("choose_skillpoints"):t.tLang("only_leader"),n.html(i),e.find(".clan-skills-container").prepend(n)},this.createShowBlessBtn=function(e){var a=t.tLang("show_blesses"),s=n.get("button").addClass("small green");return s.find(".label").html(a),s.click(i.showBless),s},this.showBless=function(){_g("clan&a=skills_use&name=blessing");var e=t.tLang("clan_blesses");t.showChooseCard("clan","clan-bless"),t.updateHeader(e)}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a,s,r=this,o=0,l=!0,c=null;this.update=function(n){i=n.cur_page,n.clans_count,n.clans_per_page,s=n.max_page;var o=n.id.length,l=e.find(".clan-list-table-header"),c=e.find(".clan-list-table");1==i&&(l.empty(),c.empty(),a=!0),i==s&&(a=!1);for(var d=0;d<o;d++){var h=n.id[d],u=n.name[d],p=$("<span/>",{text:u}),g=n.level[d],f=n.members_count[d],m=(n.attributes[d],10*(n.attributes[d]>>2&31)),v=300-10*(n.attributes[d]>>7&31),E=this.getRectruit(n.attributes[d],h,m,v),_="normal-td",b=t.createRecords([p,g,f,m,E],["clan-name-td "+_,"clan-lvl-td "+_,"clan-members-td "+_,"clan-minlvl-td "+_,_]);b.addClass("hover one-clan-tr clan-id-"+h),r.trClick(b,h),r.addIdToMyClan(b,u),c.append(b),$(".scroll-wrapper",e).trigger("updateBarPos")}if(1==i){var w=this.createTabHeaderClanList();l.prepend(w),this.createHeaderSortButtons(),$(".scroll-wrapper",e).trigger("update")}},this.getGetNextPage=function(){a&&($(".scroll-wrapper",e).trigger("stopDragBar"),r.sendRequest(i+1))},this.getRectruit=function(e,i,a,s){let r=e>>21&3;if(0==r)return _t("close_recruit");{let e,c,d=Engine.hero.d.lvl,h=d<a,u=void 0!==Engine.hero.d.clan;c=!(300==s&&d>300)&&d>s;var o=h||c||u?"inactive":"",l=n.get("button").addClass("small green "+o);return u?e=_t("in_clan",null,"clan"):c?e=_t("to_high_lvl",null,"clan"):h&&(e=_t("to_low_lvl",null,"clan")),l.tip(e),2==r?(l.find(".label").html(_t("Join_now")),h||c||u||l.click((function(e){e.stopPropagation(),_g("clan&a=join&id="+i,(function(){t.close()}))}))):(l.find(".label").html(_t("Apply_now")),h||c||u||l.click((function(t){t.stopPropagation(),_g("clan&a=apply&id="+i)}))),l}},this.createSkills=function(t,e){return{maxParticipants:{lvl:t.maxParticipants[e]},expBonus:{lvl:t.expBonus[e]},questExpBonus:{lvl:t.questExpBonus[e]},allyEnemyCount:{lvl:t.allyEnemyCount[e]},blessing:{lvl:t.blessing[e]},cursedItem:{lvl:t.cursedItem[e]},healPower:{lvl:t.healPower[e]},timeTickets:{lvl:t.timeTickets[e]}}},this.writeDataInElement=function(e,i,n,a,s,r){var o=t.getClanAtributs().getMapOfBits(i,n,a,s,r);e.data("atribute",o)},this.addIdToMyClan=function(e,i){i==t.getProp("name")&&e.addClass("my-clan-list-clan")},this.trClick=function(t,e){t.on("click",(function(){_g("clan&a=getclan&id="+e)}))},this.createLogo=function(t){var e=$("<td>").addClass("logo");return e.css({background:"url("+t+")","background-size":"100% 100%"}),e},this.createTabHeaderClanList=function(){var e=t.getClanInf(),i=t.tLang("recruitment"),n=t.tLang("min_level");return t.createRecords([e[0],e[1],e[2],n,i],"hover-header header-sort")},this.createHeaderSortButtons=function(){for(var t=e.find(".clan-list-table-header tr"),i=0;i<5;i++)this.clickSort(t,i)},this.clickSort=function(t,e){var i=t.children().eq(e);0===e&&r.setArrows(e,!0),i.click((function(){o==e?l=!l:(o=e,l=!0),r.sendRequest(1)}))},this.sendRequest=function(t,i){var n=esc(e.find(".clan-name-input").val()),a=l?1:0;_g("clan&a=list&page="+t+"&sort="+o+"&ascending="+a+(""===n?"":"&search="+n)+(i||""),()=>{r.setArrows(o,a)})},this.setArrows=(t,i)=>{const n=e.find(`.clan-list-table-header tr td:eq(${t})`),a=i?"header-sort--asc":"header-sort--desc";n.addClass(a),n.siblings("td").removeClass("header-sort--asc header-sort--desc")},this.init=function(){e=n.get("clan-list-content"),t.wnd.$.find(".card-content").append(e),$(".first-scroll-wrapper",e).addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".table-header-wrapper",e),callback:r.getGetNextPage}),r.initInputSearch()},this.initInputSearch=function(){var t=e.find(".clan-name-input"),i=e.find(".search-x");t.keyup((function(){c?(clearTimeout(c),c=null,r.createTimeout()):r.createTimeout()})),i.on("click",(function(){t.val("").blur().trigger("keyup")}))},this.createTimeout=function(){c=setTimeout((function(){r.sendRequest(1)}),300)},this.toBinary=function(t){return(t>>>0).toString(2)}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a=this;this.init=function(){this.initContent(),this.initAttrTab(),this.createFindPanel(),this.createShowFindPanelBtn(),this.hideElements()},this.hideElements=function(){e.find(".atribute-value-wrapper").css("display","none")},this.initContent=function(){e=n.get("clan-list-find-panel"),t.wnd.$.find(".clan-list-content").append(e),$(".clan-list-find-content").addScrollBar({track:!0})},this.initAttrTab=function(){var e=t.getClanAtributs();i=e.getAttrDataTab()},this.createFindPanel=function(){this.createHideBtn(),this.createFindBtn(),this.createFindPanelHeaders(),this.createAllAtributes()},this.createAllAtributes=function(){var n=e.find(".clan-list-find-content"),a=t.getClanAtributs();for(var s in i)"empty"!=i[s].name&&a.createAtribute(n,s,e,!1,!0)},this.createFindPanelHeaders=function(){var i="clan-find-header-";e.find("."+i+0).html(t.tLang(i+0)),e.find("."+i+1).html(t.tLang(i+1)),e.find("."+i+2).html(t.tLang(i+2)),e.find(".clan-list-find-header").html(t.tLang("advanced-find"))},this.showFindPanel=function(){e.toggleClass("active")},this.hideFindPanel=function(){e.removeClass("active")},this.createShowFindPanelBtn=function(){var e=n.get("button").addClass("small green"),i=t.tLang("filter"),s=t.wnd.$;e.click(a.showFindPanel),e.find(".label").html(i),s.find(".clan-list-show-btn").append(e)},this.createHideBtn=function(){var t=n.get("button").addClass("small green"),i=_t("hide");t.find(".label").html(i),t.click(a.hideFindPanel),e.find(".clan-list-hide-btn").append(t)},this.createFindBtn=function(){var t=n.get("button").addClass("small green"),i=_t("search");t.find(".label").html(i),t.click(a.sortAttrClans),e.find(".clan-list-find-btn").append(t)},this.sortAttrClans=function(){var e="&filters="+a.getFilter().join("");t.getClanList().sendRequest(1,e),a.hideFindPanel()},this.checkClanMatch=function(t,e,n){var s=!0;for(var r in n){var o="is"+(isset(i[r].find)?i[r].find:"Equal"),l=this.getLookingForVal(n[r],r);if(!a[o](e[r],l)){s=!1;break}}s||t.addClass("hide")},this.getLookingForVal=function(t,e){var n=i[e].range;return n?n[3]?Math.abs((t-n[1])/n[2]):(t-n[0])/n[2]:t},this.isEqual=function(t,e){return parseInt(t,2)==e},this.isBiggerOrEqual=function(t,e){return parseInt(t,2)>=e},this.isLesserOrEqual=function(t,e){return parseInt(t,2)<=e},this.getFilter=function(){var t=new Array(15);for(var n in i){var a=i[n].clanListFilter;if("empty"!=i[n].name){var s,r=i[n].input,o=e.find(".input-val-"+n);switch(r){case"i":s=o.val();break;case"m":s=o.attr("value");break;case"c":s=o.find(".active").attr("value")}t[a]=""!=s?s+"|":"|"}}return t}}},function(t,e,i){var n=i(0);const{showProfile:a}=i(2),s=i(36);t.exports=function(t,e){var i,a,r,o=this;this.initCards=function(){r=[["recruit-main",o.updateScroll],["recruit-candidate",o.clickCuruitCandidate],["recruit-invite",o.clickRecruitInvite]]},this.updateScroll=function(){$(".scroll-wrapper",i).trigger("update")},this.init=function(){this.initContent(),this.initCards(),this.initMenu(),this.initTexts(),this.initAttrTab(),this.initTableHeaders(),this.initInviteBut(),e||this.initSaveAttrBtn()},this.initButtonsWrapper=function(){var t=n.get("button").addClass("small green"),e=n.get("button").addClass("small");t.find(".label").html(_t("accept_all")),e.find(".label").html(_t("refuse_all")),i.find(".buttons-wrapper").append(t),i.find(".buttons-wrapper").append(e),t.click((function(){})),e.click((function(){}))},this.clickCuruitCandidate=function(){_g("clan&a=recruit_applications_show")},this.clickRecruitInvite=function(){_g("clan&a=invite_show")},this.getContent=function(){return i},this.initMenu=function(){for(var t=i.find(".clan-recruit-menu").find(".cards-header"),e=0;e<r.length;e++)o.createRecruitCardMenu(r[e],t)},this.inviteToClan=function(){var t=i.find(".player-nick");let e=t.val();checkInputValIsEmptyProcedure(e)||_g("clan&a=invite&n="+esc(e),(function(){t.val("")}))},this.initInviteBut=function(){(t.getProp("myrank")&Math.pow(2,3)?1:0)?(i.find(".invite-to-clan").find(".input-wrapper").css("display","table-cell"),i.find(".invite-to-clan").find(".label-info").html(t.tLang("clan_invite_new")),t.addControll(t.tLang("inviteClan"),"invite-but",o.inviteToClan).addClass("green small")):i.find(".js-rank-hide").css("display","none")},this.createRecruitCardMenu=function(e,i){var a=e[0],s=e[1],r=t.tLang(a),l=n.get("card").addClass("card-"+a);l.find(".label").html(r),i.append(l),l.click((function(){if(("recruit-candidate"==a||"recruit-invite"==a)&&!(t.getProp("myrank")&Math.pow(2,3)?1:0))return void mAlert(_t("accessDenied"));o.showSection(a),s&&s()}))},this.initTableHeaders=function(){var e=[_t("date",null,"matchmaking"),"Nick",_t("th_levelAndProf",null,"clan"),_t("prof_th",null,"auction"),_t("decision",null,"clan"),_t("invitedBy",null,"clan"),_t("delete",null,"clan")],n=t.createRecords([e[0],e[1],e[2],e[4]],"table-header"),a=t.createRecords([e[0],e[1],e[2],e[5],e[6]],"table-header");i.find(".recruit-candidate-table-header").html(n),i.find(".recruit-invite-table-header").html(a)},this.showSection=function(t){i.find(".card").removeClass("active"),i.find(".card-"+t).addClass("active"),i.find(".recruit-section").removeClass("active"),i.find(".section-"+t).addClass("active")},this.update=function(t,e){e?this.updateAtributes():(t.clan_applications&&this.updateClanApplications(t.clan_applications),t.clan_invitations&&this.updateClanInvitations(t.clan_invitations),o.updateScroll())},this.updateClanApplications=function(t){var e=i.find(".recruit-candidate-table");for(var n in e.find(".one-applicant").remove(),t){var a=t[n];this.createOneTr(a,e)}},this.updateClanInvitations=function(t){var e=i.find(".recruit-invite-table");for(var n in e.find(".one-invitation").remove(),t){var a=t[n];this.createOneTrInvitation(a,e)}},this.createOneTr=function(e,a){var s=n.get("button").addClass("small green"),r=n.get("button").addClass("small"),o=n.get("clan-recruit-buttons-wrapper"),l=this.createNickElement(e),c=t.createRecords([convertDateTime(e.send_ts,!0),l,e.recruit_lvl+e.recruit_prof,o],"normal-td");c.addClass("one-applicant"),s.find(".label").html(_t("accept_applicant")),r.find(".label").html(_t("refuse_applicant")),o.append(s),o.append(r),i.find(".section-recruit-candidate").find(".recruit-candidate-table").append(c),a.append(c),s.click((function(){_g("clan&a=recruit_applications_accept&id="+e.id)})),r.click((function(){_g("clan&a=recruit_applications_reject&id="+e.id)}))},this.createOneTrInvitation=function(e,a){var s=n.get("button").addClass("small red"),r=n.get("add-bck").addClass("remove2"),o=n.get("clan-recruit-buttons-wrapper"),l=this.createNickElement(e),c=t.createRecords([convertDateTime(e.send_ts,!0),l,e.recruit_lvl+e.recruit_prof,e.recruiter_nick,o],"normal-td");c.addClass("one-invitation"),s.append(r),o.append(s),i.find(".section-recruit-candidate").find(".recruit-candidate-table").append(c),a.append(c),s.click((function(){_g("clan&a=invite_cancel&id="+e.id)}))},this.updateAtributes=function(){var e=t.getProp("attributes").toString(),i=t.getClanAtributs(),n=t.getProp("quest_bonuses"),a=t.getProp("has_outfit"),s=t.getProp("level"),r=t.getProp("depo_tabs"),o=i.getMapOfBits(e,s,r,n,a),l=1&t.getProp("myrank")?1:0;this.createAllAtributs(o,l,l?"inInput":".atribute-value")},this.createNickElement=t=>{const e=$("<span>",{class:"clickable clickable--p1"}).text(t.recruit_nick);return e.on("contextmenu",e=>{getEngine().others.createOtherContextMenu(e,{lvl:t.recruit_lvl,prof:t.recruit_prof,nick:t.recruit_nick,charId:t.recruit_id,accountId:t.recruit_account},[s.INVITE_TO_ENEMIES,s.INVITE_TO_PARTY])}),e.on("click",()=>{Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(t.recruit_nick)}),e},this.initContent=function(){var a="clan-recruit-content";i=n.get(a),e?(i.removeClass(a).addClass("clan-other-recruit-content"),t.getShowcaseWnd().$.find(".card-content").append(i)):t.wnd.$.find(".card-content").append(i),i.find(".section-recruit-main").find(".scroll-wrapper").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".section-recruit-main .table-header-wrapper",i)}),i.find(".section-recruit-candidate").find(".scroll-wrapper").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".section-recruit-candidate .table-header-wrapper",i)}),i.find(".section-recruit-invite").find(".scroll-wrapper").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".section-recruit-invite .table-header-wrapper",i)})},this.initTexts=function(){(t.getProp("myrank")&Math.pow(2,3)?1:0)&&i.find(".clan-recruit-header-option").html(t.tLang("header-option")),i.find(".clan-recruit-header-atribute").html(t.tLang("header-atribute")),i.find(".clan-recruit-header-0").html(t.tLang("basic_atributes")),i.find(".clan-recruit-header-1").html(t.tLang("additional_atributes")),e&&i.find(".clan-recruit-header-2").html(t.tLang("clan_skills"))},this.initAttrTab=function(){var e=t.getClanAtributs();a=e.getAttrDataTab()},this.initSaveAttrBtn=function(){if(1&t.getProp("myrank")?1:0){var e=n.get("button").addClass("green small"),a=t.tLang("save");e.find(".label").html(a),e.click((function(){t.getClanAtributs().saveAtributes()})),i.find(".save-atributes").append(e)}},this.createAllAtributs=function(n,s,r){var o=i.find(".scroll-pane"),l=t.getClanAtributs();o.find(".one-clan-atribute").remove();var c=!!n&&[n,r];for(var d in a){if(d>99&&!e)break;l.createAtribute(o,d,i,c,s,!0)}this.updateRights()},this.updateRights=function(){var n,a=["none","table-cell"];e?n=a[0]:n=1&t.getProp("myrank")?a[1]:a[0];i.find(".one-clan-atribute").find(".input-wrapper").css("display",n)}}},function(t,e,i){var n=i(0);t.exports=function(t,e){var i,a;this.init=function(){this.initContent(),this.initTexts(),this.initAttrTab()},this.getContent=function(){return i},this.update=function(){var e=t.getProp("attributes").toString(),i=t.getClanAtributs(),n=t.getProp("quest_bonuses"),a=t.getProp("has_outfit"),s=t.getProp("level"),r=t.getProp("depo_tabs"),o=i.getMapOfBits(e,s,r,n,a);this.createAllAtributs(o,!0,"inInput")},this.initContent=function(){i=n.get("clan-other-recruit-content"),t.getShowcaseWnd().$.find(".card-content").append(i),$(".scroll-wrapper",i).addScrollBar({track:!0})},this.initTexts=function(){i.find(".clan-recruit-header-0").html(t.tLang("basic_atributes")),i.find(".clan-recruit-header-1").html(t.tLang("additional_atributes")),i.find(".clan-recruit-header-2").html(t.tLang("clan_skills"))},this.initAttrTab=function(){var e=t.getClanAtributs();a=e.getAttrDataTab()},this.initSaveAttrBtn=function(){var e=n.get("button").addClass("green"),a=t.tLang("save");e.find(".label").html(a),e.click((function(){t.getClanAtributs().saveAtributes()})),i.find(".save-atributes").append(e)},this.createAllAtributs=function(n,s,r){var o=i.find(".scroll-pane"),l=t.getClanAtributs();o.find(".one-clan-atribute").remove();var c=!!n&&[n,r];for(var d in a){if(d>99&&!e)break;l.createAtribute(o,d,i,c,s,!0)}this.updateRights()},this.updateRights=function(){i.find(".input-wrapper").css("display","none")}}},function(t,e,i){var n=i(0);t.exports=function(t){var e=this,i={0:{name:"empty",input:"c",part:0},1:{name:"empty",input:"c",part:0},2:{name:t.tLang("min_level"),input:"i",range:[0,300,10],find:"BiggerOrEqual",part:0,clanListFilter:1},7:{name:t.tLang("max_level"),input:"i",range:[10,300,10,!0],find:"BiggerOrEqual",part:0,clanListFilter:2},12:{name:"empty",input:"i",range:[13,30,1],find:"BiggerOrEqual",part:0},17:{name:"empty",input:"c",part:1},18:{name:"empty",input:"c",part:1},19:{name:t.tLang("clan type"),input:"m",strValues:[t.tLang("neutral"),t.tLang("feature"),t.tLang("war")],part:1,clanListFilter:4},21:{name:t.tLang("recruit_state_new"),input:"m",strValues:[_t("close_recruit"),_t("open_recruit"),_t("free recruitment")],part:1,clanListFilter:0},100:{name:t.tLang("clan_level"),input:"i",range:[0,30,1],find:"BiggerOrEqual",part:0,clanListFilter:3},101:{name:t.tLang("rank_outfit"),input:"c",part:1,clanListFilter:5},102:{name:t.tLang("depocards"),input:"i",range:[0,5,1],part:1,clanListFilter:6},103:{name:t.tLang("maxParticipants"),input:"i",range:[0,8,1],find:"BiggerOrEqual",part:2,clanListFilter:7},104:{name:t.tLang("expBonus"),input:"i",range:[0,10,1],find:"BiggerOrEqual",part:2,clanListFilter:8},105:{name:t.tLang("questExpBonus"),input:"i",range:[0,10,1],find:"BiggerOrEqual",part:2,clanListFilter:9},106:{name:t.tLang("allyEnemyCount"),input:"i",range:[0,10,1],find:"BiggerOrEqual",part:2,clanListFilter:10},107:{name:t.tLang("blessing"),input:"i",range:[0,7,1],find:"BiggerOrEqual",part:2,clanListFilter:11},109:{name:t.tLang("healPower"),input:"i",range:[0,10,1],find:"BiggerOrEqual",part:2,clanListFilter:13},110:{name:t.tLang("timeTickets"),input:"i",range:[0,10,1],find:"BiggerOrEqual",part:2,clanListFilter:14}};this.createAtribute=function(t,e,a,s,r,o){var l=n.get("one-clan-atribute"),c=i[e].input,d=i[e].name,h=i[e].part;if("empty"==i[e].name&&l.addClass("empty"),l.addClass("recruit-attr-id-"+e),t.find(".clan-part-"+h).append(l),l.find(".atribute-name").html(d),r){var u="i"==c?$("<input>"):$("<div>");switch(l.find(".input-wrapper").append(u),c){case"i":this.createTextInput(u,e,a,o),this.createTipToInput(u,e);break;case"m":this.createMenuInput(u,e,o);break;case"c":this.createDivideButton(u,e,o)}}s&&this.setMenuOptionOrTextInputOrDivideOptionOrNormalText(e,l,c,s)},this.setMenuOptionOrTextInputOrDivideOptionOrNormalText=function(t,e,i,n){var a=this.parseValFromBits(t,n[0]);if("inInput"==n[1])switch(i){case"m":var s=(o=e.find(".bck-wrapper>div:contains("+a+")")).html(),r=o.attr("value");e.find(".menu-option").attr("value",r).html(s);break;case"i":e.find("input").val(a);break;case"c":var o=e.find(".option:has(.label:contains("+a+"))");e.find(".bck").removeClass("active"),o.find(".bck").addClass("active")}else e.find(n[1]).html(a)},this.getMapOfBits=function(t,i,n,a,s){var r={0:e.toBinary(1&t),1:e.toBinary(t>>1&1),2:e.toBinary(t>>2&31),7:e.toBinary(t>>7&31),12:e.toBinary(t>>12&31),17:e.toBinary(t>>17&1),18:e.toBinary(t>>18&1),19:e.toBinary(t>>19&3),21:e.toBinary(t>>21&3)};return a?(r[100]=e.toBinary(i),r[101]=""==s?0:1,r[102]=e.toBinary(n),r[103]=e.toBinary(a.maxParticipants.lvl),r[104]=e.toBinary(a.expBonus.lvl),r[105]=e.toBinary(a.questExpBonus.lvl),r[106]=e.toBinary(a.allyEnemyCount.lvl),r[107]=e.toBinary(a.blessing.lvl),r[108]=e.toBinary(a.cursedItem.lvl),r[109]=e.toBinary(a.healPower.lvl),r[110]=e.toBinary(a.timeTickets.lvl),r):r},this.parseValFromBits=function(t,e){var n=i[t],a=n.range,s=n.strValues,r=parseInt(t);return isset(s)?this.getStrValFromBits(e,r):isset(a)?this.rangeOfBits(e,r):1==e[t]?_t("yes"):_t("no")},this.getStrValFromBits=function(t,e){var n=i[e].strValues,a=n.length;this.amountBits(a);return n[parseInt(t[e],2)]},this.rangeOfBits=function(t,e){var n=i[e].range[0],a=i[e].range[1],s=i[e].range[2],r=i[e].range[3],o=parseInt(t[e],2);return r?Math.abs(n+o*s-(n+a)):n+o*s},this.createMenuInput=function(t,e,i){var n=this.getAttrDataMenu(e,i);t.addClass("menu default"),t.createMenu(n,!0),t.find("span").addClass("input-val-"+e)},this.createDivideButton=function(t,e,i){var n=this.getAttrDataMenu(e,i);t.createDivideButton(n,e,!0)},this.saveAtributes=function(){for(var i=[0,1,2,7,12,17,18,19,21],n=t.getRecruit().getContent(),a=t.getProp("attributes"),s=e.getMapOfBits(a),r=0;r<i.length;r++){var o=i[r],l=e.prepareValueFromInput(n,o);if(l<0)return;s[o]=e.toBinary(l)}e.sendData(s)},this.prepareValueFromInput=function(t,e){var n,a=t.find(".input-val-"+e),s=i[e].input;if("empty"==i[e].name)return 0;switch(s){case"i":n=a.val();break;case"m":n=a.attr("value");break;case"c":n=a.find(".active").attr("value")}return""===(n=this.checkRangeExist(e,n))?-1:parseInt(n)},this.checkRangeExist=function(t,e){var n=i[t].range;return isset(n)?e=n[3]?Math.abs(e-n[1])/n[2]:(e-n[0])/n[2]:e},this.sendData=function(t){var n="";for(var a in t){var s=t[a];if(i[a].range)var r=i[a].range[0],o=(i[a].range[1]-r)/i[a].range[2]+1,l=this.amountBits(o);else if(i[a].strValues){var c=i[a].strValues.length;l=this.amountBits(c)}else l=1;for(var d="";d.length<l-s.length;)d+=0;n=(d+=s)+n}_g("clan&a=set_attrs&v="+e.toDecimal(n))},this.amountBits=function(t){for(var e=2,i=1;i<10;i++){if(t+1<=e)return i;e*=2}},this.createTextInput=function(i,n,a){var s="input-val-"+n;i.addClass("default "+s),setOnlyPositiveNumberInInput(i),i.focusout((function(){var t=$(this).val(),i=$(this).attr("class").replace("default input-val-",""),n=e.correctVal(i,t);$(this).val(n)})),t.createPlaceHolder("."+s,"----",a)},this.createTipToInput=function(t,e){var n=i[e].range,a=n[2],s=_t("leap"),r=a>1?" "+s+" "+a:"",o="Min: "+n[0]+" Max: "+n[1]+r;t.tip(o)},this.getAttrDataMenu=function(t,e){var n;n=e?[]:[{text:'<div class="icon"><div class="zero"></div></div>',val:""}];var a=i[t];return isset(a.range)?this.createRangeValues(a,n):isset(a.strValues)?this.createStrValues(a,n):(n.push({text:_t("yes"),val:1}),n.push({text:_t("no"),val:0}),n)},this.createRangeValues=function(t,e){for(var i=t.range[0],n=t.range[1],a=t.range[2],s=i;s<n;s+=a){var r={text:s,val:s};e.push(r)}return e},this.createStrValues=function(t,e){for(var i=t.strValues,n=0;n<i.length;n++){var a={text:i[n],val:n};e.push(a)}return e},this.correctVal=function(t,e){var n=i[t].range,a=n[0];if(e<=a)return a;var s=n[1];if(e>=s)return s;for(var r=n[2],o=a;a<s;o+=r){if(o==e)return e;if(o+r>e)return o}},this.toBinary=function(t){return(t>>>0).toString(2)},this.toDecimal=function(t){return parseInt(t,2)},this.getAttrDataTab=function(){return i}}},function(t,e,i){var n=i(0);t.exports=function(t){var e,i,a=this,s=[];this.init=function(){this.initContent(),this.initTexts(),this.initBackBtn(),this.initFetch()},this.update=function(t){this.clearDisabled(),this.setBlessLevel(t),this.updateScroll()},this.clearDisabled=function(){e.find(".clan-bless-container").find(".disabled").removeClass("disabled")},this.setBlessLevel=function(t){i=t.bless_max},this.newBlessItem=function(t,e){if(s.push(t),e){s.sort((t,e)=>t.id>e.id?1:-1);for(let t of s)a.createOneBless(t);s=[]}},this.createOneBless=function(s){var r=e.find(".clan-bless-container"),o=r.children().length,l=s.id;if(r.find(".bless-"+l).length>0){const t=r.find(".bless-"+l);return(o=t.index())+1>i&&a.setDisabled(t),void a.appendCloneItem(s,t.find(".item-wrapper"))}var c=n.get("one-bless-skill");c.addClass("bless-"+l);var d=s.name,h=s.parseStats(),u=h.opis,p=h.ttl,g=s.pr,f=a.useBlessBtn(o,g);t.tLang("use_cost");a.appendCloneItem(s,c.find(".item-wrapper")),c.find(".bless-name").html(d),c.find(".bless-description").html(parseClanBB(u)),c.find(".bless-duration").html(_t("battleTime",null,"matchmaking")+" "+p+"min"),c.find(".bless-use").prepend(f),o+1>i&&a.setDisabled(c),r.append(c),a.updateScroll()},this.createCloneItem=function(t){var e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.CLAN_BLESS_ITEM_VIEW,"b")[0],i=e.getTipData();if(i)return i=i.replace("s-7","s-7 left"),e.tip(i),e},this.appendCloneItem=function(t,e){var i=a.createCloneItem(t);e.html(i)},this.rebuiltDisabled=function(){var t=e.find(".one-bless-skill");t.removeClass("disabled"),t.each((function(){$(this).index()+1>i&&a.setDisabled($(this))}))},this.setDisabled=function(t){t.addClass("disabled")},this.useBlessBtn=function(t,e){var i=n.get("button").addClass("green small"),a=_t("use_it",null,"item");return i.find(".label").html(a+'<span class="small-money"></span>'+round(e,2)),i.click((function(){_g("clan&a=skills_use&name=blessing&opt="+(t+1))})),i},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_BLESS_TPL,a.newBlessItem)},this.initContent=function(){var i=(e=n.get("clan-bless-content")).find(".bless-header");t.wnd.$.find(".card-content").append(e),e.find(".scroll-pane").prepend(i),$(".scroll-wrapper",e).addScrollBar({track:!0})},this.initBackBtn=function(){var i=n.get("button").addClass("small green"),s=t.tLang("back");i.find(".label").html(s),i.click(a.showSkils),e.find(".back-to-skill-btn").append(i)},this.showSkils=function(){var e=t.tLang("clan_skills");t.showChooseCard("clan","clan-skills"),t.updateHeader(e)},this.updateScroll=function(){$(".scroll-wrapper",e).trigger("update")},this.initTexts=function(){var i=t.tLang("bless-header");e.find(".bless-header").html(i)}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e=this,i=null,a=null,s=null,r=null;this.init=function(){this.initWindow(),this.initTable(),this.changeButsInit(),this.languageDifference(),this.wnd.center(),Engine.lock.add("eCalendar")},this.initTable=function(){s=["m_styczen","m_luty","m_marzec","m_kwiecien","m_maj","m_czerwiec","m_lipiec","m_sierpien","m_wrzesien","m_pazdziernik","m_listopad","m_grudzien"],r=["d_monday","d_tuesday","d_wednesday","d_thursday","d_friday","d_saturday","d_sunday"],this.tLangLoop(s),this.tLangLoop(r)},this.changeButsInit=function(){this.initClick("next","Week"),this.initClick("next","Month"),this.initClick("prev","Week"),this.initClick("prev","Month")},this.initClick=function(t,i){this.wnd.$.find("."+t+"-"+i.toLowerCase()).click(e[t+i])},this.languageDifference=function(){var t=this.wnd.$,e=_l();t.find(".background").addClass("bck-"+e),t.find(".prev-week").addClass(e),t.find(".next-week").addClass(e)},this.updateData=function(t){for(var e in i=t)this.testRegExp(i[e]);a=this.getStartPoint(new Date),this.setDateChange()},this.testRegExp=function(t){if(/#lvl\[.*?\]#/.test(t.descr)){var e=/#lvl\[([0-9]*),([0-9]*)\]#/.exec(t.descr);t.lvl_req=[parseInt(e[1]),parseInt(e[2])],t.descr=t.descr.replace(/#lvl\[.*?\]#/,"")}},this.setDateChange=function(){this.clear();var t=this.wnd.$,e=a.getDate()+"-"+(a.getMonth()+1)+"-"+a.getFullYear(),i=s[a.getMonth()];t.find(".date-display").html(e),t.find(".month-display").html(i),this.printWeek()},this.initWindow=function(){t=n.get("event-calendar"),Engine.windowManager.add({content:t,title:this.tLang("event_calendar"),nameWindow:Engine.windowsData.name.EVENT_CALENDAR,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()},this.getStartPoint=function(t){return 1!=t.getDay()&&t.setTime(t.getTime()-24*((0==t.getDay()?7:t.getDay())-1)*36e5),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t},this.printWeek=function(){for(var t=null,e=0;e<14;e++){var n=new Date(a.getTime()+24*e*3600*1e3);null===t&&(t=n.getFullYear());var s=[];for(var r in i){if(isset(i[r].lvl_req)){var o=i[r].lvl_req,l=Engine.hero.d.lvl;if(!(l>=o[0]&&l<=o[1]))continue}var c=i[r];switch(c.attr=-2&c.attr,c.attr){case 6:case 0:this.annualCase(c,t,n,s,r);break;case 2:this.weeklyCase(c,n,s);break;case 4:this.monthlyCase(c,n,s)}}this.createCell(e,s,n)}this.animateSEvents()},this.annualCase=function(t,e,i,n,a){var s=parseInt(t.date),r=s%100,o=parseInt(Math.floor(s/100)),l=i.getFullYear();e!=l&&(l=e);var c=strtotime(this.pad(l)+"-"+this.pad(o)+"-"+this.pad(r)+" 00:00:00"),d=c+86400-1+24*(t.duration-1)*3600,h=i.getTime()/1e3;h>=c&&h<=d&&n.push(t)},this.weeklyCase=function(t,e,i){for(var n=t.duration>7?7:t.duration,a=[],s=t.date;s<t.date+n;)a.push(s%7),s++;a.indexOf(e.getDay())>=0&&i.push(t)},this.monthlyCase=function(t,e,i){t.date<40?this.lessThanFourty(t,e,i):this.moreThanFourty(t,e,i)},this.lessThanFourty=function(t,e,i){var n=this.pad(t.date),a=this.pad(e.getMonth()+1),s=e.getFullYear(),r=strtotime(this.pad(s)+"-"+this.pad(a)+"-"+this.pad(n)+" 00:00:00"),o=r;t.duration>1&&(o=strtotime("+"+(t.duration-1)+" days",r)+86400-1);var l=e.getTime()/1e3;l>r&&l<o&&i.push(t)},this.moreThanFourty=function(t,e,i){var n=this.pad(e.getMonth()+1),a=e.getFullYear(),s=strtotime(this.pad(a)+"-"+this.pad(n)+"-"+this.pad(d)+" 00:00:00"),r=new Date(1e3*s),o=t.date%10,l=Math.floor((t.date-30)/10),c=0==r.getDay()?7:r.getDay(),h=s+24*(o-c)*3600+7*(l-(o-c<0?0:1))*24*3600,u=h+24*t.duration*3600-1,p=e.getTime()/1e3;p>=h&&p<=u&&i.push(t)},this.createCell=function(t,e,i){var a=this.wnd.$,s=n.get("event-calendar-cell"),o=$(s),l="<span class=day-name>"+r[t%7]+"</span>",c="<span class=day>"+i.getDate()+"/"+this.pad(i.getMonth()+1)+"</span>";o.find(".day-and-date").append(l),o.find(".day-and-date").append(c),e.sort((function(t,e){return t.duration-e.duration}));var d=e.splice(0,2),h=o.find(".events-holder");for(var u in d)this.createSingleEvent(d,h,u);a.find(".days-wrapper").append(o)},this.createSingleEvent=function(t,e,i){var n=$('<div class="single-event"></div>'),a=t[i],s="<span class=ev-name>"+a.name+"</span>";if(n.append(s),""!=a.descr&&n.tip(a.descr,"t_static"),a.icon){var r=$("<div class=bg></div>");a.icon.match(/\./)?r.css({backgroundImage:"url("+a.icon+")"}):r.css({backgroundColor:a.icon,opacity:.2}),n.prepend(r)}e.append(n)},this.animateSEvents=function(){this.wnd.$.find(".single-event").hover((function(){e.stretchEvent($(this))}),(function(){e.restoreSize($(this))}))},this.stretchEvent=function(t){var e=t.parent().children();e.length<2||(0==t.index()?(e.last().css("top","100%"),e.first().css("bottom",0)):(e.last().css("top",0),e.first().css("bottom","100%")))},this.restoreSize=function(t){var e=t.parent().children();e.length<2||(e.last().css("top","50%"),e.first().css("bottom","50%"))},this.close=function(){e.wnd.remove(),Engine.lock.remove("eCalendar"),Engine.eventCalendar=!1},this.nextMonth=function(){a.setMonth(a.getMonth()+1),a=e.getStartPoint(a),e.setDateChange()},this.nextWeek=function(){a.setDate(a.getDate()+7),e.setDateChange()},this.prevMonth=function(){a.setMonth(a.getMonth()-1),a=e.getStartPoint(a),e.setDateChange()},this.prevWeek=function(){a.setDate(a.getDate()-7),e.setDateChange()},this.pad=function(t){return t<10?"0"+t:t},this.clear=function(){var t=this.wnd.$;t.find(".date-display").empty(),t.find(".month-display").empty(),t.find(".days-wrapper").empty()},this.tLang=function(t){return _t(t,null,"event_calendar")},this.tLangLoop=function(t){for(var e=0;e<t.length;e++)t[e]=this.tLang(t[e])}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e,i,a,s=this;this.init=function(){s.initWindow(),s.initButtons(),s.wnd.center()},this.initButtons=function(){var t=this.wnd.$;t.find(".prev").click((function(){s.changePage(-1)})),t.find(".next").click((function(){s.changePage(1)}))},this.updateData=function(t){this.updateVars(t.content),this.updateHeader(t.title,t.author),this.updateBookInfo(),this.showPage()},this.updateVars=function(t){i=t.split("#PAGE#"),a=1,e=i.length},this.updateHeader=function(t,e){var i=this.wnd.$;i.find(".book-title").html(parseContentBB(t)),i.find(".author").html(parseContentBB(e))},this.updateBookInfo=function(){var t=this.wnd.$;t.find(".which").html(a),t.find(".amount").html("/"+e)},this.changePage=function(t){a=Math.max(1,Math.min(e,a+t)),this.showPage(),this.updateBookInfo()},this.showPage=function(){this.wnd.$.find(".left").html(parseContentBB(i[a-1]))},this.initWindow=function(){t=n.get("book"),Engine.windowManager.add({content:t,title:_t("book",null,"book"),nameWindow:Engine.windowsData.name.BOOK,objParent:this,nameRefInParent:"wnd",onclose:()=>{s.close()}}),this.wnd.addToAlertLayer()},this.close=function(){s.wnd.remove(),Engine.book=!1}}},function(t,e,i){var n=i(0);t.exports=function(){var t=this;this.tLang=function(t,e){return e=e||null,_t(t,e,"motel")},this.init=function(){Engine.lock.add("motel"),Engine.windowManager.add({content:n.get("motel-window"),title:"Motel",nameWindow:Engine.windowsData.name.MOTEL,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.show(),this.wnd.center()},this.updateData=function(t){this.wnd.title(t.name),this.wnd.$.find(".rooms-description").html(t.desc),this.fillTranslate(),this.fillTable(t.rooms)},this.fillTranslate=function(){this.wnd.$.find(".room-th").html(t.tLang("room_th")),this.wnd.$.find(".state-th").html(t.tLang("state_th")),this.wnd.$.find(".price-th").html(_t("price_th",null,"auction")),this.wnd.$.find(".amount-th").html(t.tLang("amount_th")),this.wnd.$.find(".time-th").html("Czas"),this.wnd.$.find(".action-th").html("Akcja")},this.getButton=function(e,i,a){var s=n.get("button").addClass("green small");return s.find(".label").html(t.tLang(i)).on("click",function(t){return function(){a(t)}}(e)),s},this.fillTable=function(e){for(var i=null,n=[],a=[],s=0;s<e.length;s+=5){i=$("<tr/>");var r=$("<td/>").html(e[s+1]);if(i.append(r),2==e[s+3]){var o=_t("rent-to")+"<br>"+ut_fulltime(e[s+4]);r.attr("rowspan",3);var l=$("<tr/>"),c=$("<tr/>");n.push(i),n.push(l),n.push(c),i.append($("<td>").html(o).attr("rowspan",3).css("color","blue")),i.append($("<td>").append($("<div/>",{class:"default rent menu",id:"motel"+e[s]}))),i.append($("<td>").html(round(e[s+2],5)).attr({id:"price-motel"+e[s],value:e[s+2]}));var d=.1*e[s+2],h=$("<input/>").val(1).attr({id:"rokey"+e[s],type:"number"}).addClass("default");t.inputFocusOut(h,d,l),i.append($("<td>").append($("<div/>",{html:t.getButton(e[s],"long_opt",t.rentRoom)}))),l.append($("<td>").append(h)),l.append($("<td>").html(round(d,5)).attr("value",d).addClass("new-key-cost")),l.append($("<td>").append($("<div/>",{html:t.getButton(e[s],"keysadd_opt",t.dupKeys)}))),c.append($("<td>").html("-")),c.append($("<td>").html(round(.3*e[s+2],5))),c.append($("<td>").append($("<div/>",{html:t.getButton(e[s],"keysrm_opt",t.deleteKeys)})))}else 0==e[s+3]?(a.push(i),i.append($("<td/>",{html:_t("room_free_new")}).css("color","green")).append($("<td/>",{html:$("<div/>",{class:"default rent menu",id:"motel"+e[s]})})).append($("<td/>",{html:round(e[s+2],5),value:e[s+2],id:"price-motel"+e[s]})).append($("<td/>",{html:t.getButton(e[s],"rent_this",t.rentRoom)}))):(a.push(i),i.append($("<td/>",{html:_t("room_taken")+"<br>"+ut_fulltime(e[s+4])}).css("color","red")).append($("<td/>",{html:"-"})).append($("<td/>",{html:round(e[s+2],5),value:e[s+2],id:"price-motel"+e[s]})).append($("<td/>",{html:"-"})))}this.wnd.$.find(".yours-room>tbody").empty().html(n),this.wnd.$.find(".to-rent-room>tbody").empty().html(a),this.wnd.$.find(".table-wrapper").addScrollBar({track:!0}),$(".menu",this.wnd.$).each((function(){t.createMenu($(this))})),$(".scroll-wrapper").trigger("scrollTop").trigger("update")},this.createMenu=function(e){var i=[{text:t.tLang("time_1m"),val:1},{text:t.tLang("time_2m"),val:2},{text:t.tLang("time_3m"),val:3},{text:t.tLang("time_6m"),val:6},{text:t.tLang("time_12m"),val:12}];e.createMenu(i,!0,(function(t){t=e.find(".menu-option").attr("value");var i="price-"+e.attr("id"),n=$("#"+i),a=parsePrice(n.attr("value"));n.html(round(a*t,5))}))},this.inputFocusOut=function(t,e,i){t.focusout((function(){var n=t.val();i.find(".new-key-cost").html(round(n*e,5)).attr(n*e)}))},this.dupKeys=function(e){var i=$("#rokey"+e).val(),n=$("#price-motel"+e).attr("value"),a=round(parsePrice(n)*i*.1,5),s=i>4?3:i>1?2:1;checkInputValIsEmptyProcedure(i)||mAlert(t.tLang("duplicate_key_confirm"+s+" %amount% %gold%",{"%amount%":i,"%gold%":a}),[{txt:_t("yes"),callback:function(){return _g("rooms&room="+e+"&keydup="+i),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.deleteKeys=function(e){var i=$("#price-motel"+e).attr("value"),n=round(.3*parsePrice(i),5);mAlert(t.tLang("room_key_remove_confirm_new %gold%",{"%gold%":n}),[{txt:_t("yes"),callback:function(){return _g("rooms&delkeys="+e),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.rentRoom=function(e){var i=$("#price-motel"+e).attr("value"),n=$("#motel"+e+" span").attr("value"),a=t.tLang("rm_1month"),s=round(i*n,5);n>4?a=n+t.tLang("rm_2months"):n>1&&(a=n+t.tLang("rm_2months*")),mAlert(t.tLang("room_confirm_question2 %time% %gold%",{"%time%":a,"%gold%":s}),[{txt:_t("yes"),callback:function(){return _g("rooms&rent="+e+"&m="+n),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.close=function(){t.wnd.remove(),Engine.lock.remove("motel"),Engine.motel=!1}}},function(t,e,i){var n=i(0),a=i(18);t.exports=function(){var t=this;this.initWindow=function(){Engine.lock.add("goldShop"),Engine.windowManager.add({content:n.get("gold-shop"),nameWindow:Engine.windowsData.name.GOLD_SHOP,nameRefInParent:"wnd",objParent:this,title:_t("gold_shop_head_info"),onclose:()=>{t.close()}}),this.wnd.addToAlertLayer(),this.wnd.center(),this.wnd.show(),this.wnd.$.find(".header").html(_t("gold_shop_head_info")),this.wnd.$.find(".header-big-label").html(_t("exchangeOffice")),this.createBtnCallback(),this.createAllOffer(),this.updateScroll()},this.createAllOffer=function(){for(var e=[["75","250,000"],["450","1,500,000"],["1500","5,000,000"],["3750","15,000,000"],["7500","32,000,000"],["15000","75,000,000"]],i=0;i<6;i++){var a=e[i],s=n.get("one-offer").addClass("of-"+i);if(t.wnd.$.find(".scroll-pane").append(s),s.find(".sl-header").html(a[0]+" "+_t("sl",null,"clan")),s.find(".gold-header").html(a[1]),t.createButton(a,s),isset(a[2])){var r=_t("save_money %sl%",{"%sl%":a[2]},"shop");s.find(".save-money").html(r)}}},this.createButton=function(t,e){var i=n.get("button").addClass("green small");return i.find(".label").html(_t("change",null,"shop")),e.find(".change-btn").append(i),i.click((function(){var e={ik:"oimg",ip:"/draconite_small.gif",q:_t("gold_buy_confirm %gold%",{"%gold%":t[1]},"default"),it:t[0],m:"yesno2",re:"creditshop&credits_gold="+t[0]};askAlert(e)})),i},this.updateScroll=function(){var e=t.wnd.$,i=e.find(".scroll-wrapper");if(i.trigger("update"),i.find(".middle-graphics").length>0){var n=i.hasClass("scrollable")?23:20,a=e.find(".scroll-pane").width();e.find(".middle-graphics").width(a+n)}},this.createBtnCallback=function(){this.wnd.$.find(".close-btn").click(t.close),this.wnd.$.find(".sl-link").click((function(){Engine.draconiteShop?Engine.draconiteShop.close():(Engine.draconiteShop=new a,Engine.draconiteShop.open())}))},this.update=function(e){e=e.split(";");for(var i=null,a=null,s=[],r=0;r<e.length;r++)i=e[r].split("="),(a=n.get("gold-box")).addClass("box-"+r),a.find(".sl").html(i[0]+_t("sl",null,"clan")),a.find(".gold-span").html(round(i[1],3)),a.click(function(e,i){return function(){t.buyGold(e,i)}}(i[0],i[1])),s.push(a);this.wnd.$.find(".options").append(s)},this.buyGold=function(t,e){mAlert(_t("gold_buy_confirm %sl% %gold%",{"%sl%":t,"%gold%":e}),[{txt:_t("yes"),callback:function(){return _g("creditshop&credits_gold="+t),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.hide=function(){t.close()},this.close=function(){t.wnd.remove(),Engine.lock.remove("goldShop"),Engine.goldShop=!1},this.hideStats=function(){$(".extended-stats").removeClass("active")},this.initButtons=function(){var e=n.get("button").addClass("purple small"),i=n.get("button").addClass("green small");e.find(".label").html(_t("buy_sl",null,"shop")),i.find(".label").html(_t("close",null,"shop")),t.wnd.$.find(".buy-sl-btn").append(e),t.wnd.$.find(".close-btn").append(i),e.click((function(){Engine.draconiteShop?Engine.draconiteShop.close():(Engine.draconiteShop=new a,Engine.draconiteShop.open())})),i.click(t.close)},this.initLabel=function(){t.wnd.$.find(".sl-label").html(_t("low_sl",null,"shop"))},this.init=function(){t.initWindow(),t.initLabel(),t.initButtons(),t.hideStats()}}},function(t,e,i){var n=i(0),a=i(71),s=i(274),r=i(52),o=i(39);const l=i(275);t.exports=function(){var t,e,i,c=this,d=this,h=null,u={},p={},g={},f=null,m=!1,v=null,E=null,_=null,b=null,w=null,C=null,T=null,y=null,I=!1;this.init=function(){t=n.get("skills-window"),e=n.get("additional-skill-panel"),i=Engine.interface.get$interfaceLayer().find(".bottom-panel"),this.createWindow(),this.hideInterfaceItems(),this.initAdditionalHotKeys(),this.initBasicSkills(),this.initEqDragOpts(),this.initDroppable(),this.initMBattleWrapper()},this.getOneStepSkillId=()=>"skill_"+o.specificSkills.ONE_STEP_ID,this.getNormalAttackSkillId=()=>"skill_"+o.specificSkills.NORMAL_ATTACK_ID,this.initMBattleWrapper=function(){let t=n.get("button").addClass("small green");t.find(".label").html(_t("edit")),d.wnd.$.find(".MB-button").append(t),t.click((function(){_g("skills&battleaction=show")})),this.createResetButton(d.wnd.$.find(".bottom-right"))},this.getSkills=function(){return u},this.getGroupedSkills=function(){return g},this.getBasicSkills=function(){return p},this.getActiveSkills=function(){return E},this.initAdditionalHotKeys=function(){Engine.interface.get$interfaceLayer().find(".bottom-panel").prepend(e)},this.hideInterfaceItems=function(){Engine.interface.get$interfaceLayer().find(".bottom-panel>.slots").css("display","none"),Engine.interface.get$interfaceLayer().find(".skill-usable-slots").css("display","block"),Engine.hero.lvl>299&&$(".end-game-overlay").removeClass("end-game-overlay")},this.showInterfaceItems=function(){Engine.interface.get$interfaceLayer().find(".bottom-panel>.slots").css("display","block"),Engine.interface.get$interfaceLayer().find(".skill-usable-slots").css("display","none"),Engine.interface.heroElements.checkAndSetEndGamePanel()},this.initDroppable=function(){for(var t=0;t<16;t++)i.find("[slot="+t+"]").droppable({drop:function(t,e){e.helper.hasClass("battle-skill")&&d.dropSkillOnQuickBar(e,$(this))}});w=n.get("del-skill-middle-layer"),C=n.get("del-skill-left-layer"),T=n.get("del-skill-right-layer"),Engine.interface.get$gameLayer().prepend([T,C,w]),T.add(C).add(w).droppable({drop:function(t,e){var i=e.helper;i.hasClass("battle-skill")&&!i.hasClass("first-drag")&&d.deleteSkillDropOnMap(e.helper.attr("hot-skill-id"))}})},this.dropSkillOnQuickBar=function(t,e){var i=t.helper.clone(),n=d.parseId(i.attr("hot-skill-id")),a=e.find(".battle-skill").attr("hot-skill-id"),s=Engine.skills.getActiveSkills(),r=!1;if(a){var o=s.indexOf(d.parseId(a));if(i.hasClass("first-drag"))return message(_t("place_is_not_empty"));var l=s.indexOf(n);r=!0,s[o]=0,s[l]=d.parseId(a)}r||(l=s.indexOf(n))>-1&&(s[l]=0);s[e.attr("slot")]=n,_g("skills&selectedskills="+s)},this.deleteSkillDropOnMap=function(t){var e=Engine.skills.getActiveSkills(),i=e.indexOf(d.parseId(t));if(i>-1){e[i]=0;var n=e.join();_g("skills&selectedskills="+n)}},this.parseId=function(t){return parseInt(t.replace("skill_",""))},this.tLang=function(t,e){return e=e||null,_t(t,e,"skills")},this.createHotSkill=function(t){var e=t.find(".skill-background").clone(),i=n.get("skill-background-tpl"),a=t.attr("id"),s=n.get("battle-skill-in-skill-panel");return s.removeClass("first-drag"),s.attr("hot-skill-id",a),e.removeClass("skill-background").addClass("icon"),d.getTipSkill(a,s),s.append([i,e])},this.getTipSkill=function(t,e){var i=Engine.skills.getSkills()[t],n=Engine.skills.getBasicSkills()[t],a=i||n;r.setSkillTip(e,a)},this.initEqDragOpts=function(){_={helper:function(){var t=d.createHotSkill($(this));return t.addClass("first-drag"),t},distance:10,appendTo:"body",cursorAt:{top:16,left:16},scroll:!1,zIndex:20},b={helper:"clone",distance:10,appendTo:"body",cursorAt:{top:16,left:16},scroll:!1,zIndex:20}},this.initBasicSkills=function(){p={[d.getNormalAttackSkillId()]:{id:o.specificSkills.NORMAL_ATTACK_ID,name:d.tLang("normal_atack"),type:"active",cLvl:"1",mLvl:"1",lvl:"1/1",kind:"unav",desc:d.tLang("atack_desc"),basic:"",regs:"lvl=1",currentStatsIndex:0,allStats:["norm-atack=1"]},[d.getOneStepSkillId()]:{id:o.specificSkills.ONE_STEP_ID,name:d.tLang("step"),type:"active",cLvl:"1",mLvl:"1",lvl:"1/1",kind:"unav",desc:d.tLang("step_desc"),basic:"",regs:"lvl=1",currentStatsIndex:0,allStats:["step=1"]}}},this.createWindow=function(){Engine.windowManager.add({content:t,title:d.tLang("skills_title"),nameWindow:Engine.windowsData.name.SKILLS,widget:Engine.widgetsData.name.SKILLS,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.close()}}),this.wnd.show(),this.wnd.addToAlertLayer(),$(".skills-wrapper",t).addScrollBar({track:!0}),$(".info-description",t).addScrollBar({track:!0}),this.wnd.center()},this.initVariable=function(){for(var t=1;t<=8;t++)g[t]={skills:[],points:0,requiredLvl:0}},this.refreshBMButton=function(){let t=d.wnd.$.find(".MB-wrapper").find(".button"),e=d.wnd.$.find(".MB-label-1");Engine.hero.d.lvl<25?(t.addClass("disable"),e.css("display","inline-block")):(t.removeClass("disable"),e.css("display","none"))},this.update=function(e,i){if(isset(this.MBEditor))this.MBEditor.update(e);else{d.refreshBMButton(),isset(i.skill_data)&&(h=i.skill_data),g={};for(let[t,i]of Object.entries(h)){const{name:a,attr:s,xy:r,desc:o,pos:l,maxLvl:c,reqs:d,stats:h}=i,p=e[t].lvl,f=p>0?p-1:p,m=e[t].isLearnable?d+"|"+h[p]:"unav",v=d;h[f];u["skill_"+t]={id:t,name:a,attr:s,grp:l,xy:r,desc:o,regs:v,lvl:e[t].lvl+"/"+c,kind:m,type:1&s?"active":"passive",cLvl:e[t].lvl,mLvl:c,currentStatsIndex:f,allStats:h};var n=l%8;this.checkIndexExist(n),g[n].points+=u["skill_"+t].cLvl,g[n].skills.push({slug:"skill_"+t,sort:u["skill_"+t].xy}),this.setRequiredLvl(m+"|"+v,n)}this.sortGroupedSkills(),this.fillLeftColumn(),this.fillRightColumn(),$(".skills-wrapper",t).trigger("update"),$(".info-description",t).trigger("update")}},this.sortGroupedSkills=function(){for(let t in g)g[t].skills.sort((t,e)=>t.sort>e.sort?1:-1)},this.updateFreeSkills=function(t){var e=d.wnd.$.find(".free-skills-label");if(t<1)return e.css("display","none");e.css("display","block"),d.wnd.$.find(".cost-value").addClass("cost-value-crossed"),I=!0;var i=t-unix_time();e.html(_t("free_skills")+getSecondLeft(i,{short:!0})),y&&d.clearTimeInterval(),y=setInterval((function(){e.html(_t("free_skills")+getSecondLeft(i,{short:!0})),i<1&&y&&(d.clearTimeInterval(),d.wnd.$.find(".cost-value").removeClass("cost-value-crossed"),e.css("display","none"),I=!1),i--}),1e3)},this.clearTimeInterval=function(){clearInterval(y),y=null},this.checkIndexExist=function(t){isset(g[t])||(g[t]={skills:[],points:0,requiredLvl:0})},this.createLastOpenSkill=function(){f&&(d.wnd.$.find("#"+f).addClass("chosen"),this.showSkill(f))},this.getSumOfPoints=function(t){for(var e=0,i=1;i<t;i++)e+=g[i].points;return e},this.setRequiredLvl=function(t,e){var i=t.split("|"),n=null,a=null;for(var s in i)for(var r in n=i[s].split(";"))"lvl"==(a=n[r].split("="))[0]&&(g[e].requiredLvl=a[1])},this.createBasicSkills=function(t){var e=n.get("skills-description-wrapper").html(d.tLang("basicSkills"));t.push(e);var i=d.getNormalAttackSkillId(),a=d.getOneStepSkillId(),s=this.createBasicSkill(i,p[i]),r=this.createBasicSkill(a,p[a]);s.draggable(_),r.draggable(_),t.push(s),t.push(r)},this.fillLeftColumn=function(){var e=t.find(".skills-wrapper > .scroll-pane"),i=[],a=!0,s=Engine.hero.d.lvl,r=null,o=null,l=0,c=n.get("skills-description-wrapper").html(d.tLang("skill_req_desc"));for(var h in this.createBasicSkills(i),i.push(c),g)for(var p in r=g[h],l=d.getSumOfPoints(h),a=s>=r.requiredLvl&&l>=r.requiredLvl-25,h>1&&i.push(d.getDescription(r.requiredLvl)),r.skills){o=d.createSkill(r.skills[p].slug,a);var f=r.skills[p].slug;"active"==u[f].type&&u[f].cLvl>0&&o.draggable(_),i.push(o)}e.html(i),$(".skill.clickable").on("mouseup",this.skillOnClick)},this.skillOnClick=t=>{const e=$(t.currentTarget);this.wnd.$.find(".empty").css("display","none"),this.showSkill(e.attr("id"),e.hasClass("disabled")),$(".skill").removeClass("chosen"),e.addClass("chosen")},this.checkIsUnav=function(t){return"unav"===u[t].kind},this.getDescription=function(t){var e=d.tLang("skill_req_desc_new %lvl% %points%",{"%lvl%":t,"%points%":t-25});return n.get("skills-description-wrapper").html(e)},this.updateSkillsLearnt=function(e){t.find(".right-column").find(".skills-points").html(e+"/"+Math.max(0,Engine.hero.d.lvl-24))},this.fillRightColumn=function(){t.find(".right-column").find(".description-wrapper").html("")},this.createResetButton=function(t){var e=n.get("button").addClass("purple small"),i=round(50,10),a=$("<span/>",{class:"reset",html:d.tLang("reset_btn")+": "+i}),s=$("<span/>").addClass("small-draconite");e.find(".label").html([a,s]),e.click((function(){_g("skills&reset=1")})),t.html(e)},this.initBattleEditor=function(){isset(d.MBEditor)||(d.MBEditor=new s(t,d),d.MBEditor.init())},this.getEditListBtn=function(){var t=n.get("button").addClass("green small skills-queue");return t.find(".label").html(d.tLang("edit_list")),t.click(this.initBattleEditor),t},this.showSkill=function(e,i){f=e;var a=!isset(u[e]),s=a?p[e]:u[e],o=a?this.createBasicSkill(e):this.createSkill(e,!0),l=n.get("skill-description"),c=n.get("button").addClass(i?"black small":"green small"),h=l.find(".description"),g=l.find(".skill-slider");t.find(`.left-column #${e} .active`).hasClass("quick-skill")&&o.find(".active").addClass("quick-skill").tip(_t("skill-icon-active")),o.tip(""),d.createLearnButton(c),t.find(".right-column").find(".description-wrapper").html(l),d.createSkillSlider(g,s,i),d.createCost(i?0:1),h.html(s.desc),l.find(".icon-wrapper").html(o),l.find(".name").html(s.name),a||t.find(".skill-learn-btn").html(c);u[e];this.showStats(r.getStats(s),s.cLvl),i&&!a?a||t.find(".skill-learn-btn > .button").removeClass("green").addClass("black"):s.cLvl!=s.mLvl?this.addClickAction(c,l,e):l.find(".skill-learn").css("display","none"),this.showRegs(e),$(".info-description",t).trigger("update")},this.updateStats=(t,e)=>{this.showStats(r.getStats(t,e),t.cLvl)},this.createCost=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const i=Math.floor(Math.pow(Engine.hero.d.lvl,1.9))*e,n=Engine.hero.d.gold>=i,a=round(i,1),s="cost-value"+(I?" cost-value-crossed":n?"":" cost-value-red"),r=$(`<span class="${s}">${a}</span>`);t.find(".skill-learn-price .price").html(r)},this.createLearnButton=function(t){t.find(".label").text(d.tLang("learn_btn"))},this.addClickAction=function(t,e,i){var n=null,a=i.split("_").pop();if(m=!1,t.on("click",(function(){if(m)return!1;m=!0,_g("skills&learn="+a+"&lvl="+v,t=>m=!1)})),u[i].kind){u[i];n=r.getStats(u[i]),e.find(".next-level-wrapper").click((function(){d.showStats(n,u[i].cLvl)}))}},this.showStats=function(t,e){this.wnd.$.find(".all-stats").html(a.getStats(t,e))},this.showRegs=function(e){var i=Engine.battle.getIconTips(),n=(t.find(".requirements-wrapper"),t.find(".requirements-wrapper > .icons")),s=u[e]?u[e]:p[e],r=null,o=null;s.regs?r=a.getRegs(s.regs):(o=s.kind.split("|")[0],r=a.getRegs(o)),r.length?(n.html(r),$(".cl-icon",n).each((function(){const t=$(this);var e=$(this).data("icon");e="icon-21"==e?$(this).data("arrows"):i[e],t.html("- "+e),t.removeAttr("class"),t.addClass("text")}))):n.html("<span>"+_t("depo_missing",null,"depo")+"<span>")},this.createSkillSlider=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=0,a=Number(e.mLvl),s=i?0:Number(e.cLvl)+1,r=new l.default({min:n,max:a,value:s,...i?{disabled:i}:{},showValue:!0,blockValueBelowCurrent:!0,onUpdate:t=>{c.sliderUpdate(t,Number(e.cLvl))}});t.append($(r.getElement())),v=s},this.sliderUpdate=(t,e,i)=>{v=t,this.createCost(t-e),this.updateStats(u[f],v)},this.debugRefreshTip=()=>{const t=Engine.skills.getSkills();for(skill in t){const e=$("#"+skill);r.setSkillTip(e.find(".skill-tip"),t[skill])}},this.createSkill=function(t,e,i){var s=n.get("skill").attr("id",t),o=t.split("_").pop(),l=u[t]?u[t]:p[t],c=this.skillLvlColor(l),h=this.skillType(l,t);if(s.addClass(e?"clickable":"disabled clickable"),s.find(".skill-background").addClass("skill-icon "+_l()+" icon-"+o),s.find(".label-wrapper label").html(l.lvl),s.find(".label-wrapper").addClass(c),r.setSkillTip(s.find(".skill-tip"),l),s.addClass(h),"active"===h&&s.find(".active").tip(_t("skill-icon-unactive")),i){var g=a.getObjStats(l.allStats[l.currentStatsIndex]);isset(g.mana)&&d.addNotif(s,"mana",g.mana),isset(g.energy)&&d.addNotif(s,"energy",g.energy)}return s},this.addNotif=function(t,e,i){var a=n.get("skills-notif").html(i).addClass(e);t.append(a)},this.createBasicSkill=function(t,e){var i=n.get("skill").attr("id",t),a=t.replace("skill_","");return i.addClass("clickable"),i.find(".skill-background").addClass("skill-icon "+_l()+" icon-"+a),i.find(".label-wrapper label").html("1/1"),i.find(".label-wrapper").addClass("cl-6"),e&&r.setSkillTip(i.find(".skill-tip"),e),i.addClass("active"),i},this.skillType=function(t,e){return t.type},this.updateSelectedSkills=function(t){if(E=[],i.find(".skill-usable-slot").empty(),!Engine.skills.MBEditor){for(var e=0;e<t.length;e++){var n=t[e];if(0!=n){var a=this.wnd.$.find("#skill_"+n),s=d.createHotSkill(a);a.find(".active").addClass("quick-skill").tip(_t("skill-icon-active")),s.draggable(b),E[e]=n,$(".bottom-panel").find("[slot= "+e+"]").append(s)}else E[e]=0}this.createLastOpenSkill()}},this.skillLvlColor=function(t){var e="chosen";switch(parseInt(t.lvl.split("/")[0])){case 0:e="";break;case 1:case 2:e+=" cl-1";break;case 3:case 4:e+=" cl-2";break;case 5:case 6:e+=" cl-3";break;case 7:case 8:e+=" cl-4";break;case 9:e+=" cl-5";break;case 10:e+=" cl-6"}return e},this.removeEditor=function(t){delete d.MBEditor,_g("skillshop",t)},this.close=function(){d.showInterfaceItems(),e.remove(),w.remove(),C.remove(),T.remove(),Engine.skills=!1,d.wnd.remove()}}},function(t,e,i){var n=i(0);t.exports=function(t,e){var a,s=this,r=0,o=[],l=0,c=0,d=i(39);this.init=function(){s.changeScrollWrapperPos(76),s.fillLeftColumn(),e.wnd.$.find(".MB-wrapper").css("display","none"),e.wnd.$.find(".empty").css("display","none"),e.wnd.$.find(".edit-header-label").text(_t("mbattle"))},this.changeScrollWrapperPos=function(t){e.wnd.$.find(".right-column").find(".scroll-wrapper").css("top",t+"px")},this.getButton=function(t,i){var a=n.get("button").addClass(t);return a.find(".label").html(e.tLang(i)),a},this.fillLeftColumn=function(){var i=t.find(".skills-wrapper > .scroll-pane"),n=[],a=null;n.push($("<div/>",{class:"description-wrapper",html:e.tLang("mb_add_to_list_desc")})),n.push(e.createSkill(Engine.skills.getNormalAttackSkillId(),!0)),n.push(e.createSkill(Engine.skills.getOneStepSkillId(),!0));let l=Engine.skills.getSkills();for(var d in l){"skill_106"==d||"passive"==l[d].type||0==l[d].cLvl||(a=e.createSkill(d,!0,!0),n.push(a))}i.html(n),$(".skill.clickable").click((function(){if(0==c)return mAlert(_t("bm_need_buy"));if(o.length>r-1)return mAlert(_t("bm_limit_reached",null,"skills"));var t=$(this).attr("id").split("_").pop();o.push(t),s.save()}))},this.fillRightColumn=function(){var i=n.get("MBEditor"),a=this.getButton("small green","clear-list"),r=this.getButton("small green","save-btn"),o=t.find(".right-column");$(".description-wrapper",o).html(i);let d=!0;for(var h=[],u=null,p=0;p<20;p++)(u=n.get("single-skill-row").attr("id","mb_list_"+p)).find(".number").html(p+1+"."),p<c?u.addClass("usable"):(s.addBuyButtons(u,p),d?d=!1:u.addClass("disable")),h.push(u),s.fillButtonsCallbacks(u);e.wnd.$.find(".skills-points-description").html(_t("mbattle")),e.wnd.$.find(".skills-points").html(""),i.find(".clear-btn").html(a),i.find(".skills-list").html(h),i.find(".save-btn").html(r),i.find(".mb-box-input").removeClass("active").addClass(1==l?"active":""),this.setCheckboxCallback(),r.click(s.saveAndClose),a.click(s.clearList)},this.addBuyButtons=function(t,e){let i=n.get("button").addClass("small green"),r=n.get("button").addClass("small purple"),o=$("<span/>").addClass("small-money"),l=$("<span/>").addClass("small-draconite"),c=$("<span/>").html(round(a.gold[e])).addClass("buy-money-btn"),d=$("<span/>").html(a.credits[e]).addClass("buy-sl-btn");i.find(".label").html([c,o]),r.find(".label").html([d,l]),i.click((function(){s.buyAlert(0,e)})),r.click((function(){s.buyAlert(1,e)})),t.find(".money-buy").append(i),t.find(".sl-buy").append(r),t.find(".skill-name").html(_t("buy_skill_place"))},this.buyAlert=function(t,e){let i,n,s;switch(t){case 0:n="/goldIconNormal.png",i=_t("confirm_upgrade_MBATLEforGold"),s=round(a.gold[e]);break;case 1:n="/draconite_small.gif",i=_t("confirm_upgrade_MBATLEforCredits"),s=a.credits[e];break;default:return void console.warn("[MBattleEditor.js, buyAlert] Bad type of currency :"+t)}askAlert({ik:"oimg",ip:n,it:s,m:"yesno2",q:"<br>"+i,re:"skills&battleaction=learn&credits="+t})},this.saveAndClose=function(){s.changeScrollWrapperPos(42),e.removeEditor(()=>{e.wnd.$.find(".MB-wrapper").css("display","block"),e.wnd.$.find(".skills-points-description").html(_t("skills_points_description",null,"skills")),e.wnd.$.find(".edit-header-label").text(_t("clickSkills"))})},this.clearList=function(){o=[],s.save()},this.fillButtonCallbacks=function(e){e.find(".up-arrow").click((function(){s.arrowManager("up",$(this).parent())})),e.find(".down-arrow").click((function(){s.arrowManager("down",$(this).parent())})),e.find(".remove-cross").click((function(){s.arrowManager("cross",$(this).parent())})),$(".mb-label, .mb-box-input",t).click((function(){$(".mb-box-input").toggleClass("active"),l=l?0:1,s.save()}))},this.fillButtonsCallbacks=function(t){var e=n.get("button").addClass("green small w30"),i=n.get("button").addClass("green small w30"),a=n.get("button").addClass("red small w30");s.addBck(e,"up"),s.addBck(i,"down"),s.addBck(a,"remove"),t.find(".up-arrow").append(e),t.find(".down-arrow").append(i),t.find(".remove-cross").append(a),e.click((function(){s.arrowManager("up",$(this).parent().parent().parent())})),i.click((function(){s.arrowManager("down",$(this).parent().parent().parent())})),a.click((function(){s.arrowManager("cross",$(this).parent().parent().parent()),s.hideArrows()}))},this.addBck=function(t,e){t.append($("<div>").addClass("add-bck "+e)),t.find(".label").html(0).css("visibility","hidden")},this.setCheckboxCallback=function(){$(".mb-label, .mb-box-input",t).click((function(){$(".mb-box-input").toggleClass("active"),l=l?0:1,s.save()}))},this.arrowManager=function(t,e){var i=e.attr("id").split("_").pop(),n=i;switch(t){case"up":n--;break;case"down":n++}n==i?o.splice(n,1):(o[n]=o[n]^o[i],o[i]=o[n]^o[i],o[n]=o[n]^o[i]),this.save()},this.save=function(){_g("skills&battleaction=set&battleskills="+(o.length?o:0)+"&rpt="+l,(function(){s.updateList()}))},this.getSkillName=t=>{let i=Engine.skills.getSkills(),n="";switch(t){case d.specificSkills.NORMAL_ATTACK_ID:n=e.tLang("bm_normal_attack");break;case d.specificSkills.ONE_STEP_ID:n=e.tLang("step");break;default:n=i["skill_"+t].name}return n},this.updateList=function(){var t=null;Engine.skills.wnd.$.find(".single-skill-row.usable").find(".skill-name").html(_t("empty"));for(var e=0;e<o.length;e++)t=this.getSkillName(o[e]),$("#mb_list_"+e).find(".skill-name").html(t);$(".single-skill-row").hover((function(){$(this).find(".arrows-wrapper").css("visibility","visible");var t=$(this).attr("id").split("_").pop();s.showArrows(t)}),(function(){s.hideArrows(),$(this).find(".arrows-wrapper").css("visibility","hidden")}))},this.showArrows=function(t){if(!(t>=o.length)){var e=$("#mb_list_"+t);e.find(".remove-cross").css("display","block"),e.find(".down-arrow").css("display","block"),e.find(".up-arrow").css("display","block"),0==t&&e.find(".up-arrow").css("display","none"),t!=o.length-1&&1!=o.length||e.find(".down-arrow").css("display","none")}},this.hideArrows=function(){$(".single-skill-row").each((function(){$(this).find(".remove-cross").css("display","none"),$(this).find(".up-arrow").css("display","none"),$(this).find(".down-arrow").css("display","none")}))},this.updateEditor=function(e){r=e.max,o=e.list,l=1==e.rpt?1:0,c=e.cur,a=e.cost,this.fillRightColumn(),this.updateList(),this.hideArrows(),$(".scroll-wrapper",t).trigger("update")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.disabled=!1,this.defaultOptions={value:0,min:0,max:10,cssClass:[],tip:null,disabled:!1,showValue:!1,blockValueBelowCurrent:!1,onUpdate:null},this.options={},this.lastValue=null,this.options=Object.assign(Object.assign({},this.defaultOptions),t),this.createElement(),this.setParameters()}createElement(){this.el=document.createElement("div"),this.el.className="c-slider",this.input=document.createElement("input"),this.input.type="range",this.input.classList.add("c-slider__input"),this.stateEl=document.createElement("div"),this.stateEl.classList.add("c-slider__state")}setParameters(){const{value:t,min:e,max:i,cssClass:n,tip:a,disabled:s,showValue:r,blockValueBelowCurrent:o,onUpdate:l}=this.options;this.el.classList.add(...n),this.setValue(t),this.setMin(e),this.setMax(i),this.setState(s),this.setShowValue(t),this.setTip(a),this.setProgressBackground(),this.lastValue=t,this.input.addEventListener("input",e=>{const i=Number(t);let n=Number(e.target.value);o&&n<i&&(this.setValue(i),n=i),l&&n!==this.lastValue&&(this.lastValue=n,r&&this.setShowValue(n),l(n)),this.setProgressBackground()}),this.el.appendChild(this.input),this.el.appendChild(this.stateEl)}setShowValue(t){this.stateEl.textContent=`${t}/${this.getMax()}`}setState(t){this.disabled=t,this.disabled?this.input.setAttribute("disabled",""):this.input.removeAttribute("disabled")}setProgressBackground(){const t=(this.getValue()-this.getMin())/(this.getMax()-this.getMin())*100;this.input.style.background=`linear-gradient(to right, #396b29 ${t}%, #0c0d0d ${t}%)`}setValue(t){this.input.value=String(t),this.setProgressBackground()}getValue(){return Number(this.input.value)}setMin(t){this.input.min=String(t)}getMin(){return Number(this.input.min)}setMax(t){this.input.max=String(t)}getMax(){return Number(this.input.max)}getState(){return this.disabled}setTip(t){return $(this.el).tip(t)}getElement(){return this.el}}},function(t,e,i){var n=i(277);i(53),i(8);t.exports=function(){this.update=(i,n)=>{i.hasOwnProperty("data")&&this.setQuests(i.data,n),i.hasOwnProperty("finish")&&this.setFinishQuest(i.finish),i.hasOwnProperty("del")&&this.questDelete(i.del),i.hasOwnProperty("set_track")&&this.setSettrack(i.set_track),i.hasOwnProperty("update_data_track")&&t(i.update_data_track),i.hasOwnProperty("update_data_set_track")&&e(i.update_data_set_track),i.hasOwnProperty("track")&&this.setTrack(i.track),i.hasOwnProperty("observe")&&this.setQuestObserve(i.observe)},this.setFinishQuest=t=>{Engine.quests.setFinishQuest(t)},this.setQuests=(t,e)=>{Engine.quests||(Engine.quests=new n),isPl()?(Engine.quests.refresh(t,e),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,5),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,5)):Engine.quests.refreshQlog(t)};const t=t=>{getEngine().questTracking.updateData(t)},e=t=>{getEngine().questTracking.saveActiveQuestTrackingInStorage(t)};this.setTrack=t=>{getEngine().questTracking.startTrackingIfActiveTrackingQuestExist(),getEngine().quests.refreshTrackQuestButtons()},this.setSettrack=t=>{getEngine().questTracking.setActiveQuestTrackingProcedure(t),getEngine().quests.refreshTrackQuestButtons()},this.setQuestObserve=t=>{Engine.questsObserve.update(t)},this.questDelete=t=>{Engine.quests.deleteQuest(t);for(let e=0;e<t.length;e++){let i=t[e];getEngine().questTracking.deleteFromQuestTrackingDataIfExist(i)}}}},function(t,e,i){var n=i(0),a=i(5),s=(i(53),i(45));let r=i(54);const{isMan:o}=i(2);t.exports=function(){var t=this;let e,i={},l={};this.createWindow=function(){Engine.windowManager.add({content:n.get("quest-log"),title:_t("quest_journal",null,"quest"),nameWindow:Engine.windowsData.name.QUESTS_PANEL,widget:Engine.widgetsData.name.QUEST_LOG,objParent:this,nameRefInParent:"wnd",managePosition:{x:"251",y:"60"},startVH:60,cssVH:60,manageShow:!1,onclose:()=>{t.closePanel()}}),this.wnd.addToAlertLayer(),this.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0}),this.initSearch(),this.initLabel(),this.wnd.updatePos()},this.managePanelVisible=function(){t.wnd.isShow()?t.closePanel():t.openPanel()},this.openPanel=function(){t.wnd.show(),t.wnd.setWndOnPeak(),t.updateScroll()},this.closePanel=function(){t.wnd.hide()},this.initLabel=function(){this.wnd.$.find(".header-big-label").html(_t("quest_journal",null,"quest"))},this.initSearch=function(){var e=this.wnd.$.find(".search"),i=this.wnd.$.find(".search-x");e.keyup((function(){var e=$(this).val(),i=t.wnd.$.find(".quest-box");""==e?i.css("display","block"):i.each((function(){var i=$(this).find(".quest-title").html().toLowerCase().search(e.toLowerCase())>-1?"block":"none";$(this).css("display",i),t.updateScroll()}))})),e.attr("placeholder",_t("search")),i.on("click",(function(){e.val("").blur().trigger("keyup")}))},this.onResize=function(){this.updateScroll()},this.updateScroll=function(){var e=t.wnd.$,i=e.find(".scroll-wrapper");if(i.trigger("update"),i.find(".middle-graphics").length>0){var n=i.hasClass("scrollable")?23:20,a=e.find(".scroll-pane").width();e.find(".middle-graphics").width(a+n)}},this.getQuestData=t=>i[t];const c=()=>{d("track")},d=t=>{let e=getEngine().questTracking.getActiveQuestTrackingInStorage();for(let n in i){let i=u(n);for(let a of i)a.hasClass(t)&&h(a,e,e==n)}},h=(t,e,i)=>{let n=t.hasClass("green");i?n||t.addClass("green"):n&&t.removeClass("green")},u=t=>i[t]?i[t].buttonsArray:null;this.addOneQuestData=(t,e,n,a,s)=>{i[t]={title:e,content:n,buttonsArray:a,itemsArray:s}},this.setFinishQuest=t=>{l={};for(let e in t){let i=t[e];this.addFinishQuest(i)}},this.addFinishQuest=t=>{l[t]=!0},this.addFinishQuestArray=t=>{for(let e in t){let i=t[e];this.addFinishQuest(i)}},this.getFinishQuest=()=>l,this.checkFinishQuest=t=>!!l[t],this.deleteQuest=e=>{e.map(n=>{this.wnd.$.find(".quest-"+n).remove(),delete i[e],t.updateScroll()}),this.addFinishQuestArray(e)},this.prepareTypMonsterData=t=>{let e;return e=t.replace(" Common ("," "+_t("normal-monster",null,"npcs_kind")+" ("),e=e.replace(" Elite ("," "+_t("elita1",null,"npcs_kind")+" ("),e=e.replace(" Elite2 ("," "+_t("elita2",null,"npcs_kind")+" ("),e=e.replace(" Hero ("," "+_t("heros",null,"npcs_kind")+" ("),e=e.replace(" Titan ("," "+_t("tytan",null,"npcs_kind")+"/"+_t("colossus",null,"npcs_kind")+" ("),e},this.refresh=function(i,a){if(getEngine().isInitLoadTime()||g(),this.wnd||this.createWindow(),e==i)return;e=i;let r=this.prepareTypMonsterData(i);const l=isset(Engine.hero.d.gender)?Engine.hero.isMan():o(a.h.gender);r=s.sexModify(r,l);for(var c=$(r),d=0;d<c.length;d++){const t=n.get("quest-box"),e=$(c[d]),i=parseInt(e.data("quest-id")),a=[],s=e.find(".q_title"),r=escapeHTML(s.html()),o=e.find(".q_doit");s.remove(),o.length>0&&o.html(parseContentBB(o.html(),!1));let l=e.find(".q_bring"),h=l.length,u=[];for(let t=0;t<h;t++){let e=l.eq(t).text();e=e.replace("Zdobądź: ",""),e=e.replace(/\s\([0-9]+\/[0-9]+\)/,""),u.push(e)}t.find(".d-table").remove(),t.addClass("quest-"+i),t.find(".quest-title").html(r),e.find("[data-cancellable]").length>0&&this.leaveQuest(e,a,i),this.trackingQuest(a,i),this.questsObserve(a,i),this.showDetails(a,t,i),this.addOneQuestData(i,r,e,a,u),t.find(".quest-content").html(e),t.find(".quest-buttons-wrapper").html(a),this.appendToQuestToList(i,t)}t.updateScroll(),p()};const p=()=>{if(!getEngine().interface.getInterfaceStart())return;if(!i)return;let t=getEngine().questTracking.getActiveQuestTrackingInStorage();if(null==t)return;let e=i[t];if(!e)return;let n=e.itemsArray;var a;if(n.length)for(let t=0;t<n.length;t++){let e=n[t];a=e,r.HIGHLIGHT_CLASS.QUEST,getEngine().heroEquipment.setClassInItemsHighlightIfExist(a,r.HIGHLIGHT_CLASS.QUEST)}},g=()=>{getEngine().interface.getInterfaceStart()&&getEngine().heroEquipment.clearHighlightInItems(r.HIGHLIGHT_CLASS.QUEST)};this.appendToQuestToList=(t,e)=>{this.wnd.$.find(".quest-"+t).length?(this.wnd.$.find(".quest-"+t).replaceWith(e),Engine.questsObserve.updateOneQuestObserve(t)):this.wnd.$.find(".quest-log .scroll-pane").append(e)},this.showDetails=function(e,i,s){var r=a.get("hideQuest/"+s),o=r?"show":"hide",l=r?"none":"block",c=n.get("button").addClass("small green"),d=n.get("add-bck").addClass(o);i.find(".quest-content").css("display",l),c.find(".label").html("0").css("visibility","hidden"),c.append(d),c.tip(_t("hideOrShowquest")),c.on("click",(function(){var e=i.find(".quest-content"),n="block"==e.css("display"),r=$(this).find(".add-bck");r.removeClass("show hide"),n?(e.css("display","none"),r.addClass("show"),a.set("hideQuest/"+s,!0)):(e.css("display","block"),r.addClass("hide"),a.set("hideQuest/"+s,!1)),t.updateScroll()})),e.push(c)},this.leaveQuest=function(e,i,a){var s=n.get("button").addClass("small green remove");s.find(".label").html("0").css("visibility","hidden"),s.tip(_t("removequest")),s.on("click",(function(e){e.stopPropagation(),t.cancelQuest(a)}));var r=n.get("add-bck").addClass("delete");s.append(r),i.push(s)},this.questsObserve=(e,i)=>{let a=n.get("button").addClass("small observe button-observe-id-"+i),s=n.get("add-bck").addClass("observed");a.find(".label").html("0").css("visibility","hidden"),a.tip(_t("add_to_observe")),a.append(s),a.click((function(){if($(this).hasClass("green"))t.removeObserve(i);else{if(!Engine.questsObserve.checkCanObserve())return;_g("quests&a=observe_add&quest_id="+i)}})),e.push(a)},this.removeObserve=t=>{_g("quests&a=observe_remove&quest_id="+t)},this.setStateOfObserveOnButton=(t,e)=>{let i=this.wnd.$.find(".button-observe-id-"+t);e?i.addClass("green"):i.removeClass("green")},this.trackingQuest=function(e,i){var a=n.get("button");a.addClass("small track button-tracking-id-"+i),a.find(".label").html("0").css("visibility","hidden"),a.tip(_t("turnonOfftracking")),a.on("click",(function(e){e.stopPropagation();let n=getEngine().questTracking.getActiveQuestTrackingInStorage()==i?null:i;t.toggleTrack(n)})),a.append(n.get("add-bck").addClass("tracking")),e.push(a)},this.loadQuestIcon=function(t,e){Engine.imgLoader.onload(e,!1,!1,i=>{t.css({backgroundImage:"url('"+e+"')",width:i.width,height:i.height})},()=>{t.hide()})},this.setBrings=function(t,e){if(e.length){t.addClass("active");var i=e.join("<br>");return t.html(i),i}},this.colorKillBringWordCom=function(t){return t.replace(/Kill:/gi,'<span class="red">Kill:</span>').replace(/Bring:/gi,'<span class="blue">Bring:</span>')},this.refreshQlog=function(e){getEngine().isInitLoadTime()||g(),this.wnd||this.createWindow();for(var i=0;i<e.length;i+=6){var a=parseInt(e[i].replace(/g|d/,"")),s=e[i+4].split("<br>"),r="c"===e[i+5],o=[],l=[];let p=[];for(var c=1;c<s.length;c++){var d=t.colorKillBringWordCom(s[c]);if(o.push(d.replace(/#[KB]\.([0-9]+)#/g,"")),s[c].match(/#B.[0-9+]#Bring:\s/)){let t=s[1].replace(/#B.[0-9+]#Bring:\s/,"");t=t.replace(/\s\([0-9+]\/[0-9+]\)/,""),p.push(t)}}var h=n.get("quest-box"),u=h.find(".quest-content");h.addClass("quest-"+a),u.addClass("quest-content--com");var f=h.find(".quest-title"),m=u.find(".q_icon");m.css("display","block");var v=u.find(".q_doit"),E=u.find(".q_kill").addClass("q_kill_en"),_=CFG.a_npath+e[i+3];const g=escapeHTML(e[i+1]);f.html(g),t.loadQuestIcon(m,_),v.html(e[i+2]+": "+parseContentBB(s[0]));var b=t.setBrings(E,o);r&&this.leaveQuest(!1,l,a),this.trackingQuest(l,a),this.questsObserve(l,a),this.showDetails(l,h,a),h.find(".quest-buttons-wrapper").html(l);var w=$("<div>").html(v.clone());w.append(b),this.addOneQuestData(a,g,w,l,p),this.appendToQuestToList(a,h),this.wnd.$.find(".scroll-pane").append(h)}p()},this.toggleTrack=function(t){getEngine().questTracking.setActiveQuestTrackingProcedure(t),c()},this.cancelQuest=function(t){mAlert(_t("quest_cancel_confirm",null,"quest"),[{txt:_t("yes",null,"buttons"),callback:function(){return isPl()?_g("quests&a=cancel&quest_id="+t):_g("quests&cancel="+t),!0}},{txt:_t("no",null,"buttons"),callback:function(){return!0}}])},this.refreshTrackQuestButtons=c,this.setTrackItemsAfterInterfaceStart=()=>{p()},this.checkItemIsQuestItemAndAddHigllight=(t,e)=>{if(!i)return;let n=getEngine().questTracking.getActiveQuestTrackingInStorage();if(null==n)return;let a=i[n];if(!a)return;let s=a.itemsArray;if(s.length)for(let i=0;i<s.length;i++)if(s[i]==t){let i=getEngine().heroEquipment.getAmountItem$highlightById(t,e);if(!i)continue;i.hasClass(r.HIGHLIGHT_CLASS.QUEST)||i.addClass(r.HIGHLIGHT_CLASS.QUEST)}},this.addHighlightsInQuestItems=p,this.clearHighlightQuestInItems=g}},function(t,e){t.exports=function(){var t=this;this.opacity=.6;var e=new Lock(["image","position"],(function(){t.collider={box:[32*t.rx+16-t.fw/2,32*t.ry+32-t.fh,32*t.rx+16+t.fw/2,32*t.ry+32]}}));this.init=function(t){let i;switch(t){case"npc":i="/img/glow-blue.png";break;case"npc_item":i="/img/placeholder_npc_item.png"}Engine.imgLoader.onload(i,!1,!1,t=>{this.fw=t.width,this.fh=t.height,this.img=t,e.unlock("image")})},this.setPosition=function(t){this.rx=parseInt(t.rx),this.ry=parseInt(t.ry),e.unlock("position")},this.setEnabled=function(t){this.enabled=t},this.setTip=function(t){this.tip=[t]},this.setOpacity=function(t){this.opacity=t},this.getOrder=function(){return.05},this.draw=function(t){if(this.enabled&&-1!=parseInt(this.rx)&&-1!=parseInt(this.rx)){var e=32*this.rx+16-this.fw/2-Engine.map.offset[0],i=32*this.ry+7-this.fh+32-Engine.map.offset[1];t.globalAlpha=this.opacity,e=Math.round(e),i=Math.round(i),this.img&&t.drawImage(this.img,0,0,this.fw,this.fh,e,i,this.fw,this.fh),t.globalAlpha=1}}}},function(t,e,i){var n=i(0);i(26);const{getAllProfName:a}=i(2);t.exports=function(){var t,e,i=this;this.wnd=null,this.init=function(){i.initWnd(),i.initButton(),i.centeWnd()},this.initWnd=function(){Engine.windowManager.add({content:n.get("log-off"),nameWindow:Engine.windowsData.name.LOG_OFF,nameRefInParent:"wnd",objParent:this,title:_t("log-out",null,"logoff"),addClass:"log-off-wnd",backdrop:Engine.interface.get$alertsLayer(),onclose:()=>{i.close()}}),this.wnd.addToAlertLayer()},this.update=function(n){0!==n&&Engine.changePlayer?(t&&clearInterval(t),Engine.lock.add("logoff"),e=n,i.updateLabel(e),t=setInterval((function(){e--,i.updateLabel(e)}),1e3)):this.close()},this.updateLabel=function(t){var e,n=Engine.changePlayer.getDestinationCharacter(),a=t<0?0:t;e=null!==n?_t("change-log-time %val% %nick%",{"%val%":a,"%nick%":n.nick,"%lvl%":n.lvl,"%prof%":n.prof,"%world%":capitalize(n.world)},"logoff"):_t("logout-time %val%",{"%val%":a},"logoff"),i.wnd.$.find(".time-to-out").html(e)},this.centeWnd=function(){this.wnd.center()},this.initButton=function(){var t=n.get("button").addClass("small green");if(t.find(".label").html(_t("cancel")),t.click((function(){_g("logoff&a=stop")})),this.wnd.$.find(".log-out-actions").append(t),Engine.changePlayer&&Engine.changePlayer.id){Engine.changePlayer.getDestinationCharacter().world!==Engine.worldConfig.getWorldName()&&i.addRelogButton()}else{var e=n.get("button").addClass("small green");e.find(".label").html(_t("out",null,"logoff")),e.click((function(){window.location.replace("https://margonem."+getMainDomain())})),this.wnd.$.find(".log-out-actions").append(e)}},this.addRelogButton=function(){var t=n.get("button").addClass("small green");t.find(".label").html(_t("relog",null,"logoff")),t.click((function(){Engine.stop(),i.out()})),this.wnd.$.find(".log-out-actions").append(t)},this.out=function(){var t=Engine.changePlayer.id;t?Engine.changePlayer.reloadPlayer(t):window.location="https://margonem."+getMainDomain()},this.close=function(){clearInterval(t),t=null,Engine.lock.remove("logoff"),i.wnd.remove(),Engine.logOff=!1,Engine.changePlayer&&(Engine.changePlayer.id=null)}}},function(t,e,i){var n=i(0),a=i(55),s=i(18);t.exports=function(t){var e,i=this,r=0;let o={},l=[];this.init=function(){this.initWindow(),this.initBottomPanel(),this.getItems(),this.setOffers(t),this.showChestBeforePremium(),this.wnd.center(),Engine.lock.add("shop")},this.showChestBeforePremium=function(){CFG.chest?i.wnd.$.find(".info-label").css("display","none"):i.wnd.$.find(".go-to-shop").css("display","none")},this.initBottomPanel=function(){i.wnd.$.find(".info-label").html(_t("buy_sl_label",null,"shop"));var t=n.get("button").addClass("small purple");t.find(".label").html(_t("buy_sl",null,"shop")),i.wnd.$.find(".buy-sl").append(t),t.click((function(t){t.stopPropagation(),Engine.draconiteShop||(Engine.draconiteShop=new s,Engine.draconiteShop.open())}));var e=n.get("button").addClass("small green go-to-shop");e.find(".label").html(_t("go_to_show",null,"shop")),i.wnd.$.find(".buy-sl").append(e),e.click((function(t){t.stopPropagation(),Engine.premium||(Engine.premium=new a,Engine.premium.init()),i.close()}))},this.newCrazyItemShop=function(t){const e=o[t.tplId];var a=n.get("promo-chest"),s=n.get("button").addClass("small purple"),l=n.get("button").addClass("small purple");s.find(".label").html(_t("buying_items",null,"shop")),l.find(".label").html(_t("items_list"));var c=i.getClass(e.name);a.find(".chest-img").addClass(c),a.find(".price-txt").html(t.price+" "+_t("sl")),a.find(".btn-wrapper").append(s),a.find(".btn-wrapper").append(l),a.find(".txt-html").html(_t("chest_"+r)),a.find(".header-txt").html(e.name.toUpperCase()),i.wnd.$.find(".chests-choice-wrapper").append(a),s.click((function(){i.acceptBuy(t.price,t.id)})),l.click((function(){_g("moveitem&st=2&tpl="+e.id),Engine.tpls.deleteMessItemsByLoc("p"),Engine.tpls.deleteMessItemsByLoc("s")})),i.wnd.center(),r++},this.getClass=function(t){var e=new RegExp("czerwonego","gi"),i=new RegExp("czarnego","gi");return t.match(e)?"red-dragon-chest-g":t.match(i)?"black-dragon-chest-g":void 0},this.acceptBuy=function(t,e){if(Engine.hero.d.credits<t)mAlert(_t("low_sl"));else{var i={ik:"oimg",ip:"/draconite_small.gif",it:t,m:"yesno2",q:_t("accept_dragon_chest",null,"shop"),re:"shop&buy="+e+",1&sell="};askAlert(i)}},this.newItem=(t,e)=>{o[t.id]=t,e&&null!==l&&l.map(t=>this.newCrazyItemShop(t))},this.setOffers=t=>{isset(t.items_offers)&&(l=t.items_offers)},this.getItems=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_CHEST,i.newItem)},this.initWindow=function(){e=n.get("chests-window"),Engine.windowManager.add({content:e,title:_t("sl-chests",null,"shop"),nameWindow:Engine.windowsData.name.CHESTS_WINDOW,objParent:i,nameRefInParent:"wnd",onclose:()=>{i.close()}}),i.wnd.addToAlertLayer()},this.hide=function(){i.close()},this.close=function(){o={},l=[],Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_CHEST),Engine.tpls.deleteMessItemsByLoc("n"),Engine.lock.remove("shop"),i.wnd.remove(),Engine.chests=!1}}},function(t,e,i){const n=i(0),a=i(23);t.exports=function(){var t,e=this,i=!1,s={},r=null;this.initPrize=function(t){this.initWindow(),this.initHeader(t),this.checkExpire(t),this.checkUse(t),this.checkUnique(t),this.createList(),e.wnd.center(),Engine.lock.add("PromoItems")},this.initWindow=function(){t=n.get("code-manager"),Engine.windowManager.add({content:t,title:_t("promo_codes",null,"promocodes"),nameWindow:Engine.windowsData.name.CODE_MANAGER,objParent:this,nameRefInParent:"wnd",onclose:()=>{e.close()}}),this.wnd.addToAlertLayer()},this.initAskAlert=function(){var t=_t("give_promo_code",null,"codeManager");askAlert({q:t,re:"codeprom&code=",m:"inputDataCodeProm"}),mobileCheck()||$("#promo-code-input").focus()},this.checkUnique=function(t){var e=0!=t.usage_limit?_t("promo_use_count %use% %max%",{"%use%":t.usage_limit-t.usage_count},"promocodes"):_t("promo_unlimited %use% %max%",null,"promocodes");this.wnd.$.find(".info-label").html(e)},this.checkUse=function(t){t.used&&(this.wnd.$.find(".promo-alert-use").css("display","block").html(t.used),i=!0)},this.checkExpire=function(t){if(t.expire>0&&t.expire<unix_time()){var i=_t("promo_expired",null,"promocodes");e.wnd.$.find(".promo-alert-expire").css("display","block").html(i)}},this.initHeader=function(t){var e=this.wnd.$;e.find(".info-box").html(t.name),e.find(".info-desc").html(t.desc).css("display","block")},this.createList=function(){Engine.items.fetch(Engine.itemsFetchData.NEW_PROMO_ITEM,e.newPromoItem)},this.newPromoItem=function(t){var i=$("<div>");s[t.id]=t,e.createCloneItem(i,t)},this.createCloneItem=function(t,e){e.y<3&&this.addToGroup(e,"1",0),e.y>2&&e.y<6&&this.addToGroup(e,"2",3),e.y>5&&this.addToGroup(e,"3",6)},this.addToGroup=function(t,i,n){var a=Engine.items.createViewIcon(t.id,Engine.itemsViewData.CODE_PROMO_ITEM_VIEW)[0],s=e.wnd.$.find(".grid"),r=$("<div>").addClass("item-slot").css("position","absolute");if(0==s.find(".group-"+i).length){var o=$("<div>").addClass("group-"+i+" group");s.append(o),this.chooseButton(i)}this.setPos(r,t,n),s.find(".group-"+i).append(r),r.append(a),a.contextmenu((function(e,i){t.createOptionMenu(getE(e,i))}))},this.setPos=function(t,e,i){t.css({left:35*e.x+10,top:35*(e.y-i)})},this.chooseButton=function(t){const n=e.wnd.$.find(".group-"+t),s={text:_t("promo_choose",null,"promocodes"),classes:["small","green"],action:()=>{_g("codeprom&code="+r+"&opt="+t,e.close)},disabled:i},o=new a.default(s);n.append(o.getButton())},this.deletePromoItems=function(){for(var t in s)Engine.items.deleteItem(t),s[t]=null},this.setCode=function(t){r=escape(t.trim())},this.getCode=function(){return r},this.close=function(){Engine.items.removeCallback(Engine.itemsFetchData.NEW_PROMO_ITEM),e.wnd.remove(),e.deletePromoItems(),Engine.lock.remove("PromoItems"),Engine.codeProm=!1}}},function(t,e,i){var n=i(0),a=i(55),s=i(18);t.exports=function(t){var e,i=this,r=0;let o={},l=[];this.init=function(){r=t.sellp,this.initWindow(),this.initBottomPanel(),this.getItems(),this.setOffers(t),this.setPromotionTxt(),this.initScrollbar(),this.wnd.center(),Engine.lock.add("shop")},this.initBottomPanel=function(){var t=n.get("button").addClass("small purple");t.find(".label").html(_t("buy_sl",null,"shop")),i.wnd.$.find(".buy-sl").append(t),t.click((function(t){t.stopPropagation(),Engine.draconiteShop||(Engine.draconiteShop=new s,Engine.draconiteShop.open())}));var e=n.get("button").addClass("small green go-to-shop");e.find(".label").html(_t("go_to_show",null,"shop")),i.wnd.$.find(".buy-sl").append(e),e.click((function(t){t.stopPropagation(),Engine.premium||(Engine.premium=new a,Engine.premium.init()),i.close()}))},this.initBuyPanel=function(){var t=n.get("button").addClass("green");t.find(".label").html(_t("buy_promo")),i.wnd.$.find(".buy-btn").append(t),t.click((function(){i.acceptBuy(0)}))},this.newCrazyItemShop=function(t){const e=o[t.tplId];var a=n.get("shop-promo-item");let s=Engine.tpls.createViewIcon(e.id,Engine.itemsViewData.SHOP_PROMO_ITEM_VIEW,Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_CHEST.loc)[0];a.find(".item-slot-container").append(s),s.on("contextmenu",t=>{e.createPromoOptionMenu(t)}),a.find(".item-price").append(e.pr+" "+_t("sl",null,"clan")),a.find(".item-price-new").append(t.price+" "+_t("sl",null,"clan"));var r=n.get("button").addClass("small green buy-item-btn");r.find(".label").html("Buy"),r.click((function(){i.acceptBuy(t.price,t.id)})),a.find(".btn-wrapper").append(r),i.wnd.$.find(".items-wrapper").append(a),i.wnd.center()},this.acceptBuy=function(t,e){if(Engine.hero.d.credits<t)mAlert(_t("low_sl"));else{var i={ik:"oimg",ip:"/draconite_small.gif",it:t,m:"yesno2",q:_t("accept_buy_promo",null,"shop"),re:"shop&buy="+e+",1&sell="};askAlert(i)}},this.setPromotionTxt=function(){i.wnd.$.find(".promo-percent").html(100-r+"% "+_t("cheaper"))},this.newItem=(t,e)=>{o[t.id]=t,e&&null!==l&&(l.map(t=>this.newCrazyItemShop(t)),i.updateScrollbar())},this.getItems=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_PROMO,i.newItem)},this.setOffers=t=>{isset(t.items_offers)&&(l=t.items_offers)},this.initScrollbar=()=>{i.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})},this.updateScrollbar=()=>{i.wnd.$.find(".scroll-wrapper").trigger("update")},this.initWindow=function(){e=n.get("promo-window"),Engine.windowManager.add({content:e,nameWindow:Engine.windowsData.name.PROMO,nameRefInParent:"wnd",objParent:this,addClass:"promo-window-wnd",title:_t("new_premium_item_20",null,"premium_panel"),onclose:()=>{i.close()}}),this.wnd.addToAlertLayer()},this.hide=function(){i.close(),Engine.premium&&Engine.premium.finishHideShop()},this.sendRequest=function(){_g("".slice(0,-1)+"&sell=")},this.close=function(){Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_PROMO),Engine.tpls.deleteMessItemsByLoc(Engine.itemsFetchData.NEW_CRAZY_TPL_SHOP_CHEST.loc),Engine.lock.remove("shop"),i.wnd.remove(),Engine.promo=!1},this.init()}},function(t,e,i){let n=i(19),a=i(284),s=i(285),r=i(286),o=i(287),l=i(288),c=i(289),d=i(290),h=i(291),u=i(292),p=i(293),g=i(294),f=i(299);t.exports=function(){let t=null,e=null,i=0,m=null,v=null,E=null,_=null,b=null,w=null,C=null,T=null,y=null,I=null,A=null,k=null,S=null,O=null,M=null;const N=()=>{w=new a,C=new s,y=new o,T=new r,b=new l,I=new f,A=new g,O=new u,k=new c,S=new h,M=new p},R=()=>{C.init(),w.init(),T.init(),y.init(),O.init(),b.init(),I.init(),M.init(),k.init(),S.init(),A.init()},x=t=>{L(t)},L=t=>{e=t},D=()=>{null!=e?L(e-1):errorReport("AuctionManager.js","decrementTotalOffers","Can not decrement totalOffers, totalOffers = null!")},P=()=>{null!=e?L(e+1):errorReport("AuctionManager.js","incrementTotalOffers","Can not increment totalOffers, totalOffers = null!")},B=(t,e)=>{for(let i in t){let n,a=t[i],s=a.id,r=a.item_id,o=j(s);o?(n=q(s),n.updateOffer(a)):(n=new d,n.init(a),U(s,n),V(r,s)),I.checkItemExistInAllFetchItems(r)&&I.attachIconToSlotProcedure(r);let l=n.get$Offer();o||b.addToOffersTable(l,e)}},F=()=>{Engine.lock.add("auctions")},W=()=>{Engine.lock.remove("auctions")},$=()=>{S.clearItemCategory(),b.clearAuctionsInTableWithOffers()},H=e=>{t=e},G=t=>{v[t].removeOffer(),delete v[t]},V=(t,e)=>{E[t]=e},U=(t,e)=>{v[t]=e},j=t=>!!v[t],q=t=>v[t],K=()=>{v={}},Y=()=>{E={}},z=t=>{_=t},X=()=>{const t=Engine.windowsData.windowCloseConfig.AUCTION;Engine.windowCloseManager.callWindowCloseConfig(t)};this.init=()=>{X(),K(),Y(),N(),R(),F()},this.close=()=>{A.close(),C.destroy(),Engine.items.removeCallback(Engine.itemsFetchData.NEW_AUCTION_ITEM),Engine.items.deleteMessItemsByLoc(Engine.itemsFetchData.NEW_AUCTION_ITEM.loc),Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.AUCTION),Engine.auctions=!1,W(),b.close()},this.tLang=t=>_t(t,null,"auction"),this.updateData=t=>{if(t.configuration&&z(t.configuration),t.status&&isset(t.status.featuredCount)&&(H(t.status.featuredCount),A.manageVisibleSpecialOffer(),A.updateCheckbox()),t.add){let e=j(t.add.id);e||P(),m==n.KIND_MY_AUCTION.MY_AUCTION_OFF?(B([t.add],!0),e||b.scrollTop()):B([t.add]),this.getAuctionWindow().updateScroll(),b.updateAmountOfAuction()}if(t.remove&&(D(),G(t.remove),b.updateScroll(),b.updateAmountOfAuction()),t.show){let e=t.show.tab,i=t.show.offers;if(e!=m)return;isset(t.show.totalOffers)&&x(t.show.totalOffers),t.show.page&&(y.updatePages(t.show.page),b.updateAmountOfAuction());let n=y.getCurrentPage(),a=y.getMaxPage(),s=1==n||0==a;if(s){S.isShowCategoryExist()?b.clearOfferListAndOffersTableAndAttachHeaderOfTable():($(),b.setFirstHeaderOfTable())}B(i),s&&b.updateScroll(),b.updateBarPos()}},this.updateTimeOfAuction=()=>{for(let t in v)v[t].updateTime()},this.getAuctionBidAndBuyNowActions=()=>M,this.getAuctionWindow=()=>b,this.getAuctionItems=()=>I,this.getAuctionCards=()=>O,this.getAuctionOffItemPanel=()=>A,this.getAuctionPages=()=>y,this.getAuctionSort=()=>T,this.getAuctionRequest=()=>w,this.getAuctionSearchItems=()=>k,this.getAuctionItemCategory=()=>S,this.getTotalOffers=()=>e,this.getFeaturedCount=()=>t,this.getOneOfferByItemId=t=>{let e=E[t];return null==e?null:q(e)},this.getOneOffer=q,this.getActualKindOfAuction=()=>m,this.getAuctionMode=()=>i,this.setActualKindOfAuction=t=>{m=t},this.setAuctionMode=t=>{i=t},this.getConfig=()=>_,this.removeFromOfferList=G,this.clearOfferList=K,this.clearPairItemIdOfferIdObject=Y,this.putAuctionOffItem=t=>{m!=n.KIND_MY_AUCTION.MY_AUCTION_OFF&&b.setMyAuctionOffTabAction(),A.manageOfShow(t),A.putAuctionOffItem(t)},this.clearAllStates=$}},function(t,e){t.exports=function(){const t=t=>{let i=e(t);_g(i)},e=(t,e)=>{let i=Engine.auctions.getAuctionSearchItems().getFilterString(t),n=Engine.auctions.getAuctionSort().getSortString(),a="";return e&&(a="&action="+e),`ah${a}&cat=${Engine.auctions.getAuctionItemCategory().getShowCategory()}&filter=${i}&sort=${n}`};this.init=()=>{},this.firstPageOfMainAuctionRequest=()=>{t(1)},this.setAuctionOffActionRequest=(t,e)=>{const i=isset(e.price)?"&price="+e.price:"",n=isset(e.time)?"&time="+e.time:"",a=isset(e.is_featured)?"&is_featured="+e.is_featured:"",s=isset(e.buy_out)?"&buy_out="+e.buy_out:"";_g(`ah&action=sell&item=${t}${i}${n}${a}${s}`)},this.getNextPageRequest=(t,i)=>{let n=e(t);_g(n,()=>{i()})},this.mainAuctionRequest=t,this.buyNowRequest=t=>{_g("ah&action=buyout&auction="+t)},this.renewAuctionRequest=(t,e)=>{_g(`ah&action=change_time&auction=${t}&time=${e}`)},this.renewAllAuctionRequest=t=>{let i=e(1,"change_time_all&time="+t);_g(i)},this.deleteAuctionRequest=t=>{_g("ah&action=end&auction="+t)},this.observedRequest=(t,i,n)=>{let a=((t,i,n)=>{if(t){return e(n,"observation_remove&auction="+i)}return"ah&action=observation_add&auction="+i})(t,i,n);_g(a)},this.bidRequest=(t,e)=>{_g(`ah&action=bid&auction=${t}&price=${e}`)}}},function(t,e){t.exports=function(){let t=null;const e=()=>{t=setInterval(()=>{i()},1e3)},i=()=>{Engine.auctions.updateTimeOfAuction()};this.init=()=>{e()},this.destroy=()=>{clearInterval(t),t=null}}},function(t,e,i){let n=i(19);t.exports=function(){let t=n.AUCTION_CEIL.ITEM_TIME_TD.sort,e=n.SORT_ORDER.DESC;const i=e=>{if(t==e){let t=s()?n.SORT_ORDER.DESC:n.SORT_ORDER.ASC;r(t)}else a(e),r(n.SORT_ORDER.ASC)},a=e=>{t=e},s=()=>e==n.SORT_ORDER.ASC,r=t=>{e=t};this.callChangeSort=t=>{i(t),Engine.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()},this.getSortType=()=>t,this.getSortOrder=()=>e,this.getSortString=()=>`${null==t?"":t}|${null==e?0:e}`,this.init=()=>{}}},function(t,e){t.exports=function(){let t=null,e=null;this.init=()=>{},this.updatePages=i=>{t=i.number,e=i.total},this.getCurrentPage=()=>t,this.getMaxPage=()=>e,this.getNextPageAction=()=>{if(null==t||null==e||t==e)return;let i=t+1;Engine.auctions.getAuctionRequest().getNextPageRequest(i,()=>{Engine.auctions.getAuctionWindow().stopDragBar()})}}},function(t,e,i){let n=i(0),a=i(19);t.exports=function(){let t,e,i=null;const s=()=>{let e=$("<div>").addClass("scroll-auction-plug");$(".scroll-wrapper",t).find(".scrollbar-wrapper").append(e)},r=()=>{$(".scroll-wrapper",t).trigger("scrollTop")},o=()=>{t=n.get("auction-window"),e=Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.AUCTION_WND2,title:Engine.auctions.tLang("auction_title"),managePosition:{position:Engine.windowsData.position.CENTER_OR_STICK_TO_EQ},onclose:()=>{Engine.auctions.close()}}),e.addToAlertLayer(),e.center()},l=()=>{let e=Engine.auctions.tLang("auction_off_item"),i=createButton(e,["small","green"],()=>{Engine.auctions.getActualKindOfAuction()!=a.KIND_MY_AUCTION.MY_AUCTION_OFF&&c(),Engine.auctions.getAuctionOffItemPanel().manageOfShow(),Engine.auctions.getAuctionOffItemPanel().manageVisibleElements()});t.find(".auction-off-btn-wrapper").append(i)},c=()=>{Engine.auctions.getAuctionCards().clickCard(1,null),A(a.KIND_MY_AUCTION.MY_AUCTION_OFF)},d=()=>{let e=Engine.auctions.getActualKindOfAuction(),i=t.find(".auction-renew-btn-wrapper"),n=e==a.KIND_MY_AUCTION.MY_AUCTION_OFF?"block":"none",s=e==a.KIND_OTHERS_AUCTION.ALL_AUCTION;h(s),u(!s),i.css("display",n)},h=e=>{t.find(".all-auction-info-wrapper").css("display",e?"block":"none")},u=e=>{t.find(".amount-of-auction").css("display",e?"block":"none")},p=()=>{let e=Engine.auctions.tLang("renev_all_auction"),i=createButton(e,["small","green"],()=>{let t=Engine.auctions.tLang("renev_all_auction_confirmation");confirmWitchNumberTextInput(t,t=>{if(checkInputValIsEmptyProcedure(t))return!1;f(t)},{placeholder:"2-168",value:168})});t.find(".auction-renew-btn-wrapper").append(i)},g=()=>{Engine.auctions.clearOfferList(),Engine.auctions.clearPairItemIdOfferIdObject(),_()},f=t=>{Engine.auctions.getAuctionRequest().renewAllAuctionRequest(t)},m=()=>{t.find(".main-all-auction-scroll").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".all-auction-section",t),callback:v})},v=t=>{Engine.auctions.getAuctionPages().getNextPageAction()},E=()=>{i=t.find(".auction-table")},_=()=>{i.empty(),e.$.find(".auction-table-header").empty()},b=t=>{let e=Engine.auctions.getAuctionSort();if(e.getSortType()!=t)return null;let i=e.getSortOrder();switch(i){case a.SORT_ORDER.ASC:return!1;case a.SORT_ORDER.DESC:return!0;default:errorReport("AuctionManager","getSortVal","Bad val of sortOrder:"+i)}return null},w=()=>{let t=e.$.find(".auction-table-header"),i=T({[a.AUCTION_CEIL.ITEM_SLOT_TD.key]:null,[a.AUCTION_CEIL.ITEM_NAME_TD.key]:b(a.AUCTION_CEIL.ITEM_NAME_TD.sort),[a.AUCTION_CEIL.ITEM_LEVEL_TD.key]:b(a.AUCTION_CEIL.ITEM_LEVEL_TD.sort),[a.AUCTION_CEIL.ITEM_TIME_TD.key]:b(a.AUCTION_CEIL.ITEM_TIME_TD.sort),[a.AUCTION_CEIL.ITEM_BID_TD.key]:b(a.AUCTION_CEIL.ITEM_BID_TD.sort),[a.AUCTION_CEIL.ITEM_BUY_NOW_TD.key]:b(a.AUCTION_CEIL.ITEM_BUY_NOW_TD.sort),[a.AUCTION_CEIL.AUCTION_ACTION_TD.key]:null});t.append(i),r()},C=(t,e)=>{let i;return i=null==t[e]?"":"sort-arrow "+(t[e]?"sort-arrow-up":"sort-arrow-down"),e+" "+i},T=t=>{let e="header-auction-td center hover-td ",i=Engine.auctions.getAuctionSort(),n=_t("sort",null,"buttons");return createRecords(["Item",$("<span>").tip(n).html(_t("name_th",null,"auction")),$("<span>").tip(n).html(_t("level",null,"auction")),$("<span>").tip(n).html(_t("au_time",null,"auction")),$("<span>").tip(n).html(_t("price_bid",null,"auction")),$("<span>").tip(n).html(_t("filter_buyout",null,"auction")),$("<span>").html(_t("clan_action",null,"clan"))],["header-auction-td center "+C(t,a.AUCTION_CEIL.ITEM_SLOT_TD.key),e+C(t,a.AUCTION_CEIL.ITEM_NAME_TD.key),e+C(t,a.AUCTION_CEIL.ITEM_LEVEL_TD.key),e+C(t,a.AUCTION_CEIL.ITEM_TIME_TD.key),e+C(t,a.AUCTION_CEIL.ITEM_BID_TD.key),e+C(t,a.AUCTION_CEIL.ITEM_BUY_NOW_TD.key),"header-auction-td center "+C(t,a.AUCTION_CEIL.AUCTION_ACTION_TD.key)],[!1,()=>{i.callChangeSort(a.AUCTION_CEIL.ITEM_NAME_TD.sort)},()=>{i.callChangeSort(a.AUCTION_CEIL.ITEM_LEVEL_TD.sort)},()=>{i.callChangeSort(a.AUCTION_CEIL.ITEM_TIME_TD.sort)},()=>{i.callChangeSort(a.AUCTION_CEIL.ITEM_BID_TD.sort)},()=>{i.callChangeSort(a.AUCTION_CEIL.ITEM_BUY_NOW_TD.sort)},!1])},y=()=>{e.$.find(".add-item-section").find(".item-slot").droppable({accept:".inventory-item",drop:function(t,e){e.draggable.css("opacity",""),setAuctionOffItem(e.draggable.data("item"),!1)}})},I=()=>{let e=t.find(".cards-header"),i=_t("tab_others_auctions",null,"auction"),n=_t("tab_my",null,"auction"),s=_t("tab_observed",null,"auction"),r=_t("tab_au_catmybids",null,"auction"),o=Engine.auctions.getAuctionCards();o.newCard(e,i,(function(){A(a.KIND_OTHERS_AUCTION.ALL_AUCTION)})),o.newCard(e,n,(function(){A(a.KIND_MY_AUCTION.MY_AUCTION_OFF)})),o.newCard(e,s,(function(){A(a.KIND_MY_AUCTION.MY_WATCH)})),o.newCard(e,r,(function(){A(a.KIND_MY_AUCTION.MY_BID)})),k()},A=t=>{S(t),d(),t==a.KIND_OTHERS_AUCTION.ALL_AUCTION?Engine.auctions.clearAllStates():Engine.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()},k=()=>{Engine.auctions.getAuctionCards().clickCard(0,null),S(a.KIND_OTHERS_AUCTION.ALL_AUCTION),d()},S=t=>{Engine.auctions.getAuctionItemCategory().clearItemCategory(),Engine.auctions.setActualKindOfAuction(t)};this.init=()=>{o(),E(),y(),I(),l(),p(),m(),s()},this.close=()=>{e.remove()},this.initCards=I,this.stopDragBar=()=>{$(".scroll-wrapper",t).trigger("stopDragBar")},this.updateScroll=()=>{$(".scroll-wrapper",t).trigger("update")},this.updateBarPos=()=>{$(".scroll-wrapper",t).trigger("updateBarPos")},this.updateAmountOfAuction=()=>{let e=_t("quantity_of_auction",null,"auction"),i="",n=Engine.auctions.getTotalOffers();i=Engine.auctions.getActualKindOfAuction()==a.KIND_MY_AUCTION.MY_WATCH?`${e}: ${n}/${a.MAX_OBSERVED}`:`${e}: ${n}`,t.find(".amount-of-auction").html(i)},this.setFirstHeaderOfTable=w,this.setCard=S,this.getContent=()=>t,this.addToOffersTable=(t,e)=>{e?i.prepend(t):i.append(t)},this.scrollTop=r,this.setSelectorVars=E,this.setMyAuctionOffTabAction=c,this.initScrollBar=m,this.clearAuctionsInTableWithOffers=g,this.clearOfferListAndOffersTableAndAttachHeaderOfTable=()=>{g(),w()},this.setVisibleAllAuctionsInfoWrapper=h,this.setVisibleAmountOfAuction=u}},function(t,e,i){let n=i(0),a=i(19),s=i(5),r=i(14);const o=i(16);t.exports=function(){let t=null,e=null,i=null,l=null,c=null,d=null,h=null,u=null,p=null,g=null,f=null,m=null;const v=()=>{i=e.find(".auction-type-wrapper").find(".menu-wrapper"),l=e.find(".item-prof-wrapper").find(".menu-wrapper"),c=e.find(".item-rarity-wrapper").find(".menu-wrapper"),d=e.find(".new-filter-wrapper").find(".menu-wrapper"),u=createNiInput({cl:"name-item-input",keyUpClb:E,focusoutClb:D,clearClb:D}),p=createNiInput({cl:"min-price-input",keyUpClb:E,focusoutClb:D,clearClb:D,type:o.TYPE.NUMBER_WITH_KMG}),g=createNiInput({cl:"max-price-input",keyUpClb:E,focusoutClb:D,clearClb:D,type:o.TYPE.NUMBER_WITH_KMG}),f=createNiInput({cl:"min-level-input",keyUpClb:E,focusoutClb:D,clearClb:D,type:o.TYPE.NUMBER}),m=createNiInput({cl:"max-level-input",keyUpClb:E,focusoutClb:D,clearClb:D,type:o.TYPE.NUMBER}),e.find(".item-name-wrapper").append(u),e.find(".item-price-wrapper").prepend(p),e.find(".item-price-wrapper").append(g),e.find(".item-lvl-wrapper").prepend(f),e.find(".item-lvl-wrapper").append(m),u=u.find("input"),p=p.find("input"),g=g.find("input"),f=f.find("input"),m=m.find("input")},E=(t,e)=>{"Enter"==e.originalEvent.key&&D()},_=()=>{e=n.get("auction-search-item"),t.find(".main-column-auction").prepend(e)},b=()=>{let t=Engine.auctions.tLang("min-price"),e=Engine.auctions.tLang("max-price"),i=Engine.auctions.tLang("min-level"),n=Engine.auctions.tLang("max-level");createInputPlaceholder(_t("name_th",null,"auction"),u),createInputPlaceholder(t,p),createInputPlaceholder(e,g),createInputPlaceholder(i,f),createInputPlaceholder(n,m)},w=t=>t.val(),C=()=>{let t=s.get("AUCTION_FILTERS",[]);y(t)||(t=[]),T(t),h=t},T=t=>{const e=a.FILTER_KEYS.FILTER_ID;for(let i in t){let n=t[i];isset(n[e])||(n[e]=parseInt(i))}},y=t=>{let e=a.FILTER_KEYS;for(let i in t){let n=t[i],a=null;if(isset(n[e.FILTER_NAME])||(a=e.FILTER_NAME),isset(n[e.MIN_LEVEL])||(a=e.MIN_LEVEL),isset(n[e.MAX_LEVEL])||(a=e.MAX_LEVEL),isset(n[e.RARITY])||(a=e.RARITY),isset(n[e.MIN_PRICE])||(a=e.MIN_PRICE),isset(n[e.MAX_PRICE])||(a=e.MAX_PRICE),isset(n[e.AUCTION_TYPE])||(a=e.AUCTION_TYPE),isset(n[e.PROF])||(a=e.PROF),isset(n[e.NAME_ITEM])||(a=e.NAME_ITEM),null!=a)return errorReport("AuctionSearchItems.js","checkCorrectData",`Key: ${a} not exist!`,n),!1}return!0},I=()=>{s.set("AUCTION_FILTERS",h)},A=(t,e,i,n,s,r,o,l,c,d)=>{let u=a.FILTER_KEYS,p={[u.FILTER_ID]:t,[u.FILTER_NAME]:e,[u.MIN_LEVEL]:i,[u.MAX_LEVEL]:n,[u.RARITY]:s,[u.MIN_PRICE]:r,[u.MAX_PRICE]:o,[u.AUCTION_TYPE]:l,[u.PROF]:c,[u.NAME_ITEM]:d};h.push(p)},k=t=>{if(!q(t))return void errorReport("AuctionSearchItems.js","overrideFilterAction","Filter index not exist! : "+e,h);let e=K(t);deleteElementFromArray(e,h)},S=()=>{let e=createButton(_t("filter_refresh",null,"auction"),["green","small"],()=>{let t=Engine.auctions;t.getAuctionRequest().firstPageOfMainAuctionRequest(),t.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),t.getAuctionWindow().setVisibleAmountOfAuction(!0)});t.find(".refresh-button-wrapper").append(e)},O=()=>{let t=[u,p,g,f,m];for(let e in t)M(t[e])},M=t=>{t.on("keydown",(function(t){"Enter"==t.key&&N()}))},N=()=>{Engine.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()},R=t=>{for(let e in t)null==t[e]&&(t[e]="")},x=()=>{let t=w(f),e=w(m),n=w(p),s=w(g),r=w(u),o=c.getValue(),d=i.getValue(),h=l.getValue();t=isNaN(parseInt(t))?null:parsePrice(t),e=isNaN(parseInt(e))?null:parsePrice(e),n=isNaN(parseInt(n))?null:parsePrice(n),s=isNaN(parseInt(s))?null:parsePrice(s),r=""==r?null:r;let v=a.FILTER_KEYS;return{[v.NAME_ITEM]:r,[v.MIN_LEVEL]:t,[v.MAX_LEVEL]:e,[v.PROF]:h,[v.MIN_PRICE]:n,[v.MAX_PRICE]:s,[v.RARITY]:o,[v.AUCTION_TYPE]:d}},L=()=>{let t=[{text:_t("auction_type",null,"auctions"),val:a.TYPE_OF_BUY_AUCTION.ALL},{text:_t("au_catmybids",null,"auction"),val:a.TYPE_OF_BUY_AUCTION.BIDS},{text:_t("filter_buyout",null,"auction"),val:a.TYPE_OF_BUY_AUCTION.BUY_NOW}],e=[{text:_t("rarity",null,"auctions"),val:null},{text:X("all"),val:a.TYPE_OF_RARITY.ALL},{text:X("unique"),val:a.TYPE_OF_RARITY.UNIQUE},{text:X("heroic"),val:a.TYPE_OF_RARITY.HEROIC},{text:X("legendary"),val:a.TYPE_OF_RARITY.LEGENDARY}],n=[{text:Engine.auctions.tLang("filter_prof"),val:null},{text:z("warrior"),val:r.WARRIOR},{text:z("paladin"),val:r.PALADIN},{text:z("mage"),val:r.MAGE},{text:z("hunter"),val:r.HUNTER},{text:z("bdancer"),val:r.BLADE_DANCER},{text:z("tracker"),val:r.TRACKER}];l.createMenu(n,!0,(function(t){D()})),i.createMenu(t,!0,(function(t){D()})),c.createMenu(e,!0,(function(t){D()})),F()},D=(t,e)=>{if(e&&e.relatedTarget&&e.relatedTarget.classList.contains("close-button"))return!1;let i=Engine.auctions;N(),P(),i.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),i.getAuctionWindow().setVisibleAmountOfAuction(!0)},P=()=>{let t=d.getValue();if(t==a.FILTER_ID.EMPTY_FILTER)return;if(!q(t))return void errorReport("AuctionSearchItems.js","overrideFilterAction","Filter index not exist! : "+t,h);let e=Y(t);B(e,t)},B=(t,e)=>{let i=x(),n=a.FILTER_KEYS;k(e),A(e,t,i[n.MIN_LEVEL],i[n.MAX_LEVEL],i[n.RARITY],i[n.MIN_PRICE],i[n.MAX_PRICE],i[n.AUCTION_TYPE],i[n.PROF],i[n.NAME_ITEM]),I()},F=()=>{let t=[{text:_t("no_filter",null,"auction"),val:a.FILTER_ID.EMPTY_FILTER}],e=(()=>{let t=[];const e=a.FILTER_KEYS.FILTER_ID,i=a.FILTER_KEYS.FILTER_NAME;for(let n in h){let a=h[n],s=a[e],r=a[i];t.push({text:r,val:s,id:s})}return t})(),i={addNewOption:{addItemConfirmText:_t("give_filter_name",null,"auction"),removeItemConfirmText:t=>_t("confirm_delete_filter",{"%val%":t},"ah_filter_history"),addTipText:_t("new_filter",null,"ah_filter_history"),menuToAddAndRemove:e,configAddItemIdAndName:{nameFromInputVal:!0,firstPossibleId:4},addItemConfirmValidate:function(t){return!checkInputValIsEmptyProcedure(t)&&(!W(t)||(message(Engine.auctions.tLang("filter_exist")),!1))},addItemConfirmClb:t=>{let e=t.val,i=t.id;$(e,i)},removeItemConfirmClb:t=>{var e;e=t.id,k(e),I()}},parseHTML:!1};d.empty(),d.createMenu(t,!0,(function(t){if(t==a.FILTER_ID.EMPTY_FILTER)return U(),void N();H(t),N(),Engine.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),Engine.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)}),i)},W=t=>{for(let e in h)if(h[e].FILTER_NAME==t)return!0;return!1},$=(t,e)=>{let i=x(),n=a.FILTER_KEYS;A(e,t,i[n.MIN_LEVEL],i[n.MAX_LEVEL],i[n.RARITY],i[n.MIN_PRICE],i[n.MAX_PRICE],i[n.AUCTION_TYPE],i[n.PROF],i[n.NAME_ITEM]),I()},H=t=>{q(t)?V(t):errorReport("AuctionSearchItems","setFilterAction","Filter not exist: "+t,h)},G=t=>{const e=a.FILTER_KEYS.FILTER_ID;for(let i in h){let n=h[i];if(n[e]==t)return n}},V=t=>{let e=G(t),i=copyStructure(e);R(i),j(i)},U=()=>{let t=a.FILTER_KEYS;j({[t.NAME_ITEM]:"",[t.MIN_LEVEL]:"",[t.MAX_LEVEL]:"",[t.MIN_PRICE]:"",[t.MAX_PRICE]:"",[t.RARITY]:"",[t.PROF]:"",[t.AUCTION_TYPE]:a.TYPE_OF_BUY_AUCTION.ALL})},j=t=>{let e=a.FILTER_KEYS;u.val(t[e.NAME_ITEM]),p.val(t[e.MIN_PRICE]),g.val(t[e.MAX_PRICE]),f.val(t[e.MIN_LEVEL]),m.val(t[e.MAX_LEVEL]),u.trigger("change"),p.trigger("change"),g.trigger("change"),f.trigger("change"),m.trigger("change"),i.setOptionWithoutCallbackByValue(t[e.AUCTION_TYPE]),l.setOptionWithoutCallbackByValue(t[e.PROF]),c.setOptionWithoutCallbackByValue(t[e.RARITY])},q=t=>{const e=a.FILTER_KEYS.FILTER_ID;for(let i in h)if(h[i][e]==t)return!0;return!1},K=t=>{const e=a.FILTER_KEYS.FILTER_ID;for(let i in h)if(h[i][e]==t)return i;return null},Y=t=>G(t)[a.FILTER_KEYS.FILTER_NAME];function z(t){return _t("prof_"+t,null,"auction")}function X(t){return _t("type_"+t,null,"auction")}this.getFilterString=t=>{let e=Engine.auctions,i=e.getActualKindOfAuction(),n=e.getAuctionMode(),s=t||e.getAuctionPages().getCurrentPage(),r=a.FILTER_KEYS,o=x();return R(o),esc(o[r.MIN_LEVEL])+"|"+esc(o[r.MAX_LEVEL])+"|"+o[r.PROF]+"|"+o[r.RARITY]+"|"+esc(o[r.MIN_PRICE])+"|"+esc(o[r.MAX_PRICE])+"|"+o[r.AUCTION_TYPE]+"|"+i+"|"+n+"|"+s+"|"+esc(o[r.NAME_ITEM])},this.init=()=>{t=Engine.auctions.getAuctionWindow().getContent(),_(),C(),v(),L(),S(),b(),O()}}},function(t,e,i){i(0);let n=i(19);t.exports=function(){let t,e=null,i=null,a=!1;const s=t=>{a=t},r=t=>{e=t},o=e=>{t=u(e)},l=t=>{i=t},c=()=>{let e=t.find(".item-time-td").find(".time-wrapper"),n=e.html(),a=getSecondLeft(i,{short:!0});n!=a&&e.html(a)},d=()=>{t.remove()},h=t=>{let e=$("<div>").addClass("time-wrapper"),i="<br>"+ut_fulltime(ts()/1e3+t.time),n=_t("end_time %val%",{"%val%":i},"end_time_auction");return e.tip(n),e.html(getSecondLeft(t.time,{short:!0})),e},u=t=>{t.id;let e="auction-td center ",i=t.is_featured;i&&(e+="is-featured ");let a=Engine.auctions.getAuctionBidAndBuyNowActions(),s=createRecords([$("<div>").addClass("item-slot"),"","",h(t),a.getBidCeil(t),a.getBuyNowCeil(t),p(t)],[e+n.AUCTION_CEIL.ITEM_SLOT_TD.key,e+n.AUCTION_CEIL.ITEM_NAME_TD.key,e+n.AUCTION_CEIL.ITEM_LEVEL_TD.key,e+n.AUCTION_CEIL.ITEM_TIME_TD.key,e+n.AUCTION_CEIL.ITEM_BID_TD.key,e+n.AUCTION_CEIL.ITEM_BUY_NOW_TD.key,e+n.AUCTION_CEIL.AUCTION_ACTION_TD.key]);return i&&s.addClass("is-featured-tr"),s},p=t=>{t.ordinal_number;let e=$("<div>").addClass("auction-wrapper"),i=Engine.auctions.getActualKindOfAuction();if(t.is_cancelable){return t.is_featured||e.append(g(t)),e.append(f(t)),e}return[n.KIND_MY_AUCTION.MY_WATCH,n.KIND_MY_AUCTION.MY_BID,n.KIND_OTHERS_AUCTION.ALL_AUCTION].includes(i)&&!t.own_auction?(e.append(m(t)),e):(e.text("-----"),e)},g=t=>{let e=Engine.auctions.tLang("canNotRenew"),i=Engine.auctions.tLang("renewAuction"),n=t.bidder?e:i,a=t.bidder?"inactive":"",s=createSmallButtonWithBackground(["reset"],["green"],()=>{if($(s).hasClass("inactive"))return;let e=Engine.auctions.tLang("renewAuctionConfirmation"),i=t.id;confirmWitchNumberTextInput(e,t=>{if(checkInputValIsEmptyProcedure(t))return!1;Engine.auctions.getAuctionRequest().renewAuctionRequest(i,t)},{placeholder:"2-168",value:168})}),r=$(s);return r.tip(n),r.addClass(a),r},f=t=>{let e=Engine.auctions.tLang("canNotRemoveAuction"),i=Engine.auctions.tLang("removeAuction"),n=t.bidder?e:i,a=t.bidder?"inactive":"",s=createSmallButtonWithBackground(["remove"],["green"],(function(){if($(s).hasClass("inactive"))return;let e=Engine.auctions.tLang("removeAuctionConfirm"),i=t.id;confirmWithCallback({msg:e,clb:()=>{Engine.auctions.getAuctionRequest().deleteAuctionRequest(i)}})})),r=$(s);return r.tip(n),r.addClass(a),r},m=t=>{if(t.own_auction)return"";let e=Engine.auctions.tLang("canNotObserve"),i=Engine.auctions.tLang("observe"),n=t.is_observed?e:i,a=t.is_observed?"observed-auction":"not-observed-auction",s=createSmallButtonWithBackground([a],["green"],()=>{let e=t.id;if(!t.is_observed){let i=Engine.auctions.getAuctionPages().getCurrentPage();return void Engine.auctions.getAuctionRequest().observedRequest(t.is_observed,e,i)}let i=Engine.auctions.tLang("notObserveConfirmation");confirmWithCallback({msg:i,clb:()=>{let i=Engine.auctions.getAuctionPages().getCurrentPage();Engine.auctions.getAuctionRequest().observedRequest(t.is_observed,e,i)}})}),r=$(s);return r.tip(n),r.addClass(a),r};this.init=t=>{l(t.time),r(t.id),o(t),s(!1)},this.updateTime=()=>{if(i--,i<0)return d(),void Engine.auctions.removeFromOfferList(e);c()},this.get$Offer=()=>t,this.removeOffer=d,this.updateOffer=e=>{l(e.time);let i=u(e);t.replaceWith(i),t=i,s(!1)},this.setItemAttachToSlotState=s}},function(t,e,i){let n=i(19),a=i(0);t.exports=function(){let t={},e=0,i={};const s=()=>{let t=n.MY_AUCTION,e=_t("auction_type",null,"auctions"),i=c(t,e),a=i.find(".item-category-wrapper");i.addClass("type-auction-switch");for(let t in n.TYPE_OF_AUCTION){let e=r(t,_t(t+"_auction"));a.append(e)}a.find(".action-menu-item").first().addClass("selected"),u(t,i),Engine.auctions.getAuctionWindow().getContent().find(".all-categories-auction").append(i)},r=(t,e)=>{let i=a.get("action-menu-item");return i.find(".label").html(e),i.on("click",()=>{let e;Engine.auctions.getAuctionWindow().getContent().find(".type-auction-switch").find(".selected").removeClass("selected"),i.addClass("selected"),e=t==n.TYPE_OF_AUCTION.NORMAL?0:1,Engine.auctions.setAuctionMode(e),Engine.auctions.getAuctionRequest().firstPageOfMainAuctionRequest(),Engine.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),Engine.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)}),i},o=t=>{e=t},l=()=>{let t=Engine.auctions.getAuctionWindow().getContent().find(".all-categories-auction");for(let s in n.CATEGORY){let r=n.CATEGORY[s],o=v(s),l=c(s,o),d=l.find(".item-category-wrapper");for(var e in u(s,l),r){var a=r[e];let t=p(l,a);i[a]=t,d.append(t)}t.append(l)}},c=function(t,e){let i=a.get("drop-down-menu-section");return i.find(".type-header-label").html(e),i.find(".type-header").on("click",()=>{d(t),h(t),Engine.auctions.getAuctionWindow().updateScroll()}),i},d=e=>{t[e].state=!t[e].state},h=e=>{let i,n,a=t[e];a.state?(i="block",n="up-arrow"):(i="none",n="down-arrow"),a.$element.find(".state-of-type").removeClass("up-arrow down-arrow").addClass(n),a.$element.find(".content-wrapper").css("display",i)},u=(e,i)=>{t[e]={$element:i,state:!0}};function p(t,e){let i=a.get("one-category-auction");return i.tip(_t("au_cat"+e,null,"auction")),i.find(".icon").addClass("cl-"+e),i.on("click",(function(){let t=m(e);E(1,t)})),i}const g=()=>0!=e,f=()=>{Engine.auctions.getAuctionWindow().getContent().find(".one-category-auction.selected").removeClass("selected")},m=t=>e==t?0:t;const v=t=>_t("tab_"+t,null,"auction"),E=(t,i)=>{f(),o(i),(()=>{if(!g())return;Engine.auctions.getAuctionWindow().getContent().find(".one-category-auction").find(".icon.cl-"+e).parent().addClass("selected")})(),Engine.auctions.getAuctionRequest().mainAuctionRequest(t),Engine.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),Engine.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)};this.init=()=>{s(),l()},this.getShowCategory=()=>e,this.isShowCategoryExist=g,this.clearItemCategory=()=>{o(0),f()}}},function(t,e,i){let n=i(0);t.exports=function(){let t=0;const e=(t,e)=>{Engine.auctions.getAuctionWindow().getContent();i(t),Engine.auctions.getAuctionWindow().updateScroll(),e&&e()},i=e=>{let i=Engine.auctions.getAuctionWindow().getContent(),n=i.find(".card").removeClass("active"),a=i.find(".bottom-bar"),s=i.find(".section").removeClass("visible");n.eq(e).addClass("active"),s.eq(e).addClass("visible"),a.children().css("display","none"),a.children().eq(e).css("display","block"),t=e};this.init=()=>{},this.clickCard=e,this.newCard=(t,i,a)=>{let s=n.get("card");s.find(".label").html(i),t.append(s),s.click((function(){let t=$(this).index();e(t,a)}))}}},function(t,e,i){let n=i(0),a=i(19);const s=i(16);t.exports=function(){const t=(t,e)=>e==a.BIDDER_VALUES.SOMEBODY_BID?Math.ceil(11*t/10):t,e=e=>{let i=e.bid_g,n=e.bid_c,s=e.bidder,r={fullVal:null,strVal:null,tip:null};if(i){let e=t(i,s);r.fullVal=e,r.strVal=round(e,3),r.currency="",s&&(r.lastBid=i)}if(n){let e=t(n,s);r.fullVal=e,r.strVal=e,s&&(r.lastBid=n),r.currency=_t("sl")}return e.own_auction&&(r.ownAuction=!0),e.bidder==a.BIDDER_VALUES.YOU_BID&&(r.ownBid=!0),r},i=t=>{let e=t.bo_g,i=t.bo_c;return e&&i?round(e,3)+" + "+i+_t("sl"):e?round(e,3):i?i+_t("sl"):(errorReport("AuctionManager","getBuyNowText","option not exist",t),null)},r=t=>{let e=t.bidder,i=t.bid_g,n=t.bid_c,s="";return e==a.BIDDER_VALUES.YOU_BID&&(s+="disabled "),i?s+"green":n?s+"violet":(errorReport("AuctionManager","getColorBidButton","option not exist",t),null)},o=t=>{let e=t.bo_g,i=t.bo_c;return e&&i?"violet":e?"green":i?"violet":(errorReport("AuctionManager","getColorBuyNowButton","option not exist",t),null)},l=(t,e)=>{let i,a=n.get("auction-input-cost-ceil"),r=a.find(".auction-cost-btn-wrapper");if(t.ownAuction&&r.css("display","none"),t.ownAuction||t.ownBid?(i=a.find(".own-input-cost"),i.css("display","block"),i.html(t.strVal)):(i=a.find(".input-cost"),i.css("display","table-cell"),i.val(t.strVal)),t.lastBid){let e=$("<div>").addClass("somebody-bid");e.tip(_t("somebody-bid")),a.append(e),i.tip(_t("last_bid")+formNumberToNumbersGroup(t.lastBid))}if(a.find(".auction-cost-currency").html(t.currency),!e)return a;setInputMask(i,s.TYPE.NUMBER_WITH_KMG),i.attr("full-cost",t.fullVal),i.change((function(){i.attr("full-cost",parsePrice($(this).val()))}));let o=u(e.text,e.color,()=>{e.clb&&e.clb(a)});return e.buttonTip&&o.tip(e.buttonTip),a.find(".auction-cost-btn-wrapper").append(o),a},c=(t,e)=>{let i=n.get("auction-cost-ceil");if(i.find(".auction-cost-label").html(t),!e)return i.find(".auction-cost-btn-wrapper").css("display","none"),i;let a=u(e.text,e.color,e.clb);return i.find(".auction-cost-btn-wrapper").append(a),i},d=t=>{let e=null==t.bo_g?0:t.bo_g,i=null==t.bo_c?0:t.bo_c,n=t.id,a=t.item_id,s=((t,e,i,n)=>{let a="";return a=0==t&&e>1?_t("item_confirm_buynow_sl %name% %price%",{"%name%":n,"%price%":formNumberToNumbersGroup(e)},"auction"):t>0&&e>0?_t("item_confirm_buynow_sl_gold %name% %price% %price2%",{"%name%":n,"%price%":formNumberToNumbersGroup(e),"%price2%":formNumberToNumbersGroup(t)},"auction"):_t("item_confirm_buynow %name% %price%",{"%name%":n,"%price%":formNumberToNumbersGroup(t)},"auction"),a})(e,i,0,Engine.auctions.getAuctionItems().getItemName(a));confirmWithCallback({msg:s,clb:()=>{Engine.auctions.getAuctionRequest().buyNowRequest(n)}})},h=(t,e)=>{let i=null==t.bid_g?0:t.bid_g,n=null==t.bid_c?0:t.bid_c,a=t.id,s=t.item_id,r=Engine.auctions.getAuctionItems().getItemName(s),o=parsePrice(e.find(".input-cost").attr("full-cost"));if(checkInputValIsEmptyProcedure(o))return;if(!checkParsePriceValueIsCorrect(o))return;let l=((t,e,i,n)=>{let a=null,s=null;return t&&(a="item_confirm_au",s=t),e&&(a="item_confirm_au_sl",s=e),_t(a+" %name% %val%",{"%name%":n,"%price%":formNumberToNumbersGroup(s)},"auction")})(i?o:null,n?o:null,0,r);confirmWithCallback({msg:l,clb:()=>{Engine.auctions.getAuctionRequest().bidRequest(a,o)}})},u=(t,e,i)=>{var a=n.get("auction-but").addClass("small "+e);return a.find(".label").html(t),a.on("click",i),a};this.init=t=>{},this.getBuyNowCeil=t=>{let e=t.bo_g,n=t.bo_c;if(!e&&!n)return"";let a=i(t);if(t.own_auction)return c(a);let s=o(t);return c(a,{text:_t("au_price_buynow",null,"auction"),clb:()=>{d(t)},color:s})},this.getBidCeil=t=>{let i=t.bid_g,n=t.bid_c;if(!i&&!n)return"";let a=e(t);if(a.ownAuction)return l(a);let s,o=r(t);s=a.ownBid?null:e=>{h(t,e)};let c=a.ownBid?_t("youAreBid"):"";return l(a,{text:_t("bid",null,"auction"),clb:s,color:o,buttonTip:c})}}},function(t,e,i){let n=i(0),a=i(19),s=i(56);const r=i(16),o=i(50),l=i(28),{Rarities:c}=i(298);t.exports=function(){let t=null,e=null,i=null,d=null,h=null;const u=()=>{i.find(".auction-bid").find(".label").html(Engine.auctions.tLang("filter_bid")),i.find(".auction-additional-gold-payment").find(".label").html(Engine.auctions.tLang("auction-additional-gold-payment")),i.find(".auction-buy-now").find(".label").html(Engine.auctions.tLang("auction-buy-now")),i.find(".auction-duration").find(".label").html(Engine.auctions.tLang("auction-duration")),i.find(".auction-tax").find(".tax-label").html(Engine.auctions.tLang("auction-tax")),i.find(".auction-cost").find(".cost-label").html(Engine.auctions.tLang("auction-cost"))},p=()=>{i.find(".buy-info-icon").tip(_t("break_soulbound_info"))},g=()=>{i.find(".auction-bid").append(createNiInput({type:r.TYPE.NUMBER_WITH_KMG})),i.find(".auction-additional-gold-payment").append(createNiInput({type:r.TYPE.NUMBER_WITH_KMG})),i.find(".auction-buy-now").append(createNiInput({type:r.TYPE.NUMBER_WITH_KMG})),i.find(".auction-duration").append(createNiInput({type:r.TYPE.NUMBER}))},f=()=>{createInputPlaceholder("Min. 500",i.find(".auction-buy-now").find("input")),createInputPlaceholder("Min. 500",i.find(".auction-bid").find("input")),createInputPlaceholder("Min. 500",i.find(".auction-additional-gold-payment").find("input")),createInputPlaceholder("2-168",i.find(".auction-duration").find("input"))},m=()=>{i.find(".auction-buy-now").find("input").trigger("change"),i.find(".auction-bid").find("input").trigger("change"),i.find(".auction-additional-gold-payment").find("input").trigger("change"),i.find(".auction-duration").find("input").trigger("change")},v=()=>{let t=createSmallGoldIcon(0),e=createSmallDraconiteIcon(a.COST_FEATURED_AUCTION),n=i.find(".auction-cost").find(".second-span");n.append(t),n.append(e)},E=t=>{let e=Engine.auctions.getFeaturedCount()+(t?1:0);return`${Engine.auctions.tLang("featured_offer")} (${e}/${a.MAX_FEATURED_COUNT})`},_=()=>{let t=E(!1),e=createCheckBox(t,"",()=>{b(),C(!0)});i.find(".special-offer").append(e)},b=()=>{let t=D();w(t)},w=t=>{let e=E(t);i.find(".special-offer").find(".one-checkbox").find(".label").html(e)},C=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=U(),i=e&&d.checkSoulbound(),n=D();if(e){let t=tt(d);et(t),Z(!0)}else Z(!1);if(n){if(i){nt(!0),at(!0),st(!1),Q(!0);let t=d.getUnbindCost()+_t("sl");ot(!0,t)}else nt(!1),at(!1),st(!0),Q(!1),rt();J(!0),lt(!0,336,t)}else{if(i){nt(!0),at(!0),st(!1),Q(!0);let t=d.getUnbindCost()+_t("sl");ot(!0,t)}else nt(!1),at(!1),st(!0),Q(!1),rt();lt(!1,168,t),J(!1)}ht(i),m()},T=()=>{i=n.get("auction-off-item-panel"),h=Engine.windowManager.add({content:i,nameWindow:Engine.windowsData.name.AUCTION_OFF_ITEM_PANEL,title:Engine.auctions.tLang("auction_off_item"),onclose:()=>{x()}}),h.addToAlertLayer(),h.center(),L()},y=()=>{let t=createButton(_t("cancel")+" [Esc]",["small"],()=>{x()});i.find(".auction-off-btn-wrapper").append($(t))},I=()=>{let t=Engine.auctions.tLang("au_create");e=createButton(t+" [↵]",["small","green","alert-accept-hotkey"],()=>{A()});let n=$(e);i.find(".auction-off-btn-wrapper").append(n)},A=()=>{if(!d)return;let t=B();if(null==t)return;const e=new o.default,i=k(d,t);e.addCondition(()=>i,_t("too-low-price-legend-item-confirm",null,"auction"),{isConfirmHotkey:!1}).processConditions(()=>S(d.id,t))},k=(t,e)=>isset(e.buy_out)&&e.buy_out>=500&&e.buy_out<=1e8&&l.isEquipCl(t.cl)&&isset(t._cachedStats.lvl)&&t._cachedStats.lvl>20&&isset(t._cachedStats.rarity)&&t._cachedStats.rarity===c.LEGENDARY,S=(t,e)=>{Engine.auctions.getAuctionRequest().setAuctionOffActionRequest(t,e),x(),P(!1)},O=()=>{$("body").keyup(N)},M=()=>{$("body").unbind("keyup",N)},N=t=>{h.checkWndOnPeak()&&("Enter"==t.key&&A(),"Esc"==t.key&&x())},R=()=>{h.show(),h.center(),h.setWndOnPeak()},x=()=>{W(),L()},L=()=>{h.hide()},D=()=>i.find(".special-offer").find(".checkbox.active").length?1:0,P=t=>{let e=i.find(".special-offer").find(".checkbox.active");t?e.addClass("active"):e.removeClass("active")},B=()=>{let t=i.find(".auction-bid").find("input").val(),e=i.find(".auction-buy-now").find("input").val(),n=i.find(".auction-duration").find("input").val(),a=i.find(".auction-additional-gold-payment").find("input").val(),s=D(),r={};if(d.checkSoulbound()){if(null!==a){let t=parsePrice(removeSpaces(a));if(!checkParsePriceValueIsCorrect(t))return null;r.price=t}s||null===n||(r.time=n)}else{if(""!==t){let e=parsePrice(removeSpaces(t));if(!checkParsePriceValueIsCorrect(e))return null;r.price=e}if(""!==e){let t=parsePrice(removeSpaces(e));if(!checkParsePriceValueIsCorrect(t))return null;r.buy_out=t}s||null===n||(r.time=n)}return r.is_featured=s,r},F=()=>{if(!d)return;let t=d.id;G(t,Engine.itemsViewData.AUCTION_SELL_ITEM_VIEW),j(t),V(null),H()},W=()=>{F(),C()},H=()=>{i.find(".add-item-section").find(".item-slot").find(".item").remove()},G=(t,e)=>{Engine.items.deleteViewIconIfExist(t,e)},V=t=>{d=t},U=()=>!!d,j=t=>{Engine.itemsMovedManager.removeItem(t)},q=t=>{i.find(".item-slot").append(t)},K=t=>Engine.items.createViewIcon(t.id,Engine.itemsViewData.AUCTION_SELL_ITEM_VIEW)[0],Y=t=>{Engine.itemsMovedManager.addItem(t,Engine.itemsMovedData.ITEM_TO_AUCTION,(function(){W()}))},z=t=>t instanceof s,X=t=>{if(!t.checkSoulbound())return!1;let e=t.getUnbindCost();return null==e&&(e=0),e<=0},Q=t=>{dt(i.find(".buy-info-icon"),t)},J=t=>{i.find(".small-currency-icon").find(".small-draconite").parent().css("display",t?"table-cell":"none")},Z=t=>{i.find(".small-currency-icon").find(".small-money").parent().css("display",t?"table-cell":"none")},tt=t=>{let e=t.getLvl();return e||(e=10),10*Math.max(e,10)},et=t=>{i.find(".small-currency-icon").find(".small-money").parent().find(".value").html(t)},it=t=>{let e=t?"initial":"none",n=t?1:.5,a=t?"":_t("special_offer_limit_reach"),s=i.find(".special-offer");s.tip(a),s.find(".one-checkbox").css({"pointer-events":e,opacity:n})},nt=t=>{dt(i.find(".auction-additional-gold-payment"),t)},at=t=>{dt(i.find(".additional-soulbond-payment"),t)},st=t=>{dt(i.find(".auction-bid"),t)},rt=()=>{let t=i.find(".auction-buy-now").find("input").val(),e=t.search(_t("sl"))>-1?"":t;ot(!1,e)},ot=(t,e)=>{ct(i.find(".auction-buy-now").find("input"),t,e)},lt=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=i.find(".auction-duration").find("input");n||(e=""===a.val()?e:a.val()),ct(a,t,e)},ct=(t,e,i)=>{t.prop("disabled",e),t.val(i)},dt=(t,e)=>{t.css("display",e?"block":"none")},ht=t=>{const{creditsRatio:e,goldRatio:n,goldRatioFromSurcharge:a}=ut(),s=t?`${a}% (${_t("gold_plural")})<br>\n           ${e}% (${_t("credits_plural")})`:n+"%";i.find(".tax-val").html(s)},ut=()=>{const{gainedCreditsRatio:t,gainedGoldRatio:e,gainedGoldRatioFromSurcharge:i}=Engine.auctions.getConfig();return{creditsRatio:100-t,goldRatio:100-e,goldRatioFromSurcharge:100-i}},pt=()=>{i.find(".item-slot").on("click",W)};this.close=()=>{W(),M(),h.remove()},this.manageOfShow=()=>{h.isShow()?h.setWndOnPeak():R(),b()},this.getAuctionOffItem=()=>d,this.setAuctionOffItem=V,this.putAuctionOffItem=t=>{if(!z(t))return;if(t.checkPermbound())return;if(X(t))return;F();let e=K(t);V(t),C(),((t,e)=>{t.contextmenu((function(t,i){let n={txt:_t("unbuy all"),f:function(){W()}};e.createOptionMenu(getE(t,i),n,{move:!0,use:!0})}))})(e,t),Y(t),q(e)},this.manageVisibleElements=C,this.manageVisibleSpecialOffer=()=>{let t=Engine.auctions.getFeaturedCount()!=a.MAX_FEATURED_COUNT;it(t)},this.updateCheckbox=b,this.init=e=>{t=Engine.auctions.getAuctionWindow().getContent(),T(),g(),pt(),I(),y(),_(),O(),v(),f(),p(),u()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0),s=i(38);var r;!function(t){t.ID="id",t.NAME="name",t.UNBIND_COST="unbind_price",t.SALVAGE_ITEMS="extract_value",t.ENHANCEMENT_POINTS="enhance_value"}(r||(r={})),t.exports=class{constructor(t){this.creditsIcon="/img/draconite_small.gif",this.itemTypes={common:{extIcon:CFG.a_ipath+"/neu/ese_zwycz.gif",enhIcon:CFG.a_ipath+"/upg/comm_enh_ball.gif"},unique:{extIcon:CFG.a_ipath+"/neu/ese_unikat.gif",enhIcon:CFG.a_ipath+"/upg/uniq_enh_ball.gif"},heroic:{extIcon:CFG.a_ipath+"/neu/ese_hero.gif",enhIcon:CFG.a_ipath+"/upg/hero_enh_ball.gif"},upgraded:{extIcon:CFG.a_ipath+"/neu/ese_ulep.gif",enhIcon:CFG.a_ipath+"/upg/upgr_enh_ball.gif"},legendary:{extIcon:CFG.a_ipath+"/neu/pyl-sakryfikacji.gif",enhIcon:CFG.a_ipath+"/upg/lege_enh_ball.gif"}},this.item=t,this.isItem=t.isItem(),this.itemId=Math.abs(parseInt(t.id)),this.isExist()||(this.getEngine().itemDetailWindows.push(this.itemId),this.setContent(),this.initWindow(),this.show(t),t.on("delete",()=>{this.close()}))}isExist(){return this.getEngine().itemDetailWindows.includes(this.itemId)}setContent(){this.contentEl=a.get("item-details")[0],this.itemSlotEl=this.contentEl.querySelector(".item-details__slot"),this.rowsEl=this.contentEl.querySelector(".item-details__rows")}show(t){let e;e=this.isItem?this.getEngine().items.createViewIcon(t.id,Engine.itemsViewData.ITEM_DETAILS_VIEW)[0]:this.getEngine().tpls.createViewIcon(t.id,Engine.itemsViewData.ITEM_DETAILS_VIEW,t.loc)[0],this.itemSlotEl.appendChild(e[0]),this.createRows(t),this.wnd.center()}createRows(t){const{name:e,itemTypeName:i,hid:n}=t;if(this.rowsEl.appendChild(this.createRow(r.NAME,e,i)),isset(n)&&!s.isPromoItemLoc(t.loc)){const t="ITEM#"+n+"."+this.getEngine().worldConfig.getWorldName();this.rowsEl.appendChild(this.createRow(r.ID,t,i))}isset(t.unbindCost)&&this.rowsEl.appendChild(this.createRow(r.UNBIND_COST,t.unbindCost.toString(),i)),isset(t.salvageItems)&&this.rowsEl.appendChild(this.createRow(r.SALVAGE_ITEMS,t.salvageItems.toString(),i)),isset(t.enhancementPoints)&&this.rowsEl.appendChild(this.createRow(r.ENHANCEMENT_POINTS,t.enhancementPoints.toString(),i))}initWindow(){this.getEngine().windowManager.add({content:this.contentEl,title:this.tLang("details"),nameWindow:this.getEngine().windowsData.name.ITEM_DETAILS,type:this.getEngine().windowsData.type.TRANSPARENT,addClass:"item-details-wnd",objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()}createRow(t,e,i){const s=a.get("item-details-row")[0],o=s.querySelector(".item-details__content"),l=s.querySelector(".item-details__copy-btn");let c,d;switch(t){case r.UNBIND_COST:c=this.creditsIcon,d=this.createSpecificRowContent(e,c,t),o.appendChild(d),l.parentNode.removeChild(l);break;case r.SALVAGE_ITEMS:c=this.itemTypes[i].extIcon,d=this.createSpecificRowContent(e,c,t),o.appendChild(d),l.parentNode.removeChild(l);break;case r.ENHANCEMENT_POINTS:c=this.itemTypes[i].enhIcon,d=this.createSpecificRowContent(e,c,t),o.appendChild(d),l.parentNode.removeChild(l);break;default:const n=createNiInput({readonly:!0})[0];n.querySelector("input").value=e,o.appendChild(n)}return $(l).tip(this.tLang("copy")),l.addEventListener("click",()=>{(0,n.copyToClipboard)(e)}),s}createSpecificRowContent(t,e,i){const n=a.get("item-details-special-row")[0],s=n.querySelector(".item-details__txt"),r=n.querySelector(".item-details__val"),o=n.querySelector(".item-details__ico");return s.innerHTML=this.tLang(i),r.innerHTML=t,o.style.backgroundImage=`url('${e}')`,n}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"item_id"):""}close(){this.getEngine().itemDetailWindows=this.getEngine().itemDetailWindows.filter(t=>t!==this.itemId),this.wnd.hide(),this.isItem?this.getEngine().items.deleteViewIconIfExist(this.itemId,Engine.itemsViewData.ITEM_DETAILS_VIEW):this.getEngine().tpls.deleteViewIconIfExist(this.itemId,Engine.itemsViewData.ITEM_DETAILS_VIEW)}}},function(t,e,i){var n=i(0);let a=i(29),s=i(67);t.exports=function(){let t=null,e=new s;this.init=()=>{this.initWnd(),this.wnd.center()},this.setPreviewId=e=>{t=e},this.initWnd=()=>{Engine.windowManager.add({content:n.get("show-miniature"),nameWindow:Engine.windowsData.name.SHOW_MINIATURE,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,addClass:"show-miniature-window",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.setWndOnPeak()},this.onUpdate=(t,i)=>{let n,s,r;switch(i){case a.drawSystem.PLAYER_OUTFIT:s=t._cachedStats.outfit.split(","),n=t.name,r=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:a.drawSystem.PLAYER_OUTFIT,path:s[1]}),this.wnd.$.find(".info-icon").tip(_t("action_info_outfit"));break;case a.drawSystem.PET:s=t._cachedStats.pet.split(","),n=s[0];let o=s[1],l=e.checkActionsAmount(o)?s[s.length-1]:"";r=Engine.canvasCharacterWrapperManager.addCharacter({drawSystem:a.drawSystem.PET,path:o,actions:l}),this.wnd.$.find(".info-icon").tip(_t("action_info",null,"pet"));break;default:errorReport("ShowMiniature.js","onUpdate","Bad kind of miniature!"+i)}let o=r.getId(),l=$(r.getCanvas());this.setPreviewId(o),this.wnd.$.find(".canvas-wrapper").append(l),this.wnd.title(n)},this.close=()=>{this.wnd.remove(),null!=t&&Engine.canvasCharacterWrapperManager.removeCharacter(t),Engine.showMiniature=!1}}},function(t,e){t.exports=function(){let t,e,i=!1,n=null,a={heal:{x:442,y:258,width:12,height:14},lootBox:{x:458,y:258,width:12,height:14},noBonus:{x:458,y:260,width:12,height:14},expired:{x:492,y:260,width:12,height:14},higherScore:{x:474,y:258,width:12,height:14},enhanceBonus1:{x:631,y:258,width:28,height:8},enhanceBonus2:{x:568,y:258,width:28,height:8},enhanceBonus3:{x:697,y:258,width:28,height:8},enhanceBonus4:{x:729,y:258,width:28,height:8}};const s=t=>{e=t},r=t=>{n=t},o=()=>{Engine.imgLoader.onload("../img/gui/buttony.png",!1,e=>{t=e},t=>{i=!0,l()})},l=()=>{let t=e.getView();for(let i in t){let n=t[i][4];n=e.isItem()?t[i][4]:t[i][5],c(n)}},c=(e,s,r)=>{if(!i)return;let o=a[n].x,l=a[n].y,c=a[n].width,d=a[n].height;e.drawImage(t,o,l,c,d,32-c,Engine.items.getNoticeTop(),c,d)};this.draw=c,this.init=(t,e)=>{r(t),s(e),o()}}},function(t,e,i){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.itemRarity=e.Rarities=void 0,function(t){t.COMMON="common",t.UNIQUE="unique",t.HEROIC="heroic",t.UPGRADED="upgraded",t.LEGENDARY="legendary",t.ARTEFACT="artefact"}(n=e.Rarities||(e.Rarities={})),e.itemRarity={[n.COMMON]:{name:_t("rarity_common",null,"item"),namePlural:_t("rarity_plural_common",null,"item"),color:"#9da1a7",sort:1},[n.UNIQUE]:{name:_t("rarity_unique",null,"item"),namePlural:_t("rarity_plural_unique",null,"item"),color:"#fffb00",sort:2},[n.HEROIC]:{name:_t("rarity_heroic",null,"item"),namePlural:_t("rarity_plural_heroic",null,"item"),color:"#38b8eb",sort:3},[n.UPGRADED]:{name:_t("rarity_upgraded",null,"item"),namePlural:_t("rarity_plural_upgraded",null,"item"),color:"#ff59af",sort:4},[n.LEGENDARY]:{name:_t("rarity_legendary",null,"item"),namePlural:_t("rarity_plural_legendary",null,"item"),color:"#ff8400",sort:5},[n.ARTEFACT]:{name:_t("rarity_artefact",null,"item"),namePlural:_t("rarity_plural_artefact",null,"item"),color:"#e84646",sort:6}}},function(t,e,i){let n=i(19);t.exports=function(){let t={};const e=()=>{Engine.items.fetch(Engine.itemsFetchData.NEW_AUCTION_ITEM,s)},i=()=>{Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.AUCTION)},a=e=>!!t[e],s=e=>{let i=e.id;t[i]=e,a(i)&&r(i)},r=e=>{let i=t[e],n=Engine.auctions.getOneOfferByItemId(e);if(null==n)return;let a=n.get$Offer();o(i,e,a),n.setItemAttachToSlotState(!0)},o=(t,e,i)=>{let a=Engine.items.createViewIcon(e,Engine.itemsViewData.AUCTION_ITEM_VIEW)[0];l(a,t),i.find("."+n.AUCTION_CEIL.ITEM_NAME_TD.key).html(t.name),i.find("."+n.AUCTION_CEIL.ITEM_LEVEL_TD.key).html(t.getLvl()),i.find("."+n.AUCTION_CEIL.ITEM_SLOT_TD.key).find(".item-slot").append(a)},l=(t,e)=>{t.contextmenu((function(t,i){e.createOptionMenu(getE(t,i),!1)}))};this.init=()=>{e(),i()},this.checkItemExistInAllFetchItems=a,this.getItemName=e=>t[e]?t[e].name:(errorReport("AuctionManager","getItemName","Item not exist: "+e,t),""),this.attachIconToSlotProcedure=r}},function(t,e,i){var n=i(0);t.exports=function(){var t;let e=0;this.tpls=[],this.content=[],this.reagents=[],this.recipePreview=!1,this.init=function(){this.initWindow(),this.initFetch(),this.initScrollBar()},this.initScrollBar=()=>{this.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})},this.initFetch=()=>{Engine.tpls.fetch(Engine.itemsFetchData.NEW_TPL_PREVIEW,this.newTplPreview),Engine.tpls.fetch(Engine.itemsFetchData.NEW_OPEN_TPL,this.newOpenItem)},this.newOpenItem=(t,i)=>{let n=(t.isItem()?Engine.items:Engine.tpls).createViewIcon(t.id,Engine.itemsViewData.OPEN_PREVIEW_ITEM_VIEW,"s")[0];Engine.lootPreview.wnd.$.find(".item-container").append(n),n.css("cursor",`url(../img/gui/cursor/5n.png?v=${__build.version}), auto`),n.contextmenu((function(e,i){t.createOptionMenu(getE(e,i))})),this.wnd.title(t.name),i&&(e++,2===e&&this.afterFetch())},this.afterFetch=()=>{e=0,this.tpls=this.prepareTplsArray(),this.tpls.map(t=>{const e=this.getType(t.id),i=t.id===this.tplId;this.createPreviewItem({item:t,type:e,selfItemAsContent:i})})},this.newTplPreview=(t,i)=>{i&&(this.recipePreview||this.wnd.$.find(".scroll-pane").empty(),e++,2===e&&this.afterFetch())},this.prepareTplsArray=()=>{const t=[...this.content,...this.reagents];return this.sortTpls(t.map(t=>{let{id:e,amount:i}=t;const n=e===this.tplId?"s":"p";return{...Engine.tpls.getTplByIdAndLoc(e,n),amount:i}}))},this.getType=t=>this.content.find(e=>e.id===t)?"content":"reagents",this.sortTpls=t=>Object.values(t).sort((t,e)=>e.itemTypeSort-t.itemTypeSort||e.pr-t.pr||t.name.localeCompare(e.name)),this.createPreviewItem=e=>{let{item:i,type:a,selfItemAsContent:s=!1}=e;const r=n.get("loot-preview-one-item"),o=s?"s":"p",l=(i.isItem()?Engine.items:Engine.tpls).createViewIcon(i.id,Engine.itemsViewData.PREVIEW_ITEM_VIEW,o)[0];let c=this.recipePreview?`.${a}-list`:"";r.find(".item-wrapper").append(l),r.find(".name-wrapper").append(i.name),r.find(".amount-wrapper").append("x"+i.amount),Engine.lootPreview.wnd.$.find(".scroll-pane "+c).append(r),Engine.lootPreview.wnd.$.removeClass("v-hidden"),$(".scroll-wrapper",t).trigger("update"),Engine.lootPreview.wnd.center(),this.addContextMenu(i,l)},this.addContextMenu=(t,e)=>{e.css("cursor",`url(../img/gui/cursor/5n.png?v=${__build.version}), auto`),e.contextmenu((function(e,i){t.createOptionMenu(getE(e,i))}))},this.update=function(t){let e="";this.tplId=t.tpl_id,this.recipePreview=isset(t.reagents),this.reagents=[],this.content=t.content,this.wnd.$.find(".scroll-pane").empty(),this.wnd.$.find(".item-container").empty(),this.recipePreview?(this.setRecipePreview(t),e=_t("desc",null,"recipe_preview")):e="lootbox"===t.type?_t("will_get"):_t("shuffle"),this.wnd.$.find(".items-txt").html(e)},this.setRecipePreview=t=>{this.reagents=t.reagents;let e=n.get("recipe-preview-content");this.wnd.$.find(".scroll-pane").html(e),this.wnd.$.find(".content-txt").text(_t("result",null,"recipe_preview")),this.wnd.$.find(".reagents-txt").text(_t("reagents",null,"recipe_preview"))},this.initWindow=function(){t=n.get("loot-preview"),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.LOOT_PREVIEW,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,title:_t("items_list"),addClass:"fixed-wnd v-hidden",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()},this.close=()=>{Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_TPL_PREVIEW),Engine.tpls.deleteMessItemsByLoc("p"),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_OPEN_TPL),Engine.tpls.deleteMessItemsByLoc("s"),this.wnd.remove(),Engine.lootPreview=!1}}},function(t,e,i){let n=i(0);t.exports=function(){var t,e,i,a,s=this,r={},o=0;this.leftPromo=0,this.leftNews=0,this.$pagination=null,this.newsLength=null,this.wnd=null,this.init=function(){this.initWindow(),this.getNews(),this.initFetch(),this.initArrows(),l()};const l=()=>{Engine.widgetManager.updateOneWidgetNoticeProcedure(Engine.widgetsData.name.NEWS,Engine.widgetsData.type.VIOLET)};this.connectEvents=()=>{$(document).on("click",".news-section .news-pagination-item",this.paginationOnClick.bind(this)),t.find(".left-news-btn").on("click",this.newsPrev.bind(this)),t.find(".right-news-btn").on("click",this.newsNext.bind(this))},this.initArrows=function(){t.find(".left-arrow").click((function(){s.updatePosition(!0,".for-you",134,"Promo")})),t.find(".right-arrow").click((function(){s.updatePosition(!1,".for-you",134,"Promo")}))},this.initPagination=()=>{this.$pagination=t.find(".news-pagination");for(let t=0;t<s.newsLength;t++){let e=$('<div class="news-pagination-item" />');0===t&&e.addClass("active"),this.$pagination.append(e)}},this.paginationOnClick=t=>{let e=$(t.currentTarget).index();this.goTo(e)},this.paginationUpdate=t=>{this.$pagination.find(`.news-pagination-item:eq(${t})`).addClass("active").siblings(".news-pagination-item").removeClass("active")},this.goTo=e=>{let i=t.find(".news-section-overflow"),n=-402*e;s.paginationUpdate(e),o=e,i.css("left",n),s.setIntervalNews()},this.setIntervalNews=()=>{a&&clearInterval(a);let t=s.newsLength;t<=1||(a=setInterval((function(){let e=++o>=t?0:o;s.goTo(e)}),5e3))},this.newsNext=()=>{let t=++o>=s.newsLength?0:o;s.goTo(t)},this.newsPrev=()=>{let t=--o<0?s.newsLength-1:o;s.goTo(t)},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_PACK_TPL,s.newPackItem)},this.newPackItem=function(t){Engine.news.wnd.$.find(".offer-"+t.id).each((function(){var e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.NEWS_VIEW,"o")[0],i=$(this).attr("data-amount");Engine.tpls.changeItemAmount(t,e,i),$(this).append(e),e.attr("data-tip-type",t.$.data("tipType")),e.attr("data-item-type",t.$.data("itemType")),e.data("item",t),e.contextmenu((function(e,i){t.createOptionMenu(getE(e,i),!1)}))}))},this.createNewsText=function(t){var e=s.wnd.$.find(".news-section-overflow").html(parseNewsBB(t.replace(/\\/gi,"")));s.newsLength=e.find("a").children().length,s.wnd.$.find(".news-section-overflow").css("width",402*s.newsLength),s.wnd.$.find(".news-graph-arrow").css("display",s.newsLength>1?"block":"none"),s.connectEvents(),s.setIntervalNews(),s.initPagination()},this.initWindow=function(){t=n.get("news-panel"),Engine.windowManager.add({content:t,title:_t("news",null,"news"),nameWindow:Engine.windowsData.name.NEWS,widget:Engine.widgetsData.name.NEWS,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.center(),this.wnd.show()},this.getNews=function(){$.ajax({url:"https://forum.margonem.pl/ajax/premiumnews.php",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(t){var e=JSON.parse(t);s.createNewsText(e)},error:function(t){console.log("error",t)}})},this.updateChanged=function(t){for(var e in t)t[e].is_used&&this.setTileUsed(t[e].id)},this.setTileUsed=function(t){s.wnd.$.find(".promo-tile-id-"+t).addClass("is-used")},this.update=function(e){var n=t.find(".news-for-you-section").find(".for-you"),a=e.active;this.updateGlobalBackground(e.background),i=!0;var s=(o=this.getContLocalAndGlobalPromo(a)).global>2?"small":"big",r=134*o.local;this.showOrHideArrows(o.local);for(var o=1,l=0;l<a.length;l++){var c=a[l];1==c.is_personal?this.createClassicTile(c):(this.createTimePromoTile(c,s,o),o++)}n.css("left",0),n.css("width",r+"px")},this.showOrHideArrows=function(t){var e=t>3?"block":"none";s.wnd.$.find(".news-arrow").css("display",e)},this.getContLocalAndGlobalPromo=function(t){for(var e=0,i=0,n=0;n<t.length;n++)1==t[n].is_personal?e++:i++;return{local:e,global:i}},this.updateGlobalBackground=function(t){if(isset(t)){var i="url("+window.cdnUrl+"/obrazki/promocje/"+t+")";e=i,s.wnd.$.find(".time-promo-background").css("background",i)}else console.error("[News.js, updateGlobalBackground] News: no promo background from engine")},this.createClassicTile=function(e){var i=e.id,a="url("+window.cdnUrl+"/obrazki/promocje/"+e.image+")",r=n.get("news-classic-tile").addClass("promo-tile-id-"+i),o=isset(e.lvl_max)&&isset(e.seconds_left),l=isset(e.price)?e.price:0;r.find(".tile-background").css("background",a),r.find(".title-bck").css("background",a+"0 -167px"),r.find(".graphic-bck").css("background",a+"0 -209px"),r.find(".buy-info").html(l+_t("sl",null,"clan")),e.lvl_max&&r.find(".requires-level").html("Max Lvl: "+e.lvl_max+(o?" | ":""));var c=n.get("button").addClass("small purple");c.find(".label").html(_t("buy_promo")),r.find(".buy-button-wrapper").append(c),c.click((function(){s.usePromoId(e.id)})),this.createSlotsOnItems(r,e.offer),this.setInterval(i,e.seconds_left,r,o),t.find(".news-for-you-section").find(".for-you").append(r),e.is_used&&this.setTileUsed(i)},this.createTimePromoTile=function(t,a,r){var o=t.id,l=n.get("news-time-promo-tile").addClass(a).addClass("promo-tile-id-"+o),c=e,d="big"==a?"0px -381px":"-85px -381px",h="big"==a?["-85px -493px","-85px -530px"]:["-85px -567px","-85px -596px"],u=isset(t.price)?t.price:0;l.find(".tile-background").css("background",c),l.find(".tile-background").css("background-position",d),l.find(".title-time-promo-tile").html("Pakiet "+r),l.find(".price-time-promo-tile").html(u+" "+_t("sl",null,"clan"));var p=n.get("buy-button-news").css({background:c,"background-position":h[0]});if(p.hover((function(){p.css("background-position",h[1])}),(function(){p.css("background-position",h[0])})),p.append(n.get("label-news").html(_t("buy_promo"))),l.find(".buy-button-wrapper").append(p),p.click((function(){s.usePromoId(o)})),this.createSlotsOnItems(l,t.offer,[c,"-147px -381px"]),s.wnd.$.find(".package-wrapper").append(l),t.is_used&&this.setTileUsed(o),i){i=!1;var g=s.wnd.$.find(".news-time-promo-section");this.setInterval(o,t.seconds_left,g)}},this.usePromoId=function(t){_g("promotions&a=use&id="+t)},this.updatePosition=function(e,i,n,a){var r,o=t.find(i),l=parseInt(o.css("width")),c=parseInt(o.parent().width()),d=!1,h="left"+a;return e?s[h]+=n:s[h]-=n,s[h]>0&&(s[h]=0),Math.abs(s[h])>l-c&&(s[h]=-(l-c),d=!0),r=Math.abs(s[h]/c),s.paginationUpdate(r),o.css("left",s[h]),d},this.setInterval=function(t,e,i,n){r[t]&&this.clearInterval(t);var a=e;isset(e)&&(i.find(".requires-text").html(getSecondLeft(a,{short:n})),0!=a&&(r[t]=setInterval((function(){0==a&&s.clearInterval(t),i.find(".requires-text").html(getSecondLeft(a--,{short:n}))}),1e3)))},this.clearInterval=function(t){clearInterval(r[t]),r[t]=null,delete r[t]},this.createSlotsOnItems=function(t,e,i){for(var a=0;a<e.length;a++){var s=e[a],r=s[0],o=s[1],l=n.get("item-slot").addClass("offer-"+r);i&&l.css({background:i[0],"background-position":i[1]}),l.attr("data-amount",o),t.find(".tile-items-wrapper").append(l)}},this.close=function(){for(var t in r)this.clearInterval(t);r={},a&&(clearInterval(a),a=null),s.wnd.remove(),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_PACK_TPL),Engine.tpls.deleteMessItemsByLoc("o"),Engine.news=!1}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e=this,i=null,a=null,s=null,r=null,o=!1;this.rewardDays=null,this.rewardItems={},this.init=function(){this.initWindow(),this.setActualTs(),this.initHeaderDays(),this.initPrevNextMonth(),this.initFetch(),this.setPrevActualNextMonthAndYear(),l()};const l=()=>{Engine.widgetManager.updateOneWidgetNoticeProcedure(Engine.widgetsData.name.REWARDS_CALENDAR,Engine.widgetsData.type.VIOLET)};this.setActualTs=function(){i=e.getTodayWithoutMinutes(Engine.getWorldTime()),a=i,a=e.getFirstDayOfMonthTs(a),s=getStartMonth(a),r=getStartYear(a)},this.initPrevNextMonth=function(){e.wnd.$.find(".prev-month, .click-prev").click((function(){var t=s-1;t<0?(r--,s=11):s=t,e.updateMonthAndDaysAfterChangeMonth()})),e.wnd.$.find(".next-month, .click-next").click((function(){var t=s+1;t>11?(r++,s=0):s=t,e.updateMonthAndDaysAfterChangeMonth()}))},this.updateMonthAndDaysAfterChangeMonth=function(){var t=new Date(r,s);a=t.getTime()/1e3,e.setPrevActualNextMonthAndYear(),e.setOneMonthDays(),e.updateBackground()},this.initHeaderDays=function(){for(var t=e.wnd.$.find(".calendar-days-header"),i=0;i<7;i++){var a=n.get("day-header").html(_t("days"+i)).addClass("day-"+i);t.append(a)}},this.setPrevActualNextMonthAndYear=function(){var t=getStartMonth(a),i=t-1<0?11:t-1,n=t+1>11?0:t+1;e.wnd.$.find(".prev-month").html(_t("month"+i)),e.wnd.$.find(".actual-month").html(_t("month"+t)),e.wnd.$.find(".next-month").html(_t("month"+n)),e.wnd.$.find(".calendar-year").html(getStartYear(a))},this.setOneMonthDays=function(){e.wnd.$.find(".calendar-days-content").empty(),o=!1;for(var t=e.getFirstDayOfMonthTs(a),i=getStartWeekDay(t),n=t;1!=i;){n=e.getPreviousDayTs(n);var s=getStartDay(n),r=e.checkIfThisDayEventExist(n);e.createDay(n,r,s,"not",!0),i=getStartWeekDay(n)}for(var l=t,c=t;getStartDay(c)<=getStartDay(l);){c=l,l=e.getNextDayTs(c);r=e.checkIfThisDayEventExist(c),s=getStartDay(c);e.createDay(c,r,s,"current")}for(;1!=getStartWeekDay(l);){c=l,l=e.getNextDayTs(c);s=getStartDay(c),r=e.checkIfThisDayEventExist(c);e.createDay(c,r,s,"not")}},this.getTodayWithoutMinutes=function(t){var e=getStartDay(t),i=getStartMonth(t),n=getStartYear(t);return new Date(n,i,e).getTime()/1e3},this.getPreviousDayTs=function(t){var e=t-43200,i=getStartDay(e),n=getStartMonth(e),a=getStartYear(e);return new Date(a,n,i).getTime()/1e3},this.getNextDayTs=function(t){var e=t+129600,i=getStartDay(e),n=getStartMonth(e),a=getStartYear(e);return new Date(a,n,i).getTime()/1e3},this.getFirstDayOfMonthTs=function(t){return new Date(getStartYear(t),getStartMonth(t)).getTime()/1e3},this.createDay=function(t,a,s,r,l){var c=n.get("day-wrapper-reward-calendar"),d=c.find(".day").addClass(r);if(c.find(".day-nr").html(s),a){o=!0,c.find(".event-name").html(parseBasicBB(a)).css("display","block");var h=e.getRewardDataByTs(t),u=c.find(".reward").css("display","block"),p=c.find(".item-wrapper");if(isset(h)){const{tplId:i,quantity:n,isOpened:a}=h;a?u.addClass("is-open"):(u.addClass("can-open"),p.addClass("lock"),u.on("click",(function(){_g("rewards_calendar&action=open&day_no="+(parseInt(e.getDayIndex(t))+1))}))),i&&(u.addClass("visible-item"),u.addClass("reward-tpl-"+i),u.attr("data-amount",n),e.addItem(i,u))}}if(t==i&&d.addClass("today"),l?e.wnd.$.find(".calendar-days-content").prepend(c):e.wnd.$.find(".calendar-days-content").append(c),a){var g=c.find(".event-name");setTipWhenNameToLong(g,a)}},this.getRewardDataByTs=function(t){var i=e.getDayIndex(t);return this.data.days[i]},this.getDayIndex=function(t){return this.rewardDays[t]},this.initWindow=function(){var i=_t("event_calendar",null,"event_calendar");t=n.get("rewards-calendar"),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.REWARDS_CALENDAR,widget:Engine.widgetsData.name.REWARDS_CALENDAR,nameRefInParent:"wnd",objParent:this,title:i,onclose:()=>{e.close()}}),this.wnd.addToAlertLayer(),this.wnd.center(),this.wnd.show()},this.initScroll=function(){$(".scroll-wrapper",t).addScrollBar({track:!0})},this.updateScroll=function(){$(".scroll-wrapper",t).trigger("update")},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_REWARD_CALENDAR_TPL,e.newRewardCalendarItem)},this.newRewardCalendarItem=function(t){e.rewardItems[t.id]=t,e.addItem(t.id)},this.addItem=function(t,i){var n=e.rewardItems[t];if(n){var a=i||e.wnd.$.find(".reward-tpl-"+t);a.length<1||a.each((function(){var e=$(this).attr("data-amount"),i=Engine.tpls.createViewIcon(t,Engine.itemsViewData.REWARD_CALENDAR_ITEM_VIEW,"v")[0];Engine.tpls.changeItemAmount(n,i,e),i.attr("data-tip-type",n.$.data("tipType")),i.attr("data-item-type",n.$.data("itemType")),$(this).find(".item-wrapper").empty().append(i)}))}},this.update=function(t){this.updateData(t),this.updateDaysTs(),this.setOneMonthDays(),this.updateBackground()},this.updateBackground=function(){var t=o?window.cdnUrl+"/obrazki/calendar"+e.data.background_img.substr(1):"/img/gui/calendar-background.png",i=o?window.cdnUrl+"/obrazki/calendar"+e.data.day_img.substr(1):"/img/gui/calendar-windows-1.png";e.wnd.$.find(".calendar-background").css("background-image","url("+t+")"),e.wnd.$.find(".day:not(.today), .day:not(.today)>.event-name,.day:not(.today)>.reward.is-open,.day:not(.today)>.reward.can-open").css("background-image","url("+i+")")},this.updateDaysTs=function(){this.rewardDays={};for(var t=Object.keys(this.data.days).length,i=this.data.start_ts,n=0;n<t;n++)this.rewardDays[i]=n,i=e.getNextDayTs(i)},this.checkIfThisDayEventExist=function(t){return!!(e.data.start_ts<=t&&t<e.data.end_ts&&e.getRewardDataByTs(t))&&e.data.name},this.updateData=function(t){this.data={},this.data=t,this.data.start_ts=e.getTodayWithoutMinutes(this.data.start_ts)},this.getData=function(){return{start_ts:e.getTodayWithoutMinutes(1536656299),end_ts:1541116800,name_event:"advent",background_img:"advent-background.png",day_img:"advent-windows.png",max_closed:1,extra_opening:{price:13,max:2,cur:0},days:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1]]}},this.close=function(){e.wnd.remove(),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_REWARD_CALENDAR_TPL),Engine.tpls.deleteMessItemsByLoc("v"),Engine.rewardsCalendar=!1}}},function(t,e,i){var n=i(0);let a=i(14);var s=i(12),r=i(8);const{enhancedItemConfirmIfNeeded:o}=i(2);t.exports=function(){let t;this.items={},this.barterId=null,this.barterName=null,this.desireItemId=null,this.lastCreatedId=null,this.showAffectedOfferId=null,this.barterOffersData=null,this.barterOwnedData=null,this.barterAvailableData=null,this.barterUsagesData=null,this.availableOffersAmount=null,this.allParseOffers=null,this.allCategories=null,this.selectedItems=null,this.haveReagentsList=null,this.needReagentsList=null,this.init=function(){this.closeOtherWindows(),this.initWindow(),this.initLabels(),this.initFetch(),this.blockMove(),this.initSelect(),this.initSearch(),this.initStartLvl(),this.initStopLvl(),this.initScrollsBar()},this.initStartLvl=function(){const e=t.find(".start-lvl-wrapper"),i=createNiInput({cl:"start-lvl",placeholder:_t("start"),changeClb:()=>this.startFilter(),clearClb:()=>this.startFilter(),type:"number"});e.html(i)},this.initStopLvl=function(){const e=t.find(".stop-lvl-wrapper"),i=createNiInput({cl:"stop-lvl",placeholder:_t("stop"),changeClb:()=>this.startFilter(),clearClb:()=>this.startFilter(),type:"number"});e.html(i)},this.initLabels=()=>{this.wnd.$.find(".left-column-list-label").html(_t("exchange_list",null,"item_changer")),this.wnd.$.find(".reagents-label").html(_t("reagents_label"))},this.initScrollsBar=function(){$(".left-scroll",t).addScrollBar({track:!0}),$(".right-scroll",t).addScrollBar({track:!0})},this.updateScroll=function(){$(".left-scroll",t).trigger("update"),$(".right-scroll",t).trigger("update")},this.initWindow=function(){t=n.get("left-grouped-list-and-right-description-window"),t.addClass("barter-content"),Engine.windowManager.add({content:t,title:"Barter",nameWindow:Engine.windowsData.name.BARTER,objParent:this,nameRefInParent:"wnd",addClass:"barter-window",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.center()},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_BARTER_TPL,this.createBarterItem)},this.addToCategories=(t,e)=>{let i=e.cl,n=e.id,a=e.name;this.items[n]=e,this.allCategories.hasOwnProperty(i)||(this.allCategories[i]=[]),t.category=i,t.resultItemName=a,this.allCategories[i].push(t)},this.updateItem=t=>{let e=t.id;for(let i=0;i<this.allParseOffers.length;i++){let n=this.allParseOffers[i];for(let t=0;t<n.required.length;t++);for(let i=0;i<n.recived.length;i++){n.recived[i][0]==e&&this.addToCategories(n,t)}}},this.createBarterItem=(t,e)=>{this.items[t.id]=t,this.updateItem(t),e&&(this.buildRecipeList(),null!=this.showAffectedOfferId&&this.showAgainClickOffer(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,34),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,34),this.wnd.updateWindowTrigger())},this.createAllCategoriesDisableAndEnable=()=>{let t={};for(let e in this.allCategories){t[e]={enable:[],disable:[]};let i=this.allCategories[e];for(let n=0;n<i.length;n++){let a=i[n];a.maxAmount?t[e].enable.push(a):t[e].disable.push(a)}}for(let e in t)t[e].disable.sort(this.compare),t[e].enable.sort(this.compare);return t},this.buildRecipeList=()=>{let t=this.createAllCategoriesDisableAndEnable();this.cleanList(),this.drawAllRecipesOnList(t),this.countRecipesPerGroup(),this.updateScroll()},this.drawAllRecipesOnList=t=>{for(let e in t){let i=t[e];for(let t=0;t<i.enable.length;t++){let e=i.enable[t],n=this.createOneOfferOnList(e);this.createGroupElement(e,n)}for(let t=0;t<i.disable.length;t++){let e=i.disable[t],n=this.createOneOfferOnList(e);this.createGroupElement(e,n)}}},this.compare=(t,e)=>{const i=t.resultItemName.toUpperCase(),n=e.resultItemName.toUpperCase();let a=0;return i>n?a=1:i<n&&(a=-1),a},this.createOneOfferOnList=t=>{let e=t.maxAmount,i=t.recived[0][0],a=this.items[i],s=n.get("one-item-on-divide-list").addClass("crafting-recipe-in-list "+(e?"enabled":"disabled")),r=e>0?" ("+e+")":"";return s.addClass("offer-id-"+t.id),s.addClass("affectedId-id-"+t.affectedId),s.find(".name").html(t.resultItemName+r),this.createAttrToCraftingRecipe(s,a),this.recipeClick(s,t),s},this.createAttrToCraftingRecipe=(t,e)=>{let i="all",n="all",a=["unique","heroic","legendary"],s=Engine.items.parseItemStat(e.stat);isset(s.lvl)&&t.attr("lvl",s.lvl),isset(s.reqp)&&(i=s.reqp);for(var r=0;r<a.length;r++)e.itemTypeName===a[r]&&(n=a[r]);t.attr("typeItem",n),t.attr("reqp",i)},this.recipeClick=function(t,i){t.click(t=>{t.stopPropagation(),this.showAffectedOfferId=i.affectedId,this.createOffer(i),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,34),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,34),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,27),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,27),e(i.id)})};const e=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(r.ON_FINISH_REQUIRE.CLICK_BARTER_OFFER_ON_LIST,r.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)};this.deleteOldViews=()=>{},this.createOffer=t=>{Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.BARTER);var e=n.get("crafting-description-header"),i=n.get("crafting-description-reagents"),a=n.get("button");let s=t.recived[0][0],r=t.recived[0][1],o=this.items[s];this.desireItemId=s;let l=this.createViewItem(o);var c=e.find(".result-item");Engine.tpls.changeItemAmount(o,l,r),l.attr("data-tip-type",o.$.data("tipType")),l.attr("data-item-type",o.$.data("itemType")),l.data("item",o),c.append(l),this.rightClickItem(l,o,!1);let d=this.createLimitCell(t);d="-"!=d?'<br><span class="limit-cell">'+_t("limit",null,"item_changer")+d+"</span>":"";let h=o.getItemType();e.find(".offer-name").addClass(h).html(o.name+d),Engine.itemsMovedManager.removeItemsByTarget(Engine.itemsMovedData.BARTER_ITEM_REAGENT);const u=this.sortReagents(t.required);this.createReagents(i,u),this.createCost(i,t),this.useRecipeBtn(a,t);let p=this.wnd.$;p.find(".right-column-header").html(e),p.find(".all-items-wrapper").html(i),p.find(".right-column").find(".crafting-cost-panel").remove(),p.find(".bottom-row-panel").find(".do-recipe").find(".button").remove(),p.find(".bottom-row-panel").find(".do-recipe").append(a),this.markChooseOffer(),this.updateScroll(),this.manageEnableClassOfButton()},this.sortReagents=t=>t.sort((t,e)=>{let[i]=t,[n]=e;return i=this.items[i],n=this.items[n],n.itemTypeSort-i.itemTypeSort||n.pr-i.pr||i.name.localeCompare(n.name)}),this.markChooseOffer=()=>{let t="mark-offer";this.wnd.$.find("."+t).removeClass(t),this.wnd.$.find(".affectedId-id-"+this.showAffectedOfferId).addClass(t)},this.rightClickItem=(t,e,i)=>{t.off("contextmenu"),t.on("contextmenu",(function(t,n){e.createOptionMenu(getE(t,n),!1,i)}))},this.useRecipeBtn=function(t,e){var i=_t("use_it",null,"item");t.addClass("small"),t.find(".label").html(i),t.on("click",()=>{t.hasClass("black")||(this.askAlert(e),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,27),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,27),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,28),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,28))})},this.createLimitCell=(t,e)=>{if(!t.limit)return"-";let i=this.findUsagesById(t.id),n=i||0,a=e?"<br>":" ";return this.returnLimitStr(n,t,a)},this.returnLimitStr=(t,e,i)=>{switch(e.limit.period){case 0:return"-";case 1:return t+"/"+e.limit.max+i+this.tLang("on_day");case 2:return t+"/"+e.limit.max+i+this.tLang("on_week");case 3:return t+"/"+e.limit.max+i+this.tLang("on_month");default:return console.error("[Barter.js, returnLimitStr] BAD LIMIT PERIOD",e.limit.period),""}},this.findUsagesById=t=>{for(let e=0;e<this.barterUsagesData.length;e++){let i=this.barterUsagesData[e];if(i[0]==t)return i[1]}return null},this.getAmountAvailable=function(t,e){for(let i=0;i<this.barterAvailableData.length;i++){let n=this.barterAvailableData[i];if(n.offerId==t){if(!n.hasOwnProperty("tplId"))return n.count;if(n.tplId==e)return n.count}}return 0},this.askAlert=t=>{var e=t.id,i=t.limit?_t("limit",null,"item_changer")+"<b>"+this.createLimitCell(t)+"</b><br>":"",n={q:_t("accept_barter_offer")+"<br>"+i,clb:()=>this.preBarter(e)};this.setCostInData(t,n),askAlert(n)},this.preBarter=t=>{o(Object.keys(this.selectedItems),()=>this.doBarter(t))},this.doBarter=t=>{let e=Object.keys(this.selectedItems).join();_g("barter&id="+this.barterId+"&offerId="+t+"&selectedItems="+e+"&action=use&usesCount=1&available=0&desiredItem="+this.desireItemId),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,28),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,28),i(this.barterId)};const i=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(r.ON_FINISH_REQUIRE.USE_BARTER_OFFER,r.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)};this.setCostInData=(t,e)=>{e.m="yesno4"},this.initSelect=()=>{var t=this.wnd.$,e=t.find(".choose-prof"),i=t.find(".choose-item-type"),n=[{val:"all",text:_t("prof_all",null,"auction")},{val:a.MAGE,text:_t("prof_mage",null,"auction")},{val:a.WARRIOR,text:_t("prof_warrior",null,"auction")},{val:a.PALADIN,text:_t("prof_paladin",null,"auction")},{val:a.TRACKER,text:_t("prof_tracker",null,"auction")},{val:a.HUNTER,text:_t("prof_hunter",null,"auction")},{val:a.BLADE_DANCER,text:_t("prof_bdancer",null,"auction")}];e.createMenu(n,!0,t=>{this.startFilter()});var s=[{val:"all",text:_t("type_all",null,"auction")},{val:"unique",text:_t("type_unique",null,"auction")},{val:"heroic",text:_t("type_heroic",null,"auction")},{val:"legendary",text:_t("type_legendary",null,"auction")}];i.createMenu(s,!0,t=>{this.startFilter()})},this.initSearch=()=>{let t=this.wnd.$.find(".search"),e=this.wnd.$.find(".search-x");t.keyup(()=>{this.startFilter()}),t.attr("placeholder",_t("search")),e.on("click",()=>{t.val("").blur().trigger("keyup")})},this.startFilter=function(){this.wnd.$.find(".one-item-on-divide-list").removeClass("hide"),this.searchKeyUp(),this.lvlKeyUp(),this.getValueFromProf(),this.getValueFromItemType(),this.countRecipesPerGroup(),this.updateScroll()},this.searchKeyUp=()=>{let t=this.wnd.$.find(".search").val(),e=this.wnd.$.find(".one-item-on-divide-list");""==t||e.each((function(){$(this).find(".name").html().toLowerCase().search(t.toLowerCase())>-1?$(this).removeClass("hide"):$(this).addClass("hide")}))},this.lvlKeyUp=()=>{let t=this.wnd.$.find(".start-lvl input").val(),e=this.wnd.$.find(".stop-lvl input").val(),i=this.wnd.$.find(".one-item-on-divide-list");""==t&&""==e||(""==t&&(t=0),""==e&&(e=1e3),i.each((function(){if("none"==$(this).css("display"))return;let i=$(this).attr("lvl");i>=parseInt(t)&&i<=parseInt(e)?$(this).removeClass("hide"):$(this).addClass("hide")})))},this.getValueFromProf=()=>{let t=this.wnd.$.find(".choose-prof").find(".menu-option").attr("value");"all"!=t&&this.wnd.$.find(".one-item-on-divide-list").each((function(){if("none"==$(this).css("display"))return;$(this).attr("reqp").indexOf(t)>-1?$(this).removeClass("hide"):$(this).addClass("hide")}))},this.getValueFromItemType=()=>{let t=this.wnd.$.find(".choose-item-type").find(".menu-option").attr("value");"all"!=t&&this.wnd.$.find(".one-item-on-divide-list").each((function(){if("none"==$(this).css("display"))return;let e=$(this).attr("typeitem");var i;switch(t){case"unique":i="unique"==e||"heroic"==e||"legendary"==e;break;case"heroic":i="heroic"==e||"legendary"==e;break;case"legendary":i="legendary"==e}i?$(this).removeClass("hide"):$(this).addClass("hide")}))},this.countRecipesPerGroup=()=>{this.wnd.$.find(".divide-list-group").each((function(t,e){let i=$(e).find(".group-list .one-item-on-divide-list:not(.hide)").length;$(e).find(".amount").html(i)}))},this.createCost=(t,e)=>{if(e.cost){var i=n.get("cost-wrapper");switch(e.cost.currency){case 1:var a=this.createCostReagent(_t("gold"),e.cost.value,Engine.hero.d.gold,"money-icon");t.append(a);break;case 2:a=this.createCostReagent(_t("stat-credits"),e.cost.value,Engine.hero.d.credits,"draconite-icon");t.append(a);break;case 3:let i=this.lookForOwnedById(e.cost.itemTpl);a=this.createCostReagent(!1,e.cost.value,i,!1,e.cost.itemTpl);t.append(a);break;case 4:a=this.createCostReagent(_t("stat-honor"),e.cost.value,Engine.hero.d.honor,"honor-icon");t.append(a);break;default:console.error("[Barter.js, createCost] Bad currency:",e.cost.currency)}t.find(".crafting-cost-wrapper").append(i)}else t.find(".crafting-cost-wrapper").html("-")},this.createCostItem=function(t,e,i){var a=n.get("cost-item"),s=this.lookForOwnedById(t),r=s?parseInt(s):0,o=parseInt(e)<=r,l=Engine.tpls.createViewIcon(t,Engine.itemsViewData.BARTER_ITEM_VIEW,"f")[0];a.addClass("tpl-item-"+t),a.find(".item-wrapper").html(l),a.find(".require-state").removeClass("green red").addClass(o?"green":"red"),a.find(".current-owned").html(r),a.find(".need-to-use").html(e),i.append(a),this.setCostAvailableData(i,o)},this.setCostAvailableData=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.attr("data-cost-available",e)},this.createViewItem=t=>Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.BARTER_RECIVED_ITEM_VIEW,t.loc)[0],this.createReagents=function(t,e){let i=[],a=[];this.clearSelectedItems(),this.clearHaveReagentsList(),this.clearNeedReagentsList();for(var s=0;s<e.length;s++){let r=e[s][0],o=e[s][1],l=this.items[r],c=this.createViewItem(l),d=n.get("crafting-reagent"),h=d.find(".item-slot"),u=l.haveStat("amount"),p=0,g=0,f=l.getItemType();c.addClass("pattern-item"),u&&(o*=l.getAmount()),this.setNeedReagentsList(r,o);let m=d.find(".have"),v=d.find(".need");this.setLabelWithRoundVal(m,p),this.setLabelWithRoundVal(v,o),d.find(".item-name").addClass(f).html(l.name),h.addClass("reagent-tpl-"+r),h.append(c),this.rightClickItem(c,l,!1);let E=!0;for(;E;){let t=this.findOneReagent(r,a);if(E=!1,t){if(E=!0,u&&(g+=t.getAmount()),u||g++,p>=o)continue;u&&(p+=t.getAmount()),u||p++,this.setBarterItem(t,h)}}i.push(l.id),this.setHaveReagentsList(r,p);let _=d.find(".owned-items");this.setLabelWithRoundVal(_,g,_t("owned",null,"item_changer")),t.find(".reagents-list").append(d)}Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.BARTER,{enableTplArray:i})},this.setLabelWithRoundVal=(t,e,i)=>{e>9995?t.tip(e):t.tip("");let n=i||"";t.html(n+round(e,4))},this.createCostReagent=(t,e,i,a,s)=>{let r,o,l=n.get("crafting-reagent"),c=l.find(".item-slot");if(a&&(r=n.get("cost-icon-component"),r.find(".icon").addClass(a)),s){let t=this.items[s];r=this.createViewItem(t),o=t.name}t&&(o=t);let d=i>e?e:i,h=l.find(".owned-items"),u=l.find(".have"),p=l.find(".need");return this.setLabelWithRoundVal(h,i,_t("owned",null,"item_changer")),this.setLabelWithRoundVal(u,d),this.setLabelWithRoundVal(p,e),l.find(".item-name").html(o),c.append(r),l},this.getItemSlot=t=>this.wnd.$.find(".reagent-tpl-"+t),this.setBarterItem=(t,e)=>{let i=t.id,n=t.tpl,a=Engine.items.createViewIcon(i,Engine.itemsViewData.BARTER_REAGENT_ITEM_VIEW)[0],s=t.haveStat("amount"),r=e;e||(e=this.getItemSlot(n));let o=e.closest(".reagent-wrapper");Engine.itemsMovedManager.addItem(t,Engine.itemsMovedData.BARTER_ITEM_REAGENT,()=>{this.removeItemFromSlot(t,e,o,a)}),this.addToSelectedItems(i),e.append(a),a.click(i=>{this.removeItemFromSlot(t,e,o,a)});let l=this.getHaveReagentsList(n);s&&(l+=t.getAmount()),s||l++,this.setHaveReagentsList(n,l);let c=o.find(".have");this.setLabelWithRoundVal(c,l),r||this.manageEnableClassOfButton(),this.rightClickItem(a,t,{use:!0,move:!0,split:!0})},this.removeItemFromSlot=(t,e,i,n)=>{let a=t.id,s=t.tpl;this.removeFromSelectedItems(a),Engine.itemsMovedManager.removeItem(a);let r=this.getHaveReagentsList(s),o=t.haveStat("amount");o&&(r-=t.getAmount()),o||r--,this.setHaveReagentsList(s,r),n.remove();let l=i.find(".have");this.setLabelWithRoundVal(l,r),this.manageEnableClassOfButton()},this.clearHaveReagentsList=()=>{this.haveReagentsList={}},this.getHaveReagentsList=t=>this.haveReagentsList.hasOwnProperty(t)?this.haveReagentsList[t]:0,this.setHaveReagentsList=(t,e)=>{this.haveReagentsList[t]=e},this.clearNeedReagentsList=()=>{this.needReagentsList={}},this.getNeedReagentsList=t=>this.needReagentsList.hasOwnProperty(t)?this.needReagentsList[t]:0,this.setNeedReagentsList=(t,e)=>{this.needReagentsList[t]=e},this.checkCanUseOffer=()=>{for(let t in this.needReagentsList){let e=this.needReagentsList[t];if(this.haveReagentsList[t]<e)return!1}return!!this.getOfferAvailableByCost()},this.manageEnableClassOfButton=()=>{let t=this.checkCanUseOffer()?"green":"black",e=this.wnd.$.find(".bottom-row-panel").find(".do-recipe").find(".button");e.removeClass("green black"),e.addClass(t)},this.clearSelectedItems=()=>{this.selectedItems={}},this.addToSelectedItems=t=>{this.selectedItems[t]=!0},this.removeFromSelectedItems=t=>{this.selectedItems.hasOwnProperty(t)&&delete this.selectedItems[t]},this.findOneReagent=(t,e)=>{let i=Engine.heroEquipment.getHItems(),n=["upg","soulbound","lowreq","opis2","timelimit_upgs","lvlupgs","recovered"],a=null,r=null,o=e||[];for(let e in i){let l=i[e],c=l.id;if(s.isEquippedSt(l.st))continue;if(o.includes(c))continue;if(l.tpl!=t)continue;if(l.haveStat("expires")&&l.checkExpires())continue;let d=this.getAmountOfConfuseStats(n,l._cachedStats);if(!d)return o.push(c),l;(null==r||r>d)&&(r=d,a=l)}return a?(o.push(a.id),a):null},this.getAmountOfConfuseStats=(t,e)=>{let i=0;for(let n=0;n<t.length;n++){let a=t[n];e.hasOwnProperty(a)&&i++}return i},this.lookForOwnedById=t=>{for(let e=0;e<this.barterOwnedData.length;e++){if(t==this.barterOwnedData[e][0])return this.barterOwnedData[e][1]}return 0},this.createGroupElement=(t,e)=>{let i,a=t.category,s=this.wnd.$.find(".group-"+a);s.length<1&&(s=n.get("divide-list-group"),i=s.find(".group-header"),s.addClass(`group-${a} active`),s.find(".label").html(_t("au_cat"+a,null,"auction")),this.wnd.$.find(".items-list").append(s),i.click((function(t){s.toggleClass("active")}))),s.find(".group-list").append(e)},this.cleanList=function(){this.wnd.$.find(".items-list").empty()},this.update=(t,e)=>{this.barterId=t.id,this.barterName=t.name,this.barterOffersData=t.offers,this.barterOwnedData=t.owned,this.barterAvailableData=t.available,this.barterUsagesData=t.usages,this.allCategories={},this.lastCreatedId=0,this.wnd.title(this.barterName),this.createOffers()},this.showAgainClickOffer=()=>{for(let t=0;t<this.allParseOffers.length;t++)if(this.showAffectedOfferId==this.allParseOffers[t].affectedId)return void this.createOffer(this.allParseOffers[t])},this.getOfferAvailableByCost=()=>{for(let t=0;t<this.allParseOffers.length;t++)if(this.showAffectedOfferId==this.allParseOffers[t].affectedId)return this.allParseOffers[t].maxAmount;return console.warn("[Barter.js, getOfferAvailableByCost] Not find"),0},this.checkShowAffectedOfferId=()=>null!=this.showAffectedOfferId,this.createOffers=()=>{this.allParseOffers=[];for(let t=0;t<this.barterOffersData.length;t++){let e=this.barterOffersData[t];switch(e.mode){case 1:this.prepareNormalOffer(e);break;case 2:this.prepareChooseOneRequiredFromBigRequiredListOffer(e);break;default:return console.error("[Barter.js, createOffers] Bad offer mode:",e.mode)}}},this.prepareNormalOffer=t=>{let e=t.recived;for(let i=0;i<e.length;i++){let n=e[i],a=this.getAmountAvailable(t.id),s={id:t.id,affectedId:this.lastCreatedId,mode:t.mode,required:t.required,recived:[n],maxAmount:a,category:null,resultItemName:null};this.lastCreatedId++,t.limit&&(s.limit=t.limit),t.cost&&(s.cost=t.cost),this.allParseOffers.push(s)}},this.prepareChooseOneRequiredFromBigRequiredListOffer=t=>{let e=t.required;for(let i=0;i<e.length;i++){let n=e[i],a=n[0],s=this.getAmountAvailable(t.id,a),r={id:t.id,affectedId:this.lastCreatedId,mode:t.mode,required:[n],recived:t.recived,category:null,maxAmount:s,resultItemName:null};this.lastCreatedId++,t.limit&&(r.limit=t.limit),t.cost&&(r.cost=t.cost),this.allParseOffers.push(r)}},this.blockMove=function(){Engine.lock.add("barter")},this.unblockMove=function(){Engine.lock.remove("barter")},this.close=()=>{this.unblockMove(),this.wnd.remove(),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_BARTER_TPL),Engine.tpls.deleteMessItemsByLoc("f"),Engine.itemsMovedManager.removeItemsByTarget(Engine.itemsMovedData.BARTER_ITEM_REAGENT),Engine.disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.BARTER),Engine.barter=!1,l()};const l=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(r.ON_FINISH_BREAK.CLOSE_BARTER,r.ON_FINISH_TYPE.BREAK,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)};this.tLang=t=>_t(t),this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.BARTER;Engine.windowCloseManager.callWindowCloseConfig(t)}}},function(t,e,i){var n=i(0);t.exports=function(){this.result=[];var t=this,e=n.get("conquer-stats");this.initWindow=function(){let t=_t("conquer_loc_stats",null,"map");Engine.windowManager.add({content:e,title:_t("conquer_title"),nameWindow:Engine.windowsData.name.CONQUER_STATS,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.show(),this.wnd.addToAlertLayer(),this.wnd.center(),this.wnd.$.find(".edit-header-label").text(t),this.initScroll()},this.init=function(e){isset(t.wnd)||(this.initWindow(),this.initSearch(),this.parseDataToJson(e),this.createList())},this.parseDataToJson=t=>{if(t.length>0){t=t.split("|");for(var e=0;e<t.length;e+=4){var i=/m|t|b/.test(Engine.hero.d.prof)?-1*parseInt(t[e+3]):parseInt(t[e+3]);this.result.push({id:parseInt(t[e]),pId:parseInt(t[e+1]),name:t[e+2],c:parseInt(i)})}this.result.sort((function(t,e){return e.c-t.c}))}},this.createList=function(){let t=this.result,e=this.wnd.$.find(".conquer-stats-items");if(t.length<1)e.text(_t("no_data",null,"map"));else{for(let i of t){let t=n.get("conquer-stat-one"),a=this.getPercentColor(i.c);t.find(".map-name").text(i.name),t.find(".rep-percent").text(i.c+"%").css("color",a),t.tip(this.getTip(i)),this.setProgressValue(t,i.c),e.append(t)}this.updateScroll()}},this.setProgressValue=function(t,e){let i=e<0?"left":"right";e=100==Math.abs(e)?99:Math.abs(e),t.find(`.pb-fifty__one--${i} .progress`).css("width",Math.abs(e)+"%")},this.getPercentColor=function(t){let e="white";return t<0?e="#de434a":t>0&&(e="#1aba5c"),e},this.getTip=function(t){var e=1+t.c/100*3;return t.c<0?_t("loc_lost %val% %exp%",{"%val%":Math.abs(t.c),"%exp%":roundNumber(e,2)},"map"):_t("loc_conquer %val% %exp%",{"%val%":t.c,"%exp%":roundNumber(e,2)},"map")},this.initSearch=function(){var e=this.wnd.$.find(".search"),i=this.wnd.$.find(".search-x");e.keyup((function(){var e=$(this).val(),i=t.wnd.$.find(".conquer-stat-one");""===e?(i.css("display","block"),t.updateScroll()):i.each((function(){var i=$(this).find(".map-name").html().toLowerCase().search(e.toLowerCase())>-1?"block":"none";$(this).css("display",i),t.updateScroll()}))})),e.attr("placeholder",_t("search")),i.on("click",(function(){e.val("").blur().trigger("keyup")}))},this.initScroll=function(){t.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})},this.updateScroll=function(){$(".scroll-wrapper",t.wnd.$).trigger("update")},this.close=function(){t.wnd.remove(),Engine.conquerStats=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(113),a=i(0);t.exports=class{constructor(t){let{bonuses:e,itemId:i,fromReselect:a=!1}=t;this.closeOtherWindows(),this.getEngine().lock.add("bonus-selector"),this.initWindow(),this.itemId=i,this.fromReselect=a,this.bonusSelectorEl=this.contentEl.querySelector(".enhance__bonus"),this.bonusSelector=new n.default(this.bonusSelectorEl,{itemId:i,onSubmitClb:this.onSubmit.bind(this),isReselectWindow:!0}),this.bonusSelector.createBonusChoose(e),this.wnd.center()}initWindow(){this.contentEl=a.get("bonus-selector-wnd",{jQueryObject:!1}),Engine.windowManager.add({content:this.contentEl,title:this.tLang("select_bonus","item"),nameWindow:this.getEngine().windowsData.name.BONUS_SELECTOR,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()}onSubmit(t,e){if(t){const t=this.fromReselect?`bonus_reselect&action=select&item=${this.itemId}&bonusIdx=${e}`:`moveitem&st=2&id=${this.itemId}&bonusIdx=${e}`;_g(t)}this.close()}close(){this.wnd&&this.wnd.remove(),this.getEngine().bonusSelectorWindow=!1,this.getEngine().lock.remove("bonus-selector")}closeOtherWindows(){const t=this.getEngine(),e=t.windowsData.windowCloseConfig.BONUS_SELECTOR;t.windowCloseManager.callWindowCloseConfig(e)}tLang(t){return _t(t,null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement")}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(23),a=i(2),s=i(12),r=i(0);t.exports=class{constructor(){this.selectedItem=null,this.requestBlock=!1,this.receivedTpls={},this.getEngine().lock.add("bonus-reselect"),this.initWindow(),this.createContent(),this.createConfirmButton(),this.droppableInit(),this.getEngine().tpls.fetch(this.getEngine().itemsFetchData.NEW_BONUS_RESELECT_COST_TPL,this.newReceivedItem.bind(this)),Engine.disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.BONUS_RESELECT)}initWindow(){this.contentEl=r.get("bonus-reselect-wnd",{jQueryObject:!1}),Engine.windowManager.add({content:this.contentEl,title:this.tLang("bonus-reselect-title"),nameWindow:this.getEngine().windowsData.name.BONUS_RESELECT,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.center(),this.wnd.setWndOnPeak()}createContent(){this.selectedItemSlotEl=this.contentEl.querySelector(".bonus-reselect-wnd__item"),this.requireItemSlotEl=this.contentEl.querySelector(".bonus-reselect-wnd__require"),this.buttonsContainerEl=this.contentEl.querySelector(".bonus-reselect-wnd__buttons")}droppableInit(){$(this.selectedItemSlotEl).droppable({accept:".inventory-item",drop:(t,e)=>{e.draggable.css("opacity",""),this.onClickInventoryItem(e.draggable.data("item"))}})}newReceivedItem(t){const e=this.getEngine().tpls.createViewIcon(t.id,this.getEngine().itemsViewData.BONUS_RESELECT_COST_ITEM_VIEW,"w")[0][0];t.isItem()||this.updateAmount(t,e),this.requireItemSlotEl.appendChild(e)}updateAmount(t,e){const i=this.receivedTpls[t.id];i>0&&this.getEngine().tpls.changeItemAmount(t,$(e),i)}onClickInventoryItem(t){if(this.requestBlock)return;const e=parseInt(t.id);this.selectedItem!==e?this.selectedItem?s.isInBagSt(t.st):this.sendPreviewRequest(e):this.clearAll()}sendPreviewRequest(t){this.requestBlock=!0,_g("bonus_reselect&action=status&item="+t)}sendReselectRequest(){null==this.selectedItem&&console.trace(),_g("bonus_reselect&action=apply&item="+this.selectedItem,t=>{(0,a.isset)(t.message)||this.close()})}addItemToExtract(){let t=this.getEngine().items.getItemById(this.selectedItem),e=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.BONUS_RESELECT_ITEM_VIEW)[0][0];e.addEventListener("click",()=>{this.onClickInventoryItem(t)}),this.getEngine().itemsMovedManager.addItem(t,this.getEngine().itemsMovedData.BONUS_RESELECT,()=>{this.onClickInventoryItem(t)}),this.dimRestart(),t.on("delete",()=>this.clearAll()),this.selectedItemSlotEl.innerHTML="",this.selectedItemSlotEl.appendChild(e)}removeSelectedItem(){if(null!=this.selectedItem){this.getEngine().items.getItemById(this.selectedItem).unregisterCallback("delete",()=>this.clearAll()),this.selectedItem=null}}createConfirmButton(){const t={text:this.tLang("bonus-reselect-submit"),classes:["small","green"],action:this.confirmOnClick.bind(this),disabled:!0};this.submitBtn=new n.default(t),this.buttonsContainerEl.appendChild(this.submitBtn.getButton())}confirmOnClick(){const t=this.tLang("confirm-prompt");askAlert({q:t,clb:()=>this.sendReselectRequest(),m:"yesno4"})}setStateConfirmButton(t){this.checkRequiresItemsAmount(t)?this.submitBtn.setState(!1):this.submitBtn.setState(!0)}checkRequiresItemsAmount(t){let{ingredientItemQuantity:e,ingredientItemTplId:i}=t;return checkItemsAmount(i)>=e}update(t){if((0,a.isset)(t.status)){this.requestBlock=!1;const{ingredientItemQuantity:e,ingredientItemTplId:i,itemId:n}=t.status;this.selectedItem=n,this.addItemToExtract(),this.receivedTpls[i]=e,this.setStateConfirmButton(t.status)}}dimRestart(){this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.BONUS_RESELECT),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.BONUS_RESELECT)}close(){this.wnd&&this.wnd.remove(),this.clearAll(),this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.BONUS_RESELECT),this.getEngine().tpls.removeCallback(this.getEngine().itemsFetchData.NEW_BONUS_RESELECT_COST_TPL),this.getEngine().bonusReselectWindow=!1,this.getEngine().lock.remove("bonus-reselect")}tLang(t){return _t(t,null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement")}clearAll(){this.removeSelectedItem(),this.getEngine().tpls.deleteMessItemsByLoc("w"),this.getEngine().items.deleteAllViewsByViewName(this.getEngine().itemsViewData.BONUS_RESELECT_ITEM_VIEW),this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.BONUS_RESELECT),this.submitBtn.setState(!0)}getEngine(){return Engine}}},function(t,e,i){let n=i(308),a=i(0);t.exports=function(){let t=0,e=null,i=null,s=null,r=null,o=null,l=null,c=null,d={},h="premium",u="standard";const p=()=>{Engine.tpls.fetch(Engine.itemsFetchData.NEW_BATTLE_PASS_TPL,g)},g=(t,e)=>{d[t.id]=t,e&&f()},f=()=>{for(let t in d){let e=d[t];m(e)}},m=t=>{let e=t.id;i.find(".reward-item-tpl-"+e).each((function(){let i=Engine.tpls.createViewIcon(e,Engine.itemsViewData.BATTLE_PASS_ITEM_VIEW,"B")[0],n=parseInt($(this).attr("quantity"));Engine.tpls.changeItemAmount(t,i,n),i.attr("data-tip-type",t.$.data("tipType")),i.attr("data-item-type",t.$.data("itemType")),i.data("item",t),$(this).append(i)}))},v=()=>{i=a.get("battle-pass-window"),e=Engine.windowManager.add({content:i,title:_t("path_of_hero"),nameWindow:Engine.windowsData.name.BATTLE_PASS,onclose:()=>{Q()}}),e.addToAlertLayer(),e.center()},E=()=>{i.find(".roll-mission-icon").click((function(){confirmWithCallback({msg:_t("roll_mission",{"%cost%":25}),clb:function(){_g("battlepass&action=reroll")}})}))},_=()=>{let t=i.find(".cards-header"),e=_t("battle_pass_chalanges"),n=_t("battle_pass_rewards");K(t,e,(function(){})),K(t,n,(function(){})),q()},b=()=>{s&&(clearInterval(s),s=null),w(),C(),s=setInterval((function(){w(),C()}),1e3)},w=()=>{i.find(".daily-mission").find(".tiles-wrapper-header-time").html(T(r.time_daily_missions_end,{h:!0,m:!0,s:!0}))},C=()=>{i.find(".global-mission").find(".tiles-wrapper-header-time").html(T(r.activity_end_time,{d:!0,h:!0,m:!0}))},T=(t,e)=>getSecondLeft(t-Math.round(ts()/1e3),e),y=()=>{let t=null,e=null;switch(c.access){case 1:t="free-banner",e="free-icon";break;case 2:t="premium-banner",e="premium-icon";break;default:errorReport("BattlePass.js","manageBanner","unregistered access value",c.access)}i.find(".battle-pass-icon-wrapper").find(".battle-pass-icon").removeClass("premium-icon free-icon").addClass(e),i.find(".battle-pass-banner-graphic").removeClass("premium-banner free-banner").addClass(t),i.find(".battle-pass-banner-icon").removeClass("premium-banner free-banner").addClass(t)},I=()=>{i.find(".your-all-points-wrapper").find(".points").html(_t("sum_points")+" "+c.points)},A=()=>{let t=i.find(".battle-pass-buttons");if(t.empty(),1!=c.access)return;let e=createButton("Aktywuj",["small","green","active-battle-pass-button"],(function(){confirmWithCallback({msg:_t("active_battle_pass",{"%cost%":250}),clb:function(){_g("battlepass&action=buy_premium")}})}));t.append(e)},k=t=>{r=t.status.event,o=t.status.levels,l=t.status.missions,c=t.status.profile},S=()=>{let t=i.find(".battle-pass-rewards").find(".scroll-pane");i.find(".battle-pass-reward-record").remove();for(let e in o)O(o[e],e,t,c.access)},O=(t,e,i,n)=>{let s=a.get("battle-pass-reward-record");t.standard&&R(s,e,t.threshold,t.standard,u,"green",n),t.premium&&R(s,e,t.threshold,t.premium,h,"purple",n),x(s,e,t),i.append(s)},M=(t,e)=>t==h&&1==e,N=t=>c.collected_rewards.includes(t),R=(t,e,i,n,a,s,r)=>{let o=n.tplId,l=n.quantity,d=n.id,h="take-"+a+"-reward-button",u=t.find("."+a+"-reward-item-ceil"),p=["small",s,h];M(a,r)&&p.push("disable"),N(d)&&p.push("disable"),((t,e)=>t>=e)(c.points,i)||p.push("disable");let g=createButton(_t("take_mail"),p,()=>{_g("battlepass&action=collect_reward&level="+e+"&type="+a)});t.find("."+a+"-reward-button-ceil").append(g),u.addClass("visible"),L(u,d,o,l,a,r)},x=(t,e,i)=>{let n=this.calcPercent(c.points,e,i.threshold);t.find(".vertical-progress-bar-wrapper").find(".inner").css("height",n+"%"),t.find(".threshold").html(i.threshold)};this.calcPercent=(t,e,i)=>{let n=i/(parseInt(e)+1);return(t-parseInt(e)*n)/n*100};const L=(t,e,i,n,a,s)=>{let r=t.find(".reward-item-wrapper");if(r.addClass("reward-item-tpl-"+i).attr("quantity",n),N(e)&&r.addClass("disable"),!M(a,s))return;let o=$("<div>").addClass("reward-item-lock"),l=$("<div>").addClass("background"),c=$("<div>").addClass("lock");o.append(l,c),r.append(o)},D=()=>{let t=i.find(".daily-mission").find(".tiles-wrapper").empty(),e=i.find(".global-mission").find(".tiles-wrapper").empty();P(l.daily,t),P(l.global,e),Y()},P=(t,e)=>{for(let i in t)B(t[i],e)},B=(t,e)=>{let i=a.get("battle-pass-mission-tile");F(i,0),W(i,t),e.append(i)},F=(t,e)=>{t.attr("stage",e)},W=(t,e)=>{e.stages.length>1&&H(t,e),V(t,e,0)},H=(t,e)=>{t.addClass("choose-stages");let i=e.stages;t.find(".mission-prev-button").click((function(){let n=parseInt(t.attr("stage")),a=G(n-1,i);V(t,e,a)})),t.find(".mission-next-button").click((function(){let n=parseInt(t.attr("stage")),a=G(n+1,i);V(t,e,a)}))},G=(t,e)=>t<0?e.length-1:t>e.length-1?0:t,V=(t,e,i)=>{let s=a.get("mission-progress-bar"),r=e.objective,o=n.missionObjectiveByKey[r],l=e.stages[i].id,c=e.stages[i].max_progress,d=e.stages[i].reward,h=j(l),u=_t("battle_pass_"+r+"_"+o,null,"battlePassEnum");F(t,i),t.find(".mission-description").html(u+": ["+c+"]"),t.find(".mission-reward-label").html("+"+d),t.find(".mission-stage").html(`${i+1}/${e.stages.length}`),U(s,h,c),t.find(".place-to-mission-progress-bar").empty().append(s)},U=(t,e,i)=>{let n=Math.floor(e/i*100),a="";a=100==n?_t("finish_label"):`${e}/${i}`,t.find(".text").html(a),t.find(".inner").attr("bar-percent",n)},j=t=>{for(let e in c.mission_progress)if(t==c.mission_progress[e].id)return c.mission_progress[e].progress;return 0},q=()=>{i.find(".section").eq(0).addClass("visible"),i.find(".card").eq(0).addClass("active"),Y()},K=(t,e,n)=>{let s=a.get("card");s.find(".label").html(e),t.append(s),s.click((function(){let t=$(this).index();z(t),Y(),i.find(".edit-header-label").html(e),n&&n()}))},Y=()=>{$(".scroll-wrapper",i).trigger("update")},z=e=>{var n=i.find(".card").removeClass("active"),a=i.find(".bottom-bar"),s=i.find(".section").removeClass("visible");n.eq(e).addClass("active"),s.eq(e).addClass("visible"),a.children().css("display","none"),a.children().eq(e).css("display","block"),t=e},X=()=>{i.find(".battle-pass-challenges>.scroll-wrapper").addScrollBar({track:!0}),i.find(".battle-pass-rewards>.scroll-wrapper").addScrollBar({track:!0})},Q=()=>{e.remove(),Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_BATTLE_PASS_TPL),Engine.battlePass=!1};this.init=()=>{v(),_(),E(),p(),X()},this.updateData=t=>{console.log(t),k(t),b(),y(),A(),D(),S(),I()},this.updateScroll=Y}},function(t,e){let i={missionObjective:{LootCommonItem:1,LootUniqueItem:2,LootHeroicItem:3,LootLegendaryItem:4,LootArtefactItem:5,DuelWithPlayer:6,LoseDuelWithPlayer:7,KillCommonMonster:8,KillEliteMonster:9,KillElite2Monster:10,KillHeroMonster:11,KillTitanMonster:12,KillMonsterWithIndestructibleLoot:13,KillMonsterWithCritical:14,KillPlayerWithCritical:15,KillPlayer:16,KillPaladin:17,KillMage:18,KillWarrior:19,KillBladeDancer:20,KillHunter:21,KillTracker:22,DealDamage:23,DealPhysicalDamageToPlayer:24,DealPhysicalDamageToNpc:25,DealFireDamageToPlayer:26,DealFireDamageToNpc:27,DealFrostDamageToPlayer:28,DealFrostDamageToNpc:29,DealLightDamageToPlayer:30,DealLightDamageToNpc:31,DealPoisonDamageToPlayer:32,DealPoisonDamageToNpc:33,DealDeepWoundDamageToPlayer:34,DealDeepWoundDamageToNpc:35,HealByItem:36,HealByTalisman:37,HealSelfInBattle:38,HealAllyInBattle:39,ExtractItem:40,ExtractCommonItem:41,ExtractUniqueItem:42,ExtractUpgradedItem:43,ExtractHeroicItem:44,ExtractLegendaryItem:45,ExtractArtefactItem:46,SalvageItem:47,SalvageCommonItem:48,SalvageUniqueItem:49,SalvageUpgradedItem:50,SalvageHeroicItem:51,SalvageLegendaryItem:52,SalvageArtefactItem:53,GainEssencesAmount:54,EnhanceItem:55,EnhanceCommonItem:56,EnhanceUniqueItem:57,EnhanceHeroicItem:58,EnhanceUpgradedItem:59,EnhanceLegendaryItem:60,EnhanceArtefactItem:61,UpgradeItem:62,UpgradeCommonItem:63,UpgradeUniqueItem:64,UpgradeUpgradedItem:65,UpgradeHeroicItem:66,UpgradeLegendaryItem:67,UpgradeArtefactItem:68,ReselectBonusItem:69,BuyAuctionItem:70,SellItemInAuction:71,SellItemInShop:72,GainGoldFromShop:73,SpentGoldInShop:74,SendMail:75,UseBarter:76,UseBless:77,BuyClanBless:78,TradeWithPlayer:79,AddFriend:80,UseEmotion:81,UseEmotionOnPlayer:82,GainExperiencePoints:83,GainHonorPoints:84,LoseHonorPointsInDuelWithPlayer:85,PickUpRenewableItem:86},missionObjectiveByKey:{}};for(let t in i.missionObjective){let e=i.missionObjective[t];i.missionObjectiveByKey[e]=t}t.exports=i},function(t,e,i){var n=i(310),a=i(311),s=i(312),r=i(30),o=i(9);t.exports=function(){const t="CodeMessageManager.js";let e=null,i=null,l=null;const c=()=>{e=new n},d=()=>{i=new a},h=()=>{l=new s};const u=(t,i,n)=>{let a=i.id,s=e.getCodeMessageData(a,i);null!=s.fullText&&g(t,s,a,n)},p=(t,i)=>{let n=i.id,a=e.getCodeMessageData(n,i);if(null!=a.fullText)return a.confirm?a.config&&a.config.buttons?void askAlert({m:"buttons",q:parsePopupBB(a.fullText),re:a.confirm,config:a.config}):void askAlert({m:"yesno",q:parsePopupBB(a.fullText),re:a.confirm}):void g(t,a,n)},g=(e,n,a,s)=>{let l=i.getCodeMessageData(a);const c=r.VISIBLE_KIND,d=r.SOURCE,h=d.MESSAGE,u=d.CHAT,p=c.YELLOW_MESSAGE,g=c.ALERT,E=c.CHAT_SYSTEM_MESSAGE,_=c.CHAT_CLAN_MESSAGE;let b=m(a);if(l&&(l.viewParams[h]||l.viewParams[u])){switch(v(l,e)){case p:message(n.fullText,b);break;case g:mAlert(n.fullText);break;case E:f(s,n.fullText,o.CHANNEL.SYSTEM);break;case _:f(s,n.fullText,o.CHANNEL.CLAN);break;default:errorReport(t,"createOneMessageFromMessageSource","not supporter VISIBLE_KIND!",l.viewParams[h])}}else message(n.fullText,b)},f=(t,e,i)=>{Engine.chatController.addMessage({ts:t.ts,expiredMessage:getEngine().chatController.getChatDataUpdater().checkExpiredMessage(t.id,t.ts),id:t.id,channel:i,systemRelatedBusinessCard:t.getSystemRelatedBusinessCard(),authorBusinessCard:null,receiverBusinessCard:null,text:e})},m=t=>{const e=r.CALL_KIND.INSTANT_CALL;return l.getCodeMessageData(t).callParams==e},v=(t,e)=>{const i=r.SOURCE.MESSAGE,n=r.SOURCE.CHAT;let a=null;return t.viewParams[e]?a=t.viewParams[e]:(t.viewParams[i]&&(a=t.viewParams[i]),t.viewParams[n]&&(a=t.viewParams[n])),a};this.init=()=>{c(),d(),h(),function(){let t=r.CODE_MESSAGE,n=r.CODE_MESSAGE_ATTR.KEY_CODE;r.CODE_MESSAGE_ATTR.NAME;for(let a in t){let s=t[a];e.addRecord(s[n],s),i.addRecord(s[n],s),l.addRecord(s[n],s)}}(),function(){let t=r.CODE_MESSAGE_WRAPPER,i=r.CODE_MESSAGE_ATTR.KEY_CODE,n=r.CODE_MESSAGE_ATTR.NAME;for(let a in t){let s=t[a];e.addRecordWrapperMessage(s[i],s[n])}}(),e.createAllInWorkLog()},this.updateData=(e,i,n)=>{switch(i){case r.SOURCE.MESSAGE:p(i,e);break;case r.SOURCE.CHAT:u(i,e,n);break;default:errorReport(t,"updateData",`codeMessageSource ${i} not exist!`)}}}},function(t,e,i){var n=i(30);t.exports=function(){let t={},e={};function i(t,e){return t+"_"+e}function a(e,n,a){let s="",r=function(e){return t[e].groupParamsAmount}(e);return s=a?function(t,e,n,a){let s,r=i(t,e);if(a){s="";for(let e=0;e<n.length;e+=a){let i=e,o=e+a,d=l(n.slice(i,o));s+=c(t,r,d)+"[br]"}}else{let e=l(n);s=c(t,r,e)}return s}(e,n,a,r):function(t,e){let n=i(t,e);return c(t,n)}(e,n),s}function s(t,i){if(!d(t))return null;return function(t,i){if(!function(t){return e[t]}(t))return i;let n=o(t);return _t(n,{"%params0%":i},"MessageController")}(t,a(t,r(t),i))}function r(e){return t[e].keyName}function o(t){return e[t].keyName}function l(t){let e={};for(let i=0;i<t.length;i++)e[`%params${i}%`]=t[i];return e}function c(t,e,i){let n=_t(e,i||null,"MessageController");return function(t,e){if(!e){let e=`MESSAGE ID: ${t}, not created in workLog OR created and empty OR not updated dictionaries`;warningReport("CodeMessageParser.js","checkStringHasTranslated",e),message(e)}}(t,n),n}function d(e){return t[e]}this.init=function(){},this.addRecord=function(e,i){if(t[e])throw`MESSAGE ID: ${e} ALREADY EXIST! YOU NEED USE ANOTHER!`;let a=n.CODE_MESSAGE_ATTR.TEXT_PARAMS,s=n.TEXT_MODIFY.GROUP_PARAMS_AMOUNT,r=n.CODE_MESSAGE_ATTR.NAME;t[e]={keyName:i[r],groupParamsAmount:!(!i[a]||!isset(i[a][s]))&&i[a][s]}},this.addRecordWrapperMessage=function(t,i){if(e[t])throw`WRAPPER MESSAGE ID: ${t} ALREADY EXIST! YOU NEED USE ANOTHER!`;e[t]={keyName:i}},this.getCodeMessageData=function(t,e){const i=e.params,n=e.confirm,a=e.config;let r={fullText:s(t,i)};return a&&(r.config=a),function(t){if(d(t))return!0;let e=`ID: ${t} NOT DECLARED IN CLIENT!`;return warningReport("CodeMessageWrapper","manageMessageExistIsCorrect",e),message(e),!1}(t)?(null==r.fullText||n&&(r.confirm=n),r):r},this.createAllInWorkLog=function(){for(let e in t){let t=i(e,r(e));_t(t,null,"MessageController")}for(let t in e){let e=o(t);_t(e,null,"MessageController")}}}},function(t,e,i){var n=i(30);t.exports=function(){let t={};const e=t=>{for(let e in t){let i=t[e];if(!n.VISIBLE_KIND[i])return errorReport("ViewCodeMessageParser.js","checkVisibleKindExist","VISIBLE_KIND not exist",i),!1}return!0},i=t=>{if(!lengthObject(t))return errorReport("ViewCodeMessageParser.js","checkSourceExist","Object is empty!"),!1;for(let e in t)if(!n.SOURCE[e])return errorReport("ViewCodeMessageParser.js","checkSourceExist","SOURCE not exist",e),!1;return!0};this.init=function(){},this.addRecord=function(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.CODE_MESSAGE_ATTR.VIEW_PARAMS;s[r]&&i(s[r])&&e(s[r])&&(t[a]={viewParams:s[r]})},this.getCodeMessageData=e=>t[e]?t[e]:null}},function(t,e,i){var n=i(30);t.exports=function(){let t={},e="CallCodeMessageParser.js";const i=t=>{const e=n.CALL_KIND.AFTER_CLIENT_READY_CALL;a(t,e)},a=(e,i)=>{t[e]={callParams:i}},s=t=>!!n.CALL_KIND[t]||(errorReport(e,"checkCallKindExist","CALL_KIND not exist",t),!1);this.init=function(){},this.addRecord=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n.CODE_MESSAGE_ATTR,o=r.CALL_PARAMS;let l=e[o];l&&s(l)?a(t,l):i(t)},this.getCodeMessageData=e=>t[e]?t[e]:null}},function(t,e,i){var n=i(5),a=i(0),s=i(314),r=i(55),o=i(316),l=i(18),c=i(319),d=i(320),h=i(321),u=i(339),p=i(340),g=(i(112),i(341)),f=i(342);let m=i(32);var v=i(9);const{WW:E}=i(115),{isMobileApp:_}=i(2),b=i(72);t.exports=function(){var t=this,e=[];let i,w,C,T,y,I,A,k={},S=[],O=[],M=null,N=null;this.alreadyInitialised=!1,this.lock=new Lock(["game_init","loader","images","crossStorage"],(function(){let e=t.alreadyInitialised;e||t.afterUnlock(),Engine.interfaceStart=!0,e||(devConsoleLog(["initialise onResize"]),Engine.onResize(),Engine.tutorialManager.startAfterInterfaceLoad())}));this.get$gameWindowPositionerHeight=()=>M.height(),this.get$InterfaceLayerHeight=()=>this.get$interfaceLayer().height(),this.initPositioners=()=>{C=this.get$interfaceLayer().find(".bottom.positioner"),T=this.get$interfaceLayer().find(".top.positioner"),y=M.find(".right-column.main-column")},this.get$rightColumn=()=>y,this.getBottomPositioner=()=>C,this.getTopPositioner=()=>T,this.init$MAP_CANVAS=()=>{i=$("#MAP_CANVAS")},this.init$GAME_CANVAS=()=>{w=$("#GAME_CANVAS")},this.init$gameWindowPositioner=()=>{M=$(".game-window-positioner")};const R=()=>{I=this.get$interfaceLayer().find(".location")},x=()=>{A=this.get$interfaceLayer().find(".map-timer")};this.interfaceFocus=!0,this.init=function(){H((function(e){t.interfaceFocus=!1})),W((function(e){t.interfaceFocus=!0})),G(),V(),this.init$gameWindowPositioner(),this.blockWheel(),this.initCachedScripts(),this.initAppend(),this.initLayers(),this.init$GAME_CANVAS(),this.initPositioners(),this.initMouseEvent(),this.initInterfaceTemplates(),this.createZoomOverlay(),this.heroElements=new g,this.heroElements.init(),this.mailsElements=new f(this),R(),x();var e=this.get$loaderLayer().find(".progress-bar .inner");e.css("display","block"),setPercentProgressBar(e,0),$(window).on("resize",(function(){Engine.onResize()}))},this.initMouseEvent=()=>{w.on("mouseup mousedown click mousemove mouseleave mouseenter contextmenu",(function(t){let e=Engine.zoomFactor,i=getEngine().zoomManager.getActualZoom(),n=w.offset(),a=n.left,s=n.top;t.clientX=t.clientX/e,t.clientY=t.clientY/e,t.clientX=t.clientX/i,t.clientY=t.clientY/i,Engine.eventCollider.dispatch(t,t.clientX-a/e/i+Engine.map.offset[0],t.clientY-s/e/i+Engine.map.offset[1])})),$([this.get$interfaceLayer()[0],this.get$mAlertLayer()[0],this.get$alertsLayer()[0]]).on("mouseup",(function(){blockRemoveMobileMenu||$(".popup-menu").remove();var t=Engine.others.check();for(var e in t){var i=t[e];i.colorMark&&"green"==i.colorMark.color&&(delete i.colorMark,Engine.targets.deleteArrow("Other-"+i.d.id))}L()}))};const L=()=>{$(".pick-color-palette").css("display","none")};this.blockWheel=function(){if(!("undefined"!=typeof InstallTrigger)){window.innerHeight,document.documentElement.scrollHeight;window.addEventListener("wheel",(function(t){var e=$(t.target);!e.is("textarea")&&!e.closest(".unblock-scroll").length>0&&t.preventDefault()}),{passive:!1})}},this.initLayers=function(){k[m.$_CAPTCHA_LAYER]=a.get("captcha-layer"),k[m.$_ALERTS_LAYER]=a.get("alerts-layer"),k[m.$_M_ALERT_MOBILE_LAYER]=a.get("mAlert-mobile-layer"),k[m.$_INTERFACE_LAYER]=a.get("interface-layer"),k[m.$_LOADER_LAYER]=a.get("loader-layer"),k[m.$_POP_UP_LAYER]=a.get("popup-menu-layer"),k[m.$_CONSOLE_LAYER]=a.get("console-layer"),k[m.$_M_ALERT_LAYER]=a.get("mAlert-layer"),k[m.$_STICKY_TIPS_LAYER]=a.get("sticky-tips-layer"),k[m.$_TUTORIAL_LAYER]=a.get("tutorial-layer"),k[m.$_ECHH_LAYER]=a.get("echh-layer"),k[m.$_DROP_TO_DELETE_WIDGET_LAYER]=a.get("drop-to-delete-widget-layer"),k[m.$_ZOOM_LAYER]=a.get("zoom-layer"),k[m.$_CHAT_LAYER]=a.get("chat-layer"),N=k[m.$_INTERFACE_LAYER].find(".game-layer"),k[m.$_LOADER_LAYER].css("display","block");for(let t in k)M.append(k[t])},this.showTutorialLayer=()=>{this.get$tutorialLayer().css("display","block")},this.hideTutorialLayer=()=>{this.get$tutorialLayer().css("display","none")},this.initInterfaceTemplates=()=>{var t=a.get("hp-indicator-wrapper"),e=a.get("exp-bar-wrapper"),i=a.get("battle-bars-wrapper"),n=a.get("extended-stats-tpl"),s=a.get("bottom-panel-of-bottom-positioner"),r=a.get("hud-container");let o=this.get$interfaceLayer();o.find(".bottom.positioner .content").append(s),o.find(".hp-indicator-wrapper-template").append(t),o.find(".hud-container").replaceWith(r),o.find(".exp-bar-wrapper-template").append(e),o.find(".battle-bars-wrapper-template").append(i),o.find(".extended-stats").append(n),N.append(a.get("stasis-incoming-overlay")),N.append(a.get("stasis-overlay")),N.append(a.get("map-reloader-splash")),N.append(a.get("dead-overlay"));var l=a.get("character_wrapper"),c=a.get("inventory_wrapper");M.find(".right-column").find(".inner-wrapper").append(l),M.find(".right-column").find(".inner-wrapper").append(a.get("battle-set-wrapper")),M.find(".right-column").find(".inner-wrapper").append(c),M.find(".right-column").find(".inner-wrapper").append($("<div>").addClass("tutorial-banner-anchor"))},this.addToGameWindowPositioner=t=>{M.append(t)},this.tooMoreZoomOut=function(){return $("body").width()>2*$(window).width()},this.initBattleSetPanel=function(){t.get$interfaceLayer().find(".battle-set-wrapper").children().each((function(t){$(this).addClass("battle-set-nr-"+t),$(this).click((function(){var e=Engine.skills?"&skillshop=1":"";_g("moveitem&set="+(t+1)+e)}))})),t.setActiveInBattleSet(Engine.hero.d.cur_battle_set)},this.setActiveInBattleSet=function(e){var i=t.get$interfaceLayer().find(".battle-set-wrapper").find(".battle-set-choice");i.removeClass("active"),i.eq(e-1).addClass("active")},this.initZoomFactor=function(e){if(mobileCheck()){var i=n.get("ZoomFactor");null!=i&&e?(Engine.zoomFactor=i,this.addZoomClassToBody()):(Engine.zoomFactor=1,t.setASDASD()),Engine.onResize()}else t.setZoomFactor(1)},this.setASDASD=function(){var e=t.findTheBestZoom();t.setZoomFactor(e)},this.findTheBestZoom=function(){for(var e=1;tooBigScreen(e);)if(t.decreaseZoom(),(e-=.1)<.5)return e;return e},this.setZoomFactor=function(t){Engine.zoomFactor=t,n.set("ZoomFactor",t),this.addZoomClassToBody()},this.addZoomClassToBody=function(){let t=$("body");t.removeClass("zoom-factor-100"),t.removeClass("zoom-factor-90"),t.removeClass("zoom-factor-80"),t.removeClass("zoom-factor-70"),t.removeClass("zoom-factor-60"),t.removeClass("zoom-factor-50"),t.removeClass("zoom-factor-40"),t.addClass("zoom-factor-"+Math.floor(100*Engine.zoomFactor))},this.initCachedScripts=function(){jQuery.cachedScript=function(t,e){return e=$.extend(e||{},{dataType:"script",cache:!0,url:t}),jQuery.ajax(e)}},this.initAppend=function(){var t=$.fn.append;$.fn.append=function(){return t.apply(this,arguments).trigger("append")}},this.setSizeScreen=function(){mobileCheck()},this.afterUnlock=function(){t.alreadyInitialised=!0,$("body").contextmenu((function(t){t.ctrlKey||t.preventDefault()})),$(".logs-btn").click((function(){var e=t.get$interfaceLayer().find(".chat-tpl");parseInt(e.css("top"))>50?e.css("top","40px"):e.css("top","50%")})),this.get$interfaceLayer().show(),Engine.widgetManager.initDefaultWidgetSet(),this.addStaticButtons(),Engine.widgetManager.createEmptySlotsWidget(),this.showEmptySlots(!1),this.shopButtons(),this.initEngineSettings(),this.initChangePlayer(),this.initBattleSetPanel(),Engine.map.setSetings(),Engine.soundManager.synchroStart(),this.get$interfaceLayer().show(),Engine.console.displayMsg("Game started."),t.setLangClass(),t.manageMobile(),t.manageIframe(),t.setCSSAnimations(),t.setItemsHighlights(),t.initAddons(),t.initAchievements(),t.setSizeEqColumnSize(),t.pvpIcon(),t.worldName(),t.initBanners(),Engine.itemsMarkManager.compareAllItems(),t.get$loaderLayer().fadeOut(),t.updateInterfaceLayerScrollbars(),t.setChat(),getEngine().colorInterfaceNotificationManager.createMainCanvas(),getEngine().questTracking.afterInterfaceStart(),getEngine().quests.setTrackItemsAfterInterfaceStart(),D()},this.updateInterfaceLayerScrollbars=()=>{this.get$interfaceLayer().find(".battle-controller .scroll-wrapper").trigger("scrollBottom"),this.get$interfaceLayer().find(".scroll-wrapper").trigger("update")},this.checkIfIframe=()=>{try{return window.self!==window.top}catch(t){return!0}},this.manageIframe=function(){this.checkIfIframe()&&!mobileCheck()&&t.fullScreenInfoAlert(_t("full_screen"))},this.manageMobile=function(){mobileCheck()&&($("body").addClass("mobile-version"),Engine.padController?Engine.padController.init():errorReport("Interface.js","managerMobile","Engine.padController nor exist!"))};const D=()=>{mobileCheck()&&(_()||t.fullScreenInfoAlert(_t("mobile_info")))};this.fullScreenInfoAlert=e=>{mAlert(e,[{txt:"OK",callback:function(){return t.clickFullScreen(),!0}},{txt:_t("no"),callback:function(){return!0}}],!1,m.$_M_ALERT_MOBILE_LAYER)},this.setCSSAnimations=function(){Engine.opt(8)?$("body").removeClass("anim-on"):$("body").addClass("anim-on")},this.setItemsHighlights=function(){Engine.opt(13)?$("body").addClass("s-item-highlights-off"):$("body").removeClass("s-item-highlights-off")},this.setLangClass=function(){$("body").addClass("lang-"+_l())},this.createNotif=t=>{let e=a.get("right-column-notif");return this.addToQueue(t),e.attr("id",t),this.get$interfaceLayer().find(".bottom-right").find(".game-notifications").append(e),this.setPositionNotif(t),e},this.deleteNotif=function(i){var n=this.getNotifIndex(i);null!==n&&($("#"+i).remove(),e.splice(n,1),t.rebuildPosAllNotif())},this.setPositionNotif=function(t){var e=this.getNotifIndex(t);if(null!==e){var i=43*e;$("#"+t).css("bottom",i+"px")}},this.rebuildPosAllNotif=function(){for(var t=0;t<e.length;t++){var i=e[t];this.setPositionNotif(i)}},this.getNotifIndex=function(t){var i=e.indexOf(t);return i>-1?i:null},this.addToQueue=function(t){null===this.getNotifIndex(t)&&e.push(t)},this.initEngineSettings=function(){Engine.settings||(Engine.settings=new s,Engine.settings.init())},this.initChangePlayer=function(){Engine.changePlayer||(Engine.changePlayer=new p.default)},this.canShowAddons=function(){return["dev","new","experimental"].indexOf(Engine.worldConfig.getWorldName())>-1},this.initAddons=function(){Engine.addonsPanel=new h,Engine.addonsPanel.init()},this.initBanners=function(){Engine.banners=new o,Engine.banners.init(),Engine.banners.showOrHideBanners()},this.initAchievements=function(){Engine.achievements=new u,Engine.achievements.init()},this.showConsoleNotif=function(){if(!$("#consoleNotif").length){var e=t.createNotif("consoleNotif"),i=_t("warn_tip",null,"static");e.tip(i),e.click((function(){Engine.console.open()}))}},this.isShowLeftColumn=()=>"none"!=this.get$interfaceLayer().find(".left-column.main-column").css("display"),this.createZoomOverlay=function(){var e=$(".zoom-layer");e.find(".plus").click((function(){t.clickIncreaseZoom()})),e.find(".minus").click((function(){t.clickDecreaseZoom()}));var i=a.get("button").addClass("green");i.find(".label").html(_t("out",null,"logoff"));var n=a.get("button").addClass("green");n.find(".label").html(_t("standart_zoom")),e.find(".btn-wrapper").append(i),e.find(".btn-wrapper").append(n),i.click(t.clickZoomOverlayPanel),n.click((function(){t.setZoomFactor(1),Engine.onResize(),t.initZoomFactor(!1)}))},this.clickZoomOverlayPanel=function(){let e="block"==t.get$zoomLayer().css("display")?"none":"block";t.get$zoomLayer().css("display",e)},this.getPopupMenu=()=>{let t=$(".popup-menu");return t.length?t:null},this.showPopupMenu=function(e,i,n){if(i.stopPropagation(),i.preventDefault(),$(".popup-menu").remove(),!e.length)return;var s=a.get("popup-menu");a.get("button").addClass("small");for(var r in e)!function(t){var i=a.get("menu-item").html(parseBasicBB(e[t][0],!1));isset(e[t][2])&&i.addClass(e[t][2].button.cls),$(i).click((function(){e[t][1](),i.hasClass("not-close")||s.remove()})),s.append(i)}(r);var o=t.get$popUpLayer().children().length+1;t.get$popUpLayer().append(s);let l=mobileCheck();l&&s.addClass("mobile-menu");let c=s.outerWidth(),d=s.outerHeight();if(l){d>window.innerHeight/Engine.zoomFactor&&(s.removeClass("mobile-menu"),d=s.outerHeight())}const{left:h,top:u}=this.calcPopupMenuPos(i.clientX,i.clientY,c,d,n);s.css({top:u,left:h,"z-index":o}).addClass("show")},this.calcPopupMenuPos=function(t,e,i,n,a){const s=Engine.zoomFactor,r=window.innerHeight/s,o=window.innerWidth/s-i,l=r-n;if(a){let i=Engine.zoomManager.getActualZoom();t*=i,e*=i}let c=e-n/2,d=t-i/2;return d<0&&(d=0),c<0&&(c=0),d>o&&(d=o),c>l&&(c=l),{left:d,top:c}},this.isDecember=function(){return 11==(new Date).getMonth()?"":"disabled"},this.getBattlePassActive=function(){return Engine.battlePassActive},this.rewardsCalendarActive=function(){return Engine.rewardsCalendarActive},this.clickLogout=()=>{Engine.changePlayer.managePanelVisible()},this.clickHelp=function(){Engine.help?Engine.help.close():(Engine.help=new c,Engine.help.init())},this.clickSettings=function(){Engine.settings.toggle(),Engine.musicPanel||(Engine.musicPanel=new d,Engine.musicPanel.init())},this.clickMatchmaking=function(){Engine.matchmaking.toggle()},this.clickAchivements=function(){Engine.achievements.toggle()},this.clickNews=function(){Engine.news?Engine.news.close():_g("promotions&a=show")},this.clickBattlePass=function(){Engine.battlePass?Engine.battlePass.close():_g("battlepass&action=status")},this.clickParty=function(){Engine.party?Engine.party.toggle():message(_t("no-party",null,"party"))},this.clickMiniMap=function(){Engine.miniMapController.toggleMiniMap()},this.clickClan=function(){Engine.clan?Engine.clan.close():Engine.hero.d.clan?_g("clan&a=myclan"):_g("clan&a=list&page=1")},this.clickEventCalendar=function(){Engine.eventCalendar?Engine.eventCalendar.close():_g("calendar")},this.clickChat=function(){Engine.chatController.getChatWindow().chatToggle()},this.setChat=function(){let t=Engine.chatController.getChatWindow().getChatSize();Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.CHAT,!!t),M.removeClass("chat-size-0 chat-size-1").addClass("chat-size-"+t),Engine.onResize(),Engine.map.onResize()},this.clickSendMessageOnClanChat=function(){let t=_t("my_location %map% %x% %y%",{"%map%":Engine.map.d.name,"%x%":Engine.hero.d.x,"%y%":Engine.hero.d.y},"clan_my_location");getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(v.CHANNEL.CLAN)&&Engine.chatController.getChatInputWrapper().sendMessageGhostMessageProcedure(t,v.CHANNEL.CLAN)},this.clickWorld=function(){Engine.worldWindow.opened?Engine.worldWindow.close():Engine.worldWindow.open(E.MODULES.PLAYERS_ONLINE)},this.clickQuests=function(){Engine.quests.managePanelVisible()},this.clickSociety=function(){Engine.society?Engine.society.close():_g("friends&a=show")},this.clickSkills=function(){Engine.skills?Engine.skills.close():_g("skillshop")},this.clickPremium=function(){t.turnOnPremium()},this.clickPad=function(){Engine.padController&&Engine.padController.toggleVisible()},this.turnOnChest=function(){Engine.shop&&Engine.shop.close();var t=isPl()?436:"";if(Engine.premium)return Engine.premium.close();Engine.chests?Engine.chests.close():_g("creditshop&npc="+t)},this.turnOnPremium=function(){Engine.premium?Engine.premium.close():(Engine.premium=new r,Engine.premium.init())},this.clickRewardsCalendar=function(){Engine.rewardsCalendar?Engine.rewardsCalendar.close():_g("rewards_calendar&action=show")},this.clickMusic=function(){},this.clickConsole=function(){Engine.console.toggle()},this.clickFullScreen=function(){toggleFullScreen()},this.clickWhoIsHere=function(){Engine.whoIsHere.managePanelVisible()},this.clickPuzzle=function(){Engine.addonsPanel.manageVisible()},this.clickPhoto=function(){Engine.crafting.opened?Engine.crafting.triggerClose():Engine.crafting.triggerOpen()},this.clickDragGroundItem=function(){const{x:t,y:e}=Engine.hero.d,i=Engine.map.groundItems.getGroundItemOnPosition(t,e);i.length>0&&_g("takeitem&id="+i[0].id);const n=Engine.npcs.getRenewableNpcByPosition(t,e);n&&Engine.hero.sendRequestToTalk(n.d.id)},this.clickQuickPaty=function(){Engine.hero.addToPartyNearPlayer()},this.clickAttackNearMob=function(){Engine.hero.atackNearMob()},this.clickAttackNearPlayer=function(){Engine.hero.atackNearPlayer()},this.clickTalkNearMob=function(){Engine.dialogue||Engine.hero.talkNearMob()},this.clickShowLog=function(){if(!Engine.battle.getfirstLogsExist())return mAlert(_t("noLogs",null,"battle"));Engine.battle.toogleBattleLogs()},this.clickPortableMap=function(){Engine.miniMapController.toggleMiniMapWindow()},this.checkEqColumnIsShow=()=>"block"==y.css("display"),this.clickEqColumnShow=function(){t.checkEqColumnIsShow()?(t.showEqColumn(!1),n.set("eqcolumnsize",0)):(t.showEqColumn(!0),n.set("eqcolumnsize",1)),Engine.onResize()},this.centerObjectCoverEqColumn=t=>{if(Engine.interface.checkEqColumnIsShow()){let e=Engine.interface.get$rightColumn().outerWidth();return!(Engine.interface.get$interfaceLayer().width()>2*e+t)}return!1},this.getXPosOfObjectStickToEqColumn=t=>{let e=this.get$interfaceLayer().width(),i=e-y.outerWidth()-t+(window.innerWidth-e)/2;return i<0?0:i},this.showEqColumn=t=>{var e=t?"block":"none",i=t?[245,255]:[0,0];this.get$interfaceLayer().find(".right-column.main-column").css("display",e),this.setEqWidgetAmountShow(t),N.css("right",i[0]),$(".game-notifications").css("right",i[1]),Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.EQ_TOGGLE,t),Engine.onResize()},this.checkEqColumnShow=()=>"block"===this.get$interfaceLayer().find(".right-column.main-column").css("display"),this.setSizeEqColumnSize=function(){var e=this.getEqColumnsSizeFromStorage();null===e?t.showEqColumn(!0):0==e?t.showEqColumn(!1):t.showEqColumn(!0)},this.getEqColumnsSizeFromStorage=()=>n.get("eqcolumnsize"),this.setEqWidgetAmountShow=function(t){t?Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.EQ_TOGGLE,!0):Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.EQ_TOGGLE,!1)},this.clickAutofightNearMob=function(){Engine.hero.atackNearMob(!0)},this.clickGoGateway=function(){var t=Engine.hero;Engine.map.gateways.getOpenGtwAtPosition(Math.round(t.rx),Math.round(t.ry))&&Engine.hero.getTroughGateway()},this.decreaseZoom=function(){t.setZoomFactor(Engine.zoomFactor-.1),Engine.onResize()},this.clickDecreaseZoom=function(){if(t.tooMoreZoomOut())return mAlert(_t("cannot_Decrease"),!1,(function(t){t.$.addClass("huge-alert"),t.$.find(".small").removeClass("small")}));t.decreaseZoom()},this.clickIncreaseZoom=function(){t.setZoomFactor(Engine.zoomFactor+.1),Engine.onResize();var e=tooBigScreen(Engine.zoomFactor);if(!e)return;t.clickDecreaseZoom();let i=t.get$interfaceLayer();switch(e){case"leftUpWidgetW":return mAlert(_t("leftUpWidgetW"));case"rightUpWidgetW":return mAlert(_t("rightUpWidgetW"));case"leftDownWidgetW":var n=i.find(".bottom-left.main-buttons-container").find(".widget-button").length,a=i.find(".bottom-left-additional").find(".widget-button").length,s=getMaxWidgetIndex(i.find(".bottom-left.main-buttons-container"))+1,r=getMaxWidgetIndex(i.find(".bottom-left-additional"))+1;if(Math.max(s,r)<=Math.ceil((n+a)/2))return mAlert(_t("leftDownWidgetW"));break;case"rightDownWidgetW":n=i.find(".bottom-right.main-buttons-container").find(".widget-button").length,a=i.find(".bottom-right-additional").find(".widget-button").length,s=getMaxWidgetIndex(i.find(".bottom-right.main-buttons-container"))+1,r=getMaxWidgetIndex(i.find(".bottom-right-additional"))+1;if(Math.max(s,r)<=Math.ceil((n+a)/2))return mAlert(_t("rightDownWidgetW"));break;case"leftAddWidgetW":n=i.find(".bottom-left.main-buttons-container").find(".widget-button").length,a=i.find(".bottom-left-additional").find(".widget-button").length,s=getMaxWidgetIndex(i.find(".bottom-left.main-buttons-container"))+1,r=getMaxWidgetIndex(i.find(".bottom-left-additional"))+1;if(Math.max(s,r)<=Math.ceil((n+a)/2))return mAlert(_t("leftAddWidgetW"));break;case"rightAddWidgetW":n=i.find(".bottom-right.main-buttons-container").find(".widget-button").length,a=i.find(".bottom-right-additional").find(".widget-button").length,s=getMaxWidgetIndex(i.find(".bottom-right.main-buttons-container"))+1,r=getMaxWidgetIndex(i.find(".bottom-right-additional"))+1;if(Math.max(s,r)<=Math.ceil((n+a)/2))return mAlert(_t("rightAddWidgetW"))}mAlert(_t("change_widget_set"),[{txt:"OK",callback:function(){return Engine.widgetManager.rebuiltWidgetBarsIndex(),t.setZoomFactor(Engine.zoomFactor+.1),Engine.onResize(),!0}},{txt:_t("no"),callback:function(){return!0}}],(function(t){t.$.addClass("huge-alert"),t.$.find(".small").removeClass("small")}))},this.getTheMostIndex=function(){},this.clickToggleRightColumn=()=>{var t=this.get$interfaceLayer().find.find(".right-column.main-column");"block"==t.css("display")?(t.css("display","none"),N.css("right",0),$(".right-column-notif").css("right",0)):(t.css("display","block"),N.css("right","245px"),this.get$interfaceLayer().find(".right-column-notif").css("right",255)),Engine.onResize()},this.isAlwaysExist=function(t){return!(isset(defaultWidgetSet[t].alwaysExist)&&defaultWidgetSet[t].alwaysExist)||(mAlert("Can not override this slot"),!1)},this.tLang=function(t){return _t(t,null,"widgets-tip")},this.hideNotUseBars=function(){var t=Engine.serverStorage.get(Engine.widgetManager.getPathToHotWidgetVersion());for(var e in Engine.widgetManager.hideAdditionalWidgetBars(),t)Engine.widgetManager.manageDisplayAdditionaWidgetBarsPerPos(t[e][1])},this.sendGA=(t,e,i)=>{"dev"!==Engine.worldConfig.getWorldName()&&Engine.GA.send(t,e,i)},this.showEmptySlots=function(t){$(".main-buttons-container").find(".empty-slot-widget").css("display",t?"block":"none")},this.addStaticButtons=function(){var e=a.get("button");if(e.addClass("small green stats-expand"),e.click(this.clickMoreBtn),$(".stats-button").append(e),this.getMoreBtnText(null,e.find(".label")),isset(Engine.hero.previewAcc)&&isEn()&&P(),isPl()&&B(),t.initPvpButton(),Engine.hero.d.lvl>24){var i=_t("skillset_chng",null,"buttons"),n="skill-switch skill-set-"+Engine.hero.cur_skill_set,s=$(".skill-switch");s.attr("class",n),s.click(Engine.hero.changeSkillSet),s.tip(i,"t_static")}},this.registrationCall=function(){_g("registernoob")},this.initPvpButton=function(){var t=$(".pvp-btn");1==Engine.hero.d.pvp&&t.addClass("fight"),t.click((function(){$(this).removeClass("fight"),Engine.hero.d.pvp=Engine.hero.d.pvp?0:1,Engine.hero.d.pvp&&$(this).addClass("fight"),_g("setpvp&mode="+Engine.hero.d.pvp)}))},this.clickMoreBtn=function(){var e=t.get$interfaceLayer().find(".stats-button").find(".stats-expand");e.toggleClass("active"),t.get$interfaceLayer().find(".extended-stats").toggleClass("active").trigger("update");var i=e.find(".label");t.getMoreBtnText(null,i)},this.getMoreBtnText=function(e,i){var n=t.get$interfaceLayer().find(".stats-button").find(".stats-expand").hasClass("active")?_t("btn_stats_active"):_t("btn_stats_default");i.html(n),Engine.hotKeys.replaceshowhideStatsBtnsNames()},this.isStatsExpanded=()=>this.get$interfaceLayer().find(".extended-stats").hasClass("active"),this.shopButtons=function(){t.get$interfaceLayer().find(".gold-btn").click((function(){Engine.goldShop?Engine.goldShop.close():_g("creditshop&credits_gold=-1")})).tip(_t("gold_shop_head_info")),t.get$interfaceLayer().find(".credits-btn").click((function(){Engine.draconiteShop?Engine.draconiteShop.close():(Engine.draconiteShop=new l,Engine.draconiteShop.open())})).tip(_t("buy_sl"))},this.setStatsOverAdditionalBarPanel=function(){t.get$interfaceLayer().find(".extended-stats").trigger("update")},this.setAdditionalBarClass=function(t){t?M.addClass("additional-bar-br"):M.removeClass("additional-bar-br")},this.pvpIcon=()=>{this.get$interfaceLayer().find(".map_ball").on("click",(function(){if(Engine.worldConfig.getPvp())_g("conquer");else if(Engine.worldConfig.getWantedShow()){let t=Engine.wantedController;t?t.getWantedList().toggleVisible():_g("wanted&show=1",(function(){Engine.wantedController.getWantedList().toggleVisible()}))}}))},this.worldName=function(){let e=t.get$interfaceLayer().find(".world-name");e.html(Engine.worldConfig.getWorldName()),e.tip(_t("world_name")+": "+capitalize(Engine.worldConfig.getWorldName()))},this.checkTeleport=t=>{isset(t.t)&&"reload"==t.t&&Engine.map.showLoaderSplash()},this.setInterfaceSize=()=>{$(".tmp-chat .middle").height($(window).height()-493)},this.get$MAP_CANVAS=()=>i,this.get$GAME_CANVAS=()=>w,this.get$gameWindowPositioner=()=>M,this.get$gameLayer=()=>N,this.get$interfaceLayer=()=>k[m.$_INTERFACE_LAYER],this.get$alertsLayer=()=>k[m.$_ALERTS_LAYER],this.get$mAlertLayer=()=>k[m.$_M_ALERT_LAYER],this.get$captchaLayer=()=>k[m.$_CAPTCHA_LAYER],this.get$popUpLayer=()=>k[m.$_POP_UP_LAYER],this.get$consoleLayer=()=>k[m.$_CONSOLE_LAYER],this.get$mAlertMobileLayer=()=>k[m.$_M_ALERT_MOBILE_LAYER],this.get$loaderLayer=()=>k[m.$_LOADER_LAYER],this.get$tutorialLayer=()=>k[m.$_TUTORIAL_LAYER],this.get$stickyTipsLayer=()=>k[m.$_STICKY_TIPS_LAYER],this.get$echhLayer=()=>k[m.$_ECHH_LAYER],this.get$dropToDeleteWidgetLayer=()=>k[m.$_DROP_TO_DELETE_WIDGET_LAYER],this.get$zoomLayer=()=>k[m.$_ZOOM_LAYER];const P=()=>{const e=a.get("widget-button");e.addClass("red blink"),e.find(".icon").addClass("register-icon"),e.tip(_t("bm_register",null,"ingame_register"),"t_static"),e.find(".label").text(_t("reg_header",null,"ingame_register")),e.appendTo(t.get$interfaceLayer().find(".bm-register")),e.click((function(){t.registrationCall()}))},B=()=>{if(isSeptemberEnd())return;const e=a.get("widget-button");e.addClass("violet"),e.find(".icon").addClass("onc-icon"),e.tip("One Night Casino","t_static"),e.appendTo(t.get$interfaceLayer().find(".onc-btn")),e.click((function(){Engine.iframeWindowManager.integrationPage()}))},F=(t,e)=>{const i=Engine.interface.get$GAME_CANVAS();t?i.addClass(e):i.removeClass(e)},W=t=>{S.push(t)},H=t=>{O.push(t)},G=()=>{window.addEventListener("focus",(function(t){for(let e in S)S[e](t)}))},V=()=>{window.addEventListener("blur",(function(t){for(let e in O)O[e](t)}))};this.getInterfaceStart=()=>Engine.interfaceStart,this.setCursor=F,this.setDoActionCursor=t=>{F(t,b.CURSOR.DO_ACTION)},this.setDialogueCursor=t=>{F(t,b.CURSOR.DIALOGUE)},this.setPickUpCursor=t=>{F(t,b.CURSOR.PICK_UP)},this.addCallbackToInteraceFocusList=W,this.get$location=()=>I,this.show$mapTimer=t=>{t?(I.addClass("short"),A.addClass("show")):(I.removeClass("short"),A.removeClass("show"))},this.setTip$mapTimer=t=>{A.tip(t)},this.addClassTo$mapTimer=t=>{A.addClass(t)},this.removeClassFrom$mapTimer=t=>{A.removeClass(t)}}},function(t,e,i){var n=i(0),a=i(315);let s=i(57);t.exports=function(){var t=this,e=n.get("settings-window"),i=null,r={},o=null;this.init=function(){this.initWindow(),this.initRadioButtons("serveroption"),this.initSoundBar(),this.initNotifications(),this.initButtons(),this.initCards(),this.initHeader(),this.initScrollBar(),this.initNotifOpt(),this.attachVolumeMarkerDrag(e.find(".battle-effect-sound-wrapper"),s.TYPE.BATTLE_EFFECT),this.attachVolumeMarkerDrag(e.find(".notification-sound-wrapper"),s.TYPE.NOTIFICATION),this.attachVolumeMarkerDrag(e.find(".sraj-effect-sound-wrapper"),s.TYPE.SRAJ)},this.getBlockInput=function(){return Engine.catchChar},this.initWindow=function(){(o=Engine.windowManager.add({content:e,title:_t("settings-title",null,"opts"),nameWindow:Engine.windowsData.name.SETTINGS,widget:Engine.widgetsData.name.SETTINGS,startVH:60,cssVH:60,onclose:()=>{t.close()}})).hide()},this.initHeader=function(){var t=["settings-notification","settings-game","settings-keys","settings-notifications","settings-sounds",".edit-header-label"];o.$.find(".move-keys>h2>span").html(_t("move-header",null,"help")),o.$.find(".fight-keys>h2>span").html(_t("fight-header",null,"help")),o.$.find(".map-keys>h2>span").html(_t("clickMiniMap")),o.$.find(".social-keys>h2>span").html(_t("society")),o.$.find(".other-keys>h2>span").html(_t("tab_other",null,"auction")),o.$.find("."+t[0]+">span").html(_t(t[0])),o.$.find("."+t[1]+">span").html(_t(t[1])),o.$.find("."+t[3]+">span").html(_t(t[3])),o.$.find("."+t[4]+">span").html(_t(t[4])),o.$.find(t[5]).html(_t("settings_general"))},this.initSoundBar=()=>{let t=n.get("sound-volume-bar"),i=n.get("sound-volume-bar"),a=n.get("sound-volume-bar");t.addClass("notification-sound-wrapper"),i.addClass("battle-effect-sound-wrapper"),a.addClass("sraj-effect-sound-wrapper"),e.find(".notifications-config").find(".scroll-pane").append(t),e.find(".notifications-config").find(".scroll-pane").append(i),e.find(".notifications-config").find(".scroll-pane").append(a),t.find(".loudly-panel-txt").html(_t("sound_notification_level")),i.find(".loudly-panel-txt").html(_t("sound_battle_effect_level")),a.find(".loudly-panel-txt").html(_t("tab_other",null,"auction"))},this.initNotifications=function(){var t={0:"new-mail",1:"enemy-here",2:"friend-here",3:"elite2-here",4:"heroes-here",5:"group-loot",6:"abbys",7:"your_turn",8:"stasis-in"},e=o.$.find(".notifications-config").find(".all-notification");for(var i in t)if(!isEn()||6!=i){var a=t[i],s=_t(a,null,"sound_notif"),r=n.get("one-checkbox").addClass("sound-notif do-action-cursor "+a);r.find(".label").html(s),r.attr("data-soundnotif",i),r.click((function(){$(this).find(".checkbox").toggleClass("active")})),e.append(r)}},this.saveNotifications=function(){o.$.find(".notifications-config").find(".sound-notif").each((function(){var t=$(this).attr("data-soundnotif"),e=$(this).find(".checkbox").hasClass("active");r[t]=e}));let e={};e[getSoundNotificationPatch()]=r,Engine.serverStorage.sendData(e,(function(){t.close()}))},this.updateSoundNotification=function(){e.find("[data-soundnotif]").each((function(){t.updateNotifOption(this)}))},this.getStateSoundNotifById=function(t){return r[t]},this.initNotifOpt=function(){r={},e.find("[data-soundnotif]").each((function(){var t=$(this).data("soundnotif"),e=Engine.serverStorage.get(getSoundNotificationPatch(),t);null==e&&(e=!1),r[t]=e}))},this.createBtn=function(t,e,i){var a=n.get("button");return a.addClass("green small"),a.find(".label").html(t),a.click(i),e.append(a),a},this.initButtons=function(){var e=o.$.find(".options-config-buttons"),i=o.$.find(".hot-keys-config-buttons"),n=o.$.find(".notifications-config-buttons"),a=_t("defaultWidgets",null,"opts"),s=_t("opt_save",null,"opts"),r=_t("reset",null,"opts"),l=_t("old_client");let c=this.getTutorialLabel();isPl()&&this.createBtn(l,e,t.changeInterface).addClass("change-interface-btn");this.createBtn(c,e,t.manageTutorial).addClass("manage-tutorial-btn"),this.createBtn(s,e,t.saveAndClose),this.createBtn(r,i,t.reset),this.createBtn(s,n,t.saveNotifications),this.createBtn(a,i,(function(){Engine.widgetManager.resetWidgetButtons()}))},this.manageTutorial=()=>{Engine.tutorialValue<0?_g("tutorial&opt=0",(function(){location.reload()})):_g("tutorial&opt=-1")},this.setLabelOfTutorialBtn=()=>{$(".manage-tutorial-btn>.label").html(this.getTutorialLabel())},this.getTutorialLabel=()=>{let t=Engine.tutorialValue<0?"turn_on":"turn_off";return _t(t,null,"new_tutorials")},this.changeInterface=function(){var t=new Date;t.setTime(t.getTime()+2592e6),setCookie("interface","si",t,"/","margonem.pl"),window.location.reload()},this.initScrollBar=function(){e.find(".hero-options-config>.scroll-wrapper").addScrollBar({track:!0}),e.find(".hot-keys-config>.scroll-wrapper").addScrollBar({track:!0}),e.find(".notifications-config>.scroll-wrapper").addScrollBar({track:!0})},this.updateScroll=function(){$(".scroll-wrapper",e).trigger("update")},this.reset=function(){mAlert(_t("sure_reset_hotkeys"),[{txt:_t("yes"),callback:function(){return Engine.hotKeys.resetHotKeys((function(){t.updateHotKeys()})),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.initRadioButtons=function(i){e.find("[data-"+i+"]").each((function(){var t=$(this).data(i),e=_t("opt_"+t,null,"opts");$(this).find("span.label").html(e)})).click((function(){t["toggle"+i]($(this).data(i))})),isPl()||e.find("[data-17]").css("display","none")},this.initCards=function(){var t=o.$.find(".cards-header"),e=_t("settings_general"),i=_t("settings_controlls"),n=_t("settings_notifications");this.newCard(t,e,(function(){Engine.widgetManager.setEditableWidget(!1)})),this.newCard(t,i,(function(){Engine.widgetManager.setEditableWidget(!0)})),this.newCard(t,n,(function(){Engine.widgetManager.setEditableWidget(!1)})),this.setFirstCard()},this.setFirstCard=function(){o.$.find(".section").eq(0).addClass("visible"),o.$.find(".card").eq(0).addClass("active"),this.updateScroll()},this.toggleserveroption=function(t){var n=e.find('[data-serveroption="'+t+'"]').find(".checkbox");(i^=1<<t-1)&1<<t-1?n.addClass("active"):n.removeClass("active")},this.updateSingleserveroption=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;var n=$(t).data("serveroption"),a=$(t).find(".checkbox"),s=(e&1<<n-1)>0;s?a.addClass("active"):a.removeClass("active")},this.updateNotifOption=function(t){var e=$(t).data("soundnotif"),i=$(t).find(".checkbox");r[e]?i.addClass("active"):i.removeClass("active")},this.updateOptions=function(n){i=Engine.hero.d.opt,e.find("[data-"+n+"]").each((function(){t["updateSingle"+n](this)}))},this.changeSingleOptionsAndSave=t=>{let e=getEngine().hero.d.opt;e^=1<<t-1,_g("config&opt="+e),getEngine().hero.d.opt=e},this.center=function(){o.center()},this.saveAndClose=function(){t.saveOptions(),t.close()},this.saveOptions=function(){this.saveServOpt();var t=Engine.opt(19);Engine.map.setAnimated(t),Engine.banners.showOrHideBanners(),Engine.nightController.rebuiltAfterSettingsSave(),Engine.battle.warriors.rebuildAnimateWarrior()},this.saveServOpt=function(){$(".highlight"),$(".canvas-icon"),$(".canvas-warrior"),$(".css-icon"),$(".css-warrior");_g("config&opt="+i),Engine.hero.d.opt=i,Engine.setAllObjectsAnimationState(Engine.opt(8)),Engine.interface.setCSSAnimations(),Engine.interface.setItemsHighlights()},this.open=function(){o.addToAlertLayer(),o.show(),o.setWndOnPeak(!0),Engine.lock.add("settings"),this.center(),this.updateSoundSliderPos(e.find(".music-manager .volumeSlider .marker"),s.TYPE.MUSIC),this.updateSoundSliderPos(e.find(".battle-effect-sound-wrapper .volumeSlider .marker"),s.TYPE.BATTLE_EFFECT),this.updateSoundSliderPos(e.find(".notification-sound-wrapper .volumeSlider .marker"),s.TYPE.NOTIFICATION),this.updateSoundSliderPos(e.find(".sraj-effect-sound-wrapper .volumeSlider .marker"),s.TYPE.SRAJ),this.updateOptions("serveroption"),this.updateSoundNotification(),this.updateHotKeys(),t.setVisible(0),this.updateScroll()},this.updateHotKeys=function(){o.$.find(".hot-keys-list").empty();for(var t=Engine.hotKeys.getSortedHotKeys(),e=0;e<t.length;e++){var i=t[e],n=i[0],a=i[1],s=i[2],r=isset(i[3])?i[3]:"other";this.createOneHotKey(a,n,s,r)}},this.createOneHotKey=function(t,e,i,n){var a=this.createEditKeyCodeBtn(t,e),s=_t(t),r=this.createDraggableIcon(i),l=this.createRecords([r,s,e?e.toUpperCase():_t("none"),a],"");o.$.find("."+n+"-keys").find("table").append(l)},this.createDraggableIcon=function(t){if(!t)return $("<div>").html("-");var e=n.get("widget-button").addClass("from-settings-panel green no-hover");return getEngine().widgetManager.set$BtnWidgetSize(e),e.find(".icon").addClass(t),getEngine().widgetManager.addDraggableAndDataAndTip(e,_t("drag_and_drop_widget"),Engine.widgetsData.data.WIDGET_KEY,t),e},this.createEditKeyCodeBtn=function(e,i){var a=n.get("button").addClass("small green");return a.append(n.get("add-bck").addClass("edit")),a.tip(_t("edit_hotkey_char")),a.click((function(n){n.stopPropagation(),t.createMAlert(e,i)})),a},this.createMAlert=function(t,e){Engine.catchChar||(Engine.catchChar=new a(t,e),Engine.catchChar.init())},this.sendNewValue=function(t,e,i){Engine.hotKeys.changeKey(e,t,i)},this.canSendNewValue=(t,e,i)=>e==t||Engine.hotKeys.canChangeKey(i,t),this.close=function(){Engine.lock.remove("settings"),o.detachFromLayer(),Engine.widgetManager.setEditableWidget(!1)},this.toggle=function(){o.isShow()?this.close():this.open()},this.newCard=function(i,a,s){var r=n.get("card");r.find(".label").html(a),i.append(r),r.click((function(){var i=$(this).index();t.setVisible(i),t.updateScroll(),e.find(".edit-header-label").html(a),s&&s()}))},this.setVisible=function(t){var e=o.$.find(".card").removeClass("active"),i=o.$.find(".bottom-bar"),n=o.$.find(".section").removeClass("visible");e.eq(t).addClass("active"),n.eq(t).addClass("visible"),i.children().css("display","none"),i.children().eq(t).css("display","block"),t},this.createRecords=function(t,e){for(var i=$("<tr>"),n=0;n<t.length;n++){var a=$("<td>").html(t[n]);"object"==typeof e?a.addClass(e[n]):a.addClass(e),i.append(a)}return i},this.attachVolumeMarkerDrag=function(t,e){let i=t.find(".volumeSlider .marker");i.draggable({axis:"x",stop:function(){var t=Math.abs(parseInt(i.css("left"))/.85);Engine.soundManager.setVolumeWithSaveInServerStorage(t,e)},drag:function(t,n){var a=Math.abs(parseInt(i.css("left"))/.85);Engine.soundManager.setVolumeWithoutSaveInServerStorage(a,e);var s=n.helper.parent().width()-22;n.position.left<0&&(n.position.left=0),n.position.left>s&&(n.position.left=s)}});var a=n.get("button").addClass("small green");a.find(".label").html("Test"),t.find(".loudly-panel-buttons").append(a).addClass("test-sound"),a.click(()=>{if(Engine.soundManager.checkAvailableSoundType(e))switch(e){case s.TYPE.NOTIFICATION:Engine.soundManager.createNotifSound(6);break;case s.TYPE.BATTLE_EFFECT:Engine.soundManager.createBattleEffectSound(-1);break;case s.TYPE.SRAJ:let t={sound:{list:[{id:-99999,action:"CREATE",url:"owacje_VOLUME_TEST_DONT_REMOVE.mp3"}]}};Engine.rajController.parseObject(t)}})},this.updateSoundSliderPos=function(t,e){let i=.85*Engine.soundManager.getDataSettingVolume(e);t.css("left",i)},this.getContent=()=>e;this.checkTurnOnWeatherAndEventEffects=()=>!Engine.opt(16)}},function(t,e,i){var n=i(0);t.exports=function(t,e){var i=this;this.init=function(){i.initWindow(),i.initHeader(),i.initKeyDown(),i.createCancelButton(),i.createEmptyButton(),i.wnd.center()},this.initWindow=function(){Engine.windowManager.add({content:n.get("catch-char"),title:_t("catch-char"),nameWindow:Engine.windowsData.name.CATCH_CHAR,objParent:i,nameRefInParent:"wnd",onclose:()=>{$(document).off("keydown",i.keyDown),i.close()}}),i.wnd.addToAlertLayer()},this.initHeader=function(){this.wnd.$.find(".give-char").html(_t("new-char"))},this.initKeyDown=function(){$(document).on("keydown",i.keyDown)},this.createCancelButton=function(){var t=n.get("button").addClass("green small");t.find(".label").html(_t("cancel")),t.click((function(){$(document).off("keydown",i.keyDown),i.close()})),this.wnd.$.find(".cancel-char").append(t)},this.createEmptyButton=function(){var a=n.get("button").addClass("green small");a.find(".label").html(_t("none")),a.click((function(){$(document).off("keydown",i.keyDown),Engine.settings.canSendNewValue("",e,t)?Engine.settings.sendNewValue(!1,t,(function(){Engine.settings.updateHotKeys(),i.close()})):i.close()})),this.wnd.$.find(".cancel-char").append(a)},this.overrideAlert=e=>{let n=_t(Engine.hotKeys.hotKeys[e]),a=_t("overrideHotKey",{"%key%":e,"%old%":n});confirmWithTwoCallback({msg:a,clb1:()=>{i.saveKeyToServerStorage(e,t)},clb2:()=>{i.close()}})},this.keyDown=function(n){const a=correctKey(n.key);if(n.preventDefault(),$(document).off("keydown",i.keyDown),Engine.settings.canSendNewValue(a,e,t))return i.checkKeyIsAlreadyUse(a)?(Engine.catchChar=!1,void i.overrideAlert(a)):void i.saveKeyToServerStorage(a,t);i.close()},this.saveKeyToServerStorage=(t,e)=>{Engine.settings.sendNewValue(t,e,(function(){Engine.settings.updateHotKeys(),i.close()}))},this.checkKeyIsAlreadyUse=t=>!!Engine.hotKeys.hotKeys[t],this.close=function(){Engine.catchChar=!1,i.wnd.remove()}}},function(t,e,i){const n=i(114).default,a=i(0),s=i(110),r=i(18),o=i(55);t.exports=function(){var t=this;let e,l,c,d,h,u=[],p=!1,g=!0,f=!1;this.init=()=>{this.initContent(),this.initDataBanners(),this.initButtons(),this.updatePossibleBanners(),this.initHover()},this.update=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&(g=!0),h&&clearTimeout(h),h=setTimeout(()=>{t.updatePossibleBanners(),clearTimeout(h)},1e3)},this.updatePossibleBanners=()=>{this.createTable()&&(this.clearBanners(),this.initFirstBanner(),this.initBanners())},this.startInterval=()=>{d&&clearInterval(d),d=setInterval(()=>{this.rightBtnClick()},6e5)},this.clearBanners=()=>{l.find(".picture").remove()},this.showOrHideBanners=()=>{Engine.opt(17)?l.addClass("nodisp"):l.removeClass("nodisp")},this.createTable=()=>{if(!g&&f===this.isSmall())return!1;f=this.isSmall(),u=[],g=!1;for(const t in c)isset(c[t])&&c[t]&&(!isset(c[t].lvl)||isset(c[t].lvl)&&Engine.hero.d.lvl>=c[t].lvl[0]&&Engine.hero.d.lvl<=c[t].lvl[1])&&u.push(t);return!0},this.initContent=()=>{l=a.get("b_wrapper"),Engine.interface.get$interfaceLayer().find(".right-column").find(".inner-wrapper .bottom-wrapper").append(l)},this.initHover=()=>{const t=l.find(".left, .right");l.find(".all-b, .left,.right").hover(()=>{t.css("display","inline-block")},()=>{t.css("display","none")})},this.initBanners=()=>{const t=u.length;if(t<=0)return;l.find(".all-b").width(240*t),this.startInterval();const i=this.getValueOfBanner(e-1),n=this.getValueOfBanner(e+1),a=[u[i],u[e],u[n]];for(let t=0;t<3;t++){const e=a[t],i=this.createBanner(e,c[e].btn,c[e].clb);this.addBannerToWrapper(i)}},this.getValueOfBanner=t=>{const e=u.length-1;return t<0?e+t+1:t>e?t-e-1:t},this.addBannerToWrapper=t=>{l.find(".all-b").append(t)},this.isSmall=()=>Engine.interface.get$InterfaceLayerHeight()<880,this.createBanner=(t,e,i)=>{const n=f?"s":"b",s=`url(../img/gui/banners/${_l()}/${t}${n}.png?v=${__build.version})`,r=a.get("one-baner");if(r.css("background",s),r.addClass("picture "+n),!e)return r;const o=this.createButtonsToBanner(i,e);return r.append(o),r},this.createButtonsToBanner=(t,e)=>{let i=$("<div />",{class:"btns-wrapper"});if(Array.isArray(e)){for(let t=0;t<e.length;t++)i.append(this.createBtnToBanner(e[t].clb,e[t].title));i.children().length>1&&i.addClass("many")}else i.append(this.createBtnToBanner(t,e));return i},this.createBtnToBanner=(t,e)=>{const i=a.get("button").addClass("purple small");return i.find(".label").text(e),i.click(t),i},this.buyDraconite=()=>{Engine.draconiteShop?Engine.draconiteShop.close():(Engine.draconiteShop=new r,Engine.draconiteShop.open())},this.showPremium=()=>{Engine.premium?Engine.premium.close():(Engine.premium=new o,Engine.premium.init())},this.openPremiumShop=t=>{Engine.shop?Engine.shop.hide():_g("creditshop&npc="+t)},this.openStaminaShop=()=>{Engine.staminaShop?Engine.staminaShop.hide():(Engine.staminaShop=new s,Engine.staminaShop.init())},this.openLink=t=>{window.open(t,"_blank").opener=null},this.initFirstBanner=()=>{const t=u.length-1;e=Math.round(Math.random()*(t-0)+0)},this.initButtons=()=>{const t=l.find(".left"),e=l.find(".right");t.click(this.leftBtnClick),e.click(this.rightBtnClick)},this.leftBtnClick=()=>{if(p)return;p=!0,e>0?e--:e=u.length-1;const t=u[this.getValueOfBanner(e-1)],i=c[t],a=this.createBanner(t,i.btn,i.clb);l.find(".all-b").prepend(a);const s=l.find(".all-b"),r=()=>{s.children().last().remove(),p=!1};Engine.opt(8)?r():n.fromTo(".all-b",{translateX:-476},{translateX:-238},{duration:500,easing:"easingCubicOut",onComplete:r}).start()},this.rightBtnClick=()=>{if(p)return;p=!0;const t=u.length-1;e<t?e++:e=0;const i=u[this.getValueOfBanner(e+1)],a=c[i],s=this.createBanner(i,a.btn,a.clb);this.addBannerToWrapper(s);const r=l.find(".all-b"),o=()=>{r.children().first().remove(),r.css("transform","translateX(-238px)"),p=!1};Engine.opt(8)?o():n.fromTo(".all-b",{translateX:-238},{translateX:-476},{duration:500,easing:"easingCubicOut",onComplete:o}).start(),this.startInterval()},this.getNow=()=>e,this.onResize=()=>{this.update()},this.initDataBanners=()=>{const{BannersDataPl:t}=i(317),{BannersDataEn:e}=i(318);c=isPl()?t:e}}},function(t,e,i){"use strict";i.r(e),i.d(e,"BannersDataPl",(function(){return n}));const n={1:{lvl:[30,700],btn:[{title:_t("check"),clb:()=>Engine.banners.openPremiumShop(295)}]},2:{lvl:[20,150],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://pomoc.margonem.pl/index/view,3#k18")}]},3:{lvl:[40,500]},4:{lvl:[20,240],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514156")}]},5:{lvl:[1,100],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?show=posts&id=213291")}]},6:{lvl:[20,500],btn:[{title:_t("check"),clb:Engine.banners.showPremium}]},7:{lvl:[10,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=512809")}]},8:{lvl:[1,150],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=96295&ps=24#post45458291")}]},9:{lvl:[20,500]},10:{lvl:[35,280],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=492294")}]},12:{lvl:[30,500]},13:{lvl:[20,100],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://www.margonem.pl/config#bezpieczenstwo")}]},14:{lvl:[50,200],btn:[{title:_t("check"),clb:Engine.banners.buyDraconite}]},15:{lvl:[40,100]},16:{lvl:[20,150]},17:{lvl:[20,80]},18:{lvl:[40,150]},20:{lvl:[50,200]},21:{lvl:[20,500]},22:{lvl:[20,500],btn:[{title:_t("check"),clb:Engine.banners.buyDraconite}]},24:{lvl:[20,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openPremiumShop(293)}]},25:{lvl:[20,500]},26:{lvl:[25,100]},27:{lvl:[50,500]},28:{lvl:[50,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openStaminaShop()}]},29:{lvl:[10,200],btn:[{title:_t("check"),clb:()=>Engine.hero.getOutfits()}]},30:!1,31:{lvl:[1,150]},32:{lvl:[1,150]},33:!1,34:{lvl:[1,500]},35:{lvl:[20,500]},36:{lvl:[10,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openPremiumShop(304)}]},37:{lvl:[25,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openPremiumShop(436)}]},38:{lvl:[20,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=477958")}]},39:{lvl:[1,100],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=topics&id=21?task=forum&show=topics&id=21")}]},40:{lvl:[10,150]},41:{lvl:[1,100]},42:{lvl:[25,500]},43:{lvl:[20,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740")}]},44:{lvl:[45,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733")}]},45:{lvl:[30,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732")}]},46:{lvl:[10,200],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514832")}]},47:{lvl:[10,200],btn:[{title:_t("check"),clb:()=>{Engine.crafting.opened?Engine.crafting.close():Engine.crafting.open("enhancement")}}]},49:!1,50:!1,51:!1,52:!1,53:!1,54:!1,55:{lvl:[23,49],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724286")}]},56:{lvl:[50,76],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724287")}]},57:{lvl:[77,103],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724288")}]},58:{lvl:[104,130],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724289")}]},59:{lvl:[131,157],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724291")}]},60:{lvl:[158,184],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724292")}]},61:{lvl:[185,211],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724293")}]},62:{lvl:[212,238],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724295")}]},63:{lvl:[239,265],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724296")}]},64:{lvl:[266,300],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514732&ps=0#post45724298")}]},65:{lvl:[38,64],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339172")}]},66:{lvl:[57,83],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339173")}]},67:{lvl:[88,114],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339174")}]},68:{lvl:[118,144],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339181")}]},69:{lvl:[141,167],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339182")}]},70:{lvl:[164,190],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339183")}]},71:{lvl:[191,217],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339184")}]},72:{lvl:[218,244],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339185")}]},73:{lvl:[245,271],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339186")}]},74:{lvl:[287,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339188")}]},75:{lvl:[15,34],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727513")}]},76:{lvl:[20,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727515")}]},77:{lvl:[30,48],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727517")}]},78:{lvl:[35,58],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727518")}]},79:{lvl:[40,63],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727519")}]},80:{lvl:[50,76],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727520")}]},81:{lvl:[70,98],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727522")}]},82:{lvl:[60,87],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727521")}]},83:{lvl:[80,115],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727524")}]},84:{lvl:[105,129],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727525")}]},85:{lvl:[110,136],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727526")}]},86:{lvl:[115,142],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727527")}]},87:{lvl:[130,157],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727528")}]},88:{lvl:[142,170],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727529")}]},89:{lvl:[155,178],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727530")}]},90:{lvl:[170,197],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727531")}]},91:{lvl:[180,210],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727532")}]},92:{lvl:[190,223],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727533")}]},93:{lvl:[210,240],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727534")}]},94:{lvl:[230,255],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727535")}]},95:{lvl:[240,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727537")}]},96:{lvl:[255,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727540")}]},97:{lvl:[265,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post46104324")}]},102:{lvl:[30,500]},103:{lvl:[1,500]},104:{lvl:[50,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://pomoc.margonem.pl/index/view,3#k17")}]},105:{lvl:[30,500],btn:[{title:_t("check"),clb:Engine.banners.buyDraconite}]},106:{lvl:[30,250]},107:{lvl:[50,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://www.youtube.com/watch?v=E4m-GE2ky-s")}]},108:{lvl:[10,500]},109:{lvl:[30,70],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=512330&ps=0#post44925414")}]},110:{lvl:[210,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=512330&ps=0#post44925420")}]},111:{lvl:[10,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=487925")}]},112:{lvl:[100,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=512330&ps=0#post44925416")}]},113:{lvl:[10,500]},114:!1,115:!1,116:!1,117:!1,118:!1,119:{lvl:[20,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=509273")}]},120:{lvl:[30,500]},121:{lvl:[25,500]},122:{lvl:[25,250],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=511370")}]},123:{lvl:[25,150]},124:{lvl:[15,300]},125:{lvl:[25,300],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514286&ps=0#post45562629")}]},126:{lvl:[10,300]},127:{lvl:[10,300],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=512406&ps=0#post44951291")}]},128:{lvl:[272,500],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514733&ps=0#post46339187")}]},129:{lvl:[75,107],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.pl/?task=forum&show=posts&id=514740&ps=0#post45727523")}]}}},function(t,e,i){"use strict";i.r(e),i.d(e,"BannersDataEn",(function(){return n}));const n={1:{lvl:[30,700],btn:[{title:_t("premium_shop"),clb:()=>Engine.banners.openPremiumShop(165)}]},2:{lvl:[20,150]},3:{lvl:[40,500]},4:{lvl:[20,240],btn:[{title:_t("check"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/subcat/view,10")}]},5:{lvl:[10,100],btn:[{title:_t("try_it_out"),clb:()=>Engine.banners.openLink("https://margonem.com/art/view,2")}]},6:{lvl:[20,500],btn:[{title:_t("get_draconite"),clb:()=>Engine.banners.openLink("https://margonem.com/draconite")}]},7:{lvl:[10,500],btn:[{title:_t("buy_gold"),clb:()=>{Engine.goldShop?Engine.goldShop.hide():_g("creditshop&credits_gold=-1")}}]},8:{lvl:[10,150],btn:[{title:_t("try_it_out"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/topic/view,2151,1")}]},9:{lvl:[20,500]},10:{lvl:[35,280]},12:{lvl:[30,500]},13:{lvl:[20,100]},14:!1,15:{lvl:[40,100]},16:{lvl:[20,150]},17:{lvl:[20,80]},18:{lvl:[40,150]},20:{lvl:[50,200]},21:!1,22:!1,24:{lvl:[20,500],btn:[{title:_t("premium_shop"),clb:()=>Engine.banners.openPremiumShop(166)}]},25:{lvl:[20,500]},26:{lvl:[25,100]},27:!1,28:{lvl:[50,500]},29:{lvl:[10,200],btn:[{title:_t("try_it_out"),clb:()=>Engine.hero.getOutfits()}]},30:!1,31:{lvl:[10,150]},32:{lvl:[10,150]},33:!1,34:{lvl:[10,500]},35:{lvl:[20,500]},36:{lvl:[10,500]},37:{lvl:[25,500]},38:{lvl:[20,500]},39:!1,40:{lvl:[10,150]},41:{lvl:[10,100]},42:{lvl:[25,500]},43:{lvl:[20,500]},44:{lvl:[45,500]},45:{lvl:[30,500]},46:{lvl:[10,200]},47:{lvl:[10,200],btn:[{title:_t("try_it_out"),clb:()=>{Engine.crafting.opened?Engine.crafting.close():Engine.crafting.open("enhancement")}}]},49:{lvl:[10,300],btn:[{title:_t("visit_steam"),clb:()=>Engine.banners.openLink("https://store.steampowered.com/app/898590/Margonem/")}]},50:{lvl:[10,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/topic/view,2626,1")}]},51:{lvl:[10,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/subcat/view,10")}]},52:{lvl:[10,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/topic/view,2526,1")}]},53:{lvl:[10,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/subcat/view,13")}]},54:{lvl:[10,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/subcat/view,16")}]},55:{lvl:[23,49],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27731")}]},56:{lvl:[50,76],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27732")}]},57:{lvl:[77,103],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27733")}]},58:{lvl:[104,130],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27734")}]},59:{lvl:[131,157],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27735")}]},60:{lvl:[158,184],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27736")}]},61:{lvl:[185,211],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27737")}]},62:{lvl:[212,238],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27738")}]},63:{lvl:[239,265],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27739")}]},64:{lvl:[266,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27740")}]},65:{lvl:[38,64],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27690")}]},66:{lvl:[57,83],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27691")}]},67:{lvl:[88,114],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27692")}]},68:{lvl:[118,144],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27694")}]},69:{lvl:[141,167],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27695")}]},70:{lvl:[164,190],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27696")}]},71:{lvl:[191,217],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27697")}]},72:{lvl:[218,244],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27698")}]},73:{lvl:[245,271],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27699")}]},74:{lvl:[287,300],btn:[{title:_t("visit_forum")}]},75:{lvl:[15,34],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27776")}]},76:{lvl:[20,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27777")}]},77:{lvl:[30,48],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27778")}]},78:{lvl:[35,58],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27781")}]},79:{lvl:[40,63],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27782")}]},80:{lvl:[50,76],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27783")}]},81:{lvl:[60,87],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27784")}]},82:{lvl:[70,98],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27785")}]},83:{lvl:[90,113],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27786")}]},84:{lvl:[105,129],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27787")}]},85:{lvl:[110,136],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27788")}]},86:{lvl:[115,142],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27789")}]},87:{lvl:[130,157],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27790")}]},88:{lvl:[142,170],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27791")}]},89:{lvl:[155,178],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27792")}]},90:{lvl:[170,197],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27793")}]},91:{lvl:[180,210],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27794")}]},92:{lvl:[190,223],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27795")}]},93:{lvl:[210,240],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27797")}]},94:{lvl:[230,255],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27798")}]},95:{lvl:[240,500],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27799")}]},96:{lvl:[255,500],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27800")}]},97:{lvl:[265,500],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27801")}]},98:{lvl:[35,53],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27779")}]},99:{lvl:[40,58],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27780")}]},100:{lvl:[200,223],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27796")}]},101:{lvl:[260,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27802")}]},102:{lvl:[30,300]},103:{lvl:[10,300]},104:{lvl:[50,300]},105:!1,106:{lvl:[30,250]},107:!1,108:!1,109:{lvl:[30,70]},110:{lvl:[210,300]},111:!1,112:{lvl:[100,300]},113:{lvl:[10,300]},114:{lvl:[25,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27759")}]},115:{lvl:[25,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27759")}]},116:{lvl:[50,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27757")}]},117:{lvl:[266,300],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27755")}]},118:{lvl:[103,129],btn:[{title:_t("visit_forum"),clb:()=>Engine.banners.openLink("https://forum.margonem.com/post/view,27693")}]},119:!1,120:{lvl:[30,300]},121:!1,122:{lvl:[25,250]},123:{lvl:[25,150]},124:{lvl:[15,300]},125:{lvl:[25,300]},126:{lvl:[10,300]},127:!1}},function(t,e,i){var n=i(0);let a=i(14);t.exports=function(){var t,e=this,i=null;this.$profsanditems=null,this.$environment=null,this.$premium=null,this.$moveandfight=null,this.init=function(){this.initWindow(),this.initCards(),this.initItemClArray(),this.initClasses(),this.initMoveAndFight(),this.initProfsAndItems(),this.initScrollBar(),this.setContent("move-and-fight"),this.wnd.center()},this.initItemClArray=function(){i=[e.eqClLang("soulbound2"),e.eqClLang("cl_onehanded"),e.eqClLang("cl_twohanded"),e.eqClLang("cl_bastard"),e.eqClLang("cl_distance"),e.eqClLang("cl_helpers"),e.eqClLang("cl_wands"),e.eqClLang("cl_staffs"),e.eqClLang("cl_armor"),e.eqClLang("cl_helmets"),e.eqClLang("cl_boots"),e.eqClLang("cl_gloves"),e.eqClLang("cl_rings"),e.eqClLang("cl_neclaces"),e.eqClLang("cl_shield"),e.eqClLang("cl_neutral"),e.eqClLang("cl_usable"),e.eqClLang("cl_gold"),e.eqClLang("cl_keys"),e.eqClLang("cl_quests"),e.eqClLang("cl_renewable"),e.eqClLang("cl_arrows"),e.eqClLang("cl_talisman")]},this.initClasses=function(){this.$profsanditems=n.get("help-profs-and-items"),this.$environment=n.get("help-environment"),this.$premium=n.get("help-premium"),this.$moveandfight=n.get("help-move-and-fight")},this.initWindow=function(){t=n.get("help-window2"),Engine.windowManager.add({content:t,title:_t("help_window_title",null,"help"),nameWindow:Engine.windowsData.name.HELP_WINDOW,widget:Engine.widgetsData.name.HELP,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.close()}}),this.wnd.show(),this.wnd.addToAlertLayer()},this.initScrollBar=function(){$(".scroll-wrapper",t).addScrollBar({track:!0})},this.updateScroll=function(){$(".scroll-wrapper",t).trigger("update")},this.initCards=function(){var i=t.find(".card");i.each((function(){var n=$(this).attr("data-card");$(this).find(".label").html(_t(n,null,"help")),$(this).click((function(){i.removeClass("active"),$(this).addClass("active"),t.find(".edit-header-label").html(_t(n,null,"help")),e.setContent(n),$(".scroll-wrapper",t).trigger("scrollTop")}))}))},this.setContent=function(i){var n=t.find(".scroll-pane");n.children().length>1&&n.children().eq(1).detach();var a=i.replace(/-/gi,"");n.append(e["$"+a]),e.updateScroll()},this.initMoveAndFight=function(){e.createBoxesWithImg("fight",["turn","quick","pvp"],".kind-fight"),e.createBoxesWithImg("move",["basic","advance"],".move-in-fight")},this.initProfsAndItems=function(){e.createAllProfs(),e.createClItems(),e.createTypeItems()},this.createAllKindsOfFight=function(){for(var t=["turn","quick","pvp"],i=0;i<t.length;i++){var a=t[i],s=n.get("help-one-move");s.find(".title").html(_t("fight-"+a+"-name",null,"help")+":"),s.find(".symbol").addClass("symbol-"+a),s.find(".text").html(_t("fight-"+a+"-description",null,"help")),e.$moveandfight.find(".kind-fight").append(s)}},this.createBoxesWithImg=function(t,i,a){for(var s=0;s<i.length;s++){var r=i[s],o=n.get("help-box-with-img");o.find(".title").html(_t(t+"-"+r+"-name",null,"help")+":"),o.find(".symbol").addClass("symbol-"+r),o.find(".text").html(_t(t+"-"+r+"-description",null,"help")),e.$moveandfight.find(a).append(o)}},this.createAllProfs=function(t){for(var i=[a.TRACKER,a.PALADIN,a.HUNTER,a.BLADE_DANCER,a.WARRIOR,a.MAGE],s={pl:"http://pomoc.margonem.pl/index/view,342#",en:"http://help.margonem.com/index/view,342#"},r=0;r<i.length;r++){var o=i[r],l=n.get("help-one-prof");l.find(".symbol").addClass(o),l.find(".name").html(getAllProfName(o)),l.find(".avatar").addClass("avatar-"+o),l.find(".text").html(_t("prof-desription-"+o,null,"help")),l.find(".link").html(_t("more-link",null,"help")).attr("href",s[_l()]+o),e.$profsanditems.find(".profs-content").append(l)}},this.createClItems=function(){e.createOneCl(-1,e.eqClLang("unsoulbound")),e.createOneCl(-2,e.eqClLang("permbound"));for(var t=0;t<23;t++)e.createOneCl(t,i[t]);e.createOneCl(26,e.eqClLang("cl_improve")),e.createOneCl(27,e.eqClLang("cl_recipes"))},this.createOneCl=function(t,i){var a=n.get("help-one-cl-item");a.find(".icon").addClass(" icon-"+t),a.find(".text").html(i),e.$profsanditems.find(".column-1>.column-content").append(a)},this.createTypeItems=function(){for(var t=["normal-help","unique-help","heroic-help","legend-help","upgrade-help"],i=0;i<5;i++){var a=n.get("help-one-cl-item");a.find(".icon").addClass(t[i]),a.find(".text").html(_t(t[i],null,"help")),e.$profsanditems.find(".column-2>.column-content").append(a)}},this.eqClLang=function(t){return _t(t,null,"eq_cl")},this.close=function(){e.wnd.remove(),Engine.help=null}}},function(t,e,i){var n=i(0);let a=i(57);t.exports=function(){var t,e=this;this.init=function(){this.initMusicManager(),this.initButtons(),this.attachVolumeMarkerDrag(),this.initSliderPos()},this.initMusicManager=function(){this.$musicManager=n.get("music-manager"),Engine.interface.get$gameWindowPositioner().find(".settings-window").find(".music-manager-wrapper").append(this.$musicManager)},this.initButtons=function(){let t=Engine.soundManager.getDataSettingQuality(),i=Engine.soundManager.getDataSettingShuffle(),n=Engine.soundManager.getDataSettingPlay();var s=e.$musicManager,r=s.find(".quality-wrapper"),o=s.find(".list-wrapper"),l=s.find(".divide-wrapper");this.createToggleBtn(["HQ","LQ"],r,t==a.QUALITY.HQ?1:0,e.hdOption),this.createToogleBckBut(o,1==i?1:0,["random","queue"],e.random),this.createToogleBckBut(l,1==n?1:0,["play","pause"],e.musicPlayToggle)},this.createToogleBckBut=function(t,e,i,a){var s=n.get("button").addClass("green small");s.append($("<div>").addClass("add-bck")),s.find(".add-bck").addClass(i[e]),s.find(".label").html("0").css("visibility","hidden"),s.tip(_t("music_"+i[e])),s.click((function(){var t=(e=!e)?1:0;s.find(".add-bck").removeClass(i.join(" ")),s.find(".add-bck").addClass(i[t]),s.tip(_t("music_"+i[t])),a(t)})),t.append(s)},this.musicPlayToggle=function(t){
//!bool ? Engine.soundManager.checkStop() : Engine.soundManager.checkStart();
Engine.soundManager.musicPlayToggle()},this.createToggleBtn=function(t,e,i,a){var s=n.get("button").addClass("green small"),r=i;s.find(".label").html(t[i]),s.tip(_t("music_"+t[i].toLowerCase())),s.click((function(){var e=(r=!r)?1:0;s.find(".label").html(t[e]),s.tip(_t("music_"+t[e].toLowerCase())),a()})),e.append(s)},this.attachVolumeMarkerDrag=function(){var t=Engine.soundManager,i=e.$musicManager.find(".volumeSlider .marker");i.draggable({axis:"x",stop:function(){var e=Math.abs(parseInt(i.css("left"))/.85);t.setVolumeWithSaveInServerStorage(e,a.TYPE.MUSIC)},drag:function(e,n){var s=Math.abs(parseInt(i.css("left"))/.85);t.setVolumeWithoutSaveInServerStorage(s,a.TYPE.MUSIC);var r=n.helper.parent().width()-22;n.position.left<0&&(n.position.left=0),n.position.left>r&&(n.position.left=r)}})},this.initSliderPos=function(){var t=.85*Engine.soundManager.getDataSettingVolume(a.TYPE.MUSIC);e.$musicManager.find(".volumeSlider .marker").css("left",t)},this.random=function(){Engine.soundManager.toggleShuffle()},this.hdOption=function(){Engine.soundManager.toggleQuality()},this.initContent=function(){t=n.get("music-manager"),Engine.interface.getTopPositioner().append(t)},this.showDialog=function(){},this.close=function(){Engine.musicPanel=!1,e.wnd.$.remove()},this.tLang=function(t){return _t(t,null,"sound")}}},function(t,e,i){var n=i(0),a=i(7),s=i(322);let r={addon_1:i(323),addon_2:i(324),addon_3:i(325),addon_5:i(326),addon_7:i(327),addon_8:i(328),addon_11:i(329),addon_12:i(330),addon_17:i(331),addon_19:i(332),addon_20:i(333),addon_24:i(334),addon_25:i(335),addon_27:i(336),addon_28:i(337)};getMobile()||isIframe()||(r.addon_29=i(338)),t.exports=function(){var t,e=this,i={};this.exceptionClearDataAddons=[27,20],this.init=function(){e.initWindow(),e.centerWindow(),e.initLabels(),e.initSearch(),e.initScrollsBar(),e.createAddonList(),Engine.widgetManager.addWidgetButtonsWithInitZoom()},this.initWindow=function(){t=n.get("addons-panel"),Engine.windowManager.add({content:t,title:e.tLang("extend"),nameWindow:Engine.windowsData.name.ADDONS,widget:Engine.widgetsData.name.ADDONS,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.manageVisible()}}),this.wnd.addToAlertLayer(),this.wnd.hide()},this.getList=function(){return i},this.onResize=()=>{const t=Engine.addonsPanel.getList();Object.keys(t).map(e=>{const i=t[e].onResize;isset(i)&&i()})},this.initLabels=function(){var t=this.wnd.$;t.find(".addon-header-label").html(_t("iconpuzzle")),t.find(".addon-list-label").html(_t("addon_list_h2",null,"static"))},this.manageVisible=function(){e.wnd.isShow()?(e.wnd.hide(),Engine.widgetManager.setEditableWidget(!1)):(e.wnd.show(),e.updateScroll(),e.wnd.setWndOnPeak(),Engine.widgetManager.setEditableWidget(!0))},this.getAddonIdKey=t=>"addon_"+t,this.oneAddonManageVisible=t=>{let i=e.getAddonIdKey(t);this.addonManageVisible(i)},this.initScrollsBar=function(){$(".left-scroll",t).addScrollBar({track:!0}),$(".right-scroll",t).addScrollBar({track:!0})},this.updateScroll=function(){$(".left-scroll",t).trigger("update"),$(".right-scroll",t).trigger("update")},this.centerWindow=function(){this.wnd.center()},this.createAddonList=function(){let t=s,i=e.sortData(t);for(var n=0;n<i.length;n++){var a=i[n],r=a.id;this.createOneAddonOnList(a,r),this.createOneAddonDescription(a,r)}},this.sortData=function(t){var e=[];for(var i in t)e.push($.extend(t[i],{id:i}));return e.sort((function(t,e){var i=t[_l()].name,n=e[_l()].name;return i<n?-1:i>n?1:0})),e},this.createOneAddonOnList=function(t,i){var a=n.get("one-addon-on-list").addClass("addon-on-list-"+i),s=e.wnd.$,r=t[_l()].name,o=t.options,l=e.createBackgroundString(t.image);let c=a.find(".widget-button");getEngine().widgetManager.set$BtnWidgetSize(c),s.find(".addon-list").append(a),e.setWindgetColor(i,e.getStorageStateOfAddon(i)),a.find(".addon-img").css("background",l),a.find(".addon-title").html(r),a.click((function(){var a=s.find(".addon-header-img").parent();if(getEngine().widgetManager.set$BtnWidgetSize(a),a.unbind("click"),a.hasClass("ui-draggable")&&(a.draggable("destroy"),a.parent().find(".border-blink").remove(),a.tip("")),o){a.addClass("from-addon-panel");var c=n.get("border-blink");let s=getEngine().widgetManager.getWidgetSize();c.css({width:s-2,height:s-2}),a.parent().prepend(c),getEngine().widgetManager.addDraggableAndDataAndTip(a,_t("drag_and_drop_widget"),Engine.widgetsData.data.WIDGET_KEY,e.getAddonIdKey(i)),a.bind("click",(function(){!e.getStorageStateOfAddon(i)?e.setStateAddon(t,!0,i,!0,!0):e.oneAddonManageVisible(i)}))}s.find(".addon-header").css("display","table"),s.find(".addon-header-title").html(r),s.find(".addon-header-img").css("background",l),s.find(".one-addon-description").css("display","none"),s.find(".desc-"+i).css("display","block"),e.setWindgetColor(i,e.getStorageStateOfAddon(i)),e.updateScroll()}))},this.createBackgroundString=function(t){var e=t.split("|"),i=`url(${e[0]}?v=${__build.version})`;if(1==e.length)return i;var n=e[1].split(" ");return i+=" "+n[0]+"px "+n[1]+"px"},this.setButtonState=function(t,i){var n=e.tLang(i?"turn_off":"turn_on");e.wnd.$.find(".desc-"+t).find(".label").html(n)},this.setWindgetColor=function(t,i){var n=e.wnd.$.find(".addon-header").find(".widget-button"),a=e.wnd.$.find(".addon-on-list-"+t).find(".widget-button");let s=Engine.widgetsData.type,r=Engine.widgetManager.addSeveralTypesToWidget(s.RED,s.GREEN);n.add(a).removeClass(r).addClass(i?s.GREEN:s.RED)},this.getStorageStateOfAddon=function(t){return Engine.serverStorage.get(a.ADDONS,t,"state")},this.createOneAddonDescription=function(t,i){var a=n.get("one-addon-description").addClass("desc-"+i),s=this.getStorageStateOfAddon(i),r=t[_l()].description;if(e.wnd.$.find(".right-scroll>.scroll-pane").append(a),e.createOnOffButton(a,t,s),a.find(".description-text").html(r),0!=t.options&&(a.find(".drag-info").css("display","block"),s)){var o=Engine.serverStorage.get(Engine.widgetManager.getPathToHotWidgetVersion(),e.getAddonIdKey(i));o&&e.addKeyToWidgets(i,o,t[_l()].name)}},this.createOnOffButton=function(t,i,a){let s=i.id,r=n.get("button").addClass("green small");r.click((function(){e.toggleStateAddon(i)})),t.find(".on-off-button").append(r),e.setButtonState(s,a),a&&e.startAddonScript(i,s)},this.toggleStateAddon=function(t){let i=t.id,n=!e.getStorageStateOfAddon(i);t.options,e.setStateAddon(t,n,i,!0)},this.setStateAddon=function(t,i,n,a,s){i?e.startAddonScript(t,n,a,s):e.turnOffAddon(n)},this.startAddonScript=(t,i,n,a)=>{let s=e.getAddonIdKey(i),o=new r[s];this.checkAddonOnList(s)||e.addToList(s,o),n?e.saveAddonAndWidgetInServerStorageAndRunAddon(t,i,a):e.dontSaveAddonAndRunAddon(t,i,a)},this.dontSaveAddonAndRunAddon=(t,i,n)=>{let a=e.getAddonIdKey(i);this.addonStart(a),this.setButtonState(i,!0),this.setWindgetColor(i,!0),n&&this.oneAddonManageVisible(i)},this.saveAddonAndWidgetInServerStorageAndRunAddon=(t,i,n)=>{let s={[a.ADDONS]:{}};s[a.ADDONS][i]={state:!0};let r=null;t.options&&(r=Engine.widgetManager.getFirstEmptyWidgetSlot(),e.prepareDataToSendToServerStorage(i,s,r)),Engine.serverStorage.sendData(s,(function(){let t=e.getAddonIdKey(i);e.addonStart(t),r&&e.addWidgetAfterSaveInServerStorage(i,r),e.setButtonState(i,!0),e.setWindgetColor(i,!0),n&&e.oneAddonManageVisible(i)}))},this.getAddonTitle=t=>e.wnd.$.find(".addon-on-list-"+t).find(".addon-title").html(),this.prepareDataToSendToServerStorage=(t,i,n)=>{let a=Engine.widgetManager.getPathToHotWidgetVersion(),s=e.getAddonIdKey(t),r={};r[a]={},r[a][s]=[n.slot,n.container],i[a]={},i[a][s]=[n.slot,n.container]},this.addWidgetAfterSaveInServerStorage=(t,i)=>{let n=Engine.addonsPanel.getAddonTitle(t),a=e.getAddonIdKey(t),s=Engine.widgetsData.type.GREEN,r=Engine.widgetManager.getDefaultWidgetSet();Engine.widgetManager.addKeyToDefaultWidgetSet(a,i.slot,i.container,n,s,(function(){e.oneAddonManageVisible(t)})),Engine.widgetManager.addWidgetButtons(),Engine.widgetManager.widgetDrop(r[a].txt,i.container+" "+i.slot)},this.turnOffAddon=function(t){e.removeWidgetButton(t);var i=e.tLang("empty");let n={},s=Engine.widgetManager.getPathToHotWidgetVersion(),r=e.getAddonIdKey(t);n[a.ADDONS]={},n[a.ADDONS][t]={state:!1},n[s]={},n[s][r]=!1,Engine.serverStorage.sendData(n,(function(){e.setButtonState(t,!1),e.setWindgetColor(t,!1),e.stopAddonProcedure(t,i),e.exceptionClearDataAddons.includes(parseInt(t))||Engine.serverStorage.clearDataBySpecificKey(r)}))},this.stopAddonProcedure=(t,i)=>{let n=e.getAddonIdKey(t);this.addonStop(n),this.removeFromList(n),e.wnd.$.find(".desc-"+t).find(".location-menu>.menu-option").attr("value",0).html(i)},this.addonStart=t=>{i[t].start()},this.addonStop=t=>{i[t].stop()},this.addonManageVisible=t=>{i[t].manageVisible()},this.addToList=(t,e)=>{i[t]=e},this.checkAddonOnList=(t,e)=>!!i[t],this.removeFromList=t=>{delete i[t]},this.addKeyToWidgets=function(t,i,n){let a=e.getAddonIdKey(t),s=Engine.widgetsData.type.GREEN;Engine.widgetManager.addKeyToDefaultWidgetSet(a,i[0],i[1],n,s,(function(){e.oneAddonManageVisible(t)}))},this.removeWidgetButton=function(t){let i=e.getAddonIdKey(t);Engine.interface.get$interfaceLayer().find("."+i).parent().remove()},this.initSearch=function(){var t=this.wnd.$.find(".search"),i=this.wnd.$.find(".search-x");t.keyup((function(){var t=$(this).val(),i=e.wnd.$.find(".one-addon-on-list");""==t?i.css("display","block"):i.each((function(){var i=$(this).find(".addon-title").html().toLowerCase().search(t.toLowerCase())>-1?"block":"none";$(this).css("display",i),e.updateScroll()}))})),t.attr("placeholder",_t("search")),i.on("click",(function(){t.val("").blur().trigger("keyup")}))},this.close=function(){},this.getContent=()=>t,this.tLang=function(t){return _t(t,null,"extManager")}}},function(t,e){let i={1:{pl:{name:"Detektor kolizji",description:"Dodatek uwidacznia na mapie kolizje - na co dzień niezauważalne ściany, które ograniczają swobodę ruchu postaci w lokacjach."},en:{name:"Collision Detector",description:"This add-on shows collisions on the map - invisible walls that limit the freedom of movement of characters in locations."},image:"/img/gui/addons-icons.png|-314 -34",options:0},2:{pl:{name:"Współrzędne kursora",description:"Pokazuje współrzędne w kursora. Nie ma potrzeby ich obliczania z koordynatów podanych na mapie."},en:{name:"Coordinates of cursor",description:"It shows the coordinates of the cursor. There is no need for calculating the coordinates given on the map."},image:"/img/gui/addons-icons.png|-4 -3",options:0},3:{pl:{name:"Wyświetlanie czasu do ponownego użycia przedmiotu",description:"Wyświetlanie czasu do ponownego użycia przedmiotu bez potrzeby jego podświetlania."},en:{name:"Displaying the time to re-use item",description:"Displaying the time to re-use item without the need to backlight."},image:"/img/gui/addons-icons.png|-35 -3",options:0},5:{pl:{name:"Zegar",description:"Pole z zegarem oraz datą, które można umieścić w dowolnym miejscu. Szczególnie przydatne, gdy grasz na pełnym ekranie."},en:{name:"Clock",description:"The field with the clock and the date, which can be placed anywhere. Especially useful when you play full-screen."},image:"/img/gui/addons-icons.png|-97 -3",options:0},7:{pl:{name:"Numerowanie miejsc depozytu",description:"Uruchomienie dodatku ukazuje numerację miejsc w depozycie. Szczególnie przydatne w przypadku posiadania sporej liczby przedmiotów."},en:{name:"Numbering places of vault",description:"Shows the numbering of places in the deposit. Especially useful when you have a lot of items."},image:"/img/gui/addons-icons.png|-159 -3",options:0},11:{pl:{name:"Przedziały grupowania",description:"Dodatek ułatwia stworzenie grupy bez martwienia się, czy dodane do grupy osoby nie spowodują wyłączenia profitów płynących ze zgrupowania się. Po aktywacji, w dymku przeglądanej postaci znajdzie się przedział poziomowy, z którym dany gracz może się zgrupować."},en:{name:"Group Compartments",description:"This add-on makes it easier to create a group without worrying about whether added people will exclude the benefits of grouping. After activation, in the character's tooltip will be a level range with which a given player can group."},image:"/img/gui/addons-icons.png|-283 -3",options:0},12:{pl:{name:"Listowanie przedmiotów znajdujących się na mapie",description:"Dodatek pozwala na łatwe przejrzenie listy przedmiotów znajdujących się na ziemi w lokacji, w której znajduje się twoja postać."},en:{name:"Listing items located on the map",description:"Easily view list of items on the ground in the location you currently are."},image:"/img/gui/addons-icons.png|-314 -3",options:1},17:{pl:{name:"Minutnik",description:"Minutnik pokazuje czas do pojawienia się kolejnej Elity oraz Elity II zaraz po jej pokonaniu. Dodatek ma możliwość ustawienia również indywidualnych przypomnień czasowych, wraz z komunikatem dźwiękowym."},en:{name:"Timer",description:"This add-on shows the time until the next Elite and Elite II appear after defeating them. You can also set an audio message."},image:"/img/gui/addons-icons.png|-438 -3",options:1},19:{pl:{name:"Automatyczne akceptowanie zaproszeń do drużyny",description:"Automatyczne akceptowanie zaproszeń wysyłanych do twojej postaci. Swobodnie decyduj, od której grupy osób akceptować zaproszenia."},en:{name:"Automatically accept invitations to party",description:"Automatically accept invitations sent to your character. Choose freely from which group of people to accept invitations."},image:"/img/gui/addons-icons.png|-500 -3",options:1},20:{pl:{name:"Filtruj łup",description:"Dodatek pozwala na zdefiniowanie własnych reguł, które wykorzystywane są przy podziale łupów."},en:{name:"Loot Filter",description:"This add-on allows you to define your own rules that are used when splitting the loot."},image:"/img/gui/addons-icons.png|-531 -3",options:1},24:{pl:{name:"Wykrywacz",description:"Dodatek pokazuje komunikaty znalezionych tytanów, kolosów, herosów oraz NPC specjalnych. Pozwala także na natychmiastowe powiadomienie klanu lub grupy."},en:{name:"Detector",description:"Turning on this add-on allows to detect presence of a Hero. It works in range of 11 fields from your character on the map you currently are. Add-on also allows to notify your group or clan members."},image:"/img/gui/addons-icons.png|-97 -34",options:1},25:{pl:{name:"Powiadomienie o zdobytych przedmiotach",description:"Dodatek wyświetla powiadomienie na ekranie w chwili, gdy gracz zdobędzie przedmiot unikatowy, heroiczny lub legendarny."},en:{name:"Notification of acquired items",description:"This add-on displays an on-screen notification once the player gains a unique, heroic or legendary item."},image:"/img/gui/addons-icons.png|-128 -34",options:0},27:{pl:{name:"Ramki przedmiotów",description:"Dodatek umożliwia zmianę domyślnych ramek wokół przedmiotów na własne bądź wybranie z istniejącej listy."},en:{name:"Item Frames",description:"Item Frames allows to change default item frames to user ones or the available alternatives."},image:"/img/gui/addons-icons.png|-252 -34",options:1},28:{pl:{name:"Zjadacz złota",description:"Złoto z torby zostanie zużyte i dodane do posiadanego."},en:{name:"Gold Eater",description:"Gold in the inventory is used automatically."},image:"/img/gui/addons-icons.png|-283 -34",options:0}};getMobile()||isIframe()||(i[29]={pl:{name:"Tryb okienkowy",description:"Dodatek umożliwia sprowadzenie gry do wybranej przez siebie rozdzielczości. Dodatkowo umożliwia wybór tła jak i wgranie swojego własnego."},en:{name:"Window mode",description:"The add-on allows you to set the game to your chosen resolution. Additionally, it enables you to choose a background or upload your own."},image:"/img/gui/addons-icons.png|-345 -34",options:1}),t.exports=i},function(t,e){t.exports=function(){let t=!1;const e=Engine.map,i=e.draw;this.start=function(){t||(t=!0,this.setDrawCollision())},this.stop=function(){t&&(t=!1,this.setDrawCollision())},this.getColor=()=>"rgba(0, 128, 0, 60%)",this.setDrawCollision=()=>{e.draw=n=>{var a=i.call(e,n);return t&&this.drawCollisions(e,n),a}},this.drawCollisions=(t,e)=>{for(var i=this.getColor(),n=0;n<t.d.x;n++)for(var a=0;a<t.d.y;a++)t.col.check(n,a,1)&&(e.fillStyle=i,e.fillRect(32*n-t.offset[0],32*a-t.offset[1],32,32))}}},function(t,e){t.exports=function(){let t={mapX:0,mapY:0,px:0,py:0,clientX:0,clientY:0},e=!1,i=!1,n=this;function a(e){!function(e){t.clientX=e.clientX,t.clientY=e.clientY}(e),o()}function s(){e=!1}function r(t,i,n){const{x:a,y:r}=t.d;i>a||n>r||i<0||n<0?s():e=!0}function o(){const e=Engine.interface.get$GAME_CANVAS().offset(),i=Engine.map,n=i.offset,a=Engine.zoomManager.getActualZoom();t.px=t.clientX-e.left/a,t.py=t.clientY-e.top/a,t.mapX=Math.floor((n[0]+t.px)/CFG.tileSize),t.mapY=Math.floor((n[1]+t.py)/CFG.tileSize),r(i,t.mapX,t.mapY),t.tipPosX=t.px-55,t.tipPosY=t.py+35}function l(){Engine.renderer.add(n)}this.alwaysDraw=!0,this.start=function(){i||(i=!0,Engine.interface.get$GAME_CANVAS().on("mousemove",a),Engine.interface.get$GAME_CANVAS().on("mouseout",s),API.addCallbackToEvent(Engine.apiData.HERO_MOVE,o),API.addCallbackToEvent(Engine.apiData.CALL_DRAW_ADD_TO_RENDERER,l))},this.stop=function(){i&&(i=!1,Engine.interface.get$GAME_CANVAS().off("mousemove",a),Engine.interface.get$GAME_CANVAS().off("mouseout",s),API.removeCallbackFromEvent(Engine.apiData.HERO_MOVE,o),API.removeCallbackFromEvent(Engine.apiData.CALL_DRAW_ADD_TO_RENDERER,l))},this.getOrder=()=>1e4,this.draw=i=>{e&&(i.save(),i.fillStyle="white",i.shadowColor="black",i.shadowOffsetX=3,i.shadowOffsetY=3,i.shadowBlur=4,i.font="14px Arimo",i.fillText(`(${t.mapX}, ${t.mapY})`,t.tipPosX,t.tipPosY),i.restore())}}},function(t,e){t.exports=function(){var t=this,e=!1,i=[],n=null,a=null;function s(){let t=unix_time(!0);for(let e in i){r(i[e],t)}}function r(e,i){let n=function(t,e){if(isset(t.timelimit)){let i=t.timelimit.split(","),n=0;return i.length>=2&&(n=Math.ceil((parseInt(i[1])-e)/60)),n}if(isset(t.ttl))return t.ttl;return null}(e._cachedStats,i);null!=n&&function(e,i){let n=e.id,a=Engine.items.getViews()[n],s=e.$.find(".cooldown"),r=i<=0?"":i;t.setCooldownVal(s,r);for(let e in a){if("tip-item"==e)continue;let n=a[e].length;for(let s=0;s<n;s++){let n=a[e][s][0].find(".cooldown"),r=i<=0?"":i;t.setCooldownVal(n,r)}}}(e,n)}function o(t){if(!function(t){return isset(t._cachedStats.timelimit)||isset(t._cachedStats.ttl)&&t.st>0&&9!=t.st}(t))return;let e=unix_time(!0);var n;i[(n=t).id]=n,function(t){let e=l();t.$.append(e);let i=Engine.items.getAllViewsById(t.id);for(let t in i){let e=l();i[t].append(e)}}(t),r(t,e),function(t){t.on("afterUpdate",(function(e){let i=unix_time(!0);r(t,i)}))}(t)}function l(){return $("<div>").addClass("cooldown")}function c(t){let e=Engine.items.getAllViewsById(t.id);t.$.find(".cooldown").remove();for(let t in e)e[t].find(".cooldown").remove()}this.setCooldownVal=(t,e)=>{e!=t.html()&&t.html(e)},this.start=function(){e||(e=!0,i=[],t.addStyle(),t.initFetch(),n=setInterval(s,5e3),s())},this.initFetch=()=>{Engine.items.fetch(Engine.itemsFetchData.FETCH_CHECK_IF_TP_ITEM,o)},this.addStyle=()=>{a=$("<style>.cooldown{position: absolute;top: 8px;width: 32px;height: 16px;text-align: center;text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black;color: white;pointer-events: none;}</style>").appendTo("head")},this.stop=function(){e&&(e=!1,clearInterval(n),a.remove(),Engine.items.removeCallback(Engine.itemsFetchData.FETCH_CHECK_IF_TP_ITEM),function(){for(var t in i){c(i[t])}}(),i=[])}}},function(t,e){t.exports=function(){const t=Engine.windowsData.name.addon_5,e=_t("clock");let i=!1,n=null;const a=new Vue({template:'\n\t\t\t<div class="clock">\n\t\t\t\t<div class="date">\n\t\t\t\t\t<span>{{ day }}.{{ month }}.{{ year }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="time">\n\t\t\t\t\t<span>{{ hour }}:{{ min }}:{{ sec }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n        ',data:{interval:null,day:null,month:null,year:null,hour:null,min:null,sec:null},created(){this.tick(),this.interval=setInterval(this.tick,1e3)},destroyed(){clearInterval(this.interval)},methods:{tick(){const t=new Date;this.day=zero(t.getDate()),this.month=zero(t.getMonth()+1),this.year=t.getFullYear(),this.hour=zero(t.getHours()),this.min=zero(t.getMinutes()),this.sec=zero(t.getSeconds())}}});this.start=function(){i||(i=!0,function(){const t=stringToHtml(s());document.head.appendChild(t)}(),function(){n=Engine.windowManager.add({content:$(`<div id="${t}"></div>`),title:e,nameWindow:t,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:251,y:60},closeable:!1,onclose:()=>{}}),n.$[0].classList.add("window-clock"),n.updatePos(),n.addToAlertLayer();const i=document.getElementById(t);a.$mount(i)}())},this.stop=function(){i&&(i=!1,a.$destroy(),n.remove(),n=null,function(){const e=document.getElementById(t+"-style");e&&e.parentNode.removeChild(e)}(),API.Storage.remove(t,!0))};const s=()=>`\n\t\t<style id="${t}-style">\n\t\t\t.border-window.transparent.window-clock{\n\t\t\t\tmin-width: auto;\n\t\t\t\twidth: 70px;\n\t\t\t\tfont-size: 1em;\n\t\t\t}\n\t\t\t.window-clock .content{\n\t\t\t\tmargin-top: -10px;\n\t\t\t\tmargin-bottom: -13px;\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.window-clock .clock {\n\t\t\t\tpadding-top: 5px;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\t\t</style>\n\t`}},function(t,e){t.exports=function(){var t,e=!1,i=null;function n(){for(var e=14*(t+1),i=e-14,n=1,a=112*t,s=0;s<8;s++)for(var r=i;r<e;r++){var o=$("<div>").addClass("depo-number").html(n+a).css("position","absolute");Engine.depo.setPos(o,r,s,2),n++}}function a(){t=0}function s(){for(;t<Engine.depo.getAmountCards();)n(),t++}this.start=function(){e||(e=!0,i=$("<style>.depo-number{position: absolute;margin-left: 3px;z-index: 3;color: #dbdbd6;text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black;font-size: 8px;user-select: none;pointer-events: none;}</style>").appendTo("head"),Engine.depo&&(a(),s()),API.addCallbackToEvent(Engine.apiData.DEPO_INIT,a),API.addCallbackToEvent(Engine.apiData.CLAN_DEPO_INIT,a),API.addCallbackToEvent(Engine.apiData.DEPO_UPDATE,s),API.addCallbackToEvent(Engine.apiData.CLAN_DEPO_UPDATE,s))},this.stop=function(){e&&(e=!1,i.remove(),$(".depo-number").remove(),API.removeCallbackFromEvent(Engine.apiData.DEPO_INIT,a),API.removeCallbackFromEvent(Engine.apiData.CLAN_DEPO_INIT,a),API.removeCallbackFromEvent(Engine.apiData.DEPO_UPDATE,s),API.removeCallbackFromEvent(Engine.apiData.CLAN_DEPO_UPDATE,s))}}},function(t,e){t.exports=function(){var t=!1,e=null,i=null,n=[],a={"8p":[":p"],aww:[":ahh"],biggrin:[";d",":d"],blush:[";wstydnis",":wstydnis"],boogie:[":tanczy"],crying:[";("],doh:["x|"],eek:[":|"],evileye:[";>",":>"],evillaugh:["]:->","];->"],hmm:[":\\"],kiss:[";*",":*"],lol:[";)))",":)))"],mad:[":x",";x"],o_o:[";o",":o"],oops:[":oops"],razz:[";p"],rotfl:[":rotfl"],sad:[":("],smile:[":)"],smirk:[";]",":]"],thanks:[":thx"],upset:[":/"],wink:[";)"],xd:["xd"],zombie:[":zombie"]};function s(t){t=t.toLowerCase();for(var e in a){var i=a[e];for(var n in i)if(i[n]==t)return e}return null}function r(t){var e=t[0],i=t[1];if("abs"==i.s||""==i.s){var a=e.children().eq(2).contents();!function(t,e){var i={$el:t,$old:e};for(var a in n)if(n[a].$el==i.$el)return void(n[a].$old=i.$old);n.push(i)}(e,a.clone(!0,!0));for(var s=a.filter((function(){return 3===this.nodeType})),r=0;r<s.length;r++){var l=s.eq(r);l.replaceWith(o(l.text()))}}}function o(t){var e=[],n=t.split(" ");for(var a in n){var r=n[a],o=s(r);if(e.push(document.createTextNode(" ")),null!==o){var l=i.clone(!0);l.attr("data-tip",r),l.attr("src","https://micc.garmory-cdn.cloud/obrazki/emots/"+o+".gif"),e.push(l)}else e.push(document.createTextNode(r))}return e}this.start=function(){t||(t=!0,e=$("<style>.emots{height: 13px;position: relative;top: 2px;}</style>").appendTo("head"),i=$("<img>").addClass("emots"),API.addCallbackToEvent(Engine.apiData.NEW_MSG,r),API.addCallbackToEvent(Engine.apiData.UPDATE_MSG,r))},this.stop=function(){if(t){for(var i in t=!1,API.removeCallbackFromEvent(Engine.apiData.NEW_MSG,r),API.removeCallbackFromEvent(Engine.apiData.UPDATE_MSG,r),e.remove(),n)(a=n[i]).$el.children().eq(2).empty().append(a.$old);var a;n=[]}}}},function(t,e){t.exports=function(){let t=!1,e=null;const i=Engine.worldConfig.getPrivWorld()?1.4:1.2,n=t=>Math.round((t-4)/i),a=t=>Math.round(t*i)+4;function s(t){Engine.hero===t?t.updateTip():t.tipUpdate()}function r(){API.addCallbackToEvent(Engine.apiData.NEW_OTHER,s),API.removeCallbackFromEvent(Engine.apiData.NEW_OTHER,s),s(Engine.hero)}function o(t){if(0!==t.object.d.lvl){var e,i,s=function(t){let e;if(Engine.worldConfig.getPrivWorld()){e=n(t),e=t-a(e)==1?e+1:e}else e=n(t);e=Math.min(e,t-14);const i=Math.max(a(t),t+14);return[Math.max(e,1),Math.min(i,500)]}(t.object.d.lvl),r=(e=s[0],i=s[1],e+" - "+i);t.text+='<div class="info_tooltip_cont"><div class="line"></div><div class="info_tooltip_loot">'+(_t("loot",null,"info_tooltip")+'<div class="value">')+r+"</div></div></div>"}}this.start=function(){t||(t=!0,e=$('<style>.info_tooltip_cont{display: block;margin-top: -1px;width: 100%;height: 14px;font-size: 11px;}.info_tooltip_loot{float: right;}.info_tooltip_loot .value{display: inline-block;margin-left: 2px;color: #d5bf74;}.tip-wrapper[data-type="t_other"] .mute {bottom: 18px !important;}</style>').appendTo("head"),API.addCallbackToEvent(Engine.apiData.AFTER_CHARACTER_TIP_UPDATE,o),r())},this.stop=function(){t&&(t=!1,e.remove(),API.removeCallbackFromEvent(Engine.apiData.AFTER_CHARACTER_TIP_UPDATE,o),r())}}},function(t,e){t.exports=function(){const t=Engine.windowsData.name.addon_12,e=_t("title",null,"map_items"),i=_t("delete",null,"buttons"),n=_t("search");let a=!1,s=null;Vue.directive("add-item",{bind:function(t,e,i){t.innerHTML="",t.appendChild(e.value[0])}}),Vue.directive("add-tip",{bind:function(t,e,i){$(t).tip(e.value)}}),Vue.directive("add-npc-tip",{bind:function(t,e,i){let n=e.value.id,a=Engine.npcs.getById(n);if(!a)return;let s=e.value.view,r=Engine.npcs.getTip(a),o=createNpcIcon("tip-npc-wrapper","tip-npc-icon",s,1,32,32,190);$(t).tip(r+o)}});const r=new Vue({template:`\n\t\t\t<div class="window-list map-item">\n\t\t\t\t<div class="scroll-wrapper classic-bar">\n\t\t\t\t\t<div class="scroll-pane">\n\t\t\t\t\t\t<div class="scroll-pane-content">\n\t\t\t\t\t\t\t<div class="list item-list">\n\t\t\t\t\t\t\t\t<div v-if="filteredList.length > 0">\n\t\t\t\t\t\t\t\t\t<gi-item \n\t\t\t\t\t\t\t\t\t\tv-for="item in filteredList"\n\t\t\t\t\t\t\t\t\t\t:item="item" \n\t\t\t\t\t\t\t\t\t\t:key="item.id" \n\t\t\t\t\t\t\t\t\t\tclass="map_item_table do-action-cursor tw-list-item">\n\t\t\t\t\t\t\t\t\t</gi-item>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div v-else class="empty">----</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="search-wrapper scrollable">\n\t\t\t\t\t<input class="search map-item-search-input" placeholder="${n}" v-model="searchValue">\n\t\t\t\t\t<div class="search-x" @click="searchClear" v-add-tip="'${i}'"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n        `,data:{list:[],searchValue:""},mounted(){let t=this;API.addCallbackToEvent(Engine.apiData.NEW_NPC,this.watchNpc),API.addCallbackToEvent(Engine.apiData.REMOVE_NPC,(function(e){t.removeItem(e.d.id)})),API.addCallbackToEvent(Engine.apiData.CLEAR_MAP_NPCS,this.removeAllItems),Engine.items.fetch(Engine.itemsFetchData.FETCH_WATCH_ITEM,this.watchItem)},updated(){c()},destroyed(){API.Storage.remove(t,!0),Engine.items.removeCallback(Engine.itemsFetchData.FETCH_WATCH_ITEM)},computed:{filteredList:function(){return""===this.searchValue?this.list:this.list.filter(t=>t.name.toLowerCase().includes(this.searchValue.toLowerCase()))}},methods:{searchClear(){this.searchValue=""},watchItem(t){let e=this;if(t.own!=Engine.map.d.id)return;t.on("delete",(function(){e.removeItem(this.id)}));let i=this.createItem(t);this.list.push(i)},watchNpc(t){if(7!=t.d.type)return;let e=this.createItem(t,!0);this.list.push(e)},createItem(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{id:t.d.id,name:t.d.nick,x:t.d.x,y:t.d.y,type:"Npc",view:CFG.a_npath+t.d.icon}:{id:t.id,name:t.name,x:t.x,y:t.y,type:"Item",view:this.getView(t)}},getView:t=>Engine.items.createViewIcon(t.id,Engine.itemsViewData.GROUND_ADDON_ITEM_VUE_VIEW)[0],removeItem(t){var e=this.list.findIndex(e=>e.id==t);e>=0&&this.list.splice(e,1)},removeAllItems(){this.list=[]}}});function o(){s=Engine.windowManager.add({content:$(`<div id="${t}"></div>`),title:e,nameWindow:t,widget:Engine.widgetsData.name.addon_12,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:"251",y:"60"},manageShow:!1,onclose:()=>{l()}}),s.el=s.$[0],s.el.classList.add("items-on-ground"),s.updatePos(),s.addToAlertLayer();const i=document.getElementById(t);r.$mount(i),s.$.find(".scroll-wrapper").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(".search-wrapper",s.$)})}function l(){s.hide()}function c(){$(".scroll-wrapper",s.$).trigger("update")}Vue.component("gi-item",{props:{item:Object},template:'\n\t\t\t<div \n\t\t\t\t@mouseenter="addArrow(item)"\n\t\t\t\t@mouseleave="removeArrow(item)"\n\t\t\t\t@click="goTo(item)"\n\t\t\t\t:class="{ active: isActive }"\n\t\t\t\tref="lala"\n    \t\t>\n\t\t\t\t<div v-if="item.type === \'Item\'" class="map_item_cell" v-add-item="item.view"></div>\n\t\t\t\t<div v-else class="map_item_cell" v-add-npc-tip="item">\n\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t<div class="highlight t-norm"></div>\n\t\t\t\t\t\t<div class="icon css-icon" :style="setNpcIcon"></div>\n\t\t\t\t\t\t<div class="icon canvas-icon hide-icon" :style="setNpcIcon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="map_item_cell map_item_center_cell name">{{ item.name }}</div>\n\t\t\t\t<div class="map_item_cell">{{ item.x }},{{ item.y }}</div>\n\t\t\t</div>\n        ',data:()=>({isActive:!1}),beforeDestroy(){this.removeArrow(this.item);const t=Engine.items.getItemById(this.item.id);t&&t.$.tipHide()},destroyed(){},computed:{setNpcIcon:function(){return{"background-image":`url('${this.item.view}')`}}},methods:{addArrow(t){let e="Item"===t.type?{id:t.id,x:t.x,y:t.y}:{d:{id:t.id},rx:t.x,ry:t.y};Engine.targets.addArrow(t.type+"-"+t.id,t.name,e,t.type,"navigate")},removeArrow(t){Engine.targets.deleteArrow(t.type+"-"+t.id)},goTo(t){Engine.hero.autoGoTo({x:t.x,y:t.y}),this.isActive=!0,setTimeout(()=>{this.isActive=!1},500)}}}),this.manageVisible=function(){s.isShow()?l():(s.show(),s.setWndOnPeak(),c())},this.start=function(){a||(a=!0,function(){const t=stringToHtml(d());document.head.appendChild(t)}(),o())},this.stop=function(){a&&(a=!1,r.$destroy(),function(){const e=document.getElementById(t+"-style");e&&e.parentNode.removeChild(e)}(),s.remove(),s=null)};const d=()=>`\n        <style id="${t}-style">\n\t\t\t.items-on-ground .content{\n\t\t\t\tmargin: -10px -20px -17px;\n\t\t\t}\n\t\t\t.items-on-ground .search-wrapper{\n\t\t\t\tmargin-bottom: -3px;\n\t\t\t}\n\t\t\t.map-item {\n\t\t\t\tmargin-top: 5px;\n\t\t\t}\n\t\t\t.map_item_table .map_item_cell {\n\t\t\t\tdisplay: table-cell;\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-size: 11px;\n\t\t\t\tline-height: normal;\n\t\t\t\tpadding: 2px 0;\n\t\t\t\tcolor: white;\n\t\t\t\twidth: 32px;\n\t\t\t\tmin-height: 32px;\n\t\t\t\tvertical-align: middle;\n\t\t\t}\n\t\t\t.map_item_table .map_item_cell .item {\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t.map_item_table .map_item_cell.map_item_center_cell {\n\t\t\t\tmin-width: 118px;\n\t\t\t\ttext-align: left;\n\t\t\t}\n\t\t\t.items-on-ground .map-item .scrollable .scroll-pane {\n\t\t\t\tpadding-right: 15px\n\t\t\t}\n\t\t\t.items-on-ground .map-item .scrollable .scrollbar-wrapper {\n\t\t\t\ttop: -10px;\n\t\t\t\tbottom: 24px;\n\t\t\t}\n\t\t\t.map_item_table {\n\t\t\t\tdisplay: table;\n\t\t\t\twidth: 100%;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\t\t\t.map_item_table.active {\n\t\t\t\toutline: 1px solid #a2a2a2;\n\t\t\t\toutline-offset: -2px;\n\t\t\t}\n        </style>\n    `}},function(t,e){t.exports=function(){const t=Engine.windowsData.name.addon_17,e=_t("elite_timer",null,"elite_timer");var i=!1,n=this,a=null,s=null;let r=!1;var o=["elite","elite2","heroes","titans","hero-resp","sound","title"],l=["fadeout"],c={fadeout:60},d={elite:_t("elite_tip",null,"elite_timer"),elite2:_t("elite2_tip",null,"elite_timer"),heroes:_t("heroes_tip",null,"elite_timer"),titans:_t("titans_tip",null,"elite_timer"),"hero-resp":_t("hero-resp_tip",null,"elite_timer"),sound:_t("sound_tip",null,"elite_timer"),title:_t("title_tip",null,"elite_timer"),fadeout:_t("fadeout_tip",null,"elite_timer")},h=["long","short","pass"],u={elite:1,elite2:1,heroes:1,titans:1,"hero-resp":1,sound:0,title:1,fadeout:60,show:!1};const p={1:{short:"E",fullname:_t("elita1",null,"npcs_kind")},2:{short:"E2",fullname:_t("elita2",null,"npcs_kind")},3:{short:"H",fullname:_t("heros",null,"npcs_kind")},4:{short:"T",fullname:_t("tytan",null,"npcs_kind")}};var g=[];let f=[];var m=null,v=null,E=null,_=!1,b=null,w=null,C=!1;function T(t){if(!function(t){var e=Engine.hero.d.x,i=Engine.hero.d.y,n=t.d.x,a=t.d.y,s=Engine.map.d.visibility;return null===s&&console.log("WarShadow range is null, 17 needs fix"),0===s||Math.abs(e-n)<=s&&Math.abs(i-a)<=s}(t)||1===Engine.hero.d.stasis)return;var e=0;t.d.wt>19&&t.d.wt<=29?e=2:t.d.wt>9&&t.d.wt<=19?e=1:t.d.wt>79&&t.d.wt<=89?e=3:t.d.wt>99&&t.d.wt<=109&&(e=4);const i=1==e&&1==u.elite,n=2==e&&1==u.elite2,a=3==e&&1==u.heroes,s=4==e&&1==u.titans;(i||n||a||s)&&function(t,e){const{respBaseSeconds:i,resp_rand:n=10}=t.d,a=n/100;if(!isset(i)||1===i)return;const s=function(t,e){return Math.round(t*e+t)}(i,a),r=function(t,e){return Math.round(t-t*e)}(i,a),o={id:t.d.id,name:t.d.nick,x:t.d.x,y:t.d.y,map:Engine.map.d.name,type:e,char:Engine.hero.d.id,heroData:rt(),presp:unix_time()+s,minResp:unix_time()+r};it(o,tt(o))}(t,e)}function y(t){return f.find(e=>e.id===t)}function I(t){return g.find(e=>e.id===t)}function A(t){let{id:e,presp:i}=t;y(e)||(f.push({id:e,presp:i}),x())}function k(t){isset(t._cachedStats.revive)&&(r=!0)}function S(t){let{nick:e,id:i,sec:n}=t;if(!parseInt(u["hero-resp"]))return;let a=I(i),s=y(i);if(r&&a)return function(t){let{obj:e,sec:i}=t;e.presp=O(i),Q(),J(),N()}({obj:a,sec:n}),void(r=!1);if(0===n)return void function(t){const e=I(t),i=e;e&&(isset(i)&&isset(i.$)&&i.$.remove(),g.splice(e,1));let n=y(t);n&&f.splice(n,1);N()}(i);let o=Math.ceil(unix_time(!0));a||(s&&s.presp)>=o||function(t){let{nick:e,id:i,sec:n}=t;it(function(t){let{nick:e,id:i,sec:n}=t,a=O(n);return{id:i,name:e,presp:a,map:Engine.map.d.name,type:"hero",heroData:rt()}}({nick:e,id:i,sec:n}),-1)}({nick:e,id:i,sec:n})}function O(t){return Math.floor(unix_time(!0))+t}function M(t,e){return e.presp<t-u.fadeout}function N(){!function(){var t=unix_time();for(var e in g)M(t,g[e])&&g.splice(e,1)}();var e=[];for(var i in g){var n=g[i],a={};isset(n.user)?a.user=n.user:(a.char=n.char,a.id=n.id,a.map=n.map,a.type=n.type,a.x=n.x,a.y=n.y),a.heroData=n.heroData,isset(n.type)&&"hero"===n.type&&(a.type=n.type),a.name=n.name,a.presp=n.presp,a.minResp=n.minResp,e.push(a)}Engine.serverStorage.sendData({[t]:{data:e}}),x()}function R(){Engine.serverStorage.sendData({[t]:{settings:u}})}function x(){Engine.serverStorage.sendData({[t]:{skippedDeads:f}})}function L(){null!==v&&(v.remove(),v=null)}function D(){null!==a&&(document.title=a,a=null)}function P(){var t;if(0!=u.title)if(g.length>0){var e=g[0],i=unix_time();let n=function(t){return"00"==t[0]?t[1]+":"+t[2]:t[0]+":"+t[1]+":"+t[2]}(q(e.presp-i));t=n+" - "+e.name,null===a&&(a=document.title),document.title=t}else D();else D()}function B(t,e,i){var n=API.Templates.get("window-list-option");n.find(".window-list-option").addClass("elite-timer-opt"),n.find(".txt-wrapper").css("width","148px"),n.find(".control-wrapper").css("width","100px");var a=n.find(".control");n.attr("id",e),t.append(n);var s=n.find(".text").text(_t(e,null,"elite_timer")),r=$("<div>").addClass("info-icon");s.prepend(r);var o=d[e];if(isset(o)&&r.tip(o),0==i){var l=[{text:_t("yes"),val:1},{text:_t("no"),val:0}];a.createDivideButton(l,e);var c=u[e];a.find(".option[value="+c+"]").addClass("active")}else if(1==i){(h=API.Templates.get("input")).find("input").on("keydown",G).on("keyup",G).val(u[e]),a.append(h)}else{var h;(h=API.Templates.get("input")).find("input").on("keydown",V).on("keyup",V).val(u[e]),a.append(h)}}function F(){var t=API.Templates.get("button").addClass("green");t.find(".label").html(_t("save")),v.$.find(".buttons").append(t),t.on("click",(function(){!function(){for(var t in o){var e=v.$.find("#"+o[t]).find(".active");u[o[t]]=e.attr("value")}var i=l;for(var t in i){var n=v.$.find("#"+i[t]+" input"),a=parseInt(n.val());isNaN(a)&&(a=c[i[t]]),u[i[t]]=a}R(),L()}()}))}function W(t){var e=b.find("input"),i=parseInt(e.eq(3).val()),a=parseInt(e.eq(2).val()),s=parseInt(e.eq(1).val()),r=e.eq(0).val(),o=b.data("obj");C&&r.length>0&&function(t,e,i,a,s){var r=isNaN(i)?0:i;r+=isNaN(a)?0:60*a,r+=isNaN(s)?0:3600*s;var o=-1;isset(t)&&(o=tt(t));-1==o?n.add(e,r):(g[o].name=e,g[o].presp=unix_time()+(r>0?r:0),it(g[o],o))}(o,r,i,a,s),_?(w.hide(),m.$.find(".scrollbar-wrapper").removeClass("is-input-show")):b.parent().children().show(),e.val(""),b.removeData("obj"),b.detach(),$(document).off("mousedown",nt)}function H(){var t=$(this).val(),e=t.replace(/[^0-9]/g,"");isNaN(parseInt(e))&&(e=""),e>60&&(e="60"),e<0&&(e="0"),t!==e&&$(this).val(e)}function G(){var t=$(this).val(),e=t.replace(/[^0-9]/g,"");isNaN(parseInt(e))&&(e=""),e<0&&(e="0"),t!==e&&$(this).val(e)}function V(){var t=$(this).val(),e=t.replace(/,/g,".");(e=t.replace(/[^0-9.]/g,""))<0&&(e="0"),e>3&&(e="3");var i=parseFloat(e);i!=e&&(e=i),isNaN(i)&&(e=""),t!==e&&$(this).val(e)}function U(){var t=API.Templates.get("settings-button");t.addClass("small green"),t.find(".label").html("..."),m.$.find(".open-edit-panel").append(t),t.on("click",(function(t){null===v?(!function(){(v=Engine.windowManager.add({content:API.Templates.get("window-list-edit"),title:_t("option"),nameWindow:Engine.windowsData.name.addon_17_edit,onclose:()=>{L()}})).$.find(".all-options").css({"margin-top":9}),v.$.find(".buttons").wrap("<div class='bottom-bar'></div>");var t=v.$.find(".bottom-bar"),e=v.$.find(".con");t.insertAfter(e),v.$.find(".window-list-edit").addClass("elite-timer-edit"),v.addToAlertLayer()}(),function(){var t=v.$.find(".all-options");for(var e in o)B(t,o[e],0);for(var e in l)B(t,l[e],1)}(),v.$.find(".header").html(_t("elite_timer",null,"elite_timer")),v.center(),F(),t.stopPropagation()):L()}))}function j(t){const e=t.minResp<=unix_time()&&!(t.presp<=unix_time())?"text-orange":"",i=t.presp<=unix_time()?"text-red":"",n=isset(p[t.type])?p[t.type].fullname:"";var a='<span class="elite_timer_tip_name">'+t.name+"</span>";return a+=n?`<i>${n}</i>`:"",isset(t.user)||(a+='<span class="elite_timer_tip_map">',1==t.type?a+=t.map+" ("+t.x+","+t.y+")":a+=t.map,a+="</span>"),isset(t.minResp)?(a+=`<br><span class="elite_timer_tip_date">${_t("resp_time",null,"elite_timer")}</span>`,a+=`<span class="elite_timer_tip_date ${e}">`,a+=_t("min %date%",{"%date%":ut_fulltime(t.minResp,!0)},"elite_timer"),a+="</span>",a+=`<span class="elite_timer_tip_date ${i}">`,a+=_t("max %date%",{"%date%":ut_fulltime(t.presp,!0)},"elite_timer"),a+="</span>"):(a+='<span class="elite_timer_tip_date">',a+=_t("date %date%",{"%date%":ut_fulltime(t.presp,!0)},"elite_timer"),a+="</span>"),a+=`\n\t\t\t<br/>\n\t\t\t${_t("character",null,"elite_timer")}: ${t.heroData.name} ${t.heroData.lvl}${t.heroData.prof}<br/> \n\t\t\t${_t("world",null,"elite_timer")}: <span class="first-letter-upper">${t.heroData.world}</span>\n\t\t`,t.heroData.id!==Engine.hero.d.id&&(a+="<br/><br/>"+_t("click",null,"elite_timer")),a}function q(t){var e=t%60,i=(t-=e)%3600,n=i/60,a=(t-=i)/3600;e<0&&(e=0),n<0&&(n=0),a<0&&(a=0);var s=(a<10?"0":"")+a,r=(n<10?"0":"")+n,o=(e<10?"0":"")+e;return a>99&&(s=r=o="99"),[s,r,o]}function K(t){var e,i=$(this).parents(".row");for(var n in i.remove(),g){const t=g[n];if(t.$.is(i)){e=t,isset(e.type)&&"hero"===e.type&&A(t),g.splice(n,1);break}}$(".scroll-wrapper",m.$).trigger("update"),Q(),J(),N()}function Y(){at($(this).parents(".row").data("obj"))}function z(t,e,i){var n=unix_time(),a=e.$;if(M(n,e))return g.splice(i,1),isset(a)&&a.remove(),void $(".scroll-wrapper",m.$).trigger("update");if(!isset(e.$)){a=$("<div>").addClass("row tw-list-item do-action-cursor");var s=$("<div>").addClass("col").appendTo(a),r=$("<div>").addClass("col").appendTo(a),o=$("<div>").addClass("name cell").appendTo(s),l=$("<div>").addClass("time cell").appendTo(r),c=$("<div>").addClass("name-val").appendTo(o),d=$("<div>").addClass("btn btn-opt").hide().appendTo(l),h=$("<div>").addClass("btn btn-del").hide().appendTo(l),u=$("<div>").addClass("time-val").appendTo(l);c.text(X(e.type)+e.name),isset(e.heroData)&&o.on("dblclick",()=>{e.heroData.id!==Engine.hero.d.id&&Engine.changePlayer.changePlayerRequest(e.heroData.id)}),isset(e.minResp)&&d.addClass("disabled"),h.on("click",K).tip(_t("delete",null,"buttons")),d.on("click",Y).tip(_t("edit")),a.on("mouseover",(function(){o.addClass("min"),l.addClass("big"),h.show(),d.show()})),a.on("mouseout",(function(){o.removeClass("min"),l.removeClass("big"),h.hide(),d.hide()})),e.$=a,e.$time=u,a.data("obj",e),t.append(a)}const p=j(e);e.$.find(".name.cell").tip(p),e.$.find(".time-val").tip(p),et(e,n);var f=q(e.presp-n),v=f[0]+":"+f[1]+":"+f[2],E=e.$time;E.text()!=v&&E.text(v),$(".scroll-wrapper",m.$).trigger("update")}function X(t){return isset(p[t])?`[${p[t].short}] `:""}function Q(){var t=m.$.find(".npc-list");for(var e in g)z(t,g[e],e);0==g.length?m.$.find(".empty").show():m.$.find(".empty").hide(),P()}function J(){Z();var t=null;for(var e in g){var i=g[e].$;if(null!==t){var n=i.detach();t.after(n)}t=i}$(".scroll-wrapper",m.$).trigger("update")}function Z(){g.sort((function(t,e){return t.presp-e.presp}))}function tt(t){for(var e in g){var i=g[e];if(isset(t.user)&&isset(i.user)&&i.name==t.name&&i.user==t.user||!isset(t.user)&&!isset(i.user)&&i.id==t.id&&i.heroData.world==t.heroData.world)return e}return-1}function et(t,e){var i=0!=e;now=i?e:unix_time();let n=0;t.presp-now<=0?n=2:isset(t.minResp)&&now>=t.minResp&&(n=1);var a=h[n],s=function(t){return h.filter(e=>e!=t)}(a);(function(t,e,i){if(t.hasClass("changing"))return!1;if(!t.hasClass(e))return!0;for(var n in i)if(t.hasClass(i[n]))return!0})(t.$,a,s)&&(i?(!function(t){if(0==u.sound)return;1==t&&Engine.soundManager.createNotifSound(5)}(n),t.$.addClass("changing").finish().addClass(a,1e3).removeClass(s).removeClass("changing",1200)):t.$.addClass("changing").finish().addClass(a).removeClass(s).removeClass("changing"))}function it(t,e){t.tip=j(t),-1==e?g.push(t):(t.$=g[e].$,t.$time=g[e].$time,t.$.find(".name").tip(t.tip),t.$.find(".name-val").text(X(t.type)+t.name),t.$.find(".time-val").tip(t.tip),et(t,0),g[e]=t),Q(),J(),N()}function nt(t){$(t.target).closest(b).length||W()}function at(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(b.find("input").val(""),null!==t){b.find(".iname input").val(t.name),b.data("obj",t);var e=b.find(".itime input"),i=unix_time(),n=t.presp-i,a=q(n);t.$.find(".col").hide(),t.$.append(b.detach()),e.each((function(t){$(this).val(a[t])})),_=!1,C=!1}else w.is(":visible")||(w.show(),w.append(b),m.$.find(".scrollbar-wrapper").addClass("is-input-show"),_=!0,b.find(".iname input").focus(),C=!0);$(document).on("mousedown",nt)}function st(t){var e=tt(t);if(-1==e){var i={};isset(t.user)?i.user=t.user:(i.char=t.char,i.id=t.id,i.map=t.map,i.type=t.type,i.x=t.x,i.y=t.y),i.heroData=t.heroData,i.name=t.name,i.presp=t.presp,isset(t.minResp)&&(i.minResp=t.minResp),g.push(i)}else g[e].name=t.name,g[e].presp=t.presp,g[e].minResp=t.minResp,g[e].tip=j(g[e]),isset(g[e].$)&&(g[e].$.find(".name").tip(g[e].tip),g[e].$.find(".name-val").text(g[e].name))}function rt(){return{id:Engine.hero.d.id,name:Engine.hero.d.nick,lvl:Engine.hero.d.lvl,prof:Engine.hero.d.prof,world:Engine.worldConfig.getWorldName()}}this.add=function(t,e){it({name:t,user:1,presp:unix_time()+(e>0?e:0),heroData:rt()},-1)},this.manageVisible=function(){u.show=!u.show,u.show?(m.show(),m.setWndOnPeak(),m.updatePos()):m.hide(),R()},this.start=function(){if(i)return;var a;i=!0,E=$("\n\t\t  <style>\n\t\t\t.elite-timer .content{\n\t\t\t\tpadding: 0;\n\t\t\t\tmargin: -12px -20px -18px -20px;\n\t\t\t}\n\t\t\t.elite-timer .header{\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t.elite-timer .scrollable .scrollbar-wrapper.is-input-show{\n\t\t\t\tbottom: 47px !important;\n\t\t\t}\n\t\t\t/*list main window*/\n\t\t\t.elite-timer .window-list{\n\t\t\t\tpadding-top: 5px;\n\t\t\t}\n\t\t\t.elite-timer .npc-list{\n\t\t\t\tdisplay: table;\n\t\t\t\ttext-align: left;\n\t\t\t\tborder-collapse: collapse;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t.elite-timer .row{\n\t\t\t\tfont-size: 11px;\n\t\t\t\theight: 22px;\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.elite-timer .row.long{\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.elite-timer .row.short{\n\t\t\t\tcolor: orange;\n\t\t\t}\n\t\t\t.elite-timer .row.pass{\n\t\t\t\tcolor: red;\n\t\t\t}\n\t\t\t.elite-timer .row .col{\n\t\t\t\tdisplay: table-cell;\n\t\t\t}\n\t\t\t.elite-timer .row .col .cell{\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t.elite-timer .row .col .name{\n\t\t\t\twidth: 170px;\n\t\t\t}\n\t\t\t.elite-timer .scroll-wrapper.scrollable .row .col .name{\n\t\t\t\twidth: 155px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .time{\n\t\t\t\tmargin-left: 3px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .time-val{\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tmargin-left: 6px;\n\t\t\t\twidth: 44px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .name-val{\n\t\t\t\twidth: 100%;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\t\t\t.elite-timer .row .col .min{\n\t\t\t\twidth: 142px;\n\t\t\t}\n\t\t\t.elite-timer .scroll-wrapper.scrollable .row .col .min{\n\t\t\t\twidth: 127px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .btn{\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 2px;\n\t\t\t\twidth: 12px;\n\t\t\t\theight: 12px;\n\t\t\t\tbackground: red;\n\t\t\t}\n\t\t\t.elite-timer .row .col .btn-opt{\n\t\t\t\tbackground: url('img/gui/buttony.png') -608px -118px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .btn-opt:hover{\n\t\t\t\tbackground: url('img/gui/buttony.png') -660px -118px;\n\t\t\t}\n\t\t\t.elite-timer .row .col .btn-opt.disabled{\n\t\t\t\tpointer-events: none;\n\t\t\t\tvisibility: hidden;\n\t\t\t}\n\t\t\t.elite-timer .npc-list .row .col .btn-del{\n\t\t\t  margin-left: 3px;\n\t\t\t\tbackground: url('img/gui/buttony.png') -625px -118px;\n\t\t\t}\n\t\t\t.elite-timer .npc-list .row .col .btn-del:hover{\n\t\t\t\tbackground: url('img/gui/buttony.png') -727px -118px;\n\t\t\t}\n\t\t\t/*scroll main window*/\n\t\t\t.elite-timer .scrollable .scroll-pane{\n\t\t\t\tpadding-right: 12px;\n\t\t\t}\n\t\t\t/*add main window*/\n\t\t\t.elite-timer .window-controlls{\n\t\t\t\tmargin-top: 1px;\n\t\t\t}\n\t\t\t/*button add main window*/\n\t\t\t.elite-timer .window-controlls .add{\n\t\t\t\toverflow: hidden;\n\t\t\t}\n\t\t\t/*.elite-timer .window-controlls .add .btn-add{*/\n\t\t\t/*\twidth: 12px;*/\n\t\t\t/*\theight: 12px;*/\n\t\t\t/*\tbackground: url('https://dzik.margonem.pl/img/minutnik_plus.png');*/\n\t\t\t/*\tmargin-left: auto;*/\n\t\t\t/*\tmargin-right: auto;*/\n\t\t\t/*\tmargin-top: 5px;*/\n\t\t\t/*}*/\n\t\t\t/*inputs add main window*/\n\t\t\t.elite-timer .inp{\n\t\t\t\tpadding-left: 1px;\n\t\t\t\tpadding-right: 1px;\n\t\t\t}\n\t\t\t.elite-timer .inp input{\n\t\t\t\theight: 12px;\n\t\t\t\tcolor: white;\n\t\t\t\tvertical-align: 0;\n\t\t\t\tfont-size: 11px;\n\t\t\t}\n\t\t\t.elite-timer .inp .input-wrapper{\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.elite-timer .inp .iname input{\n\t\t\t\twidth: 144px;\n\t\t\t}\n\t\t\t.elite-timer .scroll-wrapper.scrollable .inp .iname input{\n\t\t\t\twidth: 130px;\n\t\t\t}\n\t\t\t.elite-timer .inp .itime input{\n\t\t\t\twidth: 15px;\n\t\t\t}\n\t\t\t/*edit window*/\n\t\t\t.elite-timer-edit{\n\t\t\t\twidth: 290px;\n\t\t\t\theight: 277px;\n\t\t\t}\n\t\t\t.elite-timer-edit .con .all-options{\n\t\t\t\tmargin: auto;\n\t\t\t\twidth: 260px;\n\t\t\t}\n\t\t\t.elite-timer-edit input{\n\t\t\t\tcolor: white;\n\t\t\t\twidth: 90px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\t\t\t.elite-timer-edit input.sec-inp{\n\t\t\t\tcolor: white;\n\t\t\t\twidth: 66px;\n\t\t\t}\n\t\t\t.elite-timer-edit .sec-txt{\n\t\t\t\tcolor: white;\n\t\t\t\tmargin-left: 5px;\n\t\t\t}\n\t\t\t.elite-timer-edit .info-icon{\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 2px;\n\t\t\t\tright: 4px;\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\tbackground: url('img/gui/buttony.png') no-repeat -499px -199px;\n\t\t\t}\n\t\t\t.elite-timer-edit .window-list-option{\n\t\t\t\tleft: -7px;\n\t\t\t}\n\t\t\t.elite_timer_tip_name{\n\t\t\t\tfont-weight: bold;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t\t.elite_timer_tip_map{\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t\t.elite_timer_tip_date{\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t  </style>").appendTo("head"),(m=Engine.windowManager.add({content:API.Templates.get("window-list"),title:e,nameWindow:t,widget:Engine.widgetsData.name.addon_17,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:251,y:100},onclose:()=>{n.manageVisible()}})).$.addClass("elite-timer"),m.$.find(".window-list").addClass("elite-timer-wnd"),m.$.find(".list").addClass("npc-list"),m.hide(),m.addToAlertLayer(),m.updatePos(),b=$("<div>").addClass("inp"),API.Templates.get("input").appendTo(b).addClass("iname").children().attr("placeholder",_t("name",null,"elite_timer")),API.Templates.get("input").appendTo(b).addClass("itime").children().attr("placeholder","0").on("keydown",G).on("keyup",G).attr("maxlength",5).on("click",(function(){$(this).select()})),API.Templates.get("input").appendTo(b).addClass("itime").children().attr("placeholder","0").on("keydown",H).on("keyup",H).attr("maxlength",2).on("click",(function(){$(this).select()})),API.Templates.get("input").appendTo(b).addClass("itime").children().attr("placeholder","0").on("keydown",H).on("keyup",H).attr("maxlength",2).on("click",(function(){$(this).select()})),b.children().on("keypress",(function(t){"13"==(t.keyCode?t.keyCode:t.which)&&W()})).on("mousedown",(function(){C=!0})),a=m.$.find(".window-controlls"),w=$("<div>").addClass("row row-input tw-list-item").hide().prependTo(a),function(){var t=m.$.find(".window-controlls");t.show();var e=$("<div>").addClass("row row-add tw-list-item").on("click",(function(){at()})),i=$("<div>").addClass("add do-action-cursor").appendTo(e);$("<div>").addClass("btn-add").appendTo(i),t.append(e)}(),U(),m.$.find(".scroll-wrapper").addScrollBar({track:!0}),m.$.find(".content").find(".scrollbar-wrapper").css({top:-11,bottom:22});let{skippedDeads:r=[],data:o={},settings:l={}}=Engine.serverStorage.get(t)||{};f=r,function(){let t=0;for(let e in f)f[e].presp<=Math.ceil(unix_time(!0))&&(f.splice(e,1),t++);t>0&&x()}(),u={...u,...l};for(const t in o)st(o[t]);Z(),null!==m&&Q(),function(){if(Engine.dead)return;S({id:Engine.hero.d.id,nick:Engine.hero.d.nick,sec:0})}(),u.show?(m.show(),m.setWndOnPeak()):m.hide(),API.addCallbackToEvent(Engine.apiData.REMOVE_NPC,T),API.addCallbackToEvent(Engine.apiData.HERO_DEAD,S),API.addCallbackToEvent(Engine.apiData.ITEM_USED,k),s=setInterval(Q,1e3)},this.stop=function(){i&&(i=!1,API.removeCallbackFromEvent(Engine.apiData.REMOVE_NPC,T),API.removeCallbackFromEvent(Engine.apiData.HERO_DEAD,S),API.removeCallbackFromEvent(Engine.apiData.ITEM_USED,k),clearInterval(s),s=null,L(),m.remove(),m=null,E.remove())}}},function(t,e,i){var n=i(17);t.exports=function(){let t=Engine.windowsData.name.addon_19;var e=!1,i=null,a=null,s=null,r=null,o={working:!0,clan:!0,friend:!0,friend_clan:!0,other:!1};function l(t,e){if(function(t){if(o.working){if(o.clan&&t==n.RELATION.CLAN)return!0;if(o.friend&&t==n.RELATION.FRIEND)return!0;if(o.friend_clan&&t==n.RELATION.CLAN_ALLY)return!0;if(o.other)return!0}return!1}(t)){var i=e[1].$backdrop;e[1].$.remove(),i&&e[1].$backdrop.remove(),delete e[1],_g(e[0].re+"1")}}function c(t){var e=function(t){var e=i.exec(t);return null!==e&&isset(e[1])?e[1]:null}(t[0].q);null!==e&&function(t,e,i){e||(e=function(){});var n=!0,a=function(a){a.nick==t&&n&&(e(a.d.relation,i),n=!1)};API.addCallbackToEvent(Engine.apiData.NEW_OTHER,a),API.removeCallbackFromEvent(Engine.apiData.NEW_OTHER,a),n&&e("",i)}(e,l,t)}function d(){API.Storage.set(t+"/conf",o)}function h(){const t=[_t("turn_on",null,"auto_accept_party"),_t("turn_off",null,"auto_accept_party")],e=r.find(".label");let i;o.working?(i=t[1],a.$.removeClass("disabled")):(i=t[0],a.$.addClass("disabled")),e.html(i)}function u(){a.$.find(".window-controlls").show(),r=API.Templates.get("button"),a.$.find(".window-controlls").append(r),r.addClass("small green turn-on-btn"),r.find(".label").html("-"),r.click((function(){o.working=!o.working,h(),d()})),h()}function p(t,e){o[e]?t.addClass("active"):t.removeClass("active")}function g(t,e,i){var n=API.Templates.get("one-checkbox").addClass("do-action-cursor");n.find(".label").html(i);var a=n.find(".checkbox");p(a,e),n.click((function(){o[e]=!o[e],p(a,e),d()})),t.append(n)}this.manageVisible=function(){a.isShow()?a.hide():(a.show(),a.setWndOnPeak())},this.start=function(){if(!e){e=!0,i=isPl()?/Czy chcesz dołączyć do drużyny gracza <strong>(.*)<\/strong>\?/:/Party invitation received from <strong>(.*)<\/strong>\. Would you like to join\?/;var n,r,l,d,h=API.Storage.get(t+"/conf",o);for(var p in h)o[p]=h[p];n=_t("intro",null,"auto_accept_party"),r=$("<div>").addClass("intro").text(n),(l=$("<div>").addClass("auto_accept_party")).append(r),(a=Engine.windowManager.add({content:l,title:_t("title",null,"auto_accept_party"),nameWindow:t,widget:Engine.widgetsData.name.addon_19,type:Engine.windowsData.type.TRANSPARENT,manageShow:!1,managePosition:{x:251,y:60},onclose:()=>{a.hide()}})).$.addClass("auto_accept_party_wnd"),a.updatePos(),a.addToAlertLayer(),a.$.find(".content").css({"padding-bottom":7}),g(d=a.$.find(".auto_accept_party"),"clan",_t("clan",null,"auto_accept_party")),g(d,"friend",_t("friend",null,"auto_accept_party")),g(d,"friend_clan",_t("friend_clan",null,"auto_accept_party")),g(d,"other",_t("other",null,"auto_accept_party")),u(),s=$("<style>\n\t\t\t.auto_accept_party .intro{\n\t\t\t\tmargin-bottom: 12px;\n\t\t\t\tmargin-top: 2px;\n\t\t\t}\n\t\t\t.auto_accept_party{\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.auto_accept_party_wnd .window-controlls {\n\t\t\t\tmargin-top: 2px;\n\t\t\t}\n\t\t</style>").appendTo("head"),API.addCallbackToEvent(Engine.apiData.NEW_ASK,c)}},this.stop=function(){e&&(e=!1,i=null,a.remove(),a=null,s.remove(),API.Storage.remove(t,!0),API.removeCallbackFromEvent(Engine.apiData.NEW_ASK,c))}}},function(t,e,i){const n=i(16),{CL:a}=i(15);t.exports=function(){var t=!1,e=!1,i=null,s=null,r=null;const o=["fight","dialog"];var l=0,c={},d=0;let h=Engine.windowsData.name.addon_20;var u=["upgby","artefact","legendary","heroic","upgraded","runes","expadd","perheal","revive","action"];function p(t,e,i,n){if("object"==typeof t.val){for(var a in t.val)if(_(n,t.val[a],t.test,i))return!0}else if(_(n,t.val,t.test,i))return!0;return!1}function g(t,e,i,n){return e.cl==t.val}var f={minval:new v((function(t,e,i,n){return e.pr>=parseInt(i)}),null,null,null,{type:n.TYPE.NUMBER_WITH_KMG}),minheal:new v(p,["leczy","fullheal"],(function(t,e){if(0!=e&&t>=e)return!0;return!1}),!1,{suffix:T("hp"),type:n.TYPE.NUMBER_WITH_KMG}),unique:new E((function(t,e,i,n){if(p(t,e,i,n))return!0;if(isset(n.rarity))if("object"==typeof t.val){if(t.val.includes(e.itemTypeName))return!0}else if(e.itemTypeName===t.val)return!0;return!1}),"unique",0,!0),key:new E(g,a.KEYS,0,!0),bag:new E(g,a.BAG),gold:new E(p,"gold",0,!0),bless:new E(g,a.BLESS,0,!0),teleport:new E(g,a.TELEPORTS),talismans:new E(g,a.TALISMAN),quest:new E((function(t,e,i,n){return!(!isset(n.quest)&&19!==e.cl)}),0,0,!0),neutral:new E(g,a.NEUTRAL)};function m(){this.testFunc=arguments[0],this.val=arguments[1],this.test=arguments[2],this.defaultVal=arguments.length>=3&&arguments[3]}function v(){this.options={},isset(arguments[4])&&(this.options={...this.options,...arguments[4]}),m.apply(this,arguments)}function E(){m.apply(this,arguments)}function _(t,e,i,n){return!(!isset(t[e])||i&&!i(t[e],n))}function b(t){e&&isset(t.init)&&(c={},d=Engine.heroEquipment.getFreeSlots(),r=o.includes(t.source),l=Object.keys(t.states).length)}function w(t,i){if(e&&r){var n,a=function(t){var e=t.parseStats();if(function(t,e){for(var i in u){var n=u[i];if(isset(e[n])||t.itemTypeName===n)return!0}return!1}(t,e))return!0;for(var i in f){var n=f[i];let a=A(i,n.defaultVal);if(!1!==a&&n.testFunc(n,t,a,e))return!0}return!1}(t),s=Engine.loots.states;n=a?Engine.loots.getGroupped()?s[2].key:s[1].key:s[0].key,c[t.id]=n,i&&function(){!function(){let t=A("auto_accept",!1),e=l<=d;return!(!t||!e)}()?Engine.loots.setLootItems(c):Engine.loots.finalize(c);l=0,c={}}()}}function C(){i.hide()}function T(t){return _t(t,null,"lootfilter")}function y(t,e,i){t[e]=i}function I(t,e){let i=function(t){let e=Engine.hero.d.id,i={};return i[h]={person:{}},i[h].person[e]=t,i}(t);Engine.serverStorage.sendData(i,()=>{e&&e()})}function A(t,e){let i=isset(e)?e:null,n=Engine.serverStorage.get(h),a=Engine.hero.d.id;return n&&n.person&&n.person[a]&&n.person[a].hasOwnProperty(t)?n.person[a][t]:i}function k(){i.$.removeClass("disabled"),i.$.addClass(e?"":"disabled")}function S(){var t=[_t("turn_on",null,"loot"),_t("turn_off",null,"loot")],n=i.$.find(".turn-on-btn").find(".label"),a=e?t[1]:t[0];n.html(a)}function O(t){var e=T("confirm_auto_accept_info"),i=[{txt:_t("ok",null,"buttons"),callback:function(){return t(!0),!0}},{txt:_t("cancel",null,"buttons"),callback:function(){return t(!1),!0}}];mAlert(e,i,(function(t){t.$.addClass("askAlert")}))}function M(t,e,i){let n={};y(n,e,i),I(n,()=>{x(t,e)})}function N(t,e,i){var n=API.Templates.get("one-checkbox").addClass("row do-action-cursor");n.find(".label").html(T(e)+": ");var a=n.find(".checkbox");x(a,e),n.click((function(){let t=A(e,!1);if(i&&!t){i((function(i){i&&M(a,e,!t)}))}else M(a,e,!t)})),t.append(n)}function R(t,e,i){var n=$("<div>").addClass("row"),a=API.Templates.get("input");$("<span>").addClass("label").html(T(e)+": ").appendTo(n),a.find("input").attr("name","lf_"+e),a.appendTo(n);var s=a.find("input");!function(t,e,i){var n=i;null===i&&(n=A(e,0));t.val(n)}(s,e,null),setInputMask(s,i.type),isset(i.suffix)&&0!=s.val()&&s.val(s.val()+i.suffix),s.change((function(){var t=function(t,e,i){i&&(e=e.split(i).join("")),e=parsePrice(e),checkParsePriceValueIsCorrect(e)||(e=0);var n=e;return i&&0!=e&&(e+=i),t.val(e),n}($(this),$(this).val(),i.suffix);let n={};y(n,e,t),I(n)})),t.append(n)}function x(t,e){var i=!1;isset(f[e])&&(i=f[e].defaultVal),A(e,i)?t.addClass("active"):t.removeClass("active")}function L(){e=!e,k(),S(),API.Storage.set(h+"/works",e)}function D(){var t,e;s=$("<style>\n\t\t\t.loot-filter{\n\t\t\t\tmargin-top: 11px;\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t\t.loot-filter-window .content{\n\t\t\t\tmargin: -5px -15px;\n\t\t\t\twidth: 210px;\n\t\t\t}\n\t\t\t.loot-filter .one-checkbox .checkbox{\n\t\t\t\tfloat: right;\n\t\t\t}\n\t\t\t.loot-filter .label{\n\t\t\t\tfloat: left;\n\t\t\t}\n\t\t\t.loot-filter .input input{\n\t\t\t\tborder: 1px solid grey;\n\t\t\t\twidth: 50px;\n\t\t\t\tcolor: white;\n\t\t\t\ttext-align: right;\n\t\t\t}\n\t\t\t.loot-filter .row{\n\t\t\t\tclear: both;\n\t\t\t}\n\t\t\t.loot-filter .row:first-child.one-checkbox{\n\t\t\t\theight: 30px;\n\t\t\t}\n\t\t\t.loot-filter .input{\n\t\t\t\tfloat: right;\n\t\t\t\tmargin-top: -6px;\n\t\t\t\tmargin-bottom: 8px;\n\t\t\t}\n\t\t\t.loot-filter .button-container{\n\t\t\t\ttext-align: center;\n\t\t\t}\n\t\t\t.loot-filter-window .window-controlls {\n\t\t\t\tmargin-top: 2px;\n\t\t\t}\n\t\t\t</style>").appendTo("head"),t=$("<div>").addClass("loot-filter"),(i=Engine.windowManager.add({content:t,title:_t("loot-filter",null,"widgets-tip"),nameWindow:h,widget:Engine.widgetsData.name.addon_20,type:Engine.windowsData.type.TRANSPARENT,addClass:"loot-filter-window",manageOpacity:3,managePosition:{x:251,y:60},manageShow:!1,onclose:()=>{C()}})).addToAlertLayer(),i.updatePos(),function(){var t=i.$.find(".loot-filter");for(var e in N(t,"auto_accept",O),f){var n=f[e];n instanceof v?R(t,e,n.options):n instanceof E&&N(t,e)}}(),e=API.Templates.get("button").addClass("small green turn-on-btn"),i.$.find(".window-controlls").append(e).show(),e.click(L),k(),S(),Engine.items.fetch(Engine.itemsFetchData.FETCH_NEW_LOOT,w),API.addCallbackToEvent(Engine.apiData.LOOT_UPDATE,b)}this.manageVisible=function(){i.isShow()?C():(i.show(),i.setWndOnPeak(),i.updatePos())},this.start=function(){t||(t=!0,function(){let t={};e=API.Storage.get(h+"/works",e),null===A("minval")&&y(t,"minval",0),null===A("minheal")&&y(t,"minheal",0),Object.keys(t).length?I(t,()=>{D()}):D()}())},this.stop=function(){t&&(t=!1,i.close(),i.remove(),i=null,e=!1,API.Storage.remove(h,!0),Engine.items.removeCallback(Engine.itemsFetchData.FETCH_NEW_LOOT),API.removeCallbackFromEvent(Engine.apiData.LOOT_UPDATE,b),s.remove())}}},function(t,e,i){const{copyToClipboard:n}=i(2),a=i(40),s=i(23),r=i(7),o=i(9);t.exports=function(){const t=Engine.windowsData.name.addon_24,e=A("heros-detector");var i=!1,l=[],c=null;let d=null,h=null;const u="HEROES",p="EVENT_HEROES",g="TITANS",f="COLOSSUS",m="SPECIAL_NPC",v="ALCHEMIST_BAGS",E="RESOURCES",_={[u]:{checked:!0},[g]:{checked:!0},[f]:{checked:!0},[m]:{checked:!0},[v]:{checked:!0},[E]:{checked:!0}},b={[u]:{name:A("heros"),showNameInMessage:!0,canFindGroup:!0},[p]:{name:A("heros"),showNameInMessage:!0,canFindGroup:!0},[g]:{name:A("titan"),showNameInMessage:!0,canFindGroup:!0},[f]:{name:A("colossus"),showNameInMessage:!0,canFindGroup:!0},[m]:{name:A("special-npc"),showNameInMessage:!1,canFindGroup:!0,idsPl:[170014,173615,182963,190415,190417,190420,190421,190422,190423,190424,190425,190426,190428,190429,190430,190431,190432,190433,190434,190435,190436,215338,215339,215340,215341,215342,215343,215344,215345,215346,215347,215347,215349,215350,215351,215352,215353,215354,215355,215356,215359,266720,250068,250069,250070,250071,250072,250073,250074,250075,250076,250077,282581,282583,282584,282585,282586,282587,282588,282589,282590,282591,289062,289063,289064,289065,289066,289067,289068,289069,289070,289071,289072,289073,289074,289075,289076,289077,289078,289079,289080,289081,236992,295610,295611,295612,295613,295614,295615,295616,295617,295618,295619,295620,308322,308323,308324,308345,304710,304711,304712,304713,304714,304715,304716,304717],idsCom:[151281,151282,151283,151284,151285,151286,151288,151289,151290,153211,153212,153213,153214,153215,153216,153217,153218,153219,153220,153221]},[v]:{name:A("alchemist-bag"),showNameInMessage:!1,canFindGroup:!1,ids:[192201,192202,192203,192204,192205,192206]},[E]:{name:A("resources"),showNameInMessage:!1,canFindGroup:!1,ids:[69871]}};function w(t){return b[t].name}function C(){!function(){const t=c.el.querySelector(".btns-container"),e=[{text:_t("save",null,"buttons"),classes:["small","green"],action:()=>(Engine.serverStorage.sendData({[r.ADDON_24]:{data:h}},()=>{d=JSON.parse(JSON.stringify(h)),T()}),void W())}];for(const i of e){const e=new s.default(i).getButton();t.appendChild(e)}}()}function T(){const t=function(){const t=Engine.serverStorage.get(r.ADDON_24);return t?{..._,...t.data}:_}();d=JSON.parse(JSON.stringify(t)),h=JSON.parse(JSON.stringify(t))}function y(){for(const t in h){const{checked:e}=h[t],i=c.el.querySelector(".checkboxes"),n=w(t),s=new a.default({name:"npc_"+t,label:n,value:t,i:t,checked:e},e=>I(e,t)).getCheckbox();i.appendChild(s)}}function I(t,e){const i=t.target.checked;h[e].checked=i}function A(t,e){return _t(t,e,"heros-detector")}function k(t,e,i,n){const a=A("go");var s,r,o,l;s=t,r=a,o=()=>{Engine.hero.autoGoTo({x:n.d.x,y:n.d.y})},(l=API.Templates.get("button")).addClass("small green"),l.on("click",o),s.append(l),l.find(".label").html(r)}function S(t,e,i,n){if(n.npcType===E)return;const a=[];Engine.party&&a.push([A("call-party"),()=>P("party",e,i,n.npcType)]),0!=Engine.hero.d.clan&&a.push([A("call-clan"),()=>P("clan",e,i,n.npcType)]);const s=[u,p];return Engine.worldConfig.getPrivWorld()&&!["pandora","nerthus","syberia"].includes(Engine.worldConfig.getWorldName())&&s.includes(n.npcType)&&a.push([A("call-local"),()=>P("local",n.d.nick,i,n.npcType)]),b[n.npcType].canFindGroup&&a.push([A("find-group"),()=>{const t=function(t){const e={minLvl:null,maxLvl:null},i=t.d.lvl,n=Engine.worldConfig.getDropDestroyLvl(),a=Engine.worldConfig.getPrivWorld();switch(t.npcType){case u:e.minLvl=i>100?i-50:Math.floor(i/2),e.maxLvl=i+n;break;case p:e.minLvl=Math.floor(i/2);break;case m:a?(e.minLvl=i-13,e.maxLvl=i+n):(e.minLvl=i-13,e.maxLvl=i+13);break;case g:case f:e.minLvl=i-13,e.maxLvl=i+13}return e}(n);Engine.worldWindow.open("players-online",{filters:t})}]),!!a.length&&(Engine.interface.showPopupMenu(a,t),!0)}function O(t,e,i,a){var s=function(t){const e=function(t){const e=function(t){return t.d.lvl||t.elasticLevel||""}(t),i=function(t){return t.d.prof||""}(t);return e?` (${e}${i})`:""}(t);return`${t.d.nick} ${e}`.trim()}(e),r=function(t){return A("map-label %map% %x% %y%",{"%map%":Engine.map.d.name,"%x%":t.d.x,"%y%":t.d.y})}(e);const o=function(t,e,i){const a=API.Templates.get("copy-btn"),s=D(t,e,i);return a.tip(_t("copy",null,"heros-detector")),a.on("click",()=>n(s)),a}(s,r,e.npcType);$("<div>").addClass("name-label").text(s).appendTo(t),$("<div>").addClass("map-label").text(r).append(o).appendTo(t),k($("<div>").addClass("btns-container").appendTo(t),0,0,e);var l=CFG.a_npath+e.d.icon,c=new Image;const d=$(c),h=$("<div>",{text:A("RMB-info"),class:"italic text-small mt-1"});if(isset(e.tip)){const t=e.npcType!==E?e.tip[0]+h.prop("outerHTML"):e.tip[0];d.tip(t,e.tip[1])}c.src=l,c.classList.add("icon","do-action-cursor"),c.onload=function(){d.insertBefore(t.find(".btns-container")),i.show(),i.updatePos(),x(i,a)},d.on("contextmenu",t=>{S(t,s,r,e)})}function M(t,i){if(t={...t,npcType:i},Engine.targets.checkExistById(t.d.id)||Engine.targets.addArrow("Npc-"+t.d.id,t.d.nick,t,"Npc","navigate"),null!==function(t){for(var e in l){var i=l[e];if(i.id===t)return i}return null}(t.d.id))return;var n={id:t.d.id,wnd:null};l.push(n);var a=$("<div>").addClass("heros-detector");const s=Engine.windowManager.add({content:a,objParent:n,nameRefInParent:"wnd",title:e,nameWindow:Engine.windowsData.name.addon_24,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:251,y:60},onclose:()=>{L(n)}});s.hide(),s.addControll(_t("close"),"small green",(function(){L(n)})),s.addToAlertLayer(),O(a,t,s,l.length)}function N(t){const e=t.d.id,i=l.find(t=>t.id===e);i&&function(t){const e=F(t),i=[u,g];return i.includes(e)&&t.d.respBaseSeconds>0||!i.includes(e)}(t)&&L(i)}function R(){for(const t in l)L(l[t])}function x(t,e){const i=e;var n=t.$.position();const a=Engine.zoomFactor||1;var s={x:n.left/a,y:n.top/a},r=15*i,o=s.x+r,l=s.y+r,c=$("body").width(),d=$("body").height(),h=l+t.$.height()+30,u=o+t.$.width()+30;h<d&&u<c&&(s.x=o,s.y=l),t.setContentPos(s.x+"px",s.y+"px")}function L(t){var e=l.indexOf(t);-1!==e&&(l[e].wnd.remove(),delete l[e].wnd,l.splice(e,1),Engine.targets.deleteArrow("Npc-"+t.id))}function D(t,e,i){return`${b[i].showNameInMessage?b[i].name+"! ":""}${t}, ${e}`}function P(t,e,i,n){let a,s=D(e,i,n);"party"===t&&(a=o.CHANNEL.GROUP),"clan"===t&&(a=o.CHANNEL.CLAN),"local"===t&&(a=o.CHANNEL.LOCAL,s=A("take_heroes",{"%name%":e})),getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(a)&&Engine.chatController.getChatInputWrapper().sendMessageGhostMessageProcedure(s,a)}function B(t){const e=F(t);e&&d[e===p?u:e].checked&&M(t,e)}function F(t){const e=Number(t.d.id);return isset(t.d.isHeroFromEvent)&&t.d.isHeroFromEvent?p:t.d.wt>=80&&t.d.wt<=89?u:t.d.wt>=90&&t.d.wt<=99?f:t.d.wt>=100&&t.d.wt<=109?g:isPl()&&b[m].idsPl.includes(e)||!isPl()&&b[m].idsCom.includes(e)?m:b[v].ids.includes(e)?v:!!b[E].ids.includes(e)&&E}function W(){c.hide(),c.el.querySelectorAll(".checkboxes").forEach(t=>t.innerHTML=""),h=null}this.onResize=()=>{let t=0;l.map(e=>{let{wnd:i}=e;x(i,t++)})},this.manageVisible=function(){c.isShow()?W():(T(),y(),c.show(),c.setWndOnPeak(),c.updatePos())},this.start=function(){i||(i=!0,T(),$style=$("<style>\n\t\t.heros-detector {\n\t\t\ttext-align: center;\n\t\t\tcolor: white;\n\t\t}\n\t\t.heros-detector .name-label {\n\t\t\tmargin-top: 5px;\n\t\t}\n\t\t.heros-detector .map-label {\n\t\t\tmargin-top: 5px;\n\t\t}\n\t\t.heros-detector .icon {\n\t\t\tmargin: 5px auto;\n\t\t\tmax-width: 100%;\n\t\t\tdisplay: block;\n\t\t}\n\t\t.heros-detector .btns-container {\n\t\t\tmargin-bottom: -10px;\n\t\t}\n\t\t.heros-detector .btns-container .button + .button {\n\t\t\tmargin-top: 3px;\n\t\t}\n\t\t.detector-options-window .heading {\n\t\t\tmargin-bottom: 12px;\n\t\t\tcolor: white;\n\t\t}\n\t\t.detector-options-window .btns-container {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\tmargin-top: 10px;\n\t\t}\n\t\t</style>").appendTo("head"),API.addCallbackToEvent(Engine.apiData.NEW_NPC,B),API.addCallbackToEvent(Engine.apiData.CLEAR_MAP_NPCS,R),API.addCallbackToEvent(Engine.apiData.REMOVE_NPC,(function(t){N(t)})),function(){const i=`\n\t\t\t<div id="${t}">\n\t\t\t\t<div class="heading">${A("heading")}</div>\n\t\t\t\t<div class="checkboxes"></div>\n\t\t\t\t<div class="btns-container"></div>\n\t\t\t</div>\n\t\t`,n=`${e} - ${_t("config-lower")}`;(c=Engine.windowManager.add({content:i,title:n,nameWindow:t+"_settings",widget:Engine.widgetsData.name.addon_24,type:Engine.windowsData.type.TRANSPARENT,managePosition:{x:"251",y:"60"},addClass:"detector-options-window",onclose:()=>{W()}})).el=c.$[0],c.updatePos(),c.addToAlertLayer(),C(),T(),y(),W()}())},this.stop=function(){i&&(i=!1,API.removeCallbackFromEvent(Engine.apiData.NEW_NPC,B),R())}}},function(t,e){t.exports=function(){let t=!1;function e(t){let e=!1,i="";if("unique"===t.itemTypeName?(e=!0,i="#fffb00"):"heroic"===t.itemTypeName?(e=!0,i="#38b8eb"):"legendary"===t.itemTypeName&&(e=!0,i="#ff8400"),e){var n=`[color=${i}][${t.name}][/color]`,a=_t("earn-item %name%",{"%name%":n},"loottext");message(a)}}this.start=function(){t||(t=!0,Engine.items.fetch(Engine.itemsFetchData.FETCH_NEW_LOOT_ITEM,e))},this.stop=function(){t&&(t=!1,Engine.items.removeCallback(Engine.itemsFetchData.FETCH_NEW_LOOT_ITEM))}}},function(t,e,i){i(27);const{copyToClipboard:n}=i(2);t.exports=function(){const t=Engine.windowsData.name.addon_27,e=_t("title",null,"item_frames"),i=CFG.a_ipath+"nas/naswilka5.gif",a=_t("delete",null,"buttons"),s=_t("copy",null,"item_id");let r="",o="",l=!1,c=null;Vue.directive("click-outside",{bind:function(t,e,i){t.clickOutsideEvent=function(n){t==n.target||t.contains(n.target)||i.context[e.expression](n)},document.body.addEventListener("mousedown",t.clickOutsideEvent)},unbind:function(t){document.body.removeEventListener("mousedown",t.clickOutsideEvent)}}),Vue.directive("add-tip",{bind:function(t,e,i){$(t).tip(e.value)}});const d=new Vue({template:`\n            <div>\n                <div class="item-frames__content">\n                    <div class="scroll-wrapper classic-bar">\n                        <div class="scroll-pane">\n                            <div class="scroll-pane-content">\n                                <div class="item-frames__list">\n                                    <div v-for="item in list" class="item-frames__list-el tw-list-item" @click="presetOnClick(item)" :class="{ active: item.active }">\n                                        <div class="item-frames__overview">\n                                            <div v-for="(n, i) in 6" :key="n" class="item-frames__overview-one" :style="getStyles(item, i)">\n                                                <img src="${i}">\n                                            </div>\n                                        </div>\n                                        <div class="item-frames__remove" v-if="item.source === 'outer'" @click.stop="removeOnClick(item)" v-add-tip="'${a}'"></div>\n                                        <div class="item-frames__copy copy-btn" v-if="item.source === 'outer'" @click.stop="copyOnClick(item.url)" v-add-tip="'${s}'"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <ifc-adder @addFrame="addFrame"></ifc-adder>\n            </div>\n        `,data:{list:[]},mounted(){this.list=this.checkDataIsset()?this.getSavedData():this.createDefaultData(),this.setFramesOnItems(this.getActivePreset)},updated(){h()},computed:{getActivePreset:function(){return preset=this.list.filter((function(t){return!0===t.active}))[0]}},methods:{getSavedData:()=>Engine.serverStorage.get(t,"framesTab"),createDefaultData(){let t=[];for(let e=0;e<7;e++)t.push({source:"inner",offset:e,active:0===e});return t},checkDataIsset(){let t=this.getSavedData();return!(null===t||0===t.length)},getStyles:(t,e)=>({"background-image":`url('${t.url?t.url:"../img/gui/it_borders.png"}')`,"background-position":`${-32*e}px ${-32*t.offset}px`}),getBackground:t=>`url('${t.url?t.url:"../img/gui/it_borders.png"}')`,presetOnClick(t){this.setActiveItem(t),this.saveData(),this.setFramesOnItems(t)},setFramesOnItems(t){r=-32*t.offset+"px",o=t.url?t.url:"../img/gui/it_borders.png",Engine.map.groundItems.changeFrames(o,t.offset),p(),u()},setActiveItem(t){this.list.map(e=>e.active=e===t)},addFrame(t){const e={source:"outer",offset:0,active:!1,url:t};this.list.push(e),this.setActiveItem(e),this.saveData(),this.setFramesOnItems(e),$(".scroll-wrapper",c.$).trigger("scrollBottom")},saveData(e){Engine.serverStorage.sendData({[t]:{framesTab:this.list}},e)},removeOnClick(t){const e=[{txt:_t("yes",null,"buttons"),callback:()=>(this.removePreset(t),!0)},{txt:_t("no",null,"buttons"),callback:()=>!0}];return mAlert(_t("remove_confirm",null,"item_frames"),e),!1},copyOnClick(t){n(t)},removePreset(t){const e=this.list.indexOf(t);if(t.active){const t=this.list[e-1];this.setActiveItem(t),this.setFramesOnItems(t)}this.list.splice(e,1),this.saveData()}}});function h(){$(".scroll-wrapper",c.$).trigger("update")}function u(){const t=stringToHtml(f());document.head.appendChild(t)}function p(){const e=document.getElementById(t+"-style");e&&e.parentNode.removeChild(e)}function g(){c.hide()}Vue.component("ifc-adder",{template:'\n        <div class="window-controlls" style="display:block" v-click-outside="clearAndHide">\n            <div class="row row-input tw-list-item" :class="{ active: inputShow }">\n                <div class="input-wrapper">\n                    <input class="default" :placeholder="placeholder" v-model="value" @keyup.enter="addNew" ref="addInput">\n                </div>\n            </div>\n            <div class="row row-add tw-list-item" @click="addNew">\n                <div class="add do-action-cursor">\n                    <div class="btn-add"></div>\n                </div>\n            </div>\n        </div>\n        ',data:function(){return{inputShow:!1,value:"",placeholder:_t("input_label",null,"item_frames")}},methods:{addNew(){this.inputShow?""===this.value?this.inputShow=!1:this.save():(this.inputShow=!0,this.focusAddInput())},checkHttps:t=>!!t.startsWith("https://")||(message(_t("https_alert",null,"item_frames")),!1),save(){this.checkHttps(this.value)&&(this.$emit("addFrame",this.value),this.clearAndHide())},focusAddInput(){this.$nextTick(()=>{this.$refs.addInput.focus()})},clearAndHide(){this.value="",this.inputShow=!1}}}),this.manageVisible=function(){c.isShow()?g():(c.show(),c.setWndOnPeak(),h())},this.start=function(){l||(l=!0,u(),function(){c=Engine.windowManager.add({content:$(`<div id="${t}"></div>`),title:e,nameWindow:t,widget:Engine.widgetsData.name.addon_27,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,manageShow:!1,managePosition:{x:251,y:60},onclose:()=>{g()}}),c.el=c.$[0],c.el.classList.add("item-frames"),c.updatePos(),c.addToAlertLayer();const i=document.getElementById(t);d.$mount(i)}(),c.$.find(".scroll-wrapper").addScrollBar({track:!0}))},this.stop=function(){l&&(l=!1,c.remove(),c=null,p(),Engine.map.groundItems.changeFrames("../img/gui/it_borders.png",0),Engine.serverStorage.clearDataBySpecificKey(t))};const f=()=>`\n        <style id="${t}-style">\n            .item-frames {\n                \n            }\n            .item-frames .content {\n                margin-top: -15px;\n                margin-left: -23px;\n                margin-right: -23px;\n                margin-bottom: -18px;\n            }\n            .item-frames__content {\n                margin-top: 10px;\n                position: relative;\n            }\n            .item-frames__list {\n            \n            }\n            .item-frames__list-el {\n                padding: 3px 2px;\n                position: relative;\n                overflow: hidden;\n            }\n            .item-frames__list-el[data-source='inner'] .item-frames__remove {\n                display: none;\n            }\n            .item-frames__list-el:last-child {\n                margin-bottom: 1px;\n            }\n            .item-frames__list-el.active {\n                /*border: 1px solid rgba(52,153,64,1);*/\n                box-shadow: 0 0 0 2px rgba(52,153,64,1) inset, 0 0 0 1px rgba(0, 0, 0, 0.55);\n            }\n            .item-frames__overview {\n                display: flex;\n            }\n            .item-frames__overview-one {\n                width: 32px;\n                height: 32px;\n                margin-left: 1px;\n            }\n            .item-frames__remove {\n                background: url(../img/gui/buttony.png?v=6) -624px -117px;\n                width: 12px;\n                height: 12px;\n                position: absolute;\n                top: 3px;\n                right: 4px;\n            }\n            .item-frames__remove:hover {\n                background: url(../img/gui/buttony.png?v=6) -726px -117px;\n            }\n            .item-frames__copy {\n                position: absolute;\n                bottom: 4px;\n                right: 4px;\n            }\n            .item-frames .scroll-wrapper .scroll-pane {\n                max-height: 50vh;\n                padding: 0 3px;\n            }\n            .item-frames .scroll-wrapper.scrollable .scroll-pane {\n                margin-right: 15px;\n                padding-right: 3px;\n            }\n            .item-frames .scroll-wrapper.scrollable .scrollbar-wrapper {\n                right: 0;\n                top: 0;\n                bottom: 1px;\n            }\n            .item-frames .row {\n                font-size: 11px;\n                height: 22px;\n                color: white;\n            }\n            .item-frames .window-controlls {\n                margin-top: 2px;\n                padding: 0 3px;\n            }\n            .item-frames .window-controlls .add {\n                overflow: hidden;\n            }\n            .item-frames .row-input {\n                display: none;\n            }\n            .item-frames .row-input.active {\n                display: block;\n            }\n            .item-frames .input-wrapper input {\n                height: 12px;\n                color: white;\n                vertical-align: 0;\n                font-size: 11px;\n                width: 96%;\n            }\n            .item .highlight.h-exist, \n            .bottomItem .highlight.h-exist, \n            .item .icon.h-exist, \n            .bottomItem .icon.h-exist {\n                ${""!==r?`background-position-y: ${r} !important;`:""}\n                ${""!==o?`background-image: url(${o});`:""}\n            }\n        </style>\n    `}},function(t,e){t.exports=function(){let t=!1;this.checkAllInventoryItems=()=>{const t=Engine.heroEquipment.getInvItems();for(const e of Object.values(t))this.isGold(e)&&Engine.heroEquipment.sendUseRequest(e)},this.newItem=t=>{this.isGold(t)&&Engine.heroEquipment.sendUseRequest(t)},this.isGold=t=>17===t.cl&&0===t.st,this.start=()=>{t||(t=!0,Engine.items.fetch(Engine.itemsFetchData.FETCH_NEW_ITEM,this.newItem))},this.stop=()=>{t&&(t=!1,Engine.items.removeCallback(Engine.itemsFetchData.FETCH_NEW_ITEM))}}},function(t,e,i){const n=i(40),a=i(16);t.exports=function(){const t="addon_29",e=_t("window_mode"),i="29.js";let s=!1,r=null,o=null,l=null,c=null,d=null,h=null,u=null,p=null,g=null,f=null,m={},v=null,E=null,_=null,b=null,w=null,C=null,T=null;const y=(t,e)=>{c[e]={id:e,link:t},A(copyStructure(c))},I=t=>{c[t]?(delete c[t],A(copyStructure(c))):errorReport(i,"removeBackground",`element ${t} not exist!`,c)},A=t=>{mt(t);let e=ft();G(e)||(e=m,errorReport(i,"updatePlayerBackgroundObject","playerBackgroundArrayData data is not correct!",e)),et(e)},k=()=>{d?C.addClass("window-mode-active"):C.removeClass("window-mode-active")},S=t=>{z(t),vt(t),k(),t||(Q(0),wt(0),X(!1),Et(!1),Z(0),Ct(0),st(),_.setFirst(),b.setFirst())};this.start=function(){s||(s=!0,it(),nt(),H(),L(),function(){const t=stringToHtml(yt());document.head.appendChild(t)}(),r=Engine.windowManager.add({content:v,title:e,nameWindow:t,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:251,y:60},onclose:()=>{ot()}}),ot(),r.updatePos(),r.addToAlertLayer(),r.addClass(t+"-wnd"),k(),d&&0!=u&&st())};const O=()=>{let t=[];for(let e in l){let i=l[e];t.push({text:i.text,val:i.id,tip:i.link,id:i.id,link:i.link})}for(let e in c){let i=c[e];t.push({text:i.text,val:i.id,tip:i.link,id:i.id,link:i.link})}return t},M=()=>{let t=O();for(let e in t){let i=t[e],n=i.id,a=i.link;if(n!=p)continue;let s=null;return s=""==a?"none":`url("${i.link}") no-repeat center center`,void E.css("background",s)}errorReport(i,"updateBackgroundUrl","id not find!",p),E.css("background","none")},N=()=>{E.css("transform",`scale(${g})`)},R=()=>{E.css("opacity",x(f))},x=t=>t/10,L=()=>{v=Tt(),W(),(()=>{const t=new n.default({name:"asd",label:_t("turn_on_window_mode"),value:"asd",i:0,checked:!!d,highlight:!1},t=>{S(!!t.target.checked)}).getCheckbox();v.find(".main-checkBox-wrapper").append($(t))})(),C=v.find(".config-panel"),(()=>{const t=getEngine(),e=t.ResolutionData.DATA,i=t.ResolutionData.RES,n=t.ResolutionData.KEY._DEFAULT,a=[];_=v.find(".resolution-menu-wrapper");for(let t=0;t<o.length;t++){let s=o[t],r=i[s],l=e[s],c={text:r,val:t};s==n||window.innerWidth>l.w&&window.innerHeight>l.h||(c.blockClick=!0,c.tip=_t("disbled",null,"clan")),0==t&&(c.text=_t("default",null,"default")),a.push(c)}_.createMenu(a,!1,(function(t){Q(t),wt(t),st()})),_.setOptionWithoutCallbackByValue(u)})(),(()=>{getEngine();let e=[],i=[];b=v.find(".background-menu-wrapper").empty();for(let t in l){let i=l[t],n={text:i.text,val:i.id,tip:i.link,id:i.id};e.push(n)}for(let t in c){let e=c[t],n={val:e.id,tip:e.link,id:e.id};i.push(n)}let n={addNewOption:{addItemConfirmText:_t("give_link",null,t),removeItemConfirmText:e=>_t("sure_remove",null,t),addTipText:_t("new_background",null,t),menuToAddAndRemove:i,configAddItemIdAndName:{nameFromInputVal:!1,namePrefix:_t("own",null,t)+" ",firstPossibleId:100,showFirstPossibleIdUserFriendly:!0},autoSelect:!0,addItemConfirmValidate:function(t){return!0},addItemConfirmClb:t=>{y(t.val,t.id)},removeItemConfirmClb:t=>{I(t.id)}}};b.createMenu(e,!1,(function(t){Z(t),Ct(t),M()}),n),b.setOptionWithoutCallbackByValue(p)})(),(()=>{getEngine();let t=[];w=v.find(".visible-menu-wrapper").empty();for(let e=0;e<11;e++){let i={text:e/10,val:e};t.push(i)}w.createMenu(t,!1,(function(t){J(t),pt(t),R()})),w.setOptionWithoutCallbackByValue(f)})(),D()},D=()=>{T=v.find(".scale-input-wrapper").empty();let t=createNiInput({cl:"asdasd",type:a.TYPE.NUMBER_FLOAT,tipClearClb:_t("reset",null,"ah_filter_history"),keyUpClb:(t,e)=>{B(t,e)},focusoutClb:()=>{F(T.find("input").val())},clearClb:()=>{P()}});tt(g),t.find("input").val(g),T.append(t)},P=()=>{T.find("input").val(1),F(1)},B=(t,e)=>{"Enter"==e.originalEvent.key&&F(t)},F=t=>{tt(t),gt(t),N()},W=()=>{E=$("<div>").addClass("window-mode-background-layer layer"),getEngine().interface.get$gameWindowPositioner().prepend(E)},H=()=>{const t="initData";let e=lt(),n=ct(),a=ht(),s=ut(),r=dt(),o=ft(),l=bt();V(e)||(e=!1,errorReport(i,t,"init worksData is not correct!")),z(e),G(o)||(o=m,errorReport(i,t,"playerBackgroundArrayData data is not correct!",o)),et(o),j(n)||(n=0,errorReport(i,t,"resolutionData data is not correct!",n)),Q(n),q(a)||(a=10,errorReport(i,t,"backgroundOpacityData data is not correct!",a)),J(a),K(r)||(r=0,errorReport(i,t,"backgroundData data is not correct!",r)),Z(r),Y(s)||(errorReport(i,t,"backgroundData data is not correct!",s),s=1),tt(s),U(l)||(l=!1,errorReport(i,t,"init outsideChatModeData is not correct!",l)),X(l)},G=t=>{if(!elementIsObject(t))return!1;for(let e in t){let i=t[e];if(!isset(i.id))return!1;if(!isset(i.link))return!1;if(!isInt(i.id))return!1;if(i.id<100)return!1}return!0},V=t=>!0===t||(!1===t||null==t),U=t=>!0===t||(!1===t||null==t),j=t=>!!isInt(t)&&!(t>o.length-1),q=t=>!!isNumberFunc(t)&&!(t<0||t>10),K=t=>{let e=O();for(let i in e){if(e[i].id==t)return!0}return!1},Y=t=>!!isNumberFunc(t)&&!(t<0||t>100),z=t=>{d=t},X=t=>{h=t},Q=t=>{u=t},J=t=>{f=t},Z=t=>{p=t},tt=t=>{g=t},et=t=>{c={};for(let e in t)c[e]=t[e]},it=()=>{const t=Engine.ResolutionData.KEY;o=[t._DEFAULT,t._920_X_555,t._1173_X_555,t._1200_X_675,t._1253_X_675,t._1024_X_768,t._1277_X_768,t._1366_X_768,t._1619_X_768,t._1600_X_900,t._1853_X_900,t._1920_X_1080]},nt=()=>{let e=CFG.a_vpath;l={0:{id:0,text:_t("empty",null,t),link:""},1:{id:1,text:isPl()?"Smocza Twierdza":"Dragon Fortress",link:e+"/windowModeBackground/smoczatwierdza.png"},2:{id:2,text:isPl()?"Wioska Rybacka":"Fishing Village",link:e+"/windowModeBackground/wioskarybacka.png"},3:{id:3,text:isPl()?"Skalne Królestwo":"Rocky Kingdom",link:e+"/windowModeBackground/skalnekrolewstwo.png"},4:{id:4,text:isPl()?"Żniwa":"Harvest",link:e+"/windowModeBackground/zniwa.png"},5:{id:5,text:isPl()?"Retrospekcja":"Retrospection",link:e+"/windowModeBackground/retrospekcja.png"},6:{id:6,text:isPl()?"Gorące Piaski":"Hot Sands",link:e+"/windowModeBackground/goracepiaski.png"},7:{id:7,text:isPl()?"Miasto":"City",link:e+"/windowModeBackground/miasto.png"},8:{id:8,text:isPl()?"Stara Mapa":"Old Map",link:e+"/windowModeBackground/staramapa.png"},9:{id:9,text:isPl()?"Podnóże Góry":"Mountain Base",link:e+"/windowModeBackground/podnozegory.png"},10:{id:10,text:isPl()?"Fatamorgana":"Mirage",link:e+"/windowModeBackground/fatamorgana.png"}}};function at(){let t=getEngine(),e=t.resolution.getResolutionKey(),i=t.resolution.getResolutionData(),n=null;if(e==Engine.ResolutionData.KEY._DEFAULT)n={position:"absolute",width:"100%",height:"100%",left:0,top:0,"margin-left":"0px","margin-top":"0px"};else{let t=i.w,e=i.h;n={position:"absolute",width:t+"px",height:e+"px",left:"50%",top:"50%","margin-left":-t/2+"px","margin-top":-e/2+"px"}}t.interface.get$interfaceLayer().css(copyStructure(n)),t.interface.get$dropToDeleteWidgetLayer().css(copyStructure(n)),t.widgetManager.resizeAllEmptySlotWidget(),t.widgetManager.resizeAllWidgetInAddons(),t.widgetManager.resizeAllWidgetInSettings(),t.widgetManager.rebuildWidgetButtons(),t.onResize()}function st(){let t=o[u];(()=>{let t=$("body");h?t.addClass("outside-chat-mode"):t.removeClass("outside-chat-mode")})(),M(),R(),N(),rt(t),at()}function rt(t){const e=Engine.ResolutionData,i=getEngine();i.widgetManager.setWidgetSize(e.WIDGET_SIZE_BY_RES[t]),i.resolution.setResolution(t)}function ot(){r.hide()}this.stop=function(){s&&(s=!1,rt(getEngine().ResolutionData.KEY._DEFAULT),at(),r.remove(),r=null,function(){const e=document.getElementById(t+"-style");e&&e.parentNode.removeChild(e)}())},this.manageVisible=function(){r.isShow()?ot():(r.show(),r.setWndOnPeak())};const lt=()=>API.Storage.get(t+"/works",!1),ct=()=>API.Storage.get(t+"/resolutionOpt",0),dt=()=>API.Storage.get(t+"/backgroundOpt",0),ht=()=>API.Storage.get(t+"/backgroundOpacityOpt",10),ut=()=>API.Storage.get(t+"/backgroundScaleVal",1),pt=e=>{API.Storage.set(t+"/backgroundOpacityOpt",e)},gt=e=>{API.Storage.set(t+"/backgroundScaleVal",e)},ft=()=>API.Storage.get(t+"/playerBackgroundObject",m),mt=e=>{API.Storage.set(t+"/playerBackgroundObject",e)},vt=e=>{API.Storage.set(t+"/works",e)},Et=e=>{API.Storage.set(t+"/outsideChatMode",e)},bt=()=>API.Storage.get(t+"/outsideChatMode",!1),wt=e=>{API.Storage.set(t+"/resolutionOpt",e)},Ct=e=>{API.Storage.set(t+"/backgroundOpt",e)},Tt=()=>$(`\n            <div id="${t}">\n                <div class="main-checkBox-wrapper"></div>\n                <div class="config-panel">\n                    <div class="one-opt-record">\n                        <div class="description-opt">${_t("size",null,t)}</div>\n                        <div class="input-opt resolution-menu-wrapper menu"></div>\n                    </div>\n                    <div class="one-opt-record">\n                        <div class="description-opt">${_t("bck",null,t)}</div>\n                        <div class="input-opt background-menu-wrapper menu"></div>\n                    </div>\n                    <div class="one-opt-record">\n                        <div class="description-opt">${_t("visible",null,t)}</div>\n                        <div class="input-opt visible-menu-wrapper menu"></div>\n                    </div>\n                    <div class="one-opt-record">\n                        <div class="description-opt">${_t("scale",null,t)}</div>\n                        <div class="input-opt scale-input-wrapper"></div>\n                    </div>\n                    <div class="outside-chat-mode-checkBox-wrapper"></div>\n                <div/>\n            </div>\n\n        `),yt=()=>{let e=getEngine().ResolutionData.RES;return`\n\t\t<style id="${t}-style">\n\n\t\t\t.${t}-wnd .content {\n\t\t\t    margin-left: -15px;\n                margin-right: -15px;\n\n                .config-panel {\n                    pointer-events: none;\n                    opacity: 0.5;\n                }\n\n                .config-panel.window-mode-active {\n                    pointer-events: auto;\n                    opacity: 1;\n                }\n\n\t\t\t}\n\n\t\t\t#${t} {\n                height: 150px;\n                margin-top: 6px;\n                font-size:12px;\n\t\t\t}\n\n            #${t} input {\n                border: 1px solid grey;\n            }\n\n            #${t} .one-opt-record {\n                display: table;\n                width: 100%;\n                height: 30px;\n            }\n\n            #${t} .one-opt-record .description-opt {\n                color: white;\n                display: table-cell;\n                vertical-align: middle;\n            }\n\n            #${t} .one-opt-record .input-opt  {\n                display: table-cell;\n                vertical-align: middle;\n                width: 60%;\n            }\n\n\n\t\t\t.main-checkBox-wrapper {\n\t\t\t    margin-bottom: 10px;\n\t\t\t}\n\n\t\t\t.outside-chat-mode-checkBox-wrapper {\n\t\t\t    margin-top: 10px;\n\t\t\t}\n\n\t\t\t.window-mode-background-layer {\n\t\t\t    pointer-events:none;\n\t\t\t        //transform: scale(1.5);\n\t\t\t}\n\n            body[data-res="${e._920_X_555}"],\n            body[data-res="${e._1173_X_555}"],\n\t\t\tbody[data-res="${e._1024_X_768}"],\n\t\t\tbody[data-res="${e._1277_X_768}"],\n\t\t\tbody[data-res="${e._1366_X_768}"],\n\t\t\tbody[data-res="${e._1619_X_768}"],\n\t\t\tbody[data-res="${e._1200_X_675}"],\n\t\t\tbody[data-res="${e._1253_X_675}"],\n\t\t\tbody[data-res="${e._1600_X_900}"],\n\t\t\tbody[data-res="${e._1853_X_900}"],\n\t\t\tbody[data-res="${e._1920_X_1080}"] {\n                .interface-layer {\n\t\t\t        border: 7px solid transparent;\n\t\t\t        border-image: url('../img/gui/windowModeBorder.png') 7 repeat;\n\t\t\t        box-sizing: border-box;\n\n\t            }\n\n                //.layer.interface-layer {\n                //    overflow: visible;\n                //}\n\n                &.outside-chat-mode {\n                    .new-chat-window {\n                        bottom:0px!important;\n                    }\n                    .chat-size-1 {\n\t                    .left-column.main-column {\n                            left: -261px;\n                        }\n\n\t                    .echh-layer,\n\t                    .game-layer,\n\t                    .layer.interface-layer .mini-map,\n\t                    .mAlert-layer .big-messages {\n\t                    \tleft: 0;\n\t                    }\n\t                    .layer.interface-layer .main-column.left-column {\n\t                    \t/*display: none;*/\n\t                    \twidth: 0;\n\t                    \t.border {\n\t                    \t    display: none;\n\t                    \t}\n\t                    }\n\t                    .left-column .inner-wrapper .chat-tpl .input-wrapper input {\n\t                    \twidth: 0;\n\t                    }\n                    }\n                }\n\n\t        }\n\n            body[data-res="${e._920_X_555}"] {\n\t\t\t    .pre-captcha {\n\t\t\t        top:-22px;\n\t\t\t    }\n\t\t\t    .pre-captcha.show {\n\t\t\t        top:52px;\n\t\t\t    }\n\t\t\t    .interface-layer .battle-controller {\n\t\t\t        transform: scale(0.75);\n                    -webkit-transform-origin-y: 100%;\n\t\t\t    }\n            }\n\n            body[data-res="${e._920_X_555}"] {\n                .bottom-left.main-buttons-container {\n                    bottom: -11px;\n                }\n                .bottom-right.main-buttons-container {\n                    bottom: -11px;\n                }\n                .main-buttons-container {\n                    width: 226px\n                }\n                .trade-window {\n                    transform: scale(0.72);\n                    bottom: 16px;\n                }\n            }\n\n            body[data-res="${e._1024_X_768}"] {\n                 .pre-captcha {\n\t\t\t        top:-18px;\n\t\t\t    }\n\t\t\t    .pre-captcha.show {\n\t\t\t        top:52px;\n\t\t\t    }\n                .trade-window {\n                    transform: scale(0.9);\n                    bottom: 42px;\n                }\n            }\n\n            body[data-res="${e._1173_X_555}"] {\n                .pre-captcha {\n\t\t\t        top:-20px;\n\t\t\t    }\n\t\t\t    .pre-captcha.show {\n\t\t\t        top:55px;\n\t\t\t    }\n                .trade-window {\n                    bottom: 42px;\n                }\n            }\n\n            body[data-res="${e._1024_X_768}"],\n\t\t\tbody[data-res="${e._1173_X_555}"] {\n                .bottom-left.main-buttons-container {\n                    bottom: -8px;\n                }\n                .bottom-right.main-buttons-container {\n                    bottom: -8px;\n                }\n                .main-buttons-container {\n                    width: 266px\n                }\n            }\n\n\t\t\tbody[data-res="${e._920_X_555}"],\n\t\t\tbody[data-res="${e._1024_X_768}"],\n\t\t\tbody[data-res="${e._1173_X_555}"] {\n\t\t\t    .dialogue-window {\n\t\t\t        bottom: 81px;\n\t\t\t    }\n\t\t\t    .interface-layer .battle-controller.with-skills {\n\t\t\t        bottom: 50px;\n\t\t\t    }\n\t\t\t    .interface-layer .mini-map-controller {\n\t\t\t        top:50px;\n\t\t\t        bottom: 50px;\n\t\t\t    }\n\n\t\t\t    .hud-container,\n\t\t\t    .bottom-panel-of-bottom-positioner.bottom-panel {\n\t\t\t        transform: scale(0.82);\n\t\t\t    }\n\t\t\t    .hud-container {\n\t                -webkit-transform-origin-y: 10%;\n                }\n                .bottom-panel-of-bottom-positioner.bottom-panel {\n\t                transform-origin: 50% 100%;\n                }\n                .interface-layer .top.positioner .bg {\n                    background-position-y: -71px!important;\n                }\n                .bottom-left.main-buttons-container {\n                    left: 2px;\n                }\n                .bottom-right.main-buttons-container {\n                    right: 2px;\n                }\n                .interface-layer .top.positioner .bg,\n                .interface-layer .bottom.positioner .bg {\n                    height: 50px;\n                }\n                .interface-layer {\n                    .right-column.main-column,\n                    .left-column.main-column,\n                    .game-layer {\n                        top: 50px;\n                        bottom : 50px;\n                    }\n                }\n                .b_wrapper {\n                    display: none;\n                }\n                .bottom.positioner .content .bottom-left-additional,\n                .bottom.positioner .content .bottom-right-additional {\n                    bottom: 30px;\n                }\n                .layer.interface-layer .positioner.bottom .bg-additional-widget-left,\n                .layer.interface-layer .positioner.bottom .bg-additional-widget-right {\n                    bottom: -20px;\n                }\n\n                .layer.interface-layer .positioner.bottom .bg-additional-widget-left {\n                    transform: scale(-1, 0.82);\n                    transform-origin: 50% -5%;\n                }\n                .layer.interface-layer .positioner.bottom .bg-additional-widget-right {\n                    transform: scale(1, 0.82);\n                    transform-origin: 0% -5%;\n                }\n\n            }\n\n            body[data-res="${e._1024_X_768}"],\n            body[data-res="${e._1173_X_555}"] {\n\t\t\t    .hud-container,\n\t\t\t    .bottom-panel-of-bottom-positioner.bottom-panel {\n\t\t\t        transform: scale(0.9);\n\t\t\t    }\n\t\t\t}\n\n\t\t</style>\n\t`}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e=this;this.init=function(){e.initWindow(),e.addScrollBar()},this.initWindow=function(){t=n.get("achievement-panel"),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.ACHIEVEMENTS,nameRefInParent:"wnd",objParent:this,title:e.tLang("achievements"),startVH:60,cssVH:60,onclose:()=>{e.hidePanel()}}),this.hidePanel(),this.wnd.addToAlertLayer()},this.callEvent=function(){$.ajax({url:"https://margonem.com/ajax/getAchievements",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(i){e.wnd.$.find(".scroll-pane").find(".section").remove(),e.wnd.$.find(".cards-header").empty();var n=JSON.parse(i);e.createCardsAndSeciotns(n.all_achievements.ach_groups),e.createAchievements(n.all_achievements.ach),$(".scroll-wrapper",t).trigger("update")},error:function(t){console.error("[AchievementsPanel.js, callEvent] Achievement ajax error")}})},this.hidePanel=function(){e.wnd.hide()},this.showPanel=function(){e.callEvent(),e.wnd.show()},this.toggle=function(){"block"==e.wnd.$.css("display")?e.hidePanel():e.showPanel()},this.createCardsAndSeciotns=function(t){for(var e=0;e<t.length;e++){var i="Fights with monsters"==t[e]?"PvE fight":t[e];this.newCard(t[e],i,e)}this.activeSection("General")},this.newCard=function(t,i,a,s){var r=n.get("card"),o=t.replace(/\?/g,"");o=o.replace(/\s/g,"-");var l=n.get("achievement-section").addClass("section "+o+" grp-"+(a+1));r.attr("card-name",o),r.find(".label").html(i),e.wnd.$.find(".cards-header").append(r),e.wnd.$.find(".scroll-pane").append(l),r.click((function(){var t=$(this).attr("card-name");e.activeSection(t),s&&s()}))},this.activeSection=function(i){var n=e.wnd.$,a=n.find("[card-name='"+i+"']"),s=a.find(".label").html();n.find(".card").removeClass("active"),n.find(".section").removeClass("active"),a.addClass("active"),e.wnd.$.find("."+i).addClass("active"),n.find(".edit-header-label").html(s),$(".scroll-wrapper",t).trigger("update"),$(".scroll-wrapper",t).trigger("scrollTop")},this.setVisibleStats=function(t,e){var i=t.find(".card").removeClass("active"),n=t.find(".section").removeClass("active");i.eq(e).addClass("active"),n.eq(e).addClass("active")},this.tLang=function(t){return _t(t,null,"achievement")},this.addScrollBar=function(){$(".scroll-wrapper",t).addScrollBar({track:!0})},this.createAchievements=function(e){for(var i in e)this.createOneAchievement(e[i],i);$(".scroll-wrapper",t).trigger("update")},this.createOneAchievement=function(t,i){var a=n.get("one-achievement").addClass("index-"+i);if(t.parent>1){var s=e.wnd.$.find(".parent-"+t.parent);s.length<1&&((s=n.get("achievement-section").addClass("section name-"+t.parent+" parent-"+t.parent)).attr("card-name","name-"+t.parent),e.wnd.$.find(".scroll-pane").append(s)),s.append(a)}else e.wnd.$.find(".grp-"+t.grp).prepend(a);if(t.is_groupping){var r=n.get("button").addClass("small green");r.find(".label").html("More"),a.append(r);var o="name-"+i;r.click((function(){e.activeSection(o)}))}a.find(".achievement-title").html(t.name),a.find(".description-wrapper").html(t.desc),0!=t.done&&a.find(".icon").css("background-position-y",-53*parseInt(i));var l=a.find(".progress-bar-wrapper").css("width");if(!isset(t.mlvl))return a.find(".state-wrapper").html("<BR>"),void(2==t.done&&a.find(".progress-bar").css("width",parseInt(l)));var c,d=t.mlvl,h=t.clvl;if(a.find(".current").html(h),a.find(".max").html(d),a.find(".progress-bar").css("width",h/d*parseInt(l)),t.todo&&a.find(".progress-bar-wrapper").tip(t.now+" of "+t.todo),h>0&&a.find(".icon").css("background-position-y",-53*parseInt(i)),!(d<3)){if(h==d)c=2;else if(!(d%2))c=h>d/2?1:0;else c=h>=Math.floor(d/2)+1?1:0;a.find(".icon").css("background-position-x",-53*c)}},this.createProgressBar=function(){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(23),s=i(0),r=i(5);e.default=class{constructor(){this.list={},this.id=null,this.changePlayerRequest=t=>{const e=this.id;this.id=t,_g("logoff&a=start",t=>{(0,n.isset)(t.logoff_time_left)||(this.id=e)})},this.initWindow(),this.initScroll(),this.errorContainerEl=this.wndEl.querySelector(".relogger__error"),this.successContainerEl=this.wndEl.querySelector(".relogger__success"),this.worldsContainerEl=this.wndEl.querySelector(".relogger__worlds"),this.characterGroupContainerEl=this.wndEl.querySelector(".relogger__top .relogger__characters"),this.bottomContainerEl=this.wndEl.querySelector(".relogger__bottom"),this.call(),this.createLogoutBtn()}initScroll(){this.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})}updateScroll(){$(".scroll-wrapper",this.wnd.$).trigger("update")}getList(){return this.list}createLogoutBtn(){const t=new a.default({text:_t("logout",null,"change_player"),classes:["small","red"],action:()=>this.logout()}).getButton();this.bottomContainerEl.appendChild(t)}logout(){Engine.logOff||_g("logoff&a=start")}getDestinationCharacter(){return null!==this.id?this.list[this.id]:null}initWindow(){Engine.windowManager.add({content:s.get("relogger"),title:_t("title",null,"change_player"),nameWindow:Engine.windowsData.name.CHANGE_SERVER,widget:Engine.widgetsData.name.EXIT,objParent:this,nameRefInParent:"wnd",type:Engine.windowsData.type.TRANSPARENT,addClass:"relogger-window",manageCollapse:{defaultVal:0,callbackFn:t=>this.collapse(t)},manageShow:!1,manageOpacity:3,managePosition:{x:"0",y:"58"},onclose:()=>{this.managePanelVisible()}}),this.wndEl=this.wnd.$[0],this.wnd.addToAlertLayer()}collapse(t){this.updateScroll()}call(){const t=getCookie("hs3"),e=Engine.worldConfig.getApiDomain()+"/account/charlist?hs3="+t;this.clearError(),$.ajax({url:e,xhrFields:{withCredentials:!0},crossDomain:!0,success:t=>{"object"==typeof t&&t.error||"no cookies"===t||0===t.length?this.onError():this.onSuccess(t)},error:()=>{this.onError()}})}onSuccess(t){const e=Engine.hero.d.account;r.set("charlist/"+e,t),this.prepareList(t),this.createWorldList(),this.createCharacters(),this.selectCurrentWorld(),this.updateScroll()}createCharacters(){Object.values(this.list).sort((t,e)=>t.lvl-e.lvl||t.nick.localeCompare(e.nick)).map(t=>{const e=t.world,i=this.createOneCharacter(t);this.characterGroupContainerEl.querySelector(`[data-world=${e}]`).appendChild(i)})}createOneCharacter(t){const e=document.createElement("div");return e.classList.add("relogger__one-character"),Engine.hero.d.id==t.id&&e.classList.add("disabled"),createImgStyle($(e),CFG.a_opath+t.icon,{height:"28px",width:"32px"},{"background-size":"400% 400%"},32),$(e).tip(this.getCharacterTip(t)),e.addEventListener("click",()=>{Engine.hero.d.id!=t.id&&(Engine.logOff?(_g("logoff&a=stop"),setTimeout(this.changePlayerRequest.bind(null,t.id),300)):this.changePlayerRequest(t.id))}),e}getCharacterTip(t){let{id:e,lvl:i,prof:n,nick:a}=t;if(Engine.hero.d.id==e)return _t("current_character",null,"change_player");const s={nick:a,d:{id:e,lvl:i,prof:n}};return Engine.hero.setTipHeader(s)}createWorldCharacterGroup(t){const e=document.createElement("div");e.classList.add("relogger__char-group"),e.setAttribute("data-world",t),this.characterGroupContainerEl.appendChild(e)}createWorldList(){this.getWorldList().map(t=>{const e=document.createElement("div");e.classList.add("relogger__one-world"),e.textContent=t,e.setAttribute("data-world",t),e.addEventListener("click",()=>this.selectWorld(t)),this.worldsContainerEl.appendChild(e),this.createWorldCharacterGroup(t)})}getWorldList(){const t=[];return Object.keys(this.list).map(e=>{const i=this.list[e].world;t.includes(i)||t.push(i)}),t.sort()}selectWorld(t){const e=this.worldsContainerEl.querySelector(`[data-world=${t}]`),i=(0,n.siblings)(e),a=this.characterGroupContainerEl.querySelector(`[data-world=${t}]`),s=(0,n.siblings)(a);e.classList.add("active"),a.classList.add("active"),i.forEach(t=>t.classList.remove("active")),s.forEach(t=>t.classList.remove("active"))}selectCurrentWorld(){const t=Engine.worldConfig.getWorldName();this.selectWorld(t)}onError(){const t=Engine.hero.d.account,e=r.get("charlist/"+t);e?this.onSuccess(e):this.setErrorLabel()}prepareList(t){for(let e=0;e<t.length;e++){let i=parseInt(t[e].id);this.list[i]=t[e]}}setErrorLabel(){this.errorContainerEl.textContent=_t("change_player_error %l%",{"%l%":getMainDomain()},"change_player"),this.errorContainerEl.style.display="block",this.successContainerEl.style.display="none"}clearError(){this.errorContainerEl.style.display="none",this.successContainerEl.style.display="block"}reloadPlayer(t){const e=this.list[t],i=new Date;i.setTime(i.getTime()+2592e6);const n=getMainDomain();setCookie("mchar_id",t,i,"/","margonem."+n,!0),window.location.replace("https://"+e.world+".margonem."+n)}openPanel(){this.wnd.show(),this.wnd.setWndOnPeak(),this.wnd.updatePos(),this.updateScroll()}closePanel(){this.wnd.hide()}onResize(){this.wnd.updatePos()}managePanelVisible(){this.wnd.isShow()?this.closePanel():this.openPanel()}}},function(t,e){t.exports=function(){var t,e,i,n,a,s=0;let r;this.init=function(){t=Engine.interface.get$interfaceLayer().find(".hp-indicator"),e=Engine.interface.get$interfaceLayer().find(".exp-progress .progress .inner"),i=Engine.interface.get$interfaceLayer().find(".battle-bars-wrapper"),n=Engine.interface.get$interfaceLayer().find(".exp-bar-wrapper"),Engine.interface.get$interfaceLayer().find(".extended-stats"),a=Engine.interface.get$interfaceLayer().find(".lag",".lagmeter"),o(0),Engine.interface.get$interfaceLayer().find(".stats-section.legends h3").tip(_t("leg_bon_info_tip"))},this.setHp=function(e,i){var n=e/i*100;$(".hpp .value",t).text(Math.ceil(n)+"%"),setPercentProgressBar($(".blood",t),n);var a,s=t.find(".blood-frame");s.css("display",n>30?"none":"block"),a=n>30?0:n>25||n>20?-103:n>15?-206:n>10?-309:n>5?-412:-515,s.css("background-position-x",a+"px");var r="<strong>"+_t("life_points",null,"player")+":</strong><br>"+round(e,10)+" / "+round(i,10);$(".bottom-panel .glass").tip(r,"t_static")},this.checkAndSetEndGamePanel=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Engine.hero.d.lvl;if(/aldous|tempest/.test(location.hostname)){if(t<=299)return}else if(t<=499)return;var e=Engine.interface.get$interfaceLayer().find(".bottom-panel");e.addClass("end-game"),e.find(".exp-progress.left>.overlay").addClass("end-game-overlay"),e.find(".exp-progress.right>.overlay").addClass("end-game-overlay"),e.find(".ribbon").addClass("end-game-ribbon"),e.find(".glass").addClass("end-game-glass")};setInterval((function(){Engine&&Engine.opt(8)||($(".blood",t).css({backgroundPosition:-103*s+++"px -9px"}),4==s&&(s=0))}),1e3);this.setXp=function(t,i,n,a,s){var r=Math.min(1,t/.5),o=Math.max((t-.5)/.5,0),l="";setPercentProgressBar($(e[0]),100*r),setPercentProgressBar($(e[1]),100*o),s<500&&(l="<strong>"+_t("experience",null,"player")+":</strong><br>"+round(i,Math.ceil(i.toString().length/3)<2?2:Math.ceil(i.toString().length/3))+" / "+round(n,Math.ceil(n.toString().length/3)<2?2:Math.ceil(n.toString().length/3))+"<br>"+_t("to %lvl% %exp%",{"%lvl%":s+1,"%exp%":round(n-i,10)},"player")),Engine.interface.get$interfaceLayer().find(".exp-progress").tip(l,"t_static")},this.setEnergy=function(t,e){var n=t||0,a=0==(e=e||0)?0:n/e*100;$(".energy > .values",i).html(n),setPercentProgressBar($(".energy .inner",i),a)},this.setMana=function(t,e){var n=t||0,a=0==(e=e||0)?0:n/e*100;$(".mana > .values",i).html(n),setPercentProgressBar($(".mana .inner",i),a)},this.showElements=function(t){switch(t){case"battle":i.show(),n.hide();break;case"game":i.hide(),n.show()}};const o=function(t){let e=`<span class="lag-meter-tip">${t}ms</span>`;a.tip(e,"t_static")},l=()=>{(t=>{let e=Math.min(Math.floor(t/50),5);Engine.lag!=e&&a.attr("class","lag lag-"+e),window.TIPS.checkTipExist()&&window.TIPS.checkTipHasClass("lag-meter-tip")&&o(t),Engine.lag=e})(ts()-Engine.getAts())};this.startLag=function(){r&&clearInterval(r),Engine.setAts(ts()),r=setInterval((function(){l()}),50)},this.endLag=function(){r&&clearInterval(r),l()}}},function(t,e){t.exports=function(){this.counter=0,this.mailsRefresh=function(t){0!=t&&(this.counter=t)},this.newMail=function(t){if(0!=t){var e=$("#mailnotifier");e.length||(e=Engine.interface.createNotif("mailnotifier")),e.find(".notif-value").text(t)}},this.setRecipient=function(t){var e=$("#mailnotifier"),i=_t("last_mail_msg %from%",{"%from%":t},"default");e.tip(i,"t_notif")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(344),s=i(23),r=i(14),o=i(0);e.default=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.wndEl=t,this.options=e,this.worldName="",this.search={nick:"",minLvl:"",maxLvl:"",profession:""},this.getEngine().playersOnline=!0,this.setContent(),this.initSearch(),this.getData(),this.setFilters()}setContent(){this.contentEl=o.get("players-online")[0],this.itemContainerEl=this.contentEl.querySelector(".players-online__items-container"),this.infoEl=this.contentEl.querySelector(".players-online__info"),this.tabContentEl=this.wndEl.querySelector(".players-online-content"),this.tabContentEl.innerHTML="",this.tabContentEl.appendChild(this.contentEl);const t=this.getRanksLegend();$(this.contentEl.querySelector(".legend")).tip(t,"t-left"),this.addRefreshButton(),this.initScrollbar()}addRefreshButton(){const t={text:_t("refresh",null,"buttons"),classes:["small","green"],action:()=>{this.getData()}},e=new s.default(t);this.infoEl.appendChild(e.getButton())}getRanksLegend(){let t="";for(const e in a.ranks)t+=`<div style='color: ${a.ranks[e].color}'>${a.ranks[e].name}</div>`;return t}createItems(t){for(const e of t)this.itemContainerEl.appendChild(this.createItem(e));this.updateScrollbar()}createItem(t){const{a:e,c:i,n:s,l:r,p:l,r:c}=t,d=o.get("players-online-item")[0],h=d.querySelector(".players-online__nick"),u=d.querySelector(".players-online__lvl"),p=d.querySelector(".players-online__prof"),g=""!==a.ranks[c].shortName?`(${a.ranks[c].shortName})`:"";return h.innerHTML=s+g,u.innerHTML=r.toString(),p.innerHTML=l,(0,n.setAttributes)(d,{nick:s,lvl:r,prof:l}),a.ranks[c]&&(d.style.color=a.ranks[c].color),d.addEventListener("contextmenu",e=>{this.createContextMenu(e,t)}),d.addEventListener("click",()=>{Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(s)}),d}createContextMenu(t,e){const i=[];return i.push([_t("send_message",null,"chat"),function(){Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(e.n)}]),i.push([_t("show_eq"),()=>{Engine.showEqManager.update({id:e.c,account:e.a,lvl:e.l,nick:e.n,prof:e.p,icon:"",world:this.worldName})}]),i.push([_t("invite_to_friend"),()=>_g("friends&a=finvite&nick="+e.n.trim().split(" ").join("_"))]),i.push([_t("add_to_enemies"),()=>_g("friends&a=eadd&nick="+e.n.trim().split(" ").join("_"))]),i.push([_t("team_invite",null,"menu"),()=>_g("party&a=inv&id="+e.c)]),i.push([_t("show_profile",null,"menu"),()=>(0,n.showProfile)(e.a,e.c)]),!!i.length&&(Engine.interface.showPopupMenu(i,t),!0)}updateInfo(t,e){this.infoEl.querySelector(".players-online__date").innerHTML=e}prepareUpdateDate(t){return t?(0,n.ut_fulltime)(strtotime(t),!0):(0,n.ut_fulltime)(Date.now()/1e3,!0)}getData(){this.itemContainerEl.replaceChildren();let t="";const e=this.getApiDomain();this.worldName=(0,n.isDevOrExpe)()?(0,n.isPl)()?"fobos":"husaria":this.getWorldName(),fetch(`${e}/info/online/${this.worldName}.json`).then(e=>(e.headers.has("last-modified")&&(t=this.prepareUpdateDate(e.headers.get("last-modified"))),e.json())).then(e=>{this.updateInfo(e.length,t),this.createItems(e),this.checkSearch()}).catch(t=>{console.error("[PlayersOnline.ts, callEvent] PlayersOnline ajax request error "+t)})}initSearch(){const t=this.contentEl.querySelector(".search"),e=this.contentEl.querySelector(".search-x"),i=this.contentEl.querySelector(".start-lvl-wrapper"),a=this.contentEl.querySelector(".stop-lvl-wrapper"),s=this.contentEl.querySelector(".choose-prof"),o=createNiInput({cl:"start-lvl",placeholder:_t("start"),changeClb:t=>this.minLvlOnChange(t),clearClb:()=>this.minLvlOnChange(""),type:"number"})[0],l=createNiInput({cl:"stop-lvl",placeholder:_t("stop"),changeClb:t=>this.maxLvlOnChange(t),clearClb:()=>this.maxLvlOnChange(""),type:"number"})[0];i.appendChild(o),a.appendChild(l),t.addEventListener("input",t=>{let{target:e}=t;this.nickOnChange(e.value)}),e.addEventListener("click",(function(){t.value="",(0,n.triggerEvent)(t,"input")}));const c=[{val:"all",text:_t("prof_all",null,"auction")},{val:r.MAGE,text:_t("prof_mage",null,"auction")},{val:r.WARRIOR,text:_t("prof_warrior",null,"auction")},{val:r.PALADIN,text:_t("prof_paladin",null,"auction")},{val:r.TRACKER,text:_t("prof_tracker",null,"auction")},{val:r.HUNTER,text:_t("prof_hunter",null,"auction")},{val:r.BLADE_DANCER,text:_t("prof_bdancer",null,"auction")}];this.$profSelect=$(s),this.$profSelect.createMenu(c,!0,t=>{this.professionOnChange(t)})}setFilters(){if(void 0===this.options.filters)return;const t=this.contentEl.querySelector(".search"),e=this.contentEl.querySelector(".start-lvl-wrapper input"),i=this.contentEl.querySelector(".stop-lvl-wrapper input");this.contentEl.querySelector(".choose-prof");this.options.filters.nick&&(this.setNick(this.options.filters.nick),t.value=this.options.filters.nick,(0,n.triggerEvent)(t,"change")),this.options.filters.minLvl&&(this.setMinLvl(String(this.options.filters.minLvl)),e.value=String(this.options.filters.minLvl),(0,n.triggerEvent)(e,"change")),this.options.filters.maxLvl&&(this.setMaxLvl(String(this.options.filters.maxLvl)),i.value=String(this.options.filters.maxLvl),(0,n.triggerEvent)(i,"change")),this.options.filters.profession&&(this.setProfession(this.options.filters.profession),this.$profSelect.setOptionWithoutCallbackByValue(this.options.filters.profession)),this.checkSearch()}setNick(t){this.search.nick=""!==t?t.toLowerCase():""}setProfession(t){this.search.profession=""!==t?t:""}setMinLvl(t){this.search.minLvl=""!==t?parseInt(t):""}setMaxLvl(t){this.search.maxLvl=""!==t?parseInt(t):""}nickOnChange(t){this.setNick(t),this.checkSearch()}professionOnChange(t){this.setProfession(t),this.checkSearch()}minLvlOnChange(t){this.setMinLvl(t),this.checkSearch()}maxLvlOnChange(t){this.setMaxLvl(t),this.checkSearch()}checkSearch(){this.itemContainerEl.querySelectorAll(".players-online__item").forEach(t=>{const e=t.getAttribute("nick").toLowerCase(),i=parseInt(t.getAttribute("lvl")),n=t.getAttribute("prof"),a=""===this.search.nick||e.includes(this.search.nick),s=(""===this.search.minLvl||i>=this.search.minLvl)&&(""===this.search.maxLvl||i<=this.search.maxLvl),r=document.querySelector(".choose-prof .menu-option").getAttribute("value");a&&s&&("all"===r||r===n)?t.classList.remove("d-none"):t.classList.add("d-none"),this.updateScrollbar()})}getWorldName(){return this.getEngine().worldConfig.getWorldName()}getApiDomain(){const t=this.getEngine().worldConfig.getApiDomain();return n.isDevOrExpe?t.replace("stag-",""):t}initScrollbar(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}updateScrollbar(){$(this.contentEl).find(".scroll-wrapper").trigger("update")}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world_window"):""}close(){this.getEngine().worldWindow.playersOnline=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ranks=void 0,e.ranks={0:{name:_t("player",null,"ranks"),shortName:"",color:"#ececec"},1:{name:_t("admin",null,"ranks"),shortName:"ADM",color:"#ff3b3b"},2:{name:_t("mg",null,"ranks"),shortName:"MG",color:"#84ff00"},4:{name:_t("super_chat_mod",null,"ranks"),shortName:"SMC",color:"#82e6ff"},16:{name:_t("super_mg",null,"ranks"),shortName:"SMG",color:"#ffde00"},32:{name:_t("chat_mod",null,"ranks"),shortName:"MC",color:"#ff0bb2"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0);e.default=class{constructor(t){this.wndEl=t,this.getEngine().serverParameters=!0;const e=[{title:this.tLang("basic-parameters"),attrs:[{name:this.tLang("npc-resp"),value:Engine.worldConfig.getNpcResp()},{name:this.tLang("weak-titans"),value:Engine.worldConfig.getWeakTitans()+"%"},{name:this.tLang("npc-exp"),value:Engine.worldConfig.getNpcExp()},{name:this.tLang("quest-exp"),value:Engine.worldConfig.getQuestExp()}]},{title:this.tLang("loot-parameters"),attrs:[{name:this.tLang("drop-destroy-lvl"),value:Engine.worldConfig.getDropDestroyLvl()+" "+this.tLang("lvls")},{name:this.tLang("loot"),value:Engine.worldConfig.getLoot()},{name:this.tLang("ttl-loot-del"),value:this.setOnOff(Engine.worldConfig.getTtlLootDel())}]},{title:this.tLang("pvp-parameters"),attrs:[{name:this.tLang("pvp-lvl-off"),value:this.setOnOff(!Engine.worldConfig.getPvpLvlOff())},{name:this.tLang("ph"),value:Engine.worldConfig.getPh()},{name:this.tLang("pvp-time"),value:Engine.worldConfig.getPvpStart()+" - "+Engine.worldConfig.getPvpEnd(),hidden:null===Engine.worldConfig.getPvpStart()&&null===Engine.worldConfig.getPvpEnd()},{name:this.tLang("non-pvp-time"),value:Engine.worldConfig.getNonPvpStart()+" - "+Engine.worldConfig.getNonPvpEnd(),hidden:null===Engine.worldConfig.getNonPvpStart()&&null===Engine.worldConfig.getNonPvpEnd()}]},{title:this.tLang("chat-parameters"),attrs:[{name:this.tLang("skip-mute"),value:this.setOnOff(!Engine.worldConfig.getSkipMute())},{name:this.tLang("enable-me"),value:this.setOnOff(Engine.worldConfig.getEnableMe())},{name:this.tLang("enable-nar"),value:this.setOnOff(Engine.worldConfig.getEnableNar())}]},{title:this.tLang("admin-parameters"),hidden:!Engine.worldConfig.getPrivWorld(),attrs:[{name:this.tLang("supervisors"),value:this.setSupervisorsList(Engine.worldConfig.getSupervisorIds())}]}];this.setContent(),this.createGroups(e)}setOnOff(t){return t?this.tLang("on"):this.tLang("off")}setSupervisorsList(t){let e=document.createElement("div");for(const[i,a]of t.entries()){const t=0===i?"":", ";let s;if((0,n.isPl)())s=document.createElement("span"),s.addEventListener("click",()=>Engine.iframeWindowManager.newPlayerProfile({accountId:a}));else{const t="https://margonem.com/profile/view,"+a;s=document.createElement("a"),(0,n.setAttributes)(s,{href:t,target:"_blank"})}s.classList.add("server-parameters__sv","not-peak"),s.textContent=`[${a}]`,e.appendChild(document.createTextNode(t)),e.appendChild(s)}return e}setContent(){this.contentEl=a.get("server-parameters")[0],this.itemContainerEl=this.contentEl.querySelector(".server-parameters__items-container"),this.tabContentEl=this.wndEl.querySelector(".server-parameters-content"),this.tabContentEl.innerHTML="",this.tabContentEl.appendChild(this.contentEl),this.initScrollbar()}createGroups(t){for(const e of t){if(e.hidden)continue;const t=this.createGroup(e);this.itemContainerEl.appendChild(t)}this.updateScrollbar()}createGroup(t){const e=document.createElement("div");e.classList.add("server-parameters__group");const i=document.createElement("div");i.classList.add("world-window__info","server-parameters__info"),i.textContent=t.title,e.appendChild(i);for(const i of t.attrs)i.hidden||e.appendChild(this.createItem(i));return e}createItem(t){const e=a.get("server-parameters-item")[0],i=e.querySelector(".server-parameters__item-name"),n=e.querySelector(".server-parameters__item-value");return i.innerHTML=t.name,"object"!=typeof t.value?n.innerHTML=t.value:n.appendChild(t.value),e}initScrollbar(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}updateScrollbar(){$(this.contentEl).find(".scroll-wrapper").trigger("update")}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"server_parameters"):""}close(){this.getEngine().worldWindow.serverParameters=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(347),a=i(348),s=i(349),r=i(350),o=i(2),l=i(116),c=i(0);var d;!function(t){t.EVENT="EVENT",t.ARCHAIC="ARCHAIC"}(d||(d={}));e.default=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.wndEl=t,this.options=e,this.search={page:1,nick:"",minLvl:"",maxLvl:"",rarity:"",type:""},this.getEngine().huntingStatistics=!0,this.request=new s.default(this),this.pagination=new a.default,this.sorting=new r.default,this.setContent(),this.initSearch(),this.setFilters(),this.getData()}setContent(){this.contentEl=c.get("hunting-statistics")[0],this.tableEl=this.contentEl.querySelector(".hunting-statistics-table"),this.tableHeadersEl=this.contentEl.querySelector(".hunting-statistics-table-header .hunting-statistics__head"),this.tabContentEl=this.wndEl.querySelector(".hunting-statistics-content"),this.tabContentEl.innerHTML="",this.tabContentEl.appendChild(this.contentEl),this.initScrollbar()}createTableHeader(){const t=_t("sort",null,"buttons");for(const e of l.TABLE_HEADERS){const i=document.createElement("th");i.classList.add("hunting-statistics__head-"+e.key),(0,o.isset)(e.default)&&i.classList.add("hunting-statistics__head-"+e.key),i.textContent=_t(e.key,null,"hunting_statistics"),e.sort&&(i.classList.add("can-hover"),$(i).tip(t),i.addEventListener("click",()=>this.sorting.callChangeSort(e.key))),i.className+=this.getSortClass(e.key),this.tableHeadersEl.appendChild(i)}}getSortClass(t){const e=this.sorting.getSortType(),i=this.sorting.getSortOrder();let n;return n=e!==t?"":" sort-arrow "+(i===l.SORT_ORDER.DESC?"sort-arrow-down":"sort-arrow-up"),n}createItems(t){for(const e of t)this.tableEl.appendChild(this.createItem(e))}createItem(t){const{kills:e,loot:i,npc:n}=t,a=c.get("hunting-statistics-item")[0],s=a.querySelector(".hunting-statistics-item__name"),r=a.querySelector(".hunting-statistics-item__level"),o=a.querySelector(".hunting-statistics-item__kills"),l=a.querySelector(".hunting-statistics-item__unique"),d=a.querySelector(".hunting-statistics-item__heroic"),h=a.querySelector(".hunting-statistics-item__legendary");s.innerHTML=n.name,r.innerHTML=String(n.level)+n.prof,o.innerHTML=String(e),l.innerHTML=i.Unique?`${i.Unique.gain} (${i.Unique.seen})`:"-",d.innerHTML=i.Heroic?`${i.Heroic.gain} (${i.Heroic.seen})`:"-",h.innerHTML=i.Legendary?`${i.Legendary.gain} (${i.Legendary.seen})`:"-";const u=Engine.npcs.getTip(Object.assign(Object.assign({},n),{d:Object.assign({nick:n.name,lvl:n.level,wt:n.warrior_type},n)})),p=`<div class="mt-2 text-center"><img src="${CFG.a_npath+n.icon}" style="display: inline-block; max-width: 100%;"></div>`;return $(s).tip(u+p),a}update(t){t.show.page&&this.pagination.updatePages(t.show.page),this.pagination.isFirstPageUpdate()&&(this.tableEl.replaceChildren(),this.tableHeadersEl.replaceChildren(),this.createTableHeader()),this.createItems(t.show.statistics),this.pagination.isFirstPageUpdate()&&(this.updateScrollbar(),this.scrollTop()),this.updateBarPos()}initSearch(){const t=this.contentEl.querySelector(".search"),e=this.contentEl.querySelector(".search-x"),i=this.contentEl.querySelector(".start-lvl-wrapper"),a=this.contentEl.querySelector(".stop-lvl-wrapper"),s=this.contentEl.querySelector(".choose-prof"),r=this.contentEl.querySelector(".choose-type"),l=createNiInput({cl:"start-lvl",placeholder:_t("start"),changeClb:(0,o.debounce)(t=>this.minLvlOnChange(t),300),clearClb:()=>this.minLvlOnChange(""),type:"number"})[0],c=createNiInput({cl:"stop-lvl",placeholder:_t("stop"),changeClb:(0,o.debounce)(t=>this.maxLvlOnChange(t),300),clearClb:()=>this.maxLvlOnChange(""),type:"number"})[0];i.appendChild(l),a.appendChild(c),t.addEventListener("input",(0,o.debounce)(t=>{let{target:e}=t;this.nickOnChange(e.value)},300)),e.addEventListener("click",(function(){t.value="",(0,o.triggerEvent)(t,"input")}));const h=[{val:"all",text:_t("prof_all",null,"auction")},{val:n.npcRarity.ELITE,text:n.npcRarityData[n.npcRarity.ELITE].name},{val:n.npcRarity.ELITE2,text:n.npcRarityData[n.npcRarity.ELITE2].name},{val:n.npcRarity.ELITE3,text:n.npcRarityData[n.npcRarity.ELITE3].name},{val:n.npcRarity.HERO,text:n.npcRarityData[n.npcRarity.HERO].name},{val:n.npcRarity.COLOSSUS,text:n.npcRarityData[n.npcRarity.COLOSSUS].name},{val:n.npcRarity.TITAN,text:n.npcRarityData[n.npcRarity.TITAN].name}];this.$raritySelect=$(s),this.$raritySelect.createMenu(h,!0,t=>{this.rarityOnChange(t)});const u=[{val:"all",text:_t("prof_all",null,"auction")},{val:d.EVENT,text:this.tLang(d.EVENT)},{val:d.ARCHAIC,text:this.tLang(d.ARCHAIC)}];this.$typeSelect=$(r),this.$typeSelect.createMenu(u,!0,t=>{this.typeOnChange(t)})}setFilters(){if(void 0===this.options.filters)return;const t=this.contentEl.querySelector(".search"),e=this.contentEl.querySelector(".start-lvl-wrapper input"),i=this.contentEl.querySelector(".stop-lvl-wrapper input");this.contentEl.querySelector(".choose-prof");this.options.filters.nick&&(this.setNick(this.options.filters.nick),t.value=this.options.filters.nick,(0,o.triggerEvent)(t,"change")),this.options.filters.minLvl&&(this.setMinLvl(String(this.options.filters.minLvl)),e.value=String(this.options.filters.minLvl),(0,o.triggerEvent)(e,"change")),this.options.filters.maxLvl&&(this.setMaxLvl(String(this.options.filters.maxLvl)),i.value=String(this.options.filters.maxLvl),(0,o.triggerEvent)(i,"change")),this.options.filters.rarity&&(this.setRarity(this.options.filters.rarity),this.$raritySelect.setOptionWithoutCallbackByValue(this.options.filters.rarity)),this.getData()}setNick(t){this.search.nick=""!==t?t.toLowerCase():""}setRarity(t){this.search.rarity=""!==t?t:""}setType(t){this.search.type=""!==t?t:""}setMinLvl(t){this.search.minLvl=""!==t?parseInt(t):""}setMaxLvl(t){this.search.maxLvl=""!==t?parseInt(t):""}nickOnChange(t){this.setNick(t),this.getData()}rarityOnChange(t){this.setRarity(t),this.getData()}typeOnChange(t){this.setType(t),this.getData()}minLvlOnChange(t){this.setMinLvl(t),this.getData()}maxLvlOnChange(t){this.setMaxLvl(t),this.getData()}getData(){this.request.mainRequest()}getFiltersQuery(){return`&filter=${arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.search.page}|${this.search.minLvl}|${this.search.maxLvl}|${this.search.rarity}|${(0,o.esc)(this.search.nick)}|${this.search.type}`}initScrollbar(){let t=$("<div>").addClass("scroll-auction-plug");$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0,addScrollableClassToAnotherEl:$(this.contentEl).find(".hunting-statistics-table-header-wrapper"),callback:this.scrollMove.bind(this)}),$(this.contentEl).find(".scrollbar-wrapper").append(t)}updateScrollbar(){$(this.contentEl).find(".scroll-wrapper").trigger("update")}scrollTop(){$(this.contentEl).find(".scroll-wrapper").trigger("scrollTop")}updateBarPos(){$(this.contentEl).find(".scroll-wrapper").trigger("updateBarPos")}stopDragBar(){$(this.contentEl).find(".scroll-wrapper").trigger("stopDragBar")}scrollMove(){this.pagination.getNextPageAction()}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hunting_statistics"):""}close(){this.getEngine().worldWindow.huntingStatistics=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.npcRarityData=e.npcRarity=void 0,e.npcRarity={HERO:"Hero",TITAN:"Titan",COLOSSUS:"Colossus",ELITE:"Elite",ELITE2:"Elite2",ELITE3:"Elite3"},e.npcRarityData={[e.npcRarity.HERO]:{name:_t("wt_hero",null,"npc")},[e.npcRarity.TITAN]:{name:_t("wt_titan",null,"npc")},[e.npcRarity.COLOSSUS]:{name:_t("wt_colossus",null,"npc")},[e.npcRarity.ELITE]:{name:_t("eliteI",null,"npc")},[e.npcRarity.ELITE2]:{name:_t("eliteII",null,"npc")},[e.npcRarity.ELITE3]:{name:_t("wt_elite3",null,"npc")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.currentPage=null,this.maxPage=null,this.checkCanGetNextPage=()=>null!==this.currentPage&&(null!==this.maxPage&&this.currentPage!==this.maxPage),this.getNextPageAction=()=>{if(this.checkCanGetNextPage()&&null!==this.currentPage){const t=this.currentPage+1;this.getNextPageRequest(t,()=>{Engine.worldWindow.huntingStatistics.stopDragBar()})}},this.updatePages=t=>{let{number:e,total:i}=t;this.currentPage=e,this.maxPage=i},this.getMaxPage=()=>this.maxPage,this.getCurrentPage=()=>this.currentPage,this.isFirstPageUpdate=()=>1===this.currentPage||0===this.maxPage,this.getNextPageRequest=(t,e)=>{Engine.worldWindow.huntingStatistics.request.getNextPageRequest(t,()=>{e()})}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.huntingStatistics=t}mainRequest(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=this.getAllItemsRequest(t);_g(e)}getNextPageRequest(t,e){const i=this.getAllItemsRequest(t);_g(i,()=>{e()})}getAllItemsRequest(t,e){return`hunting_statistics${this.huntingStatistics.getFiltersQuery(t)}${this.huntingStatistics.sorting.getSortQuery()}`}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(116),a=i(2);e.default=class{constructor(){this.defaultSortType=n.TABLE_HEADERS.find(t=>(0,a.isset)(t.default)).key,this.sortType=this.defaultSortType,this.sortOrder=n.SORT_ORDER.DESC}init(){}getSortQuery(){return`&sort=${this.sortType}|${this.sortOrder}`}callChangeSort(t){this.changeSortProcedure(t),Engine.worldWindow.huntingStatistics.request.mainRequest()}changeSortProcedure(t){if(this.sortType===t){const t=this.isASCOrder()?n.SORT_ORDER.DESC:n.SORT_ORDER.ASC;this.setSortOrder(t)}else this.setSortType(t),this.setSortOrder(n.SORT_ORDER.ASC)}isASCOrder(){return this.sortOrder==n.SORT_ORDER.ASC}setSortType(t){this.sortType=t}setSortOrder(t){this.sortOrder=t}getSortType(){return this.sortType}getSortOrder(){return this.sortOrder}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.default=class{constructor(t){this.wndEl=t,this.getEngine().locationParameters=!0,this.setContent();const e=this.getParameters();this.createGroups(e)}updateParameters(){this.clearTable();const t=this.getParameters();this.createGroups(t)}getParameters(){const t=0===Engine.map.config.getLvlMax()?500:Engine.map.config.getLvlMax();return[{title:this.tLang("basic-parameters"),attrs:[{name:this.tLang("respawn"),value:Engine.map.config.getRespawn()},{name:this.tLang("isTeleportBlocked"),value:this.setOnOff(!Engine.map.config.getIsTeleportBlocked())},{name:this.tLang("isTpOutAfterOffline"),value:this.setOnOff(Engine.map.config.getIsTpOutAfterOffline())},{name:this.tLang("isTeleportAt5AM"),value:this.setOnOff(Engine.map.config.getIsTeleportAt5AM())},...Engine.worldConfig.getHardcore()?[{name:this.tLang("isMakeNoobImmune"),value:this.setOnOff(!Engine.map.config.getIsMakeNoobImmune())}]:[],{name:this.tLang("isPrivRoom"),value:this.setOnOff(Engine.map.config.getIsPrivRoom())},{name:this.tLang("isRespawnShortened"),value:this.setOnOff(Engine.map.config.getIsRespawnShortened())},{name:this.tLang("isTimeticketsUsageDisabled"),value:this.setOnOff(!Engine.map.config.getIsTimeticketsUsageDisabled())},{name:this.tLang("isClearEnabled"),value:this.setOnOff(Engine.map.config.getIsClearEnabled())},{name:this.tLang("isQuestFogEnabled"),value:this.setOnOff(Engine.map.config.getIsQuestFogEnabled())},{name:this.tLang("locationLvlAccess"),value:`${Engine.map.config.getLvlMin()} - ${t}`}]},{title:this.tLang("pvp-parameters"),attrs:[{name:this.tLang("pvpMode"),value:_t("pvp_"+{0:"green",1:"yellow",2:"red",4:"orange"}[Engine.map.d.pvp])},{name:this.tLang("isBattlePvPQuickModeEnabled"),value:this.setOnOff(Engine.map.config.getIsBattlePvPQuickModeEnabled())},{name:this.tLang("isPartiesDisabled"),value:this.setOnOff(!Engine.map.config.getIsPartiesDisabled())},{name:this.tLang("isPvpLvlAdvantageDisabled"),value:this.setOnOff(!Engine.map.config.getIsPvpLvlAdvantageDisabled())}]}]}setOnOff(t){return t?this.tLang("on"):this.tLang("off")}setContent(){this.contentEl=n.get("location-parameters")[0],this.itemContainerEl=this.contentEl.querySelector(".location-parameters__items-container"),this.tabContentEl=this.wndEl.querySelector(".location-parameters-content"),this.tabContentEl.innerHTML="",this.tabContentEl.appendChild(this.contentEl),this.initScrollbar()}clearTable(){this.itemContainerEl.innerHTML=""}createGroups(t){for(const e of t){if(e.hidden)continue;const t=this.createGroup(e);this.itemContainerEl.appendChild(t)}this.updateScrollbar()}createGroup(t){const e=document.createElement("div");e.classList.add("location-parameters__group");const i=document.createElement("div");i.classList.add("world-window__info","location-parameters__info"),i.textContent=t.title,e.appendChild(i);for(const i of t.attrs)i.hidden||e.appendChild(this.createItem(i));return e}createItem(t){const e=n.get("location-parameters-item")[0],i=e.querySelector(".location-parameters__item-name"),a=e.querySelector(".location-parameters__item-value");return i.innerHTML=t.name,"object"!=typeof t.value?a.innerHTML=t.value:a.appendChild(t.value),e}initScrollbar(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}updateScrollbar(){$(this.contentEl).find(".scroll-wrapper").trigger("update")}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"location_parameters"):""}close(){this.getEngine().worldWindow.locationParameters=!1}}},function(t,e,i){var n=i(0);let a=i(7);var s=i(8),r=i(73);t.exports=function(){var t=null;let e={},i={},o=!1,l=null,c=this;function d(){let t="";if(!arguments.length)return errorReport("WidgetManager.js","addSeveralTypesToWidget","arguments is empty!"),t;for(let e in arguments)t+=arguments[e],t+=" ";return t.slice(0,t.length-1)}this.init=()=>{this.setWidgetSize(r.WIDGET_SIZE_BY_RES[r.KEY._DEFAULT]),this.initDrop(),this.addElementToWidgetLinkedWithSection(Engine.widgetsData.name.CHAT,()=>Engine.chatController.getChatWindow().getChatSize()),this.addElementToWidgetLinkedWithSection(Engine.widgetsData.name.MAP,()=>Engine.miniMapController.getMiniMapShow()),this.addElementToWidgetLinkedWithSection(Engine.widgetsData.name.EQ_TOGGLE,()=>Engine.interface.getEqColumnsSizeFromStorage()),this.addElementToWidgetLinkedWithSection(Engine.widgetsData.name.BATTLE_LOG,()=>Engine.battle.getBattleMessageShow())},this.setWidgetSize=t=>{l=t},this.getWidgetSize=()=>l,this.addElementToWidgetLinkedWithSection=(t,e)=>{i[t]=e},this.removeElementFromWidgetLinked=t=>{this.checkWidgetIsLinkedToSection(t)&&delete i[t]},this.checkWidgetIsLinkedToSection=t=>!!i[t],this.checkSectionIsShowByLinkedWidget=t=>!!i[t]&&i[t](),this.setTypeInDefaultWidgetSet=(e,i)=>{t[e].type=i},this.initDefaultWidgetSet=function(){const e=Engine.widgetsData.name,i=Engine.widgetsData.pos,n=Engine.widgetsData.type;var a=mobileCheck(),s=Engine.party?"":n.DISABLED;let r=Engine.interface;a?(t={[e.ZOOM]:{default:!0,index:0,pos:i.TOP_LEFT,txt:_t("zoom-in-out-panel"),type:n.GREEN,clb:r.clickZoomOverlayPanel},[e.EXIT]:{default:!0,index:1,pos:i.TOP_LEFT,txt:c.tLang("quit_game"),type:n.GREEN,clb:r.clickLogout,requires:{minLvl:10,characters:1}},[e.SETTINGS]:{default:!0,index:3,pos:i.TOP_LEFT,txt:c.tLang("game-config"),type:n.GREEN,clb:r.clickSettings,alwaysExist:!0},[e.FULL_SCREEN]:{default:!0,index:4,pos:i.TOP_LEFT,txt:c.tLang("full-screen"),type:n.GREEN,clb:r.clickFullScreen},[e.EQ_TOGGLE]:{default:!0,index:0,pos:i.TOP_RIGHT,txt:_t("eqcolumnshow"),type:n.GREEN,clb:r.clickEqColumnShow},[e.ADDONS]:{default:!0,index:1,pos:i.TOP_RIGHT,txt:c.tLang("addons-widget"),type:n.GREEN,clb:r.clickPuzzle,requires:{minLvl:3}},[e.CLAN]:{default:!0,index:2,pos:i.TOP_RIGHT,txt:c.tLang("clans-widget"),type:n.GREEN,clb:r.clickClan},[e.MAP]:{default:!0,index:3,pos:i.TOP_RIGHT,txt:c.tLang("show-minimap"),type:n.GREEN,clb:r.clickMiniMap},[e.PARTY]:{default:!0,index:4,pos:i.TOP_RIGHT,txt:c.tLang("party-widget"),type:d(n.BLUE,s),clb:r.clickParty,alwaysExist:!0},[e.CHAT]:{default:!0,index:0,pos:i.BOTTOM_LEFT,txt:c.tLang("chat-widget"),type:n.GREEN,clb:r.clickChat,alwaysExist:!0},[e.PAD]:{default:!0,index:1,pos:i.BOTTOM_LEFT,txt:_t("padController"),type:n.GREEN,clb:r.clickPad,alwaysExist:!0},[e.CRAFTING]:{default:!0,index:2,pos:i.BOTTOM_LEFT,txt:_t("iconphoto"),type:n.GREEN,clb:r.clickPhoto,requires:{minLvl:isPl()?10:6},alwaysExist:!0},[e.MINI_MAP]:{default:!0,index:3,pos:i.BOTTOM_LEFT,txt:_t("hotportablemap"),type:n.GREEN,clb:r.clickPortableMap},[e.WHO_IS_HERE]:{default:!0,index:4,pos:i.BOTTOM_LEFT,txt:_t("iconcompass"),type:n.GREEN,clb:r.clickWhoIsHere,requires:{minLvl:3}},[e.QUEST_LOG]:{default:!0,index:4,pos:i.BOTTOM_RIGHT,txt:c.tLang("quest-log"),type:n.GREEN,clb:r.clickQuests,alwaysExist:!0},[e.COMMUNITY]:{default:!0,index:3,pos:i.BOTTOM_RIGHT,txt:_t("society"),type:n.GREEN,clb:r.clickSociety,alwaysExist:!0},[e.SKILLS]:{default:!0,index:2,pos:i.BOTTOM_RIGHT,txt:c.tLang("skills-panel"),type:n.GREEN,clb:r.clickSkills,alwaysExist:!0,requires:{minLvl:25}},[e.PREMIUM]:{default:!0,index:0,pos:i.BOTTOM_RIGHT,txt:_t("premium"),type:n.BLINK_VIOLET,clb:r.clickPremium,alwaysExist:!0},[e.ATTACK_MOB]:{default:!0,index:0,pos:i.BOTTOM_RIGHT_ADDITIONAL,txt:_t("hotAttackNearMob"),type:n.GREEN,clb:r.clickAttackNearMob},[e.TALK]:{default:!1,txt:_t("hotTalkNearMob"),type:n.GREEN,clb:r.clickTalkNearMob},[e.PICK_UP_ITEM]:{default:!1,txt:_t("hotTakeGroundItem"),type:n.GREEN,clb:r.clickDragGroundItem},[e.ATTACK_PLAYER]:{default:!1,txt:_t("hotAttackNearPlayer"),type:n.GREEN,clb:r.clickAttackNearPlayer},[e.BATTLE_LOG]:{default:!1,txt:_t("showLog"),type:n.GREEN,clb:r.clickShowLog},[e.ATTACK_MOB_AUTO]:{default:!1,txt:_t("autofightNearMob"),type:n.GREEN,clb:r.clickAutofightNearMob},[e.USE_DOOR]:{default:!1,txt:_t("go-gateway"),type:n.GREEN,clb:r.clickGoGateway},[e.QUICK_PARTY]:{default:!1,txt:_t("sendInviteToGroup"),type:n.GREEN,clb:r.clickQuickPaty},[e.CLAN_MSG]:{default:!1,txt:_t("hotkey_send",null,"clan_my_location"),type:n.GREEN,clb:r.clickSendMessageOnClanChat},[e.CONSOLE]:{default:!1,txt:c.tLang("iconconsole"),type:n.GREEN,clb:r.clickConsole},[e.WORLD]:{default:!0,index:2,pos:i.TOP_LEFT,txt:_t("title",null,"world_window"),type:n.GREEN,clb:r.clickWorld}},isPl()&&(t[e.NEWS]={default:!0,index:1,pos:i.BOTTOM_RIGHT,txt:_t("news",null,"news"),type:n.VIOLET,clb:r.clickNews,alwaysExist:!0,requires:{minLvl:15}}),isPl()||(t[e.ACHIEVEMENTS]={default:!0,index:5,pos:i.TOP_RIGHT,txt:c.tLang("achievements"),type:n.GREEN,clb:r.clickAchivements,alwaysExist:!0}),isPl()&&(t[e.MATCHMAKING]={default:!1,txt:c.tLang("matchmaking"),type:n.GREEN,clb:r.clickMatchmaking,requires:{minLvl:40}}),Engine.interface.getBattlePassActive()&&(t[e.BATTLE_PASS]={default:!0,index:5,pos:i.BOTTOM_RIGHT,txt:_t("path_of_hero"),type:n.VIOLET,clb:r.clickBattlePass,alwaysExist:!0,requires:{minLvl:10}}),Engine.interface.rewardsCalendarActive()&&(t[[e.REWARDS_CALENDAR]]={default:!0,index:3,pos:i.BOTTOM_LEFT_ADDITIONAL,txt:_t("clickEventCalendar"),type:n.VIOLET,clb:r.clickRewardsCalendar,alwaysExist:!0,requires:{minLvl:25}})):(t={[e.EXIT]:{default:!0,index:0,pos:i.TOP_LEFT,txt:c.tLang("quit_game"),type:n.GREEN,clb:r.clickLogout,requires:{minLvl:10,characters:1}},[e.SETTINGS]:{default:!0,index:2,pos:i.TOP_LEFT,txt:c.tLang("game-config"),type:n.GREEN,clb:r.clickSettings,alwaysExist:!0},[e.FULL_SCREEN]:{default:!0,index:3,pos:i.TOP_LEFT,txt:c.tLang("full-screen"),type:n.GREEN,clb:r.clickFullScreen},[e.ADDONS]:{default:!0,index:0,pos:i.TOP_RIGHT,txt:c.tLang("addons-widget"),type:n.GREEN,clb:r.clickPuzzle,requires:{minLvl:3}},[e.CLAN]:{default:!0,index:1,pos:i.TOP_RIGHT,txt:c.tLang("clans-widget"),type:n.GREEN,clb:r.clickClan},[e.MAP]:{default:!0,index:2,pos:i.TOP_RIGHT,txt:c.tLang("show-minimap"),type:n.GREEN,clb:r.clickMiniMap},[e.PARTY]:{default:!0,index:3,pos:i.TOP_RIGHT,txt:c.tLang("party-widget"),type:d(n.BLUE,s),clb:r.clickParty,alwaysExist:!0},[e.CHAT]:{default:!0,index:0,pos:i.BOTTOM_LEFT,txt:c.tLang("chat-widget"),type:n.GREEN,clb:r.clickChat,alwaysExist:!0},[e.CRAFTING]:{default:!0,index:1,pos:i.BOTTOM_LEFT,txt:_t("iconphoto"),type:n.GREEN,clb:r.clickPhoto,requires:{minLvl:isPl()?10:6},alwaysExist:!0},[e.MINI_MAP]:{default:!0,index:2,pos:i.BOTTOM_LEFT,txt:_t("hotportablemap"),type:n.GREEN,clb:r.clickPortableMap},[e.WHO_IS_HERE]:{default:!0,index:3,pos:i.BOTTOM_LEFT,txt:_t("iconcompass"),type:n.GREEN,clb:r.clickWhoIsHere,requires:{minLvl:3}},[e.PREMIUM]:{default:!0,index:0,pos:i.BOTTOM_RIGHT,txt:_t("premium"),type:n.BLINK_VIOLET,clb:r.clickPremium,alwaysExist:!0},[e.SKILLS]:{default:!0,index:2,pos:i.BOTTOM_RIGHT,txt:c.tLang("skills-panel"),type:n.GREEN,clb:r.clickSkills,alwaysExist:!0,requires:{minLvl:25}},[e.COMMUNITY]:{default:!0,index:3,pos:i.BOTTOM_RIGHT,txt:_t("society"),type:n.GREEN,clb:r.clickSociety,alwaysExist:!0},[e.QUEST_LOG]:{default:!0,index:4,pos:i.BOTTOM_RIGHT,txt:c.tLang("quest-log"),type:n.GREEN,clb:r.clickQuests,alwaysExist:!0},[e.PICK_UP_ITEM]:{default:!1,txt:_t("hotTakeGroundItem"),type:n.GREEN,clb:r.clickDragGroundItem},[e.ATTACK_MOB]:{default:!1,txt:_t("hotAttackNearMob"),type:n.GREEN,clb:r.clickAttackNearMob},[e.ATTACK_PLAYER]:{default:!1,txt:_t("hotAttackNearPlayer"),type:n.GREEN,clb:r.clickAttackNearPlayer},[e.TALK]:{default:!1,txt:_t("hotTalkNearMob"),type:n.GREEN,clb:r.clickTalkNearMob},[e.BATTLE_LOG]:{default:!1,txt:_t("showLog"),type:n.GREEN,clb:r.clickShowLog},[e.EQ_TOGGLE]:{default:!1,txt:_t("eqcolumnshow"),type:n.GREEN,clb:r.clickEqColumnShow},[e.ATTACK_MOB_AUTO]:{default:!1,txt:_t("autofightNearMob"),type:n.GREEN,clb:r.clickAutofightNearMob},[e.USE_DOOR]:{default:!1,txt:_t("go-gateway"),type:n.GREEN,clb:r.clickGoGateway},[e.QUICK_PARTY]:{default:!1,txt:_t("sendInviteToGroup"),type:n.GREEN,clb:r.clickQuickPaty},[e.CONSOLE]:{default:!1,txt:c.tLang("iconconsole"),type:n.GREEN,clb:r.clickConsole},[e.CLAN_MSG]:{default:!1,txt:_t("hotkey_send",null,"clan_my_location"),type:n.GREEN,clb:r.clickSendMessageOnClanChat},[e.WORLD]:{default:!0,index:1,pos:i.TOP_LEFT,txt:_t("title",null,"world_window"),type:n.GREEN,clb:r.clickWorld}},isPl()&&(t[e.NEWS]={default:!0,index:1,pos:i.BOTTOM_RIGHT,txt:_t("news",null,"news"),type:n.VIOLET,clb:r.clickNews,alwaysExist:!0,requires:{minLvl:15}}),isPl()||(t[e.ACHIEVEMENTS]={default:!0,index:5,pos:i.TOP_RIGHT,txt:c.tLang("achievements"),type:n.GREEN,clb:r.clickAchivements,alwaysExist:!0}),isPl()&&(t[e.MATCHMAKING]={default:!0,index:4,pos:i.TOP_RIGHT,txt:c.tLang("matchmaking"),type:n.GREEN,clb:r.clickMatchmaking,requires:{minLvl:40}}),Engine.interface.getBattlePassActive()&&(t[e.BATTLE_PASS]={default:!0,index:5,pos:i.BOTTOM_RIGHT,txt:_t("path_of_hero"),type:n.VIOLET,clb:r.clickBattlePass,alwaysExist:!0,requires:{minLvl:10}}),Engine.interface.rewardsCalendarActive()&&(t[e.REWARDS_CALENDAR]={default:!0,index:4,pos:i.BOTTOM_LEFT,txt:_t("clickEventCalendar"),type:n.VIOLET,clb:r.clickRewardsCalendar,alwaysExist:!0,requires:{minLvl:25}}));for(let e in t)t[e].keyName=e},this.getDefaultWidgetSet=function(){return t},this.initOneWidgetDroppable=function(t){Engine.interface.get$interfaceLayer().find("."+t).droppable({accept:".widget-button"}).on("drop",(function(e,i){var n=i.draggable.hasClass("from-addon-panel"),s=i.draggable.hasClass("from-settings-panel"),r=c.getDropIndex(i,t,$(this)),o=i.draggable.data(Engine.widgetsData.data.WIDGET_KEY);let l={};var d=c.checkOnIndexIsEmpty($(this),r);if(d){if(n||s)return message(_t("place_is_not_empty"));var h=i.draggable.attr(Engine.widgetsData.attr.WIDGET_POS),u=i.draggable.attr(Engine.widgetsData.attr.WIDGET_INDEX);l[d.data(Engine.widgetsData.data.WIDGET_KEY)]=[u,h]}c.saveHotWidgetToStorage(o,r,t,l);let p={};if(p[c.getPathToHotWidgetVersion()]=l,n){var g=o.slice(6);Engine.addonsPanel.getAddonTitle(g);p[a.ADDONS]={},p[a.ADDONS][g]={state:!0}}Engine.serverStorage.sendData(p,()=>{c.afterSaveWidgetInServerStorage(o,r,t,n)})}))},this.initDrop=function(){let t=Engine.widgetsData;this.initOneWidgetDroppable(t.pos.BOTTOM_LEFT_ADDITIONAL),this.initOneWidgetDroppable(t.pos.BOTTOM_RIGHT_ADDITIONAL),this.initOneWidgetDroppable(t.pos.BOTTOM_LEFT),this.initOneWidgetDroppable(t.pos.BOTTOM_RIGHT),this.initOneWidgetDroppable(t.pos.TOP_RIGHT),this.initOneWidgetDroppable(t.pos.TOP_LEFT),this.initOneDropToDeleteWidget("up-part"),this.initOneDropToDeleteWidget("middle-part"),this.initOneDropToDeleteWidget("down-part")},this.initOneDropToDeleteWidget=function(e){Engine.interface.get$dropToDeleteWidgetLayer().find("."+e).droppable({accept:".widget-in-interface-bar",drop:function(e,i){var n=i.draggable.data(Engine.widgetsData.data.WIDGET_KEY);if(isset(t[n].alwaysExist)&&t[n].alwaysExist)return void mAlert(_t("ALWAYS_EXIST"));let a=c.getPathToHotWidgetVersion(),s={};s[a]={},s[a][n]=!1,Engine.serverStorage.sendData(s,()=>{c.addWidgetButtons()})}})},this.getPathToHotWidgetVersion=function(){return mobileCheck()?a.HOT_WIDGET_MOBILE:a.HOT_WIDGET_PC},this.saveHotWidgetToStorage=function(t,e,i,n){n[t]=[e,i]},this.checkOnIndexIsEmpty=(t,e)=>{let i=this.createAttrSelector(Engine.widgetsData.attr.WIDGET_INDEX,e),n=t.find(i);return n.length>0&&n},this.createAttrSelector=(t,e)=>`[${t}=${e}]`,this.setEqWidgetAmountShow=function(t){let e=!!t;c.widgets.isActive(Engine.widgetsData.name.EQ_TOGGLE,e)},this.getDropIndex=function(t,e,i){let n=Engine.widgetsData,a=e==n.pos.TOP_LEFT||e==n.pos.BOTTOM_LEFT||e==n.pos.BOTTOM_LEFT_ADDITIONAL,s=Math.round((t.offset.left-i.offset().left)/l/Engine.zoomFactor);return a||(s=Math.abs(s-6)),s},this.afterSaveWidgetInServerStorage=(e,i,n,a)=>{if(a){let t=e.slice(6),a=Engine.addonsPanel.getAddonTitle(t);c.addKeyToDefaultWidgetSet(e,i,n,a,Engine.widgetsData.type.GREEN,(function(){Engine.addonsPanel.oneAddonManageVisible(t)})),Engine.addonsPanel.setStateAddon("xD",!0,t,!0)}c.addWidgetButtons(),c.widgetDrop(t[e].txt,n+" "+i)},this.getWidgetsSlots=e=>{var i={name:"",pos:"",bar:""};let n=Engine.widgetsData;var a={[n.pos.TOP_LEFT]:["","","","","","",""],[n.pos.TOP_RIGHT]:["","","","","","",""],[n.pos.BOTTOM_LEFT]:["","","","","","",""],[n.pos.BOTTOM_RIGHT]:["","","","","","",""],[n.pos.BOTTOM_LEFT_ADDITIONAL]:["","","","","","",""],[n.pos.BOTTOM_RIGHT_ADDITIONAL]:["","","","","","",""]};if(e)for(let t=0;t<e.length;t++){let i=e[t][0];a[e[t][1]][i]="w"}for(var s in a)for(let e=0;e<a[s].length;e++){if("w"==a[s][e])continue;let n="."+s,r=c.createAttrSelector(Engine.widgetsData.attr.WIDGET_INDEX,e),o=Engine.interface.get$interfaceLayer().find(n).find(r);if(o.length){a[s][e]="w";let n=o.attr(Engine.widgetsData.attr.WIDGET_NAME);t[n].addon&&(i.name=n,i.pos=e,i.bar=s)}}return{widgets:a,canDelete:i}},this.getFirstEmptyWidgetSlot=()=>{let t=this.getWidgetsSlots().widgets;for(var e in t){var i=t[e].indexOf("");if(i>-1)return{slot:i,container:e}}return!1},this.createEmptySlotsWidget=function(){$(".main-buttons-container").each((function(){for(let t=0;t<7;t++){let t=n.get("empty-slot-widget");h(t),$(this).append(t)}}))},this.resizeAllEmptySlotWidget=()=>{$(".empty-slot-widget").each((function(){h($(this))}))},this.resizeAllWidgetInAddons=()=>{let t=getEngine().addonsPanel.getContent();t.find(".widget-button").each((function(){h($(this))})),t.find(".border-blink").css({width:l-2,height:l-2})},this.resizeAllWidgetInSettings=()=>{getEngine().settings.getContent().find(".widget-button").each((function(){h($(this))}))};const h=t=>{t.css({width:l,height:l})};this.showEmptySlots=function(t){$(".main-buttons-container").find(".empty-slot-widget").css("display",t?"block":"none")},this.widgets=new function(){this.add=function(t,e){Engine.interface.get$interfaceLayer().find(".main-buttons-container."+e).append(t)},this.toggleWidgetDisplay=function(t,e){let i=Engine.widgetsData.type.DISABLED;e?$(".main-buttons-container .widget-"+t).removeClass(i):$(".main-buttons-container .widget-"+t).addClass(i)},this.updateAmount=(t,e)=>{Engine.interface.get$interfaceLayer().find(`.main-buttons-container .widget-${t} .amount`).text(e)},this.getWidgetAmount=t=>Engine.interface.get$interfaceLayer().find(`.main-buttons-container .widget-${t} .amount`).text(),this.isActive=(t,e)=>{let i=Engine.interface.get$interfaceLayer().find(".main-buttons-container .widget-"+t);e?i.addClass("is-active"):i.removeClass("is-active")}},this.addKeyToDefaultWidgetSet=function(e,i,n,a,s,r){t[e]={keyName:e,index:i,pos:n,txt:a,type:s,clb:r,addon:!0}},this.resetWidgetButtons=function(){mAlert(_t("sure_reset_widgets"),[{txt:_t("yes"),callback:function(){let e={};return e[c.getPathToHotWidgetVersion()]=!1,Engine.serverStorage.sendData(e,(function(){t=null,c.initDefaultWidgetSet(),c.addWidgetButtons()})),!0}},{txt:_t("no"),callback:function(){return!0}}])},this.rebuildWidgetButtons=function(){this.addWidgetButtons(!0),this.setEditableWidget(!1)},this.rebuiltWidgetBarsIndex=function(){let t={},e=Engine.widgetsData;this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_LEFT,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_RIGHT,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_LEFT_ADDITIONAL,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_RIGHT_ADDITIONAL,t),this.rebuiltOneBarWidgetBar(e.pos.TOP_LEFT,t),this.rebuiltOneBarWidgetBar(e.pos.TOP_RIGHT,t),c.equalizeWidgetBars("left",t),c.equalizeWidgetBars("right",t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_LEFT,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_RIGHT,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_LEFT_ADDITIONAL,t),this.rebuiltOneBarWidgetBar(e.pos.BOTTOM_RIGHT_ADDITIONAL,t),c.equalizeWidgetBars("left",t),c.equalizeWidgetBars("right",t);let i={};i[c.getPathToHotWidgetVersion()]=t,Engine.serverStorage.sendData(i,(function(){c.rebuildWidgetButtons()}))},this.rebuiltOneBarWidgetBar=(t,e)=>{for(var i=Engine.interface.get$interfaceLayer().find("."+t+".main-buttons-container"),n=0;n<7;n++){let s=c.createAttrSelector(Engine.widgetsData.attr.WIDGET_INDEX,n);if(!(i.find(s).length>0)){var a=this.getLeastWidgetIndex(i,n);if(null!=a)a.attr(Engine.widgetsData.attr.WIDGET_INDEX,n),e[a.data(Engine.widgetsData.data.WIDGET_KEY)]=[n,t]}}},this.getLeastWidgetIndex=function(t,e){for(var i=e;i<7;i++){let e=c.createAttrSelector(Engine.widgetsData.attr.WIDGET_INDEX,i),n=t.find(e);if(n.length>0)return n}return null},this.equalizeWidgetBars=(t,e)=>{let i=Engine.interface.get$interfaceLayer();var n=i.find(".bottom-"+t+".main-buttons-container").find(".widget-button"),a=i.find(".bottom-"+t+"-additional.main-buttons-container").find(".widget-button"),s=n.length,r=a.length;s!=r&&(s>0||r>0)&&(s>r?this.equalMoreObjAndLessObj(e,n,a,s,r,"bottom-"+t+"-additional"):this.equalMoreObjAndLessObj(e,a,n,r,s,"bottom-"+t))},this.equalMoreObjAndLessObj=function(t,e,i,n,a,s){for(;n>a+1;){t[e.eq(n-1).data(Engine.widgetsData.data.WIDGET_KEY)]=[a,s],n--,a++}},this.addWidgetButtonsWithInitZoom=()=>{this.addWidgetButtons(!0),Engine.interface.initZoomFactor(!0),this.setEnableDraggingButtonsWidget(!1)},this.updateOneWidgetNoticeProcedure=(i,n)=>{if(!this.checkAttachWidgetList(i)){return void(Engine.widgetNoticeManager.checkAlwaysAvailableByWidgetName(i)&&errorReport("WidgetManager.js","updateOneWidget",`Widget: ${i} not exits in AttachWidgetList!`,e))}let a=t[i];if(!a)return void errorReport("WidgetManager.js","updateOneWidget",`Widget: ${i} not exits in defaultWidgetSet!`,e);if(a.type==n)return;let s=this.getAttachWidgetByName(i);Engine.specificAnimationManager.deleteSpecificAnimationInElementIfExist(s),this.setTypeInDefaultWidgetSet(i,n),this.manageBlinkAnimation(s,n)},this.addWidgetButtons=function(e){let i=Engine.serverStorage.get(c.getPathToHotWidgetVersion());c.removeBlinkSpecificAnimation(),c.removeWidgetFromSlots(),c.clearAttachWidgetList(),i||(i={});let n=[];for(var a in e&&c.hideAdditionalWidgetBars(),t)c.createOneWidget(a,i,e,n);n.length&&this.findPositionToWidgetsWithoutFreeSlot(n,e),Engine.hotKeys.rebuildHotKeys(),Engine.party&&Engine.party.onInterfaceReady(),Engine.whoIsHere&&Engine.whoIsHere.onInterfaceReady(),this.setEqWidgetAmountShow(Engine.interface.checkEqColumnShow()),o||(u(!0),Engine.widgetNoticeManager.forceUpdate())};const u=t=>{o=t};this.findPositionToWidgetsWithoutFreeSlot=(t,e)=>{let i={},n=[];for(let e=0;e<t.length;e++){let a=t[e],s=c.getBruteWidgetData(a,n);Object.assign(i,s)}this.saveNewPosWidgetsToServerStorage(i,e)},this.saveNewPosWidgetsToServerStorage=(t,e)=>{let i={};i[c.getPathToHotWidgetVersion()]=t,Engine.serverStorage.sendData(i,(function(){c.addWidgetButtons(e)}))},this.getBruteWidgetData=(t,e)=>{let i={};var n=this.getWidgetsSlots(e),a=n.canDelete,s=n.widgets;for(var r in s){var o=s[r].indexOf("");if(o>-1)return i[t]=[o,r],e.push([o,r]),i}return i[a.name]=!1,i[t]=[a.pos,a.bar],i},this.removeBlinkSpecificAnimation=()=>{for(let t in e){let i=e[t];Engine.specificAnimationManager.checkElementHaveSpecificAnimation(i)&&Engine.specificAnimationManager.deleteSpecificAnimationInElementIfExist(i)}},this.removeWidgetFromSlots=()=>{Engine.interface.get$interfaceLayer().find(".main-buttons-container").find(".widget-button").remove()},this.clearAttachWidgetList=()=>{e={}},this.addToAttachWidgetList=(t,i)=>{e[t]=i},this.removeFromAttachWidgetList=t=>{delete e[t]},this.getAttachWidgetList=()=>e,this.checkAttachWidgetList=t=>!!e[t],this.getAttachWidgetByName=t=>e[t],this.unsetWidgetClassWindowIsOpen=t=>{this.getAttachWidgetByName(t).removeClass("window-is-open")},this.setWidgetClassWindowIsOpen=t=>{this.getAttachWidgetByName(t).addClass("window-is-open")},this.createOneWidget=function(e,i,a,s){var r,o,d=t[e];const h=this.checkWidgetPermission(d);if(!isset(d))return;if(isset(i[e])){if(0==i[e])return;r=i[e][0],o=i[e][1]}else{var u=t[e];if(!u.default)return;r=u.index,o=u.pos,i[e]=[r,o]}let p="."+o,g=c.createAttrSelector(Engine.widgetsData.attr.WIDGET_INDEX,r);if(Engine.interface.get$interfaceLayer().find(p).find(g).length)return void s.push(e);var f=n.get("widget-button");f.addClass(d.type+" widget-in-interface-bar widget-"+e),f.find(".icon").addClass(e),c.set$BtnWidgetSize(f),f.bind("click",()=>{const t=Object.assign(d,{index:r,pos:o});this.widgetOnClick({widgetData:t})});let m=Engine.widgetsData;o==m.pos.TOP_LEFT||o==m.pos.BOTTOM_LEFT||o==m.pos.BOTTOM_LEFT_ADDITIONAL?f.css("left",r*l):f.css("right",r*l),f.attr({[Engine.widgetsData.attr.WIDGET_INDEX]:r,[Engine.widgetsData.attr.WIDGET_NAME]:e,[Engine.widgetsData.attr.WIDGET_POS]:o}),c.manageBlinkAnimation(f,d.type),c.addToAttachWidgetList(e,f);let v=Engine.windowManager;v.checkWidgetIsLinkedToWindow(e)&&v.checkWindowIsShowByLinkedWidget(e)&&c.manageClassOfWidget(e,!0),this.checkWidgetIsLinkedToSection(e)&&this.checkSectionIsShowByLinkedWidget(e)&&c.manageClassOfWidget(e,!0),f.css("position","absolute");let E=d.txt;h||(f.addClass(Engine.widgetsData.type.DISABLED),E+=" - "+_t("need__lvl",{"%val%":d.requires.minLvl})),c.addDraggableAndDataAndTip(f,E,Engine.widgetsData.data.WIDGET_KEY,e),this.widgets.add(f,o),a&&c.manageDisplayAdditionaWidgetBarsPerPos(i[e][1])},this.addDraggableAndDataAndTip=(t,e,i,n)=>{t.tip(e),t.data(i,n),t.draggable({helper:"clone",distance:5,cursorAt:{top:16,left:16},scroll:!1,zIndex:20})},this.set$BtnWidgetSize=t=>{t.css({width:l,height:l})},this.manageBlinkAnimation=(t,e)=>{if(e!=Engine.widgetsData.type.BLINK_VIOLET)return;let i=.75*l;Engine.specificAnimationManager.createBlinkedAnimation(t,i,i,"#886199",1.5,"widget-blink")};this.widgetOnClick=t=>{let{widgetData:e,eventType:i="click"}=t;if(!Engine.tutorialManager.checkBlockWidgets(e.keyName))if(this.checkWidgetPermission(e)){e.clb(),(t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(s.ON_FINISH_REQUIRE.CLICK_WIDGET,s.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)})(e.keyName),this.widgetClick(e,i);let t={};t[a.LAST_WIDGET_CLICK]={name:e.keyName},Engine.serverStorage.sendData(t,(function(){}))}else message(_t("too_low_lvl"))},this.widgetClick=debounce((t,e)=>{e=mobileCheck()?"mobile-tap":e,Engine.interface.sendGA("widget",e,t.txt)},300),this.widgetDrop=(t,e)=>{Engine.interface.sendGA("widgetDrop",t,e)},this.checkWidgetPermission=t=>"berufs"===Engine.worldConfig.getWorldName()||!(isset(t)&&isset(t.requires)&&t.requires.minLvl>Engine.hero.d.lvl&&(isset(t.requires)&&!isset(t.requires.characters)||isset(t.requires)&&isset(t.requires.characters)&&t.requires.characters===Object.keys(Engine.changePlayer.getList()).length)),this.manageDisplayAdditionaWidgetBarsPerPos=function(t){let e=Engine.widgetsData,i=Engine.interface.getBottomPositioner();t==e.pos.BOTTOM_LEFT_ADDITIONAL&&(i.find(".bg-additional-widget-left").css("display","block"),i.find(".bottom-left-additional").css("display","block"),Engine.chatController.getChatWindow().setChatOverAdditionalBarPanel(!0),c.setWidthAdditionaPanel("left",!1),Engine.interface.get$interfaceLayer().find(".quick_messages").css("bottom","110px")),t==e.pos.BOTTOM_RIGHT_ADDITIONAL&&(i.find(".bg-additional-widget-right").css("display","block"),i.find(".bottom-right-additional").css("display","block"),c.setAdditionalBarClass(!0),Engine.interface.setStatsOverAdditionalBarPanel(),c.setWidthAdditionaPanel("right",!1))},this.setAdditionalBarClass=function(t){let e=Engine.interface.get$gameWindowPositioner();t?e.addClass("additional-bar-br"):e.removeClass("additional-bar-br")},this.showAdditionaWidgetBars=function(t){Engine.chatController.getChatWindow().setChatOverAdditionalBarPanel(!0),c.setAdditionalBarClass(!0),Engine.interface.setStatsOverAdditionalBarPanel(),c.setWidthAdditionaPanel("left",t),c.setWidthAdditionaPanel("right",t);let e=Engine.interface.getBottomPositioner();e.find(".bg-additional-widget-left, .bg-additional-widget-right").css("display","block"),e.find(".bottom-left-additional, .bottom-right-additional").css("display","block"),Engine.interface.get$interfaceLayer().find(".quick_messages").css("bottom","110px")},this.setWidthAdditionaPanel=function(t,e){let i=$(".bg-additional-widget-"+t),n=null;n=e?6:getMaxWidgetIndex($(".bottom.positioner").find(".bottom-"+t+"-additional")),i.width(l*(n+1)+120+"px")},this.hideAdditionalWidgetBars=function(){Engine.chatController.getChatWindow().setChatOverAdditionalBarPanel(!1),c.setAdditionalBarClass(!1),Engine.interface.setStatsOverAdditionalBarPanel();let t=Engine.interface.getBottomPositioner();t.find(".bg-additional-widget-left, .bg-additional-widget-right").css("display","none"),t.find(".bottom-left-additional, .bottom-right-additional").css("display","none"),Engine.interface.get$interfaceLayer().find(".quick_messages").css("bottom","60px")},this.setEnableDraggingButtonsWidget=function(t){var e=$(".bottom.positioner>.content").find(".widget-button"),i=$(".top.positioner>.content").find(".widget-button");t?e.draggable("enable"):e.draggable({disabled:!0}),t?i.draggable("enable"):i.draggable({disabled:!0})},this.tLang=function(t){return _t(t,null,"widgets-tip")},this.setEditableWidget=function(t){t?(c.setEnableDraggingButtonsWidget(!0),c.showEmptySlots(!0),c.showAdditionaWidgetBars(!0)):(c.setEnableDraggingButtonsWidget(!1),c.showEmptySlots(!1),Engine.interface.hideNotUseBars())},this.manageClassOfWidget=(t,e)=>{this.checkAttachWidgetList(t)&&(this.unsetWidgetClassWindowIsOpen(t),e&&this.setWidgetClassWindowIsOpen(t))},this.getWidgetLoaded=()=>o,this.addSeveralTypesToWidget=d}},function(t,e){t.exports=function(){var t={},e=this;this.check=function(){return t},this.removeOne=function(e){delete t[e]},this.addWraith=function(e,i){t[i]=e,t[i].rx=t[i].d.x,t[i].ry=t[i].d.y},this.addPetWraith=function(e,i){t[i]=e},this.update=function(i){for(var n in t)Engine.opt(8)?e.removeOne(n):(t[n].warShadowOpacity-=2*i,t[n].warShadowOpacity<0&&e.removeOne(n))},this.onClear=function(){t={}},this.getDrawableList=function(){var e=[];for(var i in t)e.push(t[i]);return e}}},function(t,e,i){let n=i(355);t.exports=function(){let t;const e=e=>{(e=>{delete t[e]})(e)},i=()=>{t={}};this.init=()=>{i()},this.createWraithObject=e=>{let i=new n,a=e.id;i.init(),((e,i)=>{t[i]=e})(i,a),i.updateData(e)},this.removeWraithObject=e,this.checkWraithObject=function(e){return!!t[e]},this.getDrawableList=()=>{let e=[];for(let i in t)e.push(t[i]);return e},this.onClear=i,this.update=i=>{let n=Engine.opt(8);for(var a in t)n?e(a):t[a].update(i)}}},function(t,e,i){let n=i(74),a=i(58);t.exports=function(){let t=null,e=null,i=null,s=null,r=null;this.alwaysDraw=!0;const o=t=>{r=t},l=e=>{t=e},c=t=>{e=t},d=t=>{s=t};this.init=()=>{d(!1),o(()=>!0)},this.updateData=e=>{l(e.id),c(e.originalObject),isset(e.updateOriginalObject)&&d(e.updateOriginalObject),isset(e.checkUpdateOriginalObject)&&o(e.checkUpdateOriginalObject),(e=>{let s={action:a.action.FADE_OUT,callback:()=>{Engine.wraithObjectManager.removeWraithObject(t)}};isset(e.startAlpha)&&(s.startAlpha=e.startAlpha),isset(e.speed)&&(s.speed=e.speed),i=new n,i.init(),i.updateData(s)})(e)},this.update=t=>{i.update(t),s&&r()&&e.update(t)},this.draw=t=>{t.save(),t.globalAlpha=i.getFadeValue(),e.draw(t),t.restore()},this.getOrder=()=>e.getOrder()}},function(t,e,i){var n=i(109),a=i(357);t.exports=function(){var t={};let e={};this.check=function(){return t},this.removeOne=function(t){deleteArrow(t)},this.addArrow=function(i,s,r,o,l,c){let d=i||o+"-"+r.d.id;if(!t[d]){if(t[d]=new n,t[d].id=d,r&&(t[d].parent=!0,t[d].objParent=r,t[d].typeParent=o),l&&(t[d].src="/img/"+l+"-arrow.png"),t[d].enabled=!0,t[d].tip=[""+s],c){let t=new a,i=c.src?c.src:null;t.init(),t.setEnabled(!0),t.updateData(getEngine().hero,r,[""+s],i),e[d]=t}t[d].afterUpdate()}},this.deleteAllOtherArrows=function(){for(let e in t)t[e].typeParent&&"Other"==t[e].typeParent&&this.deleteArrow(e)},this.deleteArrow=function(i){t[i]&&delete t[i],e[i]&&delete e[i]},this.checkExistById=function(e){return t[e]},this.checkExistInSpecificPosById=function(e,i,n){let a=t[e].getPos();return a[1]==i&&a[2]==n},this.checkTargetIsDefaultSrc=t=>e[t].isDefaultSrc(),this.update=function(i){for(var n in t)t[n].update(i),e[n]&&e[n].update(i)},this.onClear=function(){t={},e={}},this.getDrawableList=function(){var i=[];for(var n in t)i.push(t[n]);for(var a in e)i.push(e[a]);return i}}},function(t,e){t.exports=function(){let t,e,i,n,a,s,r,o,l;this.alwaysDraw=!0;const c=t=>{l=t},d=function(t,e){i=parseInt(t),n=parseInt(e)},h=function(t){r=t},u=function(t){s=t},p=function(e){t=e},g=t=>{o=t},f=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=e?16:48,n=50,a=130,s=Math.min(a,i*t),r=a-n,o=s-a+r;let l=o>=r?1:o<=0?0:o/r;return 1-l},m=(t,e,i,n)=>{let a=t-i,s=e-n;return Math.sqrt(Math.pow(a,2)+Math.pow(s,2))},v=()=>"/img/glow-blue.png"==l;this.init=function(){},this.getOrder=function(){return Math.max(n-.1,0)},this.update=()=>{let t;if(v()){let e=o.getRX(),a=o.getRY(),s=m(e,a,i,n);t=f(s)}else t=1;p(t)},this.updateData=(t,i,n,a)=>{g(t),d(i.x,i.y),u(n),c(a||"/img/glow-blue.png"),Engine.imgLoader.onload(l,!1,!1,t=>{e=t,h(!0)}),p(1)},this.setEnabled=function(t){a=t},this.isDefaultSrc=v,this.draw=function(s){if(!r)return;if(!a)return;let o=CFG.tileSize,l=CFG.halfTileSize,c=getEngine().map.offset,d=e.width,h=e.height,u=i*o+l-d/2-c[0],p=n*o+7-h+o-c[1];s.globalAlpha=t,u=Math.round(u),p=Math.round(p),s.drawImage(e,0,0,d,h,u,p,d,h),s.globalAlpha=1}}},function(t,e,i){var n=i(359),a=i(361);t.exports=function(){let t="HeroRespManager.js",e=null,i=null,s={};const r=t=>!!s[t],o=(t,e)=>s[t]=e,l=()=>new a,c=e=>s[e]?s[e]:(errorReport(t,"getById","HeroResp not exist!"),null);this.init=()=>{e={},i=new n},this.getById=c,this.updateData=t=>{i.updateData(t)},this.updateFullData=t=>{for(let e in t){let i,n=t[e];if(r(e))return;i=l(),i.init(n),o(e,i)}Engine.miniMapController.updateWindowMiniMapRespPos(t)},this.test=()=>s,this.onClear=()=>{s={}}}},function(t,e,i){const{heroRespKind:n}=i(360);t.exports=function(){let t;const e=(e,n)=>{let a=e.pos;for(let s=0;s<a.length;s++){let r=a[s];t.push(i(e,r,n))}},i=(t,e,i)=>{let n=a(t,e),s=n.z;return isset(i[s])?i[s]++:i[s]=0,n.id=i[s],n},a=(t,e)=>({nick:t.name,icon:t.icon,lvl:t.lvl,kind:n[t.kind],wt:t.wtype,resp:t.resp,z:0,x:e[0],y:e[1],id:null});this.init=()=>{},this.updateData=i=>{t=[];let n={};for(let t=0;t<i.length;t++){let a=i[t];e(a,n)}Engine.heroesRespManager.updateFullData(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.heroRespKind=void 0,e.heroRespKind={Normal:0,Event:1,Special:2}},function(t,e,i){let n=i(1);const{roundToNextStep:a,roundToPrevStep:s}=i(2);t.exports=function(){let t=this;this.d=null,this.id=null,this.rx=null,this.ry=null,this.fw=null,this.fh=null,this.canvasObjectType=n.HEROES_RESP;let e,i,r,o,l,c=!1,d=0;const h=function(){let n=CFG.r_npath+e.icon;Engine.imgLoader.onload(n,{speed:!1,externalSource:cdnUrl},(e,n)=>{((e,n)=>{t.fw=e.hdr.width/1,t.fh=e.hdr.height,i=t.fw/2,r=t.fh/2,o=e.frames,d=0,l=n})(n,e)},t=>{c=!0},()=>{})};this.init=t=>{e={nick:t.nick,icon:t.icon,lvl:t.lvl,kind:t.kind,wt:t.wt,resp:t.resp,z:t.z,x:t.x,y:t.y,id:t.id},this.d={id:t.id,x:t.x,y:t.y},this.id=t.id,this.rx=t.x,this.ry=t.y,e.icon&&h()},this.getOnloadProperImg=()=>c,this.getKind=()=>e.kind,this.getLvl=()=>e.lvl,this.getWt=()=>e.wt,this.getResp=()=>e.resp,this.getNick=()=>e.nick,this.getFrameAmount=()=>1,this.getIcon=()=>e.icon,this.getData=()=>({d:e}),this.getPreparedResp=()=>{const t=s(.5*e.resp/Engine.worldConfig.getNpcResp(),1),i=a(1.5*e.resp/Engine.worldConfig.getNpcResp(),1);return`${secToParsedTime(60*t,!1)} - ${secToParsedTime(60*i,!1)}`},this.getLvlRanges=()=>{const t=this.getLvl(),e=this.getKind(),i=Engine.worldConfig.getDropDestroyLvl();return 0===e?t>250?[t-50,"-"]:t>100?[t-50,t+i]:[t/2,t+i]:(1===e||2===e)&&[t/2,"-"]},this.getPreparedLvlRanges=()=>{const[t,e]=this.getLvlRanges();return`${Math.floor(t)} lvl - ${"-"===e?_t("no-limitations"):e+" lvl"}`},this.updateData=()=>{}}},function(t,e){t.exports=function(){let t=null;const e=e=>!!t[e],i=(e,i)=>{t[e]=i},n=e=>{delete t[e]};this.init=()=>{t={}},this.updateData=t=>{for(let a=0;a<t.length;a++){let s=t[a],r=s.id;e(r)&&n(r),i(r,s)}},this.checkNpcIcon=e,this.getNpcIcon=e=>t[e]?t[e].icon:null,this.onClear=()=>{t={}}}},function(t,e){t.exports=function(){let t=null;const e=e=>!!t[e],i=(e,i)=>{t[e]=i},n=t=>{isset(t.nick)||(t.nick=""),isset(t.type)||(t.type=0),isset(t.warrior_type)?(t.wt=t.warrior_type,delete t.warrior_type):t.wt=0,isset(t.actions)||(t.actions=0),isset(t.group)?(t.grp=t.group,delete t.group):t.grp=0,isset(t.level)?(t.lvl=t.level,delete t.level):t.lvl=0},a=e=>{delete t[e]};this.init=()=>{t={}},this.updateData=t=>{for(let s=0;s<t.length;s++){let r=t[s],o=r.id;e(o)&&a(o),n(r),i(o,r)}},this.checkNpcTpl=e,this.getNpcTpl=e=>t[e],this.getCloneNpcTpl=e=>copyStructure(t[e]),this.onClear=()=>{t={}}}},function(t,e,i){const n=i(59);let a=i(365),s=i(60),r=i(34),o=i(13);var l=i(75);let c=i(10),d=i(1);t.exports=function(){let t="NpcManager.js",e={},i={},h={},u={},p={},g=[_t("wt_titan",null,"npc"),_t("wt_hero",null,"npc"),_t("wt_elite3",null,"npc"),_t("eliteI",null,"npc"),_t("easy_enemy",null,"npc"),_t("great_enemy",null,"npc"),_t("big_enemy",null,"npc"),_t("normal_enemy",null,"npc"),_t("in_group",null,"npc"),_t("eliteII",null,"npc"),_t("wt_colossus",null,"npc")];const f=(e,i)=>{isset(e.d)?e.d.respBaseSeconds=i:errorReport(t,"setRespBaseSecondsInNpcData","attr d not exist in npc "+e)},m=t=>{let i=t.id,s=e[i],r=isset(e[i]);var o,c,d,h;if(E(t),_(t),v(t),T(i)&&y(i),r||(s=new a,e[i]=s,s.init(),b(t,s),Engine.soundManager.manageNpcNotifications(t),o=t,c=t.x,d=t.y,isset(p[d])||(p[d]={}),p[d][c]=o),s.updateDATA.call(s,$.extend(t,{id:i})),!r){let t=getEngine().isInitLoadTime();s.firstAfterUpdate(),t||(Engine.rajMapEvents.callAllActionsBySpecificEventAndNpc(l.ON_RESPAWN_NPC,{npcId:i}),Engine.rajCharacterImageChangerManager.callAllActionsBySpecificEventAndNpc(n.KIND.ON_RESPAWN,{npcId:i})),API.callEvent(Engine.apiData.NEW_NPC,s),getEngine().questTracking.checkAddNpcAndAdd(s)}(h=t)&&elementIsObject(h)&&h.external_properties&&((t,e)=>{u[t]=e})(i,t.external_properties)},v=t=>{t.canWalkOver&&(t.walkover=t.canWalkOver,delete t.canWalkOver),isset(t.group)&&(t.grp=t.group,delete t.group)},E=t=>{let e=t.tpl,i=Engine.npcTplManager.getCloneNpcTpl(e);if(null!=i)for(let e in i)"id"!=e&&(t[e]=i[e])},_=e=>{let i=e.icon.id,n=Engine.npcIconManager.getNpcIcon(i);null!=n?e.icon=n:e.icon.special?e.icon=e.icon.special:errorReport(t,"mergeNpcDataWithNpcIconData","nima",e)},b=function(t,e){t.grp&&(isset(h[t.grp])||(h[t.grp]=[]),h[t.grp].push(e))},w=function(t){return!!e[t]},C=(t,e)=>{i[t]=e},T=t=>!!i[t],y=t=>{delete i[t]},I=function(t){if(isset(e[t].grp)){for(var i=e[t].grp,n=h[i],a=0;a<n.length;a++)if(n[a].d.id==t){n.splice(a,1);break}0==n.length&&delete h[i]}},A=t=>CFG.debug?`<br><span class="debug-content">\n\t\t\tid: ${t.id},\n\t\t\ttpl: ${t.tpl}\n\t\t</span>`:"",k=t=>{let e=t.getId(),i=getEngine().rajEmoActions.checkOneNpcActionsList(e),n=M(t);t.getHasOnetimeQuest(),t.getHasDailyQuest();let a=S(e,i),s=O(e,i,n);if(""==a&&""==s)return"";return'<div class="emo-wrapper"><div class="line"></div>'+a+s+"</div>"},S=(t,e)=>{if(!e)return"";let i=getEngine().rajEmoActions,n=i.getRajEmoDefinitionsActionsFileNamesArrayToAddToTip(t),a=i.getClToAddToTip(t);if(!n.length&&!a.length)return"";let s="";for(let t in n){s+='<img src="'+(cdnUrl+CFG.r_epath+n[t])+'">'}for(let t in a){s+='<div class="'+("emo-npc-icon i-"+a[t])+'"></div>'}return s},O=(t,e,i)=>{if(!i.length)return"";let n="",a=getEngine().rajEmoActions;for(let s in i){let r="emo-npc-icon i-"+i[s],o=!1;o=!e||a.getShowNotify(t,i[s]),o&&(n+='<div class="'+r+'"></div>')}return n},M=(t,e)=>{if(!isset(t.checkActionsBitByName))return[];let i=[];for(let n in s.BITS){t.checkActionsBitByName(n,e)&&i.push(n)}return t.getHasOnetimeQuest()&&i.push(o.NAME.NORMAL_QUEST),t.getHasDailyQuest()&&i.push(o.NAME.DAILY_QUEST),i},N=t=>{const e=c.TYPE.NPC,i=t.getKind(),n=getEngine().miniMapController.handHeldMiniMapController.canUpdateDataDrawer(e,i),a=Engine.rajCharacterHide.checkHideObject(t);return n&&t.drawNickOrTip()&&!t.isGateNpc()&&!t.isMachine()&&!a},R=function(t){return e[t]},x=t=>{let e=R(t);return!!e&&(0==e.d.type||5==e.d.type||6==e.d.type)},L=t=>{let e=0,i=null;for(let n in t){let a=t[n],s=D(a.type),r=Engine.rajEmoDefinitions.getPriority(a.type);null==!s&&null==r||(s=null!=s?s:0,r=null!=r?r:0,s=Math.max(s,r),s>e&&(e=s,i=n))}return null==i?t[0]:t[i]},D=t=>s.PRIORITY_EMO_MAP[t]?s.PRIORITY_EMO_MAP[t]:null;this.clearDataToDraw=()=>{for(let t in e)e[t].clearDataToDraw()},this.findKindNpc=t=>{let e=null,i=t.d.type,n=t.d.wt;if(2==i||3==i){e=c.KIND.NORMAL_MONSTER;let t=getDescriptionOfKindMonster(n);t&&(e=t)}if(0==i||6==i){e=c.KIND.NPCS;let t=getDescriptionOfKindMonster(n);t&&(e=t)}if(5==i){e=c.KIND.NPCS;let t=getDescriptionOfKindMonster(n);t&&(e=t)}return 7==i&&(e=c.KIND.RECOVERY),e},this.checkNpcPos=(t,e)=>!!isset(p[e])&&!!p[e][t],this.checkDeleteNpc=T,this.getDeleteNpc=t=>i[t],this.check=()=>e,this.isGateUrl=t=>!!s.GATE_URL[t],this.getExternalProperties=t=>u[t]?u[t]:null,this.updateData_npcs_del=t=>{for(let e of t){let t=e.id;if(!w(t))continue;let i=R(t);isset(e.respBaseSeconds)&&f(i,e.respBaseSeconds),i.delete()}r.reload()},this.updateData=function(t){for(var e in t)m(t[e]);Engine.miniMapController.updateWindowMiniMapMonsterPos(t),r.reload()},this.draw=function(t){for(var i in e)e[i].draw(t)},this.update=function(t){for(var i in e)e[i].update(t)},this.getAllGroup=function(){return h},this.checkNpc=w,this.removeOne=function(i){var n,a;I(i),e[i],n=e[i].getX(),a=e[i].getY(),isset(p[a])?isset(p[a][n])?(delete p[a][n],lengthObject(p[a])||delete p[a]):errorReport(t,"",`npcPos[${a}][${n}}] not exist!`,p):errorReport(t,"",`npcPos[${a}}] not exist!`,p),Engine.wraithCharacterManager.addWraith(e[i],"n"+i),getEngine().questTracking.checkRemoveNpcAndRemove(e[i]),C(i,e[i]),delete e[i],Engine.canvasMultiGlow.removeMultiGlowTargetById(i)},this.groupShining=function(t,e){for(var i in h[t]){h[t][i].overMouse=e}},this.getTip=function(i){var n=Engine.hero,a=Engine.worldConfig.getRpg(),s=i.d,r="<div><strong>"+parseBasicBB(s.nick,!1)+"</strong></div>";if(CFG.debug||4!=s.type){s.wt>99?r+="<i>"+g[0]+"</i>":s.wt>89?r+="<i>"+g[10]+"</i>":s.wt>79?r+="<i>"+g[1]+"</i>":s.wt>29?r+="<i>"+g[2]+"</i>":s.wt>19?r+="<i>"+g[9]+"</i>":s.wt>9&&(r+="<i>"+g[3]+"</i>");var o="",l="",c="",d=null;let u;if(i.hasOwnProperty("elasticLevel")){e[s.id]?u=i.elasticLevel:(warningReport(t,"getTip",`Npc ${s.id} not exist in npc list`,e),u=s.lvl)}else u=s.lvl;if(2==s.type||3==s.type){var h=u-n.d.lvl;h<-Engine.worldConfig.getDropDestroyLvl()?(l='style="color:#888"',d=g[4]):h>10?(l='style="color:#f50"',d=g[5]):h>5?(l='style="color:#ff0"',d=g[6]):d=g[7]}if(a)o=d||"",c=s.grp?g[8]:"";else{let t=0==u?"":", ";o=u?u+" lvl":"",c=s.grp?t+"grp":""}r+="<span "+l+">"+o+c+"</span>"}if(!i.getId)return r;r+=k(i);return r+=A(s)},this.getTipDebugContent=A,this.getAllEmoNameOfNpc=M,this.onClear=function(){h={},e={},i={},p={},API.callEvent(Engine.apiData.CLEAR_MAP_NPCS)},this.getDrawableList=function(){var t=[];let i=getEngine().interfaceTimerManager;const n=d.NPC;for(var a in e){let s=e[a];t.push(s);let r=s.getFollowController(),o=N(s);r.checkFollowGlow()&&t.push(r.getFollowGlow()),isset(s.npcGlow)&&s.overMouse&&t.push(s.npcGlow),s.killTimer&&t.push(s.killTimer),o&&t.push(s.getDataDrawer()),i.check(n,a)&&t.push(i.getCharacterTimer(n,a))}return t},this.setNpcsAnimationState=function(t){for(var i in e)e[i].setStaticAnimation(t)},this.getById=R,this.getRenewableNpcByPosition=(t,i)=>{for(let n in e)if(7===e[n].d.type&&e[n].d.x===t&&e[n].d.y===i)return e[n];return!1},this.getByArrayId=t=>{let i=[];for(let n=0;n<t.length;n++)e[t[n]]&&i.push(e[t[n]]);return i},this.isTalkNpc=x,this.manageDisplayOfNpcEmo=t=>{if(!x(t))return;let e=(t=>{let e=[],i=Engine.emotions.getList();for(let n in i){let a=i[n];a.sourceId==t&&a.sourceType==o.OBJECT_TYPE.NPC&&e.push(a)}return e})(t);if(e.length)if(Engine.emotions.setDisplayOfEmoFromArray(e,!1),e.length>1){let t=L(e);Engine.emotions.setDisplayOfEmoFromArray([t],!0)}else Engine.emotions.setDisplayOfEmoFromArray(e,!0)}}},function(t,e,i){const n=i(59);var a=i(35),s=i(37),r=i(13);let o=i(1),l=i(60),c=i(117),d=i(11);var h=i(22),u=i(47),p=i(75);let g=i(72);var f=function(){var t=this;this.d={},this.inMove=!1,this.frame=0,this.frames=null,this.dlg=!1,this.killTimer=null,this.dir=d.S,this.canvasObjectType=o.NPC,this.collider=null,this.isPlayer=!1,this.overMouse=!1,this.initOrder=!1,this.order=0,this.onSelfMarginEmo=0,this.mapColSet=null,this.frameAmount=1,this.sequence=[],this.sequenceIndex=0,this.tutorialOrder=0,this.walkOver=!1,this.eliteHereWasCall=!1,this.onloadProperImg=!1,this.eliteHereWasCall=!1;let e,i=null,a={},f=null;var m=new Lock(["image","afterUpdate"],(function(){}));this.init=()=>{t.createPlaceHolderCharacter(),t.initOnSelfEmoList(),t.initDataDrawer(),v()};const v=()=>{i=new u,i.init(getEngine().hero,this)};this.getFollowController=function(){return i};const E=t=>{delete a[t]},_=()=>{for(let t in a)Engine.rajExtraLight.rajRemoveActionBeyondManager(t),E(t)};this.createKillTimer=t=>{this.killTimer=new c,this.killTimer.init(),this.killTimer.updateData(null,this.d.id,o.NPC,t)},this.getOnloadProperImg=()=>this.onloadProperImg,this.delete=function(){API.callEvent(Engine.apiData.REMOVE_NPC,t),Engine.hero.checkStasis()||Engine.rajMapEvents.callAllActionsBySpecificEventAndNpc(p.ON_DIE_NPC,{npcId:t.d.id}),Engine.hero.checkStasis()||Engine.rajCharacterImageChangerManager.callAllActionsBySpecificEventAndNpc(n.KIND.ON_DIE,{npcId:t.d.id}),t.deleteNpcCollision(),Engine.npcs.removeOne(t.d.id),Engine.rajEmoActions.deleteOneNpcActionsList(t.d.id),Engine.emotions.removeAllFromSourceId(t.d.id),Engine.characterEffectsMapManager.removeCharacterEffectFromDeleteCharacter(this.canvasObjectType,t.d.id),_()},this.deleteNpcCollision=()=>{null!==t.mapColSet&&Engine.map.col.unset(t.mapColSet[0],t.mapColSet[1],2)},this.addNpcCollision=()=>{Engine.map.col.set(t.mapColSet[0],t.mapColSet[1],2)},this.seMapColSet=t=>{this.mapColSet=[t.x,t.y]},this.addNpcCollisionOrDeleteOldCollisionAndAddNewCollision=t=>{this.mapColSet&&this.deleteNpcCollision(),this.seMapColSet(t),this.addNpcCollision()};var b=0;this.update=function(e){Engine.allInit&&(t.changeWarShadowOpacity(e),this.frames&&this.frames.length>1&&(b+=100*e,this.frames[this.activeFrame].delay<b&&(b-=this.frames[this.activeFrame].delay,this.frames.length==this.activeFrame+1?(this.activeFrame=0,this.manageSequenceAction()):this.activeFrame=this.activeFrame+1)),i.checkFollowGlow()&&i.getFollowGlow().update(),t.overMouse&&isset(this.npcGlow)&&this.npcGlow.update(),t.killTimer&&t.killTimer.update(e),t.getDataDrawer().update(e))},this.manageSequenceAction=function(){t.sequence.length&&(t.sequenceIndex++,t.sequenceIndex>t.sequence.length-1?(t.sequenceIndex=0,t.frame=0):t.frame=t.sequence[t.sequenceIndex])},this.beforeOnload=(e,i,n)=>{t.fw=e.hdr.width/t.frameAmount,t.fh=e.hdr.height,t.halffw=t.fw/2,t.halffh=t.fh/2,t.frames=e.frames,t.leftPosMod=n.type>3&&!(t.fw%64)?-16:0,t.activeFrame=0,t.sprite=i,t.manageUpdateCollider()},this.manageUpdateCollider=()=>{CFG.debug||4!=t.d.type?t.updateCollider():t.collider=null},this.afterOnload=()=>{this.onloadProperImg=!0,this.afterLoadImage(),this.manageEmo(),this.refreshEmotions()},this.afterLoadImage=()=>{m.unlock("image"),t.grp&&(t.npcGlow=new s,t.npcGlow.createObject(t,"#ccccff")),Engine&&Engine.dialogue&&Engine.dialogue.updateDialogAfterChangeNpc(t)},this.setActions=function(e){var i=new RegExp(/_s_(.*?)_e_/g).exec(e);if(!i)return;if(i.length>2)return console.warn("[Npc.js, setActions] Multiple declaration",e);let n=i[1],a=[];for(let e of n){let i=parseInt(e);if(!Number.isInteger(i))return t.frameAmount=1,void console.warn("[Npc.js, setActions] Argument is not integer");a.push(i)}t.frameAmount=5,t.sequence=a},this.updateIcon=function(e,i,n){t.setPlaceHolderIcon(),t.setStaticAnimation(Engine.opt(8)),4!=n.type&&t.updateCollider();let a=CFG.r_npath+e,s=n.wt>9;t.setActions(a);let r=getEngine().npcs.isGateUrl(e);T(r),Engine.imgLoader.onload(a,{speed:s,externalSource:cdnUrl},(t,e)=>{this.beforeOnload(e,t,n)},t=>{this.afterOnload()},()=>{t.fetchError()}),Engine&&Engine.dialogue&&Engine.dialogue.updateDialogAfterChangeNpc(t)},this.checkNpcHasCollision=t=>{let e=isset(t)?t:this.d.type;return!!(4!=e||7==e&&isEn())},this.onUpdate=new function(){this.type=function(e,i,n){t.checkNpcHasCollision(e)&&t.addNpcCollisionOrDeleteOldCollisionAndAddNewCollision(n)},this.grp=function(e){e&&(t.grp=e)},this.actions=function(t){this.createNpcEmoFromActions(t)},this.hasOnetimeQuest=function(){t.addEmoToQm(r.NAME.NORMAL_QUEST)},this.hasDailyQuest=function(){t.addEmoToQm(r.NAME.DAILY_QUEST)},this.killSeconds=function(t){console.log("killSeconds",t),this.killTimer||(this.killTimer=null),0!=t&&this.createKillTimer(t)},this.qm=function(e){1==e&&t.addEmoToQm(r.NAME.YELLOW_EXCLAMATION),2==e&&t.addEmoToQm(r.NAME.BLUE_EXCLAMATION)}},this.createNpcEmoFromActions=e=>{let i=Engine.npcs.getAllEmoNameOfNpc(this,e);for(let n in i){let a=i[n];l.BITS[a]&&(t.checkActionsBitByName(a,e)&&t.addEmoToQm(a))}},this.clearQm=()=>{this.qm=[]},this.addEmoToQm=t=>{this.qm.includes(t)||this.qm.push(t)},this.beforeUpdate=function(t){this.rx=t.x,this.ry=t.y,this.clearQm()},this.manageEliteHereEmo=()=>{let e=t.d.wt<90&&t.d.wt>79&&!t.eliteHereWasCall;(2==t.d.type||3==t.d.type)&&e&&(t.eliteHereWasCall=!0,Engine.emotions.updateData([{name:r.NAME.ELITE_HERE,source_id:t.d.id,source_type:r.OBJECT_TYPE.NPC}]))},this.manageActionsEmo=()=>{if(this.clearAllActionsEmo(),!t.qm.length)return;let e=t.d.id,i=getEngine().rajEmoActions;for(let n in this.qm){let a=t.qm[n];i.checkOneNpcActionsList(e)&&!i.getShowNotify(e,a)||Engine.emotions.updateData([{name:a,source_id:e,source_type:r.OBJECT_TYPE.NPC}])}},this.clearAllActionsEmo=()=>{const e=r.NAME,i=t.d.id,n=getEngine().emotions.removeEmotionBySourceIdAndEmoType;n(i,e.NORMAL_QUEST),n(i,e.DAILY_QUEST),n(i,e.YELLOW_EXCLAMATION),n(i,e.BLUE_EXCLAMATION),n(i,e.AUCTION),n(i,e.MAIL),n(i,e.SHOP),n(i,e.HEAL),n(i,e.DEPO_CLAN),n(i,e.DEPO),n(i,e.INKEEPER)},this.manageEmo=function(){t.imgLoaded&&(t.manageEliteHereEmo(),t.manageAggressiveEmo(),t.manageActionsEmo(),this.d.external_properties&&Engine.rajController.parseObject(this.d.external_properties,[h.INTERFACE_SKIN,h.WEATHER,h.NIGHT,h.SCREEN_EFFECTS,h.MAP_FILTER,h.EARTHQUAKE,h.CHARACTER_EFFECT,h.FAKE_NPC,h.TUTORIAL,h.BATTLE_EVENTS,h.MAP_EVENTS,h.CHARACTER_IMAGE_CHANGER,h.WINDOW_EVENTS,h.MAP_EXTERNAL_PROPERTIES_REFRESH,h.PROGRAMMER,h.EXTRA_LIGHT,h.DYNAMIC_LIGHT,h.BEHAVIOR_DYNAMIC_LIGHT,h.TEMPLATE,h.FLOAT_FOREGROUND,h.FLOAT_OBJECT,h.CAMERA,h.CHARACTER_HIDE,h.DIALOGUE,h.CALL_INSTANT_BEHAVIOR_FAKE_NPC,h.YELLOW_MESSAGE,h.SEQUENCE,h.RANDOM_CALLER,h.SOUND,h.AREA_TRIGGER,h.CONNECT_SRAJ,h.MAP_MUSIC,h.ZOOM,h.TRACKING],{npcId:t.d.id}))},this.manageAggressiveEmo=function(){let e=r.NAME.AGGRESSIVE;const i=isset(this.d.elasticLevelFactor)?this.elasticLevel:this.d.lvl,n=3===t.d.type&&i>=Engine.hero.d.lvl-1;Engine.emotions.removeEmotionBySourceIdAndEmoType(t.d.id,e),n&&Engine.emotions.updateData([{name:e,source_id:t.d.id,source_type:r.OBJECT_TYPE.NPC}])};this.afterUpdate=function(e,i){if(e.icon&&t.updateIcon(e.icon,i.icon,e),isset(this.d.del))return this.delete();isset(this.d.elasticLevelFactor)&&(this.elasticLevel=this.getElasticMobLevel()),isset(this.d.external_properties)&&(Engine.characterEffectsMapManager.removeCharacterEffectFromDeleteCharacter(this.canvasObjectType,t.d.id),_(),Engine.rajController.parseObject(this.d.external_properties,[h.BATTLE_EVENTS,h.EMO_ACTIONS],{npcId:t.d.id})),w()&&this.createTipFromNpcData(),this.manageWalkOver(e),t.manageEmo(),m.unlock("afterUpdate")};const w=()=>CFG.debug||this.d.lvl||4!=this.d.type;this.createTipFromNpcData=()=>{this.tip=[getEngine().npcs.getTip(this),"t_npc"]},this.manageWalkOver=e=>{if(delete this.d.walkover,e.walkover)this.d.walkover=1,this.walkOver=!0,this.deleteNpcCollision();else{this.walkOver=!1;let i=e.type;t.checkNpcHasCollision(i)&&this.addNpcCollisionOrDeleteOldCollisionAndAddNewCollision(e)}},this.refreshTip=()=>{this.d.hasOwnProperty("elasticLevelFactor")&&w()&&this.createTipFromNpcData()},this.debugRefreshTip=()=>{this.createTipFromNpcData()},this.getElasticMobLevelAfterSubElasticLevelFactor=()=>{let t=parseInt(this.d.elasticLevelFactor);if(!Engine.party)return parseInt(Engine.hero.d.lvl)+t;let e=Engine.party.getMemberFromHeroMapWithTheBigestLevel();return e?parseInt(e.d.lvl)+t:parseInt(Engine.hero.d.lvl)+t},this.getElasticMobLevel=()=>{let t=this.getElasticMobLevelAfterSubElasticLevelFactor();return Math.min(t,300)},this.getOrder=function(){if(!t.initOrder){if(this.order=.2,(4==this.d.type||7==this.d.type)&&(this.order+=parseInt(this.d.wt),this.order<0))return.01;this.initOrder=!0}return this.ry+this.order+this.tutorialOrder},this.increaseTutorialOrder=()=>{this.tutorialOrder=301},this.clearTutorialOrder=()=>{this.tutorialOrder=0},this.onhover=function(e,i){t.overMouse=i,t.setCursor(i);var n=t.grp;t.grp&&Engine.npcs.groupShining(n,i)},this.setCursor=function(e){const i=Engine.interface.get$GAME_CANVAS(),n=this.d.type,a=g.CURSOR;if(e){if(getEngine().npcs.isGateUrl(t.d.icon))return void i.addClass(a.DO_ACTION);7==n&&i.addClass(a.PICK_UP),0!=n&&5!=n&&6!=n||i.addClass(a.DIALOGUE),2!=n&&3!=n||i.addClass(a.ATTACK)}else i.removeClass(`${a.DO_ACTION} ${a.PICK_UP} ${a.DIALOGUE} ${a.ATTACK}`)},this.elliteIIWithSmallLevel=function(){var e=this.isEliteIIMob(t);if(e){if(t.mobHaveLevelOverweight(e,50))return e}else{if(!t.hasOwnProperty("grp"))return!1;for(var i=Engine.npcs.getAllGroup()[t.grp],n=0;n<i.length;n++)if((e=this.isEliteIIMob(i[n]))&&t.mobHaveLevelOverweight(e,50))return e}},this.isEliteIIMob=function(t){return t.d.wt<30&&t.d.wt>19?t:null},this.mobHaveLevelOverweight=function(t,e){return Engine.hero.d.lvl-t.d.lvl>e},this.isTalkNpc=()=>{let t=this.d.type;return 0==t||5==t||6==t},this.oncontextmenu=e=>{e.stopPropagation();t.npcAndPlayerOnTile();let i=this.d.type,n=!1;if(0!=i&&5!=i&&6!=i&&7!=i){if(2==i||3==i){return n=!0,C(e),t.getFar()?(Engine.opt(7)||Engine.hero.autoGoTo({x:t.d.x,y:t.d.y},!1),!1):(Engine.hero.heroAtackRequest(t.d.id,!0),!1)}n||C(e)}else{let a=[],s="talk";if(7===i&&(s="take"),getEngine().npcs.isGateUrl(t.d.icon)&&(s="go"),a.push([_t(s,null,"menu"),function(){Engine.hero.getAutoGw()||Engine.hero.addAfterFollowAction(t,(function(){Engine.hero.sendRequestToTalk(t.d.id)}))}]),n=!0,t.addDebugOptionMenu(a),!Engine.dialogue){if(!e)return;Engine.interface.showPopupMenu(a,e,!0)}}};const C=t=>{if(!CFG.debug)return;let e=[];this.addDebugOptionMenu(e),Engine.interface.showPopupMenu(e,t,!0)};this.getFar=()=>Math.abs(Engine.hero.d.x-this.d.x)>1||Math.abs(Engine.hero.d.y-this.d.y)>1,this.npcAndPlayerOnTile=()=>{if(Engine.hero.d.x==this.d.x&&Engine.hero.d.y==this.d.y)return!0;let t=Engine.others.check(),e=this.d.x,i=this.d.y;for(let n in t){let a=t[n];if(a.d.x==e&&a.d.y==i)return!0}return!1},this.onclick=function(e){e.stopPropagation();var n=!0,a=t.getFar();let s=getEngine().hero;if(i.addFollowGlow(),a)return Engine.opt(7)||s.autoGoTo({x:t.d.x,y:t.d.y},!1),!1;if(n=!1,t.d.walkover&&!s.samePosWithHero(t.d.x,t.d.y))return Engine.opt(7)||s.autoGoTo({x:t.d.x,y:t.d.y},!1),!1;var r=this.d.type;return 4==r?n:0!=r&&6!=r&&7!=r||Engine.hero.getAutoGw()?2==r||3==r?(Engine.hero.heroAtackRequest(t.d.id,!1),n):5==r?(Engine.hero.sendRequestToTalk(t.d.id),n):n:(Engine.hero.sendRequestToTalk(t.d.id),n)},this.checkActionsBitByName=(t,e)=>{let i=l.BITS[t],n=!1,a=isset(e)?e:this.d.actions;return i==l.BITS.DEPO?(a>>l.BITS.DEPO&1&&(n=!0),a>>l.BITS.DEPO_CLAN&1&&(n=!0)):a>>i&1&&(n=!0),n},this.getExternalProperties=()=>this.d.external_properties,this.getNick=()=>this.d.nick,this.getX=()=>this.d.x,this.getY=()=>this.d.y,this.getDir=()=>this.dir,this.getImg=()=>this.d.icon,this.getData=()=>this.d,this.getOldImg=()=>null,this.getId=()=>this.d.id,this.getProf=()=>this.d.prof;const T=t=>{e=t},y=t=>{f=t};this.hasOnetimeQuest=function(){t.addEmoToQm(r.NAME.NORMAL_QUEST)},this.hasDailyQuest=function(){t.addEmoToQm(r.NAME.DAILY_QUEST)};this.addExtraLightId=t=>{a[t]=!0},this.getFreeIdOfExtraLights=()=>getFreeIdOfObject(a),this.drawNickOrTip=w,this.isGateNpc=()=>e,this.isMachine=()=>5==this.d.type,this.getLevel=()=>this.d.lvl,this.getGroup=()=>t.grp,this.isGroup=()=>isset(t.grp),this.getKind=()=>f,this.getTpl=()=>this.d.tpl,this.firstAfterUpdate=()=>{y(getEngine().npcs.findKindNpc(this))},this.getCanvasObjectType=()=>this.canvasObjectType,this.getWt=()=>this.d.wt,this.getType=()=>this.d.type,this.checkKillTimer=()=>!!this.killTimer,this.getElasticLevel=()=>this.elasticLevel,this.resetActiveFrame=()=>{this.activeFrame=0},this.getHasOnetimeQuest=()=>!!this.d.hasOnetimeQuest,this.getHasDailyQuest=()=>!!this.d.hasDailyQuest,this.getSprite=()=>this.sprite};(f.prototype=Object.create(a.prototype)).constructor=f,t.exports=f},function(t,e,i){var n=i(367),a=i(118),s=i(22);let r=i(21),o=i(3),l=i(4);i(6);t.exports=function(){let t="FakeNpcManager.js",e={},i=null;const c=()=>{i=new l;const e=a.behavior,n=o.TYPE;i.init(t,{createFunc:h,removeFunc:u,checkExistFunc:E,updateFunc:p,createRequire:{x:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},img:!0,behavior:{type:n.OBJECT,elementInObject:{list:{type:n.ARRAY,elementInArray:{name:{conditionVal:{[e.IDLE]:{duration:{type:n.FLOAT,optional:!0},dir:{specificVal:["E","S","W","N"],optional:!0}},[e.WALK_START]:{},[e.WALK]:{x:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[e.TP]:{x:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[e.TP_START]:{},[e.WALK_AND_TP_START]:{x:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:n.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}}}}}}}}}},o.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},d=(t,e)=>{i.updateData(t,e)},h=(t,e)=>{g(t,e)},u=(t,e)=>{f(t.id,e)},p=(t,e)=>{let i=_(t.id);t.callInstantBehavior&&(i.setBreakBehavior(!0),i.setNewBehaviourData(t.callInstantBehavior))},g=(t,e)=>{let i=new n,a=t.id;m(a,i),i.init(),i.updateDATA(t,$.extend(t,{id:a}),e)},f=t=>{if(!E(t))return;e[t].getInstantFadeOut()||Engine.wraithCharacterManager.addWraith(e[t],s.FAKE_NPC+t),v(t)},m=(t,i)=>{e[t]=i},v=(t,i)=>{E(t)&&delete e[t]},E=t=>!!e[t],_=t=>e[t];this.init=()=>{c()},this.update=t=>{if(!Engine.hero.checkStasis())for(var i in e)e[i].update(t)},this.draw=t=>{if(!Engine.hero.checkStasis())for(var i in e)e[i].draw(t)},this.getDrawableList=()=>{var t=[];for(var i in e)t.push(e[i]);return t},this.serveRayControllerData=()=>{},this.removeFakeNpc=f,this.setFakeNpcAnimationState=()=>{},this.onClear=()=>{e={}},this.getById=_,this.updateData=(t,e)=>{if(i.checkCorrectMainData(t,e))for(let i in t.list){let n=t.list[i];r.manageRandomElementInBehaviorIfExist(n.behavior),d(n,e)}},this.updateBehavior=t=>{let e=t.list;for(let t in e){let i=e[t],n=i.id,a=_(n);a.setBreakBehavior(!0),a.setNewBehaviourData(i)}},this.checkFakeNpcListExist=E}},function(t,e,i){var n=i(35);let a=i(11),s=i(118);var r=i(34);let o=i(1),l=i(6),c=i(119),d=i(76),h=function(){let t=this;this.d={},this.id=null,this.rx=null,this.ry=null,this.dir=a.S,this.canvasObjectType=o.FAKE_NPC;let e=null;this.fake=!0,this.destinyX=!1,this.destinyY=!1,this.destinyNextTile=null,this.external_properties=null,this.autoPath=r.getEmptyRoad(),this.clickData=null,this.fw=null,this.fh=null,this.halfFw=null,this.halfFh=null,this.frame=0,this.frames=null,this.activeFrame=null,this.sprite=null;let i=0,n=null,h=!1,u=!1,p=!1,g=[],f=null;const m=()=>{e=new d,e.init(this,()=>{q()},()=>{B()}),e.setDefaultRepeat(s.defaultData.BEHAVIOR_REPEAT),e.setOneBehaviorRepeat(s.defaultData.BEHAVIOR_REPEAT)},v=(t,e)=>{for(let i=0;i<g.length;i++)if(g[i].x==t&&g[i].y==e)return;g.push({x:t,y:e})},E=t=>{n=t},_=t=>{this.decreaseWarShadowOpacity(t),this.isHide()&&(this.rx=this.tpX,this.ry=this.tpY,this.d.x=this.tpX,this.d.y=this.tpY,e.callBehavior())},b=t=>{e.decreaseDuration(t),(e.getBreakBehavior()||e.getDuration()<0)&&e.callBehavior()},w=t=>{if(x())return h=!1,void e.callBehavior();if(!h){if(!R())return C(Math.floor(this.rx),Math.floor(this.ry)),W(),void(h=!1);y()}let i=k(t,this.dir,this.d.x,this.d.y,this.rx,this.ry,this.destinyNextTile.x,this.destinyNextTile.y);return i.recallRoad&&i.reach?(C(Math.floor(this.rx),Math.floor(this.ry)),W(),void(h=!1)):e.getBreakBehavior()&&i.reach?(T(i.lastReachX,i.lastReachY),h=!1,void e.callBehavior()):(this.rx=i.rx,this.ry=i.ry,this.d.x=i.lastReachX,this.d.y=i.lastReachY,this.dir=i.dir,this.destinyNextTile.x=i.destinyNextTileX,this.destinyNextTile.y=i.destinyNextTileY,void I())},C=(t,e)=>{let i=H(t,e);T(i.x,i.y)},T=(t,e)=>{this.rx=t,this.ry=e,this.d.x=t,this.d.y=e},y=()=>{G(Math.floor(this.rx),Math.floor(this.ry))&&console.log("OMG3"),h=!0,this.destinyNextTile=N(),this.dir=S(this.d.x,this.d.y,this.destinyNextTile.x,this.destinyNextTile.y)},I=()=>{this.frame=this.d.x==this.rx&&this.d.y==this.ry?0:Math.floor(2*(this.rx+this.ry))%4},A=()=>e.getActualBehavior(),k=(t,e,i,a,s,r,o,l)=>{let c=M(e,i,a,s,r,n*t),d=O(e,i,a,c),h=!1,u=null;if(d){let t=d.rest,n=d.tileX,p=d.tileY;if(h=!0,i=n,a=p,$()&&(u=!0),!u&&R()){let d=N();o=d.x,l=d.y,e=S(n,p,o,l,e),c=M(e,i,a,s,r,t);let h=Math.floor(c.x),g=Math.floor(c.y);G(n,p,!0)&&(u=!0),G(h,g,!0)&&(u=!0)}else{let t=Math.floor(c.x),e=Math.floor(c.y);c={x:i,y:a},G(o,l,!0)&&(u=!0),G(t,e,!0)&&(u=!0)}}return{rx:c.x,ry:c.y,lastReachX:i,lastReachY:a,dir:e,destinyNextTileX:o,destinyNextTileY:l,reach:h,recallRoad:u}},S=(t,e,i,n,s)=>t!=i?t<i?a.E:a.W:e!=n?e>n?a.N:a.S:(errorReport("FakeNpc.js","getNewDir","BUG! New dir not find!"),s),O=(t,e,i,n)=>{let s,r;switch(t){case a.N:return r=i-1,n.y<r&&{rest:Math.abs(r-n.y),tileX:e,tileY:r};case a.S:return r=i+1,n.y>r&&{rest:Math.abs(r-n.y),tileX:e,tileY:r};case a.W:return s=e-1,n.x<s&&{rest:Math.abs(s-n.x),tileX:s,tileY:i};case a.E:return s=e+1,n.x>s&&{rest:Math.abs(s-n.x),tileX:s,tileY:i}}},M=(t,e,i,n,s,r)=>{switch(t){case a.N:return{x:e,y:s-r};case a.S:return{x:e,y:s+r};case a.W:return{x:n-r,y:i};case a.E:return{x:n+r,y:i}}return errorReport("FakeNpc.js","getNextPosFromDir","incorrect dir",t),{x:n,y:s}},N=()=>{let t;return t=p?f.pop():this.autoPath.pop(),t},R=()=>{let t;return t=p?f.length:this.autoPath.count(),t>0},x=()=>this.rx==this.destinyX&&this.ry==this.destinyY,L=()=>{this.autoPath.clear(),p&&(f=null)},D=t=>{if(this.autoPath=r.find(this,t),!p)return;let e=this.autoPath.road;f=[];for(let t=0;t<e.length;t++){let i=e[t].x,n=e[t].y;f.push({x:i,y:n})}},P=(e,i)=>{t.fw=e.hdr.width/4,t.fh=e.hdr.height/4,t.halfFw=this.fw/2,t.halfFh=this.fh/2,t.frames=e.frames,t.activeFrame=0,t.sprite=i,t.updateCollider()},B=()=>{this.getObjectDynamicLightManager().removeAllDynamicLights(),this.getObjectDynamicLightManager().removeAllDynamicDirCharacterLights(),Engine.fakeNpcs.removeFakeNpc(this.id)},F=(t,e,i,n)=>{g=[],p&&(v(this.startX,this.startY),v(t,e),v(i,n))},W=()=>{let t=(()=>{let t=A();return t?{x:t.x,y:t.y}:null})(),e=(()=>{let t=A();return t&&t.speed?t.speed:null})(),i=Q({x:t.x,y:t.y});F(this.rx,this.ry,i.rx,i.ry);let n=H(i.rx,i.ry);n?(this.destinyX=n.x,this.destinyY=n.y,null!=e&&E(e),(t=>{if(L(),isNaN(t.x)||isNaN(t.y))return;let e=[];for(let t=0;t<g.length;t++){let i=g[t];2==Engine.map.col.check(i.x,i.y)&&e.push({x:i.x,y:i.y})}for(let t=0;t<e.length;t++){let i=e[t];Engine.map.col.unset(i.x,i.y,2)}e.length&&r.reload(),D(t);for(let t=0;t<e.length;t++){let i=e[t];Engine.map.col.set(i.x,i.y,2)}e.length&&r.reload()})({x:this.destinyX,y:this.destinyY})):console.log("can crash?",n)},$=()=>G(this.destinyX,this.destinyY,!0),H=(t,e)=>{if(!G(t,e,!0))return{x:t,y:e};let i=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];for(let n in i){let a=i[n],s=t+a[0],r=e+a[1];if(!G(s,r,!0))return{x:s,y:r}}return errorReport("FakeNpc.js","lookForFreeTile","Can not find free tile for FakeNpc id: "+this.id),null},G=(t,e,i)=>{let n=Engine.map.col.check(t,e);if(n){if(V(t,e,n))return!1}return n&&!i&&errorReport("FakeNpc.js","startWalkBehavior","incorrect pos: "+this.destinyX+", "+this.destinyY+" is collision! FakeNpc id: "+this.id),!!n},V=(t,e,i)=>{if(2!=i)return!1;for(let i=0;i<g.length;i++){let n=g[i];if(n.x==t&&n.y==e)return!0}return!1},U=()=>{let t=e.getActualBehaviorDurationData(),i=(()=>{let t=A();return t&&t.dir?l.getCharacterData(t.dir):null})();null!=t&&e.setDuration(t),null!=i&&(this.dir=i)},j=()=>{let t=(()=>{let t=A();return t?{x:t.x,y:t.y}:null})();this.tpX=t.x,this.tpY=t.y},q=()=>{this.destinyX=null,this.destinyY=null,this.tpX=null,this.tpY=null,e.setDuration(s.defaultData.BEHAVIOR_DURATION)},K=()=>{},Y=new function(){this.id=function(t){et(t)},this.behavior=function(t){e.setBehaviorData(t),e.setBehaviorList(z(copyStructure(t.list))),e.setBehaviorRepeat(isset(t.repeat)?t.repeat:s.defaultData.BEHAVIOR_REPEAT)},this.click=function(t){this.clickData=t},this.img=function(t,e){X(t)},this.dir=function(t,e){this.dir=t},this.external_properties=function(t,e){this.external_properties=t},this.speed=function(t){E(t)},this.instantCreateFadeIn=e=>{1==e&&(t.warShadowOpacity=1)},this.instantRemoveFadeOut=t=>{u=t}},z=t=>{let e=[];for(let i in t){let n=t[i];switch(n.name){case s.behavior.WALK_START:n.name=s.behavior.WALK,n.x=this.startX,n.y=this.startY,e.push(n);break;case s.behavior.TP_START:n.name=s.behavior.TP,n.x=this.startX,n.y=this.startY,e.push(n);break;case s.behavior.WALK_AND_TP_START:n.name=s.behavior.WALK,e.push(n),e.push({name:s.behavior.TP,x:this.startX,y:this.startY});break;default:e.push(t[i])}}return e},X=e=>{let i=l.getCharacterData(e);if(null==i)return;let n=CFG.r_opath+fixSrc(i);t.setPlaceHolderIcon(),t.setStaticAnimation(Engine.opt(8),Engine.hero.d.opt),Engine.imgLoader.onload(n,{speed:!0,externalSource:cdnUrl},(t,e)=>{P(e,t)},t=>{},()=>{t.fetchError()})},Q=(t,e)=>({rx:l.getCharacterData(t.x,e),ry:l.getCharacterData(t.y,e)}),J=t=>{this.frames&&this.frames.length>1&&t&&(i+=100*t,this.frames[this.activeFrame].delay<i&&(i-=this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},Z=t=>{Engine.rajController.parseObject(t,!1,{fakeNpcId:this.id})},tt=(t,e)=>{getEngine().interface.setDialogueCursor(e)},et=t=>{this.id=t};this.init=()=>{t.createPlaceHolderCharacter(),m(),E(4.9),this.initDynamicLightCharacterManager()},this.onclick=t=>{if(this.clickData)if(isset(this.clickData.range)){let t=this.clickData.range,e=Engine.hero;Math.abs(this.rx-e.rx)<=t&&Math.abs(this.ry-e.ry)<=t&&Z(this.clickData.external_properties)}else Z(this.clickData.external_properties);return!0},this.update=i=>{if(!t.sprite)return;if(!Engine.allInit)return;switch(J(i),e.getActualBehaviorName()){case s.behavior.WALK:this.changeWarShadowOpacity(i),w(i);break;case s.behavior.IDLE:this.changeWarShadowOpacity(i),b(i);break;case s.behavior.TP:_(i)}t.updateCollider()},this.onUpdate=Y,this.beforeUpdate=(t,e,i,n)=>{t.behavior.randomFirstIndex&&c.updateRandomFirstIndex(t.behavior);let a=Q(t,n);null!=a.rx&&(null!=a.ry&&(this.rx=a.rx,this.ry=a.ry,this.startX=this.rx,this.startY=this.ry,t.ignoreUpdateCollisionAndStartEndPos&&(p=!0,v(this.startX,this.startY)),G(this.startX,this.startY)&&console.log("can crash?")))},this.afterUpdate=()=>{this.d.x=this.rx,this.d.y=this.ry,e.callBehavior(),this.external_properties&&Z(this.external_properties),this.clickData&&(this.onhover=tt)},this.getOrder=()=>this.ry+.1,this.getInstantFadeOut=()=>u,this.afterLoadImage=K,this.getId=()=>this.id,this.getNDir=()=>this.dir,this.setBreakBehavior=t=>{e.setBreakBehavior(t)},this.setNewBehaviourData=t=>{e.setNewBehaviorData(t)},this.startBehavior=t=>{switch(t){case s.behavior.WALK:W();break;case s.behavior.IDLE:U();break;case s.behavior.TP:j();break;default:errorReport("FakeNpc.js","startBehavior","Incorrect name!",t)}},this.serverRayControllerData=Z,this.prepareBehaviorList=z};(h.prototype=Object.create(n.prototype)).constructor=h,t.exports=h},function(t,e,i){var n=i(96);i(120);const a=i(36),s=i(17),r=i(10);t.exports=function(){var t={};const e="OthersManager.js";this.updateData=function(e){let i=!1;for(var a in e){var s=isset(t[a]),r=isset(e[a].del);s&&!r||(i=!0),s||(t[a]=new n,t[a].init()),t[a].updateDATA($.extend(e[a],{id:a})),s||(t[a].firstAfterUpdate(),API.callEvent(Engine.apiData.NEW_OTHER,t[a]),Engine.soundManager.manageOtherNotifications(e[a])),s&&!r&&API.callEvent(Engine.apiData.UPDATE_OTHER,t[a]),Engine.whoIsHere.addToList(a,e[a],t[a])}i&&(Engine.whoIsHere.updatePlayersNumber(),Engine.whoIsHere.updateScroll()),Engine.miniMapController.updateWindowMiniMapOthersPos(e)},this.update=function(e){for(var i in t)t[i].update(e)},this.setOthersAnimationState=function(e){for(var i in t)t[i].setStaticAnimation(e),isset(t[i].pet)&&t[i].pet.setStaticAnimation(e)},this.draw=function(e){for(var i in npc)t[i].draw(e)},this.check=function(){return t},this.removeOne=function(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Engine.whoIsHere.removeFromList(e),Engine.emotions.removeAllFromSourceId(e),i&&Engine.wraithCharacterManager.addPetWraith(t[e],"o"+e),t[e].pet&&i&&Engine.wraithCharacterManager.addPetWraith(t[e].pet,"p"+e),delete t[e]},this.onClear=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var i in t)t[i].delete(e);t={}},this.getDrawableList=function(){var e=[];for(var i in t){e.push(t[i]),isset(t[i].pet)&&e.push(t[i].pet),isset(t[i].wantedGlow)&&e.push(t[i].wantedGlow),isset(t[i].colorMark)&&e.push(t[i].colorMark),isset(t[i].whoIsHereGlow)&&e.push(t[i].whoIsHereGlow);let n=t[i].getFollowController();n.checkFollowGlow()&&e.push(n.getFollowGlow()),o(t[i])&&e.push(t[i].getDataDrawer())}return e};const o=t=>{const e=r.TYPE.OTHER,i=t.getKind();return getEngine().miniMapController.handHeldMiniMapController.canUpdateDataDrawer(e,i)};this.getRoleplayRank=function(t){var e=["Ciułacz","Łowca Wilków","Tropiciel Zulusów","Poganiacz Goblinów","Piętno Orków","Miłośnik Harpii","Rezun Olbrzymów","Hycel Gnolli","Koszmar Tolloków","Magazynier Pełną Gębą","Zguba Minotaurów","Niszczyciel Szkieletów","Treser Centaurów","Nieustraszony Pogromca Korsarzy","Tańczący z Mumiami","Szabrownik Wraków","Gobliński Kat","Postrach Berserkerów","Władca Kazamatów","Młot na Czarownice","Dręczyciel Praorków","Zguba Czarnej Gwardii","Poskramiacz Furboli","Egzekutor Myświórów","Wielki Inkwizytor","Zaklinacz Arachnidów","Kat Demonisa","Oprawca Maddoków","Potomek Najwyższych","Piekielny Jeźdźca"];return t?"<center>"+e[Math.min(e.length-1,t-1>>3)]+"</center>":""},this.getById=function(e){return t[e]},this.crushTestStart=function(t){var e=ts();console.log("crushTestStart");for(var i=Engine.map.size.x,n=Engine.map.size.y,a={},s=0;s<t;s++){var r=Math.floor(i*Math.random()),o=Math.floor(n*Math.random()),l=this.oneObjTest(r,o,s);a[s]=l}this.updateData(a),console.log("crushTestStop Update time is : "+(ts()-e)/1e3)},this.oneObjTest=function(t,e){return{nick:"Yakuz"+t+e,icon:"/noob/pm.gif",clan:{id:123,name:"No tak było nie zmyślam"},x:t,y:e,dir:3,rights:2,lvl:0,prof:"p",attr:0,relation:""}},this.createOtherContextMenu=(t,n,r)=>{const o=[];let l=isset(n.charId),c=isset(n.accountId),d=isset(n.lvl),h=isset(n.nick),u=isset(n.prof);r||(r=[]);const p=a.SEND_CHAT_MESSAGE,g=a.SHOW_EQ,f=a.INVITE_TO_FRIEND,m=a.INVITE_TO_ENEMIES,v=a.INVITE_TO_PARTY,E=a.SHOW_PROFILE;let _={[p]:!0,[g]:!0,[f]:!0,[m]:!0,[v]:!0,[E]:!0};for(let t=0;t<r.length;t++){let i=r[t];_[i]?delete _[i]:errorReport(e,"createOtherContextMenu","key not exist",i)}const b=_[p]&&h&&n.relation!=s.RELATION.ENEMY,w=_[g]&&l&&c&&d&&h&&u,C=_[f]&&h,T=_[m]&&h,y=_[v]&&h,I=_[E]&&l&&c;if(b&&o.push([_t("send_message",null,"chat"),function(){Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(n.nick)}]),w&&o.push([_t("show_eq"),()=>{Engine.showEqManager.update({id:n.charId,account:n.accountId,lvl:n.lvl,nick:n.nick,prof:n.prof,icon:"",world:Engine.worldConfig.getWorldName()})}]),C&&o.push([_t("invite_to_friend"),()=>_g("friends&a=finvite&nick="+n.nick.trim().split(" ").join("_"))]),T&&o.push([_t("add_to_enemies"),()=>_g("friends&a=eadd&nick="+n.nick.trim().split(" ").join("_"))]),y&&o.push([_t("team_invite",null,"menu"),()=>_g("party&a=inv&id="+n.charId)]),I){const{showProfile:t}=i(2);o.push([_t("show_profile",null,"menu"),()=>t(n.accountId,n.charId)])}o.length&&Engine.interface.showPopupMenu(o,t)};this.clearDataToDraw=()=>{for(let e in t)t[e].clearDataToDraw()},this.findKindOther=t=>{const e=getEngine().miniMapController.handHeldMiniMapController,i=r.TYPE.OTHER,n=r.KIND;return e.canUpdate(i,n.GROUP)&&function(t){let e=Engine.party;if(!e)return!1;let i=t.d.id;return e.getMembers()[i]}(t)?n.GROUP:e.canUpdate(i,n.WANTED)&&function(t){return t.wanted}(t)?n.WANTED:e.canUpdate(i,n.CLAN)&&function(t){return t.d.relation==s.RELATION.CLAN}(t)?n.CLAN:e.canUpdate(i,n.ENEMY)&&function(t){return t.d.relation==s.RELATION.ENEMY}(t)?n.ENEMY:e.canUpdate(i,n.FRIEND)&&function(t){return t.d.relation==s.RELATION.FRIEND}(t)?n.FRIEND:e.canUpdate(i,n.CLAN_ENEMY)&&function(t){return t.d.relation==s.RELATION.CLAN_ENEMY}(t)?n.CLAN_ENEMY:e.canUpdate(i,n.CLAN_FRIEND)&&function(t){return t.d.relation==s.RELATION.CLAN_ALLY}(t)?n.CLAN_FRIEND:r.KIND.NORMAL_OTHER}}},function(t,e,i){var n=i(13);t.exports=function(t,e,i){var a=this;this.type=e.type,this.sourceType=e.sourceType,this.sourceId=e.sourceId,this.targetType=e.targetType,this.targetId=e.targetId,this.endTime=e.endTime,this.parameters=t,this.source=null,this.target=null,this.isNPC=!1,this.frame=0,this.frames=0,this.loop=0,this.startPos=null,this.currentPos=null,this.endPos=null,this.aAndB=null,this.isStatic=!1,this.stopBeforeMove=0,this.stopAfterUse=10,this.framesBeforeInTarget=null,this.framTime=0,this.timePassed=0,this.amoundFrames=0,this.inTarget=!1,this.opacity=1,this.afterUse=!1,this.revert=!1,this.lenghtEmoOnSelfList=0,this.leftModif=0;let s=!0,r=null,o=ts(),l=0;this.update=function(t){this.checkEnd(),this.drawObject(t),this.doAction(t),this.updateJump(),this.fadeOutEmo()};ts();this.updateJump=()=>{if(!this.parameters.jump)return;if(!this.checkCanJump())return void(l=0);let t=Math.floor(100*Math.abs(Math.sin(4*ts()/1e3-o)))/100;l=5*t},this.checkCanJump=()=>!this.parameters.jumpCondition||this.parameters.jumpCondition(),this.setDisplay=t=>{s=t},this.getDisplay=()=>s,this.setStaticAnimation=function(t){IE?this.staticAnimation=!0:this.staticAnimation=!1},this.fadeOutEmo=function(){this.afterUse&&(this.stopAfterUse>0?this.stopAfterUse--:(this.opacity-=.06,this.opacity<.1&&(this.opacity=0,this.delete(),i(this),Engine.emotions.manageDisplayOfNpcEmo(this.sourceType,this.sourceId))))},this.getMadnessTargetHeight=()=>{this.target?this.target.fh:this.source.fh;switch(this.sourceType){case n.OBJECT_TYPE.HERO:case n.OBJECT_TYPE.OTHER:return 0;case n.OBJECT_TYPE.NPC:case n.OBJECT_TYPE.PET:return 0}return errorReport("Emotion.js","getMadnessTargetHeight","Incorrect this.sourceType",this.sourceType),0},this.draw=function(t){let e=Engine.mapShift.getShift();var i=32*this.rx+16-this.fw/2+(isset(this.offsetX)?this.offsetX:0)-Engine.map.offset[0]-e[0]+(void 0!==this.leftPosMod?this.leftPosMod:0),n=32*this.ry-this.fh+32+a.getMadnessTargetHeight()+(isset(this.offsetY)?this.offsetY:0)-Engine.map.offset[1]-e[1];if(i+=this.leftModif,n+=l,i=Math.round(i),n=Math.round(n),this.staticAnimation)return this.img?t.drawImage(this.img,0,0,this.fw,this.fh,i,n,this.fw,this.fh):this.sprite&&t.drawImage(this.sprite,0,0,this.fw,this.fh,i,n,this.fw,this.fh),void(t.globalAlpha=1);var s=0;s=this.revert?(this.amoundFrames-this.frame)*this.fh:this.frame*this.fh,a.getDisplay()&&(t.globalAlpha=this.opacity,this.checkDrawBubbleEmo()&&this.drawBubbleEmo(t,i,n),this.img?t.drawImage(this.img,0,s,this.fw,this.fh,i,n,this.fw,this.fh):this.sprite&&void 0!==this.activeFrame&&this.frames.length>0&&t.drawImage(this.sprite,s,0+this.activeFrame*this.fh,this.fw,this.fh,i,n,this.fw,this.fh),t.globalAlpha=1)},this.checkDrawBubbleEmo=()=>this.sourceType==n.OBJECT_TYPE.NPC&&Engine.npcs.isTalkNpc(this.source.d.id)&&this.type!==n.NAME.BATTLE,this.loadBubbleEmo=()=>{let t=CFG.r_epath+"speech_bubble.gif";Engine.imgLoader.onload(t,{speed:!0,externalSource:cdnUrl},!1,t=>{r=t})},this.drawBubbleEmo=(t,e,i)=>{r&&t.drawImage(r,e-r.width/2+this.fw/2,i-r.height/2+Math.max(this.fh,24)/2)},this.initBubbleImage=()=>{this.sourceType,n.OBJECT_TYPE.NPC},this.initId=function(){return this.sourceType==n.OBJECT_TYPE.NPC?(this.source=Engine.npcs.getById(this.sourceId),null==this.source&&(this.source=this.getCharacterById(this.sourceId,this.sourceType)),this.source):this.sourceType==n.OBJECT_TYPE.PET?(this.source=Engine.hero.getPet(),this.source):(this.source=this.getCharacterById(this.sourceId,this.sourceType),!("0"!=this.targetId&&(this.target=this.getCharacterById(this.targetId,this.targetType),!this.target)))},this.getCharacterById=function(t,e){switch(e){case n.OBJECT_TYPE.HERO:return Engine.hero;case n.OBJECT_TYPE.OTHER:return Engine.others.getById(t);case n.OBJECT_TYPE.NPC:return Engine.npcs.getById(t);default:errorReport("Emotion.js","getCharacterById","Incorrect type of self.sourceType Emo!",a.sourceType)}},this.getOrder=function(){return a.ry+1},this.delete=function(){this.gifTimeOut&&clearTimeout(this.gifTimeOut),a.exit&&a.exit()},this.setImagePath=function(){this.path=this.parameters.path?this.parameters.path:CFG.r_epath,this.name=this.parameters.filename?this.parameters.filename:this.type},this.setIsNpc=()=>{this.isNPC=this.sourceType==n.OBJECT_TYPE.NPC},this.withCreateObject=function(){if(a.parameters.action!=n.ACTION.SCRIPT_EMO){a.setIsNpc();var t=a.initId();if(a.init(),this.sourceType==n.OBJECT_TYPE.NPC&&a.loadBubbleEmo(),!t)return this.delete(),void i(this);a.initBubbleImage(),a.setImagePath(),a.setXYOffset(),a.setStartAndEndPos(),a.createObject(),a.setStaticAnimation(Engine.opt(8))}else a.startScriptEmo()},this.clearRenderVariables=function(){a.afterUse=!1,a.frame=0,a.framTime=0,a.opacity=1,a.timePassed=0,a.activeFrame=0,a.loop=0},this.renew=function(){if(!a.initId())return this.delete(),i(this),void Engine.emotions.manageDisplayOfNpcEmo(this.sourceType,this.sourceId);a.clearRenderVariables(),a.setImagePath(),a.setXYOffset(),a.setStartAndEndPos(),a.setStaticAnimation(Engine.opt(8))},this.startScriptEmo=()=>{$.getScript("https://www.margonem.pl/js/"+this.parameters.filename+".min.js")}}},function(t,e,i){var n=i(13);t.exports=function(){let t=n.ACTION.ON_SELF,e=n.ACTION.ON_SELF,i=n.ACTION.REMOVER,a=n.ACTION.LANTERN,s=n.ACTION.FIRE,r=n.ACTION.STICK_TO_PLAYER,o=n.ACTION.STICK_TO_MAP,l=n.ACTION.STICK_TO_MAP,c=n.ACTION.CHAR_TO_CHAR,d=n.ACTION.CHAR_TO_CHAR,h=n.ACTION.BETWEEN_PLAYERS,u=n.ACTION.SCRIPT_EMO,p=[n.NAME.FRND,n.NAME.BATTLE,n.NAME.PVP_PROTECTED,n.NAME.LOGOFF],g={[n.NAME.NPC_TALK]:{action:t,filename:"talking_mark.gif",offset:[0,-4]},[n.NAME.ELITE_HERE]:{action:t,filename:"elite-here3.gif",offset:[0,20],position:"bottom",timeout:800},[n.NAME.AGGRESSIVE]:{action:t,filename:"angry-demon.gif",offset:[0,0]},[n.NAME.WALKOVER]:{action:t,filename:"battle.gif",offset:[0,0]},[n.NAME.BLUE_EXCLAMATION]:{action:t,filename:"exclamation_mark_2.gif",offset:[0,-10]},[n.NAME.YELLOW_EXCLAMATION]:{action:t,filename:"exclamation_mark_1.gif",offset:[0,-10]},[n.NAME.RED_EXCLAMATION]:{action:t,filename:"exclamation_mark_3.gif",offset:[0,-10]},[n.NAME.DAILY_QUEST]:{action:t,filename:"daily_quest_mark",offset:[0,0]},[n.NAME.NORMAL_QUEST]:{action:t,filename:"quest_mark.gif",offset:[0,0]},[n.NAME.AUCTION]:{action:t,filename:"auctions_mark.gif",offset:[0,0]},[n.NAME.DEPO]:{action:t,filename:"depo_mark.gif",offset:[0,0],clear:[n.NAME.DEPO_CLAN]},[n.NAME.DEPO_CLAN]:{action:t,filename:"depo_mark.gif",offset:[0,0],clear:[n.NAME.DEPO]},[n.NAME.MAIL]:{action:t,filename:"mail_mark.gif",offset:[0,0]},[n.NAME.SHOP]:{action:t,filename:"shop_mark.gif",offset:[0,0]},[n.NAME.HEAL]:{action:t,filename:"heal_mark.gif",offset:[0,0]},[n.NAME.INKEEPER]:{action:t,filename:"inn_mark.gif",offset:[0,0]},[n.NAME.FLAG_ENGLAND]:{action:t,timeout:8e3,filename:"flag-anglia.gif"},[n.NAME.FLAG_CROATIA]:{action:t,timeout:8e3,filename:"flag-chorwacja.gif"},[n.NAME.FLAG_CZECH]:{action:t,timeout:8e3,filename:"flag-czechy.gif"},[n.NAME.FLAG_DENMARK]:{action:t,timeout:8e3,filename:"flag-dania.gif"},[n.NAME.FLAG_FRANCE]:{action:t,timeout:8e3,filename:"flag-francja.gif"},[n.NAME.FLAG_GREECE]:{action:t,timeout:8e3,filename:"flag-grecja.gif"},[n.NAME.FLAG_SPAIN]:{action:t,timeout:8e3,filename:"flag-hiszpania.gif"},[n.NAME.FLAG_NETHERLAND]:{action:t,timeout:8e3,filename:"flag-holandia.gif"},[n.NAME.FLAG_IRELAND]:{action:t,timeout:8e3,filename:"flag-irlandia.gif"},[n.NAME.FLAG_GERMANY]:{action:t,timeout:8e3,filename:"flag-niemcy.gif"},[n.NAME.FLAG_POLAND]:{action:t,timeout:8e3,filename:"flag-polska.gif"},[n.NAME.FLAG_PORTUGAL]:{action:t,timeout:8e3,filename:"flag-portugalia.gif"},[n.NAME.FLAG_RUSSIA]:{action:t,timeout:8e3,filename:"flag-rosja.gif"},[n.NAME.FLAG_SKULL]:{action:t,timeout:8e3,filename:"flag-skull.gif"},[n.NAME.FLAG_SWEDEN]:{action:t,timeout:8e3,filename:"flag-szwecja.gif"},[n.NAME.FLAG_UKRAINE]:{action:t,timeout:8e3,filename:"flag-ukraina.gif"},[n.NAME.FLAG_ITALY]:{action:t,timeout:8e3,filename:"flag-wlochy.gif"},[n.NAME.ABBYS_OUT]:{action:t,timeout:2e3},[n.NAME.ANGRY]:{action:t,timeout:8e3},[n.NAME.AWAY]:{action:t,timeout:8e3},[n.NAME.BAT]:{action:t,timeout:8e3},[n.NAME.BATTLE]:{action:t},[n.NAME.STASIS]:{action:t},[n.NAME.STASIS_INCOMING]:{action:t},[n.NAME.FRND]:{action:t,timeout:3750},[n.NAME.LOGIN]:{action:t,timeout:2e3},[n.NAME.LOGOFF]:{action:t,timeout:4e3},[n.NAME.LVL_UP]:{action:t,timeout:1e3,position:"bottom",offset:[0,-30]},[n.NAME.PVP_PROTECTED]:{action:t,timeout:5e3},[n.NAME.RESPAWNED]:{action:t,timeout:2e3},[n.NAME.SPIDER]:{action:t,timeout:3e3},[n.NAME.TELEPORTED]:{action:t,timeout:2e3},[n.NAME.BUBBLES]:{action:e,height:48,frameTime:.12,offset:[0,32]},[n.NAME.CURSE]:{action:e,height:32,frameTime:.2,offset:[0,10],filename:"klatwa.gif",loop:2},[n.NAME.TUNE]:{action:e,height:32,frameTime:.1,offset:[0,0]},[n.NAME.GUM_1]:{action:e,height:48,frameTime:.12,offset:[0,32]},[n.NAME.GUM_2]:{action:e,height:48,frameTime:.12,offset:[0,32]},[n.NAME.GUM_3]:{action:e,height:48,frameTime:.12,offset:[0,32]},[n.NAME.GUM_4]:{action:e,height:48,frameTime:.12,offset:[0,32]},[n.NAME.KUCIAK]:{action:e,height:32,frameTime:.15,offset:[0,0],filename:"kuciak.png",stopAfterUse:80},[n.NAME.BIRD]:{action:e,height:32,frameTime:.085,offset:[0,0],filename:"ptaszek.png",loop:8},[n.NAME.EMO_SNOW]:{action:l,height:32,frameTime:.07,offset:[-32,0]},[n.NAME.GHOST]:{action:l,height:48,frameTime:.2,offset:[0,-45],loop:3},[n.NAME.WATER]:{action:l,height:64,frameTime:.125,offset:[0,-50],filename:"water.png"},[n.NAME.FACE_1]:{action:r,height:48,frameTime:.07,offset:[-1,-15]},[n.NAME.FACE_2]:{action:r,height:48,frameTime:.07,offset:[-1,-15]},[n.NAME.ROSE]:{action:r,height:32,frameTime:.07,offset:[-1,0],stopAfterUse:1e3},[n.NAME.COCOS]:{action:d,height:32,frameTime:.2,offset:[0,-20]},[n.NAME.EMO_HUG_1]:{action:d,height:32,frameTime:.2,offset:[0,-37]},[n.NAME.EMO_HUG_2]:{action:d,height:32,frameTime:.2,offset:[0,-37]},[n.NAME.EMO_HUG_3]:{action:d,height:32,frameTime:.2,offset:[0,-40]},[n.NAME.GIFT]:{action:d,height:32,frameTime:.2,offset:[0,-10],stopAfterUse:40},[n.NAME.HOLLY]:{action:d,height:32,frameTime:.3,offset:[0,-40]},[n.NAME.SNOWBALL]:{action:d,height:16,frameTime:.15,offset:[0,-20]},[n.NAME.PILLOW]:{action:d,height:32,frameTime:.1,framesBeforeInTarget:3,filename:"poducha.gif"},[n.NAME.FIRE_1]:{action:s,height:48,frameTime:.075,offset:[0,-60]},[n.NAME.FIRE_2]:{action:s,height:48,frameTime:.075,offset:[0,-60]},[n.NAME.FIRE_3]:{action:s,height:48,frameTime:.075,offset:[2,-60]},[n.NAME.FIRE_4]:{action:s,height:48,frameTime:.075,offset:[2,-60]},[n.NAME.FIRE_5]:{action:s,height:48,frameTime:.075,offset:[-2,-60]},[n.NAME.FIRE_6]:{action:s,height:48,frameTime:.075,offset:[-2,-60]},[n.NAME.FIRE_7]:{action:s,height:48,frameTime:.075,offset:[-2,-60]},[n.NAME.FIRE_8]:{action:s,height:48,frameTime:.075,offset:[0,-60]},[n.NAME.FIRE_9]:{action:s,height:48,frameTime:.075,offset:[0,-37]},[n.NAME.FIREWORKS]:{action:s,height:48,frameTime:.12,offset:[0,-120],framesBeforeInTarget:1,preLoop:!0},[n.NAME.STARS]:{action:e,height:32,frameTime:.12,filename:"gwiazdki.gif",loop:3},[n.NAME.TERMOFOR]:{action:e,height:32,frameTime:.2,offset:[0,0]},[n.NAME.LANTERN_1]:{action:a,height:48,frameTime:.2,revert:!0,stopAfterUse:600},[n.NAME.LANTERN_2]:{action:a,height:48,frameTime:.2,revert:!0,stopAfterUse:600},[n.NAME.LANTERN_3]:{action:a,height:48,frameTime:.2,revert:!0,stopAfterUse:600},[n.NAME.LANTERN_4]:{action:a,height:48,frameTime:.2,revert:!0,stopAfterUse:600},[n.NAME.LANTERN_5]:{action:a,height:48,frameTime:.2,revert:!0,stopAfterUse:600},[n.NAME.NO_EMO]:{action:i,clear:p},[n.NAME.ZOMBIE]:{action:o,timeout:1500,offset:[0,-15]},[n.NAME.KISS_2]:{action:c,timeout:8e3,offset:[0,-30]},[n.NAME.KISS_1]:{action:h,timeout:8e3},[n.NAME.VISUAL_EFFECTS]:{action:u,filename:"VisualEffects2"}};this.get=function(t){var e=g[t];return isset(e)?e:null}}},function(t,e){t.exports={getGifObject:function(){this.checkEnd=function(){0!==this.endTime&&Engine.getEv()>this.endTime&&(this.afterUse=!0,this.fadeOutEmo())},this.drawObject=function(t){this.frames&&this.frames.length>1&&!Engine.opt(8)&&!IE&&(this.timePassed+=100*t,this.frames[this.activeFrame].delay<this.timePassed&&(this.timePassed=this.timePassed-this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.createObject=function(){var t=this,e=/\.gif/.test(this.name)?this.name.replace(".gif",""):this.name,i=this.path+e+".gif";Engine.imgLoader.onload(i,{speed:!1,externalSource:cdnUrl},(e,i)=>{t.correctPosition(),t.fw=i.hdr.width,t.fh=i.hdr.height,t.frames=i.frames,t.activeFrame=0,t.sprite=e,t.isStatic=!(t.fw%64)})},this.correctPosition=function(){this.parameters.position&&this.parameters.position}},getSpriteObject:function(){this.drawObject=function(t){this.animateObjectBeforeInTarget(t),this.inTarget&&!this.afterUse&&(this.framTime+=t,this.framTime>=this.parameters.frameTime&&(this.frame++,this.framTime=this.framTime%this.parameters.frameTime,this.animateObjectAgainOrDelete()))},this.animateObjectBeforeInTarget=function(t){this.framesBeforeInTarget&&(this.framTime+=t,this.framTime>=this.parameters.frameTime+.1&&(this.parameters.framesBeforeInTarget>this.frame?(this.frame++,this.framTime=this.framTime%this.parameters.frameTime):this.parameters.preLoop&&(this.frame=0)))},this.animateObjectAgainOrDelete=function(){if(this.frame==this.amoundFrames)if(this.parameters.loop){if(this.loop++,this.loop==this.parameters.loop)return void(this.afterUse=!0);this.frame=0}else this.afterUse=!0},this.createObject=function(){this.setFramesBeforeInTarget(),this.setStopAfterUse(),this.setRevert();var t=this,e=/\./.test(this.name)?this.name:this.name+".gif",i=cdnUrl+this.path+e;Engine.imgLoader.onload(i,!1,!1,e=>{var i=e.height/t.parameters.height;t.amoundFrames=i-1,t.fw=e.width,t.fh=e.height/i,t.img=e})},this.setFramesBeforeInTarget=function(){this.framesBeforeInTarget=!!this.parameters.framesBeforeInTarget},this.setStopAfterUse=function(){this.parameters.stopAfterUse&&(this.stopAfterUse=this.parameters.stopAfterUse)},this.setRevert=function(){this.revert=!!this.parameters.revert},this.checkEnd=function(){}}}},function(t,e,i){var n=i(13);function a(){}function s(){this.setStartAndEndPos=function(){this.actionWithTwoId(),this.initObjectPosXY(),this.inTarget=!0},this.doAction=function(){switch(this.inTarget=!0,this.startPos[0]>this.endPos[0]&&(this.offsetX=16),this.startPos[0]<this.endPos[0]&&(this.offsetX=-16),this.startPos[1]-this.endPos[1]){case-1:this.offsetY=-65;break;case 0:this.offsetY=-50;break;case 1:this.offsetY=-35}}}function r(){this.setStartAndEndPos=function(){this.actionWithTwoId(),this.setAAndBDetermine()},this.lengthWay=function(){var t=Math.pow(this.endPos[0]-this.currentPos[0],2),e=Math.pow(this.endPos[1]-this.currentPos[1],2);return Math.sqrt(t+e)},this.reachEndPosition=function(){return this.endPos[0]==roundNumber(this.rx,1)&&this.endPos[1]==roundNumber(this.ry,1)&&(this.initObjectPosXY(),this.framesBeforeInTarget=!1,this.inTarget=!0,!0)},this.goToTarget=function(t){var e,i=this.currentPos,n=this.endPos,a=this.lengthWay()>.3?5*t:t,s=Math.abs(n[0]-i[0]),r=Math.abs(n[1]-i[1]);s>=r&&(0==this.aAndB[0]?(i[0]>n[0]&&(this.rx=this.rx-a),i[0]<n[0]&&(this.rx=this.rx+a)):(e=i[0]+(i[0]>n[0]?-a:a),this.rx=e,this.ry=this.aAndB[0]*this.rx+this.aAndB[1])),s<r&&(0==this.aAndB[0]?(i[1]>n[1]&&(this.ry=this.ry-a),i[1]<n[1]&&(this.ry=this.ry+a)):(e=i[1]+(i[1]>n[1]?-a:a),this.ry=e,this.rx=(this.ry-this.aAndB[1])/this.aAndB[0])),this.currentPos=[this.rx,this.ry]},this.setAAndBDetermine=function(){if(this.source&&this.target){var t=this.currentPos,e=this.endPos,i=t[0]-e[0],n=t[1]-e[1],a=0==i?0:n/i,s=t[1]-a*t[0];this.aAndB=[a,s]}},this.doAction=function(t){this.drawInStartPos()||this.reachEndPosition()||this.goToTarget(t)}}function o(){this.setStartAndEndPos=function(){this.actionWithOneId(),this.initObjectPosXY()},this.setXYOffset=function(){this.offsetX=this.parameters.offset[0],this.offsetY=-18},this.doAction=function(t){if(!this.drawInStartPos()){if(this.framesBeforeInTarget||(this.inTarget=!0),this.parameters.offset[1]>this.offsetY)return this.framesBeforeInTarget=!1,void(this.inTarget=!0);this.offsetY-=this.parameters.preLoop?2:10}}}function l(){this.setStartAndEndPos=function(){this.actionWithOneId(),this.inTarget=!0},this.setXYOffset=function(){if(this.parameters.position)switch(this.parameters.position){case"bottom":this.offsetY=0}else this.offsetY=-this.source.fh-2;this.offsetX=0+isset(this.source.leftPosMod)?this.source.leftPosMod:0,this.parameters.offset&&(this.offsetX+=this.parameters.offset[0],this.offsetY+=this.parameters.offset[1])},this.doAction=function(t){const e=this.source,i=e.getEmotionIndex(this);this.rx=e.rx,this.ry=e.ry,this.sourceType==n.OBJECT_TYPE.NPC&&Engine.npcs.isTalkNpc(e.d.id)||-1!=i&&(this.leftModif=this.fw*i-e.onSelfMarginEmo)},this.init=function(){const t=this.source;t.addToOnSelfEmoList(this);const e=t.getEmoLength();t.onSelfMarginEmo=this.calcMargin(e)},this.exit=function(){const t=this.source,e=t.getEmotionIndex(this);-1!=e&&t.removeOnSelfEmoList(e);const i=t.getEmoLength();t.onSelfMarginEmo=this.calcMargin(i)},this.calcMargin=function(t){return 8*t-8}}function c(){this.setStartAndEndPos=function(){this.actionWithOneId(),this.inTarget=!0},this.setXYOffset=function(){if(this.parameters.position)switch(this.parameters.position){case"bottom":this.offsetY=0}else this.offsetY=-this.source.fh-7;this.offsetX=0+isset(this.source.leftPosMod)?this.source.leftPosMod:0,this.parameters.offset&&(this.offsetX+=this.parameters.offset[0],this.offsetY+=this.parameters.offset[1])},this.doAction=function(t){this.rx=this.source.rx,this.ry=this.source.ry}}function d(){this.setStartAndEndPos=function(){this.actionWithTwoId(),this.inTarget=!0},this.doAction=function(){this.rx=this.target.rx,this.ry=this.target.ry}}function h(){this.setStartAndEndPos=function(){this.actionWithOneId(),this.initObjectPosXY(),this.inTarget=!0}}function u(){this.setStartAndEndPos=function(){this.actionWithOneId(),this.initObjectPosXY(),this.inTarget=!0},this.doAction=function(t){this.offsetX=this.offsetX+20*t,this.offsetY=this.offsetY-30*t}}a.prototype.init=function(){},a.prototype.exit=function(){},a.prototype.setXYOffset=function(){this.parameters.offset?(this.offsetX=this.parameters.offset[0],this.offsetY=this.parameters.offset[1]):(this.offsetX=0,this.offsetY=0)},a.prototype.initObjectPosXY=function(){this.rx=this.endPos[0],this.ry=this.endPos[1]},a.prototype.doAction=function(){},a.prototype.drawInStartPos=function(){return this.stopBeforeMove<3&&(this.stopBeforeMove++,this.rx=this.source.rx,this.ry=this.source.ry,!0)},a.prototype.actionWithTwoId=function(){if(this.startPos=[this.source.rx,this.source.ry],this.currentPos=this.startPos,this.parameters.modify){var t=this.parameters.modify;this.endPos=[this.target.rx+t[0],this.target.ry+t[1]]}else this.endPos=[this.target.rx,this.target.ry]},a.prototype.actionWithOneId=function(){this.endPos=[this.source.rx,this.source.ry]},s.prototype=Object.create(a.prototype),r.prototype=Object.create(a.prototype),o.prototype=Object.create(a.prototype),l.prototype=Object.create(a.prototype),c.prototype=Object.create(a.prototype),d.prototype=Object.create(a.prototype),h.prototype=Object.create(a.prototype),u.prototype=Object.create(a.prototype),t.exports={getActionBetweenPlayers:s,getActionCharToChar:r,getActionFire:o,getActionOnSelf:l,getActionOnNpc:c,getActionStickToAnotherPlayer:d,getActionStickToMap:h,getActionLantern:u}},function(t,e,i){var n=i(0),a=(i(374),i(104));i(7),i(20);let s=i(27);var r=i(17);let o=i(10),l=i(61);t.exports=function(){var t,e=this,i={},c={};let d,h,u;this.init=function(){this.initWindow(),this.initEditControlPanelBtn(),this.initSearch(),this.setStatesFromStorage(),this.initScroll(),this.initMargin(),h=e.wnd.$.find(".players-number .info-icon"),d=e.wnd.$.find(".player-list"),u=e.wnd.$.find(".players-number .num"),this.setStateOfWhoIsHere(),this.updatePlayersNumber(),this.updateHeroGlow()},this.isShow=()=>this.wnd.isShow(),this.updateWhoIsHereAfterSaveInServerStorage=()=>{this.rebuildListAfterChangeStates(),this.updateHeroGlow(),this.playersNumberTipUpdate()},this.initMargin=function(){this.wnd.$.find(".content").css({"margin-top":"-12px","margin-left":"-23px","margin-right":"-23px","margin-bottom":"-17px"})},this.getDefaultColor=function(t){return getEngine().handHeldMiniMapController.getDefaultColor(t)},this.setStatesFromStorage=function(){c=getEngine().miniMapController.handHeldMiniMapController.getDataToWhoIsHere(),t=Object.keys(c)};this.initEditControlPanelBtn=function(){var t=n.get("settings-button");t.addClass("small green"),t.find(".label").html("..."),e.wnd.$.find(".open-edit-panel").append(t),t.click((function(t){getEngine().miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow().createControllPanel()}))},this.updateScroll=function(){e.isShow()&&$(".scroll-wrapper",e.wnd.$).trigger("update")},this.getList=function(){return i},this.addToList=function(t,n,a){n.hasOwnProperty("del")?e.removeFromList(t,n):i[t]&&!isset(n.relation)||(i[t]={id:t,nick:n.nick,prof:n.prof,lvl:n.lvl,relation:e.getRelation(t,n.relation),rights:n.rights,wanted:n.wanted,stasis:n.stasis,stasisIncoming:n.stasis_incoming_seconds,show:null,$:null},this.createOnePerson(t,n,a),this.addElements(),this.checkEmpty(),this.updateSearch())},this.updateSearch=function(){if(e.isShow()){var t=e.wnd.$.find(".search").val();""!=t&&e.searchItems(t)}},this.checkEmpty=function(){if(e.updatePlayersNumber(),e.isShow()){for(let t in i)if(i[t].show)return void e.wnd.$.find(".empty").css("display","none");e.wnd.$.find(".empty").css("display","block"),e.updateScroll()}},this.getAmountVisibleOthers=()=>{let t=0;for(let e in i)i[e].show&&t++;return t},this.addElements=function(){var t=e.wnd.$.find(".player-list").empty();const i=this.getSortedPlayerList();for(const e of i)t.append(e.$),this.createMenuAction(e.$,e.id)},this.getSortedPlayerList=()=>Object.values(i).sort((t,e)=>t.lvl!==e.lvl?e.lvl-t.lvl:t.nick.localeCompare(e.nick)),this.createOnePerson=function(t,a,s){var r=n.get("one-other"),o=i[t],l=o.nick,c=0==o.lvl?"":"("+o.lvl+o.prof+")",h=o.stasis,u=o.stasisIncoming,p=this.getPersonColor(o.relation),g=this.getPersonVisible(o.relation),f=this.getMapPersonVisible(o.relation),m=r.find(".stasis"),v=r.find(".stasis-incoming");const E=r.find(".tip-container"),_=$("<div />"),b=$('<div class="avatar-icon" />');createImgStyle(b,CFG.a_opath+s.d.icon),_.append(s.createStrTip()).append(b),e.updateGlow(a,g,s,f,p);var w=r.find(".name .inner");if(w.html(l),E.tip(_,"t_other"),r.attr("data-id",t),g?r.removeClass("hidden"):r.addClass("hidden"),i[t].show=g,r.find(".center").css("color",p),r.find(".lvl").html(c),h?m.addClass("active"):m.removeClass("active"),u>0?v.addClass("active"):v.removeClass("active"),r.data("sort",o.lvl),i[t].$=r,d.append(r),o.wanted){h?m.addClass("with-wanted"):m.removeClass("with-wanted"),u>0?v.addClass("with-wanted"):v.removeClass("with-wanted");var C=n.get("wanted-skull-wrapper");C.find(".skull").tip(_t("my_char_wanted",null,"map")),w.after(C)}},this.updateGlow=function(t,e,i,n,a){i?e&&n?(i.whoIsHere=a,i.d.whoIsHere=a,isset(i.whoIsHereGlow)?i.whoIsHereGlow.updateColor():i.updateWhoIsHereGlow(),i.tipUpdate()):(delete i.whoIsHere,delete i.d.whoIsHere,delete i.whoIsHereGlow):e&&n&&(t.whoIsHere=a)},this.canShowActionMenu=function(){return!Engine.battle.getShow()},this.createMenuAction=function(t,i){t.on("click",(function(t){var e=Engine.others.getById(i);Engine.chatController.getChatInputWrapper().setPrivateMessageProcedure(e.d.nick)})),t.on("contextmenu",(function(t){var n=Engine.others.getById(i);if(n){if(!e.canShowActionMenu())return n.createBasicMenu(t),void e.wnd.correctPositionMenuToRightEdgeOfWnd();n.createMenu(t),e.wnd.correctPositionMenuToRightEdgeOfWnd()}})),t.on("mouseenter",(function(){var t=Engine.others.getById(i);t&&(t.colorMark||0!=$(".popup-menu").length||(t.colorMark=new a(i,"green"),t.colorMark.init(),Engine.targets.addArrow(!1,t.nick,t,"Other","navigate")))})),t.on("mouseleave",(function(){var t=Engine.others.getById(i);t&&t.colorMark&&"green"==t.colorMark.color&&0==$(".popup-menu").length&&(delete t.colorMark,Engine.targets.deleteArrow("Other-"+t.d.id))}))},this.getRelation=function(t,e){var i,n=Engine.party;let a=o.KIND;if(n&&n.getMembers()[t])i=a.GROUP;else switch(e){case r.RELATION.NONE:i=a.NORMAL_OTHER;break;case r.RELATION.FRIEND:i=a.FRIEND;break;case r.RELATION.ENEMY:i=a.ENEMY;break;case r.RELATION.CLAN:i=a.CLAN;break;case r.RELATION.CLAN_ENEMY:i=a.CLAN_ENEMY;break;case r.RELATION.CLAN_ALLY:i=a.CLAN_FRIEND;break;default:i=a.NORMAL_OTHER}return i},this.getList=function(){return i},this.comparePartyMembers=function(t,i){for(var n=t.length<i.length?i:t,a=Engine.others.check(),s=0;s<n.length;s++){var r=n[s];a[r]&&e.addToList(r,a[r].d,a[r])}e.updateScroll(),e.updatePlayersNumber()},this.rebuildListAfterChangeStates=function(){for(var t in this.setStatesFromStorage(),i)this.rebuildOnePerson(t);e.checkEmpty()},this.updateHeroGlow=function(){let t=(e=o.KIND.HERO,c[e]);var e;let i=t.color,n=t.mapBlur,a=Engine.hero;n?(a.whoIsHere=i,a.d.whoIsHere=i,isset(a.whoIsHereGlow)?a.whoIsHereGlow.updateColor(i):a.updateWhoIsHereGlow()):(delete a.whoIsHere,delete a.whoIsHereGlow)},this.rebuildOnePerson=function(t){var n=i[t].relation,a=e.getPersonColor(n),s=e.getPersonVisible(n),r=e.getMapPersonVisible(n),o=Engine.others.check(),l=o[t];s&&r?(l.whoIsHere=a,l.d.whoIsHere=a,isset(l.whoIsHereGlow)?l.whoIsHereGlow.updateColor():l.updateWhoIsHereGlow()):e.removeWhoIsHere(t),l.tipUpdate(),Engine.miniMapController.updateWindowMiniMapOthersPos(o,!0),s?i[t].$.removeClass("hidden"):i[t].$.addClass("hidden"),i[t].$.find(".center").css("color",a),i[t].show=s},this.getPersonColor=function(t){return t?c[t].color:"#ffffff"},this.getPersonVisible=function(t){return!t||!!c[t].whoIsHere},this.getMapPersonVisible=function(t){return!t||c[t].mapBlur},this.removeFromList=function(t,n){i[t]&&(e.wnd.$.find(`[data-id='${t}']`).remove(),delete i[t],e.checkEmpty())},this.removeWhoIsHere=function(t){var e=Engine.others.check()[t];isset(e)&&isset(e.whoIsHere)&&(delete e.whoIsHere,delete e.d.whoIsHere,delete e.whoIsHereGlow)},this.updatePlayersNumber=function(){let t=e.getAmountVisibleOthers(),i=u.html();""!==i&&i==t||(u.text(t),this.playersNumberTipUpdate()),this.updateAmountOnWidget(t)},this.updateAmountOnWidget=t=>{Engine.widgetManager.widgets.updateAmount(Engine.widgetsData.name.WHO_IS_HERE,t)},this.countPlayerTypes=function(){var t=[];for(var e in i)t.push(i[e].relation);return t.reduce((function(t,e){return t[e]=(t[e]||0)+1,t}),{})},this.playersNumberTipUpdate=function(){let e=[],i=this.countPlayerTypes();const n=Engine.miniMapController.handHeldMiniMapController;e.push("<div>");for(var a=0;a<t.length;a++){let s=t[a],r=n.getWhoIsHereOfKindByName(s);if(s==o.KIND.HERO)continue;if(!r)continue;let c,d=l.getColorOfKindByName(s),h=i[s],u=_t(s,null,"edit-panel-option");null==d&&(d=n.getDefaultColor(s)),c=h||0,e.push(`<div class="who-is-here-one-type clearfix" style="color:${d}">\n\t\t\t\t\t<div class="type">${u}</div>\n\t\t\t\t\t<div class="amount">${c}</div>\n\t\t\t\t</div>`)}e.push("</div>");let s=e.join("");h.tip(s,"t-who-is-here")},this.searchItems=t=>{e.wnd.$.find(".player-list").find(".one-other").each((function(){var e=$(this),i=e.find(".name .inner").html().toLowerCase().search(t.toLowerCase())>-1?"":"none";e.css("display",i)})),e.checkEmpty()},this.initSearch=()=>{var t=e.wnd.$.find(".search"),i=e.wnd.$.find(".search-x");t.on("input",(function(){e.searchItems($(this).val())})),i.on("click",(function(){t.val("").blur().trigger("input")}))},this.initScroll=function(){e.wnd.$.find(".scroll-wrapper").addScrollBar({track:!0})},this.createButton=function(t,i,a){var s=n.get("button").addClass(i);s.find(".label").html(t),s.click(a),e.wnd.$.append(s)},this.openPanel=function(){e.addElements(),e.wnd.show(),e.wnd.setWndOnPeak(),e.checkEmpty(),e.updateScroll(),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.WHO_IS_HERE,!0)},this.closePanel=function(){e.wnd.hide(),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.WHO_IS_HERE,!1)},this.managePanelVisible=function(){this.isShow()?this.closePanel():this.openPanel()},this.onInterfaceReady=function(){this.updatePlayersNumber(),Engine.widgetManager.widgets.isActive(Engine.widgetsData.name.WHO_IS_HERE,e.isShow())},this.initWindow=function(){Engine.windowManager.add({content:n.get("who-is-here"),title:_t("players_on_map"),nameWindow:Engine.windowsData.name.WHO_IS_HERE,widget:Engine.widgetsData.name.WHO_IS_HERE,objParent:this,nameRefInParent:"wnd",type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,manageShow:!1,managePosition:{x:"251",y:"60"},onclose:()=>{e.managePanelVisible()}}),this.wnd.updatePos(),this.wnd.$.addClass("whoishere-window"),this.wnd.addToAlertLayer()},this.setStateOfWhoIsHere=function(){var t=s.getShowWindow(Engine.windowsData.name.WHO_IS_HERE);t&&null!=t?this.openPanel():this.closePanel()},this.onResize=function(){this.wnd.updatePos()}}},function(t,e,i){var n=i(0);let a=i(7),s=i(375);const r=i(77),o=i(40);t.exports=function(){let t="EditColorPanel.js";var e,i=this;let l={},c={};var d;let h={};this.init=function(){this.initWindow(),this.initNamesTab(),this.initAllOptions(),this.initLabels(),this.centreWnd(),this.initSaveButton(),this.initSetDefaultSettingsBtn()};const u=e=>h[e]?h[e].getChooseColor():(errorReport(t,"getColorFromAllColorPickers","allColorPickers name not exist!",e),"#fc3e40");this.initSetDefaultSettingsBtn=()=>{let t=n.get("button").addClass("green small");t.find(".label").html(_t("default_settings")),this.wnd.$.find(".save-colors").append(t),t.click(()=>{let t=_t("set_Default_settings_alert");confirmWithCallback({msg:t,clb:()=>{this.setDefaultSettings()}})})},this.setDefaultSettings=()=>{this.setDefaultColor(),this.setDefaultCheckboxAndMenu(),this.saveColorsToStore(!1)},this.setDefaultCheckboxAndMenu=()=>{this.wnd.$.find(".who-is-here-color").each((function(){let t=$(this);i.showPaleteAndCheckbox(t,1)}));for(let t in l)l[t].setChecked(!0);for(let t in c)c[t].setChecked(!0)},this.setDefaultColor=()=>{for(let t in h){let e=i.getColorFromDefault(t);h[t].setColorAndUpdate(e)}},this.initSaveButton=function(){var t=n.get("button").addClass("green small");t.find(".label").html(_t("save")),this.wnd.$.find(".save-colors").append(t),t.click((function(){i.saveColorsToStore(!0)}))},this.centreWnd=function(){this.wnd.center()},this.initLabels=function(){var t=this.wnd.$;t.find(".header").html(_t("players_on_map")),t.find(".show-label").html(_t("show",null,"whoIsHere")),t.find(".color-label").html(_t("color",null,"whoIsHere")),t.find(".show-map-label").html(_t("lighting",null,"whoIsHere"))},this.initWindow=function(){e=n.get("who-is-here-edit"),Engine.windowManager.add({content:e,title:_t("option"),nameWindow:Engine.windowsData.name.EDIT_COLOR_PANEL_WHO_IS_HERE,objParent:this,nameRefInParent:"wnd",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer()},this.initNamesTab=function(){d=[s.NAME.HERO,s.NAME.NORMAL_PLAYERS,s.NAME.FRIENDS,s.NAME.ENEMIES,s.NAME.CLAN_MEMBERS,s.NAME.CLAN_FRIENDS,s.NAME.CLAN_ENEMIES,s.NAME.GROUPS]},this.initAllOptions=function(){for(var t=this.wnd.$.find(".all-colors"),e=0;e<d.length;e++)this.createOneColor(d[e],t)},this.createOneColor=function(t,e){let a=n.get("who-is-here-color");if(a.attr("id",t),e.append(a),a.find(".text").html(_t(t,null,"whoIsHere")),v(a,t),t!=s.NAME.HERO){let e=a.find(".show-checkbox-wrapper"),n=this.getStateFromStorage(t),s=g(t);m(n,s,e,"SHOW",(function(t){i.showPaleteAndCheckbox(a,t)})),this.showPaleteAndCheckbox(a,n)}let r=a.find(".glow-checkbox-wrapper"),o=this.getMapStateFromStorage(t),l=p(t);m(o,l,r,"GLOW")};const p=t=>t+"-glow-checbox-who-is-here",g=t=>t+"-show-checbox-who-is-here",f=t=>c[t],m=(t,e,i,n,a)=>{const s=new o.default({name:"",label:" ",value:"",i:e,checked:t},t=>{a&&a(t.target.checked)});i.append($(s.getCheckbox())),"GLOW"==n&&((t,e)=>{l[t]=e})(e,s),"SHOW"==n&&((t,e)=>{c[t]=e})(e,s)},v=(t,e)=>{let i=new r,n=t.find(".choose-color-wrapper");var a=this.getColorFromStore(e);i.init(),i.updateData(n,a,null),h[e]=i};this.showPaleteAndCheckbox=function(t,e){var i=t.find(".choose-color-wrapper,.glow-checkbox-wrapper");e?i.removeClass("hide"):i.addClass("hide")},this.getColorFromDefault=function(t){return"#"+Engine.whoIsHere.getDefaultColor(t)},this.getColorFromStore=function(t){let e=Engine.serverStorage.get(a.WHO_IS_HERE,t,s.ATTR.COLOR);return e||i.getColorFromDefault(t)},this.getStateFromStorage=function(t){let e=Engine.serverStorage.get(a.WHO_IS_HERE,t,s.ATTR.STATE);if(null!==e)return e;return!0},this.getMapStateFromStorage=function(t){let e=Engine.serverStorage.get(a.WHO_IS_HERE,t,s.ATTR.MAP_STATE);return null!==e?e:t!=s.NAME.NORMAL_PLAYERS},this.close=function(){i.wnd.remove(),Engine.whoIsHere.editColorPanel=null},this.saveColorsToStore=function(t){let e={};for(var n=0;n<d.length;n++){let t=d[n],i=u(t),a=(r=p(t),l[r]),o=f(g(t)),c=a.getChecked(),h=t==s.NAME.HERO||o.getChecked();e[t]={[s.ATTR.STATE]:h,[s.ATTR.COLOR]:i,[s.ATTR.MAP_STATE]:c}}var r;Engine.serverStorage.sendData({[a.WHO_IS_HERE]:e},(function(){Engine.whoIsHere.updateWhoIsHereAfterSaveInServerStorage(),t&&i.close()}))}}},function(t,e){t.exports={NAME:{HERO:"hero",NORMAL_PLAYERS:"normal_players",FRIENDS:"friends",ENEMIES:"enemies",CLAN_MEMBERS:"clan-members",CLAN_FRIENDS:"clan-friends",CLAN_ENEMIES:"clan-enemies",GROUPS:"groups"},ATTR:{MAP_STATE:"mapState",STATE:"state",COLOR:"color"}}},function(t,e,i){var n=i(377);t.exports=function(){let t={};const e=e=>t[e],i=()=>new n,a=e=>!!t[e],s=(e,i)=>{t[e]=i};this.init=()=>{},this.updateData=t=>{for(let n in t){let r=t[n],o=r.id,l=null;a(o)?l=e(o):(l=i(),l.init(),s(o,l)),l.updateData(r)}},this.getCard=e,this.checkCardExist=a}},function(t,e){t.exports=function(){let t=null,e=null,i=null,n=null,a=null,s=null,r=null,o=null;this.getAcc=()=>t,this.getIcon=()=>e,this.getId=()=>i,this.getLvl=()=>n,this.getNick=()=>a,this.getProf=()=>s,this.getSex=()=>r,this.getRelation=()=>o,this.init=()=>{},this.updateData=l=>{isset(l.acc)&&(t=l.acc),isset(l.icon)&&(e=l.icon),isset(l.id)&&(i=l.id),isset(l.lvl)&&(n=l.lvl),isset(l.nick)&&(a=l.nick),isset(l.prof)&&(s=l.prof),isset(l.sex)&&(r=l.sex),isset(l.relation)&&(o=l.relation)}}},function(t,e,i){var n=i(9),a=i(379),s=i(380),r=i(386),o=i(387),l=i(388),c=i(389),d=i(391),h=i(392),u=i(393);i(7);t.exports=function(){let t=null,e=null,i=null,p=null,g=null,f=null,m=null,v=null,E=null;const _=()=>{m=new u,p=new h,i=new d,t=new a,e=new s,g=new r,f=new o,v=new l,m.init(),i.init(),p.init(),v.init(),t.init(),e.init(),g.init(),f.init(),b()},b=()=>{E={};let t=n.CHANNEL;for(let e in t)E[e]={}},w=()=>{let t=[];for(let e in E){let i=E[e];for(let e in i)t.push(i[e])}return t},C=(t,e,i)=>{E[i][e]=t};this.init=()=>{_(),v.setChannel(n.CHANNEL.GLOBAL)},this.getChatConfig=()=>t,this.getChatWindow=()=>v,this.getChatDataUpdater=()=>m,this.getChatInputWrapper=()=>e,this.getChatMessageWrapper=()=>f,this.getChatChannelCardWrapper=()=>g,this.getChatChannelsAvailable=()=>i,this.getChatPrivateMessageData=()=>p,this.addMessage=t=>{if(null==t.id)return void errorReport("ChatController.js","addMessage","Chat message id == undefined !");let e=t.id,i=t.channel,n=new c;t.receiverBusinessCard&&t.authorBusinessCard&&t.authorBusinessCard.getNick()!=getEngine().hero.d.nick&&p.addReceiveMessageUser(t.authorBusinessCard.getNick()),t.receiverBusinessCard&&t.authorBusinessCard&&t.authorBusinessCard.getNick()==getEngine().hero.d.nick&&p.addSendMessageUser(t.receiverBusinessCard.getNick()),C(n,e,i),t.town||getEngine().chatController.getChatMessageWrapper().manageChatWidgetAmountAfterAddMessage(),n.init(t),n.updateMessage(),n.appendMessageToChannel(!getEngine().allInit)},this.rebuiltMessage=()=>{f.clearAllMessageWrapperChannel(),t.updateSectionsVisible(),t.updateChannelsColor(),t.updateMessagesAddToGeneral(),e.updateMenu();let i=getEngine().chatController.getChatDataUpdater(),n=w(),a=i.getArchivedMessage(),s=i.sortMessage({mergeMessage:n,mergeArchivedMessage:a});for(let t in s)s[t].isCodeMessage(),s[t].isCodeMessage()||(s[t].updateMessage(),s[t].appendMessageToChannel(!0));f.updateScroll()},this.checkMessageExist=(t,e)=>!!E[e][t],this.addToMessageList=C,this.clearMessageList=t=>{E[t]={}},this.chatLang=(t,e)=>_t(t,e||null,"chat_lang"),this.getMessageList=()=>E}},function(t,e,i){var n=i(9),a=i(7);t.exports=function(){let t="ChatConfig.js",e=null,i=null,s=null,r={};const o=()=>{e={};for(let t in n.MESSAGES_ADD_TO_GENERAL){let i=n.MESSAGES_ADD_TO_GENERAL[t],a=copyStructure(i);e[t]=a;for(let e in a){let i=d(n.STATIC_KEYS.MESSAGES_ADD_TO_GENERAL,t,e);null!==i&&(a[e]=i)}}},l=()=>{i={};for(let t in n.MESSAGE_SECTIONS_VISIBLE){let e=n.MESSAGE_SECTIONS_VISIBLE[t],a=copyStructure(e);i[t]=a;for(let e in a){let i=d(t,e);null!==i&&(a[e]=i)}}},c=()=>{s={};const t=n.MESSAGES_COLORS_OPT.EDIT_COLOR,e=n.MESSAGES_COLORS,i=n.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,a=n.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR;for(let r in e){let o=n.INPUT_CHANNEL_HEADER[r];s[r]||(s[r]={[t]:{[i]:null,[a]:null}});let l=s[r][t];l[i]=o[i],l[a]=o[a];let c=null,h=null;if(e[r][t].saveApart)c=d(n.STATIC_KEYS.MESSAGES_COLORS,r,t,i),h=d(n.STATIC_KEYS.MESSAGES_COLORS,r,t,a);else{let e=d(n.STATIC_KEYS.MESSAGES_COLORS,r,t,i);c=e,h=e}null!==c&&(l[i]=c),null!==h&&(l[a]=h)}},d=(t,e,i,n)=>isset(r[t])&&isset(r[t][e])?isset(i)?isset(r[t][e][i])?isset(n)?isset(r[t][e][i][n])?r[t][e][i][n]:null:r[t][e][i]:null:r[t][e]:null;this.init=()=>{o(),l(),c()},this.setStorageData=(t,e)=>{let i=t[0],n=t[1],a=isset(t[2])?t[2]:null,s=isset(t[3])?t[3]:null;r[i]||(r[i]={}),null==a?r[i][n]=e:(r[i][n]||(r[i][n]={}),null==s?r[i][n][a]=e:(r[i][n][a]||(r[i][n][a]={}),r[i][n][a][s]=e))},this.getStorageData=d,this.allStorageData=()=>r,this.getMessageSectionData=(e,a)=>{const s="getMessageSectionData";return isset(n.MESSAGE_SECTIONS_VISIBLE[e])?isset(n.MESSAGE_SECTIONS_VISIBLE[e][a])?i[e][a]:(errorReport(t,s,`SUB_SECTION: ${a} not exist!`,n.MESSAGE_SECTIONS_VISIBLE[e][a]),!1):(errorReport(t,s,`SECTION: ${e} not exist!`,n.MESSAGE_SECTIONS_VISIBLE),!1)},this.getMessagesAddToGeneralData=(i,a)=>{if(i==n.CHANNEL.GENERAL)return!0;const s="getColorMessageData";return isset(n.MESSAGES_ADD_TO_GENERAL[i])?isset(n.MESSAGES_ADD_TO_GENERAL_OPT[a])?e[i][a]:(errorReport(t,s,`OPT: ${a} not exist!`,n.MESSAGES_ADD_TO_GENERAL_OPT),!1):(errorReport(t,s,`SECTION: ${i} not exist!`,n.MESSAGES_ADD_TO_GENERAL[i]),!1)},this.getColorMessageData=(e,i,a)=>{const r="getColorMessageData",o=n.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,l=n.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR;return isset(n.MESSAGES_COLORS[e])?isset(n.MESSAGES_COLORS_OPT[i])?[o,l].includes(a)?s[e][i][a]:(errorReport(t,r,`only available kindMessageColor: is ${o}} or ${l}!`,a),!1):(errorReport(t,r,`OPT: ${i} not exist!`,n.MESSAGES_COLORS_OPT),!1):(errorReport(t,r,`SECTION: ${e} not exist!`,n.MESSAGES_COLORS),!1)},this.saveInServerStorageChatConfigStorage=()=>{const t=a.CHAT,e=n.SERVER_STORAGE.DATA;getEngine().serverStorage.sendData({[t]:{[e]:r}})},this.getDataFromServerStorageAndSetStorageData=e=>{(e=>{if(!elementIsObject(e))return errorReport(t,"checkDataFromServerStorageIsCorrect","Chat serverStorageData have to be obj!",e),!1;const i="checkDataFromServerStorageIsCorrect";let a=n.MESSAGE_SECTIONS.CHANNEL_TAG,s=n.MESSAGE_SECTIONS.EMO_ICON,r=n.STATIC_KEYS.MESSAGES_ADD_TO_GENERAL,o=n.STATIC_KEYS.MESSAGES_COLORS,l=n.MESSAGE_SECTIONS.TS;if(e[a]&&elementIsObject(e[a])){let s=e[a],r=n.MESSAGE_SUB_SECTIONS.ALL_TAG;if(isset(s[r])){let n=s[r];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.${r} have to be bool value!`,e),!1}}if(e[s]&&elementIsObject(e[s])){let a=e[s],r=n.MESSAGE_SUB_SECTIONS.DISPLAY;if(isset(a[r])){let n=a[r];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.${r} have to be bool value!`,e),!1}}if(e[r]&&elementIsObject(e[r])){let a=n.MESSAGES_ADD_TO_GENERAL_OPT.ADD,s=e[r];for(let o in s){if(!n.CHANNEL[o])return errorReport(t,i,`Chat serverStorageData data.${r} Channel not exist!`,e),!1;let l=s[o];if(!elementIsObject(l))return errorReport(t,i,`Chat serverStorageData data.${r} Channel data have to object!`,e),!1;if(isset(l[a])){let n=l[a];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.[channel]${a} have to bool data!`,e),!1}}}if(e[o]&&elementIsObject(e[o])){let a=n.MESSAGES_COLORS_OPT.EDIT_COLOR,s=e[o];for(let r in s){if(!n.CHANNEL[r])return errorReport(t,i,`Chat serverStorageData data.${o} Channel not exist!`,e),!1;let l=s[r];if(!elementIsObject(l))return errorReport(t,i,`Chat serverStorageData data.${o} Channel data have to object!`,e),!1;if(isset(l[a])&&!elementIsObject(l[a]))return errorReport(t,i,`Chat serverStorageData data.${o} EDIT_COLOR must be obj!`,e),!1}}if(e[l]&&elementIsObject(e[l])){let a=n.MESSAGE_SUB_SECTIONS.DISPLAY,s=n.MESSAGE_SUB_SECTIONS.ALL_UNIT,r=n.MESSAGE_SUB_SECTIONS.TWELVE_HOUR,o=e[l];if(isset(o[a])){let n=o[a];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.${a} have to bool data!`,e),!1}if(isset(o[s])){let n=o[s];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.${s} have to bool data!`,e),!1}if(isset(o[r])){let n=o[r];if(!isBooleanWithWarning(n))return errorReport(t,i,`Chat serverStorageData data.${r} have to bool data!`,e),!1}}return!0})(e)&&(r=e)},this.getChannelColor=(t,e)=>{const i=n.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,a=n.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR;let r=e?i:a,o=n.MESSAGES_COLORS_OPT.EDIT_COLOR;return s[t][o][r]},this.updateSectionsVisible=l,this.updateMessagesAddToGeneral=o,this.updateChannelsColor=c}},function(t,e,i){const n=i(0);var a=i(9),s=i(381),r=i(382),o=i(383),l=i(384);t.exports=function(){let t=a.CHANNEL.GLOBAL,e=null,i=null,c=null,d=null,h=null,u=null,p=null,g=null,f=null;const m=()=>{if(!mobileCheck())return;let t=e.find(".magic-input-wrapper").find(".type-mobile-message");t.css("display","block"),t.click(()=>{et()})},v=()=>{let t;i=$("<div>").addClass("clear-cross"),i.tip(_t("reset",null,"ah_filter_history")),i.on("click",()=>{P(!1),c.setInput("")}),t=mobileCheck()?getEngine().interface.get$gameWindowPositioner().find(".chat-layer").find(".magic-input-wrapper"):e.find(".magic-input-wrapper"),t.append(i)},E=()=>{Z(null)},_=()=>{let t=$("<div>").addClass("chat-config-wrapper-button");t.on("click",(function(){g?w():b()})),t.tip(getEngine().chatController.chatLang("config_button")),e.find(".chat-config-wrapper").append(t)},b=()=>{g=new l,g.init()},w=()=>{g.closeWindow(),C()},C=()=>{g=null},T=()=>{const t=a.KIND_MESSAGE_COLOR.HERO_MSG_COLOR;let i=getEngine().chatController.getChatConfig().getColorMessageData(a.CHANNEL.PRIVATE,a.MESSAGES_COLORS_OPT.EDIT_COLOR,t);e.find(".private-nick").css("color",i)},y=()=>{let t=e.find(".card-remove");t.on("click",()=>{let t=getEngine().chatController.getChatChannelCardWrapper().getActiveChannelName(),e=a.INPUT_CHANNEL_HEADER[t].inputWrapper,i=a.INPUT_CHANNEL_HEADER[e];O(i)}),t.tip(_t("reset",null,"ah_filter_history"))},I=()=>{e.find(".card-name").on("click",t=>{t.stopPropagation(),X()}),A()},A=t=>{let i=a.INPUT_CHANNEL_HEADER,n=e.find(".card-list");t&&n.empty();for(let t in i)k(i[t],n);t||$("body").on("click",(function(t){N()&&z()}))},k=(t,e)=>{if(!t.menu)return;const i=a.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,n=a.MESSAGES_COLORS_OPT.EDIT_COLOR;let s=t.name,r=t.short[_l()],o=getEngine().chatController.getChatConfig().getColorMessageData(s,n,i),l=$("<div>").addClass("input-channel-item").html(getEngine().chatController.chatLang(t.name.toLowerCase())+" /"+r);l.css("color",o),S(l,t),e.append(l,t)},S=(t,e)=>{t.on("click",(function(){O(e)}))},O=(i,n,s,r)=>{const o=a.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,l=a.MESSAGES_COLORS_OPT.EDIT_COLOR;let d=i.name,g=getEngine().chatController.getChatConfig().getColorMessageData(d,l,o);(r||getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(d))&&(u=n||null,p=s||null,t=d,q(d),M(g),(()=>{let i,n=getEngine().chatController.getChatChannelCardWrapper().getActiveChannelName(),s=a.INPUT_CHANNEL_HEADER[n].inputWrapper;i=s==a.INPUT_CHANNEL_HEADER[n].name?n==t?"none":"inline-block":t==s?"none":"inline-block",e.find(".card-remove").css("display",i)})(),K(u),Y(p),h.setVisible(t),c.setColorInput(g))},M=t=>{e.find(".card-name").css("color",t)},N=()=>"none"!=e.find(".card-list").css("display"),R=()=>{d=new r,d.init(e.find(".chat-notification-wrapper"))},x=()=>{h=new o,h.init()},L=()=>{let t;c=new s;let i=mobileCheck(),n=getEngine().interface.get$gameWindowPositioner().find(".chat-layer");i?(t=n.find(".mobile-magic-input-wrapper"),(()=>{let t=createButton(_t("send_message",null,"chat"),["small","green"],()=>{W(J())});getEngine().interface.get$gameWindowPositioner().find(".chat-layer").find(".send-mobile-message-wrapper").append($(t))})()):t=e.find(".magic-input-wrapper"),c.init(t,a.INPUT_REGEXP,a.CHANNEL_INPUT_DATA,_t("enter_to_chat",null,"chat"),W,D)},D=t=>{getEngine().chatController.getChatMessageWrapper().updateScroll(),P(!t)},P=t=>{let e=i.css("display");"none"==e&&t?i.css("display","block"):"block"!=e||t||i.css("display","none")},B=(t,e)=>!!(t=>"/cls"==t)(t)||(!!(t=>"/clsall"==t)(t)||(!!(t=>new RegExp("^/lvl(\\s{1}|&nbsp;)([A-Za-z_]+)","g").exec(t))(t)||!(e||!(t=>new RegExp("^/dice(\\s{1}|&nbsp;)([0-9]+)","g").exec(t))(t)))),F=t=>{let e=H();G(e.channelRequest,e.reciverRequest,e.styleRequest,t)},W=(t,e)=>{if(!V(t))return;let i=getEngine().chatLinkedItemsManager;if(i.checkSendMessageIsItemLinked(t)){if(t=i.getReplacedStrWithoutWorldWhereHeroStay(t),!i.checkLinkedItemsAreOnlyFromWorldWhereHeroStay(t))return(t=>{let e=_t("item_from_another_world");confirmWithCallback({msg:e,clb:()=>{F(t),tt()}})})(t),void it()}mobileCheck()&&getEngine().chatController.getChatWindow().setVisibleMobileView(!1),F(t),e||tt()},H=()=>{let e=getEngine().chatController.getChatDataUpdater().getServerChannelNameByChannelName(t);return{serverChannelName:e,reciverRequest:u?"&receiver="+u.replaceAll(" ","_"):"",styleRequest:p?"&style="+p:"",channelRequest:"&channel="+e}},G=(t,e,i,n)=>{_g("chat"+t+e+i,!1,{c:n})},V=e=>""!=e&&(""!=e.trim()&&((t=>!B(t)&&"/"==t[0])(e)?(message(_t("4501002_EChatBroadcastError_InvalidCharacters",null,"MessageController")),!1):t!=a.CHANNEL.PRIVATE||null!=u||B(e)?t!=a.CHANNEL.SYSTEM||B(e)?h.checkBlockadeLeftSeconds(t)&&!B(e,!0)?(message(getEngine().chatController.chatLang("toFastMessageSendOn")+getEngine().chatController.chatLang(t.toLocaleLowerCase())),!1):!u||u.toLocaleLowerCase()!=getEngine().hero.d.nick.toLocaleLowerCase()||(message(_t("can_not_send_message_to_yourself")),!1):(message(getEngine().chatController.chatLang("can_not_send_msg_on_system")),!1):(message(getEngine().chatController.chatLang("private_reciver_not_exist")),!1))),U=()=>{e=n.get("chat-input-wrapper")},j=()=>{getEngine().chatController.getChatWindow().get$chatWindow().find(".chat-input-wrapper").replaceWith(e)},q=t=>{e.find(".card-name").html(getEngine().chatController.chatLang(t.toLowerCase()))},K=t=>{e.find(".private-nick").html(t?t.replaceAll("_"," "):"")},Y=t=>{e.find(".style-message").html(t||"")},z=()=>{e.find(".card-list").css("display","none")},X=()=>{N()?z():e.find(".card-list").css("display","block")},Q=()=>c.getFullInputVal(),J=()=>c.getEscapeFullInputVal(),Z=t=>{f=t},tt=()=>{c.clearMagicInput()},et=()=>{mobileCheck()&&getEngine().chatController.getChatWindow().setVisibleMobileView(!0),c.focus()},it=()=>{mobileCheck()&&getEngine().chatController.getChatWindow().setVisibleMobileView(!1),c.blur()},nt=t=>{c.setInput(t)},at=(t,e)=>{let i=Q(),n=null;if(""==i)n=t;else{n=" "==i[i.length-1]?i+t:i+" "+t}nt(n),e&&c.setCaretOnTheEndOfInput()};this.init=()=>{E(),U(),L(),x(),R(),T(),j(),I(),y(),_(),v(),m()},this.setChannel=O,this.clearInput=tt,this.focus=et,this.setBlockNearOnEnterUp=()=>{c.setBlockNearOnEnterUp(!0)},this.blur=it,this.isFocus=()=>{c.isFocus()},this.setInput=nt,this.addToInput=at,this.setPrivateMessageProcedure=t=>{et(),O(a.INPUT_CHANNEL_HEADER.PRIVATE,t),c.setCaretOnTheEndOfInput()},this.getVal=Q,this.getChannelName=()=>t,this.getPrivateReceiver=()=>u,this.getStyleMessage=()=>p,this.clearChatConfigureWindow=C,this.getChatNotificationManager=()=>h,this.getChatNotificationView=()=>d,this.getDataAndSendRequest=F,this.setLinkedItem=t=>{let e=`ITEM#${t} `;mobileCheck()?(getEngine().chatController.getChatWindow().setVisibleMobileView(!0),at(e,!0)):at(e,!0)},this.sendMessageGhostMessageProcedure=(e,i)=>{let n=t;O(a.INPUT_CHANNEL_HEADER[i]),W(e,!0),O(a.INPUT_CHANNEL_HEADER[n])},this.updateMenu=()=>{A(!0),T();let e=a.INPUT_CHANNEL_HEADER[t];O(e)}}},function(t,e){t.exports=function(){let t=null,e=null,i=null,n="",a=null,s={},r={},o=null,l=null,c=null,d=null,h=null;const u=t=>{e=$("<div>").addClass("magic-input-placeholder"),e.html(t)},p=t=>{let i=e.css("display"),n=t?"block":"none";if(t){if("block"==i)return}else if("none"==i)return;e.css("display",n)},g=()=>{i.append(e),i.append(t)},f=t=>{d=t},m=t=>{c=t},v=t=>{o=t},E=t=>{l=t},_=()=>{for(let t in o)s[t]={}},b=()=>{for(let t in l)r[t]={}},w=()=>{t=$("<MAGIC_INPUT>").addClass("magic-input"),t.attr("contenteditable","true"),t.html("")},C=()=>{i=$("<div>").addClass("magic-input-wrapper")},T=t=>{t.replaceWith(i)},y=()=>{t.on("click",(function(){I()}))},I=()=>{t.find(".linked-item").each((function(){nt($(this))}))},A=()=>{t.on("keydown",(function(t){"Enter"==t.originalEvent.key&&(t.preventDefault(),""==ut()&&lt()&&ot()),a=it()}))},k=()=>{t[0].addEventListener("input",(function(t){M()}))},S=t=>t.replace(/(?=\s)[^\r\n\t]/g," "),O=()=>{t.on("keyup",(function(t){if(L(),"Enter"==t.originalEvent.key){if(h)return void pt(!1);let t=ut();return t=S(t),void c(t)}"Escape"!=t.originalEvent.key?M():ot()}))},M=()=>{let e=""==t.html();p(e),d(e)},N=()=>t[0].innerHTML,R=e=>t.html(e),x=t=>{n=t},L=()=>{if(at())return;let e=U();if(e.shouldUpdate){let i=it(),n=P(i,e.data);R(n.html),x(n.html),tt(t[0],n.nodeIndex,n.pos),a=i}if(!isFirefoxBrowser())for(let t in o){let e=N(),i=it();e=D(e),K(e,o[t],i)}for(let t in l){let e=N();q(e,l[t])}},D=t=>t.replace(/&amp;/g,"&"),P=(e,i)=>{let n=e.baseOffset,a=e.childNodeIndex,s=[],r="";i.length!=t[0].childNodes.length&&warningReport("MagicInput3","getPosAndNodeIndexAfterChildNodesUpdate","possible caret bug, data.length != $magicInput[0].childNodes");for(let t=0;t<i.length;t++){let e=i[t];e.toRemoveStyle&&(a==t&&(n=e.innerText.length),e.isText=!0,e.outerHTML=null,e.toRemoveStyle=!1)}let o=null,l=0;for(let t=0;t<i.length;t++){let e=i[t];if(null!=o)if(o&&e.isText){let i=s.length-1,r=s[i].innerText.length;s[i].innerText+=e.innerText,t<=a+l&&(t==a+l&&(n+=r),a--,l++)}else o=e.isText,s.push(e);else s.push(e),o=e.isText}for(let t in s){let e=s[t];r+=e.parseSpan?e.outerHTML:e.innerText}return n--,{html:r,pos:n,nodeIndex:a}},B=(t,e)=>null==e?t:e,F=(t,e,i)=>{let n=[],a=!1,s=t.length;for(let r=0;r<s;r++){let s=t[r];if(!isFirefoxBrowser()||!dt(s))if("#text"==s.nodeName){let t=H(B(r,i),s.textContent,e);n.push(t)}else{if(j(s,"parse-span")){let t=G(B(r,i),s.innerText,s.outerHTML,e);n.push(t)}else{let t=s.childNodes;if(t.length){let e=F(t,!0,B(r,i));W(n,e.data)}else{let t=V(B(r,i),s.innerText,s.outerHTML,e);n.push(t)}a=!0}}}return{data:n,shouldUpdate:a}},W=(t,e)=>{for(let i in e)t.push(e[i])},H=(t,e,i)=>({isText:!0,innerText:e,outerHTML:null,toRemoveStyle:!1,deep:i,parentChildIndex:t}),G=(t,e,i,n)=>({isText:!1,parseSpan:!0,innerText:e,outerHTML:i,toRemoveStyle:!1,deep:n,parentChildIndex:t}),V=(t,e,i,n)=>({isText:!1,parseSpan:!1,innerText:e,outerHTML:i,toRemoveStyle:!0,deep:n,parentChildIndex:t}),U=()=>{let e=t[0].childNodes;if(0==e.length)return{data:[],shouldUpdate:!1};let i=F(e,!1,null),n=i.data,a=i.shouldUpdate,s=null;for(let t=0;t<n.length;t++){let e=n[t];if(null!=s){if(s&&e.isText){a=!0;break}s=e.isText}else s=e.isText}let r=[];for(let t=0;t<n.length;t++){let e=copyStructure(n[t]);if(e.deep)if(r[e.parentChildIndex]){let t=r[r.length-1];t.toRemoveStyle=!0,t.innerText+=e.innerText}else e.toRemoveStyle=!0,r.push(e);else r.push(e)}return{data:r,shouldUpdate:a}},j=(t,e)=>t.classList.contains(e),q=(e,i)=>{let n=i.getPattern().exec(e);if(n){i?i.callback(n[1]):i.callback(),e=e.replace(i.getPattern(),""),t.html(e);let a=t[0].childNodes.length;tt(t[0],a-1,-1),x(e)}},K=(e,i,n)=>{let a=i.tag;((t,e)=>{for(let i in s[e]){let n=e+"_"+i;t.indexOf(n)<0&&delete s[e][i]}})(e,i.tag);let r=i.getPattern().exec(e);if(r){let o=Q(e,i,r,n),l=o.itemsToAdd;for(let t in l)s[a][t]=l[t];e=o.html,t.html(e),tt(t[0],o.childNodeIndex,o.caretPos),x(e)}},Y=(t,e)=>{let i=e.tag,n=(t=>{let e=0;if(!lengthObject(s[t]))return 0;for(let i in s[t]){let t=parseInt(i);t>e&&(e=t)}return e+1})(i),a=getEngine().chatLinkedItemsManager.changeStringOn(t,e.getPattern(),i,n),r=a.itemsData,o={};for(let t in r)for(let n in a.htmlString){let s=a.htmlString[n],l=r[t].replace("&nbsp;"," ");s==i+"_"+t&&(o[t]=l,a.htmlString[n]=X(s,t,e,z(l)))}return{html:a.htmlString.join(""),itemsToAdd:o}},z=t=>{let e={data:t.split("")};return JSON.stringify(e)},X=(t,e,i,n)=>{let a=`<img tag-data="${i.tag}" tag-and-index-data="${t}" tag-index-data="${e}" item-data-helper='${n}' `;return i.spanClass?a+='class="parse-span"':a+=`class="parse-span ${i.spanClass}"`,i.getSrc&&(a+=`src="${i.getSrc()}"`),i.style&&(a+=`style="${i.style}"`),a+=">&nbsp;",a},Q=(t,e,i,n)=>{let a=Y(t,e),s=a.itemsToAdd;t=a.html;let r=J(s,i,n),o=r.childNodeIndex;return{html:t,caretPos:r.caretPos,childNodeIndex:o,itemsToAdd:s}},J=(t,e,i)=>{let n=null,s=null,r=lengthObject(t);if(null==i.childNodeIndex||0==i.childNodeIndex)i.baseOffset==e[0].length?(n=2*r-1,s=i.baseOffset==i.baseNodeLength?-1:0):(n=0==e.index?2*r-1:2*r,s=i.baseOffset!=i.baseNodeLength&&e.index>0?0:-1);else{n=a.childNodeIndex;for(let e in t){n+=t[e].replaceAll("&nbsp;"," ").length==a.baseNode.length?1:2}s=a.baseOffset==a.baseNodeLength?-1:0}return{caretPos:s,childNodeIndex:n}},Z=e=>{if(e==t[0])return 0;let i=et(e);if(null==i)return null;let n=t[0].childNodes;for(let t=0;t<n.length;t++)if(n[t]==i)return t;return null},tt=(t,e,i)=>{let n=document.createRange(),a=window.getSelection();if(null==e&&(errorReport("MagicInput.js","setCaret","childNodeIndex = null!"),e=0),!t.childNodes.length)return;t.childNodes[e]||(errorReport("MagicInput.js","setCaret","childNodes with childNodeIndex:"+e+" not exist!"),e=t.childNodes.length-1);let s=t.childNodes[e].length;(i=-2==(i=-1==i?s-1:i)?-1:i)>=s?errorReport("MagicInput.js","setCaret","Pos is bigger than childNodeLength"):(n.setStart(t.childNodes[e],i+1),n.collapse(!0),a.removeAllRanges(),a.addRange(n))},et=e=>{let i=0;if(t[0]==e)return e;let n=e;for(;n.parentNode!=t[0];){if(10==i)return null;n=n.parentNode,i++}return n},it=()=>{let t=window.getSelection(),e=t.anchorNode;if(et(e)){let e=Z(t.anchorNode);return{baseNode:t.focusNode,baseNodeLength:null!=t.focusNode?t.focusNode.length:null,baseOffset:t.baseOffset,extentNode:t.extentNode,extentOffset:t.extentOffset,childNodeIndex:e}}return errorReport("MagicInput","getCaretData","null"),null},nt=t=>{t.css("background","none")},at=()=>n==N(),st=()=>{t.css({"outline-width":0,display:"block","box-shadow":"inset 0px 0px 3px 3px black","font-size":13,"max-height":"60vh",overflow:"hidden"}),e.css({color:"#787878",position:"absolute",top:5,left:6,"pointer-events":"none"})},rt=()=>{t.focus()},ot=()=>{t.blur()},lt=()=>t.is(":focus"),ct=e=>{rt(),a=it(),R(e),L(),p(""==t.html())};isTextNode=t=>"#text"==t.nodeName;const dt=t=>"BR"==t.nodeName,ht=(t,e)=>{let i=t.attributes;for(let t in i)if(i[t].name==e)return i[t].textContent;return errorReport("MagicInput","getInputDataAtrr",e+" attr not exist!",i),null},ut=()=>{let e=t[0].childNodes,i=e.length,n="";for(let t=0;t<i;t++){let i=e[t];if(isTextNode(i)){n+=i.textContent;continue}if(isFirefoxBrowser()&&dt(i))continue;let a=ht(i,"tag-data"),r=ht(i,"item-data-helper");if(!a)return"";let o=ht(i,"tag-index-data");if(!o)return"";if(s[a]&&s[a][o])n+=s[a][o];else if(r){let t=JSON.parse(r).data.join("");n+=t,errorReport("MagicInput.js","getFullInputVal","Take data from item-data-helper attr...",t)}else{if(!s[a])return errorReport("MagicInput.js","getFullInputVal","inputData."+a+" not exist!",s),"";if(!s[a][o])return errorReport("MagicInput.js","getFullInputVal","inputData."+a+"["+o+"] not exist!",s),""}}return n},pt=t=>{h=t};this.init=function(t,e,i,n,a,s){pt(!1),v(e),E(i),m(a),f(s),_(),b(),w(),u(n),C(),st(),g(),T(t),k(),A(),O(),y()},this.addToInput=t=>{ct(n+t)},this.setCaretOnTheEndOfInput=()=>{let e=t[0].childNodes.length;tt(t[0],e-1,-1)},this.isFocus=lt,this.focus=rt,this.blur=ot,this.clearMagicInput=()=>{x(""),R(""),ot(),M()},this.setInput=ct,this.setColorInput=e=>{t.css({"caret-color":e,color:e})},this.getFullInputVal=ut,this.getEscapeFullInputVal=()=>S(ut()),this.setBlockNearOnEnterUp=pt}},function(t,e,i){var n=i(0),a=i(9);t.exports=function(){let t=null;const e=e=>{e.replaceWith(t)},i=()=>{let t=a.NOTIFICATION;for(let e in t){let t=s(e);r(t)}},s=t=>{let e=$("<div>").addClass("chat-notification chat-notification-"+t);return e.tip("chat-notification-"+t),e},r=e=>{t.append(e)},o=()=>{t=n.get("chat-notification-wrapper")},l=e=>{t.find(".chat-notification-"+e).css("display","none")};this.init=t=>{o(),i(),e(t);for(let t in a.NOTIFICATION)l(t)},this.turnOnNotification=(e,i)=>{let n=t.find(".chat-notification-"+e);n.css("display","inline-block"),i&&n.tip(i)},this.turnOffNotification=l}},function(t,e,i){var n=i(9);t.exports=function(){let t=null,e=null;const i=()=>{t={[n.CHANNEL.GLOBAL]:null,[n.CHANNEL.LOCAL]:null,[n.CHANNEL.TRADE]:null,[n.CHANNEL.GROUP]:null,[n.CHANNEL.CLAN]:null,[n.CHANNEL.PRIVATE]:null}},a=()=>{e={[n.CHANNEL.GLOBAL]:null,[n.CHANNEL.LOCAL]:null,[n.CHANNEL.TRADE]:null,[n.CHANNEL.GROUP]:null,[n.CHANNEL.CLAN]:null,[n.CHANNEL.PRIVATE]:null}},s=(e,i,n,a)=>{let s=ts()+1e3*i;t[e]=setInterval((function(){n&&n(),ts()<s||a&&(a(e),c(e))}),1e3)},r=(t,i,n,a)=>{let s=ts()+1e3*i;e[t]=setInterval((function(){n&&n(),ts()<s||a&&(d(t),a(t))}),1e3)},o=e=>!!t[e],l=t=>!!e[t],c=e=>{clearInterval(t[e]),t[e]=null},d=t=>{clearInterval(e[t]),e[t]=null};this.init=()=>{i(),a()},this.setBlockadeLeftSeconds=(t,e,i,n,a)=>{o(t)&&c(t),i&&i(t),s(t,e,n,a)},this.setMuteLeftSeconds=(t,e,i,n,a)=>{l(t)&&d(t),i&&i(t),n&&n(t),r(t,e,n,a)},this.checkBlockadeLeftSeconds=o,this.setVisible=t=>{let e=getEngine().chatController.getChatInputWrapper().getChatNotificationView(),i=n.NOTIFICATION.WATCH,a=[n.NOTIFICATION.MUTE,i],s=[l,o];for(let i in a){let n=a[i];s[i](t)?e.turnOnNotification(n):e.turnOffNotification(n)}}}},function(t,e,i){const n=i(0);var a=i(9);const s=i(121),r=i(77);t.exports=function(){let t=null,e=null;const i=()=>{e.find(".scroll-wrapper").addScrollBar({track:!0})},o=()=>{$(".scroll-wrapper",e).trigger("update")},l=()=>{let e=t.$.find(".default-colors-wrapper"),i=createButton(_t("default-chat-colors"),["small","green"],(function(){d()}));e.append($(i))},c=()=>{let e=t.$.find(".color-configuration").empty();const i=a.MESSAGES_COLORS,n=a.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,s=a.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR,r=a.MESSAGES_COLORS_OPT.EDIT_COLOR,o=getEngine().chatController.getChatConfig();for(let t in i){let i=a.MESSAGES_COLORS[t].EDIT_COLOR;if(i.edit)if(i.saveApart){let i=o.getColorMessageData(t,r,n),a=o.getColorMessageData(t,r,s);u(e,t,i,[n],n),u(e,t,a,[s],s)}else{let i=o.getColorMessageData(t,r,n);u(e,t,i,[n,s])}}},d=()=>{h(),getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage(),c()},h=()=>{const t=a.MESSAGES_COLORS,e=a.STATIC_KEYS.MESSAGES_COLORS,i=a.KIND_MESSAGE_COLOR.HERO_MSG_COLOR,n=a.KIND_MESSAGE_COLOR.OTHER_MSG_COLOR,s=a.MESSAGES_COLORS_OPT.EDIT_COLOR,r=a.INPUT_CHANNEL_HEADER,o=getEngine().chatController.getChatConfig();for(let a in t){let l=t[a][s].saveApart,c=r[a];if(l){let t=c[i],r=c[n];o.setStorageData([e,a,s,i],t),o.setStorageData([e,a,s,n],r)}else{let t=c[i];o.setStorageData([e,a,s,i],t)}}},u=(t,e,i,n,s)=>{let o=_t(e.toLowerCase(),null,"chat_lang")+(s?" "+_t(s):""),l=new r,c=$("<div>").addClass("oneColorRow");l.init(),l.updateData(c,i,null,(function(t){for(let i=0;i<n.length;i++){let s=n[i];getEngine().chatController.getChatConfig().setStorageData([a.STATIC_KEYS.MESSAGES_COLORS,e,a.MESSAGES_COLORS_OPT.EDIT_COLOR,s],t)}getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()})),c.append($("<div>").addClass("color-name").html(o)),l.get$colorPicker().css("display","inline-block"),t.append(c)},p=()=>{e=n.get("chat-configure-window"),t=getEngine().windowManager.add({content:e,title:getEngine().chatController.chatLang("chat_options"),nameWindow:getEngine().windowsData.name.CHAT_CONFIGURE,onclose:()=>{C(),getEngine().chatController.getChatInputWrapper().clearChatConfigureWindow()}}),t.addToAlertLayer()},g=()=>{let e=t.$.find(".time-configuration").empty(),i=getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.TS,a.MESSAGE_SUB_SECTIONS.TWELVE_HOUR),n={radios:[{value:1,label:"12h",selected:i},{value:0,label:"24h",selected:!i}],name:a.MESSAGE_SUB_SECTIONS.TWELVE_HOUR,onSelected:_},r=getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.TS,a.MESSAGE_SUB_SECTIONS.ALL_UNIT),o={radios:[{value:0,label:"hh:mm",selected:!r},{value:1,label:"hh:mm:ss",selected:r}],name:a.MESSAGE_SUB_SECTIONS.ALL_UNIT,onSelected:_};const l=new s.default(n,{isInline:!0,label:getEngine().chatController.chatLang("time_format")}).getList(),c=new s.default(o,{isInline:!0,label:getEngine().chatController.chatLang("hour_format")}).getList();let d=createCheckBox(getEngine().chatController.chatLang("show_time"),"",(function(t){getEngine().chatController.getChatConfig().setStorageData([a.MESSAGE_SECTIONS.TS,a.MESSAGE_SUB_SECTIONS.DISPLAY],t),t?(l.classList.add("active-section"),c.classList.add("active-section")):(l.classList.remove("active-section"),c.classList.remove("active-section")),getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()}));getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.TS,a.MESSAGE_SUB_SECTIONS.DISPLAY)&&(d.find(".checkbox").addClass("active"),l.classList.add("active-section"),c.classList.add("active-section")),e.append(d),e[0].appendChild(l),e[0].appendChild(c)},f=()=>{let e=t.$.find(".tag-configuration").empty(),i=getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.CHANNEL_TAG,a.MESSAGE_SUB_SECTIONS.ALL_TAG),r={radios:[{value:1,label:_t("full_channel_tag",null,"chat_lang"),selected:i},{value:0,label:_t("shot_channel_tag",null,"chat_lang"),selected:!i}],name:a.MESSAGE_SUB_SECTIONS.ALL_TAG,onSelected:_};const o=_t("tag_format",null,"chat_lang"),l=$("<div>").addClass("small-icon-wrapper").append(n.get("info-icon").addClass("small-info").tip(_t("tag_format_tip",null,"chat_lang"))),c=new s.default(r,{isInline:!0,label:o,elementAfterLabel:l[0]}).getList(),d=createCheckBox(_t("tag_show_options",null,"chat_lang"),"",(function(t){getEngine().chatController.getChatConfig().setStorageData([a.MESSAGE_SECTIONS.CHANNEL_TAG,a.MESSAGE_SUB_SECTIONS.DISPLAY],t),t?c.classList.add("active-section"):c.classList.remove("active-section"),getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()}));getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.CHANNEL_TAG,a.MESSAGE_SUB_SECTIONS.DISPLAY)&&(d.find(".checkbox").addClass("active"),c.classList.add("active-section")),e.append(d),e[0].appendChild(c)},m=()=>{const e=t.$.find(".emo-configuration").empty(),i=createCheckBox(getEngine().chatController.chatLang("show_emo_icons"),"",(function(t){getEngine().chatController.getChatConfig().setStorageData([a.MESSAGE_SECTIONS.EMO_ICON,a.MESSAGE_SUB_SECTIONS.DISPLAY],t),getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()}));getEngine().chatController.getChatConfig().getMessageSectionData(a.MESSAGE_SECTIONS.EMO_ICON,a.MESSAGE_SUB_SECTIONS.DISPLAY)&&i.find(".checkbox").addClass("active"),e.append(i)},v=()=>{const e=getEngine().settings,i=t.$.find(".enemy-msg-configuration").empty(),n=createCheckBox(_t("opt_28",null,"opts"),"",(function(t){e.changeSingleOptionsAndSave(28)}));i.append(n),e.updateSingleserveroption(".enemy-msg-configuration",getEngine().hero.d.opt)},E=()=>{const e=getEngine().settings,i=t.$.find(".get-legendary-item-clan-notification").empty(),n=createCheckBox(_t("opt_29",null,"opts"),"",(function(t){e.changeSingleOptionsAndSave(29)}));i.append(n),e.updateSingleserveroption(".get-legendary-item-clan-notification",getEngine().hero.d.opt)},_=(t,e)=>{let i=t.target.value,n=t.target.name;"1"===i&&(i=!0),"0"===i&&(i=!1);let s=getEngine().chatController.getChatConfig();switch(n){case a.MESSAGE_SUB_SECTIONS.ALL_TAG:s.setStorageData([a.MESSAGE_SECTIONS.CHANNEL_TAG,n],i);break;case a.MESSAGE_SUB_SECTIONS.ALL_UNIT:case a.MESSAGE_SUB_SECTIONS.TWELVE_HOUR:s.setStorageData([a.MESSAGE_SECTIONS.TS,n],i)}getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()},b=()=>{let e=a.CHANNEL_CARDS,i=t.$.find(".notification-configuration");for(let t in e){if(t==a.CHANNEL.GENERAL)continue;let e=w(t,t);i.append(e)}},w=(t,e)=>{let i=createCheckBox(_t(t.toLowerCase(),null,"chat_lang"),e,(function(e){getEngine().chatController.getChatConfig().setStorageData([a.STATIC_KEYS.MESSAGES_ADD_TO_GENERAL,t,a.MESSAGES_ADD_TO_GENERAL_OPT.ADD],e),getEngine().chatController.rebuiltMessage(),getEngine().chatController.getChatConfig().saveInServerStorageChatConfigStorage()}));return getEngine().chatController.getChatConfig().getMessagesAddToGeneralData(t,a.MESSAGES_ADD_TO_GENERAL_OPT.ADD)&&i.find(".checkbox").addClass("active"),i},C=()=>{t.remove()};this.init=()=>{p(),b(),g(),f(),m(),v(),E(),c(),l(),i(),o(),t.center()},this.closeWindow=C}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0);e.default=class{constructor(t,e){this.onSelected=e,this.el=a.get("radio-custom")[0],this.createRadio(t)}createRadio(t){let{id:e,name:i,value:a,label:s,selected:r,i:o}=t;const l=this.el.querySelector("input"),c=this.el.querySelector("label");l.addEventListener("change",t=>{this.onSelected&&this.onSelected(t)}),!(0,n.isset)(e)&&(0,n.isset)(o)&&(e=`${i}_${o}`),(0,n.setAttributes)(l,{id:e,name:i,value:a}),(0,n.isset)(r)&&r&&(l.checked=!0),s&&(c.setAttribute("for",e.toString()),"object"==typeof s?c.appendChild(s):c.innerHTML=s)}getRadio(){return this.el}}},function(t,e,i){const n=i(0);var a=i(9),s=i(7);t.exports=function(){let t,e=null,i={};const r=()=>{e=n.get("chat-channel-card-wrapper")},o=()=>{getEngine().chatController.getChatWindow().get$chatWindow().find(".chat-channel-card-wrapper").replaceWith(e)},l=()=>{let t=a.CHANNEL_CARDS;for(let i in t){let n=d(t[i]);e.append(n)}},c=()=>{let t=a.CHANNEL;for(let e in t)i[e]=0},d=t=>{let e=n.get("chat-channel-card");e.addClass(t+"-channel"),e.on("click",(function(){if(!getEngine().chatController.getChatChannelsAvailable().checkAvailableProcedure(t))return;h(t,!1),getEngine().chatController.getChatWindow().setChannel(t);let e=s.CHAT,i=a.SERVER_STORAGE.CHANNEL;getEngine().serverStorage.sendData({[e]:{[i]:t}})}));let i=a.INPUT_CHANNEL_HEADER[t].short[_l()],r=getEngine().chatController.chatLang(t.toLocaleLowerCase())+(i?" /"+i+i:"");return e.tip(r),e},h=(t,i)=>{let n=i?"block":"none";0==i&&(u(t),p(t)),e.find(`.${t}-channel`).find(".chat-channel-not-read-counter").css("display",n)},u=t=>{i[t]=0},p=t=>{let n=i[t];e.find(`.${t}-channel`).find(".chat-channel-not-read-counter").html(n>99?"+99":n)};this.init=()=>{r(),o(),l(),c()},this.addOneMessageCounterProcedure=(e,n,s)=>{if(s)return;if(getEngine().hero.d.nick==n)return;if(t==e)return;let r=getEngine().chatController.getChatConfig().getMessagesAddToGeneralData(e,a.MESSAGES_ADD_TO_GENERAL_OPT.ADD);t==a.CHANNEL.GENERAL&&r||((t=>{i[t]++})(e),p(e),h(e,!0))},this.showNotReadElement=h,this.setChannelCard=i=>{t=i,e.find(".chat-channel-card").removeClass("active"),e.find(`.${i}-channel`).addClass("active")},this.getActiveChannelName=()=>t}},function(t,e,i){const n=i(0);var a=i(9);t.exports=function(){let t,e;const i=()=>{e=0},s=()=>{t.addScrollBar({track:!0,callback:l})},r=()=>{t.trigger("scrollBottom")},o=()=>{t.trigger("update")},l=t=>{},c=()=>{let e=a.CHANNEL;for(let i in e){let e=h(i);t.find(".scroll-pane").append(e)}},d=()=>{t=n.get("chat-message-wrapper")},h=t=>{let e=$("<div>").addClass("one-message-wrapper");return e.addClass(t+"-message-wrapper"),e},u=e=>{getEngine().chatController.getChatWindow().get$chatWindow().find(".chat-message-wrapper").replaceWith(t)},p=()=>t.hasClass("scrollable");this.init=()=>{i(),d(),u(),c(),s(),o()},this.setChannelMessageWrapper=e=>{t.find(".one-message-wrapper").removeClass("active"),t.find(`.${e}-message-wrapper`).addClass("active")},this.appendMessageToMessageWrapper=(e,i,n,s)=>{let l=p();if(t.find(`.${e}-message-wrapper`).append(n),e!=a.CHANNEL.GENERAL){if(getEngine().chatController.getChatConfig().getMessagesAddToGeneralData(e,a.MESSAGES_ADD_TO_GENERAL_OPT.ADD)){let i=n.clone(!0);i.addClass(e+"-channel-in-"+a.CHANNEL.GENERAL+"-channel"),t.find(`.${a.CHANNEL.GENERAL}-message-wrapper`).append(i)}}getEngine().chatController.getChatChannelCardWrapper().addOneMessageCounterProcedure(e,i,s),o();let c=p();(!getEngine().interface.alreadyInitialised||!l&&c)&&r()},this.updateScroll=o,this.setScrollOnBottom=r,this.manageChatWidgetAmountAfterAddMessage=()=>{if(!0===getEngine().getFirstNotInit())return;getEngine().interface.isShowLeftColumn()||(e++,getEngine().widgetManager.widgets.updateAmount(getEngine().widgetsData.name.CHAT,e>999?"+999":e))},this.resetHideChatMessageCounterAndChatWidgetAmount=()=>{i(),getEngine().widgetManager.widgets.updateAmount(getEngine().widgetsData.name.CHAT,"")},this.clearAllMessageWrapperChannel=()=>{t.find(".one-message-wrapper").empty()},this.clearAllMessageFromWrapperByChannelName=e=>{t.find(".chat-"+e+"-message").remove()}}},function(t,e,i){var n=i(0),a=i(9),s=i(7);t.exports=function(){let t=null,e=!0;const i=()=>{getEngine().interface.get$gameWindowPositioner().find(".chat-layer").find(".chat-overlay").click(()=>{u(!1)})},r=()=>{t=n.get("new-chat-window")},o=()=>{getEngine().interface.get$interfaceLayer().find(".left-column").find(".inner-wrapper").append(t)},l=()=>e?1:0,c=function(){const t=s.CHAT,i=a.SERVER_STORAGE.VISIBLE;h(!e);let n={[t]:{[i]:e}};getEngine().serverStorage.sendData(n),d()},d=()=>{if(getEngine().interface.setChat(),!getEngine().interface.isShowLeftColumn())return;let t=getEngine().chatController.getChatMessageWrapper();t.resetHideChatMessageCounterAndChatWidgetAmount(),t.setScrollOnBottom()},h=t=>{e=t},u=t=>{getEngine().interface.get$gameWindowPositioner().find(".chat-layer").css("display",t?"block":"none")};this.init=()=>{r(),i(),o()},this.setChatOverAdditionalBarPanel=e=>{var i=e?49:0;t.css("bottom",i+"px")},this.get$chatWindow=()=>t,this.manageChatWindowAfterEnter=()=>{l()||c(),getEngine().chatController.getChatInputWrapper().focus(),getEngine().chatController.getChatInputWrapper().setBlockNearOnEnterUp()},this.setChatVisible=h,this.chatToggle=c,this.setChannel=(t,e,i)=>{let n=e||null,s=a.INPUT_CHANNEL_HEADER[t].inputWrapper,r=a.INPUT_CHANNEL_HEADER[s];getEngine().chatController.getChatChannelCardWrapper().setChannelCard(t),getEngine().chatController.getChatInputWrapper().setChannel(r,null,n,i),getEngine().chatController.getChatMessageWrapper().setChannelMessageWrapper(t),getEngine().chatController.getChatMessageWrapper().updateScroll(),getEngine().chatController.getChatMessageWrapper().setScrollOnBottom()},this.getChatSize=l,this.setVisibleMobileView=u}},function(t,e,i){var n=i(9),a=i(0),s=i(390),r=i(101),o=i(102);const{showProfile:l}=i(2);t.exports=function(){let t=null,e=null,i=null,c=null,d=null,h=null,u=null,p=null,g=null,f=null,m=null,v=null;const E=()=>{c&&t.addClass("expired-message")},_=t=>{e=t.id,i=t.ts,c=t.expiredMessage,d=t.channel,p=t.authorBusinessCard,g=t.receiverBusinessCard,h=t.text,u=isset(t.systemRelatedBusinessCard)?t.systemRelatedBusinessCard:null,t.authorBusinessCard&&(f=p.getNick()),t.receiverBusinessCard&&(m=g.getNick()),t.style&&(v=t.style)},b=()=>{t=w()},w=()=>a.get("new-chat-message"),C=()=>{t.css("color");let e=getEngine().chatController.getChatConfig(),i=getEngine().hero.d.nick==f,n=e.getChannelColor(d,i);t.css("color",n)},T=(t,e)=>{if("inline"==t.css("display")==e)return;let i=e?"inline":"none";t.css("display",i)},y=()=>{let e=getEngine().chatController.getChatConfig(),a=e.getMessageSectionData(n.MESSAGE_SECTIONS.TS,n.MESSAGE_SUB_SECTIONS.DISPLAY),s=t.find(".ts-section");if(T(s,a),!a)return;let r=e.getMessageSectionData(n.MESSAGE_SECTIONS.TS,n.MESSAGE_SUB_SECTIONS.ALL_UNIT),o=e.getMessageSectionData(n.MESSAGE_SECTIONS.TS,n.MESSAGE_SUB_SECTIONS.TWELVE_HOUR),l=ut_time(Math.floor(i),r,o);s.html("["+l+"] "),s.tip(ut_time(Math.floor(i),!0,o))},I=()=>{let e=getEngine().chatController.getChatConfig(),i=e.getMessageSectionData(n.MESSAGE_SECTIONS.CHANNEL_TAG,n.MESSAGE_SUB_SECTIONS.DISPLAY),a=t.find(".channel-section");if(T(a,i),!i)return;let s=e.getMessageSectionData(n.MESSAGE_SECTIONS.CHANNEL_TAG,n.MESSAGE_SUB_SECTIONS.ALL_TAG),r=getEngine().chatController.chatLang(d.toLocaleLowerCase()),o=s?r:r[0];a.html("["+o+"] "),a.tip(r)},A=()=>{let e=t.find(".author-section");v!=n.SERVER_STYLE.ME&&f||e.css("display","none"),e.html(f+(m?"":": ")),S()},k=()=>{let e=t.find(".receiver-section"),i=t.find(".receiver-arrow-section"),n=!!m;T(i,n),T(e,n),n&&(e.html(m+": "),S())},S=()=>{let t=O();t&&M(t)},O=e=>{if(d==n.CHANNEL.SYSTEM||d==n.CHANNEL.CLAN&&e)return e?{id:e.id,acc:e.acc,nick:e.nick,prof:e.prof,icon:e.icon,lvl:e.lvl,$clickField:e.$clickField}:null;let i=getEngine().hero.d.nick;if(d==n.CHANNEL.PRIVATE)return f==i?{id:g.getId(),acc:g.getAcc(),nick:m,prof:g.getProf(),icon:g.getIcon(),lvl:g.getLvl(),$clickField:t.find(".receiver-section")}:{id:p.getId(),acc:p.getAcc(),nick:f,prof:p.getProf(),icon:p.getIcon(),lvl:p.getLvl(),$clickField:t.find(".author-section")};if(f==i)return null;let a=null;return a=f?p:g,{id:a?a.getId():null,acc:a?a.getAcc():null,nick:f,prof:a?a.getProf():null,icon:a?a.getIcon():null,lvl:a?a.getLvl():null,$chatMessage:t,$clickField:t.find(".author-section")}},M=t=>{t.$clickField.addClass("click-able"),t.$clickField.on("click",(function(){getEngine().chatController.getChatInputWrapper().setPrivateMessageProcedure(t.nick)})),t.$clickField.on("contextmenu",(function(e,i){console.log(t);let n=[],a=$(this).parent().parent();F(t.nick,n),W(a,n),H(t.nick,n),N(t.id,t.nick,t.prof,t.icon,t.lvl,t.acc,n),R(t.nick,n),x(t.nick,n),L(t.id,n),D(t.acc,t.id,n),G(t.nick,n);let s=getE(e,i);getEngine().interface.showPopupMenu(n,s)})),t.$clickField.tip(getEngine().chatController.chatLang("privMessageTo")+t.nick)},N=(t,e,i,n,a,s,r)=>{r.push([_t("show_eq"),function(){Engine.showEqManager.update({id:t,nick:e,prof:i,icon:n,lvl:a,account:s})}])},R=(t,e)=>{e.push([_t("invite_to_friend"),function(){P(t)}])},x=(t,e)=>{e.push([_t("add_to_enemies"),function(){B(t)}])},L=(t,e)=>{e.push([_t("team_invite",null,"menu"),function(){_g("party&a=inv&id="+t)}])},D=(t,e,i)=>{i.push([_t("show_profile",null,"menu"),()=>l(t,e)])},P=t=>{_g("friends&a=finvite&nick="+t.trim().split(" ").join("_"))},B=t=>{_g("friends&a=eadd&nick="+t.trim().split(" ").join("_"))},F=(t,e)=>{e.push([_t("send_message",null,"chat"),function(){getEngine().chatController.getChatInputWrapper().setPrivateMessageProcedure(t)}])},W=function(t,e){t.hasClass(n.CHANNEL.CLAN+"-channel-in-"+n.CHANNEL.GLOBAL+"-channel")&&e.push([_t("to-clan"),function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.CLAN)}]),t.hasClass(n.CHANNEL.GROUP+"-channel-in-"+n.CHANNEL.GLOBAL+"-channel")&&e.push([_t("to-group"),function(){getEngine().chatController.getChatWindow().setChannel(n.CHANNEL.GROUP)}])},H=(t,e)=>{e.push([_t("player_nick",null,"clan"),function(){getEngine().chatController.getChatInputWrapper().addToInput(t+"&nbsp;",!0)}])},G=(t,e)=>{var i=getEngine().hero.d.uprawnienia;0!=i&&t!=getEngine().hero.d.nick&&"System"!=t&&(e.push(["MC Panel",function(){getEngine().mcAddon||(getEngine().mcAddon=new r(self),getEngine().mcAddon.init()),getEngine().mcAddon.update(t)}]),4!=i&&16!=i||e.push(["SMC Panel",function(){getEngine().smcAddon&&getEngine().smcAddon.close(),getEngine().smcAddon=new o(t),getEngine().smcAddon.init()}]))},V=()=>{let e,i=d==n.CHANNEL.SYSTEM,a=d==n.CHANNEL.CLAN,s=d==n.CHANNEL.COMMERCIAL,r=v==n.SERVER_STYLE.TOWN;i&&(e=j(h,!0,!0)),a&&u&&(e=j(h,!0,!0)),s&&(e=parseChatBB(h)),e||(e=j(h,!1,!r)),t.find(".message-section").html(e)},U=()=>{v&&(t.find(".message-part").addClass("special-style-"+v),t.addClass("wrapper-special-style-"+v))},j=(t,e,i)=>{e&&(t=parseChatBB(t));let n=[lt(t,e)];for(let t=0;t<n.length;t++){let a=n[t],s=a.textContent;if("#text"!=a.nodeName){if(a.hasClass("mark-message-span"))continue;s=e?a.html():a.text()}it(s)?(et(n,t),tt(t,n,s,e),t--):getEngine().chatLinkedItemsManager.checkReceiveMessageHaveLinkedItem(s,!1)?(et(n,t),at(t,n,getEngine().chatLinkedItemsManager.parseReceiveMessageWithLinkedItem(s,!1,e)),t--):z(s)?(et(n,t),at(t,n,Q(t,n,s,e)),t--):i&&Y(s)&&(et(n,t),at(t,n,X(t,n,s,e)),t--)}return n},q=t=>t.kind==n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,K=()=>{const t=n.MESSAGE_MARK_REGEXP_KINDS.EMO_ICON,e=n.MESSAGE_SUB_SECTIONS.DISPLAY;return getEngine().chatController.getChatConfig().getMessageSectionData(t,e)},Y=t=>{let e=n.MESSAGE_MARK_REGEXP,i={};for(let n in e){let a=e[n];if((!q(a)||K())&&Z(a,t,i))return!0}return!1},z=t=>{let e=d==n.CHANNEL.SYSTEM,i=d==n.CHANNEL.CLAN;if(!(e&&u||i&&u))return!1;let a={relatedNick:u.getNick()},s=n.SYSTEM_MESSAGE_MARK_REGEXP;for(let e in s){let i=s[e];if((!q(i)||K())&&Z(i,t,a))return!0}return!1},X=(t,e,i,a)=>{let r=n.MESSAGE_MARK_REGEXP,o={};for(let t in r){let e=r[t];if(Z(e,i,o))return s.parseReceiveMessageWithMark(i,e,a)}},Q=(t,e,i,a)=>{let r=n.SYSTEM_MESSAGE_MARK_REGEXP,o={relatedId:u.getId(),relatedAcc:u.getAcc(),relatedNick:u.getNick(),relatedProf:u.getProf(),relatedIcon:u.getIcon(),relatedLvl:u.getLvl()};for(let t in r){let e=r[t];if(!Z(e,i,o))continue;let n=s.parseReceiveSystemMessageWithMark(i,e,a,o);return e.editMark&&J(e,n,o),n}},J=(t,e,i)=>{for(let n in e){let a=e[n];if(a.hasClass("mark-message-span"))return void t.editMark(this,a,i)}},Z=(t,e,i)=>{let n=s.getMyRegExp(t,i);return null!=n&&!!n.exec(e)},tt=(t,e,i,n)=>{let a=linkify.tokenize(i);for(let i in a){let s=a[i];if(s.isLink)at(t,e,st(s)),t++;else{let i=s.toString();at(t,e,[lt(i,n)]),t++}}},et=(t,e)=>{t.splice(e,1)},it=t=>{let e=linkify.tokenize(t);for(let t in e){let i=e[t],n=i.toString();if("url"==i.type&&nt(n))return!0}return!1},nt=function(t){return/^(?:(https?:\/\/)|(www\.))/i.test(t)},at=(t,e,i)=>{for(let n=0;n<i.length;n++){let a=t+n;e.splice(a,0,i[n])}},st=t=>{let e=t.toObject("https"),i=ct(e.href);return i?rt(e,i):ot(e)},rt=(t,e)=>{let i=$("<span>"),a=null,s=e.htmlClass,r=e.getTip;try{a=JSON.parse(e.style)}catch(t){errorReport("ChatMessage.js","createLinkNodeFromWhiteList","Incorrect JSON format!",a)}return null!=s&&i.addClass(s),null!=a&&i.css(a),null!=r&&i.tip(r()),i.addClass('message-mark "mark-message-span'),i.text(e.getText()),i.click((function(){switch(e.linkType){case n.LINK_TYPES.PLAYER_PROFILE:getEngine().iframeWindowManager.newPlayerProfile({staticUrl:t.href});break;case n.LINK_TYPES.CLAN_PROFILE:getEngine().iframeWindowManager.newClanPage({staticUrl:t.href})}})),[i]},ot=t=>{let e=$("<u>");return e.addClass("link mark-message-span"),e.text(t.href),e.click((function(){window.goToUrl(t.href)})),[e]},lt=(t,e)=>{let i;return e?(i=document.createElement("span"),i.innerHTML=t,i=$("<span>").html(t)):i=document.createTextNode(t),i},ct=t=>{let e=n.MESSAGE_LINK_REGEXP;for(let i in e){let n=e[i];if(n.getPattern().exec(t))return n}return null};this.init=e=>{b(),_(e),t.addClass("chat-"+d+"-message"),E()},this.getTs=()=>i,this.getId=()=>e,this.getStyle=()=>v,this.isCodeMessage=()=>!1,this.updateMessage=()=>{C(),y(),I(),A(),k(),V(),U()},this.remove=()=>{t.remove()},this.appendMessageToChannel=e=>{getEngine().chatController.getChatMessageWrapper().appendMessageToMessageWrapper(d,f,t,e)},this.attachContextMenuToRelatedNick=(t,e)=>{let i=O({$clickField:t,id:e.relatedId,acc:e.relatedAcc,nick:e.relatedNick,prof:e.relatedProf,icon:e.relatedIcon,lvl:e.relatedLvl});M(i)}}},function(t,e){const i="ChatMessageWithMarkReplace.js",n=(t,e)=>{let n=t.getPattern,a=t.getDynamicPattern;return n&&a?(errorReport(i,"getMyGegExp","Declare getPattern and additionalData is impossible!",oneMarkData),t.getPattern()):n?n():a?a(e):void 0},a=(t,e,i,a)=>{let r,o=t.length,l=0,c=0,d=n(e,a),p=[],g=[];for(;null!==(r=d.exec(t));){let n=r.index;if(c<n){let a=t.substr(c,n-c);g.push(h(a,i)),p.push(s(t,r,e)),g.push(u(l,i))}else p.push(s(t,r,e)),g.push(u(l,i));l++,c=r.index+r[0].length}if(c!=o){let e=t.substr(c,o-1);g.push(h(e,i))}return{htmlString:g,marksDataArray:p}},s=(t,e,i)=>{if(i.dynamicMark){let t={style:i.style,dynamicData:[]};for(let i=1;i<e.length;i++){let n=e[i];n=n.replaceAll("&quot;",""),n=n.replaceAll('"',""),t.dynamicData.push(n)}return t}return{style:i.style,text:i.text}},r=(t,e,i)=>{for(let n in t){let a=t[n];e[i]=e[i].replaceAll("<"+a+">",""),e[i]=e[i].replaceAll("</"+a+">","")}},o=(t,e,i)=>{i&&(t=>{let e=t.htmlString,i=["strong"];for(let t in e){let n=e[t],a=c(n,i);a.allClose||r(a.list,e,t)}})(t);let n=i?$("<div>"+t.htmlString.join("")+"</div>"):$("<div>").html(t.htmlString),a=[];for(let i in t.marksDataArray){let a=t.marksDataArray[i],s=l(a,e);n.find(".mark-"+i).replaceWith(s)}return n.children().each((function(){a.push($(this))})),a},l=(t,e)=>{let i=$("<span>"),n=null;try{n=JSON.parse(t.style)}catch(e){errorReport("ChatMessageWithMarkReplace.js","createMarkItemSpan","Incorrect JSON format!",t.style)}null!=n&&i.css(n);let a=null,s=null;return e.dynamicMark?(a=e.dynamicMark(t.dynamicData),e.getDynamicTip&&(s=e.getDynamicTip(t.dynamicData))):(a=t.text,e.getTip&&(s=e.getTip())),i.text(a),i.addClass("mark-message-span"),null!=s&&i.tip(s),i},c=(t,e)=>{let i=!0,n=[];for(let a=0;a<e.length;a++){let s=e[a];d(t,"<"+s+">","</"+s+">")||(i=!1,n.push(s))}return{allClose:i,list:n}},d=(t,e,i)=>{let n,a,s,r=new RegExp(e+"(.*?)"+i,"g"),o=new RegExp(e,"g"),l=new RegExp(i,"g"),c=0,d=0,h=0;for(;null!==(n=r.exec(t));)c++;for(;null!==(a=o.exec(t));)d++;for(;null!==(s=l.exec(t));)h++;return c==d&&d==h},h=(t,e)=>e?`<span class="mark-text-span">${t}</span>`:$("<span>").addClass("mark-text-span").text(t),u=(t,e)=>e?`<span class="mark-${t}"></span>`:$("<span>").addClass("mark-message-span mark-"+t);let p={parseReceiveSystemMessageWithMark:(t,e,i,n)=>{let s=a(t,e,i,n);return o(s,e,i)},parseReceiveMessageWithMark:(t,e,i,n)=>{let s=a(t,e,i,n);return o(s,e,i)},getMyRegExp:n};t.exports=p},function(t,e,i){var n=i(9);t.exports=function(){let t={};const e=()=>{let e=n.AVAILABLE;for(let i in e)t[i]=e[i]},i=e=>{if(isset(t[e]))return!!t[e];errorReport("ChatChannelAvailable.js","checkAvailable","channelName: "+e+" not exist in ",t)};this.init=()=>{e()},this.setAvailable=(e,i)=>{isset(t[e])?t[e]=i:errorReport("ChatChannelAvailable.js","setAvailable","channelName: "+e+" not exist in ",t)},this.checkAvailableProcedure=t=>{if(!i(t)){let e=getEngine().chatController.chatLang(t.toLowerCase());return getEngine().interface.alreadyInitialised&&message(getEngine().chatController.chatLang("channel_not_available",{"%channel%":e.toLowerCase()})),!1}return!0},this.checkAvailable=i}},function(t,e){t.exports=function(){let t=[],e=[];this.init=()=>{},this.addSendMessageUser=e=>{t.push(e)},this.addReceiveMessageUser=t=>{e.push(t)},this.getLastUserWhoSendToHeroPrivateMessage=()=>{let t=e.length;return e[t-1]},this.getLastUserWhoGetFromHeroPrivateMessage=()=>{let e=t.length;return t[e-1]}}},function(t,e,i){var n=i(9);let a=i(30);var s=i(7);t.exports=function(){let t=[];const e=t=>{i(t)&&r(t);let e=(t=>{let e=[],i=[];for(let n in t){let a=t[n],s=v(n);if(a.archivedIds){let t=a.archivedIds;for(let e in t)i.push(t[e])}if(a.msg){let t=a.msg;for(let i in t){let n=t[i];n.channel=s,e.push(n)}}}return{mergeMessage:e,mergeArchivedMessage:i}})(t);if(!e.mergeMessage.length)return;let n=l(e);d(n)},i=t=>{let e=n.SERVER_CHANNEL[n.CHANNEL.LOCAL];return t[e]&&t[e].archivedIds},r=e=>{let i=n.SERVER_CHANNEL[n.CHANNEL.LOCAL];var a;a=e[i].archivedIds,t=a},o=t=>{(t=>{for(let e in t){let i=t[e],n=v(e);isset(i.blockadeLeftSeconds)&&m(i.blockadeLeftSeconds,n)}})(t),e(t)},l=t=>{let e=[],i=[],a=t.mergeMessage,s=t.mergeArchivedMessage;for(let t in a){let r=a[t],o=isset(r.id)?r.id:r.getId();r.channel==n.CHANNEL.COMMERCIAL&&(r.ts=ts()/1e3),s.includes(o)?i.push(r):e.push(r)}i.length&&c(i),e.length&&c(e);let r=null;for(let t=0;t<e.length;t++){let i,a=e[t],s=isset(a.style),o=isset(a.getStyle);s||o?(s&&(i=a.style),o&&(i=a.getStyle())):i=null,i==n.SERVER_STYLE.TOWN&&(r=t)}if(i.length)if(null==r){for(let t=0;t<i.length;t++)e.push(i[t]);c(e)}else for(let t=0;t<i.length;t++)addToArrayRecord(e,r+t+1,i[t]);return e},c=t=>{t.sort((function(t,e){return(isset(t.ts)?t.ts:t.getTs())-(isset(e.ts)?e.ts:e.getTs())}))},d=t=>{const e=n.CHANNEL;for(let i in t){let n=t[i],s=n.id,r=n.channel,o=r==e.CLAN,l=r==e.SYSTEM,c=r==e.COMMERCIAL,d=n.sender,u=isset(n.receiver)?n.receiver:null,p=r==e.LOCAL&&!isset(d)&&!isset(d);if(getEngine().chatController.checkMessageExist(s,r))continue;if(l&&n.code||o&&n.code){getEngine().chatController.addToMessageList(n,s,r);let t=JSON.parse(n.code);n.isCodeMessage=function(){return!0},n.getTs=function(){return n.ts},n.getSystemRelatedBusinessCard=function(){return isset(n.related&&n.related[0])?getEngine().businessCardManager.getCard(n.related[0]):null};for(let e in t.message)getEngine().codeMessageManager.updateData(t.message[e],a.SOURCE.CHAT,n);continue}let g=n.ts,f=n.msg,m=isset(n.style)?n.style:null,v=getEngine().businessCardManager.getCard(d),E=null;if(!v&&!(l||c||p)){errorReport("ChatDataUpdater.js","updateMessages","authorBusinessCard not exist! Author id:"+d);continue}if(null!=u&&!l&&(E=getEngine().businessCardManager.getCard(u),!E)){errorReport("ChatDataUpdater.js","updateMessages","receiverBusinessCard not exist! Receiver id:"+u);continue}let _={town:p,ts:g,expiredMessage:h(s,g),id:s,style:m,channel:r,authorBusinessCard:v,receiverBusinessCard:E,text:f};getEngine().chatController.addMessage(_)}},h=(e,i)=>(e=>t.includes(e))(e)||ts()/1e3-10>i,u=t=>{if("*"!=t)p(v(t));else for(let t in n.CHANNEL)p(t)},p=t=>{getEngine().chatController.getChatMessageWrapper().clearAllMessageFromWrapperByChannelName(t),getEngine().chatController.clearMessageList(t),getEngine().chatController.getChatChannelCardWrapper().showNotReadElement(t,!1),getEngine().chatController.getChatMessageWrapper().updateScroll()},g=(t,e)=>{let i=getEngine().chatController.getChatInputWrapper(),a=n.NOTIFICATION.MUTE;i.getChatNotificationManager().setMuteLeftSeconds(e,t,()=>{if(i.getChannelName()!=e)return;let n=getEngine().chatController.chatLang("MUTE_NEXT_MESSAGE_TIME")+" "+f(t);i.getChatNotificationView().turnOnNotification(a,n)},()=>{if(t--,i.getChannelName()!=e)return;let n=getEngine().chatController.chatLang("MUTE_NEXT_MESSAGE_TIME")+" "+f(t);i.getChatNotificationView().turnOnNotification(a,n)},()=>{i.getChannelName()==e&&i.getChatNotificationView().turnOffNotification(a)})},f=t=>getSecondLeft(t,{short:!0})+" ("+ut_fulltime(ts()/1e3+t,!0,!0)+")",m=(t,e)=>{let i=getEngine().chatController.getChatInputWrapper(),a=n.NOTIFICATION.WATCH;if(0==t)return;i.getChatNotificationManager().setBlockadeLeftSeconds(e,t,()=>{if(i.getChannelName()!=e)return;let n=getEngine().chatController.chatLang("BLOCKADE_NEXT_MESSAGE_TIME")+" "+f(t);i.getChatNotificationView().turnOnNotification(a,n)},()=>{if(t--,i.getChannelName()!=e)return;let n=getEngine().chatController.chatLang("BLOCKADE_NEXT_MESSAGE_TIME")+" "+f(t);i.getChatNotificationView().turnOnNotification(a,n)},()=>{i.getChannelName()==e&&i.getChatNotificationView().turnOffNotification(a)})},v=t=>{for(let e in n.SERVER_CHANNEL)if(t==n.SERVER_CHANNEL[e])return e;return errorReport("ChatDataUpdater.js","getChannelNameByServerChannelName","Incorrect serverChannelName!",t),n.CHANNEL.LOCAL};this.init=()=>{},this.sortMessage=l,this.getArchivedMessage=()=>t,this.getServerChannelNameByChannelName=t=>{let e=n.SERVER_CHANNEL[t];return e||(errorReport("ChatDataUpdater.js","getChannelNameByServerChannelName","Incorrect serverChannelName!",e),n.SERVER_CHANNEL.LOCAL)},this.getShortInputChannelData=t=>{let e=null;return isPl()&&(e=t.short.pl),isEn()&&(e=t.short.en),e},this.setDataFromServerStorage=()=>{let t=getEngine().serverStorage.get(s.CHAT);const e=n.SERVER_STORAGE.VISIBLE,i=n.SERVER_STORAGE.CHANNEL,a=n.SERVER_STORAGE.DATA;if(t){if(isset(t[e])){let i=t[e];getEngine().chatController.getChatWindow().setChatVisible(i)}if(t[a]&&(getEngine().chatController.getChatConfig().getDataFromServerStorageAndSetStorageData(t[a]),getEngine().chatController.rebuiltMessage()),t[i]){let e=t[i];getEngine().chatController.getChatWindow().setChannel(e,null,!0)}}},this.updateMessages=d,this.updateData=t=>{isset(t.channels)&&o(t.channels),isset(t.clear)&&u(t.clear),isset(t.muteLeftSeconds)&&(g(t.muteLeftSeconds,n.CHANNEL.GLOBAL),g(t.muteLeftSeconds,n.CHANNEL.LOCAL),g(t.muteLeftSeconds,n.CHANNEL.TRADE))},this.checkExpiredMessage=h}},function(t,e,i){var n=i(56);i(5);function a(t){return void 0!==t}t.exports=function(){var t=this,e={},i={},s={},r={};let o,l=0,c=!0,d={},h={};this.init=()=>{this.createPlaceHolderItem(),this.initTs(),u()};const u=()=>{getEngine().interface.addCallbackToInteraceFocusList(p)},p=()=>{for(let t in e)e[t].setShouldDrawIcon(null)};this.createPlaceHolderItem=()=>{Engine.imgLoader.onload("../img/def-item.gif",!1,t=>{this.placeHolderItem=t})},this.initTs=()=>{o=ts()},this.updateNoticeTop=()=>{let t=Math.round(4*Math.abs(Math.sin(4*ts()/1e3-o))*10)/10,e=Math.floor(t);t=t-e>.5?e+.5:e,t!=l?(l=t,c=!0):c=!1},this.getNoticeTop=()=>l,this.getPlaceholderItem=()=>this.placeHolderItem,this.createViewIcon=function(t,i){let n=e[t];if(!n)return!1;let r,o=n.$.clone(!0),l=n.$canvasIcon[0],c=o.find(".canvas-icon")[0],d=c.getContext("2d"),h=o.find(".canvas-notice"),u=h.length,p=null,g=null;return c.width=l.width,c.height=l.height,d.drawImage(l,0,0),n.updateDynamicTips(o,/timelimit=([0-9]+)/,1e3),n.updateDynamicTips(o,/expires=([0-9]+)/,1e3),u?(p=h[0],g=p.getContext("2d"),r=[o,d,c,p,g]):r=[o,d,c],i&&(a(s[t])||(s[t]={}),a(s[t][i])||(s[t][i]=[]),s[t][i].push(r),this.checkViewExist(i)),u&&n.drawNotice(g,p),r},this.checkViewExist=t=>{Engine.itemsViewData[t]||errorReport("ItemsManager.js","createViewIcon","Unregistered viewName: "+t)},this.changePlaceHolderIconIntoNormalIcon=t=>{let i=s[t];if(!i)return;let n=e[t];for(let t in i){let e=i[t];for(let t=0;t<e.length;t++){let i=n.$.clone(!0),a=n.$canvasIcon[0],s=i.find(".canvas-icon")[0],r=s.getContext("2d");s.width=a.width,s.height=a.height,r.drawImage(a,0,0),e[t][0].find(".canvas-icon").replaceWith($(s)),e[t][1]=r,e[t][2]=s}}},this.deleteViewIconIfExist=function(t,e){s[t]&&s[t][e]&&Engine.items.deleteViewIcon(t,e)},this.deleteViewIcon=function(t,e){if(!s[t])return console.error("[ItemsManager.js, deleteViewIcon] View of item: "+t+" not exist!");if(!s[t][e])return console.error("[ItemsManager.js, deleteViewIcon] ViewName of itemId: "+t+" not exist:"+e);let i=s[t][e].length;for(let n=0;n<i;n++)s[t][e][n][0].remove();delete s[t][e]},this.deleteViewWithAllIcon=function(e){for(let i in s[e])t.deleteViewIcon(e,i);delete s[e]},this.addAndGetIdToFetchPackageController=function(t){let e=0;for(;r[e];)e++;r[e]={};for(let i in t){let n=t[i].loc;n&&(a(r[e][n])||(r[e][n]=0),r[e][n]++)}return e},this.getFetchPackageController=function(){return r},this.decreaseFetchPackageController=function(t,e){r[t][e]--,r[t][e]<1&&delete r[t][e],this.checkClearFetchPackageController(t)},this.checkClearFetchPackageController=t=>{r[t]&&(Object.keys(r[t]).length||delete r[t])},this.checkFetchFinish=function(e,i){return t.decreaseFetchPackageController(e,i),!r[e]||!a(r[e][i])},this.getLocToUpdate=t=>{let e={};for(let i in t){let n=t[i].loc;e[n]||(e[n]=!0)}return e},this.updateDATA=function(t){let i=this.getLocToUpdate(t),n=this.addAndGetIdToFetchPackageController(t);for(var s in this.beforeUpdate(t,i),t)a(t[s].del)?this.deleteItem(s):a(e[s])?this.updateItem(s,t[s],n):this.newItem(s,t[s],n,!0);this.checkClearFetchPackageController(n),this.afterUpdate(t,i)},this.addToBeforeUpdateItemsCallback=(t,e)=>{let i=t.loc;d[i]||(d[i]=[]),d[i].push(e)},this.addToAfterUpdateItemsCallback=(t,e)=>{let i=t.loc;h[i]||(h[i]=[]),h[i].push(e)},this.beforeUpdate=(t,e)=>{for(let i in d)if(e[i])for(let e in d[i])d[i][e](t)},this.afterUpdate=(t,e)=>{for(let i in h)if(e[i])for(let e in h[i])h[i][e](t)},this.updateItem=function(t,i,n){var a=e[t].loc!=i.loc,s=e[t].st!=i.st,r=CFG.enhancedItemId==t;a||s||r?(this.checkGetNow(t,i),this.deleteItem(t),this.newItem(t,i,n,a)):(e[t].update(i,n),this.decreaseFetchPackageController(n,e[t].loc))},this.checkGetNow=function(t,i){var n=a(e[t].getNow),s="g"==e[t].loc;n&&s&&(i.getNow=!1)},this.newItem=function(t,i,s,r){if(!Engine.reload||!a(i.loc)||"g"!=i.loc||a(Engine.hero.oldLvl)&&Engine.hero.oldLvl>Engine.hero.d.lvl&&1===Engine.hero.d.lvl){var o=new n(t,i,"item");e[t]=o,o.setIdFetchPackage(s),o.update(i),r&&o.firstGetNow()}},this.deleteItem=function(i){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a(e[i])&&(n&&e[i].beforeDelete(),t.deleteViewWithAllIcon(i),Engine.stickyTips.deleteIfExist(i),Engine.itemsMarkManager.removeItem(e[i]),delete e[i])},this.newItemInLocation=function(e,n,s){let r=t.checkFetchFinish(s,n.loc);if(a(i[e]))for(var o in i[e])t.delayLocationCallbacks(n,e,o,r)},this.delayLocationCallbacks=function(t,e,n,a){(0,i[e][n])(t,a)},this.fetchLocationItems=function(t){var i=[];for(var n in e)e[n].loc==t&&e[n]&&i.push(e[n]);return i},this.addCallback=function(t,e,n){a(i[t])||(i[t]={}),i[t][e]?console.error("[ItemsManager.js, addCallback] Fetch callback already use!",e):i[t][e]=n},this.removeCallback=function(t){let e=t.loc.split(","),n=t.k;a(i[e])?(delete i[e][n],Object.keys(i[e]).length||delete i[e]):console.error("[ItemsManager.js, removeCallback] Fetch callback not exist!",n)},this.fetch=function(e,i){let n=e.loc.split(","),a=e.k;if("function"==typeof i)for(var s=0;s<n.length;s++){t.addCallback(n[s],a,i);var r=t.fetchLocationItems(n[s]);let e=r.length-1;for(var o in r){let t=e==o;i(r[o],t)}}},this.parseItemStat=function(t){t=t.split(";");for(var e={},i=0;i<t.length;i++){var n=t[i].split("=");e[n[0]]=a(n[1])?n[1]:null}return e},this.deleteUnnecessaryItems=function(){var e=t.fetchLocationItems("l");for(var i in e)t.deleteItem(e[i].id)},this.getItemById=function(t){return e[t]},this.onClear=function(){},this.test=function(){return{items:e,callbacks:i}},this.updateTrackHighlights=function(){for(let t in e)e[t].$.find(".highlight").removeClass("track"),e[t].loc!==Engine.itemsFetchData.NEW_GROUND_ITEM.loc&&0!==Engine.items.getAllViewsById(t).length&&Engine.items.getAllViewsById(t)[0].find(".highlight").removeClass("track")},this.testMyItems=function(){let t={},e=this.test().items;for(let i in e)"g"==e[i].loc&&(t[i]=e[i]);return t},this.update=function(t){this.updateNoticeTop();for(let i in s)e[i].updateDraw(t)},this.getViews=function(){return s},this.getViewById=function(t){return s[t]},this.getViewByIdAndLoc=function(t,e){let i=s[t];if(a(i[e]))return i[e][0][0]},this.getAllViewsById=function(t){let e=[],i=s[t];for(let t in i){let n=i[t];for(let t=0;t<n.length;t++)e.push(n[t][0])}return e},this.getAllViewsByViewName=function(t){let e=[];for(const i in s)a(s[i][t])&&(console.log(i),e.push(s[i][t][0][0]));return e},this.deleteAllViewsByViewName=function(t){for(const e in s)a(s[e][t])&&(this.deleteViewIcon(e,t),delete s[e][t])},this.getAllViewsByIdAndViewName=function(t,e){let i=[],n=s[t];for(let t in n){if(t!=e)continue;let a=n[t];for(let t=0;t<a.length;t++)i.push(a[t][0])}return i},this.getAllViewsItemsById=function(t){let e=$();const i=this.getAllViewsById(t);for(let t in i)e.push.apply(e,i[t]);return e},this.drawItems=function(){for(let t in s)for(let i in s[t])for(let n=0;n<s[t][i].length;n++){let a=e[t],r=s[t][i][n],o=r[1],l=r[2],d=r[3],h=r[4];g(a)&&a.drawItem(o,l,i,c,d,h)}};const g=t=>{let e=t.getLoc(),i=getEngine();switch(e){case i.itemsFetchData.NEW_CLAN_DEPO_ITEM.loc:case i.itemsFetchData.NEW_PRIVATE_DEPO_ITEM.loc:if(i.depo){if(i.depo.getVisible()!=Math.floor(t.getX()/12))return!1}}return!0};this.deleteMessItemsByLoc=function(i){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let a in e)e[a].loc===i&&t.deleteItem(a,n)},this.deleteMessItemsByLocAndOwnId=function(i,n){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];for(let s in e)e[s].loc===i&&e[s].own===n&&t.deleteItem(s,a)}}},function(t,e){t.exports=function(){let t="ITEM",e="TPL",i={[t]:{},[e]:{}},n={[t]:{},[e]:{}};const a=()=>{Engine.items.fetch(Engine.itemsFetchData.NEW_CHAT_LINKED_ITEM,s),Engine.tpls.fetch(Engine.itemsFetchData.NEW_CHAT_LINKED_TPL,r)},s=e=>{let i=e.hid,a=n[t];a[i]||(a[i]=e)},r=t=>{let i=t.id,a=n[e];a[i]||(a[i]=t)},o=(t,e,a)=>{let s=n[e],r=i[e];s[t]?a(s[t]):r[t]||(r[t]=setTimeout(()=>{r[t]=!1},500),_g(`chat&getContent=${e}%23${t}`,()=>{a(s[t])}))},l=(t,e,i)=>{let n=$("<span>");return i=escapeHTML(i,!0),n.html(`[${i}]`),n.addClass("linked-chat-item"),c(t,e,n),n},c=(t,e,i)=>{let n=!1;i.on("mouseenter",(function(i){n=!0,$(this).hasClass("linked-chat-item-tip-created")||o(e,t,t=>{t&&($(this).data("item",t),t.setTip($(this)),$(this).addClass("linked-chat-item-tip-created"),n&&$(this).tipShow(i))})})),i.on("mouseout",t=>{n=!1}),i.on("contextmenu",(function(i,n){$(this).hasClass("linked-chat-item-tip-created")&&o(e,t,t=>{t.createOptionMenu(getE(i,n),!1,{use:!0,move:!0,attachToQuickItems:!0,moveToEnhancement:!0,shop:!0,enhance:!0,play:!0,bonus_not_selected:!0,split:!0,drop:!0,destroy:!0})})}))},d=(i,n)=>{let a=m(i,n),s=v(i,n);return a?t:s?e:(errorReport("ChatLinkedItemsManager","getKindLinkedItem","not find KindLinkedItem in string!",i),null)},h=(t,e,i,n)=>{let a,s=_(e,i),r=t.length,o=0,l=0,c=[],d=[];for(;null!==(a=s.exec(t));){let s=a.index;if(l<s){let r=t.substr(l,s-l);c.push(p(r,n)),d.push(f(t,e,a,i)),c.push(g(o,n))}else d.push(f(t,e,a,i)),c.push(g(o,n));o++,l=a.index+a[0].length}if(l!=r){let e=t.substr(l,r-1);c.push(p(e,n))}return{htmlString:c,itemsData:d}},u=(t,e,i,n)=>{let a=n?$("<div>"+e.join("")+"</div>"):$("<div>").html(e),s=[];for(let e in i){let n=i[e],s=l(t,n.hid,n.name);a.find(".item-"+e).replaceWith(s)}return a.children().each((function(){s.push($(this))})),s},p=(t,e)=>e?`<span class="text">${t}</span>`:$("<span>").text(t),g=(t,e)=>e?`<span class="mark-message-span item-${t}"></span>`:$("<span>").addClass("mark-message-span item-"+t),f=(t,e,i,n)=>{let a=i[0].split(":"),s=a[0].replace(e+"#",""),r=n?"&quot;":'"';return{name:a[1].replaceAll(r,""),hid:s}},m=(e,i)=>E(t,e,i),v=(t,i)=>E(e,t,i),E=(t,e,i)=>!!_(t,i).exec(e),_=(i,n)=>{let a;switch(i){case t:a=n?new RegExp(i+"#([0-9a-z]{64}|[0-9]{7,11}):(&quot;.*?&quot;)","g"):new RegExp(i+'#([0-9a-z]{64}|[0-9]{7,11}):(".*?")',"g");break;case e:a=n?new RegExp(i+"#([0-9]+):(&quot;.*?&quot;)","g"):new RegExp(i+'#([0-9]+):(".*?")',"g")}return a},b=()=>new RegExp(t+"#([0-9a-z]{64}|[0-9]{7,11})+(\\.[a-z]+)?","g");this.init=()=>{a()},this.checkReceiveMessageHaveLinkedItem=(t,e)=>{let i=m(t,e),n=v(t,e);return i||n},this.getReplacedStrWithoutWorldWhereHeroStay=e=>{let i=Engine.worldConfig.getWorldName(),n=new RegExp(t+"#([0-9a-z]{64}|[0-9]{7,11})+(\\."+i+")?","g");return e.replace(n,t+"#$1")},this.checkLinkedItemsAreOnlyFromWorldWhereHeroStay=t=>{let e=null,i=!0,n=b();for(;null!==(e=n.exec(t));)e[2]&&(i=!1);return i},this.checkSendMessageIsItemLinked=t=>b().exec(t),this.addEventToLinkedItemSpan=c,this.parseReceiveMessageWithLinkedItem=(t,e,i)=>{let n=d(t,e);if(null==n)return;let a=h(t,n,e,i);return u(n,a.htmlString,a.itemsData,i)},this.changeStringOn=(t,e,i,n)=>{let a,s=t.length,r=0,o=[],l={};for(;null!==(a=e.exec(t));){let e=a.index;if(r<e){let a=t.substr(r,e-r);o.push(a),o.push(i+"_"+n)}else o.push(i+"_"+n);l[n]=a[0],n++,r=a.index+a[0].length}if(r!=s){let e=t.substr(r,s-1);o.push(e)}return{htmlString:o,itemsData:l}},this.getSendMessagePattern=b}},function(t,e,i){var n=i(5),a=i(0),s=i(28);t.exports=function(){var t=this,e=!1,i={},r={appendTo:"body",helper:"clone",distance:6,delay:100,cursorAt:{top:16,left:16},scroll:!1,zIndex:20,start:function(t,e){$(this).fadeTo(200,.5),changeViewOfHelper(e.helper,$(this).data().item.id)},stop:function(t){$(this).fadeTo(200,1)}};this.getDisableSlotsList=()=>i,this.getFreeSlots=()=>{let t={};return Engine.interface.get$gameWindowPositioner().find(".usable-slot").each((function(){if($(this).children().length)return;let e=$(this),i=e.index();e.parent().hasClass("right")&&(i=3+Math.abs(i-4)),t[i+1]=e})),t},this.init=function(){Engine.items.fetch(Engine.itemsFetchData.NEW_BOTTOM_ITEM,t.newBottomItemFromFetch),Engine.interface.get$gameWindowPositioner().find(".usable-slot").droppable({accept:".item:not(.shop-item)",drop:function(e,i){var n=$(this),a=i.draggable.data("item"),s=i.draggable.parent(),r=i.draggable.hasClass("bottomItem"),o=n.children().length>0;if(!r&&o)return message(_t("place_is_not_empty"));t.newBottomItem(a,n,o,s)}})},this.setDisableSlots=t=>{i[t]||($(".bottom-panel").find(".slots, .helpers-numbers").addClass("disable-slots"),i[t]=!0)},this.setEnableSlots=t=>{delete i[t],Object.keys(i).length||$(".bottom-panel").find(".slots, .helpers-numbers").removeClass("disable-slots")},this.newBottomItem=function(e,i,a,s){var r=e.id,o=n.get("bottomPanel/"+Engine.hero.d.id+"/"+r);if(i||o){if(o){if(t.isntRightItem(e,!1))return void t.deleteExistItem(r,e)}else if(t.isntRightItem(e,!0))return;i&&o&&(a?this.changePlaceTwoItems(r,i,s):this.deleteExistItem(r,e)),t.bItemCallbacks(e),i?t.afterDrop(i,e):t.fromStorage(o,e)}},this.newBottomItemFromFetch=function(e){var i=e.id,a=n.get("bottomPanel/"+Engine.hero.d.id+"/"+i);a&&(t.isntRightItem(e,!1)?t.deleteExistItem(i,e):(t.bItemCallbacks(e),t.fromStorage(a,e)))},this.changePlaceTwoItems=function(t,e,i){var n=$(e.children().get(0)).data("item");this.deleteExistItem(t,n),this.newBottomItem(n,i)},this.afterDrop=function(e,i){var a=e.css("float"),s=e.index(),r=a[0]+s,o=t.initBottomItem(i,a,s);n.set("bottomPanel/"+Engine.hero.d.id+"/"+i.id,r),e.empty(),e.append(o)},this.fromStorage=function(e,i){var n="l"==e[0]?"left":"right",a=e[1],s=Engine.interface.get$gameWindowPositioner().find(".slots."+n).children().eq(a),r=t.initBottomItem(i,n,a);s.empty(),s.append(r)},this.initBottomItem=function(e,i,n){let a=Engine.items.createViewIcon(e.id,Engine.itemsViewData.BOTTOM_ITEM_VIEW)[0];const s=Engine.items.getAllViewsItemsById(e.id);return a.draggable(r),a.css({opacity:1}),a.data("item",e),a.attr("id","bottomItem"+e.id),a.addClass("bottomItem"),s.hover((function(){s.addClass("addHoverFromBottomItem")}),(function(){s.removeClass("addHoverFromBottomItem")})),a.click((function(){t.afterUse(e)})),a.contextmenu((function(i,n){var a={txt:_t("detach"),f:function(){t.deleteExistItem(e.id,e)}};i.clientY-=50,e.createOptionMenu(getE(i,n),a,{move:!0,attachToQuickItems:!0})})),t.setPosItem(a,i,n),a},this.isntRightItem=function(t,e){return isset(t._cachedStats.emo)?(e&&mAlert(_t("emo_alert")),!0):s.canAddToBottomPanel(t.cl)?!(!isset(t._cachedStats.expires)||!t.checkExpires())&&(e&&message(_t("item_expired_info")),!0):(e&&mAlert(_t("only_to_eat")),!0)},this.setPosItem=function(t,e,i){t.css({top:3,left:2})},this.prepareMenuToPutItemInSlot=(t,e)=>{let i=this.getFreeSlots();if(!Object.keys(i).length)return void mAlert(_t("not_have_free_slots"));let n=[];for(let e in i)this.createMenuElementToPutItemInSpecificSlot(t,e,i[e],n);Engine.interface.showPopupMenu(n,e)},this.createMenuElementToPutItemInSpecificSlot=(e,i,n,a)=>{a.push([i,()=>{t.newBottomItem(e,n)}])},this.bItemCallbacks=function(e){e.on("afterUpdate",t.afterUpdateCallback),e.on("delete",t.deleteCallback)},this.afterUpdateCallback=function(e){var i=$("#bottomItem"+this.id);i&&this.updadeViewAfterUpdateItem(i);let n=ts()/1e3;e.x==this.x&&e.y==this.y&&this._cachedStats.timelimit&&this._cachedStats.timelimit.split(",")[1]&&this._cachedStats.timelimit.split(",")[1]>n&&(console.log("change timelimit item"),t.changeOnNewItem(this))},this.deleteCallback=function(){t.changeOnNewItem(this)},this.deleteAllCallback=e=>{e.unregisterCallback("afterUpdate",t.afterUpdateCallback),e.unregisterCallback("delete",t.deleteCallback)},this.changeOnNewItem=e=>{let i=e.name,n=e.cl,a=$("#bottomItem"+e.id).parent(),s=e._cachedStats.timelimit,r=[];s&&s.split(",")[1]&&(r[0]=parseInt(s.split(",")[1]),r[1]=e),t.deleteExistItem(e.id,e);let o=Engine.heroEquipment.getHItems();for(let l in o){let c=o[l];if(i==c.name&&(n==c.cl&&!($("#bottomItem"+c.id).length>0)&&e.id!=c.id)){if(c.haveStat("custom_teleport")){if(c.getCustomTeleport()!=e.getCustomTeleport())continue}if(!s||!c._cachedStats.timelimit)return void t.newBottomItem(c,a);{let e=c._cachedStats.timelimit.split(",")[1];if(!e)return void t.newBottomItem(c,a);e=parseInt(e),r[0]>e&&(r[0]=e,r[1]=c)}}}r[1]&&(console.log(r[1].id),t.newBottomItem(r[1],a))},this.deleteExistItem=function(e,i){n.get("bottomPanel/"+Engine.hero.d.id+"/"+e)&&(n.remove("bottomPanel/"+Engine.hero.d.id+"/"+e),$("#bottomItem"+e).remove(),Engine.items.deleteViewIconIfExist(e,Engine.itemsViewData.BOTTOM_ITEM_VIEW),t.deleteAllCallback(i))},this.isActiveDroppableWindow=()=>Engine.mails||Engine.trade||Engine.depo||Engine.auctions||Engine.shop,this.doInterfaceItemAcion=function(t){var e,i=parseInt(t)-1,n="left";i>3&&(n="right",i=7-i),(e=Engine.interface.get$gameWindowPositioner().find(".slots."+n).children().eq(i).children().data("item"))&&this.afterUse(e)},this.afterUse=function(i){if(!(e||this.isActiveDroppableWindow()&&s.isConsumeCl(i.cl))){var n=a.get("afterUseBottonItem"),r=$("#bottomItem"+i.id).parent();e=!0,n.addClass("afterUseBottonItem"),r.append(n),Engine.heroEquipment.afterOneClick(i)?t.afterUseCallback(n):Engine.heroEquipment.sendUseRequest(i,(function(){t.afterUseCallback(n)}))}},this.afterUseCallback=function(t){e=!1,Engine.opt(8)?t.remove():t.fadeOut("slow",(function(){$(this).remove()}))}}},function(t,e,i){var n=i(56);function a(t){return void 0!==t}t.exports=new function(){var t=this,e={},i={},s={},r={};let o,l=0,c=!0;this.init=()=>{this.createPlaceHolderItem(),d()};const d=()=>{getEngine().interface.addCallbackToInteraceFocusList(h)},h=()=>{for(let t in e){let i=e[t];for(let t in i)i[t].setShouldDrawIcon(null)}};this.createPlaceHolderItem=()=>{Engine.imgLoader.onload("../img/def-item.gif",!1,t=>{this.placeHolderItem=t})},this.initTs=()=>{o=ts()},this.updateNoticeTop=()=>{let t=Math.round(4*Math.abs(Math.sin(4*ts()/1e3-o))*10)/10,e=Math.floor(t);t=t-e>.5?e+.5:e,t!=l?(l=t,c=!0):c=!1},this.getNoticeTop=()=>l,this.getPlaceholderItem=()=>this.placeHolderItem,this.createViewIcon=function(e,i,n){let r,o=t.getTplByIdAndLoc(e,n),l=o.$.clone(!0),c=o.loc,d=o.$canvasIcon[0],h=l.find(".canvas-icon")[0],u=h.getContext("2d"),p=l.find(".canvas-notice");if(h.width=d.width,h.height=d.height,u.drawImage(d,0,0),p.length){let t=p[0],e=t.getContext("2d");r=[l,u,h,c,t,e]}else r=[l,u,h,c];return a(s[e])||(s[e]={}),a(s[e][i])||(s[e][i]=[]),s[e][i].push(r),this.checkViewExist(i),r},this.checkViewExist=t=>{Engine.itemsViewData[t]||errorReport("TplsManager.js","createViewIcon","Unregistered viewName: "+t)},this.changePlaceHolderIconIntoNormalIcon=(t,i)=>{let n=s[t];if(!n)return;if(!e[i]||!e[i][t])return;let a=e[i][t];for(let t in n){let e=n[t];for(let t=0;t<e.length;t++){let i=a.$.clone(!0),n=a.$canvasIcon[0],s=i.find(".canvas-icon")[0],r=s.getContext("2d");s.width=n.width,s.height=n.height,r.drawImage(n,0,0),e[t][0].find(".canvas-icon").replaceWith($(s)),e[t][1]=r,e[t][2]=s}}},this.deleteViewIconIfExist=function(t,e,i){s[t]&&s[t][e]&&(this.removeAllViewInArrayByIdItemAndViewNameAndLoc(t,e,i),this.removeIdItemViewsIfEmpty(t))},this.deleteViewIcon=function(t,e,i){let n=s[t][e].length;if(a(i)){if(!a(s[t][e][i]))return console.warn("index: "+i+" of itemId: "+t+" with viewName : "+e+" not exist");s[t][e][i][0].remove(),s[t][e].splice(i,1),s[t][e].length||delete s[t][e]}else{for(let i=0;i<n;i++)s[t][e][i][0].remove();delete s[t][e]}},this.removeAllViewInArrayByIdItemAndViewNameAndLoc=function(e,i,n){let a=s[e][i];for(let s=0;s<a.length;s++){a[s][3]==n&&(t.deleteViewIcon(e,i,s),s--)}},this.deleteViewWithAllIcon=function(t,e){if(s[t]){for(let i in s[t])this.removeAllViewInArrayByIdItemAndViewNameAndLoc(t,i,e);this.removeIdItemViewsIfEmpty(t)}},this.removeIdItemViewsIfEmpty=function(t){Object.keys(s[t]).length||delete s[t]},this.addAndGetIdToFetchPackageController=function(t){let e=0;for(;r[e];)e++;r[e]={};for(let i in t){let n=t[i].loc;n&&(a(r[e][n])||(r[e][n]=0),r[e][n]++)}return e},this.getFetchPackageController=function(){return r},this.decreaseFetchPackageController=function(t,e){r[t][e]--,r[t][e]<1&&delete r[t][e],this.checkClearFetchPackageController(t)},this.checkClearFetchPackageController=t=>{r[t]&&(Object.keys(r[t]).length||delete r[t])},this.checkFetchFinish=function(e,i){return t.decreaseFetchPackageController(e,i),!r[e]||!a(r[e][i])},this.updateDATA=function(e){let i=t.addAndGetIdToFetchPackageController(e);for(var n in e)this.checkExist(n,e[n])&&this.deleteTpl(e[n].loc,n),this.newTpl(n,e[n],i,!0);this.checkClearFetchPackageController(i)},this.checkExist=function(t,i){var n=i.loc,s=e[n];return!(!a(s)||!a(s[t]))&&s[t]},this.newTpl=function(t,i,s,r){let o=new n(t,i,"tpl"),l=i.loc;a(e[l])||(e[l]={}),e[l][t]=o,o.setIdFetchPackage(s),o.update(i),r&&o.firstGetNow()},this.deleteTpl=function(i,n){a(e[i][n])&&(e[i][n].beforeDelete(),Engine.stickyTips.deleteIfExist(n),t.deleteViewWithAllIcon(n,i),delete e[i][n])},this.newTplInLocation=function(e,n,s){let r=t.checkFetchFinish(s,n.loc);if(a(i[e]))for(var o in i[e])t.delayLocationCallbacks(n,e,o,r)},this.delayLocationCallbacks=function(t,e,n,a){(0,i[e][n])(t,a)},this.fetchLocationTpls=function(t){var i=[];if(a(e[t])){var n=e[t];for(var s in n){let t=n[s].loc;e[t]&&e[t][s]&&i.push(n[s])}}return i},this.addCallback=function(t,e,n){a(i[t])||(i[t]={}),i[t][e]?console.error("[TplsManager.js, addCallback] Fetch callback already use!",e):i[t][e]=n},this.removeCallback=function(t){let e=t.loc.split(","),n=t.k;a(i[e])?(delete i[e][n],Object.keys(i[e]).length||delete i[e]):console.error("[TplsManager.js, removeCallback] Fetch callback not exist!",n)},this.fetch=function(e,i){let n=e.loc.split(","),a=e.k;if("function"==typeof i)for(var s=0;s<n.length;s++){t.addCallback(n[s],a,i);var r=t.fetchLocationTpls(n[s]);let e=r.length-1;for(var o in r){let t=e==o;i(r[o],t)}}},this.parseTplStat=function(t){t=t.split(";");for(var e={},i=0;i<t.length;i++){var n=t[i].split("=");e[n[0]]=a(n[1])?n[1]:null}return e},this.changeItemAmount=function(e,i,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var s,r=i.find(".amount");if(r.length>0)s=parseInt(r.html())*n,r.html(roundShorten(s));else{if(1==n)return;var o=$("<div>").addClass("amount");s=n,o.html(roundShorten(s)),i.append(o)}t.changeAmountInTip(e,i,s,{recalcPrice:a,serverAmount:n})},this.changeAmountInTip=function(t,e,i,n){let{recalcPrice:s=!1,serverAmount:r}=n;i=formNumberToNumbersGroup(i);const o=t.getTipContent();var l=$("<div>").append(o);if(l.find(".amount").remove(),l.find(".item").append($("<div>").html(i).addClass("amount")),s){const e=t.pr*r;l.find(".value-item .val").text(round(e,e<1e4?10:2))}var c=l.find(".amount-text");if(c.length>0)c.html(i);else{var d=a(t._cachedStats.cursed),h=[_t("cursed_amount %val%",{"%val%":""}),_t("amount %val% %split%",{"%val%":"","%split%":""})][d?0:1],u=l.siblings(".s-4"),p=$("<span>").html(h),g=$("<span>").addClass("damage");if(c=$("<span>").html(i).addClass("amount-text"),g.append(c),p.append(g),u.length>0)u.append(p);else{(u=$("<div>").addClass("item-tip-section s-4")).append(p);const t=l.children();t.push(u[0]),t.sort((t,e)=>{const i=$(t).attr("class").toLowerCase(),n=$(e).attr("class").toLowerCase();return i<n?-1:i>n?1:0}),l=$("<div>").html(t)}}t.setTip(e,l[0].innerHTML,{forceNewId:!0})},this.onClear=function(){},this.deleteMessItemsByLoc=function(i){if(a(e[i])){var n=e[i];for(var s in n)t.deleteTpl(i,s)}},this.getTplByIdAndLoc=function(t,i){if(i){let n=e[i];for(let a in n)if(a==t)return e[i][a];return null}},this.getAllTpls=function(t){return e.hasOwnProperty(t)?e[t]:{}},this.test=function(){return{tpls:e,callbacks:i}},this.update=function(t){let i={};for(let n in s)for(let a in s[n]){let r=s[n][a][0][3];i[n]||(i[n]=[]),i[n].indexOf(r)<0&&(e[r][n].updateDraw(t),i[n].push(r))}},this.drawItems=function(){for(let t in s)for(let i in s[t])for(let n=0;n<s[t][i].length;n++){let a=s[t][i][n][1],r=s[t][i][n][2],o=s[t][i][n][3],l=s[t][i][n][4],d=s[t][i][n][5];e[o][t].drawItem(a,r,i,c,l,d)}},this.getViewByIdAndLoc=function(t,e){let i=s[t];if(a(i[e]))return i[e][0][0]},this.getAllViewsById=function(t){let e=[],i=s[t];for(let t in i){let n=i[t];for(let t=0;t<n.length;t++)e.push(n[t][0])}return e},this.updateTrackHighlights=()=>{for(let t in e)for(let i in e[t]){e[t][i].$.find(".highlight").removeClass("track"),0!==this.getAllViewsById(i).length&&this.getAllViewsById(i)[0].find(".highlight").removeClass("track")}},this.getViews=function(){return s},this.getViewById=function(t){return s[t]}}},function(t,e){t.exports=function(){let t=[],e=[],i=[],n=[],a=null,s=null;let r={x:null,y:null,maxX:null,maxY:null};this.add=function(){for(var o=0;o<arguments.length;o++){let l=arguments[o];if(l.alwaysDraw||r.x<l.rx&&l.rx<r.maxX&&r.y<l.ry&&l.ry<r.maxY){let r=l.getOrder();if(r>2e4){if(20004==r){e.push(l);continue}if(20001==r){i.push(l);continue}if(20003==r){s=l;continue}if(20002==r){a=l;continue}}t.push(l),l.collider&&n.indexOf(l)<0&&n.push(l)}}},this.updateScreenSize=(t,e)=>{e?this.setDefaultScreenSize():this.setScreenSize(t.x,t.y,t.maxX,t.maxY)},this.setDefaultScreenSize=()=>{this.setScreenSize(0,0,3200,3200)},this.setScreenSize=(t,e,i,n)=>{r={x:t,y:e,maxX:i,maxY:n}},this.draw=function(n){t.sort((function(t,e){var i=t.getOrder()-e.getOrder();return 0==i&&t.d&&e.d?t.d.id>e.d.id?i+.2:i-.2:i}));for(var r=0;r<t.length;r++)t[r].draw(n);for(let t=0;t<i.length;t++)i[t].draw(n);a&&a.draw(n),s&&s.draw(n);for(let t=0;t<e.length;t++)e[t].draw(n);this.updateColliders(),o()},this.updateColliders=function(){for(var e=[],i=n.length-1;i>=0;i--)t.indexOf(n[i])<0&&e.push(n[i]);for(i=0;i<e.length;i++)n.splice(n.indexOf(e[i]),1);n.sort((function(t,e){return e.getOrder()-t.getOrder()}))},this.getCollisionsAt=function(t,e){for(var i=[],a=0;a<n.length;a++)if(n[a].collider)if(n[a].collider.box){var s=n[a].collider.box;t>s[0]&&e>s[1]&&t<s[2]&&e<s[3]&&i.push(n[a])}else i.push(n[a]);return i},this.getHighestOrderWithoutSort=()=>20004,this.getWeatherOrderWithoutSort=()=>20001,this.getWeatherOrderWithoutSort=()=>20001,this.getQuestMapOrderWithoutSort=()=>20003,this.getNightOrderWithoutSort=()=>20002;const o=()=>{t=[],i=[],e=[],a=null,s=null};this.onClear=function(){n=[],o()}}},function(t,e,i){let n=i(1);t.exports=function(){var t=[],e=this;this.test=function(){return t},this.topHoverObject=null,this.hoverCheck=function(t,i){e.topHoverObject!=i&&(e.topHoverObject&&e.topHoverObject.onhover&&e.topHoverObject.onhover(t,!1),e.topHoverObject=i,isset(i)&&isset(i.onhover)&&Engine.rajCharacterHide.checkShowTip(i)&&i.onhover(t,!0),i&&i.tip&&i.tip[0]?(e.checkObjectIsNpc(i)&&i.refreshTip(),Engine.rajCharacterHide.checkShowTip(i)&&Engine.canvasTip.show(t,e.topHoverObject)):Engine.canvasTip.hide(t))},this.addToClickEventsMenu=function(t,e,i){let a;switch(e.canvasObjectType){case n.FAKE_NPC:case n.NPC:case n.OTHER:case n.HERO:a=e.d.nick;break;case n.PET:a=e.d.name;break;case n.M_ITEM:a=e.i.name;break;case n.GATEWAY:a=_t("gw");break;default:errorReport("EventCollider","addToClickEventsMenu","Incorrect CanvasObjectTypeData "+e.canvasObjectType),a=e.canvasObjectType}t.push([a,function(){e.oncontextmenu(i)}])},this.dispatch=function(t,i,n){if(!Engine.allInit)return[];var a=Engine.renderer.getCollisionsAt(i,n);this.hoverCheck(t,a[0]);var s="on"+t.type;if(Engine.interfaceStart){switch(t.type){case"mouseup":case"mousedown":case"mousemove":for(var r=0;r<a.length;r++){if(a[r][s])if(!a[r][s](t))break}break;case"click":{getEngine().setLastClickOnCanvas([t,i,n]),getEngine().hero.setStartClickOnMapMove(!0);let o=this.checkIsNormalNpcFromListAndGet(a),l=e.checkIsNpcAndGatewayOnList(a),c=Engine.hero.getRefFollowObj();!o&&c&&Engine.hero.clearRefFollowObj();for(r=0;r<a.length;r++){if(!a[r][s])continue;if(!isset(a[r][s]))continue;let i=e.checkObjectIsGateway(a[r]);if(!l||!i){if(Engine.canvasFocus.getActive()){if(this.checkObjectIsNpc(a[r])){a[r].onclick(t);break}}if(!a[r][s](t))break}}break}case"contextmenu":getEngine().setLastClickOnCanvas([t,i,n]),getEngine().hero.setStartClickOnMapMove(!0);var o=[];for(r=0;r<a.length;r++){var l=this.checkType(a[r])?a[r].canvasObjectType:null;if(a[r][s])if(l)e.addToClickEventsMenu(o,a[r],t);else{if(isset(a[r].gateways))continue;a[r][s](t)}}if(o.length>0)if(1==o.length){let e=this.checkIsNormalNpcFromListAndGet(a);if(e){let t=e.d.type;0==t||5==t||6==t||7==t||e.getFollowController().addFollowGlow()}o[0][1](t)}else Engine.interface.showPopupMenu(o,t)}return a}},this.samePos=function(t,e){return t.d.x==e.d.x&&t.d.y==e.d.y},this.checkObjectIsNpc=t=>t.canvasObjectType==n.NPC,this.checkObjectIsGateway=t=>t.canvasObjectType==n.GATEWAY,this.checkIsNormalNpcFromListAndGet=function(t){for(let e=0;e<t.length;e++)if(t[e].canvasObjectType==n.NPC)return t[e];return!1},this.checkIsNpcAndGatewayOnList=function(t){let i=!1,n=!1;for(let a=0;a<t.length;a++)e.checkObjectIsGateway(t[a])&&(n=!0),e.checkObjectIsNpc(t[a])&&(i=!0);return i&&n},this.getMapFromList=function(t){for(let e=0;e<t.length;e++)if(t[e].canvasObjectType==n.MAP)return t[e]},this.checkType=t=>{if(!isset(t.canvasObjectType))return!1;if(t.canvasObjectType==n.PET){let e=this.getEngine();if(t.d.master.d.id!=e.hero.d.id)return!1}return!0},this.getEngine=()=>Engine}},function(t,e){t.exports=new function(){var t=null,e=!0,i=20,n=this;this.start=function(){if(!t){var i=[_t("server_connection_fail",null,"reload"),_t("auto_reload in",null,"reload")];e=!1,Engine.stopJSONInterval(),Engine.lock.add("reconnect"),log(i[0]),log(i[1]),t=setInterval(this.countDown,1e3)}},this.stop=function(){t&&(clearInterval(t),t=null,i=20)},this.stateInterval=function(){return t},this.countDown=function(){i<=0?window.location.reload():(i--,Engine.console.wnd.$.find("#reconnectInfo").html(i+"s"),_g("_",n.success))},this.success=function(){if(!e){var t=Engine.console.wnd.$;e=!0,t.find("#reconnectInfo").removeAttr("id"),Engine.lock.remove("reconnect"),Engine.startGameThread()}},this.disconnect=function(t){var e=t.status;200!=e&&0!=e||Engine.reconnect.start()}}},function(t,e,i){let n=i(402),a=i(122),s=(i(21),i(3)),r=i(4);t.exports=new function(){let t="WeatherManager.js",e=[],i={},o=this;this.mapSize=null;let l=null,c=null,d=[a.weather.BUBBLE,a.weather.RAIN,a.weather.SNOW];var h={meduza:{orientationY:!0,yDir:0},bat:{speedY:1.5},batpumpupdown:{orientationY:!0,speedX:1.5},batskullupdown:{orientationY:!0},batupdown:{orientationY:!0}};const u=()=>{const e=a.weather;c=new r,c.init(t,{createFunc:p,removeFunc:g,createRequire:{name:{specificVal:[e.SNOW,e.RAIN,e.BUBBLE,e.FISH,e.LIGHT,e.BAT,e.HALLOWEEN_BAT,e.LATERN]}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_NAME)};this.getActualWeather=()=>i,this.setMapSize=function(){Engine.map.size&&(this.mapSize=Engine.map.size)},this.onClear=()=>{for(var t in e)delete e[t];e=[],m()},this.update=function(t){for(var i in e)e[i].update(t)};const p=t=>{let e=t.name;this.setMapSize(),this.mapSize&&this.createObjects(e,t)},g=t=>{let i=t.name;for(let t=0;t<e.length;t++)e[t].getType()==i&&(e.splice(t,1),t--);f(i)};this.setActualWeather=(t,e)=>{i[t]=e};const f=t=>{delete i[t]},m=()=>{i={}};this.createObjects=(t,e)=>{let i=this.createGroups(t),n=this.getAmountOfObjects(t);this.setActualWeather(t,n),i?this.createGroupFallObject(i,t,n):this.createNormalFallObjects(n,t,e)},this.createGroupFallObject=(t,i,s)=>{var r=0;for(let l=0;l<s;l++){let s=t[r],l=new n(o,a.weather.FISH,i,s);l.createObject(),e.push(l),r==t.length-1?(r=0,t=[],o["create"+i+"Set"](t)):r++}},this.createNormalFallObjects=(t,i,a)=>{for(let s=0;s<t;s++){let t=new n(o,i,i,a||{});t.createObject(),e.push(t)}},this.removeNormalFallObjects=(t,i)=>{for(;t>0;){let n=e.length-1,a=Math.round(n*Math.random());i==e[a].getType()&&(e.splice(a,1),t--)}},this.createGroups=e=>{let i=[];switch(e){case a.weather.BUBBLE:case a.weather.RAIN:case a.weather.SNOW:case a.weather.SNOWSTORM:return null;case a.weather.FISH:o.createFishSet(i);break;case a.weather.HALLOWEEN_BAT:o.createHalloweenBatSet(i);break;case a.weather.BAT:o.createBatSet(i);break;case a.weather.LIGHT:o.createLightSet(i);break;case a.weather.LATERN:o.createLaternSet(i);break;default:return errorReport(t,"createGroups",`Incorrect kind of weather: "${e}" not exist! Possible weather`,a.weather),null}return i.length?i:(console.error("Object weather group is empty "+e),null)},this.createLaternSet=function(t){o.createMapPos(1,1,1,t,4,"lampion")},this.createLightSet=function(t){o.createMapPos(1,1,1,t,0,"light"),o.createMapPos(1,1,1,t,0,"lightconstant")},this.createHalloweenBatSet=function(t){o.createMapPos(1,1,1,t,0,"batpump"),o.createMapPos(1,1,1,t,0,"batskull"),o.createMapPos(1,1,1,t,0,"bat"),o.createMapPos(1,1,1,t,0,"batpumpupdown"),o.createMapPos(1,1,1,t,0,"batskullupdown"),o.createMapPos(1,1,1,t,0,"batupdown"),o.createMapPos(1,1,1,t,0,"batpumpupdown"),o.createMapPos(1,1,1,t,0,"batskullupdown"),o.createMapPos(1,1,1,t,0,"batupdown")},this.createBatSet=function(t){o.createMapPos(1,1,1,t,0,"bat"),o.createMapPos(1,1,1,t,0,"batupdown"),o.createMapPos(1,1,1,t,0,"batupdown")},this.createFishSet=function(t){o.createMapPos(5,3,3,t,2,"rybka"),o.createMapPos(3,3,3,t,2,"kalamarnica"),o.createMapPos(3,1,3,t,1,"rekin"),o.createMapPos(3,2,2,t,0,"krewetka"),o.createMapPos(3,3,3,t,2,"meduza"),o.createMapPos(2,1,3,t,1,"wegorz"),o.createMapPos(1,3,3,t,1,"wengorz")},this.createMapPos=function(e,i,n,a,s,r){if(e>i*n)warningReport(t,"createMapPos","impossible",r);else{for(var l=[],c=0;c<e;c++){var d;do{d=Math.round(Math.random()*i*n)}while(l.indexOf(d)>-1);l.push(d)}var h,u=o.checkConfig(r,"orientationY",!1),p=u?[.01,1]:[1,.01],g=u?[.5,3]:[3,.5],f=o.checkConfig(r,"xDir",Math.round(Math.random())),m=o.checkConfig(r,"yDir",Math.round(Math.random())),v=Math.max(5,Math.random()*o.mapSize.x-5),E=Math.max(.1,Math.random()*o.mapSize.y),_=Math.max(p[0],Math.random()*g[0]),b=Math.max(p[1],Math.random()*g[1]);h=u?0==m?"U":"D":0==f?"L":"R";for(c=0;c<l.length;c++){var w=l[c],C=Math.floor(w/i),T=v+C,y=E+w-C,I=Math.round(Math.random()*s);a.push({startPos:o.checkConfig(r,"startPos",{x:y,y:T}),speedX:o.checkConfig(r,"speedX",_*(f?1:-1)),speedY:o.checkConfig(r,"speedY",b*(m?1:-1)),icon:o.checkConfig(r,"icon",h+r+I+".gif")})}}},this.checkConfig=function(t,e,i){return isset(h[t])&&isset(h[t][e])?h[t][e]:i},this.updateDataWeatherFromRayController=t=>{if(c.checkCorrectMainData(t))for(let e in t.list){let i=t.list[e];c.updateData(i)}},this.getData=()=>{},this.getDrawableList=function(){return Engine.settings&&Engine.settings.checkTurnOnWeatherAndEventEffects()?e:[]},this.onResize=(t,e,i)=>{l&&clearTimeout(l),l=setTimeout(()=>{i&&this.increaseSize(),0==i&&this.decreaseSize(),l=null},200)},this.getAmountOfObjects=e=>{var i=(Engine.map.getMaxX()-Engine.map.getMinX())*(Engine.map.getMaxY()-Engine.map.getMinY());let n=this.mapSize.x*this.mapSize.y;switch(i||(i=260),e){case a.weather.BUBBLE:return Math.floor(i/20);case a.weather.RAIN:case a.weather.SNOW:return Math.floor(i/10);case a.weather.FISH:return Math.floor(n/100);case a.weather.BAT:case a.weather.HALLOWEEN_BAT:case a.weather.LIGHT:case a.weather.LATERN:return Math.floor(n/180);default:return errorReport(t,"getAmountOfObjects",`Incorrect kind of weather: "${e}" not exist! Possible weather`,a.weather)}},this.increaseSize=()=>{for(let t in i){if(!d.includes(t))continue;let e=i[t],n=this.getAmountOfObjects(t),a=n-e;if(a>0){let e=this.getDataOfRandomFallObjectByKind(t);this.createNormalFallObjects(a,t,e),this.setActualWeather(t,n)}}},this.getDataOfRandomFallObjectByKind=t=>{if(!e.length)return{action:s.CREATE,kind:t};let i=0,n=e.length-1;for(;10!=i;){let a=Math.round(n*Math.random()),s=e[a];if(s.getKind()==t)return copyStructure(s.getData());i++}return{action:s.CREATE,kind:t}},this.decreaseSize=()=>{for(let t in i){if(!d.includes(t))continue;let e=i[t],n=this.getAmountOfObjects(t),a=e-n;a>0&&(this.removeNormalFallObjects(a,t),this.setActualWeather(t,n))}},this.init=()=>{u()}}},function(t,e,i){let n=i(122);t.exports=function(t,e,i,a){var s=this;this.startFadeOut=null,this.startFadeIn=null,this.opacity=1,this.timePassed=0;let r=null;this.update=function(t){this["update"+e](t)},this.setSpeed=function(){s["setSpeed"+e]()},this.setSize=function(){this["setSize"+e]()},this.draw=function(t){let i=Engine.map.getMinLeftMaxLeftAndMinTopMaxTop(),n=32*this.rx+16-this.fw/2-Engine.map.offset[0],a=32*this.ry-this.fw+32-Engine.map.offset[1];n<i.minLeft||n>i.maxLeft||a<i.minTop||a>i.maxTop||(t.beginPath(),this["draw"+e](t,n,a))},this.updateRain=function(t){this.ry=this.ry+this.sppedY*t,this.rx=this.rx+this.sppedX*t,this.ry>this.startY+this.lengthWay&&this.setPos(),this.ry<-10&&this.setPos()},this.updateFish=function(e){this.drawObject(e),this.ry=this.ry+this.sppedY*e,this.rx=this.rx+this.sppedX*e,this.rx<-1&&(this.rx=t.mapSize.x-2),this.rx>t.mapSize.x+1&&(this.rx=0),this.ry<-1&&(this.ry=t.mapSize.y),this.ry>t.mapSize.y+1&&(this.ry=0)},this.updateSnow=function(t){this.startFadeIn>this.ry&&(this.opacity+=2*t),this.startFadeOut<this.ry&&(this.opacity-=2*t),this.ry=this.ry+this.sppedY*t,this.rx=this.rx+this.sppedX*t,(this.objectIsOutOfScreenArea()||this.ry>this.startY+this.lengthWay)&&(this.setPos(),this.setOpacity())},this.updateBubble=function(t){this.ry=this.ry+this.sppedY*t,this.rx=this.rx+this.sppedX*t;var e=(new Date).getTime();s.widthScale=.1*Math.sin(e/200)+this.sppedY,s.heightScale=-1*Math.sin(e/200)*.1+this.sppedY,this.objectIsOutOfScreenArea()&&(this.setPos(),this.setOpacity())},this.objectIsOutOfScreenArea=()=>{let t=Engine.map.getMinX()-1,e=Engine.map.getMaxX(),i=Engine.map.getMinY()-5,n=Engine.map.getMaxY();return this.ry<i||this.ry>n||this.rx<t||this.rx>e},this.drawRain=function(t,e,i){let n=Engine.mapShift.getShift(),a=e-n[0],r=i-n[1];t.strokeStyle="white",t.moveTo(a,i),t.lineTo(a+s.fw,r+s.fh),t.stroke()},this.drawFish=function(t){if(this.objectIsOutOfScreenArea())return;let e=Engine.mapShift.getShift();var i=32*this.rx+16-this.fw/2-Engine.map.offset[0]-e[0],n=32*this.ry-this.fw+32-Engine.map.offset[1]-e[1];if(this.sprite&&void 0!==this.activeFrame&&this.frames.length>0){i=Math.round(i),n=Math.round(n);let e=Engine.map.clipObject(i,n,this.fw,this.fh);e&&t.drawImage(this.sprite,0+e.backgroundPositionX,0+this.activeFrame*this.fh+e.backgroundPositionY,e.width,e.height,e.left,e.top,e.width,e.height)}},this.drawSnow=function(t,e,i){let n=Engine.mapShift.getShift(),a=e-n[0],r=i-n[1];t.arc(a,r,s.fw,0,2*Math.PI),t.fillStyle="white",t.fill()};let o=null;this.createMask=()=>{o=document.createElement("canvas"),o.width=10,o.height=10;let t=o.getContext("2d");t.arc(5,5,s.fw,0,2*Math.PI),t.fillStyle="white",t.fill(),t.strokeStyle="gray",t.lineWidth=.4,t.stroke()},this.drawSnowstorm=function(t,e,i){let n=Engine.mapShift.getShift(),a=e-n[0],r=i-n[1];t.globalAlpha=this.opacity,t.arc(a,r,s.fw,0,2*Math.PI),t.fillStyle="white",t.fill()};this.drawBubble=function(t,e,i){let n=Engine.mapShift.getShift(),a=Math.round(e-n[0]),s=Math.round(i-n[1]);{if(!r){let t=getRandomElementFromArray([20,19,18,15,14]);r=(t=>{let e=document.createElement("canvas"),i=e.getContext("2d"),n=e.width/2,a=e.height/2;return i.save(),i.translate(n,a),i.scale(1,1),i.arc(0,0,t/2-2,0,2*Math.PI,!1),i.restore(),i.globalAlpha=.7,i.fillStyle="#8ED6FF",i.fill(),i.lineWidth=2,i.strokeStyle="#555",i.stroke(),i.beginPath(),i.save(),i.translate(n,a),i.scale(1,1),i.arc(1,1,t/10,0,2*Math.PI,!1),i.restore(),i.fillStyle="white",i.fill(),i.globalAlpha=1,e})(t)}let e=Engine.map.clipObject(a,s,r.width,r.height);if(!e)return;t.drawImage(r,e.backgroundPositionX,e.backgroundPositionY,e.width,e.height,e.left,e.top,e.width,e.height)}},this.getKind=function(){return e},this.getType=function(){return i},this.getData=function(){return a},this.setSpeedRain=function(){let t=isset(a.speedX)?a.speedX:1,e=isset(a.speedY)?a.speedY:1;s.sppedX=.2*Math.random()*t,s.sppedY=(7+5*Math.random())*e},this.setSpeedSnow=function(){let t=isset(a.speedX)?a.speedX:1,e=isset(a.speedY)?a.speedY:1;s.sppedX=(0+Math.random())*t,s.sppedY=(.5+Math.random())*e},this.setSpeedBubble=function(){let t=isset(a.speedX)?a.speedX:1,e=isset(a.speedY)?a.speedY:1;s.sppedX=.1*Math.random()*t,s.sppedY=-.8*Math.random()*e},this.setSpeedFish=function(){s.sppedX=a.speedX,s.sppedY=a.speedY},this.setSizeRain=function(){var t=[[.5,6],[.5,10],[.5,12]],e=Math.floor(3*Math.random());s.fw=t[e][0],s.fh=t[e][1]},this.setSizeSnow=function(){var t=[2,2.5,3],e=Math.floor(3*Math.random());s.fw=t[e],s.fh=t[e]},this.setSizeBubble=function(){var t=[[1,2],[2,7],[7,2]],e=Math.floor(3*Math.random());s.fw=t[e][0],s.fh=t[e][1]},this.setSizeFish=function(){var t=[[1,2],[2,7],[7,2]],e=Math.floor(3*Math.random());s.fw=t[e][0],s.fh=t[e][1]},this.setOpacity=function(){e!=n.weather.RAIN&&(s.opacity=0,s.startFadeOut=s.ry+.8*s.lengthWay,s.startFadeIn=s.ry+.2*s.lengthWay)},this.setPosOld=function(){isset(a.startPos)?(s.rx=a.startPos.x,s.ry=a.startPos.y):(s.rx=Math.random()*t.mapSize.x,s.ry=Math.random()*t.mapSize.y-2),s.startY=s.ry},this.setPos=function(){if(isset(a.startPos))s.rx=a.startPos.x,s.ry=a.startPos.y;else{let t=Engine.map.getMinX(),e=Engine.map.getMinY()-5,i=Engine.map.getMaxX(),n=Engine.map.getMaxY();s.rx=t+Math.random()*(i-t),s.ry=e+Math.random()*(n-e)}s.startY=s.ry},this.changeDir=function(){this.sppedX=-1*this.sppedX},this.setDir=function(){e!=n.weather.FISH&&(Math.round(Math.random())&&this.changeDir())},this.setLengthWay=function(){e==n.weather.FISH?this.lengthWay=10:this.lengthWay=20},this.drawObject=function(t){this.frames&&this.frames.length>1&&!IE&&(this.timePassed+=100*t,this.frames[this.activeFrame].delay<this.timePassed&&(this.timePassed=this.timePassed-this.frames[this.activeFrame].delay,this.activeFrame=this.frames.length==this.activeFrame+1?0:this.activeFrame+1))},this.getOrder=function(){return getEngine().renderer.getWeatherOrderWithoutSort()},this.setIcon=function(){if(isset(a.icon)){var t=CFG.r_fpath+"fish/"+a.icon;Engine.imgLoader.onload(t,{speed:!1,externalSource:cdnUrl},(t,e)=>{s.beforeOnload(e,t)})}},this.beforeOnload=(t,e)=>{s.fw=t.hdr.width,s.fh=t.hdr.height,s.frames=t.frames,s.activeFrame=0,s.sprite=e},this.createObject=function(){s.setPos(),s.setSpeed(),s.setSize(),s.setLengthWay(),s.setOpacity(),s.setDir(),s.setIcon()}}},function(t,e,i){let n=i(3),a=i(4);t.exports=function(){let t,e="MapFilter.js";const i=()=>{const i=n.TYPE;t=new a,t.init(e,{createFunc:r,clearFunc:s,createRequire:{color:{type:i.RGBA_COLOR}}},n.GROUP_NAME.OVERRIDE_OBJECT)},s=()=>{$(".filter-map-weather").css("display","none")},r=t=>{let e=$(".filter-map-weather");e.css("display","block"),e.css("background",`rgba(${t.color.r},${t.color.g},${t.color.b},${t.color.a})`)};this.init=()=>{i()},this.updateData=(e,i)=>{t.checkCorrectMainData(e,i)&&t.updateData(e)},this.onClear=()=>{s()}}},function(t,e,i){let n=i(95),a=i(26),s=i(7);t.exports=function(){var t,e=this;this.hotKeys=null,this.init=function(){this.initDefaultHotKeys(),this.hotKeys={},this.rebuildHotKeys()},this.initDefaultHotKeys=function(){let i=Engine.widgetsData.name;t={[n.name.move_up]:["W",!1,n.type.LABEL,!1,n.group.MOVE],[n.name.move_down]:["S",!1,n.type.LABEL,!1,n.group.MOVE],[n.name.move_left]:["A",!1,n.type.LABEL,!1,n.group.MOVE],[n.name.move_right]:["D",!1,n.type.LABEL,!1,n.group.MOVE],[n.name.hotAttackNearMob]:["Q",".widget-button:has(.icon.attack-near-mob):not(.from-settings-panel)",n.type.TIP,i.ATTACK_MOB,n.group.FIGHT],[n.name.autofightNearMob]:[!1,".widget-button:has(.icon.auto-fight-near-mob):not(.from-settings-panel)",n.type.TIP,i.ATTACK_MOB_AUTO,n.group.FIGHT],[n.name.hotAttackNearPlayer]:["X",".widget-button:has(.icon.attack-near-player):not(.from-settings-panel)",n.type.TIP,i.ATTACK_PLAYER,n.group.FIGHT],[n.name.hotChangeTarget]:[!1,".change-target-btn",n.type.LABEL,!1,n.group.FIGHT],[n.name.hotAutoFight]:["F",".auto-fight-btn",n.type.LABEL,!1,n.group.FIGHT],[n.name.hotAcceptLoot]:[!1,".bottom-wrapper>.table-wrapper>.accept-button>.button",n.type.LABEL,!1,n.group.FIGHT],[n.name.toggleBattlePanel]:["B",".toggle-battle",n.type.TIP,!1,n.group.FIGHT],[n.name.hotCloseFight]:["Z",".close-battle-ground",n.type.LABEL,!1,n.group.FIGHT],[n.name.showLog]:["H",!1,n.type.TIP,i.BATTLE_LOG,n.group.FIGHT],[n.name.iconglobe]:["M",".widget-button:has(.icon.globe):not(.from-settings-panel)",n.type.TIP,i.MAP,n.group.MAP],[n.name.hotportablemap]:["E",".widget-button:has(.icon.portable-map-icon):not(.from-settings-panel)",n.type.TIP,i.MINI_MAP,n.group.MAP],[n.name.iconcompass]:[!1,".widget-button:has(.icon.compass):not(.from-settings-panel)",n.type.TIP,i.WHO_IS_HERE,n.group.MAP],[n.name.goGateway]:[!1,".widget-button:has(.icon.go-gateway):not(.from-settings-panel)",n.type.TIP,i.USE_DOOR,n.group.MAP],[n.name.hotTalkNearMob]:["R",".widget-button:has(.icon.npc-talk-icon):not(.from-settings-panel)",n.type.TIP,i.TALK,n.group.MAP],[n.name.iconchat]:["C",".widget-button:has(.icon.chat):not(.from-settings-panel)",n.type.TIP,i.CHAT,n.group.SOCIAL],[n.name.iconclans]:["K",".widget-button:has(.icon.clans):not(.from-settings-panel)",n.type.TIP,i.CLAN,n.group.SOCIAL],[n.name.iconfriends]:["P",".widget-button:has(.icon.friends):not(.from-settings-panel)",n.type.TIP,i.COMMUNITY,n.group.SOCIAL],[n.name.iconparty]:["G",".widget-button:has(.icon.party):not(.from-settings-panel)",n.type.TIP,i.PARTY,n.group.SOCIAL],[n.name.quickParty]:["V",!1,n.type.TIP,i.QUICK_PARTY,n.group.SOCIAL],[n.name.clanSendMessage]:[!1,".widget-button:has(.icon.send-clan-msg):not(.from-settings-panel)",n.type.TIP,i.CLAN_MSG,n.group.SOCIAL],[n.name.iconconfig]:[!1,".widget-button:has(.icon.config):not(.from-settings-panel)",n.type.TIP,i.SETTINGS,n.group.OTHER],[n.name.iconWindows]:[!1,".widget-button:has(.icon.windows):not(.from-settings-panel)",n.type.TIP,i.FULL_SCREEN,n.group.OTHER],[n.name.iconpuzzle]:[!1,".widget-button:has(.icon.puzzle):not(.from-settings-panel)",n.type.TIP,i.ADDONS,n.group.OTHER],[n.name.iconconsole]:["`",".widget-button:has(.icon.console):not(.from-settings-panel)",n.type.TIP,i.CONSOLE,n.group.OTHER],[n.name.eqcolumnshow]:[!1,".widget-button:has(.icon.eq-show-icon):not(.from-settings-panel)",n.type.TIP,i.EQ_TOGGLE,n.group.OTHER],[n.name.showhideStats]:[!1,".stats-expand",n.type.LABEL,!1,n.group.OTHER],[n.name.hotAuction]:[!1,".game-window-positioner .auctions-bar-put .put-button",n.type.LABEL,!1,n.group.OTHER],[n.name.iconphoto]:[!1,".widget-button:has(.icon.photo):not(.from-settings-panel)",n.type.TIP,i.CRAFTING,n.group.OTHER],[n.name.iconscroll]:["T",".widget-button:has(.icon.scroll):not(.from-settings-panel)",n.type.TIP,i.QUEST_LOG,n.group.OTHER],[n.name.iconskills]:["U",".widget-button:has(.icon.skills):not(.from-settings-panel)",n.type.TIP,i.SKILLS,n.group.OTHER],[n.name.iconexit]:["L",".widget-button:has(.icon.exit):not(.from-settings-panel)",n.type.TIP,i.EXIT,n.group.OTHER],[n.name.iconstar]:[!1,".widget-button:has(.icon.star):not(.from-settings-panel)",n.type.TIP,i.PREMIUM,n.group.OTHER],[n.name.world]:[!1,".widget-button:has(.icon.world-icon):not(.from-settings-panel)",n.type.TIP,i.WORLD,n.group.SOCIAL]},isPl()&&(t[n.name.news]=[!1,".widget-button:has(.icon.news-icon):not(.from-settings-panel)",n.type.TIP,i.NEWS,n.group.OTHER]),isPl()&&(t[n.name.matchmaking]=["O",".widget-button:has(.icon.matchmaking-icon):not(.from-settings-panel)",n.type.TIP,i.MATCHMAKING,n.group.SOCIAL]),isPl()||(t[n.name.achievements]=[!1,".widget-button:has(.icon.achievements-icon):not(.from-settings-panel)",n.type.TIP,i.ACHIEVEMENTS,n.group.SOCIAL]),isPl()&&(t[n.name.hotTakeGroundItem]=[!1,!1,n.type.LABEL,i.PICK_UP_ITEM,n.group.MAP]),e.checkNumberUnique()},this.checkNumberUnique=function(){var e={};for(var i in t){var n=t[i][0];n&&(isset(e[n])?console.log(n+" exist in defaultHotKeys"):e[n]=!0)}},this.checkKeyIsConsole=t=>{let e=Engine.hotKeys.hotKeys[t];return!!e&&e==n.name.iconconsole},this.checkHotExist=function(e){var i=Engine.serverStorage.get(s.HOTKEYS,e);if(i)this.hotKeys[correctKey(i)]=e;else if(null==i){let n=t[e][0];0!=n&&(i=n,this.hotKeys[i]=e)}var n=t[e];1!=n.length&&n&&0!=n[1]&&this.changeName(n[1],n[2],i)},this.changeName=function(t,e,i){var n=$(t);this["set"+e](n,i)},this.setTip=function(t,i){var n=t.getTipData();n&&(n=e.removeBracket(n),""!=i&&(n=this.createTagOrBrackets(n,i)),t.tip(n))},this.removeBracket=t=>{let e=new RegExp('<b class="hot-char">+(.*)</b>?',"g");return t.replace(e,"")},this.setLabel=function(t,e){var i=t.find(".label");if(i.length){i.find(".hot-char").remove();var n=i.html();""!=e&&(n=this.createTagOrBrackets(n,e)),i.html(n)}},this.createTagOrBrackets=function(t,e){return e?t+' <b class="hot-char">['+correctKey(e)+"]</b>":t},this.getKeyByClbName=t=>{if(Engine.serverStorage.getDataLoaded()){let e=Engine.serverStorage.get(s.HOTKEYS,t);return null==e?this.getDefaultHotkey(t):correctKey(e)}return this.getDefaultHotkey(t)},this.getDefaultHotkey=e=>t[e]?t[e][0]:null,this.checkKey=function(i){var a=this.hotKeys[i];if(!a)return;const s=t[this.hotKeys[i]][3];if(!Engine.tutorialManager.checkBlockHotKeys(a))if(s!==Engine.widgetsData.name.CONSOLE||Engine.interface.alreadyInitialised)if(!1!==s){const t=Engine.widgetManager.getDefaultWidgetSet();Engine.widgetManager.widgetOnClick({widgetData:t[s],eventType:"hot-key"})}else{if([n.name.move_down,n.name.move_up,n.name.move_left,n.name.move_right].includes(a))return;e[a]()}else Engine.interface.clickConsole()},this.checkForbidenChar=function(t){return!/[1-8\s]/i.test(t)},this.canChangeKey=(t,e)=>{let i=_t("char")+" "+(" "==e?"space":e);return e.length>1?("ESCAPE"==e||mAlert(i+" "+_t("is_forbidden ")),!1):!!this.checkForbidenChar(e)||(mAlert(i+" "+_t("is_forbidden ")),!1)},this.changeKey=(t,e,i)=>{let n={};this.overrideIfKeyExist(e,n),n[t]=e||!1,Engine.serverStorage.sendData({[s.HOTKEYS]:n},()=>{this.rebuildHotKeys(),i()})},this.overrideIfKeyExist=function(t,e){if(this.hotKeys[t]){e[this.hotKeys[t]]=!1}},this.getSortedHotKeys=function(){var i=[],n=e.changeClbNameWitchKey();for(var a in t){var s=n[a]?n[a]:null,r=t[a][3],o=t[a][4];i.push([s,a,r,o])}return i},this.changeClbNameWitchKey=function(){var t={};for(var i in e.hotKeys){t[e.hotKeys[i]]=i}return t},this.rebuildHotKeys=function(){for(var e in this.hotKeys={},t)this.checkHotExist(e);a.updateKeys()},this.resetHotKeys=function(e){let i={};for(var n in t){var a=t[n];i[n]=a[0]}Engine.serverStorage.sendData({[s.HOTKEYS]:i},()=>{this.rebuildHotKeys(),e()})},this.replaceAutoAndChangeBtnsNames=function(){this.checkHotExist(n.name.hotAutoFight),this.checkHotExist(n.name.hotChangeTarget)},this.replaceToggleBattlePanelTipNames=function(){this.checkHotExist(n.name.toggleBattlePanel)},this.replaceCreateAuctionBtnsNames=function(){this.checkHotExist(n.name.hotAuction)},this.replaceCloseFightBtnsNames=function(){this.checkHotExist(n.name.hotCloseFight)},this.replacehotAcceptLootBtnsNames=function(){this.checkHotExist(n.name.hotAcceptLoot)},this.replaceshowhideStatsBtnsNames=function(){this.checkHotExist(n.name.showhideStats)},this.hotAuction=function(){Engine.auctions&&Engine.auctions.exhibitItem()},this.iconcalendar=function(){Engine.interface.clickEventCalendar()},this.toggleBattlePanel=function(){Engine.battle.getShow()&&Engine.battle.toggleBattlePanel()},this.hotAutoFight=function(){Engine.battle.getShow()&&Engine.battle.canAutoFight()},this.hotCloseFight=function(){Engine.battle.getShow()&&Engine.battle.canLeave()},this.showhideStats=function(){Engine.interface.clickMoreBtn()},this.hotChangeTarget=function(){Engine.battle.getShow()&&Engine.battle.selectWarrior()},this.hotAcceptLoot=function(){Engine.loots&&Engine.loots.acceptLoot()},this.checkCanCloseConsole=function(){var t=Engine.console;return!!t.isOpen&&(t.close(),!0)},this.checkCanRefuseLoot=function(){return!(!Engine.loots||!Engine.loots.itemsDecisionExist())&&(Engine.loots.refuseAllLoot(),!0)},this.checkCanCloseMiniMap=function(){return!!Engine.miniMapController.getMiniMapShow()&&(Engine.miniMapController.closeMiniMap(),!0)},this.checkCanCloseTrade=function(){return!!Engine.trade&&(Engine.trade.$.find(".cancel-trade").click(),!0)},this.checkCanCloseDialog=function(){if(Engine.dialogue){var t=Engine.dialogue.$.find(".answer.dialogue-window-answer.line_exit");return!!t.length&&(t.click(),!0)}return!1},this.checkCanAcceptWindow=function(){let t=e.getExistWnd();return null!=t&&e.checkInAlertExistAcceptHotkey(t)},this.checkCanAcceptAlert=function(){let t=e.getExistAlert();return null!=t&&(e.checkInAlertExistAcceptHotkey(t)&&e.clickHotAcceptInAlert(t),!0)},this.checkCanCancelAlert=function(){let t=e.getExistAlert();return null!=t&&(e.checkInAlertExistCancelHotkey(t)&&e.clickHotCancelInAlert(t),!0)},this.checkCanCloseWindow=function(){let t=e.getExistWnd();if(null==t)return!1;const i=t.find(".menu-list .close-menu");return i.length>0&&i.closest(".menu-list").trigger({type:"close"}),e.clickWindowOnClose(t),!0},this.checkCanBlurInput=function(){const t=$("input:focus");return!(t.length<=0)&&(t.blur(),!0)},this.clickWindowOnClose=function(t){t.find(".close-button-corner-decor").find(".close-button").click()},this.getExistAlert=function(){let t=Engine.interface.get$mAlertLayer().find(".mAlert"),e=null;if(t.each((function(){if(null===e)e=$(this);else{let t=parseInt(e.css("z-index"));parseInt($(this).css("z-index"))>t&&(e=$(this))}})),null!==e)return e},this.getExistWnd=function(){let t=Engine.interface.get$alertsLayer().find(".border-window"),e=null;if(t.each((function(){if("none"!=$(this).css("display")&&!$(this).hasClass("transparent")&&$(this).find(".close-button-corner-decor").find(".close-button").length&&"none"!=$(this).find(".close-button-corner-decor").css("display"))if(null===e)e=$(this);else{let t=parseInt(e.css("z-index"));parseInt($(this).css("z-index"))>t&&(e=$(this))}})),null!==e)return e},this.checkInAlertExistAcceptHotkey=function(t){return t.find(".alert-accept-hotkey").length},this.checkInAlertExistCancelHotkey=function(t){return t.find(".alert-cancel-hotkey").length},this.clickHotAcceptInAlert=function(t){t.find(".alert-accept-hotkey").click()},this.clickHotCancelInAlert=function(t){t.find(".alert-cancel-hotkey").click()}}},function(t,e,i){var n=i(57),a=i(17);t.exports=function(){const t={fileName:"Sound.js"},e={[n.TYPE.MUSIC]:{},[n.TYPE.NOTIFICATION]:{},[n.TYPE.BATTLE_EFFECT]:{},[n.TYPE.SRAJ]:{},[n.TYPE.TMP]:{}},i={[n.TYPE.MUSIC]:100,[n.TYPE.NOTIFICATION]:50,[n.TYPE.BATTLE_EFFECT]:20,[n.TYPE.SRAJ]:80,[n.TYPE.TMP]:80};let s={"002":{file:"002.mp3",gr:1},"003":{file:"003.mp3",gr:2},"004":{file:"004.mp3",gr:1},"006":{file:"006.mp3",gr:1},"013":{file:"013.mp3",gr:2},"014":{file:"014.mp3",gr:2},"015":{file:"015.mp3",gr:2},"027":{file:"027.mp3",gr:1},"27n":{file:"027.mp3",gr:null},"032":{file:"032.mp3",gr:3},"007":{file:"007.mp3",gr:4},m11:{file:"007.mp3",gr:null},"07n":{file:"007.mp3",gr:null},"018":{file:"018.mp3",gr:8},"019":{file:"019.mp3",gr:7},"19n":{file:"019.mp3",gr:null},"035":{file:"035.mp3",gr:4},"35n":{file:"035.mp3",gr:null},"005":{file:"005.mp3",gr:3},"008":{file:"008.mp3",gr:3},"009":{file:"009.mp3",gr:3},"010":{file:"010.mp3",gr:4},"011":{file:"011.mp3",gr:4},"012":{file:"012.mp3",gr:3},"021":{file:"021.mp3",gr:4},"033":{file:"033.mp3",gr:8},"034":{file:"034.mp3",gr:7},aa1:{file:"a.mp3",gr:null},aa2:{file:"a.mp3",gr:null},bb:{file:"b.mp3",gr:null},cc1:{file:"c.mp3",gr:null},cc2:{file:"c.mp3",gr:null},dd1:{file:"d.mp3",gr:null},dd2:{file:"d.mp3",gr:null},dd3:{file:"d.mp3",gr:null},dd4:{file:"d.mp3",gr:null},ee:{file:"e.mp3",gr:null},f:{file:"f.mp3",gr:0},g:{file:"g.mp3",gr:0},h:{file:"h.mp3",gr:0},i:{file:"i.mp3",gr:6},j:{file:"j.mp3",gr:5},k:{file:"k.mp3",gr:5},l:{file:"l.mp3",gr:5}};const r={"-1":"123_szadz.mp3"},o={0:"new_mail.mp3",1:"enemy_here.mp3",2:"friend_here.mp3",3:"elite2_here.mp3",4:"heroes_here.mp3",5:"timer.mp3",6:"abbys.mp3",7:"group_loot.mp3",8:"your_turn.mp3",9:"stasis_in.mp3"},l={"-1":"owacje_VOLUME_TEST_DONT_REMOVE.mp3"};let c=!1,d=!1;const h=[];let u=null;const p={play:!mobileCheck(),shuffle:!1,quality:n.QUALITY.HQ,volume:{[n.TYPE.MUSIC]:100,[n.TYPE.NOTIFICATION]:100,[n.TYPE.BATTLE_EFFECT]:100,[n.TYPE.SRAJ]:100,[n.TYPE.TMP]:100}},g=t=>{p.play=t},f=t=>{p.quality=t},m=t=>{p.shuffle=t},v=(t,e)=>{w(e)&&(p.volume[e]=t)},E=()=>p.quality,_=()=>p.shuffle,b=t=>p.play,w=t=>!!n.TYPE[t]||(errorReport("Sound","checkAvailableSoundType","Incorrect type of sound"+t),!1),C=(t,i)=>{if(!w(i))return;let n=t.soundData.id;e[i][n]=t},T=(t,i)=>{w(t)&&delete e[t][i]},y=()=>{$(document).one("mousedown keydown",(function(){if(!c){c=!0;for(let t in h)h[t].soundData.play()}}))},I=t=>{let e=n.TYPE.MUSIC,i=t||K(),a=D(i,e);if(null==a)return;let s=M(e),r=L(s,e,i,a);C(r,e),P(r)},A=t=>{if(!p.play)return;if(k()){if(t)return void U();let e=V();if(S(e))return;U()}else I()},k=()=>{for(let t in e[n.TYPE.MUSIC])return!0;return!1},S=t=>{let e=K();if(!D(e,n.TYPE.MUSIC))return!1;let i=O(e),a=O(t.soundKey);return null!=i&&null!=a&&i==a},O=t=>s[t]?s[t].gr:null,M=()=>{let t=0;for(;e[n.TYPE.MUSIC][t]||e[n.TYPE.NOTIFICATION][t]||e[n.TYPE.BATTLE_EFFECT][t]||e[n.TYPE.TMP][t];)t++;return t},N=()=>{soundManager.setup({flashVersion:9,useFlashBlock:!1,onready:function(){d=!0}})},R=(t,e)=>{if(!Object.keys(e).length)return errorReport("Sound.js","getNextKeyFromGroup","group is empty"+e),null;if(1==Object.keys(e).length)return t;let i=[];for(let n in e)n!=t&&i.push(n);return i[Math.round(Math.random()*(i.length-1))]},x=(t,e)=>{let i=null,n=null;if(!Object.keys(e).length)return errorReport("Sound.js","getNextKeyFromGroup","group is empty"+e),null;for(let a in e){if(null==i&&(i=a),n)return a;t==a&&(n=!0)}return i},L=(t,e,a,s,r)=>{if(!w(e))return;let o={type:e,soundKey:a,soundData:null,additionalData:null},l={id:t,position:0,url:`${s}?v=${__build.version}`,volume:i[e]};switch(e){case n.TYPE.MUSIC:o.fadeOut=!1,o.fadeOutStart=null,o.fadeIn=!0,o.finishing=!1,l.onfinish=()=>{B(o)},l.whileplaying=()=>{F(o)};break;case n.TYPE.BATTLE_EFFECT:case n.TYPE.NOTIFICATION:case n.TYPE.TMP:l.onfinish=()=>{B(o)},l.whileplaying=()=>{F(o)};break;case n.TYPE.SRAJ:l.onfinish=()=>{B(o)},l.whileplaying=()=>{F(o)},o.rajSound=r.rajSound}return o.soundData=soundManager.createSound(l),W(o),o};removeSound=t=>{t.soundData.destruct()};const D=(e,i)=>{if(!w(i))return null;switch(i){case n.TYPE.MUSIC:if(!s[e])return errorReport("Sound.js","getSoundUrl","MUSIC_DATA sound not exist: "+e),null;let i=null;return i=s[e].sraj?cdnUrl+CFG.r_srajSound:cdnUrl+"/",i+"music/"+p.quality+"/"+s[e].file;case n.TYPE.BATTLE_EFFECT:return r[e]?cdncrUrl+CFG.r_battleEffectsSound+r[e]:(errorReport("Sound.js","getSoundUrl","BATTLE_EFFECT_DATA sound not exist: "+e),null);case n.TYPE.NOTIFICATION:return o[e]?"/sounds/"+o[e]:(errorReport("Sound.js","getSoundUrl","NOTIFICATION_DATA sound not exist: "+e),null);case n.TYPE.SRAJ:return l[e]?cdnUrl+CFG.r_srajSound+l[e]:(errorReport(t,"getSoundUrl","SRAJ_DATA sound not exist: "+e),null);case n.TYPE.TMP:return cdnUrl+"/obrazki/"+e}},P=t=>{c?t.soundData.play():h.push(t)},B=t=>{let e=t.type;if(w(e))switch(T(t.type,t.soundData.id),removeSound(t),e){case n.TYPE.MUSIC:S(t)?(t=>{let e=t.soundKey,i=O(e);if(null==i)return void A();let n,a=u[i];n=1==p.shuffle?R(e,a):x(e,a),I(n)})(t):A();break;case n.TYPE.NOTIFICATION:case n.TYPE.BATTLE_EFFECT:break;case n.TYPE.SRAJ:t.rajSound.finishSound()}},F=function(t){W(t)},W=t=>{let e,i=t.type;switch(i){case n.TYPE.MUSIC:j(t),e=H(t);break;case n.TYPE.BATTLE_EFFECT:case n.TYPE.NOTIFICATION:case n.TYPE.TMP:e=G(i);break;case n.TYPE.SRAJ:let a=G(i)/100,s=t.rajSound.checkSource(),r=t.rajSound.getSpecificVolume(),o=(null!=r?r:G(i))/100;e=s?a*(o*t.rajSound.getVolumeForSourceSound(Engine.hero.rx,Engine.hero.ry)):a*(100*o)}t.soundData.setVolume(e)},H=t=>{let e,a=i[n.TYPE.MUSIC];if(t.fadeOut){e=a*Math.abs((t.soundData.position-t.fadeOutStart)/4e3-1)}else e=a;return e<0?0:e>100?100:e},G=t=>{if(!w(t))return;let e=i[t];return e<0?0:e>100?100:e},V=()=>{for(let t in e[n.TYPE.MUSIC])return e[n.TYPE.MUSIC][t];return null},U=()=>{let t=V();t.fadeOut||(t?(t.fadeOut=!0,t.fadeOutStart=t.soundData.position):errorReport("Sound.js","setMusicFadeOut","Music not exist!"))},j=t=>{let e=t.soundData.position,i=t.soundData.duration-e;null!=t.soundData.duration&&(t.fadeOut?e-t.fadeOutStart>4e3&&B(t):4e3>i&&U())},q=t=>{let e=getSoundNotificationPatch(),i=Engine.serverStorage.get(e,t);return null!=i&&i},K=()=>{let t=null,e=Engine.rajMapMusicManager,i=e.getLastPlayId();if(null!=i)t=e.getMusicIdByMapMusicId(i);else{let e=/(.*?)\.jpg/.exec(Engine.map.d.bg);t=null==e?null:e[1]}return null==t?"l":s[t]?t:"l"},Y=()=>{u={};for(let t in s){let e=s[t].gr;null!=e&&(u[e]||(u[e]={}),u[e][t]?warningReport("Sound.js","prepareGroupObj","This key already exist"):u[e][t]=!0)}},z=()=>{const t=e[n.TYPE.TMP][0];B(t)},X=t=>{let e=n.TYPE.NOTIFICATION,i=D(t,e);if(null==i)return;if(Q(t))return;let a=M(e),s=L(a,e,t,i);C(s,e),P(s)},Q=t=>{let i=e[n.TYPE.NOTIFICATION];for(let e in i)if(i[e].soundKey==t)return!0;return!1},J=()=>isset(e[n.TYPE.TMP][0]),Z=()=>{et(),tt()},tt=()=>{i[n.TYPE.MUSIC]=p.volume[n.TYPE.MUSIC],i[n.TYPE.NOTIFICATION]=p.volume[n.TYPE.NOTIFICATION],i[n.TYPE.BATTLE_EFFECT]=p.volume[n.TYPE.BATTLE_EFFECT],i[n.TYPE.SRAJ]=p.volume[n.TYPE.SRAJ]},et=()=>{let t=it();t&&(isset(t.play)&&g(t.play),isset(t.shuffle)&&m(t.shuffle),isset(t.quality)&&f(t.quality),isset(t.volume)&&(isset(t.volume[n.TYPE.MUSIC])&&v(t.volume[n.TYPE.MUSIC],n.TYPE.MUSIC),isset(t.volume[n.TYPE.NOTIFICATION])&&v(t.volume[n.TYPE.NOTIFICATION],n.TYPE.NOTIFICATION),isset(t.volume[n.TYPE.BATTLE_EFFECT])&&v(t.volume[n.TYPE.BATTLE_EFFECT],n.TYPE.BATTLE_EFFECT),isset(t.volume[n.TYPE.SRAJ])&&v(t.volume[n.TYPE.SRAJ],n.TYPE.SRAJ)))},it=()=>Engine.serverStorage.get(getSoundParametersPatch()),nt=(t,e)=>{w(e)&&(t=parseInt(t<0?0:t>100?100:t),i[e]=t)},at=()=>{let t={};t[getSoundParametersPatch()]={play:b(),volume:p.volume,shuffle:_(),quality:E()},Engine.serverStorage.sendData(t)},st=()=>{let t=V();t&&(T(t.type,t.soundData.id),removeSound(t))};this.checkSrajSoundIsPlaying=t=>{for(let i in e[n.TYPE.SRAJ])if(t==i)return!0;return!1},this.prepareSrajSound=t=>{this.addToSRAJ_DATA(t,t),this.loadToCache(t,n.TYPE.SRAJ)},this.createSrajSound=(t,e)=>{let i=n.TYPE.SRAJ,a=D(t,i);if(null==a)return;let s=e.getId(),r=L(s,i,t,a,{rajSound:e});C(r,i),P(r)},this.finishPlayingSrajSound=t=>{let i=e[n.TYPE.SRAJ][t];B(i)},this.finishPlayingTmpSound=z,this.loadToCache=(t,e)=>{new Audio(D(t,e))},this.addToBATTLE_EFFECT_DATA=(t,e)=>{r[t]||(r[t]=e)},this.addToSRAJ_DATA=(t,e)=>{l[t]||(l[t]=e)},this.checkAvailableSoundType=w,this.musicPlayToggle=()=>{let t=p.play=!p.play;g(t),at(),st(),p.play&&A()},this.toggleShuffle=function(){let t=p.shuffle=!p.shuffle;m(t),at()},this.toggleQuality=()=>{let t=p.quality==n.QUALITY.LQ?n.QUALITY.HQ:n.QUALITY.LQ;f(t),at(),st(),p.play&&A()},this.setVolumeWithSaveInServerStorage=(t,e)=>{w(e)&&(nt(t,e),v(i[e],e),at())},this.setVolumeWithoutSaveInServerStorage=nt,this.getDataSettingQuality=E,this.getDataSettingShuffle=_,this.getDataSettingPlay=b,this.getDataSettingVolume=t=>{if(w(t))return p.volume[t]},this.setMusicFadeOut=U,this.createBattleEffectSound=t=>{let e=n.TYPE.BATTLE_EFFECT,i=D(t,e);if(null==i)return;let a=M(e),s=L(a,e,t,i);C(s,e),P(s)},this.createNotifSound=X,this.createTmpSound=t=>{let e=n.TYPE.TMP,i=D(t,e);if(null==i)return;J()&&z();let a=L(0,e,t,i);C(a,e),P(a)},this.getStateSoundNotifById=q,this.init=()=>{N(),Y(),Z(),y()},this.setMusic=A,this.manageOtherNotifications=t=>{let e=!q(1),i=!q(2);return e&&t.relation==a.RELATION.ENEMY?X(1):i&&t.relation==a.RELATION.FRIEND?X(2):void 0},this.manageNpcNotifications=t=>{let e=!q(3),i=!q(4);if(!(2==t.type||3==t.type))return;let n=null;i&&t.wt>79?n=4:e&&t.wt<30&&t.wt>19&&(n=3),null!=n&&X(n)},this.synchroStart=()=>{},this.addSrajMapMusic=(t,e,i)=>{s[t]?errorReport("Sound2","addSrajMapMusic",`id ${t} already exist!`):s[t]={file:e,gr:i,sraj:!0}},this.refreshGroupObj=Y,this.removeSrajMapMusic=t=>{s[t]?delete s[t]:errorReport("Sound2","removeSrajMapMusic",`id ${t} not exist!`)}}},function(t,e,i){const n=i(0),a=i(26),s=i(11),r=i(27);t.exports=function(){var t,e,i,o=this,l=null;this.init=function(){this.initWindow(),this.initTouch(".pad-bck"),this.setVisible(),this.wnd.$.find(".pad-bck")},this.initWindow=function(){l=n.get("pad-controller"),Engine.windowManager.add({content:l,nameWindow:Engine.windowsData.name.PAD_CONTROLLER,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,manageOpacity:1,managePosition:{x:"251",y:"60"},title:"",addClass:"pad-controller-window",manageShow:!0,onclose:()=>{this.toggleVisible()}}),this.wnd.updatePos(),this.wnd.$.css("min-width","0px"),this.wnd.addToAlertLayer()},this.toggleVisible=function(){o.wnd.isShow()?o.wnd.hide():o.wnd.show()},this.initTouch=function(n){l.find(n)[0].addEventListener("touchstart",(function(n){n.preventDefault(),i=1/Engine.zoomFactor,t=10*i,e=33*i,o.calculateDir(n)}),!1),l.find(n)[0].addEventListener("touchmove",(function(t){t.preventDefault(),o.calculateDir(t)}),!1),l.find(n)[0].addEventListener("touchend",(function(t){t.preventDefault(),a.setMoveDirection(null)}),!1)},this.calculateDir=function(n){var a=n.targetTouches[0],r=a.pageX*i,o=a.pageY*i,l=Engine.padController.wnd.$.position(),c=l.left*i,d=l.top*i;var h=88-(r-c-t),u=88-(o-d-e);Math.abs(h)<10&&Math.abs(u)<10||(Math.abs(h)>Math.abs(u)?Engine.inputParser.setMoveDirection(h>0?s.W:s.E):Engine.inputParser.setMoveDirection(u>0?s.N:s.S))},this.setVisible=function(){var t=r.getShowWindow(Engine.windowsData.name.PAD_CONTROLLER);null===t?(!0,r.setShowWindow(!0,Engine.windowsData.name.PAD_CONTROLLER)):t||o.wnd.hide()}}},function(t,e,i){var n=i(0),a=(i(53),i(408)),s=i(423);const r=i(424);let o=i(60);const l=i(13);t.exports=function(){var t=this;this.$=null,this.handHeldMiniMapController=null;var e=null,i=null,c=!1,d=!1,h=null;let u;this.getMiniMapShow=function(){return c},this.init=function(){this.initTemplate(),this.createLocalContent(),this.createGlobalContent(),this.createButtonsPanel(),this.initDragAndZoom(),this.handHeldMiniMapController=new a,this.handHeldMiniMapController.init(),this.initSearch()},this.initDragAndZoom=()=>{u=new r(".mini-global-map-overflow",{minScale:.1,maxScale:2,factor:.2})},this.initTemplate=function(){this.$=n.get("mini-map-controller"),Engine.interface.get$interfaceLayer().find(".right-column").after(this.$)},this.showLocalAndHideGlobalMap=function(e){if(Engine.map){var i=e?Engine.map.d.name:_t("show-minimap",null,"widgets-tip");t.$.find(".mini-map-label").html(i)}e||d||_g("minimap"),t.$.find(".mini-map-local-content").css("display",e?"block":"none"),t.$.find(".mini-local-map").css("display",e?"block":"none"),t.$.find(".mini-map-global-content").css("display",e?"none":"block"),t.$.find(".mini-global-map").css("display",e?"none":"block"),t.$.find(".mini-global-map-overflow").css("display",e?"none":"block"),t.$.find(".show-global-map-btn").tip(_t(e?"global_map":"local_map")),this.updateScroll()},this.toggleBckType=function(t,e){var i=t.find(".add-bck");i.removeClass("mimi-map-global-bck "+localCl),i.addClass(e?localCl:"mimi-map-global-bck")},this.createButtonsPanel=function(){var e=t.$.find(".mini-map-buttons"),i=n.get("button").addClass("small green toggle-btn set-local-map-btn"),a=n.get("button").addClass("small green toggle-btn set-global-map-btn");i.find(".label").html(_t("local_map")),a.find(".label").html(_t("iconglobe")),e.append(i),e.append(a),i.click((function(){t.showLocalAndHideGlobalMap(!0),t.setDisable($(this))})),a.click((function(){t.showLocalAndHideGlobalMap(!1),t.setDisable($(this))})),this.createButton("close-mini-map-btn",e,"close",this.toggleMiniMap),this.$.find(".close-mini-map-btn").tip(_t("hotkey_close"))},this.setDisable=function(e){t.$.find(".toggle-btn").removeClass("disable"),e.addClass("disable")},this.createButton=function(t,e,i,a){var s=n.get("button").addClass("small "+t);return e.append(s),s.append(n.get("add-bck").addClass(i)),s.click(a),s},this.updateMiniMapWindow=function(){t.handHeldMiniMapController.updateMap(Engine.map)},this.updateWindowMiniMapHeroPos=function(e,i){t.handHeldMiniMapController.updateHero(e,i)},this.updateWindowMiniMapMonsterPos=function(e){t.handHeldMiniMapController.updateNpc(e)},this.updateWindowMiniMapOthersPos=function(e){t.handHeldMiniMapController.updateOther(e)},this.updateWindowMiniMapGatewaysPos=function(){let e=Engine.map.gateways.getDrawableItems();t.handHeldMiniMapController.updateGateway(e)},this.updateWindowMiniMapRipsPos=function(e){t.handHeldMiniMapController.updateRip(e)},this.updateWindowMiniMapRespPos=function(e){t.handHeldMiniMapController.updateResp(e)},this.openMiniMap=function(){this.$.css("display","block"),Engine.lock.add("miniMapBlock"),c=!0,t.setHeader(),t.updateLocalMapAndElements(),t.updateScroll(),u.resetScale();var e=Engine.map.d.mainid,i=0==e?Engine.map.d.id:e;(h?h[i]:null)?t.centerMapOnElement(t.$.find("#map_id_"+i)):u.resetPosition(),t.showLocalAndHideGlobalMap(!1),t.setDisable(t.$.find(".set-global-map-btn")),d&&t.showMyLoc(),Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.MAP,!0)},this.closeMiniMap=function(){Engine.lock.remove("miniMapBlock"),this.$.css("display","none"),c=!1,Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.MAP,!1)},this.toggleMiniMap=function(){c?t.closeMiniMap():t.openMiniMap()},this.toggleMiniMapWindow=()=>{this.handHeldMiniMapController.getHandHeldMiniMapWindow().toggleMiniMap()},this.setHeader=function(){t.$.find(".mini-map-label").html(Engine.map.d.name),t.$.find(".hero-is-here").tip(Engine.map.d.name)},this.onResize=function(){Engine.map.size&&c&&t.updateLocalMapAndElements()},this.updateLocalMapAndElements=function(){t.clearElements(),t.setLocalMap(),i&&clearTimeout(i),i=setTimeout((function(){t.setElementsOnMiniMap()}),200)},this.setLocalMap=function(){var i=Engine.map,n=t.$.find(".mini-map-map");e=n.height()/i.size.y;var a=i.size.x*e,s=i.size.y*e;a>n.width()&&(e=n.width()/i.size.x,a=n.width(),s=i.size.y*e),t.$.find(".mini-local-map").css({background:"url("+i.src+") no-repeat center",width:a+"px",height:s+"px","background-size":"contain"})},this.getSpecialElementsFromNpc=()=>{var e=Engine.npcs.check(),i=t.setSearchElementsFromDivideButtons();for(var n in e){let s=e[n],r=s.getType();if(3!=r&&2!=r){for(var a in i.BITS)t.checkbitPosAndAddElement(s,a,i.BITS);if(lengthObject(i.OTHER)){const t=l.NAME.NORMAL_QUEST,e=l.NAME.DAILY_QUEST;i.OTHER[t]&&p(s,t,i.OTHER,s.getHasOnetimeQuest()),i.OTHER[e]&&p(s,e,i.OTHER,s.getHasDailyQuest())}}}let s={};for(let t in i.BITS)s[t]=i.BITS[t];for(let t in i.OTHER)s[t]=i.OTHER[t];return s},this.checkbitPosAndAddElement=function(t,e,i){t.checkActionsBitByName(e)&&i[e].push(t)};const p=(t,e,i,n)=>{n&&i[e].push(t)};this.setSearchElementsFromDivideButtons=function(){var t={BITS:{},OTHER:{}};for(var e in o.BITS)this.getActive(e)&&(t.BITS[e]=[]);const i=l.NAME.NORMAL_QUEST,n=l.NAME.DAILY_QUEST;return this.getActive(i)&&(t.OTHER[i]=[]),this.getActive(n)&&(t.OTHER[n]=[]),t},this.getActive=function(t){return this.$.find("."+t+"-switch").find(".left").hasClass("active")},this.drawHero=function(t,e){var i=Engine.hero.d,n={x:i.x,y:i.y,name:_t("my_character",null,"map"),cl:"hero"};this.drawOneTile([n],t,e)},this.setElementsOnMiniMap=function(){var e=t.$.find(".mini-local-map").width(),i=t.$.find(".mini-local-map").height(),n=e/(l=Engine.map.size.x),a=i/(c=Engine.map.size.y),s={},r=this.getSpecialElementsFromNpc();for(var o in r)this.setElements(r[o],s,o);for(var l in this.getActive("gateway")&&this.setElements(Engine.map.gateways.getDrawableItems(),s,"gateway"),s)for(var c in s[l]){var d=s[l][c];this.drawOneTile(d,n,a)}this.drawHero(n,a)},this.setElements=function(t,e,i){for(var n in t){var a=t[n].d.x,s=t[n].d.y,r=t[n].d.nick;isset(e[a])||(e[a]={}),isset(e[a][s])||(e[a][s]=[]);var o={x:t[n].d.x,y:t[n].d.y,cl:i,tip:isset(r)?r:t[n].tip.join()};e[a][s].push(o)}},this.drawOneTile=function(e,i,a){for(var s=0;s<e.length;s++){var r=e[s],o=r.x,l=r.y,c=r.tip,d=r.cl,h=n.get("icon-wrapper-map");h.find(".emo-npc-icon").addClass("i-"+d).tip(c);var u=t.getWrapperElement(o,l,d);u.find(".border-wrapper").append(h);var p=i<19?(19-i)/-2:(i-19)/2,g=a<19?(19-a)/-2:(a-19)/2;u.css({left:o*i,top:l*a,"margin-left":p,"margin-top":g})}},this.getWrapperElement=function(e,i,a){var s="wrapper-x"+e+"-y"+i,r=t.$.find("."+s),o="hero"==a;return r.length<1||o?(r=n.get("element-mini-map").addClass(s),t.$.find(".mini-local-map").append(r)):(r.find(".border-wrapper").css("display","none"),t.activeHover(r)),r},this.activeHover=function(t){t.hasClass("hover-active")||(t.addClass("more hover-active"),t.hover((function(){$(this).find(".border-wrapper").css("display","inline-block"),$(this).addClass("hide-more")}),(function(){$(this).removeClass("hide-more"),$(this).find(".border-wrapper").css("display","none")})))},this.updateScroll=function(){$(".scroll-wrapper",t.$).trigger("update")},this.createLocalContent=function(){var t=n.get("mini-map-local-content");for(var e in this.$.find(".mini-map-content").append(t),o.BITS)this.createLocalMapElement(e);this.createLocalMapElement(l.NAME.NORMAL_QUEST),this.createLocalMapElement(l.NAME.DAILY_QUEST),this.createLocalMapElement("gateway"),t.find(".scroll-wrapper").addScrollBar({track:!0})},this.createGlobalContent=function(){var t=n.get("mini-map-global-content");this.$.find(".mini-map-content").append(t),t.find(".scroll-wrapper").addScrollBar({track:!0})},this.centerMapOnElement=function(t){u.centerOn(t[0])},this.createLocationList=function(){var e=[];for(var i in h){var n=h[i].name;if(!t.hideZapelniacz(n)){var a=$("<div>").addClass("one-location-on-list").html(escapeHTML(n));a.attr("id","location-id-"+h[i].id),e.push(a),a.click((function(){var e=$(this).attr("id").replace("location-id-",""),i=t.$.find("#map_id_"+e);t.centerMapOnElement(i)}))}}t.$.find(".mini-map-global-content").find(".scroll-pane").append(e),t.$.find(".one-location-on-list").hover((function(){var e=$(this).attr("id").replace("location-id-","");t.$.find("#map_id_"+e).addClass("mark")}),(function(){var e=$(this).attr("id").replace("location-id-","");t.$.find("#map_id_"+e).removeClass("mark")})),t.updateScroll()},this.hideZapelniacz=function(t){return/zape.niacz/.test(t.toLowerCase())},this.initSearch=function(){var e=this.$.find(".search"),i=this.$.find(".search-x");e.keyup((function(){var e=$(this).val(),i=t.$.find(".one-location-on-list");""==e?i.css("display","block"):i.each((function(){var i=$(this).html().toLowerCase().search(e.toLowerCase())>-1?"block":"none";$(this).css("display",i),t.updateScroll()}))})),e.attr("placeholder",_t("search")),i.on("click",(function(){e.val("").blur().trigger("keyup")}))},this.getMapUrl=()=>{let t=isPl()?"ni":"en";return CFG.a_vpath+"minimap-"+t+".png"},this.setSizeAndBckGlobalMap=()=>{t.$.find(".mini-global-map").css({});const e=$("<img />",{class:"world-map",src:this.getMapUrl()});t.$.find(".mini-global-map").append(e)},this.updateGlobalMap=e=>{d||Engine.imgLoader.onload(this.getMapUrl(),!1,!1,i=>{i.width,i.height,d=!0,h={},t.setSizeAndBckGlobalMap(),t.loadMapList(e),t.createLocationList(),t.createMyLocMarker(),t.showMyLoc()})},this.createMyLocMarker=function(){var e=$("<div>").addClass("hero-is-here").tip(_t("you_are_here",null,"map")+"<br>"+Engine.map.d.name);t.$.find(".mini-global-map").append(e)},this.loadMapList=function(e){var i=e.split(";"),a=[];for(var s in i){var r=i[s].split(",");let e=parseInt(r[0]);h[e]={id:e,name:r[1],x:parseInt(r[2]),y:parseInt(r[3]),width:parseInt(r[4]),height:parseInt(r[5])};var o=n.get("one-location-on-map");o.attr("id","map_id_"+r[0]),o.tip(r[1],"t_static"),o.css({left:parseInt(r[2]),top:parseInt(r[3]),width:parseInt(r[4]),height:parseInt(r[5])}),a.push(o),t.createMouseEvents(o,e)}h=this.sortMapList(h),t.$.find(".mini-global-map").append(a)},this.sortMapList=t=>Object.values(t).sort((t,e)=>t.name.localeCompare(e.name)),this.createMouseEvents=(e,i)=>{e.hover((function(){var e=$(this).attr("id").replace("location-id-","");t.$.find("#"+e).addClass("mark")}),(function(){var e=$(this).attr("id").replace("location-id-","");t.$.find("#"+e).removeClass("mark")})),e.on("click",(function(){[0,4,32].includes(Engine.hero.d.uprawnienia)||_g("gm&a=teleport&target="+i,(function(t){Engine.interface.checkTeleport(t)}))}))},this.showMyLoc=function(){if(h){var e=Engine.map.d.mainid,i=0==e?Engine.map.d.id:e,n=h.find(t=>t.id===i);if(!n)return t.$.find(".hero-is-here").css("display","none");t.centerMapOnElement(t.$.find("#map_id_"+i)),t.$.find(".hero-is-here").css({left:n.x,top:n.y,width:n.width,height:n.height,display:"block"})}},this.createLocalMapElement=function(t){var e=n.get("local-map-element").addClass(t+"-switch");this.$.find(".mini-map-local-content").find(".scroll-pane").append(e),e.find(".label").html(_t("place-"+t,null,"mini-map")),e.find(".emo-npc-icon").addClass("i-"+t),this.createDivideButtons(e.find(".toggle"),t)},this.createDivideButtons=function(e,i){var n=$("<div>");e.append(n);var a=[{text:_t("yes"),val:"0"},{text:_t("no"),val:"1"}],r=s.getStateByKind(i);null===r&&(s.setStateByKind(i,!0),r=!0),n.createDivideButton(a,0,!1,(function(e){t.clearElements(),t.setElementsOnMiniMap();let n=!parseInt(e);s.setStateByKind(i,n)})),n.find(".option").eq(r?0:1).addClass("active")},this.clearElements=function(){t.$.find(".mini-local-map").find(".element").remove()}}},function(t,e,i){var n=i(61);let a=i(10),s=i(409),r=(i(24),i(410)),o=i(413),l=i(414),c=i(416),d=i(417),h=i(418),u=i(419),p=i(420),g=i(421),f=i(422);i(20);t.exports=function(){const t="HandHeldMiniMapController";let e,i,m,v,E,_,b,w,C,T=null,y=null,I=null,A=null,k=!1,S=null,O=null,M=null,N=null,R=null;const x=function(t){let e=n.getDataDrawerNickOfKindByName(t);return null!==e?e:F(t)},L=function(t){let e=n.getDataDrawerProfAndLevelOfKindByName(t);return null!==e?e:W(t)};function D(t){return S[t].whoIsHere}function P(t){return S[t].mapBlur}function B(t){return S[t].color}function F(t){return S[t].dataDrawerNick}function W(t){return S[t].dataDrawerProfAndLevel}function $(t){return S[t].icon}function H(){!function(){for(var t in O={},O[a.KIND.MARK_OBJECT]={color:"#c71618",icon:a.STATIC_ICONS.SQUARE,type:a.TYPE.OTHER},S){let e=n.getColorOfKindByName(t),i=n.getIconOfKindByName(t),a=n.getStateOfKindByName(t);e||(e=B(t)),null==i&&(i=$(t)),null==a&&(a=!0),O[t]={color:e,icon:i,state:a};let s=O[t],r=S[t];(isset(r.dataDrawerNick)||isset(r.dataDrawerProfAndLevel))&&(isset(S[t].dataDrawerNick)&&(s.nick=x(t)),isset(S[t].dataDrawerProfAndLevel)&&(s.lvlAndProf=L(t)))}}(),A={[a.TYPE.NPC]:{},[a.TYPE.OTHER]:{},[a.TYPE.RIP]:{},[a.TYPE.GATEWAY]:{},[a.TYPE.ITEM]:{},[a.TYPE.HERO]:{},[a.TYPE.RESP]:{}},I={[a.TYPE.NPC]:{},[a.TYPE.OTHER]:{}},function(){A[a.TYPE.OTHER][a.KIND.MARK_OBJECT]=!0;for(let t in O)if(O[t].state){let e=S[t].type;if("object"==typeof e)for(const i of e)A[i][t]=!0;else A[e][t]=!0}}(),function(){for(let t in O){if(!O[t].nick&&!O[t].lvlAndProf)continue;let e=S[t].type;I[e][t]=!0}}()}function G(){M=V(a.MIN_LEVEL_DATA),N=V(a.DATA_DRAWER_WIDTH_DATA),R=V(a.DATA_DRAWER_FONT_SIZE_DATA),getEngine().npcs.clearDataToDraw(),getEngine().others.clearDataToDraw()}function V(t){let e=null,i=t.KEY,s=t.DEFAULT,r=t.MIN,o=t.MAX;switch(i){case a.MIN_LEVEL_DATA.KEY:e=n.getMinLevelOfKindByName();break;case a.DATA_DRAWER_WIDTH_DATA.KEY:e=n.getWidthDataDrawerOfKindByName();break;case a.DATA_DRAWER_FONT_SIZE_DATA.KEY:e=n.getFontSizeDataDrawerOfKindByName()}if(null!==e)return isInt(e)?e<r||e>o?s:e:s;var l=s;return n.setMinLevelOfKindByName(l),l}function U(){v.updateData()}function j(t){m.updateData(t)}function q(t){E.updateData(t)}function K(t){b.updateData(t)}function Y(t){C.updateData(t)}function z(t){w.updateData(t)}function X(t){k=t}function Q(){var t=Engine.npcs.check(),e=[],n=Engine.others.check(),a=Engine.map.gateways.getDrawableItems(),s=Engine.map.rip.getDrawableList(),r=Engine.heroesRespManager.test();_.clearFetch();for(let i in t)e.push(t[i].d);J(),i.clearCords(),U(),q(e),j(n),_.setFetch(),z(a),K(s),Y(r)}function J(){v.clearAllLists(),m.clearAllLists(),E.clearAllLists(),m.clearAllLists(),_.clearAllLists(),b.clearAllLists(),w.clearAllLists(),C.clearAllLists()}this.init=function(){!function(){let t=a.TYPE.NPC,e=a.TYPE.OTHER,i=a.TYPE.RESP,n=a.STATIC_ICONS.CIRCLE,s=a.STATIC_ICONS.SQUARE,r=a.STATIC_ICONS.RHOMB,o=a.KIND,l=a.TYPE.GATEWAY,c=a.TYPE.ITEM,d=a.TYPE.RIP,h=a.TYPE.HERO;S={[o.HERO]:{handheldMap:!0,mapBlur:!0,color:"#87fdff",icon:r,type:h},[o.NORMAL_OTHER]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#eaeaea",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.FRIEND]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#46a31d",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.ENEMY]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#c71618",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.CLAN]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#4cfa4f",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.CLAN_FRIEND]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#ffba37",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.CLAN_ENEMY]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#fc3e40",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.GROUP]:{handheldMap:!0,whoIsHere:!0,mapBlur:!0,color:"#b554ff",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.WANTED]:{handheldMap:!0,color:"#ec0c0c",icon:r,type:e,dataDrawerNick:!1,dataDrawerProfAndLevel:!1},[o.NPCS]:{handheldMap:!0,color:"#fef348",icon:n,type:t,dataDrawerNick:!0},[o.NORMAL_MONSTER]:{handheldMap:!0,color:"#b1b7bd",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.ELITE_1]:{handheldMap:!0,color:"#87fdff",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.ELITE_2]:{handheldMap:!0,color:"#40bfff",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.ELITE_3]:{handheldMap:!0,color:"#ffba37",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.HEROS]:{handheldMap:!0,color:"#fe5afb",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.HEROES_RESP]:{handheldMap:!0,color:"#ffba37",icon:s,type:i},[o.HEROES_RESP_E]:{handheldMap:!0,color:"#ffba37",icon:s,type:i},[o.COLOSSUS]:{handheldMap:!0,color:"#a500fc",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.TYTAN]:{handheldMap:!0,color:"#3559ff",icon:s,type:t,dataDrawerNick:!0,dataDrawerProfAndLevel:!0},[o.RECOVERY]:{handheldMap:!0,color:"#ffa9fe",icon:n,type:[c,t]},[o.GATEWAY]:{handheldMap:!0,color:"#3559ff",icon:n,type:l},[o.RIP]:{handheldMap:!0,color:"#292929",icon:n,type:d}}}(),y=new r,y.init(),e=new o,i=new l,v=new c,m=new d,E=new h,_=new u,b=new p,w=new g,C=new f,e.init(),i.init(),v.init(),m.init(),E.init(),_.init(),b.init(),w.init(),C.init(),H(),G(),T=new s},this.updateAndDraw=function(t){if(!k)return;let e=y.getCtx();!function(t,e){t.clearRect(0,0,e.width,e.height)}(e,y.getCanvas()),T.draw(e,t),C.draw(e,t),E.draw(e,t),_.draw(e,t),b.draw(e,t),w.draw(e,t),m.draw(e,t),v.draw(e,t)},this.updateHero=U,this.updateMap=function(t){T.updateData(t),y.prepareScaleMarginSquareData(),X(!0)},this.updateNpc=q,this.updateOther=j,this.updateRip=K,this.updateResp=Y,this.updateGateway=z,this.clearMiniMap=function(){X(!1),J(),i.clearCords()},this.refreshMiniMapController=function(){G(),H(),Q()},this.canUpdateDataDrawer=function(t,e){return I[t][e]},this.canUpdate=function(t,e){return A[t][e]},this.onResize=function(){y.onResize()},this.getColorByKind=function(t){return O[t]?O[t].color:"000000"},this.getShapeByKind=function(t){return O[t]?O[t].icon:0},this.getShowObject=function(t){return A[t]},this.getMinLevel=function(){return M},this.getWidthDataDrawer=function(){return N},this.getFontSizeDataDrawer=function(){return R},this.getAmountElementFromStorage=V,this.getDefaultColor=B,this.getDefaultIcon=$,this.iconIndexToName=function(t){for(let e in a.STATIC_ICONS)if(a.STATIC_ICONS[e]==t)return e},this.iconNameToIconIndex=function(t){return a.STATIC_ICONS.hasOwnProperty(t)?a.STATIC_ICONS[t]:(console.error("invalid name of HandHeldMiniMapData.STATIC_ICONS: "+t),a.STATIC_ICONS.SQUARE)},this.getIcons=function(){let t=[];for(let e in a.STATIC_ICONS)t.push(e);return t},this.getNamesTab=function(){return S},this.getMiniMapNpcController=function(){return E},this.getMiniMapHeroController=function(){return v},this.getMiniMapOtherController=function(){return m},this.getMiniMapItemsController=function(){return _},this.getMiniMapRipController=function(){return b},this.getMiniMapGatewayController=function(){return w},this.getObjectController=function(t){switch(t){case a.TYPE.HERO:return v;case a.TYPE.NPC:return E;case a.TYPE.OTHER:return m;case a.TYPE.ITEM:return _;case a.TYPE.RIP:return b;case a.TYPE.GATEWAY:return w;case a.TYPE.RESP:return C;default:console.error("incorrect type",t)}},this.getMiniMapTipController=function(){return i},this.getImageObjectController=function(){return e},this.getHandHeldMiniMapWindow=function(){return y},this.getDataDrawerNickOfKindByName=x,this.getDataDrawerProfAndLevelOfKindByName=L,this.getWhoIsHereOfKindByName=function(t){let e=n.getWhoIsHereOfKindByName(t);return null!==e?e:D(t)},this.getMapBlurOfKindByName=function(t){let e=n.getMapBlurOfKindByName(t);return null!==e?e:P(t)},this.getDefaultDataDrawerNick=F,this.getDefaultDataDrawerProfAndLevel=W,this.getDefaultWhoIsHere=D,this.getDefaultMapBlur=P,this.getDataToWhoIsHere=function(){const e="getDataToWhoIsHere";let i={};for(let a in S){let s=isset(S[a].whoIsHere);if(!s&&!isset(S[a].mapBlur))continue;let r=n.getColorOfKindByName(a),o=n.getWhoIsHereOfKindByName(a),l=n.getMapBlurOfKindByName(a);null==r&&(r=B(a)),null==o?o=D(a):isBoolean(o)||(o=D(a),errorReport(t,e,"incorrect val!",o)),null==l?l=P(a):isBoolean(l)||(l=P(a),errorReport(t,e,"incorrect val!",l)),i[a]={whoIsHere:s?o:null,mapBlur:l,color:r}}return i}}},function(t,e){t.exports=function(){let t=null,e=null;function i(e){t=e}this.init=function(){},this.setRef=i,this.clearMapImage=function(){e=null},this.draw=function(i,n){if(!e)return;let a=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),s=a.getScale(),r=a.getMargin(),o=t.size.x*CFG.tileSize*s,l=t.size.y*CFG.tileSize*s;i.save(),i.filter="blur(0.3px)",i.drawImage(e,r.left,r.top,o,l),i.restore()},this.updateData=function(n){i(n),function(){let i=t.src;Engine.imgLoader.onload(i,!1,!1,t=>{e=t})}()}}},function(t,e,i){let n=i(0);var a=i(411),s=i(10),r=i(61);t.exports=function(){let t,e,i,o,l="",c=null,d=[230,300,450,650],h=d.length-1,u=0,p=null,g={normalSize:null,minSize:s.MIN_SIZE,margin:0},f={left:0,top:0};function m(t){if(t.originalEvent.wheelDelta>0||t.originalEvent.detail<0){if(u==h)return;E()}else!function(){if(u<1)return;u--,_(),w(),b()}();Engine.miniMapController.handHeldMiniMapController.refreshMiniMapController()}function v(){o?o.close():(o=new a,o.init())}function E(){u==h?u=0:u++,_(),w(),b()}function _(){r.setSizeWindow(u)}function b(){t.checkPassTheScreenBounds()&&(t.setWindowOnLeftTopCorner(),0!=u&&t.checkPassTheScreenBounds()&&(u=0,_(),w()))}function w(){let t=d[u];C(t,t),I()}function C(i,n){e.width=i,e.height=n,t.$.find(".handheld-mini-map").css("height",parseInt(n))}function T(t,i,n){let a,s=Engine.zoomFactor,r=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow().getSquareData(),o=i.offset().left,l=i.offset().top,c=Engine.map.size.x,d=Engine.map.size.y,h=t.clientX,u=t.clientY;if(a=c>d?e.width/c*s:e.height/d*s,!n&&0!=r.margin)return y(h,u,o,l,f,a);let p=h-o-f.left,g=u-l-f.top;return[{x:Math.floor(p/a),y:Math.floor(g/a)}]}function y(t,e,i,n,a,s){let r={},o=-1*Math.floor(g.margin),l=Math.floor(g.normalSize)-o;for(let c=o;c<l;c++)for(let d=o;d<l;d++){let o=t+d-i-a.left,l=e+c-n-a.top,h=Math.floor(o/s),u=Math.floor(l/s);r[u]||(r[u]={}),r[u][h]||(r[u][h]=!0)}let c=[];for(let t in r)for(let e in r[t])c.push({x:e,y:t});return c}function I(){!function(){let t=Engine.map.size.x,i=Engine.map.size.y,n=e.width,a=e.height,s=t*CFG.tileSize,r=i*CFG.tileSize;if(t>i){O(n/s),k(0,(a-r*p)/2)}else{O(a/r),k((n-s*p)/2,0)}}(),function(){let t=CFG.tileSize*p,e=Math.max(t,s.MIN_SIZE),i=0;e>t&&(i=(e-t)/2);S(t,e,i)}()}function A(){t.hide()}function k(t,e){f.left=t,f.top=e}function S(t,e,i){g.normalSize=t,g.minSize=e,g.margin=i,g.halfNormalSize=t/2,g.halfMinSize=e/2}function O(t){p=t}this.init=function(){var a;t=Engine.windowManager.add({content:n.get("handheld-mini-map"),nameWindow:Engine.windowsData.name.HANDHELD_WINDOW,widget:Engine.widgetsData.name.MINI_MAP,type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:"251",y:"60",position:Engine.windowsData.position.RIGHT_POSITIONING},title:_t("portable_map"),addClass:"handheld-window",manageShow:!0,onclose:()=>{A()}}),t.addToAlertLayer(),null===(a=r.getSizeWindow())?(u=0,_()):u=a,function(){let e=t.$.find(".search"),i=t.$.find(".search-x");e.keyup((function(){l=$(this).val(),Engine.miniMapController.handHeldMiniMapController.refreshMiniMapController()})),e.attr("placeholder",_t("search")),i.on("click",(function(){e.val("").blur().trigger("keyup")}))}(),function(){let e=n.get("toggle-size-button");t.$.find(".handheld-mini-map").append(e),e.addClass("settings-button1"),e.click((function(t){E(),Engine.miniMapController.handHeldMiniMapController.refreshMiniMapController()}))}(),function(){let e=n.get("settings-button");t.$.find(".handheld-mini-map").append(e),e.addClass("settings-button2"),e.click((function(t){t.stopPropagation(),v()}))}(),e=t.$.find("canvas")[0],i=e.getContext("2d"),function(){let t=$(e);t.on("click mousemove mouseleave mouseenter contextmenu",(function(e){e.preventDefault(),"click"==e.type?function(t,e){let i=Engine.miniMapController.handHeldMiniMapController.getMiniMapTipController();Engine.hero.getRefFollowObj()&&Engine.hero.clearRefFollowObj();let n=T(t,e),a=i.getObjectFromCordsArray(n);if(a)return void Engine.hero.autoGoTo(a.cords);let s=T(t,e,!0),r=Engine.map.getCorrectAutoGoPos(s[0].x,s[0].y);Engine.hero.autoGoTo(r)}(e,t):function(t,e){let i=Engine.miniMapController.handHeldMiniMapController.getMiniMapTipController(),n=T(t,e),a=i.getObjectFromCordsArray(n);i.manageShowHideTip(t,a)}(e,t)}))}(),$(e).on("mousewheel DOMMouseScroll",m),C(d[u],d[u]),t.updatePos()},this.getCtx=function(){return i},this.getCanvas=function(){return e},this.getMargin=function(){return f},this.getScale=function(){return p},this.getSquareData=function(){return g},this.nameIsCorrect=function(t){if(""==l)return!0;let e=t;return e=e?e.toLowerCase():e,e.search(l.toLowerCase())>-1},this.setScale=O,this.getNewScale=function(){let t=Engine.map.size.x,i=(Engine.map.size.y,e.width,e.height,t*CFG.tileSize),n=(CFG.tileSize,t*s.MIN_SQUARE);return s.MIN_SQUARE,n/i},this.getNewOffset=function(){return[-Engine.hero.rx*s.MIN_SQUARE+e.width/2,-Engine.hero.ry*s.MIN_SQUARE+e.height/2]},this.setSquareData=S,this.setMargin=k,this.onResize=function(){t.isShow()&&(c&&clearTimeout(c),c=setTimeout((function(){b()}),200))},this.toggleMiniMap=function(){t.isShow()?A():(t.show(),t.setWndOnPeak())},this.removeControlPanel=function(){o=null},this.prepareScaleMarginSquareData=I,this.createControllPanel=v}},function(t,e,i){const n=i(0),a=i(61),s=i(10),r=i(77),o=i(40),l=(i(20),i(16)),c=i(412);t.exports=function(){let t="EditMiniMapWindowPanel.js";var e,i=this;this.standardIcons;let d={},h={},u={},p={},g={},f={};this.init=function(){this.initWindow(),this.initAllOptions(),this.centreWnd(),this.initSaveButton(),this.initSetDefaultSettingsBtn()};const m=e=>d[e]?d[e].getChooseColor():(errorReport(t,"getColorFromAllColorPickers","allColorPickers name not exist!",e),"#fc3e40"),v=e=>d[e]?d[e].getChooseIconId():(errorReport(t,"getIconIdFromAllColorPickers","allColorPickers name not exist!",e),0);this.initSetDefaultSettingsBtn=()=>{let t=n.get("button").addClass("green small");t.find(".label").html(_t("default_settings")),this.wnd.$.find(".save-colors").append(t),t.click(()=>{let t=_t("set_Default_settings_alert");confirmWithCallback({msg:t,clb:()=>{this.setDefaultSettings()}})})},this.setDefaultSettings=()=>{this.setDefaultInHtmlElements(),this.setDefaultMinLvl(),this.saveDataToStore()},this.setDefaultMinLvl=()=>{E(s.MIN_LEVEL_DATA),E(s.DATA_DRAWER_WIDTH_DATA),E(s.DATA_DRAWER_FONT_SIZE_DATA)};const E=t=>{let e=t.KEY,n=t.DEFAULT;i.wnd.$.find("#"+e).find("input").val(n)},_=t=>i.wnd.$.find("#"+t).find("input").val();this.setDefaultInHtmlElements=()=>{for(let t in d){let e=i.getIconFromDefault(t),n=i.getColorFromDefault(t);d[t].setColorAndUpdate(n),d[t].setIconIdAndUpdate(e)}for(let t in h)h[t].setChecked(!0);const t=Engine.miniMapController.handHeldMiniMapController;for(let e in u)u[e].setChecked(t.getDefaultDataDrawerNick(e));for(let e in p)p[e].setChecked(t.getDefaultDataDrawerProfAndLevel(e));for(let e in g)g[e].setChecked(t.getDefaultWhoIsHere(e));for(let e in f)f[e].setChecked(t.getDefaultMapBlur(e))},this.initSaveButton=function(){var t=n.get("button").addClass("green small");t.find(".label").html(_t("save")),this.wnd.$.find(".save-colors").append(t),t.click((function(){i.saveDataToStore(),i.close()}))},this.centreWnd=function(){this.wnd.center()},this.initLabels=function(){var t=this.wnd.$;t.find(".edit-header-label").html(_t("portable_map")),t.find(".show-monsters-header").html(_t("show_monsters")),t.find(".show-label-window-map").html("PORTABLE_MAP"),t.find(".show-label-data-drawer-nick").html("D_NICK"),t.find(".show-label-data-drawer-prof-and-level").html("D_PPROF_&_LVL"),t.find(".show-label-who-is-here").html("WHO_IS_HERE"),t.find(".show-label-map-blur").html("MAP_BLUR"),t.find(".color-label").html(_t("color",null,"whoIsHere"))},this.initWindow=function(){e=n.get("divide-and-color-edit"),Engine.windowManager.add({content:e,title:_t("option"),nameWindow:Engine.windowsData.name.EDIT_MINI_MAP_WINDOW,objParent:this,nameRefInParent:"wnd",onclose:()=>{i.close()}}),i.wnd.addToAlertLayer()},this.saveDataToStore=function(){var t=Engine.miniMapController.handHeldMiniMapController.getNamesTab();for(var e in t){let t=m(e),i=v(e),n=N(e),s=k(e),r=S(e),o=O(e),l=M(e),c=n.getChecked();if(a.setColorOfKindByName(e,t),a.setIconOfKindByName(e,i),a.setStateOfKindByName(e,c),s){let t=s.getChecked();a.setDataDrawerNickOfKindByName(e,t)}if(r){let t=r.getChecked();a.setDataDrawerProfAndLevelOfKindByName(e,t)}if(o){let t=o.getChecked();a.setWhoIsHereOfKindByName(e,t)}if(l){let t=l.getChecked();a.setMapBlurOfKindByName(e,t)}}let i=_(s.MIN_LEVEL_DATA.KEY),n=_(s.DATA_DRAWER_WIDTH_DATA.KEY),r=_(s.DATA_DRAWER_FONT_SIZE_DATA.KEY);a.setMinLevelOfKindByName(i),a.setWidthDataDrawerOfKindByName(n),a.setFontSizeDataDrawerOfKindByName(r),Engine.miniMapController.handHeldMiniMapController.refreshMiniMapController(),Engine.whoIsHere.updateWhoIsHereAfterSaveInServerStorage()},this.initAllOptions=function(){var t=this.wnd.$.find(".global-option"),e=this.wnd.$.find(".by-name-option"),i=Engine.miniMapController.handHeldMiniMapController.getNamesTab();let n=new c;this.createOneAmountOption(s.MIN_LEVEL_DATA,t),this.createOneAmountOption(s.DATA_DRAWER_WIDTH_DATA,t),this.createOneAmountOption(s.DATA_DRAWER_FONT_SIZE_DATA,t);let a={},r={},o={},l={},m={},v={},E=[];for(var _ in i){let t=this.createOneOption(_,i[_],a,r,o,l,m,v,n);E.push(t)}h=a,u=r,p=o,g=l,f=m,d=v;let b={$wrapper:e,$headerRecord:L(n),bodyRecordsArray:E,addClass:"config-characters-table"};n.init(b)},this.createOneAmountOption=function(t,e){let i,a=n.get("text-and-input"),s=t.KEY,r=t.DEFAULT,o=Engine.miniMapController.handHeldMiniMapController.getAmountElementFromStorage(t);const c=t.MIN,d=t.MAX;i=createNiInput({cl:"input-wrapper",type:l.TYPE.NUMBER,keyUpClb:(t,e)=>{e.stopPropagation(),"Enter"!=e.originalEvent.code&&"Esc"!=e.originalEvent.code||i.find("input").blur()},focusoutClb:(t,e)=>{b(i.find("input"),r,t,c,d)},tip:`${c} - ${d}`,clear:!1,val:o}),a.append(i),a.attr("id",s),i.find("input").val(o),a.find(".text").html(_t(s,null,"edit-panel-option")),e.append(a)};const b=(t,e,i,n,a)=>{null!=i&&""!=i?(i>a&&t.val(a),i<n&&t.val(n)):t.val(e)};this.createOneOptionOld=function(t,e,i,a,s,r,o,l,c){let d=n.get("divide-and-color-record");return d.attr("id",t),i.append(d),d.find(".text").html(_t(t,null,"edit-panel-option")),x(d,t,c),w(t,e,d,a,s,r,o,l),d},this.createOneOption=function(t,e,n,a,s,r,o,l,c){let d=i.getStateElementFromStorage(t),h=$("<div>").html(_t(t,null,"edit-panel-option")),u=$("<div>"),p=$("<div>"),g=$("<div>"),f=$("<div>"),m=$("<div>"),v=C(t),E=T(t),_=y(t),b=I(t),w=A(t);const k=Engine.miniMapController.handHeldMiniMapController;if(R(d,v,u,n,t),isset(e.dataDrawerNick)){let e=k.getDataDrawerNickOfKindByName(t);R(e,E,p,a,t)}else p.html("-");if(isset(e.dataDrawerProfAndLevel)){let e=k.getDataDrawerProfAndLevelOfKindByName(t);R(e,_,g,s,t)}else g.html("-");if(isset(e.whoIsHere)){let e=k.getWhoIsHereOfKindByName(t);R(e,b,f,r,t)}else f.html("-");if(isset(e.mapBlur)){let e=k.getMapBlurOfKindByName(t);R(e,w,m,o,t)}else m.html("-");let S=" table-with-static-header-td center";return c.createRecords([h,f,m,u,p,g,x(t,l)],["catergory"+S,"show-portable-map"+S,"show-data-drawer-nick"+S,"show-data-drawer-prof"+S,"show-who-is-here"+S,"show-map-blur"+S,"color-wrapper"+S])};const w=(t,e,n,a,s,r,o,l)=>{let c=i.getStateElementFromStorage(t),d=n.find(".show-hand-held-mini-map-checkbox-wrapper"),h=n.find(".show-data-drawer-nick-checkbox-wrapper"),u=n.find(".show-data-drawer-prof-and-level-checkbox-wrapper"),p=n.find(".show-who-is-here-checkbox-wrapper"),g=n.find(".show-map-blur-checkbox-wrapper"),f=C(t),m=T(t),v=y(t),E=I(t),_=A(t);const b=Engine.miniMapController.handHeldMiniMapController;if(R(c,f,d,a,t),isset(e.dataDrawerNick)){let e=b.getDataDrawerNickOfKindByName(t);R(e,m,h,s,t)}if(isset(e.dataDrawerProfAndLevel)){let e=b.getDataDrawerProfAndLevelOfKindByName(t);R(e,v,u,r,t)}if(isset(e.whoIsHere)){let e=b.getWhoIsHereOfKindByName(t);R(e,E,p,o,t)}if(isset(e.mapBlur)){let e=b.getMapBlurOfKindByName(t);R(e,_,g,l,t)}},C=t=>t+"-show-checbox-portable-map",T=t=>t+"-show-checkbox-data-drawer-nick",y=t=>t+"-show-checkbox-data-drawer-prof-and-level",I=t=>t+"-show-checkbox-who-is-here",A=t=>t+"-show-checkbox-map-blur",k=t=>u[t],S=t=>p[t],O=t=>g[t],M=t=>f[t],N=t=>h[t],R=(t,e,i,n,a)=>{const s=new o.default({name:"",value:"",i:e,checked:t},t=>{});i.append($(s.getCheckbox())),n[a]=s},x=(t,e)=>{let i=new r,n=$("<div>").addClass("color-picker-wrapper"),a=this.getColorFromStore(t),s=this.getIconFromStore(t);return i.init(),i.updateData(n,a,parseInt(s)),e[t]=i,n};this.getStateElementFromStorage=function(t){let e=a.getStateOfKindByName(t);if(null!==e)return e;return a.setStateOfKindByName(t,!0),!0},this.getColorFromStore=function(t){let e=a.getColorOfKindByName(t);return e||i.getColorFromDefault(t)},this.getIconFromStore=function(t){let e=a.getIconOfKindByName(t);return null==e?Engine.miniMapController.handHeldMiniMapController.getDefaultIcon(t):e},this.getColorFromDefault=function(t){return Engine.miniMapController.handHeldMiniMapController.getDefaultColor(t)},this.getIconFromDefault=function(t){return Engine.miniMapController.handHeldMiniMapController.getDefaultIcon(t)},this.getStateFromStorage=function(t){let e=a.getStateOfKindByName(t);if(null!==e)return e;return a.setStateOfKindByName(t),!0},this.close=function(){i.wnd.remove(),Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow().removeControlPanel()},this.initColorsTab=function(){["#fc3e40","#767676","#87fdff","#93441c","#4cfa4f","#fe5afb","#40bfff","#f37125","#a500fc","#ffba37","#eaeaea","#93b900","#fef348","#3559ff","#c71618","#ffa9fe","#46a31d","#292929"]},this.initIconsTab=function(){this.standardIcons=Engine.miniMapController.handHeldMiniMapController.getIcons()};const L=t=>{let e=" table-with-static-header-header-td center",i=_t("hero_name").replace(" ","<br>");return t.createRecords([_t("option",null,"edit-panel-option"),_t("players_on_map"),_t("lighting",null,"whoIsHere"),_t("portable_map"),i,_t("levelAndProf",null,"edit-panel-option"),_t("color",null,"whoIsHere")],["catergory"+e,"show-portable-map"+e,"show-data-drawer-nick"+e,"show-data-drawer-prof"+e,"show-who-is-here"+e,"show-map-blur"+e,"color-wrapper"+e])}}},function(t,e,i){let n=i(0);t.exports=function(){let t,e=null;const i=()=>{t=$("<div>").addClass("scroll-table-plug"),$(e).find(".table-with-static-header").append(t)},a=t=>{e=n.get("table-with-static-header"),t&&e.addClass(t)},s=t=>{e.find(".table-with-static-header-header").append(t)},r=t=>{let i=e.find(".table-with-static-header-table");for(let e=0;e<t.length;e++)i.append(t[e])},o=()=>{$(".scroll-wrapper",e).trigger("update");let i=$(e).find(".table-with-static-header");t.height(i.height()-2)},l=t=>{let i={track:!0,addScrollableClassToAnotherEl:e.find(".table-with-static-header")};t&&(i.callback=t),e.find(".scroll-wrapper").addScrollBar(i)};function c(t,e,i){e&&e[i]&&t.on("click",()=>{e[i]()})}this.init=t=>{let{$wrapper:n,$headerRecord:c,bodyRecordsArray:d,addClass:h,scrollMove:u}=t;a(h),s(c),r(d),l(u),i(),n.append(e),o()},this.scrollTop=()=>{$(".scroll-wrapper",e).trigger("scrollTop")},this.updateScroll=o,this.getTable=()=>e,this.createRecords=(t,e,i)=>{for(var n=$("<tr>"),a=0;a<t.length;a++){var s=$("<td>").html(t[a]);"object"==typeof e?s.addClass(e[a]):s.addClass(e),c(s,i,a),n.append(s)}return n}}},function(t,e,i){let n=i(10);t.exports=function(){let t={[n.STATIC_ICONS.SQUARE]:{},[n.STATIC_ICONS.CIRCLE]:{},[n.STATIC_ICONS.RHOMB]:{}};this.init=function(){},this.addImageObject=function(e,i,n,a){isset(t[i][n])||(t[i][n]={}),t[i][n][a]=e},this.checkImageObjectExist=function(e,i,n){return!!isset(t[e][i])&&!!isset(t[e][i][n])},this.getImageObject=function(e,i,n){return t[e][i][n]}}},function(t,e,i){let n=i(415),a=i(10);t.exports=function(){let t,e={};function i(e,i){t.show(e,i)}function s(e){t.hide(e)}function r(t,i){if(!e.hasOwnProperty(i))return null;if(!e[i].hasOwnProperty(t))return null;return function(t){if(t.hero&&o(a.TYPE.HERO,t.hero))return[a.TYPE.HERO,t.hero];if(t.npc&&o(a.TYPE.NPC,t.npc))return[a.TYPE.NPC,t.npc];if(!c(t.other)){let e=l(a.TYPE.OTHER,t.other);if(null!=e)return[a.TYPE.OTHER,e]}if(!c(t.rip)){let e=l(a.TYPE.RIP,t.rip);if(null!=e)return[a.TYPE.RIP,e]}if(!c(t.item)){let e=l(a.TYPE.ITEM,t.item);if(null!=e)return[a.TYPE.ITEM,e]}const e=a.TYPE.RESP;if(!c(t[e])){let i=l(e,t[e]);if(null!=i)return[e,i]}return t.gateway&&o(a.TYPE.GATEWAY,t.gateway)?[a.TYPE.GATEWAY,t.gateway]:null}(e[i][t])}function o(t,e){return Engine.miniMapController.handHeldMiniMapController.getObjectController(t).getObject(e).checkVisible()}function l(t,e){for(let i in e)if(o(t,i))return i;return null}function c(t){return!Object.keys(t).length}function d(t,e){return Engine.miniMapController.handHeldMiniMapController.getObjectController(t).getObject(e)}this.init=function(){t=new n,t.init()},this.addToCords=function(t,i,n,s){switch(e.hasOwnProperty(i)||(e[i]={}),e[i].hasOwnProperty(t)||(e[i][t]={[a.TYPE.NPC]:null,[a.TYPE.OTHER]:{},[a.TYPE.RIP]:{},[a.TYPE.GATEWAY]:null,[a.TYPE.ITEM]:{},[a.TYPE.HERO]:null,[a.TYPE.RESP]:{}}),n){case a.TYPE.NPC:case a.TYPE.GATEWAY:case a.TYPE.HERO:e[i][t][n]=s;break;case a.TYPE.RESP:case a.TYPE.OTHER:case a.TYPE.RIP:case a.TYPE.ITEM:e[i][t][n][s]=!0;break;default:console.error("incorrect CORDS TYPE",n)}},this.removeFromCords=function(t,i,n,s){if(e.hasOwnProperty(i)&&e[i].hasOwnProperty(t))switch(n){case a.TYPE.NPC:case a.TYPE.GATEWAY:case a.TYPE.HERO:e[i][t][n]=null;break;case a.TYPE.RESP:case a.TYPE.OTHER:case a.TYPE.RIP:case a.TYPE.ITEM:delete e[i][t][n][s];break;default:console.error("incorrect CORDS TYPE",n)}},this.getObjectFromCordsArray=function(t){for(let e in t){let i=t[e],n=parseFloat(i.x),a=parseFloat(i.y),s=r(n,a);if(s)return{object:s,cords:{x:n,y:a}}}return null},this.clearCords=function(){e={}},this.manageShowHideTip=function(t,e){if(e){let n=d(e.object[0],e.object[1]);n.getTip&&n.checkCanShowTip()&&i(t,n)}else s(t)},this.getObjectByBelongTypeAndId=d,this.show=i,this.hide=s}},function(t,e){t.exports=function(){var t;this.init=function(){t=$(".handheld-mini-map-canvas")},this.show=function(e,i){t.tip(null);let n=i.getTip();n?(t.tip(n[0],n[1],null,n[2]),t.tipShow(e,i)):console.warn("tipNotExist",i.getRef())},this.hide=function(e){t.tip(null),t.tipHide(e)}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t;this.init=function(){},this.updateData=function(){t?(t.updateMapObjectInCords(),t.setPos()):(t=new n,t.setRef(Engine.hero),t.setKind(a.KIND.HERO),t.setColor(),t.setShape(),t.setBelongType(a.TYPE.HERO),t.addMapObjectToCords(),t.setPos(),function(t){const e=$("<div />"),i=$('<div class="avatar-icon" />');createImgStyle(i,CFG.a_opath+Engine.hero.d.img),e.append(Engine.hero.createStrTip()).append(i),t.setTip(e,"t_other")}(t))},this.clearAllLists=function(){t=null},this.getObject=function(){return t},this.draw=function(e,i){if(Engine.miniMapController.handHeldMiniMapController.canUpdate(a.TYPE.HERO,a.KIND.HERO)){if(!t)return;if(t.draw(e),!Engine.warShadow.canDraw||!Engine.settings||Engine.opt(24))return;t.drawWarShadow(e,i)}}}},function(t,e,i){let n=i(24),a=i(10);i(17);t.exports=function(){let t={},e={},i={},s={},r={},o={},l={},c={},d={},h={};function u(n){switch(n){case a.KIND.MARK_OBJECT:return c;case a.KIND.NORMAL_OTHER:return d;case a.KIND.FRIEND:return t;case a.KIND.ENEMY:return e;case a.KIND.CLAN:return i;case a.KIND.CLAN_FRIEND:return s;case a.KIND.CLAN_ENEMY:return r;case a.KIND.GROUP:return o;case a.KIND.WANTED:return l;default:console.error("incorrect kind",n)}}function p(t){h[t].remove(),delete h[t]}function g(t){let e=h[t].getRef(),i=e.getKind(),n=h[t].getKind();if(m(e)){if(n!=i){h[t].deleteFromBelongList(),h[t].setKind(i),h[t].addToBelongList(a.TYPE.OTHER),h[t].clearImageObject(),h[t].setColor(),h[t].setShape();let e=i==a.KIND.MARK_OBJECT?1:null;h[t].setAlpha(e)}h[t].updateMapObjectInCords(),h[t].setPos()}}function f(t,e){let i=getEngine().others.getById(t),s=(r=i,getEngine().others.findKindOther(r));var r;if(h[t]=new n,h[t].setRef(e),h[t].setPos(),h[t].setKind(s),!m(e))return;h[t].addToBelongList(a.TYPE.OTHER),h[t].addMapObjectToCords(),h[t].setColor(),h[t].setShape();let o=s==a.KIND.MARK_OBJECT?1:null;h[t].setAlpha(o),function(t){const e=t.getRef(),i=$("<div />"),n=$('<div class="avatar-icon" />');createImgStyle(n,CFG.a_opath+e.d.icon),i.append(e.createStrTip()).append(n),t.setTip(i,"t_other")}(h[t])}function m(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=t.d.nick;return e.nameIsCorrect(i)}this.draw=function(t,e){let i=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.TYPE.OTHER);for(let n in i){let i=u(n);for(let n in i)h[n].draw(t,e)}},this.getObject=function(t){return h[t]},this.updateData=function(t){for(let e in t){if(t[e].del){p(e);continue}let i=Engine.others.getById(e);i?(h[e]&&g(e),h[e]||f(e,i)):console.warn("[MiniMapOtherController.js, updateData] Other not exist",e)}},this.init=function(){},this.deleteFromList=function(t,e){delete u(t)[e]},this.addToList=function(t,e){u(t)[e]=!0},this.clearAllLists=function(){t={},e={},i={},s={},r={},o={},l={},c={},d={},h={}}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t={},e={},i={},s={},r={},o={},l={},c={},d={},h={};function u(n){switch(n){case a.KIND.NPCS:return t;case a.KIND.NORMAL_MONSTER:return e;case a.KIND.ELITE_1:return i;case a.KIND.ELITE_2:return s;case a.KIND.ELITE_3:return r;case a.KIND.HEROS:return o;case a.KIND.COLOSSUS:return l;case a.KIND.TYTAN:return c;case a.KIND.RECOVERY:return d;default:console.error("incorrect kind",n)}}function p(t){return 2==t.d.type||3==t.d.type}function g(t){let e=Engine.npcs.getById(t),i=e.getKind();null!=i&&(h[t]=new n,h[t].setRef(e),h[t].setKind(i),p(e)&&!function(t){const e=t.d.hasOwnProperty("elasticLevelFactor")?Engine.npcs.getById(t.d.id).getElasticMobLevel():t.d.lvl;let i=Engine.miniMapController.handHeldMiniMapController.getMinLevel();return e>=i}(e)||function(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=t.d.nick;return e.nameIsCorrect(i)}(e)&&(h[t].addToBelongList(a.TYPE.NPC),h[t].addMapObjectToCords(),h[t].setColor(),h[t].setShape(),function t(e,i){let n=e.getRef();if(!n.getOnloadProperImg())return void setTimeout((function(){t(e,i)}),1e3);let a=createNpcIcon("mini-map-monster-icon-container","mini-map-monster-icon",CFG.a_npath+n.d.icon,n.frameAmount,n.fw,n.fh,190),s=Engine.npcs.getTip(n);e.setTip(s+a,"t_npc")}(h[t],i)))}function f(t){h[t]?(h[t].remove(),delete h[t]):warningReport("MiniMapNpcController.js","deleteNpc","Double npc del bug in mini map",t)}this.draw=function(t,e){let i=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.TYPE.NPC);for(let n in i){let i=u(n);for(let n in i)h[n].draw(t,e)}},this.init=function(){},this.deleteFromList=function(t,e){delete u(t)[e]},this.updateData_npcs_del=function(t){for(let e in t){f(t[e].id)}},this.addToList=function(t,e){u(t)[e]=!0},this.updateData=function(t){for(let e=0;e<t.length;e++){g(t[e].id)}},this.clearAllLists=function(){t={},e={},i={},s={},r={},o={},l={},c={},d={},h={}},this.getObject=function(t){return h[t]}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t={},e={};function i(){Engine.items.fetch(Engine.itemsFetchData.NEW_MINI_MAP_GROUND_ITEM,s)}function s(t){let i=t.d.id;e[t.d.id]=new n,e[i].setRef(t),e[i].setKind(a.KIND.RECOVERY),function(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=t.name;return e.nameIsCorrect(i)}(t)&&(e[i].addToBelongList(a.TYPE.ITEM),e[i].addMapObjectToCords(),e[i].setColor(),e[i].setShape(),e[i].addMapObjectToCords(),function(t){let e=t.getRef(),i=parseItemBB(e.name)+'<div class="item-mini-map-icon" style="background-image:url('+CFG.a_ipath+e.icon+'")></div>';t.setTip(i)}(e[i]),t.on("delete",(function(){e[i]&&(e[i].remove(),delete e[i])})))}function r(e){switch(e){case a.KIND.RECOVERY:return t;default:console.error("incorrect kind",e)}}this.getObject=function(t){return e[t]},this.draw=function(t,i){let n=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.TYPE.ITEM);for(let a in n){let n=r(a);for(let a in n)e[a].draw(t,i)}},this.init=function(){i()},this.deleteFromList=function(t,e){delete r(t)[e]},this.addToList=function(t,e){r(t)[e]=!0},this.setFetch=i,this.clearFetch=function(){Engine.items.removeCallback(Engine.itemsFetchData.NEW_MINI_MAP_GROUND_ITEM)},this.clearAllLists=function(){t={},e={}}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t={},e={};function i(e){switch(e){case a.KIND.RIP:return t;default:console.error("[MiniMapRipController.js, getListByKind] incorrect kind:",e)}}function s(t){let i=Engine.map.rip.getRipById(t);e[t]=new n,e[t].setRef(i),e[t].setKind(a.KIND.RIP),function(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=t.nick;return e.nameIsCorrect(i)}(i)&&(e[t].addToBelongList(a.TYPE.RIP),e[t].addMapObjectToCords(),e[t].setColor(),e[t].setShape(),function(t){let e=t.getRef(),i="<div>"+e.tip[0]+'</div><div class="rip-icon" style="background-image:url(/img/rip2.gif)"></div>';t.setTip(i,"t_rip")}(e[t]))}this.getObject=function(t){return e[t]},this.draw=function(t,n){let s=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.KIND.RIP);for(let a in s){let s=i(a);for(let i in s)e[i].draw(t,n)}},this.init=function(){},this.deleteFromList=function(t,e){delete i(t)[e]},this.addToList=function(t,e){i(t)[e]=!0},this.updateData=function(t){for(let e in t){s(t[e].d.id)}},this.clearAllLists=function(){t={},e={}},this.deleteRip=function(t){e[t]?(e[t].remove(),delete e[t]):console.warn("[MiniMapRipController.js, deleteRip] Bug in Rips.js. Should be fix in future")}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t={},e={};function i(e){switch(e){case a.KIND.GATEWAY:return t;default:console.error("incorrect kind",e)}}function s(t){let i=Engine.map.gateways.getGtwById(t);i||console.error("noooo!");for(let s in i){let l=t+"x"+i[s].d.x+"y"+i[s].d.y;e[l]=new n,e[l].setRef(i[s]),e[l].setKind(a.KIND.GATEWAY),r(i[s])&&(e[l].addToBelongList(a.TYPE.GATEWAY),e[l].addMapObjectToCords(),e[l].setColor(),e[l].setShape(),o(e[l]))}}function r(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=isset(t.tip)?t.tip[0]:t.master.tip[0];return e.nameIsCorrect(i)}function o(t){let e=t.getRef(),i="<div>"+(isset(e.tip)?e.tip[0]:e.master.tip[0])+'</div><div class="exit-icon" style="background-image:url(/img/exit.png)"></div>';t.setTip(i)}this.draw=function(t,n){let s=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.TYPE.GATEWAY);for(let a in s){let s=i(a);for(let i in s)e[i].draw(t,n)}},this.init=function(){},this.deleteFromList=function(t,e){delete i(t)[e]},this.addToList=function(t,e){i(t)[e]=!0},this.updateData=function(t){for(let e in t){s(t[e].d.id)}},this.clearAllLists=function(){t={},e={}},this.getObject=function(t){return e[t]}}},function(t,e,i){let n=i(24),a=i(10);t.exports=function(){let t="MiniMapRespController.js",e={},i={},s={};function r(n){switch(n){case a.KIND.HEROES_RESP:return e;case a.KIND.HEROES_RESP_E:return i;default:errorReport(t,"getListByKind","incorrect kind",n)}}function o(e){let i=Engine.heroesRespManager.getById(e),r=function(e){const i=e.getKind();switch(i){case 0:case 2:return a.KIND.HEROES_RESP;case 1:return a.KIND.HEROES_RESP_E;default:errorReport(t,"findKind","incorrect kind",i)}}(i);null!=r&&(s[e]=new n,s[e].setRef(i),s[e].setKind(r),function(t){let e=t.getLvl(),i=t.getKind(),n=Engine.hero.d.lvl,a=Engine.worldConfig.getDropDestroyLvl();return function(t,e,i,n){if(0===e)return t>=250?i+50>=t:t>=100?t+n>=i&&i+50>=t:i>=Math.floor(t/2)&&t+n>=i;return(1===e||2===e)&&i>=Math.floor(t/2)}(e,i,n,a)}(i)&&function(t){let e=Engine.miniMapController.handHeldMiniMapController.getHandHeldMiniMapWindow(),i=t.getNick();return e.nameIsCorrect(i)}(i)&&(s[e].addToBelongList(a.TYPE.RESP),s[e].addMapObjectToCords(),s[e].setColor(),s[e].setShape(),function(t,e){let i=t.getRef();const n=Engine.npcs.getTip(i.getData()),a=`${_t("resp-time")}: <span class="nowrap">${i.getPreparedResp()}</span><br>`,s=`${_t("visibility")}: <span class="nowrap">${i.getPreparedLvlRanges()}</span>`,r=_t("possible-resp-place")+":<br><br>"+n+"<br><br>"+a+s;t.setTip(r,"t_npc")}(s[e])))}this.draw=function(t,e){let i=Engine.miniMapController.handHeldMiniMapController.getShowObject(a.TYPE.RESP);for(let n in i){let i=r(n);for(let n in i)s[n].draw(t,e)}},this.init=function(){},this.deleteFromList=function(t,e){delete r(t)[e]},this.addToList=function(t,e){r(t)[e]=!0},this.updateData=function(t){for(let e in t)o(e)},this.clearAllLists=function(){e={},i={},s={}},this.getObject=function(t){return s[t]}}},function(t,e,i){var n=i(5),a=i(20);t.exports=new function(){this.getStateByKind=t=>n.easyGet(a.MINI_MAP_CONTROLLER.mainKey,t,a.MINI_MAP_CONTROLLER.STATE),this.setStateByKind=(t,e)=>{n.easySet(e,a.MINI_MAP_CONTROLLER.mainKey,t,a.MINI_MAP_CONTROLLER.STATE)}}},function(t,e,i){"use strict";t.exports=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.selector=t,this.passedOptions=e,this.pos={x:0,y:0},this.scale=1,this._zoomTarget={x:0,y:0},this.moving=!1,this.pointers=[],this.defaultOptions={minScale:1,maxScale:6,factor:.5},this.prevDiff=-1,this.onWheel=t=>{t.preventDefault();const{deltaY:e,deltaMode:i,pageX:n,pageY:a}=t;let s=0===i?e:15*e;s=s=-Math.max(-100,Math.min(100,s));const r=this.el.getBoundingClientRect();let o={x:n-(r.left+document.body.scrollLeft),y:a-(r.top+document.body.scrollTop)};this.zoom({delta:s,zoomPoint:o})},this.onPointerDown=t=>{t.preventDefault(),this.addGlobalListeners(),this.startPos={x:this.pos.x,y:this.pos.y},this.clickPos={x:t.clientX,y:t.clientY},this.movingStart(),this.addPointer(t)},this.onPointerUp=t=>{this.removePointer(t),this.getPointersAmount()<2&&(this.prevDiff=-1),0===this.getPointersAmount()&&this.removeGlobalListeners(),this.moving=!1,document.body.classList.remove("no-select")},this.onPointerMove=t=>{t.preventDefault();for(let e=0;e<this.getPointersAmount();e++)if(t.pointerId===this.pointers[e].pointerId){this.pointers[e]=t;break}if(2===this.getPointersAmount()){const t=this.getDistance(this.pointers[0],this.pointers[1]),e=this.getMidpoint(this.pointers[0],this.pointers[1]);if(this.prevDiff>0){let i=t>this.prevDiff?1:-1;this.zoom({delta:i,zoomPoint:e,type:"pinch"})}this.prevDiff=t}else{const e=this.getOuterZoom();if(!0===this.moving){const i=t.clientX-this.clickPos.x,n=t.clientY-this.clickPos.y;this.pos.x=this.startPos.x+i/e,this.pos.y=this.startPos.y+n/e,this.setMatrix()}}},"undefined"==typeof RUNNING_UNIT_TEST&&this.init()}init(){this.setOptions(),this.setElements(),this.connectEvents()}setElements(){if(this.el=document.querySelector(this.selector),!this.el)throw Error(`DragZoom: not found element with selector "${this.selector}"`);if(this.zoomedEl=this.el.firstElementChild,!this.zoomedEl)throw Error("DragZoom: not found child element for zooming and dragging");this.zoomedEl.style.transformOrigin="0 0",this.el.style.touchAction="none"}setOptions(){this.options=Object.assign(Object.assign({},this.defaultOptions),this.passedOptions),this.options.factor/=100}connectEvents(){this.el.addEventListener("wheel",this.onWheel),this.el.addEventListener("pointerdown",this.onPointerDown)}addGlobalListeners(){document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)}removeGlobalListeners(){document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp)}zoom(t){let{delta:e,zoomPoint:i,type:n="scroll"}=t;const a=this.getOuterZoom();i={x:i.x/a,y:i.y/a};const s="scroll"===n?this.options.factor:8*this.options.factor;this._zoomTarget.x=(i.x-this.pos.x)/this.scale,this._zoomTarget.y=(i.y-this.pos.y)/this.scale,this.scale+=e*s*this.scale,this.scale=Math.max(this.options.minScale,Math.min(this.options.maxScale,this.scale)),this.pos.x=-this._zoomTarget.x*this.scale+i.x,this.pos.y=-this._zoomTarget.y*this.scale+i.y,this.setMatrix()}getMidpoint(t,e){return{x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}}getDistance(t,e){return e?Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2)):0}movingStart(){this.moving=!0,document.body.classList.add("no-select")}addPointer(t){this.pointers.push(t)}removePointer(t){this.pointers=this.pointers.filter(e=>e.pointerId!==t.pointerId)}getPointersAmount(){return this.pointers.length}centerOn(t){let e="object"==typeof t?t:this.el.querySelector(t);if(!e)throw Error(`DragZoom: not found element with selector "${e}"`);{let t={left:e.offsetLeft,top:e.offsetTop},i=e.clientWidth,n=e.clientHeight;this.pos.x=this.el.clientWidth/2-(t.left+document.body.scrollLeft+i/2)*this.scale,this.pos.y=this.el.clientHeight/2-(t.top+document.body.scrollTop+n/2)*this.scale,this.setMatrix()}}setScale(t){this.scale=t}setPosition(t){if(!t.hasOwnProperty("x")||!t.hasOwnProperty("y"))throw Error("Wrong position argument - expects { x: XXX, y: YYY }");this.pos=t}resetPosition(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setPosition({x:0,y:0}),t&&this.setMatrix()}resetScale(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setScale(1),t&&this.setMatrix()}resetScaleAndPosition(){this.resetScale(!1),this.resetPosition(!1),this.setMatrix()}setMatrix(){const t=`matrix(${this.scale}, 0, 0, ${this.scale}, ${this.pos.x}, ${this.pos.y})`;return"undefined"==typeof RUNNING_UNIT_TEST&&(this.zoomedEl.style.transform=t),t}getOuterZoom(){return this.roundToTwo(this.el.getBoundingClientRect().width/this.el.offsetWidth)}roundToTwo(t){return+(Math.round(t+"e+2")+"e-2")}}},function(t,e,i){var n=i(0),a=i(426),s=i(5);t.exports=function(){var t,e,i,r,o,l,c,d,h=this,u=null,p=_t("coloseum",null,"matchmaking"),g=!1,f=!1,m=!1,v=null,E={current:null,max:null},_={current:null,max:null},b=null;this.init=function(){this.initWindow(),this.hidePanel(),r=n.get("matchmaking-overlay"),this.createMainWndMatchmaking(),this.createChooseEq(),this.createStatsAndHistory(),this.createProgressPanel(),this.createRanking(),this.createStatisticsDetailed(),this.createDetailsWindow(),this.createSeasonRewardMain(),this.setGreenHeader(p),this.createBlinkerWaitIcon(),this.showMainWnd(".matchmaking-menu"),this.initFetch(),this.initScroll(),this.summary=new a,this.summary.init()},this.initScroll=function(){this.wnd.$.find(".reward-wrapper").addScrollBar({track:!0})},this.createSeasonRewardMain=function(){var t=n.get("button").addClass("small green");h.wnd.$.find(".take-reward").append(t),t.find(".label").html(h.tLang("take_reward_in_next_time")),t.click((function(){h.showMatchmakingMenu()}))},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_SEASON_TPL,h.newSeasonItem),Engine.tpls.fetch(Engine.itemsFetchData.NEW_SEASON_REWARD_TPL,h.newSeasonRewardItem),Engine.tpls.fetch(Engine.itemsFetchData.NEW_PROGRESS_TPL,h.newProgressItem)},this.newProgressItem=function(t){h.wnd.$.find(".progress-tpl-slot-id-"+t.id).each((function(){var e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.PROGRESS_ITEM_VIEW,"d")[0];$(this).append(e),e.click((function(){var t=h.canTakeItem2($(this).parent());t&&t.f()})),e.contextmenu((function(e,i){var n=h.canTakeItem2($(this).parent());t.createOptionMenu(getE(e,i),n)}))}))},this.newSeasonRewardItem=function(t){h.wnd.$.find(".season-reward-main").find(".tpl-"+t.id).each((function(){$(this).empty();var e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.SEASON_REWARD_ITEM_VIEW,"i")[0],i=$(this).attr("data-amount");Engine.tpls.changeItemAmount(t,e,i),$(this).append(e),e.attr("data-tip-type",t.$.data("tipType")),e.attr("data-item-type",t.$.data("itemType")),e.contextmenu((function(e,i){t.createOptionMenu(getE(e,i))}))}))},this.newSeasonItem=function(t){h.wnd.$.find(".season-wnd").find(".tpl-"+t.id).each((function(){var e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.SEASON_ITEM_VIEW,"r")[0],i=$(this).attr("data-amount");Engine.tpls.changeItemAmount(t,e,i),$(this).html(e),e.attr("data-tip-type",t.$.data("tipType")),e.attr("data-item-type",t.$.data("itemType")),e.contextmenu((function(e,i){t.createOptionMenu(getE(e,i))}))}))},this.canTakeItem2=function(t){var e=t.attr("reward_stage");if(null!=e){var i=t.attr("reward_idx");return{txt:h.tLang("take_reward"),f:function(){_g("match&a=profile&reward_stage="+e+"&reward_idx="+i)}}}return!1},this.createHugeRewardTpl=function(t){isset(l)||(l=t)},this.createBigRewardTpl=function(t){isset(c)||(c=t)},this.createSmallRewardTpl=function(t){isset(d)||(d=t)},this.createDetailsWindow=function(){var t=n.get("details-progress");t.find(".details-txt").html(h.tLang("details_progress")),t.find(".details-header").html(h.tLang("details")),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.DETAILS_WND_MATCHMAKING,objParent:this,nameRefInParent:"detailsWnd",type:Engine.windowsData.type.TRANSPARENT,addClass:"mm-details-window",onclose:()=>{h.detailsWnd.hide()}}),h.detailsWnd.hide(),h.detailsWnd.addToAlertLayer()},this.toogleDetails=function(t){t.stopPropagation(),h.detailsWnd.setWndOnPeak();var e="none"==h.detailsWnd.$.css("display");h.detailsWnd.$.css("display",e?"block":"none")},this.createProgressPanel=function(){var t=n.get("button").addClass("small green"),e=n.get("button").addClass("small green");t.find(".label").html(h.tLang("details")),e.find(".label").html(h.tLang("champions-shop")),h.wnd.$.find(".progress-wnd").find(".details-btn").append(t),h.wnd.$.find(".progress-wnd").find(".go-to-shop-btn").append(e),t.click(h.toogleDetails),e.click((function(){Engine.shop&&Engine.shop.close(),h.hidePanel(),_g("creditshop&npc=471")}))},this.createBlinkerWaitIcon=function(){setInterval((function(){var t=$(".matchmaking-timer"),e="green";t.hasClass(e)?t.removeClass(e):t.addClass(e)}),2e3)},this.updateSearch=function(t){var i=t.since;e&&(clearInterval(e),e=null),e=setInterval((function(){var e=h.getDurationVal(t.avg_duration),n=i<60?i+"s":Math.round(i/60)+"min",a="<div>"+_t("average_wait_time %val",{"%val%":e},"matchmaking")+"</div>",s="<div>"+_t("time_in_queue %val",{"%val%":n},"matchmaking")+"</div>";$(".matchmaking-timer").tip(a+s),i++}),1e3)},this.getDurationVal=function(t){return 0==t?"-":600==t?"~10min":"~"+(t<60?t+"s":Math.round(t/60)+"min")},this.setGreenHeader=function(t){h.wnd.$.find(".edit-header-label").html(t)},this.createOneTile=function(t,e,i,a,s,r){var o=n.get("matchmaking-tile");return o.addClass(e),o.find(".matchmaking-tile-bottom-label").addClass(e),i&&(o.find(".matchmaking-tile-header-wrapper").css("display","block"),o.find(".matchmaking-tile-header").html(h.tLang(i))),a&&o.find(".matchmaking-tile-content").html(a),s&&o.find(".matchmaking-tile-bottom-label").html(s),o.click(r),t.append(o),o},this.createRanking=function(){var t=h.wnd.$.find(".matchmaking-ranking");h.newCard(t,h.tLang("general"),(function(){_g("match&a=ladder_global&page=1")})),h.newCard(t,h.tLang("clan"),(function(){if(0==Engine.hero.d.clan){var t=h.wnd.$.find(".clan-ranking-wnd");h.hideBottomBar(t,!0)}_g("match&a=ladder_clan&page=1")})),h.newCard(t,h.tLang("friends"),(function(){_g("match&a=ladder_friends&page=1")})),h.createBottomRankingPanel("ladder_global"),h.createBottomRankingPanel("ladder_clan"),h.createBottomRankingPanel("ladder_friends")},this.createStatisticsDetailed=function(){this.createBottomStatistickDetailed()},this.createBottomStatistickDetailed=function(){var t=n.get("button").addClass("green small"),e=h.wnd.$.find(".stats-and-history");t.find(".label").html(h.tLang("back")),t.click((function(){h.setVisibleStats(e,1),h.setGreenHeader(h.tLang("yourstatistics"))})),h.wnd.$.find(".statistics-detailed-bottom-panel").find(".back-to-main").append(t)},this.setMatchmakingState=function(t){var e=h.wnd.$.find(".queue"),i=e.find(".matchmaking-tile-bottom-label");switch(b=t,t){case 0:e.removeClass("active"),i.html(h.tLang("lookforfight")),"none"!=h.wnd.$.css("display")&&h.showMatchmakingMenu(),$("#matchmaking-timer").parent().parent().parent().remove(),h.detachOverlay(),u=!1,h.showTimerMatychmaking(!1);break;case 1:e.addClass("active"),i.html(h.tLang("breaklookforfight")),"block"==h.wnd.$.find(".wait-for-opponent").css("display")&&h.showMatchmakingMenu(),h.detachOverlay(),h.showTimerMatychmaking(!0);break;case 2:break;case 3:h.wnd.setWndOnPeak(),h.showPanel(!1),h.showMainWnd(".choose-eq"),h.deleteChosenAndDisableClassTile(),h.wnd.$.find(".blink-wait-label").css("display","none"),h.wnd.$.find(".fight-button").removeClass("disable");break;case 4:h.wnd.setWndOnPeak(),h.showPanel(!1),h.showMainWnd(".choose-eq"),h.deleteChosenAndDisableClassTile(),h.wnd.$.find(".blink-wait-label").css("display","block"),h.wnd.$.find(".fight-button").addClass("disable");break;case 5:h.deleteCloneEqItems(),h.showMatchmakingMenu(!1),h.hidePanel()}},this.deleteCloneEqItems=()=>{for(let t in o){let e=o[t].items;for(let i=0;i<e.length;i++){let n=e[i];if(0==n)continue;let a=this.getItemView(t);Engine.items.deleteViewIcon(n,a)}}},this.getItemView=t=>{let e=parseInt(t);switch(e){case 0:return Engine.itemsViewData.CHANGE_EQ_ITEM_NR_0_VIEW;case 1:return Engine.itemsViewData.CHANGE_EQ_ITEM_NR_1_VIEW;case 2:return Engine.itemsViewData.CHANGE_EQ_ITEM_NR_2_VIEW;default:return warningReport("Matchmaking.js","getItemView","EqNr not exist!"+e),Engine.itemsViewData.CHANGE_EQ_ITEM_NR_0_VIEW}return warningReport("Matchmaking.js","getItemView","EqNr is not int!"+e),Engine.itemsViewData.CHANGE_EQ_ITEM_NR_0_VIEW},this.deleteChosenAndDisableClassTile=function(){Engine.matchmaking.wnd.$.find(".choose-eq").find(".matchmaking-tile").removeClass("chosen-tile disabled-tile")},this.isBlockedShowMatchmakingMenu=function(){return!!Engine.trade},this.canToggleMatchmaking=function(){return!("block"==h.wnd.$.find(".wait-for-opponent").css("display")||"block"==h.wnd.$.find(".choose-eq").css("display"))},this.showTimerMatychmaking=function(t){Engine.interface.get$interfaceLayer().find(".matchmaking-timer").css("display",t?"block":"none")},this.setMatchmakingConfirmation=function(t){switch(t.accept){case 0:u||(u=!0,h.createFindPlayerAlert()),$("#matchmaking-timer").html(Math.max(0,t.time_left)+"s");break;case 1:h.wnd.setWndOnPeak(),h.detachOverlay(),h.showPanel(!1),h.showMainWnd(".wait-for-opponent")}},this.createFindPlayerAlert=function(){Engine.soundManager.createNotifSound(6),mAlert(h.tLang("findPlayer"),[{txt:h.tLang("fight"),callback:function(){return _g("match&a=accept_opp&ans=1",(function(){u=!1,$("#matchmaking-timer").parent().parent().parent().remove(),h.showMainWnd(".wait-for-opponent")})),!0}},{txt:h.tLang("refuse"),callback:function(){return _g("match&a=accept_opp&ans=0",(function(){u=!1,$("#matchmaking-timer").parent().parent().parent().remove()})),!0}}]),h.appendOverlay()},this.appendOverlay=function(){var t=parseInt(Engine.matchmaking.wnd.$.css("z-index"));r.css("z-index",t-1),Engine.interface.get$alertsLayer().append(r)},this.detachOverlay=function(){r.detach()},this.setPreparation=function(t){var e=t.time_left;h.wnd.$.find(".eq-stots").removeClass("active"),h.wnd.$.find(".choose-eq").find(".eq-"+t.selected_battle_set).addClass("active"),h.setGreenHeader(h.tLang("choose_your_eq")),o=t.battle_sets,h.setSkillsSets(o),h.setVSPanel(t),Engine.items.fetch(Engine.itemsFetchData.NEW_BATTLE_SET_EQ_ITEM,h.newBatlleSetEqItem),i&&(clearInterval(i),i=null),i=setInterval((function(){h.wnd.$.find(".time").html(e--+"s"),e<0&&(clearInterval(i),i=null)}),1e3),4==b&&h.wnd.$.find(".choose-eq").find(".matchmaking-tile").each((function(){$(this).hasClass("active")?$(this).addClass("chosen-tile"):$(this).addClass("disabled-tile")}))},this.setSkillsSets=function(){for(var t in o){var e=o[t].skill_set,i=n.get("skill-set-matchmaking").addClass("skill-set-"+e);h.wnd.$.find(".choose-eq").find().remove(".skill-set"),h.wnd.$.find(".eq-"+(parseInt(t)+1)).find(".eq-items-set").append(i)}},this.setVSPanel=function(t){var e=h.wnd.$.find(".choose-eq"),i=e.find(".you-info"),n=e.find(".opponent-info"),a=Engine.hero.d;h.setPlayersInfo({$wrapper:i,nick:a.nick,icon:a.img,level:a.lvl,rating:t.rating}),h.setPlayersInfo({$wrapper:n,nick:getAllProfName(t.opponent_prof),icon:t.opponent_prof,level:t.opponent_lvl,rating:t.opponent_rating,opponent:!0})},this.setOpponentCharacterIcon=(t,e)=>{const i=t.find(".avatar-icon");i.removeClassStartingWith("hidden-prof--"),i.addClass("hidden-prof--"+e)},this.setPlayersInfo=function(t){let{$wrapper:e,nick:i,icon:n,level:a,rating:s,opponent:r=!1}=t;var o=CFG.a_opath+n;const l=e.find(".avatar-wrapper");r?(this.setOpponentCharacterIcon(l,n),e.find(".name").text(_t("opponent",null,"matchmaking")),e.find(".level-rating").text(i)):(createImgStyle(l,o),e.find(".name").text(i),e.find(".level-rating").text(a+" lvl PR "+s))},this.createMainWndMatchmaking=function(){var t=h.wnd.$.find(".matchmaking-menu");this.createOneTile(t,"statistick",!1,!1,h.tLang("statistics"),(function(){var t=h.wnd.$.find(".stats-and-history");h.setGreenHeader(h.tLang("progress")),h.showMainWnd(".stats-and-history"),h.setVisibleStats(t,0),_g("match&a=profile")}));var e=this.createOneTile(t,"queue",!1,!1,h.tLang("lookforfight"),(function(){$(this).hasClass("active")?_g("match&a=signout"):_g("match&a=signin")})),i=n.get("completed-matches");i.tip(_t("matches_point_desc")),e.append(i),this.createOneTile(t,"history",!1,!1,h.tLang("ranking"),(function(){var t=h.wnd.$.find(".matchmaking-ranking");h.setGreenHeader(h.tLang("generalranking")),h.showMainWnd(".matchmaking-ranking"),h.setVisibleStats(t,0),_g("match&a=ladder_global&page=1")}));var a=n.get("button").addClass("green small");a.find(".label").html(h.tLang("take_reward")),t.find(".show-reward-season-item").append(a),a.click((function(){h.setGreenHeader(h.tLang("Congratulations")),h.showMainWnd(".season-reward-main"),h.wnd.$.find(".season-reward-main").find(".your-outfits").children().length>0&&h.blockTakeRewardButtonAndClearCheckbox()})),this.createBottomMainWndMatchmaking()},this.createBottomMainWndMatchmaking=function(){var t=n.get("one-checkbox");h.wnd.$.find(".turn-on-off-tutorial").append(t),t.find(".label").html(_t("dont_show",null,"matchmaking-tutorial")),t.click((function(){var t=$(this).find(".checkbox").toggleClass("active").hasClass("active");s.set("MM_Tutorial/status",t)}))},this.createStatsAndHistory=function(){var t=h.wnd.$.find(".stats-and-history");h.newCard(t,h.tLang("progress"),(function(){_g("match&a=profile"),Engine.tpls.deleteMessItemsByLoc("d")})),h.newCard(t,h.tLang("yourstatistics"),(function(){_g("match&a=statistics")})),h.newCard(t,h.tLang("battlehistory"),(function(){_g("match&a=history&page=1")})),h.newCard(t,h.tLang("season"),(function(){_g("match&a=season")})),h.createBottomProgressPanel(),h.createBottomHistoryPanel(),h.createBottomStatsPanel(),h.createBottomSeasonPanel()},this.createBottomSeasonPanel=function(){var t=n.get("button").addClass("green small");t.find(".label").html(h.tLang("back")),t.click((function(){h.showMatchmakingMenu()})),h.wnd.$.find(".season-bottom-panel").find(".back-to-main").append(t)},this.newCard=function(t,e,i){var a=n.get("card");a.find(".label").html(e),t.find(".cards-header").append(a),a.click((function(){var n=$(this).index();t.find(".matchmaking-tutorial-overlay").length>0&&n--,h.setVisibleStats(t,n),h.wnd.$.find(".edit-header-label").html(e),i&&i()}))},this.setVisibleStats=function(t,e){var i=t.find(".card").removeClass("active"),n=t.find(".section").removeClass("active");i.eq(e).addClass("active"),n.eq(e).addClass("active")},this.createChooseEq=function(){var t=h.wnd.$.find(".choose-eq"),e=n.get("eq-items-set"),i=this.createOneTile(t,"eq-stots","eq-1",e,!1,(function(){_g("match&a=battleset&ans=1")})),a=this.createOneTile(t,"eq-stots","eq-2",e.clone(),!1,(function(){_g("match&a=battleset&ans=2")})),s=this.createOneTile(t,"eq-stots","eq-3",e.clone(),!1,(function(){_g("match&a=battleset&ans=3")}));i.addClass("eq-1"),a.addClass("eq-2"),s.addClass("eq-3"),h.createBottomChooseEqPanel()},this.showMainWnd=function(t){var e=h.wnd.$;e.find(".main-wnd").css("display","none");var i="no-exit-button";e.find(t).css("display","block").hasClass("no-exit")?e.addClass(i):e.removeClass(i)},this.newBatlleSetEqItem=function(t){for(var e in o)for(var i=o[e].items,n=0;n<i.length;n++){var a=i[n],s=n+1,r=parseInt(e)+1;if(t.id==a){let i=h.getItemView(e);var l=Engine.items.createViewIcon(t.id,i,"g")[0];l.css({top:"1px",left:"2px"}),h.wnd.$.find(".eq-"+r).find(".st-"+s).append(l)}}},this.initWindow=function(){t=n.get("matchmaking-panel"),Engine.windowManager.add({content:t,title:h.tLang("matchmaking"),nameWindow:Engine.windowsData.name.MATCHMAKING,widget:Engine.widgetsData.name.MATCHMAKING,objParent:this,nameRefInParent:"wnd",onclose:()=>{h.hidePanel()}}),this.wnd.addToAlertLayer()},this.toggle=function(){h.canToggleMatchmaking()&&("none"==h.wnd.$.css("display")?h.showPanel():h.hidePanel())},this.showPanel=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Engine.battle.getShow()||(h.wnd.show(),h.showMatchmakingMenu(t))},this.hidePanel=function(){this.wnd.hide(),Engine.tpls.deleteMessItemsByLoc("d"),Engine.tpls.deleteMessItemsByLoc("r")},this.nanana=function(){h.updateHistory({positions:{1:{result:0,rating_delta:-15,start_ts:1507223840,opponent_lvl:300,opponent_prof:"b"},2:{result:1,rating_delta:-15,start_ts:1507223840,opponent_lvl:300,opponent_prof:"b"},3:{result:2,rating_delta:-15,start_ts:1507223840,opponent_lvl:300,opponent_prof:"b"},4:{result:0,rating_delta:-15,start_ts:1507223840,opponent_lvl:300,opponent_prof:"b"},5:{result:1,rating_delta:-15,start_ts:1509223840,opponent_lvl:300,opponent_prof:"b"},6:{result:2,rating_delta:-15,start_ts:1509223840,opponent_lvl:300,opponent_prof:"b"},7:{result:0,rating_delta:-15,start_ts:1509223840,opponent_lvl:300,opponent_prof:"b"},8:{result:1,rating_delta:-15,start_ts:1510223840,opponent_lvl:300,opponent_prof:"b"},9:{result:2,rating_delta:-15,start_ts:1510223840,opponent_lvl:300,opponent_prof:"b"},10:{result:1,rating_delta:-15,start_ts:1510223840,opponent_lvl:300,opponent_prof:"b"}}})},this.createBottomRankingPanel=function(t){const e=n.get("button").addClass("green small");e.find(".label").html(_t("refresh",null,"buttons")),e.click((function(){Math.max(1,_.current-1);_g("match&a="+t+"&page=1")}));var i=n.get("button").addClass("green small");i.find(".label").html(h.tLang("back")),i.click((function(){h.showMatchmakingMenu()}));var a=n.get("button").addClass("green small");a.find(".label").html(h.tLang("previouspage")),a.click((function(){var e=Math.max(1,_.current-1);_g("match&a="+t+"&page="+e)}));var s=n.get("button").addClass("green small");s.find(".label").html(h.tLang("nextpage")),s.click((function(){var e=Math.min(_.current+1,_.max);_g("match&a="+t+"&page="+e)}));const r=h.wnd.$.find("."+t+"-bottom-panel");r.find(".refresh").append(e),r.find(".back-to-main").append(i),r.find(".prev-page").append(a),r.find(".next-page").append(s);let o=r.find(".page-number");o.keypress((function(e){if(13==e.which){var i=$(this).val();i=i<1?1:Math.min(i,_.max),_g("match&a="+t+"&page="+i)}})),setOnlyPositiveNumberInInput(o)},this.createBottomProgressPanel=function(){var t=n.get("button").addClass("green small");t.find(".label").html(h.tLang("back")),t.click((function(){h.showMatchmakingMenu()})),h.wnd.$.find(".progress-bottom-panel").find(".back-to-main").append(t)},this.createBottomHistoryPanel=function(){var t=n.get("button").addClass("green small");t.find(".label").html(h.tLang("back")),t.click((function(){h.showMatchmakingMenu()}));var e=n.get("button").addClass("green small");e.find(".label").html(h.tLang("previouspage")),e.click((function(){var t=Math.max(1,E.current-1);_g("match&a=history&page="+t)}));var i=n.get("button").addClass("green small");i.find(".label").html(h.tLang("nextpage")),i.click((function(){var t=Math.min(E.current+1,E.max);_g("match&a=history&page="+t)}));var a=h.wnd.$.find(".history-bottom-panel");a.find(".back-to-main").append(t),a.find(".prev-page").append(e),a.find(".next-page").append(i);let s=a.find(".page-number");s.keypress((function(t){if(13==t.which){var e=$(this).val();e=e<1?1:Math.min(e,E.max),_g("match&a=history&page="+e)}})),setOnlyPositiveNumberInInput(s)},this.createBottomStatsPanel=function(){var t=n.get("button").addClass("green small");t.find(".label").html(h.tLang("back")),t.click((function(){h.showMatchmakingMenu()})),h.wnd.$.find(".stats-bottom-panel").find(".back-to-main").append(t)},this.createBottomChooseEqPanel=function(){var t=n.get("button").addClass("green small");t.find(".label").html(h.tLang("fight2")),t.click((function(){_g("match&a=prepared")})),h.wnd.$.find(".choose-eq-bottom-panel").find(".fight-button").append(t)},this.showMatchmakingMenu=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(m||Engine.matchmakingTutorial.setTutorialById(0),t&&_g("match&a=main"),h.isBlockedShowMatchmakingMenu())return h.hidePanel(),!1;h.setGreenHeader(p),h.showMainWnd(".matchmaking-menu"),h.wnd.setWndOnPeak()},this.warningPoints=function(t,e){h.wnd.$.find(".warning-points").find(".text").html(_t("warning_points")+": "+t+"/"+e)},this.matchesPoints=function(t,e){var i=t>=e?e:t;h.wnd.$.find(".completed-matches").find(".text").html(i+"/"+e),h.wnd.$.find(".completed-matches").css("display",0==e?"none":"block")},this.updatehistoryPageInfo=function(t,e){E.current=t,E.max=e,h.wnd.$.find(".history-bottom-panel").find(".page-number").val(t),h.wnd.$.find(".history-bottom-panel").find(".page-info").html(h.tLang("page")+" "+t+"/"+e)},this.updateHistory=function(t){var e,i;Engine.matchmakingTutorial.setTutorialById(3);var n=0;this.updatehistoryPageInfo(t.cur_page,t.max_page);var a=h.wnd.$.find(".history-table").empty();for(var s in h.createHeaderOfHistoryTable(a),t.positions){var r,o=t.positions[s],l=o.start_ts;e||(e=h.getDateStr(l));var c=h.getDateStr(l);c==e?n++:(i.attr("rowspan",n),e=c,n=1),1==n?i=(r=h.createHistoryRecord(o,l,c)).children().last():r=h.createHistoryRecord(o,l),a.append(r)}lengthObject(t.positions)>0&&i.attr("rowspan",n)},this.createHistoryRecord=function(t,e,i){var n=h.getResult(t.result),a=getAllProfName(t.opponent_prof)+" "+t.opponent_lvl+" lvl",s=t.rating_delta,r=t.end_ts-e,o=h.getHourStr(e);return i?h.createRecords([n,a,s,r+" s",o,i],["normal-td left","normal-td right","normal-td center","normal-td center","normal-td center","center date"]):h.createRecords([n,a,s,r+" s",o],["normal-td left","normal-td right","normal-td center","normal-td center","normal-td center"])},this.createHeaderOfHistoryTable=function(t){t.append(h.createRecords([h.tLang("result"),h.tLang("prof-and-lvl"),h.cellWithSmallInfo("PR",h.tLang("rank-points")),h.tLang("battleTime"),h.tLang("time"),h.tLang("date")],["header-td italic big-height-td result","header-td italic big-height-td prof-and-lvl","header-td italic big-height-td rank-points","header-td italic big-height-td battle-time","header-td italic big-height-td time","header-td italic big-height-td date"]))},this.getResult=function(t){var e,i;switch(t){case 1:e="Lose",i="lose";break;case 0:e="Win",i="win";break;case 2:e="Draw",i="draw"}return n.get("fight-result").html(h.tLang(e)).addClass("result-"+i)},this.getHourStr=function(t){var e=ut_fulltime(t.toString());return e.substr(e.indexOf(" ")+1,e.length)},this.getDateStr=function(t){var e=ut_fulltime(t.toString());return e.substr(0,e.indexOf(" "))},this.updateProgressPanel=function(t){Engine.matchmakingTutorial.setTutorialById(1),this.createRewardItems(t);var e=h.wnd.$.find(".progress-wnd"),i=CFG.a_opath+Engine.hero.d.img;for(var n in e.find(".char-info").text(`${Engine.hero.d.nick} (${Engine.hero.d.lvl}${Engine.hero.d.prof})`),createImgStyle(e.find(".outfit-wrapper"),i),e.find(".right-side").empty(),t.daily_stages){var a=t.daily_stages[n];h.setMachmakingProgressStage(a.id,a.points_cur,a.points_max,a.rewards_max,a.rewards_cur,a.rewards_last)}},this.updateSeasonPanel=function(t){Engine.matchmakingTutorial.setTutorialById(4),h.updateRewardsInfo(t),h.createSeasonReward(t)},this.updateRewardsInfo=function(t){const e=h.wnd.$.find(".season-wnd"),i=t.outfit_one&&t.outfit_two?"txt-info-outfits":"txt-info";e.find(".played-battle").html(h.tLang("played-battle")+"?/?"),e.find(".header-info").html(h.tLang("season-header-info")),e.find(".txt-info").html(h.tLang(i)),e.find(".players-in-ranking-info").html(h.tLang("players-in-ranking-info")+"<span>"+t.players_cur+"/"+t.players_max+"</span>"),e.find(".amount-players-got-outfit-info").html(h.tLang("amount-players-got-outfit-info")+"<span>"+t.outfits_cur_count+"</span>"),e.find(".wrapper-outfit-info").empty(),e.find(".wrapper-outfit-info").append(h.getOutfit(t.outfit_one)),e.find(".wrapper-outfit-info").append(h.getOutfit(t.outfit_two)),t.outfit_one&&t.outfit_two||e.find(".outfits-wrapper").css("display","none"),e.find(".your-season-record").html(h.tLang("your-season-record")+": "+t.rating_best_season+" PR"),e.find(".your-career-record").html(h.tLang("your-career-record")+": "+t.rating_best_career+" PR")},this.getOutfit=function(t){return n.get("season-outfit").css("background-image","url("+CFG.a_opath+t+")")},this.createSeasonReward=function(t){if(g)return;g=!0,h.wnd.$.find(".reward-wrapper").find(".scroll-pane").find(".rage-wrapper").remove();const{rewards:e}=t,i=Object.keys(e).sort((t,e)=>(parseInt(t.split("-")[0])||parseInt(t))-(parseInt(e.split("-")[0])||parseInt(e)));for(const t of i){for(var a=n.get("rage-wrapper").addClass("rage-wrapper"),s=n.get("place-matchmaking").html("#"+t).addClass("place-"+t),r=0;r<e[t].length;r++){var o=e[t][r],l=n.get("item-wrapper-matchmaking").addClass("tpl-"+o[0]);l.attr("data-amount",o[1]),a.append(l)}a.prepend(s),h.wnd.$.find(".season-wnd").find(".reward-wrapper").find(".scroll-pane").append(a)}h.setSeasonScroll(t.rewards.length)},this.setSeasonScroll=function(t){var e=h.wnd.$.find(".season-wnd");e.find("active").removeClass("active"),t<=6||(e.find(".reward-header").addClass("active"),e.find(".winners-header").addClass("active"),e.find(".winners-wrapper").addClass("active"),e.find(".middle-wood").addClass("active"),$(".scroll-wrapper",h.wnd.$).trigger("update"))},this.createRewardItems=function(t){h.createHugeRewardTpl(t.huge_reward_tpl),h.createBigRewardTpl(t.big_reward_tpl),h.createSmallRewardTpl(t.small_reward_tpl)},this.getRomeVal=function(t){switch(t){case 0:return"I";case 1:return"II";case 2:return"III";case 3:return"IV";case 4:return"V";case 5:return"VI"}},this.setMachmakingProgressStage=function(t,e,i,a,s,r){var o=h.wnd.$.find(".progress-wnd"),l=n.get("matchmaking-progress-stage"),c=[!0];o.find(".right-side").append(l);var d=252/a,u=e/i*252,p=l.find(".items-wrapper");l.find(".background-bar").css("width",u),l.find(".stage").html(h.tLang("stage")+" "+h.getRomeVal(t)),l.find(".ratio").html(e+"/"+i);for(var g=1;g<a+1;g++){var f=n.get("item-chest-slot-matchmaking"),m=g*d,v=f.find(".item-chest-border");if(h.appendPriceItemToSlot(c,v,f,g,s,r,a,e,t),f.css("left",m),p.append(f),g!=a){var E=n.get("measure-matchmaking");E.css("left",m),p.append(E)}}},this.appendPriceItemToSlot=function(t,e,i,n,a,s,r,o,u){var p="",g=!1,f=!1,m="unavailable-level",v=d;s>=n&&(p+="disabled",m="disabled "+m,f=!0),0==o&&0==a&&0==s&&(p+="disabled",m="disabled "+m,f=!0),!f&&n<=a?(p+=" available-level",g=!0):p+=" unavailable-level",n==r&&(p+="-last",m+="-last",v=c),5===n&&3===u&&(v=l),0==h.wnd.$.find(".first").length&&g&&!f&&(p+=" first",i.attr("reward_stage",u),i.attr("reward_idx",n-1)),e.addClass(p),i.addClass(m),i.addClass("progress-tpl-slot-id-"+v)},this.getChestItemCl=function(t,e,i,n,a){return n>a?e==i?"unavailable-level-last":"unavailable-level":e==i?"available-level-last":"available-level"},this.updateRanking=function(t,e,i){var n=h.wnd.$.find(e),a=n.find(".ranking-table").empty();t.cur_page;switch(i){case"friends":Engine.matchmakingTutorial.setTutorialById(7);var s=1==t.cur_page&&0==lengthObject(t.positions),r=h.wnd.$.find(".friends-ranking-wnd");h.hideBottomBar(r,s);break;case"clan":Engine.matchmakingTutorial.setTutorialById(6);var o=1==t.cur_page&&0==lengthObject(t.positions),l=h.wnd.$.find(".clan-ranking-wnd");h.hideBottomBar(l,o);break;case"global":Engine.matchmakingTutorial.setTutorialById(5)}for(var c in this.updateRankingPageInfo(t.cur_page,t.max_page,n),t.positions){var d=t.positions[c];0;var u=h.createRecords([d.position+".",d.nick+` (${d.lvl}${d.prof})`,d.rating,d.wins_ratio+"%",d.wins+"/"+d.losses+"/"+d.draws],["normal-td left","normal-td left","normal-td right","normal-td center","normal-td center","normal-td center"]),p=CFG.a_opath+d.ikona;const e=$('<div class="avatar-icon" />');createImgStyle(e,p),u.addClass("hover-tr"),u.tip(e,"t_outfit"),a.append(u)}h.createHeaderOfRankingTable(a)},this.hideBottomBar=function(t,e){t.find(".text-info").css("display",e?"block":"none"),t.find(".page-info, .prev-page, .input-wrapper, .next-page").css("display",e?"none":"block")},this.updateRankingPageInfo=function(t,e,i){_.current=t,_.max=e,i.find(".page-number").val(t),i.find(".page-info").html(h.tLang("page")+" "+t+"/"+e)},this.createHeaderOfRankingTable=function(t){t.prepend(h.createRecords([h.tLang("lp"),h.tLang("playernick"),h.cellWithSmallInfo("PR",h.tLang("rank-points")),h.cellWithSmallInfo("PW",h.tLang("winsratio")),h.cellWithSmallInfo(h.tLang("WPR"),h.tLang("wpr_tip"))],["header-td italic big-height-td lp","header-td italic big-height-td player-nick","header-td italic big-height-td","header-td italic big-height-td","header-td italic big-height-td"]))},this.updateStatistics=function(t){Engine.matchmakingTutorial.setTutorialById(2);var e=h.wnd.$.find(".stats-table").empty(),i=0,n=0,a=0,s=0,r=0;for(var o in t){var l,c=t[o],d=h.createAvatarNameLevelAndProfCell(c,o);if(i+=c.wins_ratio,n+=c.wins,a+=c.losses,s+=c.draws,0!=c.status)r++,l=h.createRecords([d,c.ladder_pos,c.rating,c.wins_ratio+"%",c.wins+"/"+c.losses+"/"+c.draws],["normal-td","normal-td ladder-pos center","normal-td rating center","normal-td wins-ratio center","normal-td w-p-r center"]);else{var u=_t("in_classification %val%",{"%val%":c.placement_cur+"/"+c.placement_max},"matchmaking");(l=h.createRecords([d,u],["normal-td","normal-td center"])).children().last().attr("colspan",4)}e.append(l),l.addClass("hover-tr"),h.detailsClick(c.playerId,l)}0!=r&&(i=Math.round(i/r)),h.createHeaderOfStatsTable(e,i,n,a,s)},this.detailsClick=function(t,e){e.click((function(){_g("match&a=statistics_detailed&player_id="+t)}))},this.createAvatarNameLevelAndProfCell=function(t,e){var i=n.get("first-cell-matchmaking"),a=i.find(".img-wrapper"),s=CFG.a_opath+t.icon;return createImgStyle(a,s,{height:"22px"},{"background-size":"400% 800%"}),i.find(".info").html("<b>"+e+"</b> <i>("+t.lvl+t.prof+")</i>"),i},this.createHeaderOfStatsTable=function(t,e,i,n,a){var s=isPl(),r=e.toString(),o=i.toString(),l=n.toString(),c=a.toString(),d=s?"M":"P",u=s?"PR":"RP",p=(s?"PW":"")+"<br>"+r+"%",g=h.tLang("WPR")+"<br>"+o+"/"+l+"/"+c;t.prepend(h.createRecords([h.tLang("chardata"),h.cellWithSmallInfo(d,h.tLang("ranking_place")),h.cellWithSmallInfo(u,h.tLang("rank-points")),h.cellWithSmallInfo(p,h.tLang("winsratio")),h.cellWithSmallInfo(g,h.tLang("wpr_tip"))],["header-td big-height-td italic char-data","header-td big-height-td italic place-data","header-td big-height-td italic pr-data","header-td big-height-td italic pw-data","header-td big-height-td italic wpr-data"]))},this.cellWithSmallInfo=function(t,e){var i=n.get("info-icon").addClass("small-info"),a=$("<div>").addClass("label");return i.tip(e),a.html(t),a.append(i)},this.updateStatisticsDetailed=function(t){var e=h.wnd.$.find(".statistics-detailed-table").empty(),i=0,n=0,a=0,s=h.wnd.$.find(".stats-and-history");for(var r in t)if("all"!=r){var o=t[r];o.wins_ratio,i+=o.wins,n+=o.losses,a+=o.draws,e.append(h.createRecords([getAllProfName(r),o.rating,o.wins_ratio+"%",o.wins+"/"+o.losses+"/"+o.draws],["big-td center","big-td center","big-td center","big-td center"]))}h.createHeaderOfStatisticsDetailed(e,t.all.wins_ratio,i,n,a),h.setVisibleStats(s,4),h.setGreenHeader(h.tLang("additionalstatistics")),h.wnd.$.find(".stats-and-history").find(".card").eq(1).addClass("active")},this.createHeaderOfStatisticsDetailed=function(t,e,i,n,a){var s=isPl(),r=e.toString(),o=i.toString(),l=n.toString(),c=a.toString(),d=s?"PR":"",u=(s?"PW":"")+"<br>"+r+"%",p=h.tLang("WPR")+"<br>"+o+"/"+l+"/"+c;t.prepend(h.createRecords([h.tLang("classopponents"),h.cellWithSmallInfo(d,h.tLang("rank-points")),h.cellWithSmallInfo(u,h.tLang("winsratio")),h.cellWithSmallInfo(p,h.tLang("wpr_tip"))],["header-td big-height-td italic prof-data-detail","header-td big-height-td italic pr-detail","header-td big-height-td italic pw-detail","header-td big-height-td italic wpr-detail"]))},this.matchmakingSeasonPosition=function(t){if(0!=t.ladder_position&&0!=t.rewards.length&&(m=!0,h.showPanel(),h.wnd.$.find(".show-reward-season-item").css("display","block"),h.setGreenHeader(h.tLang("Congratulations")),h.showMainWnd(".season-reward-main"),!f)){for(var e in f=!0,h.wnd.$.find(".season-reward-main").find(".your-place").html(_t("your_place %place%",{"%place%":"#"+t.ladder_position},"matchmaking")),h.createGetRewardButton(),t.rewards){var i=t.rewards[e],a=n.get("item-wrapper-matchmaking").addClass("tpl-"+i[0]);a.attr("data-amount",i[1]),h.wnd.$.find(".season-reward-main").find(".your-reward").append(a)}isset(t.outfit_one)&&(h.wnd.$.find(".season-reward-main").find(".your-outfits").append(h.outfitWrapperWithCheckbox(t.outfit_one,"woman")),h.wnd.$.find(".season-reward-main").find(".your-outfits").append(h.outfitWrapperWithCheckbox(t.outfit_two,"man")),h.blockTakeRewardButtonAndClearCheckbox())}},this.blockTakeRewardButtonAndClearCheckbox=function(){v=null,h.wnd.$.find(".season-reward-main").find(".active").removeClass("active"),h.wnd.$.find(".season-reward-main").find(".take-reward-now").find(".button").addClass("black")},this.createGetRewardButton=function(){var t=h.wnd.$.find(".season-reward-main").find(".take-reward-now"),e=n.get("button").addClass("small green");e.find(".label").html(_t("take_rewards_now")),t.append(e),e.click((function(){if(!$(this).hasClass("black")){var t="match&a=season&reward_season=1";_g(t+=v?"&outfit_idx="+v:"",(function(t){isset(t.item)&&(h.wnd.$.find(".show-reward-season-item").css("display","none"),h.showMatchmakingMenu(),m=!1)}))}}))},this.outfitWrapperWithCheckbox=function(t,e){var i=$("<div>").addClass("outfit-check-wrapper "+e),a=$("<div>").addClass("outfit-wrapper"),s=n.get("one-checkbox"),r=$("<div>").html(_t(e)).addClass("label");return i.append(s),i.append(a),s.click((function(){h.wnd.$.find(".season-reward-main").find(".black").removeClass("black"),v=h.getOutfitIndex(e),$(this).hasClass("active")||($(this).parent().parent().find(".active").removeClass("active"),$(this).parent().find(".outfit-wrapper").addClass("active"),$(this).parent().find(".checkbox").addClass("active"))})),a.click((function(){h.wnd.$.find(".season-reward-main").find(".black").removeClass("black"),v=h.getOutfitIndex(e),$(this).hasClass("active")||($(this).parent().parent().find(".active").removeClass("active"),$(this).parent().find(".outfit-wrapper").addClass("active"),$(this).parent().find(".checkbox").addClass("active"))})),a.append(h.getOutfit(t)),a.append(r),i},this.outfitWrapperWithCheckbox2=function(t,e){n.get("outfit-check-wrapper");var i=n.get("outfit-check-wrapper").addClass(e),a=i.find(".outfit-wrapper");return i.find(".text-label").html(_t(e)),i.find(".one-checkbox").click((function(){h.wnd.$.find(".season-reward-main").find(".black").removeClass("black"),v=h.getOutfitIndex(e),$(this).hasClass("active")||($(this).parent().parent().find(".active").removeClass("active"),$(this).parent().find(".outfit-wrapper").addClass("active"),$(this).parent().find(".checkbox").addClass("active"))})),a.click((function(){h.wnd.$.find(".season-reward-main").find(".black").removeClass("black"),v=h.getOutfitIndex(e),$(this).hasClass("active")||($(this).parent().parent().find(".active").removeClass("active"),$(this).parent().find(".outfit-wrapper").addClass("active"),$(this).parent().find(".checkbox").addClass("active"))})),a.append(h.getOutfit(t)),i},this.getOutfitIndex=function(t){switch(t){case"woman":return 1;case"man":return 2}},this.createRecords=function(t,e){for(var i=$("<tr>"),n=0;n<t.length;n++){var a=$("<td>").html(t[n]);"object"==typeof e?a.addClass(e[n]):a.addClass(e),i.append(a)}return i},this.tLang=function(t){return _t(t,null,"matchmaking")}}},function(t,e,i){var n=i(0);t.exports=function(){var t,e,i,a,s=this;this.init=function(){this.initWindow(),this.initNextFightButton(),this.initCloseButton(),this.setShow(!1),this.initFetch()},this.initFetch=function(){Engine.tpls.fetch(Engine.itemsFetchData.NEW_BATTLE_SUMMARY_TPL,s.newBattleSummaryItem)},this.initWindow=function(){t=n.get("matchmaking-summary"),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.MATCHMAKING_SUMMARY,nameRefInParent:"wnd",objParent:this,title:_t("battle_summary",null,"battle"),onclose:()=>{s.setShow(!1)}}),this.wnd.addToAlertLayer()},this.newBattleSummaryItem=function(t){s.wnd.$.find(".progress-tpl-slot-id-"+t.id).each((function(){let e=Engine.tpls.createViewIcon(t.id,Engine.itemsViewData.MM_BATTLE_SUMMARY_VIEW,"d")[0];$(this).append(e),e.click((function(){var t=s.canTakeItem2($(this).parent());t&&t.f()})),e.contextmenu((function(e,i){var n=s.canTakeItem2($(this).parent());t.createOptionMenu(getE(e,i),n)}))}))},this.canTakeItem2=function(t){var e=t.attr("reward_stage");if(null!=e){var i=t.attr("reward_idx");return{txt:s.tLang("take_reward"),f:function(){_g("match&a=summary&reward_stage="+e+"&reward_idx="+i)}}}return!1},this.initCloseButton=function(){var t=n.get("button").addClass("green small");s.wnd.$.find(".close-wrapper").append(t),t.find(".label").html(_t("close")),t.click((function(){s.setShow(!1)}))},this.initNextFightButton=function(){var t=n.get("button").addClass("green small");s.wnd.$.find(".close-wrapper").append(t),t.find(".label").html(_t("next_fight")),t.click((function(){s.setShow(!1),_g("fight&a=nextmatch")}))},this.setShow=function(t){s.wnd.$.css("display",t?"block":"none")},this.updateSummary=function(t){this.createRewardItems(t);var e={result:s.getResult(t.result),name:Engine.hero.d.nick,lvl:Engine.hero.d.lvl,prof:Engine.hero.d.prof,pr:t.rating,icon:Engine.hero.d.img},i={result:s.getResult(t.result,!0),name:s.tLang("opponent"),lvl:t.opponent_lvl,prof:t.opponent_prof,pr:t.opponent_rating,icon:t.opponent_icon};s.updateGreenHeader(e.result),s.updateOutfit("your",e),s.updateOutfit("enemy",i),s.updateStars(t.difficulty_rank),s.updateClassificationMatch(t.placement_cur,t.placement_max),s.setArrow(e.result),s.setChangePr(e.result,t.rating_delta),s.setProgressPoints(t.points_gained);var n=t.daily_stage;s.setMachmakingProgressStage(n.id,n.points_cur,n.points_max,n.rewards_max,n.rewards_cur,n.rewards_last)},this.updateStars=function(t){s.wnd.$.find(".difficult-stars-val").find(".text").html(_t("fight_dificult"));var e=s.wnd.$.find(".difficult-stars-val").find(".stars-wrapper");e.empty();for(var i=1;i<11;i+=2){var a=n.get("star-matchmaking");i<t+1?i==t&&i%2&&a.addClass("half-star"):a.addClass("empty-star"),e.append(a)}},this.updateClassificationMatch=function(t,e){t>=e?s.wnd.$.find(".classification-match").css("display","none"):s.wnd.$.find(".classification-match-val").html(_t("classification_match")+" "+t+"/"+e)},this.getResult=function(t,e){var i;switch(t){case 1:i=e?"win":"lose";break;case 0:i=e?"lose":"win";break;case 2:i="draw"}return i},this.createHugeRewardTpl=function(t){isset(e)||(e=t)},this.createBigRewardTpl=function(t){isset(i)||(i=t)},this.createSmallRewardTpl=function(t){isset(a)||(a=t)},this.createRewardItems=function(t){s.createHugeRewardTpl(t.huge_reward_tpl),s.createBigRewardTpl(t.big_reward_tpl),s.createSmallRewardTpl(t.small_reward_tpl)},this.getRomeVal=function(t){switch(t){case 0:return"I";case 1:return"II";case 2:return"III";case 3:return"IV";case 4:return"V";case 5:return"VI"}},this.setMachmakingProgressStage=function(t,e,i,a,r,o){var l=n.get("matchmaking-progress-stage"),c=[!0];s.wnd.$.find(".current-stage").empty().append(l),s.setTokenAmounts();var d=252/a,h=e/i*252,u=l.find(".items-wrapper");l.find(".background-bar").css("width",h),l.find(".stage").html(s.tLang("stage")+" "+s.getRomeVal(t)),l.find(".ratio").html(e+"/"+i);for(var p=1;p<a+1;p++){var g=n.get("item-chest-slot-matchmaking"),f=p*d,m=g.find(".item-chest-border");if(s.appendPriceItemToSlot(c,m,g,p,r,o,a,e,t),g.css("left",f),u.append(g),p!=a){var v=n.get("measure-matchmaking");v.css("left",f),u.append(v)}}},this.appendPriceItemToSlot=function(t,n,r,o,l,c,d,h,u){var p="",g=!1,f=!1,m="unavailable-level",v=a;c>=o&&(p+="disabled",m="disabled "+m,f=!0),0==h&&0==l&&0==c&&(p+="disabled",m="disabled "+m,f=!0),!f&&o<=l?(p+=" available-level",g=!0):p+=" unavailable-level",o==d&&(p+="-last",m+="-last",v=i),5===o&&3===u&&(v=e),0==s.wnd.$.find(".first").length&&g&&!f&&(p+=" first",r.attr("reward_stage",u),r.attr("reward_idx",o-1)),n.addClass(p),r.addClass(m),r.addClass("progress-tpl-slot-id-"+v)},this.setProgressPoints=function(t){s.wnd.$.find(".progress-points-val").html(_t("got_points",{"%val%":t},"matchmaking"))},this.setTokenAmounts=function(){},this.setChangePr=function(t,e){s.wnd.$.find(".pr-change").html(e+" PR").removeClass("win lose").addClass(t)},this.setArrow=function(t){s.wnd.$.find(".arrow").removeClass("win lose").addClass(t)},this.updateGreenHeader=function(t){},this.updateOutfit=function(t,e){var i=s.wnd.$.find("."+t+"-side"),n=CFG.a_opath+e.icon;i.find("."+t+"-result").html(_t(e.result+"_p",null,"matchmaking")).removeClass("win lose").addClass(e.result),i.find("."+t+"-name-and-level").html(e.name+" ("+e.lvl+e.prof+")"),i.find("."+t+"-pr").html(e.pr+" PR").removeClass("win lose").addClass(e.result);const a=s.wnd.$.find("."+t+"-outfit-wrapper").find(".out-icon");createImgStyle(a,n)},this.tLang=function(t){return _t(t,null,"matchmaking")}}},function(t,e,i){var n=i(0),a=i(5);t.exports=function(){var t,e=this;this.init=function(){this.initData(),this.initTutorialStateInMMWnd()},this.initData=function(){t={id0:[{p:0,t:".matchmaking-tile.statistick",h:e.tLang("progress-h"),txt:e.tLang("tid0txt0")},{p:1,t:".matchmaking-tile.queue",h:e.tLang("look-for-battle"),txt:e.tLang("tid0txt1")},{p:2,t:".matchmaking-tile.history",h:e.tLang("ranking"),txt:e.tLang("tid0txt2")}],id1:[{p:0,t:".stats-and-history .cards-header .card:first",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt0")},{p:2,t:".details-btn",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt2")},{p:2,t:".outfit-wrapper",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt3")},{p:2,t:".go-to-shop-btn",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt4")},{p:2,t:".progress-bar:first",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt5")},{p:2,t:".item-chest-slot:first",h:e.tLang("progress-wnd-h"),txt:e.tLang("tid1txt6")}],id2:[{p:0,t:".stats-and-history .cards-header .card:nth-of-type(2)",h:e.tLang("your-stats-h"),txt:e.tLang("tid2txt0")},{p:2,t:".stats-wnd .stats-table",h:e.tLang("your-stats-h"),txt:e.tLang("tid2txt1")},{p:1,t:".stats-wnd .stats-table",h:e.tLang("your-stats-h"),txt:e.tLang("tid2txt2")},{p:0,t:".stats-wnd .stats-table",h:e.tLang("your-stats-h"),txt:e.tLang("tid2txt3")}],id3:[{p:2,t:".stats-and-history .cards-header .card:nth-of-type(3)",h:e.tLang("battle-history-h"),txt:e.tLang("tid3txt0")}],id4:[{p:2,t:".stats-and-history .cards-header .card:nth-of-type(4)",h:e.tLang("season-h"),txt:e.tLang("tid4txt0")},{p:2,t:".reward-wrapper",h:e.tLang("season-h"),txt:e.tLang("tid4txt1")},{p:2,t:".reward-wrapper",h:e.tLang("season-h"),txt:e.tLang("tid1txt1")},{p:2,t:".winners-wrapper",h:e.tLang("season-h"),txt:e.tLang("tid4txt2")},{p:2,t:".your-season-record",h:e.tLang("season-h"),txt:e.tLang("tid4txt3")},{p:2,t:".your-career-record",h:e.tLang("season-h"),txt:e.tLang("tid4txt4")}],id5:[{p:2,t:".matchmaking-ranking .cards-header-wrapper .cards-header .card:first",h:e.tLang("general-ranking-h"),txt:e.tLang("tid5txt0")}],id6:[{p:2,t:".matchmaking-ranking .cards-header-wrapper .cards-header .card:nth(1)",h:e.tLang("clan-ranking-h"),txt:e.tLang("tid6txt0")}],id7:[{p:2,t:".matchmaking-ranking .cards-header-wrapper .cards-header .card:nth(2)",h:e.tLang("friends-ranking-h"),txt:e.tLang("tid7txt0")}]}},this.initTutorialStateInMMWnd=function(){this.getTutorialState(),this.getTutorialState()&&Engine.matchmaking.wnd.$.find(".checkbox").addClass("active")},this.getLastStep=function(t){var e=a.get("MM_Tutorial/"+t);return null==e?(a.set("MM_Tutorial/"+t,-1),-1):e},this.clearTutorial=function(){a.remove("MM_Tutorial")},this.setCloudWatchInStorage=function(e,i){t["id"+e].length<=i+1?a.set("MM_Tutorial/"+e,"watched"):a.set("MM_Tutorial/"+e,i)},this.createOverlayAndMarkObj=function(t){var e=n.get("matchmaking-tutorial-overlay");t.addClass("tutorial-element-on-top");var i=t.css("position");"abosolute"!=i&&"relative"!=i&&t.addClass("add-relative"),e.insertBefore(t)},this.removeOverlayAndMark=function(){Engine.matchmaking.wnd.$.find(".matchmaking-tutorial-overlay").remove(),Engine.matchmaking.wnd.$.find(".tutorial-element-on-top").removeClass("tutorial-element-on-top add-relative"),Engine.matchmaking.wnd.$.find(".tutorial-element-on-top").removeClass("tutorial-element-on-top")},this.createCloudTip=function(i,a,s){var r=n.get("cloud-tip"),o=t["id"+i][a];$("body").append(r),r.attr("id","cloud-tip"),r.find(".header").html(o.h),r.find(".content").html(o.txt),r.find(".cloud-tail").addClass("pos-"+o.p),r.find(".close").click((function(){e.removeCloundAndOverlay()})),r.find(".next").click((function(){s.unbind("click",e.clickMarkElement),e.removeCloundAndOverlay(),e.setTutorialByIdQuick(i)})),s.bind("click",e.clickMarkElement),e.setCloudWatchInStorage(i,a)},this.clickMarkElement=function(){$(this).unbind("click",e.clickMarkElement),e.removeCloundAndOverlay()},this.nextStep=function(i,n){isset(t["id"+i][n])&&e.setTutorialByIdQuick(i)},this.setTutorialById=function(t){setTimeout((function(){e.setTutorialByIdQuick(t)}),50)},this.checkCloudExist=function(){return $("#cloud-tip").length>0},this.setTutorialByIdQuick=function(i){if(e.getTutorialState()&&!e.checkCloudExist()){var n=e.getLastStep(i);if("watched"!=n){n++;var a=Engine.matchmaking.wnd.$.find(t["id"+i][n].t);e.createOverlayAndMarkObj(a),e.createCloudTip(i,n,a),e.setCloudPosition(i,n,a),Engine.matchmaking.wnd.setWndOnPeak()}}},this.getTutorialState=function(){var t=a.get("MM_Tutorial/status");return null===t?(a.set("MM_Tutorial/status",!1),!1):t},this.setCloudPosition=function(e,i,n){var a,s,r=n.offset().left,o=n.offset().top,l=$("#cloud-tip");switch(t["id"+e][i].p){case 0:a=r+n.width()/2,s=o+n.height()+20;break;case 1:a=r+n.width()/2,s=o-l.height()-30;break;case 2:a=r+n.width()/2-l.width(),s=o-l.height()-30}l.css({left:a,top:s})},this.removeCloud=function(){$("#cloud-tip").remove()},this.removeCloundAndOverlay=function(){this.removeCloud(),this.removeOverlayAndMark()},this.tLang=function(t){return _t(t,null,"matchmaking-tutorial")}}},function(t,e,i){let n=i(429),a=i(430),s=i(431),r=i(54);t.exports=function(){let t,e,i,o,l,c,d,h;const u=t=>{let e={};for(let i in t){e[t[i].questId]=!0}return e},p=e=>{t=e},g=t=>{c=t},f=t=>{let e=w(t);S(),e&&(g(t),y(C()),m(),v(),b(),getEngine().quests.addHighlightsInQuestItems())},m=()=>{const t=r.TYPE;let e=[t.COLLECT,t.KILL];for(let t of d)e.includes(t.kind)&&(l[t.name2]=!0)},v=()=>{if(!lengthObject(l))return;let t=getEngine().npcs.check();for(let e in t){let i=t[e];E(i)}},E=t=>{t.getNick;let e=t.getNick(),i=t.getId();l[e]&&(o[e]||(o[e]={}),o[e][i]=t)},_=t=>{let e=t.getNick(),i=t.getId();l[e]&&(o[e]?o[e][i]&&(delete o[e][i],lengthObject(o[e])||delete o[e]):errorReport("asd","!!!!!!!!!!","!!!!!!"))},b=()=>{for(let t of d){let e=new s;e.init(),e.updateData(t),h.push(e)}},w=e=>{if(!t)return!1;for(let i in t){if(t[i].questId==e)return!0}return!1},C=()=>{let e=[];if(!t)return e;for(let i of t)i.questId==c&&e.push(i);return e},T=()=>null!=c,y=t=>{d=t},I=()=>{o={}},A=()=>{l=[]},k=()=>{S()},S=()=>{(()=>{if(h){for(let t of h)t.deleteArrowIfExist();h=[]}else h=[]})(),A(),I(),O(),y(null),g(null)},O=()=>{getEngine().quests&&getEngine().quests.clearHighlightQuestInItems(),getEngine().heroEquipment.clearHighlightInItems(r.HIGHLIGHT_CLASS.TRACK)},M=t=>{i.setQuestTrackingId(t)},N=()=>i.getQuestTrackingId();this.init=()=>{e=new a,i=new n,i.init(),g(null)},this.checkTrackingNpcExist=t=>!!o[t],this.getNearTrackingNpc=(t,e,i)=>{let n=o[t],a=200,s=null;for(let t in n){let r=n[t],o=r.getX(),l=r.getY(),c=Math.abs(o-e)+Math.abs(l-i);c<a&&(a=c,s=r)}return s},this.stopTracking=k,this.updateData=i=>{let n=e.getParseData(i),a=(e=>{let i=[];if(!t)return i;for(let n in t){let a=t[n];e[a.questId]||i.push(a)}return i})(u(n)),s=[...n,...a];p(s)},this.update=t=>{if(h)for(let e=0;e<h.length;e++)h[e].update(t)},this.checkAddNpcAndAdd=t=>{T()&&E(t)},this.checkRemoveNpcAndRemove=t=>{T()&&_(t)},this.startTrackingIfActiveTrackingQuestExist=()=>{let t=N();f(t)},this.afterInterfaceStart=()=>{if(null===i.checkQuestTrackingId())return;let t=i.getQuestTrackingId();w(t)?(f(t),getEngine().quests.refreshTrackQuestButtons()):getEngine().quests.refreshTrackQuestButtons()},this.setActiveQuestTrackingProcedure=t=>{M(t),null!=t&&w(t)?f(t):k()},this.getActiveQuestTrackingInStorage=N,this.saveActiveQuestTrackingInStorage=M,this.deleteFromQuestTrackingDataIfExist=e=>{if(t)for(let i=0;i<t.length;i++)t[i].questId==e&&(deleteElementFromArray(i,t),i--)},this.onClear=()=>{A(),I()},this.clearQuestTrackingDataAfterDie=()=>{p(null)}}},function(t,e,i){var n=i(5);t.exports=function(){this.init=()=>{},this.setQuestTrackingId=t=>{let e=getEngine().hero.getId();n.set("questTracking"+e,parseInt(t))},this.getQuestTrackingId=()=>{let t=getEngine().hero.getId();return n.get("questTracking"+t)},this.checkQuestTrackingId=()=>{let t=getEngine().hero.getId();return null!==n.get("questTracking"+t)},this.removeQuestTracking=()=>{let t=getEngine().hero.getId();n.get("questTracking"+t)&&n.remove("questTracking"+t)}}},function(t,e,i){let n=i(54);t.exports=function(){const t=t=>{if("*"==t)return null;if(""==t)return null;let n=t.split("|");return 5==n.length?e(n):3==n.length?i(n):void 0},e=t=>{let e=t[3],i=h(t[4],e);if(-1==i.pos.x&&-1==i.pos.y)return null;let n=s(t[1]);return{questId:t[0],kind:n,killCounter:l(n,t[2]),toCollect:c(n,t[2]),name1:e,name2:i.name,pos:i.pos}},i=t=>{let e=a(t[1]),i=h(t[2],e);if(-1==i.pos.x&&-1==i.pos.y)return null;let n=r(t[1]);return{questId:t[0],kind:n,killCounter:o(n,t[1]),toCollect:d(n,t[1]),name1:e,name2:i.name,pos:i.pos}},a=t=>t.replace(/#[KB]\.([0-9]+)#/g,"").replace("Find: ","").replace("Go to: ","").replace("Kill: ","").replace(/\s\([0-9]+\/[0-9]+\)/,""),s=t=>{const e=n.TYPE;switch(t){case e.TALK:return e.TALK;case e.KILL:return e.KILL;case e.COLLECT:return e.COLLECT}},r=t=>{const e=n.TYPE;let i=null;return/#[K]\.([0-9]+)#/.test(t)&&(i=e.KILL),/#[B]\.([0-9]+)#/.test(t)&&(i=e.COLLECT),i||(i=e.TALK),i},o=(t,e)=>{if(t!=n.TYPE.KILL)return null;let i=/\([0-9]+\/[0-9]+\)/.exec(e);if(!i)return null;let a=i[0];a=a.replace("(",""),a=a.replace(")","");let s=a.split("/");return{current:parseInt(s[0]),toKill:parseInt(s[1])}},l=(t,e)=>{if(t!=n.TYPE.KILL)return null;let i=e.split("/");return{current:parseInt(i[0]),toKill:parseInt(i[1])}},c=(t,e)=>t!=n.TYPE.COLLECT?null:parseInt(e),d=(t,e)=>{if(t!=n.TYPE.COLLECT)return null;let i=/\([0-9]+\/[0-9]+\)/.exec(e);if(!i)return null;let a=i[0];a=a.replace("(",""),a=a.replace(")","");let s=a.split("/");return parseInt(s[1])},h=(t,e)=>{let i=t.split("."),n={pos:{x:parseInt(i[1]),y:parseInt(i[2]),mapId:parseInt(i[0])}};return n.name=4==i.length?i[3]:e,n},u=function(t){for(var e=[],i=[],a=0;a<t.length;a++){var s=t[a];if(!(e.indexOf(s)>-1)){var r=s.split("|");if(Array.isArray(r)&&r[1]==n.TYPE.KILL){var o=r[3];if(i.indexOf(o)>-1)continue;e.push(s),i.push(o)}else e.push(s)}}return e};this.getParseData=e=>{let i=u(e),n=[];for(let e of i){let i=t(e);i&&n.push(i)}return n}}},function(t,e,i){let n=i(54);t.exports=function(){let t,e,i,a,s={x:null,y:null};const r=(t,e)=>{s.x=t,s.y=e},o=t=>{e=t},l=(t,e)=>getEngine().npcs.checkNpcPos(t,e),c=(t,e)=>getEngine().map.gateways.getGtwAtPosition(t,e),d=t=>{let e=l(s.x,s.y),i=c(s.x,s.y);w(!e&&!i),f(s.x,s.y)},h=t=>{let e=i.toCollect,a=i.name2,s=getEngine().heroEquipment.getAmountItemAmount(a),r=null==s||s<e,o=getEngine().shop;if(o){let t=o.getShopItemsNameHighlight(a);getEngine().heroEquipment.setClassInItemsHighlight(t,n.HIGHLIGHT_CLASS.TRACK)}r?p():E()&&_()},u=t=>{let e=i.killCounter;e.current<e.toKill&&p()},p=()=>{let t=i.name2,e=getEngine().questTracking.checkTrackingNpcExist(t),n=g(e,t),a=c(n.x,n.y),s=((t,e,i)=>{let n=getEngine().map.groundItems.getGroundItemOnPosition(t,e);if(!n.length)return!1;for(let t in n)if(n[t].getName()==i)return!0;return!1})(n.x,n.y,t);e||(e=l(n.x,n.y)),w(!e&&!a&&!s),f(n.x,n.y)},g=(t,e)=>{let i,n;if(t){let t=getEngine().hero,a=getEngine().questTracking.getNearTrackingNpc(e,t.rx,t.ry);i=a.getX(),n=a.getY()}else i=s.x,n=s.y;return{x:i,y:n}},f=(t,e)=>{if(E()){let i=m(t,e),n=v(),s=!a&&n||a&&!n;if(i&&s)return;_()}b(t,e)},m=(t,i)=>getEngine().targets.checkExistInSpecificPosById(e,t,i),v=()=>getEngine().targets.checkTargetIsDefaultSrc(e),E=()=>getEngine().targets.checkExistById(e),_=()=>{getEngine().targets.deleteArrow(e)},b=(t,s)=>{let r,o={x:t,y:s},l={};a&&(l.src="/img/placeholder_npc_item.png");let c=i.name2,d=i.killCounter;r=d?c+" ("+d.current+"/"+d.toKill+")":c,getEngine().targets.addArrow(e,r,o,n.TRACKING_ARROW,!1,l)},w=t=>{a=t};this.init=()=>{w(!1)},this.updateData=e=>{const a=n.TYPE;if(i=e,t=i.kind,t==a.COLLECT){let t=i.pos;r(t.x,t.y)}if(t==a.TALK){let t=i.pos;r(t.x,t.y)}if(t==a.KILL){let t=i.pos;r(t.x,t.y)}o(i.name2+s.x+","+s.y+n.TRACKING_ARROW)},this.update=e=>{const i=n.TYPE;switch(t){case i.TALK:d(e);break;case i.COLLECT:h(e);break;case i.KILL:u(e)}},this.deleteArrowIfExist=()=>{E()&&_()}}},function(t,e){t.exports=function(){var t=this,e=10;this.init=()=>{},this.addItemToTip=function(t,e,i){let n;n=i.isItem()?Engine.items.createViewIcon(t,Engine.itemsViewData.STICKY_ITEM_VIEW)[0][0]:Engine.tpls.createViewIcon(t,Engine.itemsViewData.STICKY_ITEM_VIEW,i.loc)[0][0];let a=e.querySelector(".item");a&&a.remove(),e.querySelector(".item-head").prepend(n)},this.add=e=>{let i=e.id;t.deleteIfExist(i);let n=e.$.getTipData(),a=e.$.attr("data-item-type"),s=document.createElement("div");s.className="tip-wrapper sticky-tip sticky-tip-id-"+i,s.style.left="271px",s.style.top="70px",s.style.display="block",s.style.position="absolute",s.setAttribute("data-type","t_item"),s.setAttribute("data-item-type",a),s.addEventListener("mousedown",this.onMouseDown.bind(this));let r=document.createElement("div");r.className="content",r.innerHTML=n,s.append(r),this.addCloseBtn(s),this.addDraggable(s),this.setZIndex(s),this.addItemToTip(i,s,e),Engine.interface.get$stickyTipsLayer()[0].append(s)},this.deleteIfExist=e=>{let i=document.querySelector(".sticky-tip-id-"+e);i&&t.close(i)},this.addDraggable=t=>$(t).draggable({handle:".item-head",drag:function(t,e){const i=document.body.clientWidth,n=document.body.clientHeight,a=this.offsetWidth,s=this.offsetHeight;e.position.left<0&&(e.position.left=0),e.position.top<0&&(e.position.top=0),e.position.left+a>i&&(e.position.left=i-a),e.position.top+s>n&&(e.position.top=n-s)},stop:(t,e)=>{this.setZIndex(t.target)}}),this.addCloseBtn=t=>{let e=document.createElement("div");e.className="close",e.addEventListener("click",this.onCloseClick.bind(this)),$(e).tip(_t("delete")),t.appendChild(e)},this.onMouseDown=t=>{this.setZIndex(t.currentTarget)},this.onCloseClick=t=>{const e=t.currentTarget,i=e.parentNode;this.close(i),$(e).tipHide()},this.setZIndex=t=>{t.style.zIndex=e++},this.close=t=>{let e=t.querySelector(".item");if(e){let t=$(e).data().item,i=t.id;t.isItem()?Engine.items.deleteViewIcon(i,Engine.itemsViewData.STICKY_ITEM_VIEW):Engine.tpls.deleteViewIcon(i,Engine.itemsViewData.STICKY_ITEM_VIEW)}t.remove()}}},function(t,e,i){const n=i(0),a=i(434);t.exports=function(){var t=this;let e,i,s=[];this.actions={openCaptcha:"openCaptcha",showPreCaptcha:"showPreCaptcha",captchaDone:"captchaDone",blockWithCounter:"blockWithCounter",openCaptchaAndBlockInit:"openCaptchaAndBlockInit"},this.init=function(){},this.blockMove=()=>{Engine.lock.add("captcha")},this.unblockMove=()=>{Engine.lock.remove("captcha")},this.getAction=t=>{let e=null;if(isset(t.content))e=this.getEngine().allInit?this.actions.openCaptcha:this.actions.openCaptchaAndBlockInit;else if(isset(t.autostart_time_left))e=this.actions.showPreCaptcha;else if(isset(t.done)&&t.done)e=this.actions.captchaDone;else if(isset(t.blockade_time_left))e=this.actions.blockWithCounter;else{if(!isset(t.blocked))throw new Error("[Captcha.js, getAction] No action for this engine answer");e=!1}return e},this.updateData=t=>{const e=this.getAction(t);e&&this[e](t)},this.openCaptcha=t=>{isset(this.wnd)&&this.close(),i&&i.close(),this.initWindow(),this.create(t),this.wnd.center()},this.openCaptchaAndBlockInit=t=>{this.openCaptcha(t),this.engineStopAndBlockNextInit()},this.showPreCaptcha=t=>{i=new a,i.init(t.autostart_time_left,r)};const r=()=>{i=null};this.captchaDone=t=>{this.close()},this.blockWithCounter=t=>{this.close(),this.countTimeToNextCaptcha(t.blockade_time_left),this.engineStopAndBlockNextInit(),error("Engine stop")},this.engineStopAndBlockNextInit=function(){t.getEngine().stop(),t.getEngine().setBlockSendNextInit(!0)},this.countTimeToNextCaptcha=t=>{let e=t;mAlert(_t("captcha_wrong_answer"),[{txt:_t("main_page"),hotkeyClass:"alert-accept-hotkey",callback:function(){return window.location.href=isPl()?"https://www.margonem.pl/":"https://margonem.com/",!0}}]),setInterval(()=>{e--,e<0&&(e=0),e<1&&location.reload(),this.updateCaptchaBlockadeTimer(e)},1e3),this.updateCaptchaBlockadeTimer(e)},this.updateCaptchaBlockadeTimer=t=>{$("#captcha-timer").html(getSecondLeft(t))},this.create=t=>{this.clear(),this.createImg({image:t.content.image}),this.createQuestion({text:t.content.question.text}),this.createButtons({answers:t.content.question.options}),this.createConfirmButton(),this.createTriesLeft(t.triesLeft),this.blockMove()},this.createImg=t=>{let{image:i}=t;var n=document.createElement("IMG");n.setAttribute("src",i.data),n.setAttribute("width",i.resolution.x),n.setAttribute("height",i.resolution.y),e.querySelector(".captcha__image").append(n)},this.createQuestion=t=>{let{text:i}=t;e.querySelector(".captcha__question").textContent=i},this.createButtons=t=>{let{answers:i}=t;for(const t in i){const n=i[t],a=createButton(n,["small","green"],this.buttonOnClick);e.querySelector(".captcha__buttons").append(a)}},this.createConfirmButton=()=>{const t=createButton(_t("captcha_confirm"),["small","green"],this.confirmOnClick);e.querySelector(".captcha__confirm").append(t)},this.createTriesLeft=t=>{e.querySelector(".captcha__triesleft").innerHTML=_t("captcha_triesleft")+t},this.buttonOnClick=t=>{if(!t.isTrusted)return;var e=t.target;const i=this.getNodeIndex(e);e.classList.toggle("pressed"),this.updateSelectedAnswers(i)},this.updateSelectedAnswers=t=>{this.getSelectedAnswer().includes(t)?this.removeSelectedAnswer(t):this.addSelectedAnswer(t)},this.getSelectedAnswer=()=>s,this.addSelectedAnswer=t=>{this.getSelectedAnswer().push(t)},this.removeSelectedAnswer=t=>{this.getSelectedAnswer().splice(this.getSelectedAnswer().indexOf(t),1)},this.getFinishRequest=()=>"captcha&answerId="+this.getSelectedAnswer().sort().join(","),this.confirmOnClick=t=>{if(!t.isTrusted)return;const e=this.getFinishRequest(),i=this.getEngine();i.allInit?_g(e):(i.start(),i.setFirstLoadInit1(!0),i.setFirstLoadInit2(!0),i.reCallInitQueue("&"+e))},this.initWindow=function(){Engine.windowManager.add({content:this.getCaptchaTpl(),nameWindow:Engine.windowsData.name.CAPTCHA,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,title:_t("captcha"),addClass:"captcha-window",closeable:!1,onclose:()=>{this.close()}}),this.setDefaultContent(),this.wnd.addToCaptchaLayer()},this.clear=()=>{this.setDefaultContent(),s=[]},this.setDefaultContent=()=>{e=this.getCaptchaTpl(),this.wnd.content(e)},this.getCaptchaTpl=()=>n.get("captcha")[0],this.getNodeIndex=t=>[...t.parentNode.children].indexOf(t),this.close=function(){this.unblockMove(),isset(this.wnd)&&this.wnd.remove()},this.getEngine=function(){return Engine}}},function(t,e,i){var n=i(0);t.exports=function(){var t=null,e=!1;let i;this.wndEl=Engine.interface.get$interfaceLayer().find(".pre-captcha")[0],this.toggleBtnEl=null,this.init=function(t,e){this.clear(),this.addPreCaptchaInfo(t),this.createToggleButton(),a(e)};const a=t=>{i=t};this.createToggleButton=()=>{this.toggleBtnEl=this.wndEl.querySelector(".captcha-pre-info__toggler"),this.toggleBtnEl.addEventListener("click",this.toggleWindow),this.show()},this.toggleWindow=()=>{e?this.show():this.hide()},this.show=()=>{this.wndEl.classList.add("show"),this.toggleBtnEl.classList.add("is-open"),e=!1},this.hide=()=>{this.wndEl.classList.remove("show"),this.toggleBtnEl.classList.remove("is-open"),e=!0},this.getDefaultYWindowPos=()=>hudEl.offsetHeight,this.addPreCaptchaInfo=t=>{const e=t-1,i=new Date;i.setSeconds(i.getSeconds()+e);const a=n.get("captcha-pre-info")[0],s=a.querySelector(".captcha-pre-info__time"),r=a.querySelector(".captcha-pre-info__button"),o=createButton(_t("captcha_resolve_now"),["small","green"],()=>{this.removePreCaptchaInfo(),_g("captcha&start=1")});s.textContent=e,r.append(o),this.preCaptchaInfoTimeTick(s,i),this.wndEl.appendChild(a)},this.preCaptchaInfoTimeTick=(e,i)=>{t=setInterval(()=>{let t=new Date,n=Math.ceil((i.getTime()-t.getTime())/1e3);n<=0&&this.removePreCaptchaInfo(),e.innerHTML=n},500)},this.removePreCaptchaInfo=()=>{clearInterval(t),this.close()},this.close=function(){this.hide(),this.clear(),i()},this.clear=()=>{this.wndEl.innerHTML=""}}},function(t,e,i){const n=i(0),a=i(5);t.exports=function(){let t,e,i,s,r={rateRange:[1,10],pollApiUrl:null,pollApiUrlPush:null,pollHitKey:"pollHit",pollDisplayedKey:"pollDisplayed"};function o(t,e){for(const i in e)t.setAttribute(i,e[i])}this.getApiDomain=()=>this.getEngine().worldConfig.getApiDomain(),this.getConfig=()=>r,this.setApiUrl=()=>{const t=this.getHS3Cookie(),e=this.getApiDomain();this.getConfig().pollApiUrl=`${e}/surveys/get?hs3=${t}`,this.getConfig().pollApiUrlPush=e+"/surveys/vote"},this.init=()=>{this.canHitForPoll().then(t=>{t&&(this.setPollHitDate(),this.getPollData())})},this.canHitForPoll=async()=>{const t=await this.hasPollDisplayedToday();return!(this.hasPollHitToday()||t)},this.hasPollDisplayedToday=async()=>{const t=await Engine.crossStorage.get(this.getConfig().pollDisplayedKey);return t&&t===getCurrentDate()},this.setPollDisplayedDate=()=>{Engine.crossStorage.set(this.getConfig().pollDisplayedKey,getCurrentDate())},this.hasPollHitToday=()=>{const t=a.get(this.getConfig().pollHitKey);return t&&t===getCurrentDate()},this.setPollHitDate=()=>{a.set(this.getConfig().pollHitKey,getCurrentDate())},this.getPollData=()=>{this.setApiUrl(),fetch(this.getConfig().pollApiUrl,{credentials:"include"}).then(t=>t.json()).then(t=>{const e=t.survey;e?this.updateData({data:e}):isset(t.error)&&console.warn("[Poll.js, getPollData] Poll - Something went wrong.")}).catch(t=>{console.warn("[Poll.js, getPollData] Poll - Something went wrong.",t)})},this.updateData=t=>{let{data:e}=t;isset(e)&&(i=e.id,this.openPoll({data:e}))},this.openPoll=t=>{let{data:e}=t;this.close(),this.setPollDisplayedDate(),this.initWindow(),this.create({data:e}),this.wnd.center()},this.create=t=>{let{data:i}=t;this.createQuestion({data:i}),this.createConfirmButton(),e=this.wnd.el.querySelector("form")},this.createQuestion=e=>{let{data:i}=e;const a=t.querySelector(".poll__list");i.questions.forEach((t,e,i)=>{const s=n.get("poll__list-item")[0],r=s.querySelector(".poll__answers");s.querySelector(".poll__question").textContent=`${e+1}. ${t}`,this.createAnswers(r,e+1),a.appendChild(s)})},this.createAnswers=(t,e)=>{const i=this.getConfig().rateRange;for(let n=i[0];n<=i[1];n++){const i=`answer_${e}-${n}`,a=document.createElement("div");a.classList.add("poll__answers-item");const s=document.createElement("input");o(s,{type:"radio",value:n,id:i,name:"q_"+e,required:!0}),s.addEventListener("change",this.checkValid);const r=document.createElement("label");o(r,{for:i}),r.textContent=n.toString(),a.appendChild(s),a.appendChild(r),t.appendChild(a)}return t},this.createConfirmButton=()=>{s=createButton(_t("send",null,"mails"),["small","green","disable"],this.confirmOnClick),t.querySelector(".poll__confirm").append(s)},this.checkValid=()=>e.checkValidity()?(s.classList.remove("disable"),!0):(s.classList.add("disable"),!1),this.getHS3Cookie=()=>getCookie("hs3"),this.confirmOnClick=()=>{const t=$(e).serializeArray().map(t=>parseInt(t.value)),n={vote:i,w:this.getEngine().worldConfig.getWorldName(),answer:t,hs3:this.getHS3Cookie()};fetch(this.getConfig().pollApiUrlPush,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(n)}).then(t=>0===t.status?null:t.json()).then(t=>{}).catch(t=>{console.warn("[Poll.js, confirmOnClick] Something went wrong.",t)});this.close()},this.initWindow=()=>{t=this.getDefaultContent(),Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.POLL,type:Engine.windowsData.type.TRANSPARENT,nameRefInParent:"wnd",objParent:this,title:_t("poll"),addClass:"poll-window",onclose:()=>{this.close()}}),this.wnd.el=this.wnd.$[0],this.wnd.addToAlertLayer()},this.getDefaultContent=()=>n.get("poll")[0],this.close=()=>{isset(this.wnd)&&this.wnd.remove()},this.getEngine=()=>Engine}},function(t,e){t.exports=function(){var t=this;this.mask=null,this.magin=2,this.warRangeAndMargin=null,this.fw=null,this.fh=null,this.halffw=null,this.halfhh=null,this.globalComposition="xor",this.canDraw=!1;var e=null,i=null;this.init=function(){this.createImg(),this.createCanvas()},this.setWarRange=function(t){this.canDraw=t>0,this.warRangeAndMargin=t+this.magin,this.fw=2*this.warRangeAndMargin*32,this.fh=2*this.warRangeAndMargin*32,this.halffw=this.fw/2,this.halfhh=this.fh/2},this.createCanvas=function(){e=document.createElement("canvas"),i=e.getContext("2d")},this.setSizeCanvas=function(){let t=Engine.interface.get$GAME_CANVAS();e.width=t.width(),e.height=t.height()},this.getWarShadow=function(){return!t.canDraw||Engine.opt(24)?[]:[t]},this.drawMask=function(){var n=e.width,a=e.height,s=32*t.rx-t.halffw+16-Engine.map.offset[0],r=32*t.ry-t.halfhh+16-Engine.map.offset[1];s=Math.round(s),r=Math.round(r),i.clearRect(0,0,n,a),i.drawImage(t.mask,s,r,t.fw,t.fh),i.globalCompositeOperation=t.globalComposition,i.fillRect(0,0,n,a)},this.getOrder=function(){return 400},this.update=function(){this.updatePos()},this.updatePos=function(){this.rx=Engine.hero.rx,this.ry=Engine.hero.ry},this.createImg=function(){Engine.imgLoader.onload("../img/testmask9.png",!1,e=>{t.mask=e},t=>{!0})},this.checkCanDraw=function(){},this.draw=function(i){if(e.width<1||e.height<1)return;t.checkCanDraw(),t.drawMask(),i.globalAlpha=.7;let n=Engine.map.clipObject(0,0,e.width,e.height);n&&(i.drawImage(e,n.backgroundPositionX,n.backgroundPositionY,n.width,n.height,n.left,n.top,n.width,n.height),i.globalAlpha=1)},this.updateColor=function(){t.color=t.master.d.whoIsHere},this.init()}},function(t,e,i){let n=i(12),a=i(38);t.exports=function(){var t=this,e=this;this.healItems=[],this.lootboxes=[],this.expiresItems=[],this.enhanceReagentItems=[],this.noBonusItems=[],this.init=function(t){},this.newItem=function(t){Engine.hero.d.lvl<25&&n.isInBagSt(t.st)&&(this.checkHealItem(t)&&this.checkLvlRequired(t)&&(this.healItems.push(t.id),this.markHealItems()),this.checkLootBox(t)&&(this.lootboxes.push(t.id),this.markOneLootBox(t.id,Engine.hero.d.lvl))),this.checkEnhanceReagentItem(t)&&Engine.crafting.enhancement&&Engine.crafting.enhancement.selectedEnhanceItem&&Engine.crafting.enhancement.selectedEnhanceItem!==parseInt(t.id)&&(this.enhanceReagentItems.push(parseInt(t.id)),this.markEnhanceReagentItems()),this.checkNoBonusItem(t)&&(this.noBonusItems.push(t.id),this.markNoBonusItems(t),t.on("afterUpdate",()=>{this.markNoBonusItems(t)})),this.checkExpiresItem(t)&&(this.expiresItems.push(t.id),this.markExpireItem(t))},this.removeItem=function(t){!a.isEquipItemLoc(t.loc)||Engine.hero.d.lvl>=25||(this.healItems=this.healItems.filter((function(e){return e!=t.id})),this.lootboxes=this.lootboxes.filter((function(e){return e!=t.id})))},this.checkLvlRequired=t=>!isset(t.getLvl())||t.getLvl()<=Engine.hero.d.lvl,this.checkHealItem=function(t){return isset(t._cachedStats.leczy)||isset(t._cachedStats.fullheal)||isset(t._cachedStats.perheal)},this.checkLootBox=function(t){return isset(t._cachedStats.lootbox)||isset(t._cachedStats.lootbox2)},this.checkExpiresItem=function(t){return isset(t._cachedStats.expires)},this.checkEnhanceReagentItem=t=>a.isEquipItemLoc(t.loc),this.checkNoBonusItem=function(t){return isset(t._cachedStats.bonus_not_selected)},this.isLowHealth=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t||Math.ceil(Engine.hero.d.warrior_stats.hp/Engine.hero.d.warrior_stats.maxhp*100);return e<=50},this.getHealItems=function(){return this.healItems},this.getLootBox=function(){return this.lootboxes},this.markEnhanceReagentItems=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.enhanceReagentItems=e.length>0?e:t.enhanceReagentItems;for(let e of t.enhanceReagentItems){let i=Engine.items.getItemById(e),n=null;const a=Engine.crafting.enhancement.getReagentBonus(i);a&&(n="enhanceBonus"+a),isset(i)&&null!=n&&t.addClassToElements(i.$,n,i)}},this.unmarkEnhanceReagentItems=()=>{for(let t of this.enhanceReagentItems){let e=Engine.items.getItemById(t),i=["enhanceBonus1","enhanceBonus2","enhanceBonus3","enhanceBonus4"];isset(e)&&this.removeClassFromElements(e.$,i,e)}},this.markNoBonusItems=t=>{let e="noBonus";isset(t._cachedStats.bonus_not_selected)&&isOwnItem(t)?this.addClassToElements(t.$,e,t):this.removeClassFromElements(t.$,e,t)},this.markHealItems=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.healItems.length)for(let e of this.healItems){let i=Engine.items.getItemById(e),n="heal";i&&(this.isLowHealth(t)?this.addClassToElements(i.$,n,i):this.removeClassFromElements(i.$,n,i))}},this.markLootBoxes=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.lootboxes.length){t=t||Engine.hero.d.lvl;for(let e of this.lootboxes)this.markOneLootBox(e,t)}},this.markOneLootBox=(t,e)=>{let i=Engine.items.getItemById(t),n="lootBox";i&&(!i._cachedStats.lvl||i._cachedStats.lvl<=e?this.addClassToElements(i.$,n,i):this.removeClassFromElements(i.$,n,i))},this.markExpireItem=function(t){let e="expired";const i=()=>{t._cachedStats.expires-unix_time()<0?(this.addClassToElements(t.$,e,t),isset(t.expireInterval)&&clearInterval(t.expireInterval)):t._cachedStats.expires-unix_time()<259200||this.removeClassFromElements(t.$,e,t)};i(),t.expireInterval||(t.expireInterval=setInterval(()=>{i()},1e3))},this.addClassToElements=function(t,e,i){let n=Array.isArray(t)?t:[t];for(let t of n)i.createNotice(e)},this.removeClassFromElements=function(t,e,i){let n=Array.isArray(t)?t:[t],a=Array.isArray(e)?e:[e];for(let t of n)for(let e of a)t.removeClass(e),i.removeNotice(e),i.clearCanvasNotice()},this.heroHpChanged=function(t){if(Engine.hero.d.lvl>=25)return;let e=Math.ceil(100*t);this.markHealItems(e)},this.heroLvlChanged=function(t){Engine.hero.d.lvl>=25||this.markLootBoxes(t)},this.compareAllItems=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Engine.hero.d.lvl>25)return;if(Engine.shop){let e=Engine.shop.items;Object.assign(t,e)}let i=Engine.heroEquipment,n=Object.values(i.getEqItems()),a=Object.assign({},i.getHItems(),t),s=Object.values(a).map(e.mapItems).filter(e.itemInBagAndCanEquipFilter).filter(t=>e.sameItemsFilter(t,n)),r=e.removeDuplicatesLowerScore(s);r.map(e.addMarkHigherScore)},this.removeDuplicatesLowerScore=function(t){return Array.from(t.reduce((t,e)=>!t.has(e.itemClType)||t.get(e.itemClType).score<=e.score?t.set(e.itemClType,e):t,new Map).values())},this.mapItems=function(t){return t=e.setItemType(t),e.clearMarkHigherScore(t)},this.setItemType=function(t){switch(t.cl){case 1:case 2:case 3:t.itemClType=123;break;default:t.itemClType=t.cl}return t},this.clearMarkHigherScore=function(t){return e.removeClassFromElements(t.$,"higherScore",t),t},this.addMarkHigherScore=function(t){e.addClassToElements(t.$,"higherScore",t)},this.itemInBagAndCanEquipFilter=function(t){return n.isInBagSt(t.st)&&Engine.heroEquipment.checkItemCanEquip(t)},this.sameItemsFilter=function(t,e){return!e.some(e=>t.itemClType===e.itemClType&&t.score<=e.score)}}},function(t,e){t.exports=function(){var t=this,e=this;this.items=[],this.init=function(){},this.addItem=(t,e,i)=>{this.items.push({id:t.id,loc:e}),this.createMoveItem(t.id,i)},this.createMoveItem=(t,e)=>{Engine.items.getItemById(t);let i=Engine.items.getAllViewsById(t);this.addChooseToViews(t,i,"moved disable-item-mark",e)},this.removeMoveItem=t=>{Engine.items.getItemById(t);let e=Engine.items.getAllViewsById(t);this.removeClassFromElements(e,"moved disable-item-mark")},this.removeItem=t=>{this.items=this.items.filter((function(i){return i.id==t&&e.removeMoveItem(i.id),i.id!=t}))},this.removeItemsByTarget=function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.items=t.items.filter(t=>{const a=parseInt(t.id);return 0===n.length?(t.loc===i&&e.removeMoveItem(a),t.loc!==i):(t.loc!==i||n.includes(a)||e.removeMoveItem(a),t.loc!==i||n.includes(a))})},this.addChooseToViews=(t,e,i,n)=>{let a=Array.isArray(e)?e:[e];for(let e of a)this.addChooseToOneView(t,e,i,n)},this.addChooseToOneView=(t,e,i,n)=>{if(e.find(".choose-icon").length)return;let a=$("<div>").addClass("choose-icon"),s=$("<div>").addClass("click-area");e.addClass(i),e.append(a),e.append(s),s.click(t=>{t.stopPropagation(),n&&n()})},this.removeChooseIcon=t=>{t.find(".choose-icon").remove(),t.find(".click-area").remove()},this.removeClassFromElements=(t,e)=>{let i=Array.isArray(t)?t:[t];for(let t of i)t.removeClass(e),this.removeChooseIcon(t)}}},function(t,e,i){let n=i(12),a=i(15);t.exports=function(){var t=this;this.allKinds=[],this.allDisableItemStats=null,this.allDisableItemClass=null,this.allAllowItemClass=null,this.allEnableTpl=null,this.disableExpiresStat=null,this.disableEq=null,this.disabledItems={},this.activeDisableKinds={},this.init=()=>{this.prepareAllKinds(),this.initAllDisableKinds()},this.prepareAllKinds=()=>{let t=Engine.itemsDisableData;for(let e in t)this.allKinds.push(t[e])},this.testExpires=()=>{for(let t in this.allDisableItemStats){if(this.allDisableItemStats[t].includes("expires"))return void console.error("[DisableItemsManager.js, testExpires] Stat expires is forbidden")}},this.testKinds=t=>{for(let e=0;e<this.allKinds.length;e++){let i=this.allKinds[e];if(!t.hasOwnProperty(i))return console.error("[DisableItemsManager.js, testKinds] Has not property:",i,t),void console.trace()}},this.initAllDisableKinds=()=>{let t=Engine.itemsDisableData;this.allDisableItemStats={[t.MAIL]:["permbound","soulbound"],[t.SHOP]:[],[t.BARTER]:[],[t.DEPO]:["nodepo"],[t.DEPO_CLAN]:["nodepoclan","permbound","soulbound"],[t.AUCTION]:["noauction","permbound"],[t.SALVAGE]:["cursed","artisan_worthless",{lvl:["<",20]}],[t.ENHANCE]:["cursed",{lvl:["<",20]}],[t.ENHANCE_INGR]:["cursed","artisan_worthless",{lvl:["<",20]}],[t.EXTRACTION]:[],[t.BONUS_RESELECT]:[]},this.allAllowItemStats={[t.MAIL]:[],[t.SHOP]:[],[t.BARTER]:[],[t.DEPO]:[],[t.DEPO_CLAN]:[],[t.AUCTION]:[],[t.SALVAGE]:[],[t.ENHANCE]:[],[t.ENHANCE_INGR]:[],[t.EXTRACTION]:["enhancement_upgrade_lvl"],[t.BONUS_RESELECT]:["bonus"]},this.allDisableItemClass={[t.MAIL]:[],[t.SHOP]:[a.CL.GOLD,a.CL.QUEST,a.CL.BLESS,a.CL.UPGRADE,a.CL.RECIPE,a.CL.COINAGE],[t.BARTER]:[],[t.DEPO]:[],[t.DEPO_CLAN]:[],[t.AUCTION]:[a.CL.GOLD,a.CL.QUEST,a.CL.BLESS,a.CL.UPGRADE,a.CL.RECIPE,a.CL.KEYS],[t.SALVAGE]:[],[t.ENHANCE]:[],[t.ENHANCE_INGR]:[],[t.EXTRACTION]:[],[t.BONUS_RESELECT]:[]},this.allAllowItemClass={[t.MAIL]:[],[t.SHOP]:[],[t.BARTER]:[],[t.DEPO]:[],[t.DEPO_CLAN]:[],[t.AUCTION]:[],[t.SALVAGE]:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,29],[t.ENHANCE]:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,29],[t.ENHANCE_INGR]:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,29],[t.EXTRACTION]:[],[t.BONUS_RESELECT]:[]},this.allEnableTpl={[t.MAIL]:null,[t.SHOP]:null,[t.BARTER]:null,[t.DEPO]:null,[t.DEPO_CLAN]:null,[t.AUCTION]:null,[t.SALVAGE]:null,[t.ENHANCE]:null,[t.ENHANCE_INGR]:null,[t.EXTRACTION]:null,[t.BONUS_RESELECT]:null},this.enableLinkedConditions={[t.MAIL]:null,[t.SHOP]:null,[t.BARTER]:null,[t.DEPO]:null,[t.DEPO_CLAN]:null,[t.AUCTION]:null,[t.SALVAGE]:null,[t.ENHANCE]:null,[t.ENHANCE_INGR]:null,[t.EXTRACTION]:null,[t.BONUS_RESELECT]:null},this.disableExpiresStat={[t.MAIL]:null,[t.SHOP]:null,[t.BARTER]:!0,[t.DEPO]:null,[t.DEPO_CLAN]:null,[t.AUCTION]:null,[t.SALVAGE]:"all",[t.ENHANCE]:"all",[t.ENHANCE_INGR]:"all",[t.EXTRACTION]:null,[t.BONUS_RESELECT]:null},this.disableEq={[t.MAIL]:!1,[t.SHOP]:!1,[t.BARTER]:!1,[t.DEPO]:!1,[t.DEPO_CLAN]:!1,[t.AUCTION]:!1,[t.SALVAGE]:!0,[t.ENHANCE]:!1,[t.ENHANCE_INGR]:!0,[t.EXTRACTION]:!0,[t.BONUS_RESELECT]:!0},this.testKinds(this.allAllowItemStats),this.testKinds(this.allAllowItemClass),this.testKinds(this.allEnableTpl),this.testKinds(this.disableExpiresStat),this.testKinds(this.disableEq),this.testExpires()},this.addToActiveDisableKinds=t=>{this.activeDisableKinds[t]=!0},this.removeFromActiveDisableKinds=t=>{delete this.activeDisableKinds[t]},this.removeFromDisableItems=t=>{delete this.disabledItems[t]},this.addDisableClassToItem=(t,e)=>{const i=parseInt(t.data().item.id);this.disabledItems[e]||(this.disabledItems[e]=[]),this.disabledItems[e].includes(i)||this.disabledItems[e].push(i),t.addClass(e+"-disable disable-item-mark"),this.addDisableIcon(t)},this.getAllDisabledItemsArray=()=>{let t=[];for(let e in this.disabledItems){let i=this.disabledItems[e];for(let e in i)t.push(i[e])}return t},this.addDisableIcon=t=>{if(t.find(".choose-icon").length)return;let e="disable-icon";if(!t.find("."+e).length){let i=$("<div>").addClass(e);t.append(i)}},this.removeDisableIcon=t=>{t.find(".disable-icon").remove()},this.prepareClassToDisable=t=>{let e=t.split(","),i=Array.from(new Array(32),(t,e)=>e+1);for(;e.length;){let t=parseInt(e[0]),n=i.indexOf(t);n>-1&&i.splice(n,1),e.splice(0,1)}return i},this.isPremiumShop=()=>Engine.shop&&Engine.shop.getPremiumShop(),this.isOnlyBuyShop=()=>Engine.shop&&Engine.shop.isOnlyBuyShop(),this.checkShopItemShouldBeDisable=t=>{let e=Engine.shop.getPurchase();if("*"==e)return!1;if(""==e)return!0;if(this.prepareClassToDisable(e).indexOf(t.cl)>-1)return!0;return!1},this.manageItemDisableInHeroEQ=(t,e)=>{this.manageItemDisable(t,e,this.activeDisableKinds)},this.manageItemDisable=(t,e,i)=>{if(this.checkLinkedConditionsFulfilled(i,t))return;let n=this.createArrayResult(i,t);for(let t in n){let i=n[t];i&&this.addDisableClassToItem(e[0],i)}},this.checkRequires=(t,e)=>{if(this.checkLinkedConditionsFulfilled(e,t))return!0;let i=this.createArrayResult(e,t);for(let t in i)if(i[t])return!0;return!1},this.createArrayResult=(t,e)=>{let i=[];return i.push(this.checkShops(t,e)),i.push(this.checkStats(t,e)),i.push(this.checkStats(t,e,!1)),i.push(this.checkExpires(t,e)),i.push(this.checkClass(t,e)),i.push(this.checkClass(t,e,!1)),i.push(this.checkEq(t,e)),i.push(this.checkTpl(t,e)),i},this.checkShops=(t,e)=>{if(t[Engine.itemsDisableData.SHOP]){if(this.checkShopItemShouldBeDisable(e))return Engine.itemsDisableData.SHOP}return!1},this.checkStats=function(e,i){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];for(let a in e){if(!t.checkDisableKindExist(a))return!1;if(a==Engine.itemsDisableData.SHOP&&t.isOnlyBuyShop())continue;let e=n?t.allDisableItemStats[a]:t.allAllowItemStats[a];for(let s=0;s<e.length;s++){let r=e[s];if(!(!t.statCheckCanDisabled(i,r)&&n||t.statCheckCanDisabled(i,r)&&!n))return a}}return!1},this.statCheckCanDisabled=(t,e)=>{if("object"==typeof e)for(const i in e){if(!t.haveStat(i))return!0;{const[n,a]=e[i],s=t._cachedStats[i];if(count(n,s,a))return!0}}else if(t.haveStat(e))return!0;return!1},this.checkClass=function(e,i){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];for(let a in e){if(!t.checkDisableItemClassNameExist(a))return!1;let e=n?t.allDisableItemClass[a]:t.allAllowItemClass[a];if((a!=Engine.itemsDisableData.SHOP||!t.isOnlyBuyShop())&&(e.length&&(e.indexOf(i.cl)>-1&&n||-1===e.indexOf(i.cl)&&!n)))return a}return!1},this.checkExpires=(t,e)=>{for(let i in t){if(!this.checkDisableItemClassNameExist(i))return!1;let t=this.disableExpiresStat[i];if(i==Engine.itemsDisableData.SHOP&&this.isOnlyBuyShop())continue;if(null==t)continue;if(!e.haveStat("expires"))continue;let n=e.checkExpires();switch(t){case null:break;case!0:if(n)return i;break;case!1:if(!n)return i;break;case"all":return i;default:return console.error("[DisableItemsManager.js, checkExpires] BAD TYPE EXPIRES OPTION",t),!1}}return!1},this.checkEq=(t,e)=>{for(let i in t){if(!this.checkDisableKindExist(i))return!1;if(null!==this.disableEq[i]&&(!n.isInBagSt(e.st)&&this.disableEq[i]))return i}return!1},this.createResultItemData=(t,e)=>({itemView:t[0],disableKind:e}),this.checkTpl=(t,e)=>{for(let i in t)if(null!=this.allEnableTpl[i]&&!this.allEnableTpl[i].includes(e.tpl))return i;return!1},this.checkLinkedConditionsFulfilled=(t,e)=>{for(let i in t)if(null!=this.enableLinkedConditions[i])for(let t in this.enableLinkedConditions[i]){let n=this.enableLinkedConditions[i][t];if(this.checkOneLinkedRecord(n,e))return!0}return!1},this.checkOneLinkedRecord=(t,e)=>{let i=[];if(t.stats){let n=[];for(let i=0;i<t.stats.length;i++){let a=t.stats[i];n.push(this.statCheckCanDisabled(e,a))}let a=this.checkIsArrayWithAllTheSameVal(n,!0);i.push(a)}return t.classes&&i.push(t.classes.includes(e.cl)),this.checkIsArrayWithAllTheSameVal(i,!0)},this.checkIsArrayWithAllTheSameVal=(t,e)=>t.every(t=>t==e),this.getEnabledItems=()=>{const t=Engine.heroEquipment.getHItems(),e=this.getAllDisabledItemsArray();return Object.keys(t).map(Number).filter(t=>!e.includes(t))},this.startSpecificItemKindDisable=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.checkDisableKindExist(e))return;t.addToActiveDisableKinds(e);let n=Engine.heroEquipment.getHItems();i.enableTplArray&&t.addToEnableTplByKind(e,i.enableTplArray),i.linkedConditions&&t.addToLinkedConditions(e,i.linkedConditions);for(let e in n){let i=Engine.items.getAllViewsByIdAndViewName(e,Engine.itemsViewData.BAG_VIEW);if(!i.length)return console.warn("[DisableItemsManager.js, startSpecificItemKindDisable] $view not find",e);t.manageItemDisable(n[e],i,t.activeDisableKinds)}},this.endSpecificItemKindDisable=t=>{this.checkDisableKindExist(t)&&(this.removeFromActiveDisableKinds(t),this.removeFromEnableTpl(t),this.removeFromLinkedConditions(t),this.removeFromDisableItems(t),this.manageOfDeleteDisableItemMarkClass(t))},this.manageOfDeleteDisableItemMarkClass=t=>{let e=t+"-disable",i=$("."+e),n=this;i.removeClass(e),i.each((function(){for(let t=0;t<n.allKinds.length;t++){let e=n.allKinds[t];if($(this).hasClass(e+"-disable"))return}$(this).removeClass("disable-item-mark"),n.removeDisableIcon($(this))}))},this.addToEnableTplByKind=(t,e)=>{this.allEnableTpl[t]=e},this.removeFromEnableTpl=t=>{this.allEnableTpl[t]=null},this.addToLinkedConditions=(t,e)=>{this.enableLinkedConditions[t]=e},this.removeFromLinkedConditions=t=>{this.enableLinkedConditions[t]=null},this.checkDisableKindExist=t=>!!this.allDisableItemStats[t]||(console.error("[DisableItemsManager.js, checkDisableKindExist] Bad disable kind!!! ",t),!1),this.checkDisableItemClassNameExist=t=>!!this.allDisableItemClass[t]||(console.error("[DisableItemsManager.js, checkDisableItemClassNameExist] Bad disable ItemClass!!! ",t),!1)}},function(t,e,i){var n=i(0);t.exports=function(){this.list=null,this.observeMax=null,this.init=()=>{this.list={},this.initWindow(),this.initMargin()},this.initWindow=function(){Engine.windowManager.add({content:n.get("quest-observe-window"),title:_t("quests-h",null,"help"),nameWindow:Engine.windowsData.name.QUEST_OBSERVE,objParent:this,nameRefInParent:"wnd",type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,managePosition:{x:"251",y:"60"},closeable:!1,onclose:()=>{this.managePanelVisible()}}),this.wnd.addToAlertLayer(),this.wnd.updatePos()},this.initMargin=function(){this.wnd.$.find(".content").css({"margin-top":"-12px","margin-left":"-23px","margin-right":"-23px","margin-bottom":"-20px"})},this.openPanel=()=>{this.wnd.$.css("display","block"),this.wnd.show(),this.wnd.setWndOnPeak(),this.updateScroll()},this.closePanel=()=>{this.wnd.hide()},this.updateScroll=()=>{$(".scroll-wrapper",this.wnd.$).trigger("update")},this.checkCanObserve=()=>!(Object.keys(this.list).length>=this.observeMax)||(mAlert(_t("can_not_observe_more")),!1),this.getSortData=t=>{let e=[],i={};for(let e in t){i[t[e]]=e}for(let t in i)e.push(parseInt(t));e.sort((function(t,e){return t-e}));for(let t=0;t<e.length;t++){let n=e[t];e[t]=i[n]}return e},this.update=t=>{this.observeMax=t.max;let e=this.getSortData(t.ids_numbers),i=JSON.parse(JSON.stringify(this.list));this.list={};let n=[],a=[];for(let t=0;t<e.length;t++){let a=e[t];this.list[a]=!0,i[a]?delete i[a]:n.push(a)}for(let t in i)a.push(t);this.setStatesOfObserveInQuestLog(n,!0),this.setStatesOfObserveInQuestLog(a,!1),n.length<1&&this.setStatesOfObserveInQuestLog(Object.keys(this.list),!0);for(let t of n)this.createOneQuestObserve(t);for(let t of a)this.deleteOneObserveQuest(t);this.manageEmpty()},this.setStatesOfObserveInQuestLog=(t,e)=>{for(let i of t)Engine.quests.setStateOfObserveOnButton(i,e)},this.createOneQuestObserve=(t,e)=>{let i=Engine.quests.getQuestData(t),a=n.get("one-quest-observe").addClass("quest-observe-"+t);if(a.find(".title").html(i.title),a.find(".quest-content").html(i.content.clone()),a.find(".delete-observe-btn").click((function(){Engine.quests.removeObserve(t)})).tip(_t("detach_from_observe")),e){let e=this.wnd.$.find(".scroll-pane").find(".quest-observe-"+t);if(!e.length)return void console.warn("[QuestObserve.js, createOneQuestObserve] $replaceWith not exist! Id: ",t);e.replaceWith(a)}else this.wnd.$.find(".scroll-pane").find(".quest-observe-list").append(a)},this.updateOneQuestObserve=t=>{this.list[t]&&(this.setStatesOfObserveInQuestLog([t],!0),this.createOneQuestObserve(t,!0))},this.deleteOneObserveQuest=t=>{this.wnd.$.find(".scroll-pane").find(".quest-observe-"+t).remove()},this.manageEmpty=()=>{let t=this.wnd.$.find(".empty"),e=this.wnd.$.find(".quest-observe-list").children().length?"none":"block";t.css("display",e),this.wnd.$.find(".quest-observe-list").children().length?this.openPanel():this.closePanel()}}},function(t,e,i){var n=i(5),a=i(12);t.exports=function(){this.init=()=>{},this.onRequest=(t,e)=>{if(("_"!==t||isset(e.item))&&isEn()){var i=new URLSearchParams("t="+t);switch(i.get("t")){case"creditshop":this.send("premiumShop","enter","Enter to the premium shop");break;case"shop":if(i.get("buy")){if(!e.item||!Engine.shop.wnd||!Engine.shop.wnd.$.find(".shop-content").hasClass("normal-shop-sl")&&!Engine.shop.wnd.$.find(".shop-content").hasClass("pet-shop-sl"))return;for(var s=i.get("buy").split(";"),r=0;r<s.length;r++){var o=s[r].split(","),l=o[0],c=o[1],d=Engine.tpls.getTplByIdAndLoc(l,"n"),h=d.name,u=d.pr*c;this.send("premiumShop","purchase","Premium Purchase: "+c+" x "+h,u)}}break;case"talk":3877==Engine.map.d.id&&(113018==i.get("id")&&"q.696.55"==i.get("c")&&this.send("tutorial","skipped","Tutorial skipped"),113018==i.get("id")&&"q.696.42"==i.get("c")&&e.item&&(this.send("tutorial","playerDead","Player has gotten crafting items"),n.set("tutorialCraftingStartTime",Date.now())),113074==i.get("id")&&"q.696.51"==i.get("c")&&this.send("tutorial","Complete","tutorial-10-april-2019")),3881==Engine.map.d.id&&(113386!=i.get("id")&&113387!=i.get("id")||"1.1"!=i.get("c")||this.send("tutorial","playerHealed","[Forest Retreat] Player has been healed by NPC."));break;case"init":if(3877==Engine.map.d.id&&4==i.get("initlvl")&&e.dead){var p=Object.keys(e.f.w)[1],g=e.f.w[p].name;this.send("tutorial","playerDead","Player has been killed by "+g)}break;case"fight":if(3877==Engine.map.d.id)return;break;case"craft":if(3877==Engine.map.d.id&&"use"==i.get("a")&&e.item){this.send("tutorial","craft","Player has crafted an item");var f=n.get("tutorialCraftingStartTime");if(f){let t=(Date.now()-f)/1e3,e=(t/60).toFixed(1);this.send("tutorial","craft",`Player has crafted an item in ${e}min (${t.toFixed(1)}s)`)}}break;case"moveitem":3877==Engine.map.d.id&&e.msg&&e.msg[0].includes("You have learned recipe")&&this.send("tutorial","craft","Player has learned recipe");break;case"_":if(isset(e.item)&&1==Engine.map.d.id&&isset(e.msg)&&e.msg[0].includes("You are now under a spell:"))for(let t in e.item){const i=e.item[t];if(i.hasOwnProperty("st")&&a.isBlessSt(i.st)&&this.watchedItems.includes(i.name)){const t="Cooldown"!==i.name?"[Blessed Shrine] Player has drawn BLESS":"[Blessed Shrine] Player has removed the blessing (Cooldown).";this.send("tutorial","playerBlessed",t)}}}}},this.send=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";ma.trackEvent(t,e,i,n)},this.watchedItems=["Blessing of Adventure","Blessing of Deadly Strikes","Blessing of Defense","Blessing of Divine Favor","Blessing of Knowledge","Blessing of Magical Prowess","Blessing of Nimbleness","Blessing of Obstacle","Blessing of Perception","Blessing of Soul","Blessing of Swiftness","Blessing of Vigor","Blessing of Vitality","Enchanted Blessing of Adventure","Enchanted Blessing of Deadly Strikes","Enchanted Blessing of Defense","Enchanted Blessing of Divine Favor","Enchanted Blessing of Knowledge","Enchanted Blessing of Magical Prowess","Enchanted Blessing of Nimbleness","Enchanted Blessing of Obstacle","Enchanted Blessing of Perception","Enchanted Blessing of Soul","Enchanted Blessing of Swiftness","Enchanted Blessing of Vigor","Enchanted Blessing of Vitality","Greater Blessing of Adventure","Greater Blessing of Deadly Strikes","Greater Blessing of Defense","Greater Blessing of Divine Favor","Greater Blessing of Knowledge","Greater Blessing of Magical Prowess","Greater Blessing of Nimbleness","Greater Blessing of Obstacle","Greater Blessing of Perception","Greater Blessing of Soul","Greater Blessing of Swiftness","Greater Blessing of Vigor","Greater Blessing of Vitality","Lesser Blessing of Adventure","Lesser Blessing of Deadly Strikes","Lesser Blessing of Defense","Lesser Blessing of Divine Favor","Lesser Blessing of Knowledge","Lesser Blessing of Magical Prowess","Lesser Blessing of Nimbleness","Lesser Blessing of Obstacle","Lesser Blessing of Perception","Lesser Blessing of Soul","Lesser Blessing of Swiftness","Lesser Blessing of Vigor","Lesser Blessing of Vitality","Cooldown"]}},function(t,e,i){let n=i(443),a=i(444),s=i(445);var r=i(446);let o=i(12);var l=i(8);t.exports=function(){let t=this;const e="TutorialManager.js";this.list={},this.externalList={[CFG.LANG.PL]:{},[CFG.LANG.EN]:{}},this.plData=null,this.enData=null,this.oneSend=!1,this.idToStartAfterInterfaceLoad=[],this.init=()=>{this.plData=new a,this.plData.init(),this.enData=new s,this.enData.init(),this.test()},this.test=()=>{this.testHeader(Engine.tutorialManager.list.en),this.testHeader(Engine.tutorialManager.list.pl),this.testText(Engine.tutorialManager.list.en),this.testText(Engine.tutorialManager.list.pl),this.testAvailableTutorialId(Engine.tutorialManager.list.en),this.testAvailableTutorialId(Engine.tutorialManager.list.pl)},this.literatGetAllHeadersName=()=>{let t=Engine.tutorialManager.list.pl,e="";for(let i in t)e+="id: "+i+" "+_t(t[i][0].headerPc,null,"new_tutorials")+"\n";return e},this.literatGetHeadersNameOfDoneTutorialStepByBits=t=>{let e=Engine.tutorialManager.list[_l()],i="\n";for(let n in e)if(this.bitIsSet(t,n)){i+=n+"| "+(53==n?"Witaj w Margonem!":_t(e[n][0].headerPc,null,"new_tutorials"))+";\n"}return i},this.literatGetRaportAllHeadersName=()=>{let t=Engine.tutorialManager.list[_l()],e="";for(let i in t){e+=i+"| "+(53==i?"Witaj w Margonem!":_t(t[i][0].headerPc,null,"new_tutorials"))+";\n"}return e},this.testAvailableTutorialId=t=>{if(t.hasOwnProperty("0"))return console.error("Tutorial id must be more than 0!");for(let e in t){if(isNaN(parseInt(e)))return console.error("Tutorial id must be integer!",e);if(e>53)return console.error("Tutorial id more than 53 is forbidden! Incorrect id:",e)}},this.testHeader=t=>{for(let e in t){let i=t[e][0];if(!i.hasOwnProperty("headerPc"))return console.error("tutorialStep:",e,"has not headerPc!");if(!i.hasOwnProperty("headerMobile"))return console.error("tutorialStep:",e,"has not headerMobile!")}},this.testText=t=>{for(let e in t){let i=t[e][0];if(!i.hasOwnProperty("textPc"))return console.error("tutorialStep:",e,"has not textPc!");if(!i.hasOwnProperty("textMobile"))return console.error("tutorialStep:",e,"has not textMobile!")}},this.bitIsSet=(t,e)=>r(t).and(r(2).pow(e-1))>0,this.setBit=(t,e)=>r(t).or(r(2).pow(e-1)),this.safariBigIntOr=(t,e)=>{console.log(r(t).or(e))},this.OLDbitIsSet=(t,e)=>{let i=BigInt(t),n=BigInt(e);return parseInt((i&BigInt(1)<<n-BigInt(1)).toString())},this.OLDsetBit=(t,e)=>{let i=BigInt(t),n=BigInt(e);i|=BigInt(1)<<n-BigInt(1);let a=parseInt(i.toString());return console.log(a),a},this.getItemByClass=(t,e,i)=>{let n=JSON.parse(JSON.stringify(e)),a=[],s=!0,r=!0;for(let e in t){let l=t[e],c=l.cl;if(!n.hasOwnProperty(c))continue;if(l.loc!=n[c].loc)continue;if(n[c].hasOwnProperty("tpl")&&n[c].tpl!=l.getTpl())continue;let d=!1;if(i){let t=null,e=null,n=null;i.hasOwnProperty("inUse")&&(t=!1,(i.inUse&&o.isEquippedSt(l.st)||!i.inUse&&o.isInBagSt(l.st))&&(t=!0)),i.hasOwnProperty("minOneOfAllNotEquip")&&(t=!0,o.isInBagSt(l.st)&&(s=!1)),i.hasOwnProperty("haveOneOfAllAndAllNotEquip")&&(t=!0,o.isInBagSt(l.st)||(r=!1)),i.stats&&(n=!1,this.checkFulfillStatsInItem(l,i.stats)&&(n=!0)),d=this.addManage([t,e,n])}else d=!0;if(d&&(a.push(l),n[c].hasOwnProperty("amount")?(n[c].amount--,n[c].amount<1&&delete n[c]):delete n[c]),i&&i.hasOwnProperty("minOneOfAllNotEquip")&&!Object.keys(n).length)return!s&&a;if(!Object.keys(n).length)return i&&i.hasOwnProperty("haveOneOfAllAndAllNotEquip")?!!r&&a:a}return!!(i&&i.hasOwnProperty("haveOneOfAllAndAllNotEquip")&&a.length)&&(!!r&&a)},this.addManage=t=>{let e=[];for(let i=0;i<t.length;i++){let n=t[i];null!==n&&e.push(n)}return!(e.indexOf(!1)>-1)},this.checkFulfillStatsInItem=(t,e)=>{let i=this.copyObject(e);for(let e in i){let n=!1;if(t._cachedStats.hasOwnProperty(e)){if(!0===i[e])n=!0;else{let a=i[e][0],s=i[e][1],r=parseInt(s),o=parseInt(t._cachedStats[e]);switch(a){case">=":o>=r&&(n=!0);break;case"<=":o<=r&&(n=!0);break;case l.STAT_OPERATION.NUMBER_EQUAL:o==r&&(n=!0);break;case l.STAT_OPERATION.STRING_EQUAL:t._cachedStats[e]==s&&(n=!0);break;default:console.warn("[TutorialManager.js, checkFulfillStatsInItem] Unsupported compare type:",a)}}n&&delete i[e]}}return!Object.keys(i).length},this.copyObject=t=>{let e={};for(let i in t)e[i]=t[i];return e},this.checkHasQuest=t=>Engine.quests.getQuestData(t),this.checkMinLevel=t=>Engine.hero.d.lvl>=t,this.checkMaxLevel=t=>Engine.hero.d.lvl<=t,this.checkMap=t=>t.indexOf(Engine.map.d.id)>-1,this.needItemsTest=t=>{if(!t.itemsNeed)return!0;let e=t.itemsNeed,i=null,n=null,a={};if(e.items&&(i=e.items[Engine.hero.d.prof],n=Engine.items.test().items),e.tpls){i=e.tpls[Engine.hero.d.prof];let t=getFirstElementInObject(i);if(n=Engine.tpls.test().tpls[t.loc],null==n)return!1}if(null==n)return errorReport("TutorialManager.js","needItemsTest","iNeed have not attr iNeed.items or iNeed.tpls!",e),!1;e.hasOwnProperty("minOneOfAllNotEquip")&&(a.minOneOfAllNotEquip=!0),e.hasOwnProperty("haveOneOfAllAndAllNotEquip")&&(a.haveOneOfAllAndAllNotEquip=!0),e.hasOwnProperty("inUse")&&(a.inUse=e.inUse),e.hasOwnProperty("stats")&&(a.stats=e.stats);let s=!!Object.keys(a).length&&a;return this.getItemByClass(n,i,s)},this.getTutorialNeedItems=()=>{let t=Engine.tutorials.getActive();return this.getDataFromList(t).itemsNeed},this.checkUseItemIsRightWithTutorialItemsNeed=t=>{let e=Engine.tutorials.getActive(),i=this.getDataFromList(e),n=Engine.hero.d.prof,a=i.itemsNeed.items[n],s=!1,r=t.tpl;for(let t in a)if(a[t].tpl){if(a[t].tpl==r)return!0;s=!0}return!s},this.checkBlockHotKeys=t=>{if(!Engine.tutorials)return!1;let e=this.getDataFromList(Engine.tutorials.active);return!!e.blockedHotKeys&&(!!e.blockedHotKeys.includes(t)&&(message(_t("hotkey_forbidden")),!0))},this.checkBlockWidgets=t=>{if(!Engine.tutorials)return!1;let e=this.getDataFromList(Engine.tutorials.active);return!!e.blockedWidget&&(!!e.blockedWidget.includes(t)&&(message(_t("widget_forbidden")),!0))},this.checkFullFillFromList=(t,e,i)=>{let n=i||this.getDataFromList(t);if(n.idMaps&&!this.checkMap(n.idMaps))return!1;if(n.itemsNeed&&!this.needItemsTest(n))return!1;if(n.canvasFocus){let t=n.canvasFocus.id;if(n.canvasFocus.typeObject==l.TYPE_OBJECT.NPC&&!Engine.npcs.getById(t))return!1}if(n.canvasMultiGlow){let t=n.canvasMultiGlow.objects[0];if(t.type==l.TYPE_OBJECT.NPC&&!Engine.npcs.getById(t.id))return!1}return!(n.hasQuestId&&!this.checkHasQuest(n.hasQuestId))&&(!(n.minLevel&&!this.checkMinLevel(n.minLevel))&&(!(n.maxLevel&&!this.checkMaxLevel(n.maxLevel))&&!(n.additionalRequireFunction&&!n.additionalRequireFunction(t,e))))},this.checkFullFillInterfaceRequire=(t,e,i)=>this.checkFullFillFromList(t,e,i),this.checkIsSameNpc=(t,e)=>t.idNpc==e,this.getDataFromList=t=>{let e=_l();return this.list[e][t]?this.list[e][t][0]:this.externalList[e][t]?this.externalList[e][t][0]:(errorReport("TutorialManager.js","getDataFromList",`id ${t} not exist!`,this.list),errorReport("TutorialManager.js","getDataFromList",`id ${t} not exist!`,this.externalList),{})},this.itemIsLootbox=t=>t._cachedStats.lootbox,this.getSelectorsFromNeedItems=(t,e)=>{let i=Engine.tutorialManager.needItemsTest(t);for(let t=0;t<i.length;t++)e.push(".item-id-"+i[t].id)},this.itemsInBasket=t=>{let e=this.getDataFromList(t),i=[];if(this.getSelectorsFromNeedItems(e,i),!i.length)return!1;let n=Engine.shop.wnd.$.find(".buy-items");for(let t=0;t<i.length;t++)if(!n.find(i[t]).length)return!1;return!0},this.checkIsMoveTutorial=()=>!(1!==Engine.tutorials.active)&&(!this.oneSend&&(this.oneSend=!0,!0)),this.idExist=t=>{for(let e=0;e<this.idToStartAfterInterfaceLoad.length;e++)if(this.idToStartAfterInterfaceLoad[e].id==t)return!0;return!1},this.tutorialStart=function(t,e,i,a){if(_l()==t&&(Engine.tutorials&&Engine.tutorials.active==e&&Engine.tutorials.refreshViewOfTutorialStep(),a||!this.bitIsSet(Engine.tutorialValue,e)))if(a||Engine.interface.alreadyInitialised)this.checkFullFillInterfaceRequire(e,i,a)&&(Engine.tutorials||(Engine.tutorials=new n),Engine.tutorials.create(e,a));else if(!this.idExist(e)){let t={lang:_l(),id:e,data:i};this.idToStartAfterInterfaceLoad.push(t)}},this.startAfterInterfaceLoad=()=>{for(let t=0;t<this.idToStartAfterInterfaceLoad.length;t++){let e=this.idToStartAfterInterfaceLoad[t];this.tutorialStart(e.lang,e.id,e.data,isset(e.externalData)?e.externalData:null)}},this.startTutorialFromRayController=t=>{if(!Engine.rajCase.checkFullFillCase(t.case))return;let i=_l(),n=t.id;!isInt(n)||n>-1?errorReport(e,"startTutorialFromRayController","only negative number is correct for id!",t):this.externalList[i][n]||this.checkPreventRepeatExist(t)&&!this.checkCanAddToExternalList(t)||(this.externalList[i][n]=[t],Engine.tutorialManager.tutorialStart(i,n,null,t))},this.checkPreventRepeatExist=t=>!!t.preventRepeat&&!!t.preventRepeat.name,this.checkCanAddToExternalList=t=>{if(!this.checkPreventRepeatExist(t))return!0;let e=_l();for(let i in this.externalList[e]){let n=this.externalList[e][i][0];if(this.checkPreventRepeatExist(n)&&this.checkPreventRepeatNameSame(t,n))return!1}return!0},this.checkPreventRepeatNameSame=(t,e)=>t.preventRepeat.name==e.preventRepeat.name,this.checkCanFinishExternalAndFinish=t=>{if(!Engine.tutorials)return;let e=Engine.tutorials.getActive(),n=this.externalList[_l()],a=n[e];if(!n[e])return;let s=i(a,t,e);if(s.result&&(Engine.tutorials.finishTutorial(),delete n[e],this.checkOnFinishExternalProperties(a))){if(s.kind==l.ON_FINISH_TYPE.BREAK)return;this.callOnFinishExternalProperties(a)}},this.checkOnFinishExternalProperties=t=>!!t[0].onFinish.external_properties,this.callOnFinishExternalProperties=t=>{let e=t[0].onFinish.external_properties;Engine.rajController.parseObject(e)};const i=(t,e,i)=>{let n=t[0].onFinish;if(!n)return errorReport("TutorialManager.js","checkExternalFinish","onFinish not exist :O",t),message("LOOK TO CONSOLE!"),{result:!1,kind:"SYSTEM"};let a=n[l.ON_FINISH_TYPE.REQUIRE],s=n[l.ON_FINISH_TYPE.ABSOLUTE_FINISH],r=n[l.ON_FINISH_TYPE.BREAK];if(!a)return errorReport("TutorialManager.js","checkExternalFinish","onFinish.require not exist :O",t),message("LOOK TO CONSOLE!"),{result:!1,kind:"SYSTEM"};if(r&&e.type==l.ON_FINISH_TYPE.BREAK)for(let t=0;t<r.length;t++){if(r[t]==e.name)return{result:!0,kind:l.ON_FINISH_TYPE.BREAK}}if(s&&e.type==l.ON_FINISH_TYPE.ABSOLUTE_FINISH)for(let t=0;t<s.length;t++){if(s[t]==e.name)return{result:!0,kind:l.ON_FINISH_TYPE.ABSOLUTE_FINISH}}for(let t=0;t<a.length;t++){let n=a[t];n[e.name]&&(c(n,e,i)&&(a.splice(t,1),t--))}return{result:!a.length,kind:l.ON_FINISH_TYPE.REQUIRE}};this.createTutorialDataTrigger=(t,e,i)=>({name:t,type:e,[t]:i});const c=(e,i,n)=>{const a=l.ON_FINISH_REQUIRE,s=a.USE_ITEM_TPL,r=a.TALK_NPC_ID,o=a.CLICK_RECIPE_ON_LIST,c=a.CLICK_BARTER_OFFER_ON_LIST,d=a.USE_RECIPE,h=a.USE_BARTER_OFFER,u=a.ATTACK_NPC_ID,p=a.USE_BATTLE_SKILL,g=a.CLICK_WIDGET,f=a.OPEN_WINDOW;switch(i.name){case s:return e[s].includes(i[s]);case r:return e[r]==i[r];case o:return e[o]==i[o];case c:return e[c]==i[c];case d:return e[d]==i[d];case h:return e[h]==i[h];case u:return e[u]==i[u];case p:return e[p]==i[p];case g:return e[g]==i[g];case f:return e[f]==i[f];case a.ITEMS_IN_BASKET:return t.itemsInBasket(n);case a.MOVE_REQUIRE:case a.HERO_LEAVE_BATTLE_BUTTON_OR_HOTKEY:case a.ACCEPT_BASKET:return!0;default:return errorReport("TargetsManager.js","checkExternalTutorialRequireFinish","tutorialFinishRequireName not exist!",i.name),!1}};this.onClear=()=>{this.externalList[CFG.LANG.PL]={},this.externalList[CFG.LANG.EN]={}},this.checkCanFinishAndFinish=(t,e,i)=>{if(_l()==t&&Engine.tutorials&&Engine.tutorials.active==e){switch(t){case CFG.LANG.PL:if(!this.plData.checkCanFinish(e,i))return;break;case CFG.LANG.EN:if(!this.enData.checkCanFinish(e,i))return;break;default:return void console.warn("[TutorialManager.js, checkCanFinishAndFinish] Lang: "+t+" not supported!")}Engine.tutorials.finishTutorial()}}}},function(t,e,i){var n=i(0);t.exports=function(){this.active=null,this.activeStep=null,this.queue=[],this.content=null,this.interval=null,this.$blinkObj=null,this.focusCollider=null;var t=this;let e=null;this.list=Engine.tutorialManager.list,this.getActiveStepData=()=>e||t.list[_l()][this.active][this.activeStep];this.create=function(t,i){console.log("CHECK TUTORIAL_START !!!!!!!!!!!!!",t),this.setVariables(t,i)||(i&&(t=>{e=t})(i),console.log("tutorialStart !!!!!!!!!!!!!",t),this.requestRemoveCloud(),this.addAdditionalFunctionBeforeCreate(),this.initWindow(),this.initMargin(),this.addButts(),this.canvasFocus(),this.changeNameBut(),this.setHeader(),this.setText(),this.setGraphic(),this.setExternalProperties(),this.blink(),this.htmlFocus(),this.canvasMultiGlow(),this.htmlMultiGlow(),this.setPosition(),this.doCallback(),this.addClick(),this.addAdditionalFunctionAfterCreate())},this.initMargin=function(){this.wnd.$.find(".content").css({"margin-top":"-12px","margin-left":"-23px","margin-right":"-23px","margin-bottom":"-20px"})},this.addAdditionalFunctionBeforeCreate=()=>{let t=this.getActiveStepData().additionalFunctionBeforeCreate;t&&t()},this.addAdditionalFunctionAfterCreate=()=>{let t=this.getActiveStepData().additionalFunctionAfterCreate;t&&t()},this.canvasFocus=()=>{let t=this.getActiveStepData().canvasFocus,e=this.getActiveStepData().blink;t&&this.checkCanvasDataIsCorrect(t)&&(Engine.htmlFocus.create(Engine.interface.get$gameLayer(),!1,!1),"onlyCanvas"!=t.typeObject&&Engine.canvasFocus.addOverlayAndTarget(t,e))},this.checkCanvasDataIsCorrect=t=>{if(!t.hasOwnProperty("typeObject"))return console.warn('[Tutorial.js, checkCanvasDataIsCorrect] Not exist "typeObject" property in canvasFocus'),!1;switch(t.typeObject){case"onlyCanvas":case"hero":return!0;case"npc":return!!t.hasOwnProperty("id")||(console.warn('[Tutorial.js, checkCanvasDataIsCorrect] Not exist "id" property in canvasFocus'),!1);default:return console.warn('[Tutorial.js, checkCanvasDataIsCorrect] bad "typeObject" property: ',t.typeObject),!1}},this.addClick=function(){let e=t.getActiveStepData().click;if(!e)return;t.wnd.$.find(".click-area").css("display","block");let i=n.get("button").addClass("small green");i.find(".label").html(e.txt),t.wnd.$.find(".click-area").append(i),i.click(e.clb)},this.initWindow=()=>{this.content=n.get("tutorial");let t={content:this.content,nameWindow:Engine.windowsData.name.TUTORIAL_CLOUD,objParent:this,nameRefInParent:"wnd",type:Engine.windowsData.type.TRANSPARENT,closeable:!1,onclose:()=>{this.skipTutorial()}};!1===this.getActiveStepData().draggableWnd&&(t.draggable=!1),Engine.windowManager.add(t),this.wnd.hide(),this.wnd.addToTutorialLayer()},this.requestRemoveCloud=function(t){if(e)return;let i=t||this.active,n=Engine.tutorialManager.setBit(Engine.tutorialValue,i);_g("tutorial&opt="+n)},this.addButts=function(){this.content},this.setHeader=function(){let i=Engine.mobile?"headerMobile":"headerPc",n=null;e?n=e[i]?parseContentBB(e[i]):"none":(n=t.getActiveStepData()[i],n=n?_t(n,null,"new_tutorials"):"none"),t.wnd.title(n)},this.setText=function(){let i=Engine.mobile?"textMobile":"textPc",n=null;n=e?parseContentBB(e[i]):_t(t.getActiveStepData()[i],null,"new_tutorials"),this.content.find(".con").html(n)},this.setGraphic=function(){let e=t.getActiveStepData().graphic;if(!e||Engine.mobile)return;let i=this.content.find(".graphic-area"),n=$("<img>").attr("src",e).addClass("tutorial-graphic");i.css("display","block").append(n)},this.setExternalProperties=()=>{let e=t.getActiveStepData().external_properties;e&&Engine.rajController.parseObject(e,!1,{tutorialId:this.active})},this.setVariables=function(t,e){if(e)return null===this.active?(this.active=t,this.activeStep=0,!1):(this.addToQueue(t,e),!0);var i=Engine.tutorialValue,n=null!==i&&isset(this.list[_l()][t])&&null===this.active;let a=Engine.tutorialManager.bitIsSet(i,t);return n?a?(this.active=null,this.activeStep=null,this.closeTutorials(),!0):(this.active=t,void(this.activeStep=0)):(this.addToQueue(t),!0)},this.addToQueue=function(e,i){let n=i?Engine.tutorialManager.externalList:t.list;if(isset(n[_l()][e])){let t={id:e};i&&(t.externalData=i),this.queue.push(t)}},this.turnOffTutorial=function(){_g("tutorial&opt=-1"),t.queue=null,t.closeCloud()},this.skipTutorial=function(){t.requestRemoveCloud(),t.removeDomCloud()},this.blink=function(){var e="tutorial-border",i=t.getActiveStepData().blink;i&&(this.$blinkObj=$(i),this.interval=setInterval((function(){t.$blinkObj.hasClass(e)?t.$blinkObj.removeClass(e):t.$blinkObj.addClass(e)}),500))},this.getStyles=t=>{let e={};var i,n=t[0];if(window.getComputedStyle)i=window.getComputedStyle(n);else{if(!n.currentStyle)throw"shit browser";i=$.extend(!0,{},n.currentStyle)}for(let t in i)Number.isInteger(parseInt(t))||"length"!=t&&"z-index"!=t&&"zIndex"!=t&&""!=i[t]&&null!==i[t]&&"Function"!=i[t].constructor.name&&(e[t]=i[t]);return e},this.addItemToView=function(t,e,i){var n,a=t||e.data().item,s=a.id;n=a.isItem()?Engine.items.createViewIcon(s,Engine.itemsViewData.TIP_ITEM_VIEW)[0]:Engine.tpls.createViewIcon(s,Engine.itemsViewData.TIP_TPL_ITEM_VIEW,a.loc)[0],i.find(".item-head").prepend(n)},this.htmlFocus=()=>{let t=this.getActiveStepData().htmlFocus,e=this.getActiveStepData().blink;t&&Engine.htmlFocus.create($(t),!0,e)},this.canvasMultiGlow=()=>{let t=this.getActiveStepData().canvasMultiGlow,e=this.getActiveStepData().blink;t&&Engine.canvasMultiGlow.addMultiGlowTarget(t.objects,e)},this.htmlMultiGlow=()=>{let e=t.getActiveStepData(),i=e.htmlMultiGlow,n=this.getItemsMultiGlow(),a=e.blink;if(!i&&!n)return;let s=this.getArrayToMultiGlow(i,n);Engine.htmlMultiGlow.addMultiGlowTarget(s,a)},this.getItemsMultiGlow=()=>{let e=t.getActiveStepData();if(e.itemsNeed&&e.itemsNeed.htmlMultiGlow){if(e.itemsNeed.items)return e.itemsNeed.items;if(e.itemsNeed.tpls)return e.itemsNeed.tpls}return!1},this.getArrayToMultiGlow=(e,i)=>{let n=[];if(e)for(let t=0;t<e.length;t++)n.push(e[t]);if(i){let e=t.getActiveStepData();Engine.tutorialManager.getSelectorsFromNeedItems(e,n)}return n},this.findItemsInElementsAndChangeOnItemView=t=>{t.find(".item").each((function(){let t,e=$(this).data("item");t=e.isItem()?Engine.items.createViewIcon(e.id,Engine.itemsViewData.TUTORIAL_ITEM_VIEW)[0]:Engine.tpls.createViewIcon(e.id,Engine.itemsViewData.TUTORIAL_TPL_ITEM_VIEW,e.loc)[0],$(this).replaceWith(t)}))},this.findViewsInElementsAndRemove=function(t){t.find(".item").each((function(){let t=$(this).data("item");t.isItem()?Engine.items.deleteViewIconIfExist(t.id,Engine.itemsViewData.TUTORIAL_ITEM_VIEW):Engine.tpls.deleteViewIconIfExist(t.id,Engine.itemsViewData.TUTORIAL_TPL_ITEM_VIEW,t.loc)}))},this.setStyleInAllChildren=t=>{let e=t.clone(!0),i=[];this.prepareStyles(t,i),this.setStyles(e,i,[0]);let n=t.offset();return e.css({position:"fixed",left:n.left,top:n.top}),e},this.prepareStyles=(e,i)=>{let n=e.children();n.length&&n.each((function(){t.prepareStyles($(this),i)})),i.push(this.getStyles(e))},this.setStyles=(e,i,n)=>{let a=e.children();a.length&&a.each((function(){t.setStyles($(this),i,n)})),e.css(i[n[0]]),n[0]++},this.setPosition=()=>{let e=t.getActiveStepData().htmlPosition,i=t.getActiveStepData().htmlPositionOffset,n=t.getActiveStepData().canvasPosition;return e?this.setHtmlPosition(e,i):n?this.setCanvasPosition(n):(t.wnd.show(),void this.wnd.center())},this.setHtmlPosition=(e,i)=>{let n=$(e);if(!Engine.mobile){let t=Engine.tutorials.wnd.$.find(".graphic-area>img");if(t.length&&!t[0].complete)return void setTimeout(()=>{this.setHtmlPosition(e,i)},100)}if(!n.length)return;let a=n.offset(),s=n.width(),r=n.height();t.findPosition(s,r,a.left,a.top,n,i||null)},this.setCanvasPosition=function(e){let i;if(this.checkCanvasDataIsCorrect(e)){if(i=Engine.canvasFocus.getTargetFromTutorialData(e),!i)return t.wnd.show(),void console.warn("[Tutorial.js, setCanvasPosition] target in canvasFocus not exist!");this.setPositionCloudAfterCanvasObjectLoad(i)}},this.setPositionCloudAfterCanvasObjectLoad=e=>{e.imgLoaded&&Engine.map.getOffsetIsSet()?t.findPosition(e.fw,e.fh,32*(e.d.x-Engine.map.offset[0]/32)+Engine.interface.get$GAME_CANVAS().offset().left,32*(e.d.y-Engine.map.offset[1]/32)+Engine.interface.get$GAME_CANVAS().offset().top):setTimeout(()=>{this.setPositionCloudAfterCanvasObjectLoad(e)},500)},this.getShift=t=>{let e=0,i=0;return t&&(t.css("border-left-width")&&(e+=parseInt(t.css("border-left-width"))),t.css("border-right-width")&&(e+=parseInt(t.css("border-right-width"))),t.css("border-top-width")&&(i+=parseInt(t.css("border-top-width"))),t.css("border-bottom-width")&&(i+=parseInt(t.css("border-bottom-width")))),[e,i]},this.findPosition=(e,i,n,a,s,r)=>{let o=t.wnd.$,l=o.outerWidth(),c=o.outerHeight(),d=this.getShift(s),h=d[0],u=d[1],p=[[n+e+h+10,a+i+u+10],[n-l-10,a-c-10],[n+e+h+10,a-c-10],[n-l-10,a+i+u+10]],g=$(window).width(),f=$(window).height(),m=-1;for(let t=0;t<p.length;t++){let e=p[t][0],i=p[t][1],n=e+l,a=i+c;if(e>0&&i>0&&n<g&&a<f){m=t;break}}if(-1==m){let t=a+(i+u)/2-l/2;p=[[n-l-10,t],[n+e+h+10,t]];for(let t=0;t<p.length;t++){let e=p[t][0],i=e+l;if(e>0&&i<g){m=t;break}}}t.wnd.show(),o.css("left",p[m][0]+(r&&r.left?r.left:0)),o.css("top",p[m][1]+(r&&r.top?r.top:0))},this.onResize=()=>{this.refreshViewOfTutorialStep()},this.refreshViewOfTutorialStep=()=>{this.wnd&&(this.clearOverlay(),this.htmlFocus(),this.canvasFocus(),this.canvasMultiGlow(),this.htmlMultiGlow(),this.setPosition())},this.doCallback=function(){var e=t.getActiveStepData().callback;e&&e()},this.clearOverlay=()=>{Engine.canvasFocus.removeOverlayAndTarget(),Engine.htmlFocus.removeOverlayAndTarget(),Engine.canvasMultiGlow.removeMultiGlowTarget(),Engine.htmlMultiGlow.removeMultiGlowTarget()},this.clearClick=function(){t.wnd.$.find(".click-area").empty().css("display","none")},this.clearGraphic=function(){t.wnd.$.find(".graphic-area").empty().css("display","none")},this.clearBlink=function(){this.interval&&(clearInterval(this.interval),this.$blinkObj.removeClass("tutorial-border"),this.$blinkObj=null,this.interval=null)},this.changeNameBut=function(){if(!e){var i=t.list[_l()][t.active].length;if(t.activeStep==i-1){var n=this.tLang("finish");this.content.find(".finish-tutorial>.button>.label").html(n)}}},this.finishTutorial=function(){t.removeDomCloud()},this.removeDomCloud=function(){t.queue.length>=1?this.closeCloud(!0):this.closeCloud()},this.clearEvents=function(){this.clearOverlay(),this.clearBlink(),this.clearClick(),this.clearGraphic()},this.closeCloud=function(e){if(t.clearEvents(),t.wnd.remove(),t.active=null,t.activeStep=null,!e)return void t.closeTutorials();var i=t.getDataNextCloud();let n=i.externalData?i.externalData:null;t.create(i.id,n)},this.closeTutorials=function(){Engine.tutorials=!1},this.getDataNextCloud=function(){var e=t.queue[0];return this.queue.shift(),e},this.tLang=function(t){return _t(t,null,"tutorials")},this.createBtn=function(t,e,i){var a=n.get("button");return a.click(i),a.find(".label").html(t),e.append(a),a},this.getActive=()=>this.active}},function(t,e,i){var n=i(14),a=i(8),s=i(39);t.exports=function(){let t=this,e="eqcolumnshow";this.init=()=>{this.addPlDataToList()},this.attachSkipTutorial=()=>{$(".skip-tutorial-span").click((function(){Engine.tutorials.turnOffTutorial()}))},this.getQuestObserve=()=>".border-window:has(.content):has(.quest-observe-window)",this.checkAdditionalTutorialRequire2=t=>!Engine.tutorialManager.bitIsSet(Engine.tutorialValue,1),this.checkAdditionalTutorialRequire6=(t,e)=>0==parseInt(e.auto),this.checkAdditionalTutorialRequire18=t=>Engine.tutorialManager.itemsInBasket(17),this.checkAdditionalTutorialRequire19=t=>Engine.hero.d.warrior_stats.hp/Engine.hero.d.warrior_stats.maxhp<.5,this.checkAdditionalTutorialRequire22=(t,e)=>e._cachedStats.recipe,this.checkAdditionalTutorialRequire23=(t,e)=>$(".items-list>.divide-list-group>.group-list>.crafting-recipe-in-list.enabled").length,this.checkAdditionalTutorialRequire24=(t,e)=>Engine.crafting.recipes,this.checkAdditionalTutorialRequire25=(t,e)=>Engine.crafting.recipes,this.checkAdditionalTutorialRequire26=(t,e)=>Engine.crafting.recipes,this.checkAdditionalTutorialRequire27=(t,e)=>!$(".group-list>.offer-id-1616.disabled").length&&$(".barter-content>.bottom-row-panel>.do-recipe>.button.green").length,this.checkAdditionalTutorialRequire34=(t,e)=>!$(".group-list>.offer-id-1616.disabled").length,this.checkAdditionalTutorialRequire32=t=>Engine.tutorialManager.itemsInBasket(31),this.checkFullFill19=t=>Engine.hero.d.warrior_stats.hp/Engine.hero.d.warrior_stats.maxhp>.5,this.checkFullFill17=()=>{if(Engine.tutorialManager.itemsInBasket(17))return!0;let t={itemsNeed:{items:{[n.WARRIOR]:{1:{loc:"g",tpl:119},14:{loc:"g",tpl:72},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}},[n.PALADIN]:{1:{loc:"g",tpl:119},14:{loc:"g",tpl:72},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}},[n.HUNTER]:{4:{loc:"g",tpl:85},29:{loc:"g",tpl:658},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}},[n.TRACKER]:{4:{loc:"g",tpl:85},29:{loc:"g",tpl:658},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}},[n.BLADE_DANCER]:{1:{loc:"g",tpl:119},5:{loc:"g",tpl:28985},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}},[n.MAGE]:{6:{loc:"g",tpl:141},7:{loc:"g",tpl:25571},8:{loc:"g",tpl:34019},9:{loc:"g",tpl:66},10:{loc:"g",tpl:83}}}}};return Engine.tutorialManager.needItemsTest(t)},this.checkFullFill20=t=>{let e={itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{quest:[a.STAT_OPERATION.NUMBER_EQUAL,1723]}}};return Engine.tutorialManager.needItemsTest(e)},this.checkFullFill21=t=>t._cachedStats.recipe,this.checkFullFill23=t=>!t.hasClass("black"),this.checkFullFill34=()=>$(".offer-id-1616.mark-offer").length,this.checkCanFinish=(t,e)=>{let i=Engine.tutorialManager.getDataFromList(t);switch(t){case 53:case 0:return!0;case 1:return Engine.tutorialManager.checkIsMoveTutorial();case 2:return Engine.tutorialManager.checkIsSameNpc(e,i.canvasMultiGlow.objects[0].id);case 3:return Engine.tutorialManager.needItemsTest(Engine.tutorialManager.getDataFromList(4));case 4:return Engine.tutorialManager.checkIsSameNpc(e,i.canvasMultiGlow.objects[0].id);case 5:case 6:case 7:case 8:return!0;case 9:return Engine.tutorialManager.checkIsSameNpc(e,i.canvasMultiGlow.objects[0].id);case 10:return!0;case 11:return Engine.tutorialManager.itemIsLootbox(e);case 12:return!0;case 13:return Engine.tutorialManager.needItemsTest({itemsNeed:{items:{[n.WARRIOR]:{9:{loc:"g"}},[n.PALADIN]:{9:{loc:"g"}},[n.MAGE]:{9:{loc:"g"}},[n.TRACKER]:{9:{loc:"g"}},[n.HUNTER]:{9:{loc:"g"}},[n.BLADE_DANCER]:{9:{loc:"g"}}},inUse:!0,stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,5]}}});case 14:case 15:return!0;case 16:return Engine.tutorialManager.itemIsLootbox(e);case 17:return this.checkFullFill17();case 18:return!0;case 19:return this.checkFullFill19();case 20:return this.checkFullFill20();case 21:return this.checkFullFill21(e);case 22:return!0;case 23:return this.checkFullFill23(e);case 24:case 25:case 26:case 27:case 28:case 29:case 30:return!0;case 31:return Engine.tutorialManager.itemsInBasket(31);case 32:return!0;case 33:return Engine.tutorialManager.needItemsTest({itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{24:{loc:"g",amount:2}},[n.PALADIN]:{24:{loc:"g",amount:2}},[n.MAGE]:{24:{loc:"g",amount:2}},[n.TRACKER]:{24:{loc:"g",amount:2}},[n.HUNTER]:{24:{loc:"g",amount:2}},[n.BLADE_DANCER]:{24:{loc:"g",amount:2}}},inUse:!0}});case 34:return this.checkFullFill34(e);default:return console.log("not supported Finish tutorial... Yet..."),!1}},this.manageEqColumn=()=>{Engine.interface.checkEqColumnIsShow()||Engine.interface.clickEqColumnShow()},this.getNormalAttackIcon=()=>"icon-"+s.specificSkills.NORMAL_ATTACK_ID,this.addPlDataToList=()=>{Engine.tutorialManager.list.pl={53:[{textPc:"t_53_ni_pl",textMobile:"t_53_ni_pl",headerPc:"movement_header_ni",headerMobile:"mobile_53_tutorial",idMaps:[1456],graphic:"/img/gui/newTutorial/0.png",click:{txt:"Zaczynamy",clb:function(){Engine.tutorials.finishTutorial()}},additionalFunctionAfterCreate:t.attachSkipTutorial}],1:[{textPc:"t_1_ni_pl",textMobile:"t_1_ni_mobile_pl",headerPc:"t_header_1_ni_pl",headerMobile:"t_header_1_ni_pl",graphic:"/img/gui/newTutorial/6.gif",idMaps:[1456],htmlFocus:".echh-layer",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.HERO}]},blink:!0,canvasPosition:{typeObject:a.TYPE_OBJECT.HERO}}],2:[{textPc:"t_2_ni_pl",textMobile:"t_2_ni_mobile_pl",headerPc:"t_header_2_ni_pl",headerMobile:"t_header_2_ni_pl",graphic:"/img/gui/newTutorial/8.gif",htmlMultiGlow:[".widget-in-interface-bar.widget-npc-talk-icon"],canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:178339}]},canvasPosition:{typeObject:a.TYPE_OBJECT.NPC,id:178339},blink:!0,idMaps:[1456],additionalRequireFunction:t.checkAdditionalTutorialRequire2}],3:[{textPc:"t_3_ni_pl",textMobile:"t_3_ni_mobile_pl",headerPc:"t_header_3_ni_pl",headerMobile:"t_header_3_ni_pl",graphic:"/img/gui/newTutorial/4.gif",htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",htmlMultiGlow:[".character_wrapper>.equipment-wrapper>[data-st=5]",".character_wrapper>.equipment-wrapper>[data-st=7]"],blink:!0,idMaps:[1456],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{1:{loc:"g",tpl:10446},14:{loc:"g",tpl:10447}},[n.PALADIN]:{1:{loc:"g"},14:{loc:"g"}},[n.MAGE]:{6:{loc:"g"},7:{loc:"g"}},[n.TRACKER]:{4:{loc:"g"},29:{loc:"g"}},[n.HUNTER]:{4:{loc:"g"},29:{loc:"g"}},[n.BLADE_DANCER]:{1:{loc:"g"},5:{loc:"g"}}},minOneOfAllNotEquip:!0},blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],4:[{textPc:"t_4_ni_pl",textMobile:"t_4_ni_mobile_pl",headerPc:"t_header_4_ni_pl",headerMobile:"t_header_4_ni_pl",htmlPosition:t.getQuestObserve(),htmlMultiGlow:[t.getQuestObserve()],graphic:"/img/gui/newTutorial/8.gif",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:178339}]},blink:!0,idMaps:[1456],itemsNeed:{items:{[n.WARRIOR]:{1:{loc:"g"},14:{loc:"g"}},[n.PALADIN]:{1:{loc:"g"},14:{loc:"g"}},[n.MAGE]:{6:{loc:"g"},7:{loc:"g"}},[n.TRACKER]:{4:{loc:"g"},29:{loc:"g"}},[n.HUNTER]:{4:{loc:"g"},29:{loc:"g"}},[n.BLADE_DANCER]:{1:{loc:"g"},5:{loc:"g"}}},inUse:!0}}],5:[{textPc:"t_5_ni_pl",textMobile:"t_5_ni_mobile_pl",headerPc:"t_header_5_ni_pl",headerMobile:"t_header_5_ni_pl",graphic:"/img/gui/newTutorial/7.gif",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:178348}]},htmlPosition:".omg-tutorial-handler",hasQuestId:1761,idMaps:[1456],itemsNeed:{items:{[n.WARRIOR]:{1:{loc:"g"},14:{loc:"g"}},[n.PALADIN]:{1:{loc:"g"},14:{loc:"g"}},[n.MAGE]:{6:{loc:"g"},7:{loc:"g"}},[n.TRACKER]:{4:{loc:"g"},29:{loc:"g"}},[n.HUNTER]:{4:{loc:"g"},29:{loc:"g"}},[n.BLADE_DANCER]:{1:{loc:"g"},5:{loc:"g"}}},inUse:!0},blink:!0,blockedHotKeys:["autofightNearMob"],blockedWidget:["auto-fight-near-mob"],htmlMultiGlow:[".widget-button.widget-in-interface-bar.widget-attack-near-mob"]}],6:[{textPc:"t_6_ni_pl",textMobile:"t_6_ni_mobile_pl",headerPc:"t_header_6_ni_pl",headerMobile:"t_header_6_ni_pl",graphic:"/img/gui/newTutorial/5.gif",idMaps:[1456],htmlFocus:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",htmlPosition:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire6}],7:[{textPc:"t_7_ni_pl",textMobile:"t_7_ni_mobile_pl",headerPc:"t_header_7_ni_pl",headerMobile:"t_header_7_ni_pl",graphic:"/img/gui/newTutorial/5.gif",idMaps:[1456],htmlMultiGlow:[".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")"],htmlPosition:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",blink:!0}],8:[{textPc:"t_8_ni_pl",textMobile:"t_8_ni_mobile_pl",headerPc:"t_header_8_ni_pl",headerMobile:"t_header_8_ni_pl",graphic:"/img/gui/newTutorial/9.gif",htmlFocus:".close-battle-ground",htmlPosition:".close-battle-ground",idMaps:[1456],blink:!0}],9:[{textPc:"t_9_ni_pl",textMobile:"t_9_ni_mobile_pl",headerPc:"t_header_9_ni_pl",headerMobile:"t_header_9_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[1456],htmlPosition:t.getQuestObserve(),htmlMultiGlow:[t.getQuestObserve()],canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:178339}]},blink:!0}],10:[{textPc:"t_10_ni_pl",textMobile:"t_10_ni_mobile_pl",headerPc:"t_header_10_ni_pl",headerMobile:"t_header_10_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[1456],itemsNeed:{items:{[n.WARRIOR]:{19:{loc:"g"}},[n.PALADIN]:{19:{loc:"g"}},[n.MAGE]:{19:{loc:"g"}},[n.TRACKER]:{19:{loc:"g"}},[n.HUNTER]:{19:{loc:"g"}},[n.BLADE_DANCER]:{19:{loc:"g"}}}},htmlMultiGlow:[t.getQuestObserve()],canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:178358}]},htmlPosition:t.getQuestObserve(),blink:!0}],11:[{textPc:"t_11_ni_pl",textMobile:"t_11_ni_mobile_pl",headerPc:"t_header_11_ni_pl",headerMobile:"t_header_11_ni_pl",graphic:"/img/gui/newTutorial/4.gif",idMaps:[707],htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".inventory_wrapper>.inventory-grid-bg",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g",tpl:25356}},[n.PALADIN]:{16:{loc:"g",tpl:25356}},[n.MAGE]:{16:{loc:"g",tpl:25356}},[n.TRACKER]:{16:{loc:"g",tpl:25356}},[n.HUNTER]:{16:{loc:"g",tpl:25356}},[n.BLADE_DANCER]:{16:{loc:"g",tpl:25356}}}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],12:[{textPc:"t_12_ni_pl",textMobile:"t_12_ni_mobile_pl",headerPc:"t_header_12_ni_pl",headerMobile:"t_header_12_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[707],htmlFocus:".bottom-wrapper>.table-wrapper>.accept-button>.button",htmlPosition:".border-window:has(.content):has(.inner-content):has(.loot-window)",itemsNeed:{items:{[n.WARRIOR]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}},[n.PALADIN]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}},[n.MAGE]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}},[n.TRACKER]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}},[n.HUNTER]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}},[n.BLADE_DANCER]:{16:{loc:"l"},9:{loc:"l"},17:{loc:"l"}}}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],13:[{textPc:"t_13_ni_pl",textMobile:"t_13_ni_mobile_pl",headerPc:"t_header_13_ni_pl",headerMobile:"t_header_13_ni_pl",graphic:"/img/gui/newTutorial/4.gif",idMaps:[707],maxLevel:7,htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",htmlMultiGlow:[".character_wrapper>.equipment-wrapper>[data-st=1]"],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{9:{loc:"g",tpl:65}},[n.PALADIN]:{9:{loc:"g",tpl:65}},[n.MAGE]:{9:{loc:"g",tpl:65}},[n.TRACKER]:{9:{loc:"g",tpl:65}},[n.HUNTER]:{9:{loc:"g",tpl:65}},[n.BLADE_DANCER]:{9:{loc:"g",tpl:65}}},minOneOfAllNotEquip:!0,stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,5]}},minLevel:5,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],14:[{textPc:"t_14_ni_pl",textMobile:"t_14_ni_mobile_pl",headerPc:"t_header_14_ni_pl",headerMobile:"t_header_14_ni_pl",graphic:"/img/gui/newTutorial/4.gif",idMaps:[707],htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{17:{loc:"g",tpl:25357}},[n.PALADIN]:{17:{loc:"g",tpl:25357}},[n.MAGE]:{17:{loc:"g",tpl:25357}},[n.TRACKER]:{17:{loc:"g",tpl:25357}},[n.HUNTER]:{17:{loc:"g",tpl:25357}},[n.BLADE_DANCER]:{17:{loc:"g",tpl:25357}}},stats:{gold:!0}},minLevel:5,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn,additionalRequireFunction:function(){return!Engine.addonsPanel.checkAddonOnList(Engine.addonsPanel.getAddonIdKey(28))}}],15:[{textPc:"t_15_ni_pl",textMobile:"t_15_ni_mobile_pl",headerPc:"t_header_15_ni_pl",headerMobile:"t_header_15_ni_pl",graphic:"/img/gui/newTutorial/3.gif",idMaps:[1508],htmlMultiGlow:[t.getQuestObserve(),".main-buttons-container>.widget-auto-fight-near-mob",".widget-button.widget-in-interface-bar.widget-auto-fight-near-mob"],htmlPosition:t.getQuestObserve(),blink:!0}],16:[{textPc:"t_16_ni_pl",textMobile:"t_16_ni_mobile_pl",headerPc:"t_header_16_ni_pl",headerMobile:"t_header_16_ni_pl",graphic:"/img/gui/newTutorial/4.gif",htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",idMaps:[707],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g"}},[n.PALADIN]:{16:{loc:"g"}},[n.MAGE]:{16:{loc:"g"}},[n.TRACKER]:{16:{loc:"g"}},[n.HUNTER]:{16:{loc:"g"}},[n.BLADE_DANCER]:{16:{loc:"g"}}},stats:{lootbox:!0,lvl:[a.STAT_OPERATION.NUMBER_EQUAL,10]}},minLevel:10,blink:!0,additionalRequireFunction:function(){return!1}}],17:[{textPc:"t_17_ni_pl",textMobile:"t_17_ni_mobile_pl",headerPc:"t_header_17_ni_pl",headerMobile:"t_header_17_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[707],itemsNeed:{htmlMultiGlow:!0,tpls:{[n.WARRIOR]:{1:{loc:"n",tpl:119},14:{loc:"n",tpl:72},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}},[n.PALADIN]:{1:{loc:"n",tpl:119},14:{loc:"n",tpl:72},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}},[n.HUNTER]:{4:{loc:"n",tpl:85},29:{loc:"n",tpl:658},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}},[n.TRACKER]:{4:{loc:"n",tpl:85},29:{loc:"n",tpl:658},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}},[n.BLADE_DANCER]:{1:{loc:"n",tpl:119},5:{loc:"n",tpl:28985},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}},[n.MAGE]:{6:{loc:"n",tpl:141},7:{loc:"n",tpl:25571},8:{loc:"n",tpl:34019},9:{loc:"n",tpl:66},10:{loc:"n",tpl:83}}},stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,10]}},htmlMultiGlow:[".inner-content>.shop-wrapper>.shop-content>.buy-items"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:10,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],18:[{textPc:"t_18_ni_pl",textMobile:"t_18_ni_mobile_pl",headerPc:"t_header_18_ni_pl",headerMobile:"t_header_18_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[707],htmlMultiGlow:[".shop-wrapper>.shop-content>.finalize-button"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:10,blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire18,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],19:[{textPc:"t_19_ni_pl",textMobile:"t_19_ni_mobile_pl",headerPc:"t_header_19_ni_pl",headerMobile:"t_header_19_ni_pl",graphic:"/img/gui/newTutorial/4.gif",htmlPosition:".interface-layer>.right-column.main-column",minLevel:5,maxLevel:20,idMaps:[707,1540,1508,1835,4732],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g",tpl:31946}},[n.PALADIN]:{16:{loc:"g",tpl:31946}},[n.MAGE]:{16:{loc:"g",tpl:31946}},[n.TRACKER]:{16:{loc:"g",tpl:31946}},[n.HUNTER]:{16:{loc:"g",tpl:31946}},[n.BLADE_DANCER]:{16:{loc:"g",tpl:31946}}}},blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire19,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],20:[{textPc:"t_20_ni_pl",textMobile:"t_20_ni_mobile_pl",headerPc:"t_header_20_ni_pl",headerMobile:"t_header_20_ni_pl",graphic:"/img/gui/newTutorial/3.gif",htmlMultiGlow:[".main-buttons-container>.widget-drag-item-icon",".widget-button.widget-in-interface-bar.widget-drag-item-icon"],htmlPosition:".interface-layer>.right-column.main-column",minLevel:10,idMaps:[3969],canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.GROUND_ITEM_COLLECTIONS,szablon:441}]},itemsNeed:{items:{[n.WARRIOR]:{20:{loc:"m"}},[n.PALADIN]:{20:{loc:"m"}},[n.MAGE]:{20:{loc:"m"}},[n.TRACKER]:{20:{loc:"m"}},[n.HUNTER]:{20:{loc:"m"}},[n.BLADE_DANCER]:{20:{loc:"m"}}},stats:{szablon:[a.STAT_OPERATION.NUMBER_EQUAL,441]}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],21:[{textPc:"t_21_ni_pl",textMobile:"t_21_ni_mobile_pl",headerPc:"t_header_21_ni_pl",headerMobile:"t_header_21_ni_pl",graphic:"/img/gui/newTutorial/4.gif",htmlPosition:".interface-layer>.right-column.main-column",minLevel:10,idMaps:[707],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{27:{loc:"g"}},[n.PALADIN]:{27:{loc:"g"}},[n.MAGE]:{27:{loc:"g"}},[n.TRACKER]:{27:{loc:"g"}},[n.HUNTER]:{27:{loc:"g"}},[n.BLADE_DANCER]:{27:{loc:"g"}}},stats:{recipe:!0}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],22:[{textPc:"t_22_ni_pl",textMobile:"t_22_ni_mobile_pl",headerPc:"t_header_22_ni_pl",headerMobile:"t_header_22_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".widget-button:has(.icon.photo)",htmlMultiGlow:[".widget-button>.icon.photo"],minLevel:10,idMaps:[707],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire22,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],23:[{textPc:"t_23_ni_pl",textMobile:"t_23_ni_mobile_pl",headerPc:"t_header_23_ni_pl",headerMobile:"t_header_23_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.recipes-manager)",htmlMultiGlow:[".items-list>.divide-list-group>.group-list>.crafting-recipe-in-list.enabled"],minLevel:10,idMaps:[707],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire23,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],24:[{textPc:"t_24_ni_pl",textMobile:"t_24_ni_mobile_pl",headerPc:"t_header_24_ni_pl",headerMobile:"t_header_24_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.recipes-manager)",htmlMultiGlow:[".use-recipe-btn>.button"],itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{capacity:[a.STAT_OPERATION.NUMBER_EQUAL,5],cansplit:[a.STAT_OPERATION.NUMBER_EQUAL,0],quest:[a.STAT_OPERATION.NUMBER_EQUAL,1723]}},additionalRequireFunction:t.checkAdditionalTutorialRequire24,minLevel:10,idMaps:[707],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],25:[{textPc:"t_25_ni_pl",textMobile:"t_25_ni_mobile_pl",headerPc:"t_header_25_ni_pl",headerMobile:"t_header_25_ni_pl",graphic:"/img/gui/newTutorial/10.gif",htmlPosition:".mAlert-layer>.mAlert",htmlMultiGlow:[".mAlert-layer>.mAlert>.content>.window-controlls>.alert-accept-hotkey"],itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{capacity:[a.STAT_OPERATION.NUMBER_EQUAL,5],cansplit:[a.STAT_OPERATION.NUMBER_EQUAL,0],quest:[a.STAT_OPERATION.NUMBER_EQUAL,1723]}},additionalRequireFunction:t.checkAdditionalTutorialRequire25,minLevel:10,idMaps:[707],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],26:[{textPc:"t_26_ni_pl",textMobile:"t_26_ni_mobile_pl",headerPc:"t_header_26_ni_pl",headerMobile:"t_header_26_ni_pl",graphic:"/img/gui/newTutorial/11.gif",htmlPosition:".content:has(.inner-content):has(.recipes-manager) ~ .close-button-corner-decor>.close-button",htmlMultiGlow:[".content:has(.inner-content):has(.recipes-manager) ~ .close-button-corner-decor>.close-button"],itemsNeed:{items:{[n.WARRIOR]:{16:{loc:"g"}},[n.PALADIN]:{16:{loc:"g"}},[n.MAGE]:{16:{loc:"g"}},[n.TRACKER]:{16:{loc:"g"}},[n.HUNTER]:{16:{loc:"g"}},[n.BLADE_DANCER]:{16:{loc:"g"}}},stats:{leczy:[a.STAT_OPERATION.NUMBER_EQUAL,200],capacity:[a.STAT_OPERATION.NUMBER_EQUAL,20],cansplit:[a.STAT_OPERATION.NUMBER_EQUAL,1]}},additionalRequireFunction:t.checkAdditionalTutorialRequire26,minLevel:10,idMaps:[707],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],27:[{textPc:"t_27_ni_pl",textMobile:"t_27_ni_mobile_pl",headerPc:"t_header_27_ni_pl",headerMobile:"t_header_27_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".barter-content>.bottom-row-panel>.do-recipe>.button",htmlMultiGlow:[".barter-content>.bottom-row-panel>.do-recipe>.button.green"],minLevel:10,maxLevel:20,idMaps:[368],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire27,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],28:[{textPc:"t_28_ni_pl",textMobile:"t_28_ni_mobile_pl",headerPc:"t_header_28_ni_pl",headerMobile:"t_header_28_ni_pl",graphic:"/img/gui/newTutorial/10.gif",htmlPosition:".mAlert-layer>.mAlert",htmlMultiGlow:[".mAlert-layer>.mAlert>.content>.window-controlls>.alert-accept-hotkey"],minLevel:10,maxLevel:20,idMaps:[368],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire27,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],29:[{textPc:"t_29_ni_pl",textMobile:"t_29_ni_mobile_pl",headerPc:"t_header_29_ni_pl",headerMobile:"t_header_29_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",htmlFocus:".shop-wrapper>.shop-content>.great-merchamp>.btn-num:first",minLevel:10,maxLevel:20,idMaps:[368],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],30:[{textPc:"t_30_ni_pl",textMobile:"t_30_ni_mobile_pl",headerPc:"t_header_30_ni_pl",headerMobile:"t_header_30_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".shop-wrapper>.shop-content>.finalize-button",htmlMultiGlow:[".shop-wrapper>.shop-content>.finalize-button"],minLevel:10,maxLevel:20,idMaps:[368],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],31:[{textPc:"t_31_ni_pl",textMobile:"t_31_ni_mobile_pl",headerPc:"t_header_31_ni_pl",headerMobile:"t_header_31_ni_pl",itemsNeed:{htmlMultiGlow:!0,tpls:{[n.WARRIOR]:{15:{loc:"n",tpl:34279}},[n.PALADIN]:{15:{loc:"n",tpl:34279}},[n.MAGE]:{15:{loc:"n",tpl:34279}},[n.TRACKER]:{15:{loc:"n",tpl:34279}},[n.HUNTER]:{15:{loc:"n",tpl:34279}},[n.BLADE_DANCER]:{15:{loc:"n",tpl:34279}}}},graphic:"/img/gui/newTutorial/1.gif",htmlMultiGlow:[".inner-content>.shop-wrapper>.shop-content>.buy-items"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:6,maxLevel:20,idMaps:[707],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],32:[{textPc:"t_32_ni_pl",textMobile:"t_32_ni_mobile_pl",headerPc:"t_header_32_ni_pl",headerMobile:"t_header_32_ni_pl",itemsNeed:{htmlMultiGlow:!0,tpls:{[n.WARRIOR]:{15:{loc:"n",tpl:34279}},[n.PALADIN]:{15:{loc:"n",tpl:34279}},[n.MAGE]:{15:{loc:"n",tpl:34279}},[n.TRACKER]:{15:{loc:"n",tpl:34279}},[n.HUNTER]:{15:{loc:"n",tpl:34279}},[n.BLADE_DANCER]:{15:{loc:"n",tpl:34279}}}},graphic:"/img/gui/newTutorial/1.gif",htmlMultiGlow:[".shop-wrapper>.shop-content>.finalize-button"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:6,maxLevel:20,idMaps:[707],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire32,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],33:[{textPc:"t_33_ni_pl",textMobile:"t_33_ni_mobile_pl",headerPc:"t_header_33_ni_pl",headerMobile:"t_header_33_ni_pl",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{24:{loc:"g",tpl:25364}},[n.PALADIN]:{24:{loc:"g",tpl:25364}},[n.MAGE]:{24:{loc:"g",tpl:25364}},[n.TRACKER]:{24:{loc:"g",tpl:25364}},[n.HUNTER]:{24:{loc:"g",tpl:25364}},[n.BLADE_DANCER]:{24:{loc:"g",tpl:25364}}},minOneOfAllNotEquip:!0},graphic:"/img/gui/newTutorial/12.gif",htmlMultiGlow:[".game-window-positioner>.interface-layer>.right-column>.inner-wrapper>.inventory_wrapper>.bags-navigation>.tutorial-bag"],htmlPosition:".interface-layer>.right-column.main-column",minLevel:10,maxLevel:20,idMaps:[707],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],34:[{textPc:"t_34_ni_pl",textMobile:"t_34_ni_mobile_pl",headerPc:"t_header_34_ni_pl",headerMobile:"t_header_34_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".barter-window",htmlMultiGlow:[".offer-id-1616"],minLevel:10,maxLevel:20,blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire34,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}]}}}},function(t,e,i){let n=i(14);var a=i(8),s=i(39);t.exports=function(){let t=this,e="eqcolumnshow";this.init=()=>{this.addEnDataToList()},this.attachSkipTutorial=()=>{$(".skip-tutorial-span").click((function(){Engine.tutorials.turnOffTutorial()}))},this.getQuestObserve=()=>".border-window:has(.content):has(.quest-observe-window)",this.checkAdditionalTutorialRequire2=t=>!Engine.tutorialManager.bitIsSet(Engine.tutorialValue,1),this.checkAdditionalTutorialRequire6=(t,e)=>0==parseInt(e.auto),this.checkAdditionalTutorialRequire9=(t,e)=>!Engine.npcs.check()[131703],this.checkFullFill14=t=>22616==t.tpl,this.checkAdditionalTutorialRequire18=t=>Engine.tutorialManager.itemsInBasket(17),this.checkAdditionalTutorialRequire19=t=>Engine.hero.d.warrior_stats.hp/Engine.hero.d.warrior_stats.maxhp<.5,this.checkAdditionalTutorialRequire22=(t,e)=>e._cachedStats.recipe,this.checkAdditionalTutorialRequire23=(t,e)=>$(".items-list>.divide-list-group>.group-list>.crafting-recipe-in-list.enabled").length,this.checkAdditionalTutorialRequire24=(t,e)=>{let i=Engine.crafting.recipes,n=$(".recipes-manager .use-recipe-btn .button");return i&&804==i.getShowId()&&n&&!n.hasClass("black")},this.checkAdditionalTutorialRequire25=(t,e)=>Engine.crafting.recipes,this.checkAdditionalTutorialRequire26=(t,e)=>Engine.crafting.recipes,this.checkAdditionalTutorialRequire27=(t,e)=>!$(".group-list>.offer-id-1890.disabled").length&&$(".barter-content>.bottom-row-panel>.do-recipe>.button.green").length,this.checkAdditionalTutorialRequire34=(t,e)=>!$(".group-list>.offer-id-1890.disabled").length,this.checkAdditionalTutorialRequire32=t=>Engine.tutorialManager.itemsInBasket(31),this.checkFullFill19=t=>Engine.hero.d.warrior_stats.hp/Engine.hero.d.warrior_stats.maxhp>.5,this.checkFullFill20=t=>{let e={itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{quest:[a.STAT_OPERATION.NUMBER_EQUAL,703],amount:[a.STAT_OPERATION.NUMBER_EQUAL,6]}}};return Engine.tutorialManager.needItemsTest(e)},this.checkFullFill21=t=>t._cachedStats.recipe,this.checkFullFill23=t=>!t.hasClass("black"),this.checkCanFinish=(t,e)=>{let i=Engine.tutorialManager.getDataFromList(t);switch(t){case 30:case 31:case 32:case 33:case 53:case 0:return!0;case 1:return Engine.tutorialManager.checkIsMoveTutorial();case 2:return Engine.tutorialManager.checkIsSameNpc(e,i.canvasMultiGlow.objects[0].id);case 3:return Engine.tutorialManager.needItemsTest(Engine.tutorialManager.getDataFromList(5));case 4:case 5:case 6:case 7:case 8:return!0;case 9:case 10:return Engine.tutorialManager.checkIsSameNpc(e,i.canvasMultiGlow.objects[0].id);case 11:return Engine.tutorialManager.itemIsLootbox(e);case 12:return!0;case 13:return Engine.tutorialManager.needItemsTest({itemsNeed:{items:{[n.WARRIOR]:{10:{loc:"g"}},[n.PALADIN]:{10:{loc:"g"}},[n.MAGE]:{10:{loc:"g"}},[n.TRACKER]:{10:{loc:"g"}},[n.HUNTER]:{10:{loc:"g"}},[n.BLADE_DANCER]:{10:{loc:"g"}}},inUse:!0,stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,5]}}});case 14:return this.checkFullFill14(e);case 15:return!0;case 16:return Engine.tutorialManager.itemIsLootbox(e);case 17:return Engine.tutorialManager.itemsInBasket(17);case 18:return!0;case 19:return this.checkFullFill19();case 20:return this.checkFullFill20();case 21:return this.checkFullFill21(e);case 22:return!0;case 23:return this.checkFullFill23(e);case 24:case 25:case 26:case 27:case 28:case 29:case 34:return!0;default:return console.log("not supported Finish tutorial... Yet..."),!1}},this.manageEqColumn=()=>{Engine.interface.checkEqColumnIsShow()||Engine.interface.clickEqColumnShow()},this.getNormalAttackIcon=()=>"icon-"+s.specificSkills.NORMAL_ATTACK_ID,this.addEnDataToList=()=>{Engine.tutorialManager.list.en={53:[{textPc:"t_53_ni_pl",textMobile:"t_53_ni_pl",headerPc:"movement_header_ni",headerMobile:"mobile_53_tutorial",idMaps:[3877],graphic:"/img/gui/newTutorial/0_eng.png",click:{txt:"Start!",clb:function(){Engine.tutorials.finishTutorial()}},additionalFunctionAfterCreate:t.attachSkipTutorial}],1:[{textPc:"t_1_ni_pl",textMobile:"t_1_ni_mobile_pl",headerPc:"t_header_1_ni_pl",headerMobile:"t_header_1_ni_pl",graphic:"/img/gui/newTutorial/6_eng.gif",idMaps:[3877],htmlFocus:".echh-layer",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.HERO}]},blink:!0,canvasPosition:{typeObject:a.TYPE_OBJECT.HERO}}],2:[{textPc:"t_2_ni_pl",textMobile:"t_2_ni_mobile_pl",headerPc:"t_header_2_ni_pl",headerMobile:"t_header_2_ni_pl",graphic:"/img/gui/newTutorial/8_eng.gif",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:113018}]},canvasPosition:{typeObject:a.TYPE_OBJECT.NPC,id:113018},htmlMultiGlow:[".widget-in-interface-bar.widget-npc-talk-icon"],blink:!0,idMaps:[3877],additionalRequireFunction:t.checkAdditionalTutorialRequire2}],3:[{textPc:"t_3_ni_pl",textMobile:"t_3_ni_mobile_pl",headerPc:"t_header_3_ni_pl",headerMobile:"t_header_3_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",htmlMultiGlow:[".character_wrapper>.equipment-wrapper>[data-st=5]",".character_wrapper>.equipment-wrapper>[data-st=6]",".character_wrapper>.equipment-wrapper>[data-st=7]"],blink:!0,idMaps:[3877],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{8:{loc:"g"},1:{loc:"g"},14:{loc:"g"}},[n.PALADIN]:{8:{loc:"g"},1:{loc:"g"},14:{loc:"g"}},[n.MAGE]:{8:{loc:"g"},6:{loc:"g"},5:{loc:"g"}},[n.TRACKER]:{8:{loc:"g"},4:{loc:"g"},21:{loc:"g"}},[n.HUNTER]:{8:{loc:"g"},4:{loc:"g"},21:{loc:"g"}},[n.BLADE_DANCER]:{8:{loc:"g"},1:{loc:"g"},5:{loc:"g"}}},minOneOfAllNotEquip:!0},blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],5:[{textPc:"t_5_ni_pl",textMobile:"t_5_ni_mobile_pl",headerPc:"t_header_5_ni_pl",headerMobile:"t_header_5_ni_pl",graphic:"/img/gui/newTutorial/7_eng.gif",canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:131714}]},htmlPosition:".omg-tutorial-handler",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{8:{loc:"g"},1:{loc:"g"},14:{loc:"g"}},[n.PALADIN]:{8:{loc:"g"},1:{loc:"g"},14:{loc:"g"}},[n.MAGE]:{8:{loc:"g"},6:{loc:"g"},5:{loc:"g"}},[n.TRACKER]:{8:{loc:"g"},4:{loc:"g"},21:{loc:"g"}},[n.HUNTER]:{8:{loc:"g"},4:{loc:"g"},21:{loc:"g"}},[n.BLADE_DANCER]:{8:{loc:"g"},1:{loc:"g"},5:{loc:"g"}}},inUse:!0},hasQuestId:767,minLevel:2,htmlMultiGlow:[".widget-button.widget-in-interface-bar.widget-attack-near-mob"],blink:!0,blockedHotKeys:["autofightNearMob"],blockedWidget:["auto-fight-near-mob"],idMaps:[3877]}],6:[{textPc:"t_6_ni_pl",textMobile:"t_6_ni_mobile_pl",headerPc:"t_header_6_ni_pl",headerMobile:"t_header_6_ni_pl",graphic:"/img/gui/newTutorial/5_eng.gif",idMaps:[3877],htmlFocus:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",htmlPosition:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire6}],7:[{textPc:"t_7_ni_pl",textMobile:"t_7_ni_mobile_pl",headerPc:"t_header_7_ni_pl",headerMobile:"t_header_7_ni_pl",graphic:"/img/gui/newTutorial/5_eng.gif",idMaps:[3877],htmlMultiGlow:[".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")"],htmlPosition:".skill-usable-slot:has(.battle-skill):has(."+t.getNormalAttackIcon()+")",blink:!0}],8:[{textPc:"t_8_ni_pl",textMobile:"t_8_ni_mobile_pl",headerPc:"t_header_8_ni_pl",headerMobile:"t_header_8_ni_pl",graphic:"/img/gui/newTutorial/9_eng.gif",htmlFocus:".close-battle-ground",htmlPosition:".close-battle-ground",idMaps:[3877],blink:!0}],9:[{textPc:"t_9_ni_pl",textMobile:"t_9_ni_mobile_pl",headerPc:"t_header_9_ni_pl",headerMobile:"t_header_9_ni_pl",graphic:"/img/gui/newTutorial/8_eng.gif",idMaps:[3877],htmlPosition:t.getQuestObserve(),htmlMultiGlow:[t.getQuestObserve()],canvasMultiGlow:{objects:[{typeObject:a.TYPE_OBJECT.NPC,id:131717}]},blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire9}],11:[{textPc:"t_11_ni_pl",textMobile:"t_11_ni_mobile_pl",headerPc:"t_header_11_ni_pl",headerMobile:"t_header_11_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",idMaps:[3877],minLevel:5,htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".inventory_wrapper>.inventory-grid-bg",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g"}},[n.PALADIN]:{16:{loc:"g"}},[n.MAGE]:{16:{loc:"g"}},[n.TRACKER]:{16:{loc:"g"}},[n.HUNTER]:{16:{loc:"g"}},[n.BLADE_DANCER]:{16:{loc:"g"}}},stats:{lootbox:!0,lvl:[a.STAT_OPERATION.NUMBER_EQUAL,5]}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],12:[{textPc:"t_12_ni_pl",textMobile:"t_12_ni_mobile_pl",headerPc:"t_header_12_ni_pl",headerMobile:"t_header_12_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[3877],htmlFocus:".bottom-wrapper>.table-wrapper>.accept-button>.button",htmlPosition:".border-window:has(.content):has(.inner-content):has(.loot-window)",itemsNeed:{items:{[n.WARRIOR]:{10:{loc:"l"},17:{loc:"l"}},[n.PALADIN]:{10:{loc:"l"},17:{loc:"l"}},[n.MAGE]:{10:{loc:"l"},17:{loc:"l"}},[n.TRACKER]:{10:{loc:"l"},17:{loc:"l"}},[n.HUNTER]:{10:{loc:"l"},17:{loc:"l"}},[n.BLADE_DANCER]:{10:{loc:"l"},17:{loc:"l"}}}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],13:[{textPc:"t_13_ni_pl",textMobile:"t_13_ni_mobile_pl",headerPc:"t_header_13_ni_pl",headerMobile:"t_header_13_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",idMaps:[3877],htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",htmlMultiGlow:[".character_wrapper>.equipment-wrapper>[data-st=8]"],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{10:{loc:"g"}},[n.PALADIN]:{10:{loc:"g"}},[n.MAGE]:{10:{loc:"g"}},[n.TRACKER]:{10:{loc:"g"}},[n.HUNTER]:{10:{loc:"g"}},[n.BLADE_DANCER]:{10:{loc:"g"}}},minOneOfAllNotEquip:!0,stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,5]}},minLevel:5,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],14:[{textPc:"t_14_ni_pl",textMobile:"t_14_ni_mobile_pl",headerPc:"t_header_14_ni_pl",headerMobile:"t_header_14_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",idMaps:[3877],htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{17:{loc:"g",tpl:22616}},[n.PALADIN]:{17:{loc:"g",tpl:22616}},[n.MAGE]:{17:{loc:"g",tpl:22616}},[n.TRACKER]:{17:{loc:"g",tpl:22616}},[n.HUNTER]:{17:{loc:"g",tpl:22616}},[n.BLADE_DANCER]:{17:{loc:"g",tpl:22616}}},stats:{gold:!0}},minLevel:5,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],15:[{textPc:"t_15_ni_pl",textMobile:"t_15_ni_mobile_pl",headerPc:"t_header_15_ni_pl",headerMobile:"t_header_15_ni_pl",graphic:"/img/gui/newTutorial/3.gif",idMaps:[3987],htmlMultiGlow:[t.getQuestObserve(),".widget-button.widget-in-interface-bar.widget-auto-fight-near-mob"],htmlPosition:t.getQuestObserve(),blink:!0}],16:[{textPc:"t_16_ni_pl",textMobile:"t_16_ni_mobile_pl",headerPc:"t_header_16_ni_pl",headerMobile:"t_header_16_ni_pl",graphic:"/img/gui/newTutorial/4.gif",htmlFocus:".interface-layer>.right-column.main-column",htmlPosition:".interface-layer>.right-column.main-column",idMaps:[3881],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g",tpl:22624}},[n.PALADIN]:{16:{loc:"g",tpl:22624}},[n.MAGE]:{16:{loc:"g",tpl:22624}},[n.TRACKER]:{16:{loc:"g",tpl:22624}},[n.HUNTER]:{16:{loc:"g",tpl:22624}},[n.BLADE_DANCER]:{16:{loc:"g",tpl:22624}}}},minLevel:6,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],17:[{textPc:"t_17_ni_pl",textMobile:"t_17_ni_mobile_pl",headerPc:"t_header_17_ni_pl",headerMobile:"t_header_17_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[3987],itemsNeed:{htmlMultiGlow:!0,tpls:{[n.PALADIN]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}},[n.WARRIOR]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}},[n.BLADE_DANCER]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}},[n.HUNTER]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}},[n.TRACKER]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}},[n.MAGE]:{11:{loc:"n",tpl:19112},16:{loc:"n",tpl:19050},9:{loc:"n",tpl:19113}}},stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,6]}},htmlMultiGlow:[".inner-content>.shop-wrapper>.shop-content>.buy-items"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:6,blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],18:[{textPc:"t_18_ni_pl",textMobile:"t_18_ni_mobile_pl",headerPc:"t_header_18_ni_pl",headerMobile:"t_header_18_ni_pl",graphic:"/img/gui/newTutorial/1.gif",idMaps:[3987],htmlMultiGlow:[".shop-wrapper>.shop-content>.finalize-button"],htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",minLevel:6,blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire18,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],19:[{textPc:"t_19_ni_pl",textMobile:"t_19_ni_mobile_pl",headerPc:"t_header_19_ni_pl",headerMobile:"t_header_19_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",htmlPosition:".interface-layer>.right-column.main-column",minLevel:5,maxLevel:20,idMaps:[3881],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{16:{loc:"g"}},[n.PALADIN]:{16:{loc:"g"}},[n.MAGE]:{16:{loc:"g"}},[n.TRACKER]:{16:{loc:"g"}},[n.HUNTER]:{16:{loc:"g"}},[n.BLADE_DANCER]:{16:{loc:"g"}}},stats:{fullheal:!0}},blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire19}],20:[{textPc:"t_20_ni_pl",textMobile:"t_20_ni_mobile_pl",headerPc:"t_header_20_ni_pl",headerMobile:"t_header_20_ni_pl",graphic:"/img/gui/newTutorial/2.gif",htmlPosition:".interface-layer>.right-column.main-column",idMaps:[3881],canvasMultiGlow:{objects:[{typeObject:"groundItemCollections",allId:[113101,113102,113103,113104,113105,113106,113107,113108,113109,113110,113111,113112,113113,113114,113115]}]},itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,7]}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],21:[{textPc:"t_21_ni_pl",textMobile:"t_21_ni_mobile_pl",headerPc:"t_header_21_ni_pl",headerMobile:"t_header_21_ni_pl",graphic:"/img/gui/newTutorial/4_eng.gif",htmlPosition:".interface-layer>.right-column.main-column",minLevel:7,idMaps:[3881],itemsNeed:{htmlMultiGlow:!0,items:{[n.WARRIOR]:{27:{loc:"g"}},[n.PALADIN]:{27:{loc:"g"}},[n.MAGE]:{27:{loc:"g"}},[n.TRACKER]:{27:{loc:"g"}},[n.HUNTER]:{27:{loc:"g"}},[n.BLADE_DANCER]:{27:{loc:"g"}}},stats:{recipe:[a.STAT_OPERATION.NUMBER_EQUAL,804]}},blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],22:[{textPc:"t_22_ni_pl",textMobile:"t_22_ni_mobile_pl",headerPc:"t_header_22_ni_pl",headerMobile:"t_header_22_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".widget-button:has(.icon.photo)",htmlMultiGlow:[".widget-button>.icon.photo"],minLevel:7,idMaps:[3881],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire22,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],23:[{textPc:"t_23_ni_pl",textMobile:"t_23_ni_mobile_pl",headerPc:"t_header_23_ni_pl",headerMobile:"t_header_23_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.recipes-manager)",htmlMultiGlow:[".items-list>.divide-list-group>.group-list>.crafting-recipe-in-list.enabled"],minLevel:7,idMaps:[3881],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire23,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],24:[{textPc:"t_24_ni_pl",textMobile:"t_24_ni_mobile_pl",headerPc:"t_header_24_ni_pl",headerMobile:"t_header_24_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.recipes-manager)",htmlMultiGlow:[".use-recipe-btn>.button"],itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g",tpl:19134}},[n.PALADIN]:{15:{loc:"g",tpl:19134}},[n.MAGE]:{15:{loc:"g",tpl:19134}},[n.TRACKER]:{15:{loc:"g",tpl:19134}},[n.HUNTER]:{15:{loc:"g",tpl:19134}},[n.BLADE_DANCER]:{15:{loc:"g",tpl:19134}}}},additionalRequireFunction:t.checkAdditionalTutorialRequire24,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn,minLevel:7,idMaps:[3881],blink:!0}],25:[{textPc:"t_25_ni_pl",textMobile:"t_25_ni_mobile_pl",headerPc:"t_header_25_ni_pl",headerMobile:"t_header_25_ni_pl",graphic:"/img/gui/newTutorial/10_eng.gif",htmlPosition:".mAlert-layer>.mAlert",htmlMultiGlow:[".mAlert-layer>.mAlert>.content>.window-controlls>.alert-accept-hotkey"],itemsNeed:{items:{[n.WARRIOR]:{15:{loc:"g"}},[n.PALADIN]:{15:{loc:"g"}},[n.MAGE]:{15:{loc:"g"}},[n.TRACKER]:{15:{loc:"g"}},[n.HUNTER]:{15:{loc:"g"}},[n.BLADE_DANCER]:{15:{loc:"g"}}},stats:{capacity:[a.STAT_OPERATION.NUMBER_EQUAL,1],lvl:[a.STAT_OPERATION.NUMBER_EQUAL,7],quest:[a.STAT_OPERATION.NUMBER_EQUAL,767],amount:[a.STAT_OPERATION.NUMBER_EQUAL,1],cansplit:[a.STAT_OPERATION.NUMBER_EQUAL,0]}},additionalRequireFunction:t.checkAdditionalTutorialRequire25,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn,minLevel:7,idMaps:[3881],blink:!0}],26:[{textPc:"t_26_ni_pl",textMobile:"t_26_ni_mobile_pl",headerPc:"t_header_26_ni_pl",headerMobile:"t_header_26_ni_pl",graphic:"/img/gui/newTutorial/11_eng.gif",htmlPosition:".content:has(.inner-content):has(.recipes-manager) ~ .close-button-corner-decor>.close-button",htmlMultiGlow:[".content:has(.inner-content):has(.recipes-manager) ~ .close-button-corner-decor>.close-button"],itemsNeed:{items:{[n.WARRIOR]:{16:{loc:"g"}},[n.PALADIN]:{16:{loc:"g"}},[n.MAGE]:{16:{loc:"g"}},[n.TRACKER]:{16:{loc:"g"}},[n.HUNTER]:{16:{loc:"g"}},[n.BLADE_DANCER]:{16:{loc:"g"}}},stats:{lvl:[a.STAT_OPERATION.NUMBER_EQUAL,7],fullheal:[a.STAT_OPERATION.NUMBER_EQUAL,1500],amount:[a.STAT_OPERATION.NUMBER_EQUAL,1],capacity:[a.STAT_OPERATION.NUMBER_EQUAL,10],cansplit:[a.STAT_OPERATION.NUMBER_EQUAL,0]}},additionalRequireFunction:t.checkAdditionalTutorialRequire26,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn,minLevel:7,idMaps:[3881],blink:!0}],27:[{textPc:"t_27_ni_pl",textMobile:"t_27_ni_mobile_pl",headerPc:"t_header_27_ni_pl",headerMobile:"t_header_27_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".barter-content>.bottom-row-panel>.do-recipe>.button",htmlMultiGlow:[".barter-content>.bottom-row-panel>.do-recipe>.button"],minLevel:7,idMaps:[3881],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire27,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],28:[{textPc:"t_28_ni_pl",textMobile:"t_28_ni_mobile_pl",headerPc:"t_header_28_ni_pl",headerMobile:"t_header_28_ni_pl",graphic:"/img/gui/newTutorial/10_eng.gif",htmlPosition:".mAlert-layer>.mAlert",htmlMultiGlow:[".mAlert-layer>.mAlert>.content>.window-controlls>.alert-accept-hotkey"],minLevel:7,idMaps:[3881],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire27,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],29:[{textPc:"t_29_ni_pl",textMobile:"t_29_ni_mobile_pl",headerPc:"t_header_29_ni_pl",headerMobile:"t_header_29_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".border-window:has(.content):has(.inner-content):has(.shop-wrapper)",htmlFocus:".shop-wrapper>.shop-content>.great-merchamp>.btn-num:first",minLevel:7,idMaps:[3881],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],30:[{textPc:"t_30_ni_pl",textMobile:"t_30_ni_mobile_pl",headerPc:"t_header_30_ni_pl",headerMobile:"t_header_30_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".shop-wrapper>.shop-content>.finalize-button",htmlMultiGlow:[".shop-wrapper>.shop-content>.finalize-button"],minLevel:7,idMaps:[3881],blink:!0,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}],34:[{textPc:"t_34_ni_pl",textMobile:"t_34_ni_mobile_pl",headerPc:"t_header_34_ni_pl",headerMobile:"t_header_34_ni_pl",graphic:"/img/gui/newTutorial/1.gif",htmlPosition:".barter-window",htmlMultiGlow:[".offer-id-1890"],minLevel:7,idMaps:[3881],blink:!0,additionalRequireFunction:t.checkAdditionalTutorialRequire34,blockedWidget:["eq-show-icon"],blockedHotKeys:[e],additionalFunctionBeforeCreate:t.manageEqColumn}]}}}},,function(t,e,i){const n=i(448).CrossStorageClient;t.exports=function(){var t=this;this.storage=null,this.isConnected=!1,this.init=async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&(t.initService(),await t.connectToService())},this.initService=()=>{const t=this.getHitUrl();this.storage=new n(t)},this.connectToService=async()=>{await this.storage.onConnect().then(()=>{this.isConnected=!0,this.unlockGameInterface()},t=>{this.unlockGameInterface()})},this.unlockGameInterface=()=>{this.getEngine().interface.lock.unlock("crossStorage")},this.getHitUrl=()=>this.getCommonsUrl()+"/cross-storage/hub.html",this.getCommonsUrl=()=>__build.commonsURL,this.set=(t,e)=>"string"==typeof e?this.storage.set(t,e):this.storage.set(t,JSON.stringify(e)),this.get=t=>this.storage.get(t),this.getEngine=()=>Engine}},,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),a=i(8),s=i(452),r=i(453),o=i(454),l=i(461);t.exports=class{constructor(){this.opened=!1,this.content="",this.cards={enhancement:{name:this.tLang("enhancement","enhancement"),requireLvl:20},salvage:{name:this.tLang("salvage","salvager"),requireLvl:20},extraction:{name:this.tLang("extraction","extraction"),requireLvl:20},recipes:{name:this.tLang("recipe"),initAction:()=>{_g("craft&a=list")}}}}init(){this.initWindow(),this.centerWindow(),this.createCards()}open(t,e){"default"===t&&(t="enhancement"),this.closeOthers(t);const i=this.getEngine();if(!this.canCardOpen(t))return;this.activateCard(t),this.currentTab=t,this.closeOtherWindows();let n=null;switch(t){case"recipes":i.crafting.recipes||(i.crafting.recipes=new s,i.crafting.recipes.init()),i.crafting.recipes.update(e),n=i.crafting.recipes;break;case"salvage":i.crafting.salvage||(i.crafting.salvage=new r.default(this.wndEl)),n=i.crafting.salvage;break;case"enhancement":i.crafting.enhancement||(i.crafting.enhancement=new o.default(this.wndEl)),n=i.crafting.enhancement;break;case"extraction":i.crafting.extraction||(i.crafting.extraction=new l.default(this.wndEl)),n=i.crafting.extraction}this.windowOpen(),n.updateScroll&&n.updateScroll()}closeAll(){this.getEngine().crafting.recipes&&this.getEngine().crafting.recipes.close(),this.getEngine().crafting.salvage&&this.getEngine().crafting.salvage.close(),this.getEngine().crafting.enhancement&&this.getEngine().crafting.enhancement.close(),this.getEngine().crafting.extraction&&this.getEngine().crafting.extraction.close()}closeOthers(t){this.getEngine().crafting.recipes&&"recipes"!==t&&this.getEngine().crafting.recipes.close(),this.getEngine().crafting.salvage&&"salvage"!==t&&this.getEngine().crafting.salvage.close(),this.getEngine().crafting.enhancement&&"enhancement"!==t&&this.getEngine().crafting.enhancement.close(),this.getEngine().crafting.extraction&&"extraction"!==t&&this.getEngine().crafting.extraction.close()}createCards(){for(const t in this.cards)this.createOneCard(t,this.cards[t])}createOneCard(t,e){const i=n.get("card")[0],a=this.wndEl.querySelector(".crafting__contents"),s=this.wndEl.querySelector(".crafting__tabs .cards-header"),r=i.querySelector(".label");i.classList.add(t+"-tab"),r.innerHTML=e.name,isset(e.disabled)&&e.disabled&&(i.classList.add("disabled"),$(i).tip(this.tLang("coming_soon","default"))),s.appendChild(i);let o=document.createElement("div");o.classList.add(t+"-content"),a.appendChild(o),i.addEventListener("click",()=>{i.classList.contains("disabled")||(e.initAction?e.initAction():this.open(t))})}activateCard(t){const e=this.wndEl.querySelector(`.crafting__tabs .${t}-tab`),i=this.wndEl.querySelector(`.crafting__contents .${t}-content`);e.classList.add("active"),i.classList.add("active");const n=siblings(e),a=siblings(i);n.forEach(t=>t.classList.remove("active")),a.forEach(t=>t.classList.remove("active"))}setCardRequires(){for(const t in this.cards){const e=this.cards[t];if(isset(e.disabled)&&e.disabled)continue;const i=this.wndEl.querySelector(`.crafting__tabs .${t}-tab`);this.checkOneCardRequires(t)?(i.classList.remove("disabled"),$(i).tip("")):(i.classList.add("disabled"),$(i).tip(this.tLang("need__lvl","default",{"%val%":e.requireLvl})))}}checkOneCardRequires(t){const e=this.cards[t];return!(isset(e.requireLvl)&&e.requireLvl&&this.getEngine().hero.d.lvl<e.requireLvl)}getFirstAvailableCard(){for(const t in this.cards){const e=this.cards[t];if((!isset(e.disabled)||!e.disabled)&&this.checkOneCardRequires(t))return t}}canCardOpen(t){const e=this.getFirstAvailableCard();if(!this.checkOneCardRequires(t)&&e){const t=this.cards[e];return t.initAction?t.initAction():this.open(e),!1}return!0}manageVisible(){this.opened?this.windowClose():(this.closeOtherWindows(),this.windowOpen())}windowOpen(){this.setCardRequires(),this.wnd.show(),this.opened=!0,this.wnd.setWndOnPeak(),Engine.lock.add("crafting")}windowClose(){this.wnd.hide(),this.opened=!1,Engine.lock.remove("crafting")}initWindow(){this.content=n.get("crafting"),this.getEngine().windowManager.add({content:this.content,title:this.tLang("crafting"),nameWindow:this.getEngine().windowsData.name.CRAFTING,widget:this.getEngine().widgetsData.name.CRAFTING,objParent:this,nameRefInParent:"wnd",startVH:60,cssVH:60,onclose:()=>{this.triggerClose()}}),this.wnd.addToAlertLayer(),this.windowClose(),this.wndEl=this.wnd.$[0]}centerWindow(){this.wnd.center()}getEngine(){return Engine}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recipes"):""}closeOtherWindows(){const t=this.getEngine(),e=t.windowsData.windowCloseConfig.CRAFTING;t.windowCloseManager.callWindowCloseConfig(e)}callCheckCanFinishExternalTutorialCloseBarter(){let t=Engine.tutorialManager.createTutorialDataTrigger(a.ON_FINISH_BREAK.CLOSE_CRAFTING,a.ON_FINISH_TYPE.BREAK,!0);this.getEngine().tutorialManager.checkCanFinishExternalAndFinish(t)}close(){this.closeAll(),this.windowClose(),this.callCheckCanFinishExternalTutorialCloseBarter(),delete this.getEngine().crafting.recipes}triggerOpen(){_g("artisanship&action=open")}triggerClose(){this.close()}}},function(t,e,i){var n=i(0);i(56);let a=i(14);var s=i(8);const{setOnlyPositiveNumberInInput:r}=i(2);t.exports=function(){var t,e=this,i=null,r={};this.recipes=[],this.items={},this.init=function(){this.initWindow(),this.initLabels(),this.initSelect(),this.initSearch(),this.initStartLvl(),this.initStopLvl(),this.initScrollsBar(),Engine.tpls.fetch(Engine.itemsFetchData.NEW_RECIPE_TPL,this.newRecipeItem.bind(this)),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,22),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,22)},this.getShowId=()=>i,this.initStartLvl=function(){const i=t.find(".start-lvl-wrapper"),n=createNiInput({cl:"start-lvl",placeholder:_t("start"),changeClb:e.startFilter,clearClb:e.startFilter,type:"number"});i.html(n)},this.initStopLvl=function(){const i=t.find(".stop-lvl-wrapper"),n=createNiInput({cl:"stop-lvl",placeholder:_t("stop"),changeClb:e.startFilter,clearClb:e.startFilter,type:"number"});i.html(n)},this.startFilter=function(){t.find(".one-item-on-divide-list").removeClass("hide"),e.searchKeyUp(),e.lvlKeyUp(),e.getValueFromProf(),e.getValueFromItemType(),e.countRecipesPerGroup(),e.updateScroll()},this.countRecipesPerGroup=()=>{t.find(".divide-list-group").each((function(t,e){let i=$(e).find(".group-list .one-item-on-divide-list:not(.hide)").length;$(e).find(".amount").html(i)}))},this.searchKeyUp=function(){var e=t.find(".search").val(),i=t.find(".one-item-on-divide-list");""==e||i.each((function(){$(this).find(".name").html().toLowerCase().search(e.toLowerCase())>-1?$(this).removeClass("hide"):$(this).addClass("hide")}))},this.lvlKeyUp=function(){var e=t.find(".start-lvl input").val(),i=t.find(".stop-lvl input").val(),n=t.find(".one-item-on-divide-list");""==e&&""==i||(""==e&&(e=0),""==i&&(i=1e3),n.each((function(){if("none"!=$(this).css("display")){var t=$(this).attr("lvl");t>=parseInt(e)&&t<=parseInt(i)?$(this).removeClass("hide"):$(this).addClass("hide")}})))},this.getValueFromProf=function(){var e=t.find(".choose-prof").find(".menu-option").attr("value");"all"!=e&&t.find(".one-item-on-divide-list").each((function(){"none"!=$(this).css("display")&&($(this).attr("reqp").indexOf(e)>-1?$(this).removeClass("hide"):$(this).addClass("hide"))}))},this.getValueFromItemType=function(){var e=t.find(".choose-item-type").find(".menu-option").attr("value");"all"!=e&&t.find(".one-item-on-divide-list").each((function(){if("none"!=$(this).css("display")){var t,i=$(this).attr("typeitem");switch(e){case"unique":t="unique"==i||"heroic"==i||"legendary"==i;break;case"heroic":t="heroic"==i||"legendary"==i;break;case"legendary":t="legendary"==i}t?$(this).removeClass("hide"):$(this).addClass("hide")}}))},this.initWindow=function(){(t=n.get("left-grouped-list-and-right-description-window")).addClass("recipes-manager"),$(".crafting__contents:first .recipes-content").html(t)},this.initSelect=function(){var i=t,n=i.find(".choose-prof"),s=i.find(".choose-item-type"),r=[{val:"all",text:_t("prof_all",null,"auction")},{val:a.MAGE,text:_t("prof_mage",null,"auction")},{val:a.WARRIOR,text:_t("prof_warrior",null,"auction")},{val:a.PALADIN,text:_t("prof_paladin",null,"auction")},{val:a.TRACKER,text:_t("prof_tracker",null,"auction")},{val:a.HUNTER,text:_t("prof_hunter",null,"auction")},{val:a.BLADE_DANCER,text:_t("prof_bdancer",null,"auction")}];n.createMenu(r,!0,(function(t){e.startFilter()}));var o=[{val:"all",text:_t("type_all",null,"auction")},{val:"unique",text:_t("type_unique",null,"auction")},{val:"heroic",text:_t("type_heroic",null,"auction")},{val:"legendary",text:_t("type_legendary",null,"auction")}];s.createMenu(o,!0,(function(t){e.startFilter()}))},this.initLabels=function(){var e=t;e.find(".receipe-header-label").html(this.tLang("recipe")),e.find(".reagents-label").html(this.tLang("reagents_recipe")),e.find(".left-column-list-label").html(this.tLang("list_recipes")),e.find(".empty").html(this.tLang("recipse_info"))},this.initScrollsBar=function(){$(".left-scroll",t).addScrollBar({track:!0}),$(".right-scroll",t).addScrollBar({track:!0})},this.updateScroll=function(){$(".left-scroll",t).trigger("update"),$(".right-scroll",t).trigger("update")},this.createRecipesList=function(t,i,a,s){var r=t.enabled?"enabled":"disabled",o=n.get("one-item-on-divide-list").addClass("crafting-recipe-in-list "+r);o.addClass("recipe-id-"+i),o.find(".name").html(t.name),e.appendRecipeToGroup(o,t.itemTpl,a,s,t.enabled),this.recipeClick(o,i)},this.appendRecipeToGroup=function(t,e,i,n,a){const s=Engine.tpls.getTplByIdAndLoc(e,Engine.itemsFetchData.NEW_RECIPE_TPL.loc);let r="all",o="all",l=["unique","heroic","legendary"],c=s.cl,d=s._cachedStats;isset(d.lvl)&&t.attr("lvl",d.lvl),isset(d.reqp)&&(r=d.reqp);for(const t of l)s.itemTypeName===t&&(o=t);t.attr("typeItem",o),t.attr("reqp",r),isset(n[c])||(n[c]={enabled:[],disabled:[]}),a?n[c].enabled.push(t):n[c].disabled.push(t)},this.createGroupElement=function(i,a){var s=t.find(".group-"+i);let r;s.length<1&&(r=(s=n.get("divide-list-group")).find(".group-header"),s.addClass(`group-${i} active`),s.find(".label").html(_t("au_cat"+i,null,"auction")),t.find(".items-list").append(s),r.click((function(){s.toggleClass("active"),e.updateScroll()}))),s.find(".group-list").append(a)},this.createRecipe=function(t,e){var i=n.get("crafting-description-header"),a=n.get("crafting-description-reagents"),s=n.get("crafting-description-button");this.createResultItem(i,t.itemTpl),this.useRecipeBtn(s,t.enabled),this.createReagents(a,t),i.find(".offer-name").html(t.name),r[e]&&delete r[e],r[e]={header:i,reagents:a,button:s}},this.createResultItem=function(t,e){const i=this.getRecipeIcon(e);t.find(".result-item").append(i)},this.createReagents=function(t,e){var i=e.ingredients,a=e.missing;for(const e of i){const[i,s]=e,r=this.items[i];let o;const l=n.get("crafting-reagent"),c=l.find(".item-slot"),d=a&&a.find(t=>t[0]===i);if(d){const[t,e]=d;l.find(".amount-items").addClass("disabled"),o=s-e}else o=s;l.find(".have").html(o),l.find(".need").html(s),l.find(".item-name").html(r.name),t.find(".reagents-list").append(l);const h=this.getRecipeIcon(i);c.append(h)}},this.cleanList=function(){var e=t;e.find(".recipe-description").remove(),e.find(".crafting-recipe-in-list").remove(),e.find(".empty").css("display","block")},this.useRecipeBtn=function(t,e){var i=n.get("button").addClass("small"),a=e?"green":"black",s=this.tLang("use_recipe");i.addClass(a),i.find(".label").html(s),t.find(".use-recipe-btn").append(i)},this.confirmUseRecipe=function(t){_g("craft&a=use&id="+t,(function(){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,24),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,24),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,25),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,25),e.callCheckCanFinishExternalTutorialUseRecipe(t)}))},this.callCheckCanFinishExternalTutorialUseRecipe=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(s.ON_FINISH_REQUIRE.USE_RECIPE,s.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.callCheckCanFinishExternalTutorialClickRecipeOnList=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(s.ON_FINISH_REQUIRE.CLICK_RECIPE_ON_LIST,s.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.recipeClick=function(t,i){t.click((function(t){t.stopPropagation(),e.showRecipe(i),e.callCheckCanFinishExternalTutorialClickRecipeOnList(i)}))},this.showRecipe=function(n){var a=t,s=r[n];i=n,a.find(".mark-offer").removeClass("mark-offer"),a.find(".recipe-id-"+n).addClass("mark-offer"),a.find(".board").css("display","block"),a.find(".right-column-header .crafting-description-header").detach(),a.find(".right-column-header").html(s.header),a.find(".all-items-wrapper .crafting-description-reagents").detach(),a.find(".all-items-wrapper").html(s.reagents),a.find(".do-recipe").html(s.button),e.updateScroll();var o=t.find(".use-recipe-btn>.button");o.hasClass("black")||(o.off("click"),o.click((function(){e.confirmUseRecipe(n)})),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,23,o),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,23,o),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,24),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,24))},this.initSearch=function(){var i=t.find(".search"),n=t.find(".search-x");i.keyup((function(){e.startFilter()})),i.attr("placeholder",_t("search")),n.on("click",(function(){i.val("").blur().trigger("keyup")}))},this.getRecipeIcon=function(t){return Engine.tpls.createViewIcon(t,Engine.itemsViewData.RECIPE_ITEM_VIEW,Engine.itemsFetchData.NEW_RECIPE_TPL.loc)[0]},this.newRecipeItem=function(t,e){this.items[t.id]=t,t.$.on("contextmenu",(function(e){t.createOptionMenu(e)})),e&&this.createAllRecipes()},this.update=function(t){this.recipes=t},this.createAllRecipes=function(){let t={},n={};this.cleanList();for(let e in this.recipes){var a=this.recipes[e];this.createRecipesList(a,e,t,n),this.createRecipe(a,e)}for(let t in n){let i=n[t];i.enabled.sort((function(t,e){let i=$(t).find(".name").html(),n=$(e).find(".name").html();return i<n?-1:i>n?1:0})),i.disabled.sort((function(t,e){let i=$(t).find(".name").html(),n=$(e).find(".name").html();return i<n?-1:i>n?1:0}));for(let n in i.enabled)e.createGroupElement(t,i.enabled[n]);for(let n in i.disabled)e.createGroupElement(t,i.disabled[n])}null!==i&&e.showRecipe(i),this.countRecipesPerGroup(),this.updateScroll(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,23),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,23),Engine.crafting.wnd.updateWindowTrigger()},this.deleteRecipes=function(){for(var t in r){var e=r[t];delete r[t],e.header.remove(),e.reagents.remove(),e.button.remove()}},this.close=function(){e.deleteRecipes(),r=null,this.recipes=[],this.items={},Engine.tpls.removeCallback(Engine.itemsFetchData.NEW_RECIPE_TPL),Engine.tpls.deleteMessItemsByLoc(Engine.itemsFetchData.NEW_RECIPE_TPL.loc),Engine.crafting.recipes=!1,Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,26),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,26)},this.tLang=function(t){return _t(t,null,"recipes")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0);e.default=class{constructor(t){this.wndEl=t,this.reagentsGridSize={x:5,y:5},this.maxReagentsLimit=this.reagentsGridSize.y*this.reagentsGridSize.x,this.selectedInventoryItems=[],this.reagentSlotsOld={},this.reagentSlots={},this.receivedItems={},this.requestBlock=!1,this.deboucedReagentDelete=debounce(t=>{this.reagentDelete(t)},10),this.createContent(),this.initScroll(),this.droppableInit(),this.getEngine().tpls.fetch(Engine.itemsFetchData.NEW_SALVAGE_RECEIVED_TPL,this.newReceivedItem.bind(this)),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.SALVAGE),this.getEngine().interfaceItems.setDisableSlots("salvage")}newReceivedItem(t,e){if(!isset(this.receivedItems[t.id]))return;const i=this.getEngine().tpls.createViewIcon(t.id,this.getEngine().itemsViewData.SALVAGE_ITEM_VIEW,"h")[0][0];this.updateAmount(t,i),this.receivedItems[t.id].icon=i,this.receivedItems[t.id].itemTypeSort=t.itemTypeSort,e&&this.appendReceivedItems(),i.addEventListener("contextmenu",e=>{t.createOptionMenu(e)})}appendReceivedItems(){const t=this.sortTpls(this.receivedItems);for(let e=0;e<t.length;e++)this.setReceivedItemSlot(t[e].icon,e),this.receivesGridEl.appendChild(t[e].icon)}sortTpls(t){return Object.values(t).sort((t,e)=>t.itemTypeSort-e.itemTypeSort)}setReceivedItemSlot(t,e){const i=Math.floor(e/8),n=e-8*i;t.style.left=32*n+n+1+"px",t.style.top=32*i+i+1+"px"}updateAmount(t,e){const i=this.receivedItems[t.id].amount;this.getEngine().tpls.changeItemAmount(t,$(e),i)}createContent(){const t=a.get("salvage")[0];this.contentEl=this.wndEl.querySelector(".salvage-content"),this.contentEl.innerHTML="",this.contentEl.appendChild(t),this.createConfirmButton(),this.reagentsGridEl=this.contentEl.querySelector(".salvage__reagents"),this.receivesGridEl=this.contentEl.querySelector(".salvage__receives")}initScroll(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}createConfirmButton(){const t=createButton(_t("submit",null,"salvager"),["small","green","disable"],this.confirmOnClick.bind(this));this.contentEl.querySelector(".salvage__submit").appendChild(t)}confirmOnClick(){const t=_t("confirm-prompt",null,"salvager");askAlert({q:t,clb:()=>this.preSalvage(),m:"yesno4"})}preSalvage(){(0,n.enhancedItemConfirmIfNeeded)(this.selectedInventoryItems,()=>this.doSalvage())}doSalvage(){if(this.selectedInventoryItems.length>0){const t=this.selectedInventoryItems.join(",");_g("salvager&action=salvage&selectedItems="+t,()=>{})}}setConfirmButton(){const t=this.contentEl.querySelector(".salvage__submit .button");Object.keys(this.reagentSlots).length>0?t.classList.remove("disable"):t.classList.add("disable")}sendRequest(){if(this.selectedInventoryItems.length>0){const t=this.selectedInventoryItems.join(",");this.requestBlock=!0,_g("salvager&action=preview&selectedItems="+t,this.afterRequest.bind(this))}}afterRequest(t){!isset(t.item_tpl&&isset(t.msg))&&this.selectedInventoryItems.length>0&&this.selectedInventoryItems.pop(),this.requestBlock=!1}droppableInit(){$(this.reagentsGridEl).droppable({accept:".inventory-item",drop:(t,e)=>{e.draggable.css("opacity",""),this.onClickInventoryItem(e.draggable.data("item"))}})}onClickInventoryItem(t){if(this.requestBlock)return;const e=t.id;if(this.selectedInventoryItems.includes(e))this.reagentDelete(e);else{if(!this.canSelectNextItem())return;this.selectedInventoryItems.push(e),this.sendRequest()}}canSelectNextItem(){return this.selectedInventoryItems.length<this.maxReagentsLimit}addReagentItem(t){let e=null;for(var i=0;i<this.reagentsGridSize.y;i++){for(var n=0;n<this.reagentsGridSize.x;n++)if(!isset(this.reagentSlots[n+","+i])){e=[n,i];break}if(e)break}if(null!==e){this.reagentSlots[e[0]+","+e[1]]=t.id;let i=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.SALVAGE_VIEW)[0][0];i.dataset.item=t,i.style.top=32*e[1]+e[1]+1+"px",i.style.left=32*e[0]+e[0]+1+"px",this.reagentsGridEl.appendChild(i),i.addEventListener("click",()=>{this.onClickInventoryItem(t)}),i.addEventListener("contextmenu",e=>{let i={txt:_t("move",null,"item"),f:()=>{this.onClickInventoryItem(t)}};t.createOptionMenu(e,i,{move:!0,use:!0,split:!0,drop:!0,itemId:!0,destroy:!0,enhance:!0,attachToQuickItems:!0,moveToEnhancement:!0})}),this.getEngine().itemsMovedManager.addItem(t,this.getEngine().itemsMovedData.SALVAGE,()=>{this.onClickInventoryItem(t)}),t.on("delete",()=>this.onReagentDelete(t.id))}this.setConfirmButton()}onReagentDelete(t){removeFromArray(this.selectedInventoryItems,t),this.deboucedReagentDelete(t)}reagentDelete(t){removeFromArray(this.selectedInventoryItems,t),this.selectedInventoryItems.length>0?this.sendRequest():this.clearAll()}removeReagentItem(t){const e=this.getEngine().items.getItemById(t);e.unregisterCallback("delete",()=>this.onReagentDelete(e.id)),removeFromArray(this.selectedInventoryItems,t),this.getEngine().items.deleteViewIconIfExist(t,this.getEngine().itemsViewData.SALVAGE_VIEW),this.getEngine().itemsMovedManager.removeItem(t),this.setConfirmButton()}update(t){this.removeAllReceivedItems(),this.reagentSlotsOld=this.reagentSlots,this.reagentSlots={};const e=arrayEquals(t.item,this.selectedInventoryItems)?this.selectedInventoryItems:t.item;for(const t of e){this.getEngine().items.deleteViewIconIfExist(t,this.getEngine().itemsViewData.SALVAGE_VIEW);const e=this.getEngine().items.getItemById(t);this.addReagentItem(e)}for(const e of t.recived){const[t,i]=e;this.receivedItems[t]={id:t,amount:i,icon:null,itemTypeSort:null}}this.removeOldReagentItems()}removeOldReagentItems(){const t=Object.values(this.reagentSlotsOld),e=Object.values(this.reagentSlots);if(t.length>e.length){let i=t.filter(t=>!e.includes(t));for(const t of i)this.removeReagentItem(t)}}removeAllReceivedItems(){this.receivedItems={},this.getEngine().tpls.deleteMessItemsByLoc("h")}clearAll(){this.reagentSlots={},this.selectedInventoryItems=[],this.getEngine().items.deleteAllViewsByViewName(this.getEngine().itemsViewData.SALVAGE_VIEW),this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.SALVAGE),this.removeAllReceivedItems(),this.setConfirmButton()}close(){this.clearAll(),this.getEngine().tpls.removeCallback(Engine.itemsFetchData.NEW_SALVAGE_RECEIVED_TPL),this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.SALVAGE),this.getEngine().interfaceItems.setEnableSlots("salvage"),this.getEngine().crafting.salvage=!1}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),a=i(0),s=i(12),r=i(455),o=i(456),l=i(460);e.default=class{constructor(t){this.wndEl=t,this.upgradeLvl=0,this.maxUpgradeLvl=5,this.selectedEnhanceItem=null,this.requestBlock=!1,this.RT={SET_ENHANCE_ITEM:"SET_ENHANCE_ITEM",CHECK_PROGRESS:"CHECK_PROGRESS",ENCHANT:"ENCHANT",UPGRADE:"UPGRADE"},this.createContent(),this.initScroll(),this.getEngine().items.fetch(this.getEngine().itemsFetchData.NEW_ENHANCEMENT_RECEIVED_ITEM,this.newReceivedItem.bind(this)),this.dimStartDefault(),this.getEngine().interfaceItems.setDisableSlots("enhance")}createContent(){const t=a.get("enhance")[0];this.contentEl=this.wndEl.querySelector(".enhancement-content"),this.contentEl.innerHTML="",this.contentEl.appendChild(t),this.topInfoEl=this.contentEl.querySelector(".enhance__info--top"),this.enhanceItemSlotCurrent=this.contentEl.querySelector(".enhance__item--current .slot"),this.enhanceItemSlotCurrentLvl=this.contentEl.querySelector(".enhance__item--current .lvl"),this.enhanceItemSlotReceive=this.contentEl.querySelector(".enhance__item--receive .slot"),this.enhanceItemSlotReceiveLvl=this.contentEl.querySelector(".enhance__item--receive .lvl");const e=this.contentEl.querySelector(".enhance__enchant");this.enchant=new o.default(e);const i=this.contentEl.querySelector(".enhance__progressbar");this.progressbar=new r.default(i);const n=this.contentEl.querySelector(".enhance__enhance");this.upgrade=new l.default(n)}initScroll(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}updateScroll(){$(".scroll-wrapper",$(this.contentEl)).trigger("update")}newReceivedItem(t){const e=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.ENHANCE_REQUIRE_ITEM_VIEW,"u")[0][0];this.enhanceItemSlotReceive.appendChild(e),t.on("afterUpdate",()=>this.receivedItemAfterUpdate(t)),e.addEventListener("contextmenu",e=>{t.createOptionMenu(e,!1,{itemId:!0})}),this.receivedItemAfterUpdate(t)}receivedItemAfterUpdate(t){this.setUpgradeLvl(!0,t)}setUpgradeLvl(){let t=arguments.length>1?arguments[1]:void 0,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.enhanceItemSlotReceiveLvl:this.enhanceItemSlotCurrentLvl,i=parseInt((0,n.isset)(t)&&(0,n.isset)(t._cachedStats.enhancement_upgrade_lvl)?t._cachedStats.enhancement_upgrade_lvl:0);if(i!==parseInt(e.getAttribute("data-lvl"))){this.changeLvlAnim(),e.setAttribute("data-lvl",i.toString());let t=e.querySelector(".cl-icon");removeClassStartingWith(t,"icon-star-"),t.classList.add("icon-star-"+i)}}changeLvlAnim(){this.enhanceItemSlotReceiveLvl.classList.add("upper"),setTimeout(()=>{this.enhanceItemSlotReceiveLvl.classList.remove("upper")},200)}sendRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;if(!this.selectedEnhanceItem)return;const n=e.join(",");switch(t){case this.RT.SET_ENHANCE_ITEM:this.requestBlock=!0,_g("enhancement&action=status&item="+this.selectedEnhanceItem,this.afterRequest.bind(this));break;case this.RT.CHECK_PROGRESS:this.requestBlock=!0,_g(`enhancement&action=progress_preview&item=${this.selectedEnhanceItem}&ingredients=${n}`,()=>{i&&i(),this.requestBlock=!1});break;case this.RT.ENCHANT:_g(`enhancement&action=progress&item=${this.selectedEnhanceItem}&ingredients=${n}`,i)}}afterRequest(t){let{enhancement:e}=t;this.requestBlock=!1,(0,n.isset)(e)&&(0,n.isset)(e.upgradable||e.progressing||e.completed)&&this.addItemToEnchant()}addItemToEnchant(){let t=this.getEngine().items.getItemById(this.selectedEnhanceItem),e=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.ENHANCE_ITEM_VIEW)[0][0];e.addEventListener("click",()=>{this.onClickInventoryItem(t)}),e.addEventListener("contextmenu",e=>{let i={txt:_t("move",null,"item"),f:()=>{this.onClickInventoryItem(t)}};t.createOptionMenu(e,i,{move:!0,use:!0,split:!0,drop:!0,itemId:!0,destroy:!0,enhance:!0,attachToQuickItems:!0,moveToEnhancement:!0})}),this.getEngine().itemsMovedManager.addItem(t,this.getEngine().itemsMovedData.ENHANCE,()=>{this.onClickInventoryItem(t)}),t.on("delete",()=>this.clearAll()),this.enhanceItemSlotCurrent.innerHTML="",this.enhanceItemSlotCurrent.appendChild(e),t.on("afterUpdate",()=>this.enchantItemAfterUpdate(t.id)),this.enchantItemAfterUpdate(t.id),this.dimStartIngredients(t._cachedStats.rarity),this.markReagents()}enchantItemAfterUpdate(t){const e=this.getEngine().items.getItemById(t);this.setUpgradeLvl(!1,e),this.addUpgradedLevelClass()}removeItemFromEnchant(){if(null!=this.selectedEnhanceItem){const t=this.getEngine().items.getItemById(this.selectedEnhanceItem);t.unregisterCallback("afterUpdate",()=>this.enchantItemAfterUpdate(t.id)),t.unregisterCallback("delete",()=>this.clearAll()),this.selectedEnhanceItem=null}}addUpgradedLevelClass(){const t=this.contentEl.querySelector(".enhance__content");this.removeUpgradedLevelClass(),t.classList.add("upgraded-"+this.upgradeLvl)}removeUpgradedLevelClass(){const t=this.contentEl.querySelector(".enhance__content");removeClassStartingWith(t,"upgraded-")}onEmptyReagents(){this.sendRequest(this.RT.SET_ENHANCE_ITEM)}onClickInventoryItem(t){if(this.requestBlock)return;const e=parseInt(t.id);if(!this.selectedEnhanceItem)return this.selectedEnhanceItem=e,void this.sendRequest(this.RT.SET_ENHANCE_ITEM);this.selectedEnhanceItem!==e?s.isInBagSt(t.st)&&this.enchant.onClickReagent(t):this.clearAll()}update(t){this.requestBlock=!1,this.enchant.setReagentsDisableState(!1),this.enchant.setEnchantConfirmButton(),this.getEngine().crafting.tempEnhanceItemId&&((0,n.isset)(t.upgradable)||(0,n.isset)(t.progressing)||(0,n.isset)(t.completed))&&(this.selectedEnhanceItem||(this.selectedEnhanceItem=this.getEngine().crafting.tempEnhanceItemId,this.addItemToEnchant(),this.getEngine().crafting.tempEnhanceItemId=null)),(0,n.isset)(t.progressing)&&(this.upgradeLvl=t.progressing.upgradeLevel,this.progressbar.update({current:t.progressing.current,max:t.progressing.max,upgradeLevel:t.progressing.upgradeLevel}),this.enchant.clearReagents()),(0,n.isset)(t.progress_preview)&&this.progressbar.update({gained:t.progress_preview.gained,current:t.progress_preview.current,max:t.progress_preview.max,upgradeLevel:t.progress_preview.upgradeLevel}),(0,n.isset)(t.upgradable)&&(this.upgradeLvl=t.upgradable.upgradeLevel,this.enchant.reset(),this.progressbar.update({current:t.upgradable.current,max:t.upgradable.max,upgradeLevel:t.upgradable.upgradeLevel}),this.upgrade.update({data:t.upgradable,disable:!1}),this.enchant.setReagentsDisableState(!0),this.enchant.setEnchantDisableState(!0),this.setTopInfo(!0),this.unmarkReagents()),(0,n.isset)(t.completed)&&(this.upgradeLvl=this.maxUpgradeLvl,this.onCompleted()),(0,n.isset)(t.usages_preview)&&(this.getEngine().enhanceUsages=t.usages_preview,this.enchant.updateUsages(this.getEngine().enhanceUsages)),this.updateScroll()}getReagentBonus(t){const e=this.getEngine().items.getItemById(this.selectedEnhanceItem);return!(!(0,n.isset)(t)||!this.canMarkItems()||(0,n.isset)(t._cachedStats.target_rarity))&&(!s.isEquippedSt(t.st)&&(t.tpl===e.tpl?4:t.itemTypeName===e.itemTypeName&&(0,n.sameClGroup)([t.cl,e.cl])?3:t.itemTypeName===e.itemTypeName?2:!!(0,n.sameClGroup)([t.cl,e.cl])&&1))}canMarkItems(){return!(this.upgradeLvl===this.maxUpgradeLvl||this.upgradeLvl===this.maxUpgradeLvl-1&&this.progressbar.isFull())}markReagents(){if(!this.canMarkItems())return;let t=this.getEngine().disableItemsManager.getEnabledItems();t.includes(this.selectedEnhanceItem)&&(t=t.filter(t=>t!==this.selectedEnhanceItem)),this.getEngine().itemsMarkManager.markEnhanceReagentItems(t)}unmarkReagents(){this.getEngine().itemsMarkManager.unmarkEnhanceReagentItems()}setTopInfo(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.topInfoEl.classList.add("is-bonus"):this.topInfoEl.classList.remove("is-bonus")}onCompleted(){this.enchant.update({disable:!0}),this.upgrade.update({disable:!0}),this.progressbar.completed(),this.getEngine().items.deleteMessItemsByLoc("u")}dimStartDefault(){this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE_INGR),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE)}dimStartIngredients(t){this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE_INGR,{linkedConditions:[{classes:[26],stats:["enhancement_add",{target_rarity:["===",t]}]},{classes:[26],stats:["enhancement_add_point",{target_rarity:["===",t]}]}]})}upgradeLvlReset(){this.setUpgradeLvl(!0),this.setUpgradeLvl(!1)}clearAll(){this.removeItemFromEnchant(),this.progressbar.reset(),this.upgrade.reset(),this.enchant.reset(),this.setTopInfo(),this.getEngine().items.deleteMessItemsByLoc("u"),this.getEngine().items.deleteAllViewsByViewName(this.getEngine().itemsViewData.ENHANCE_ITEM_VIEW),this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.ENHANCE),this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.ENHANCE_INGR),this.unmarkReagents(),this.removeUpgradedLevelClass(),this.dimStartDefault(),this.upgradeLvlReset(),this.updateScroll()}close(){this.clearAll(),this.getEngine().crafting.tempEnhanceItemId=null,this.upgrade.destroy(),this.enchant.destroy(),this.getEngine().items.removeCallback(this.getEngine().itemsFetchData.NEW_ENHANCEMENT_RECEIVED_ITEM),this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE),this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.ENHANCE_INGR),this.getEngine().interfaceItems.setEnableSlots("enhance"),this.getEngine().crafting.enhancement=!1}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement"):""}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.el=t,this.lastMax=0,this.lastCurrent=0,this.lastPreview=0,this.lastUpgradeLevel=0,this.currentProgressEl=t.querySelector(".enhance__progress--current"),this.previewProgressEl=t.querySelector(".enhance__progress--preview"),this.currentProgressTextEl=t.querySelector(".enhance__progress-text--current"),this.previewProgressTextEl=t.querySelector(".enhance__progress-text--preview")}update(t){let{current:e,gained:i,max:n,upgradeLevel:a}=t,s=n?e/n*100:0;if(void 0!==i)this.setPreview(i,e,n,a);else{this.lastCurrent=e<=n?e:n,this.lastMax=n,this.lastUpgradeLevel=a;let t=e||n?`${formNumberToNumbersGroup(e)} / ${formNumberToNumbersGroup(n)}`:" ";this.setProgress(s,0,t,0)}}setPreview(t,e,i,n){let a,s,r=this.lastCurrent,o=r;n===this.lastUpgradeLevel?(e-=this.lastCurrent,s=i?r/i*100:0):(s=0,o=0),a=i?(o+e)/i*100:0,this.lastPreview=e=t;let l=`${formNumberToNumbersGroup(this.lastCurrent)} / ${formNumberToNumbersGroup(i)}`;this.setProgress(s,a,l,e)}setProgress(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.currentProgressEl.style.width=t+"%",this.currentProgressTextEl.innerText=i,this.previewProgressEl.style.width=(e<=100?e:100)+"%",this.previewProgressTextEl.innerText="+"+formNumberToNumbersGroup(n),n?this.previewTextShow():this.previewTextHide()}previewTextShow(){this.previewProgressTextEl.style.display="block"}previewTextHide(){this.previewProgressTextEl.style.display="none",this.previewProgressTextEl.innerHTML=""}isFull(){return this.lastCurrent===this.lastMax&&0!==this.lastCurrent}completed(){return this.setProgress(100,0,this.tLang("completed"),0),!0}reset(){this.update({current:0,max:0,upgradeLevel:0})}tLang(t){return Engine.crafting.enhancement.tLang(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(457),a=i(2),s=i(50),r=i(15),o=i(7);e.default=class{constructor(t){this.el=t,this.reagentsGridSize={x:5,y:5},this.maxReagentsLimit=this.reagentsGridSize.y*this.reagentsGridSize.x,this.reagentSlots={},this.addReagentsBlock=!0,this.selectedInventoryItems=[],this.deboucedReagentDelete=debounce(t=>{this.reagentDelete(t)},10),this.createContent(),this.droppableInit()}createContent(){this.createAutofiller(),this.createConfirmButton(),this.reagentsGridEl=this.el.querySelector(".enhance__reagents"),this.usageCounterEl=this.el.querySelector(".enhance__counter"),this.getEngine().enhanceUsages&&this.updateUsages(this.getEngine().enhanceUsages)}createAutofiller(){this.autofillerEl=this.el.querySelector(".enhance__autofiller");const t={btnTip:t=>_t("advanced_craftsman_choose_bag %val%",{"%val%":t}),btnFn:t=>this.autofillFrom(t),storageName:o.ENCHANT_AUTOFILLER,filters:{cl:[{key:r.CL.ONE_HAND_WEAPON,checked:!0,groupId:1},{key:r.CL.TWO_HAND_WEAPON,checked:!0,groupId:1},{key:r.CL.ONE_AND_HALF_HAND_WEAPON,checked:!0,groupId:1},{key:r.CL.DISTANCE_WEAPON,checked:!0,groupId:1},{key:r.CL.HELP_WEAPON,checked:!0,groupId:1},{key:r.CL.WAND_WEAPON,checked:!0,groupId:1},{key:r.CL.ORB_WEAPON,checked:!0,groupId:1},{key:r.CL.ARMOR,checked:!0,groupId:1},{key:r.CL.HELMET,checked:!0,groupId:1},{key:r.CL.BOOTS,checked:!0,groupId:1},{key:r.CL.GLOVES,checked:!0,groupId:1},{key:r.CL.RING,checked:!0,groupId:1},{key:r.CL.NECKLACE,checked:!0,groupId:1},{key:r.CL.SHIELD,checked:!0,groupId:1},{key:r.CL.QUIVER,checked:!0,groupId:1}]},configWindow:{title:_t("advanced_craftsman"),heading:this.tLang("info6"),cssClass:"",groups:[{id:1,title:_t("itemKinds",null,"autofiller")}]},itemGrabberOptions:{allow:{cls:[],stats:[{name:"rarity",params:["===","common"]},{name:"lvl",params:[">=",20]}]},deny:{stats:["artisan_worthless"]}}};this.autofiller=new n.default(t),this.autofiller.disabled(),this.autofillerEl.appendChild(this.autofiller.getContent())}autofillFrom(t){this.addManyReagentItems(t)}droppableInit(){$(this.reagentsGridEl).droppable({accept:".inventory-item",drop:(t,e)=>{e.draggable.css("opacity",""),this.getEnhancement().onClickInventoryItem(e.draggable.data("item"))}})}onClickReagent(t){if(this.addReagentsBlock||this.getEnhancement().requestBlock)return;const e=t.id;if(this.selectedInventoryItems.includes(e))this.reagentDelete(t.id,!0);else{if(!this.canSelectNextItem())return;this.selectedInventoryItems.push(e),t.on("delete",()=>this.onReagentDelete(e)),this.sendReagentsRequest(t)}}isCorrectReagent(t){const e=this.getEngine().items.getItemById(this.getEnhancement().selectedEnhanceItem);if(e.id===t.id)return!1;const i=(0,a.isset)(t._cachedStats.target_rarity);return!i||i&&t._cachedStats.target_rarity===e.itemTypeName}onReagentDelete(t){removeFromArray(this.selectedInventoryItems,t),this.deboucedReagentDelete(t)}onEmptyReagents(){this.getEnhancement().onEmptyReagents()}reagentDelete(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.getEngine().items.getItemById(t);removeFromArray(this.selectedInventoryItems,t),this.selectedInventoryItems.length>0?this.sendReagentsRequest(i,!1):(this.removeReagentItem(t),e&&this.onEmptyReagents())}sendReagentsRequest(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getEnhancement().sendRequest(this.getEnhancement().RT.CHECK_PROGRESS,this.selectedInventoryItems,()=>{e?this.isCorrectReagent(t)?this.addReagentItem(t):removeFromArray(this.selectedInventoryItems,t.id):(0,a.isset)(t)&&this.removeReagentItem(t.id)})}addManyReagentItems(t){let e=0;for(const i of t)this.isCorrectReagent(i)&&!this.isReagentItemIsSelectedAlready(i.id)&&this.canSelectNextItem()&&(e++,this.selectedInventoryItems.push(i.id),this.addReagentItem(i));e>0&&this.getEnhancement().sendRequest(this.getEnhancement().RT.CHECK_PROGRESS,this.selectedInventoryItems)}isReagentItemIsSelectedAlready(t){return this.selectedInventoryItems.includes(t)}addReagentItem(t){let e=null;for(var i=0;i<this.reagentsGridSize.y;i++){for(var n=0;n<this.reagentsGridSize.x;n++)if(!(0,a.isset)(this.reagentSlots[n+","+i])){e=[n,i];break}if(e)break}if(null!==e){this.reagentSlots[e[0]+","+e[1]]=t.id;let i=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.ENHANCE_REAGENT_VIEW)[0][0];i.dataset.item=t,i.style.top=32*e[1]+e[1]+1+"px",i.style.left=32*e[0]+e[0]+1+"px",this.reagentsGridEl.appendChild(i),i.addEventListener("click",()=>{this.onClickReagent(t)}),i.addEventListener("contextmenu",e=>{let i={txt:_t("move",null,"item"),f:()=>{this.onClickReagent(t)}};t.createOptionMenu(e,i,{move:!0,use:!0,split:!0,drop:!0,itemId:!0,destroy:!0,enhance:!0,attachToQuickItems:!0,moveToEnhancement:!0})}),this.getEngine().itemsMovedManager.addItem(t,this.getEngine().itemsMovedData.ENHANCE,()=>{this.onClickReagent(t)})}this.setEnchantConfirmButton()}removeReagentItem(t){for(const e in this.reagentSlots)this.reagentSlots[e]==t&&delete this.reagentSlots[e];removeFromArray(this.selectedInventoryItems,t),this.getEngine().items.deleteViewIconIfExist(t,this.getEngine().itemsViewData.ENHANCE_REAGENT_VIEW),this.getEngine().itemsMovedManager.removeItem(t),this.setEnchantConfirmButton()}canSelectNextItem(){return this.selectedInventoryItems.length<this.maxReagentsLimit}createConfirmButton(){const t={selector:".enhance__submit",txt:this.tLang("submit_btn"),classes:["small","green","disable"],onClick:this.confirmOnClick.bind(this)},e=createButton(t.txt,t.classes,t.onClick);this.el.querySelector(t.selector).appendChild(e)}setEnchantConfirmButton(){const t=this.el.querySelector(".enhance__submit .button");Object.keys(this.reagentSlots).length>0?t.classList.remove("disable"):t.classList.add("disable")}confirmOnClick(){const t=new s.default,e=this.getEngine().items.getItemById(this.getEnhancement().selectedEnhanceItem);t.addCondition(()=>!0,this.tLang("confirm-prompt")).addCondition(()=>(0,a.checkReducedRequirementItems)(this.selectedInventoryItems),_t("reduced-requirement-item-confirm")).addCondition(()=>(0,a.checkBetterItemClass)(this.selectedInventoryItems,e),_t("better-item-class-confirm")).addCondition(()=>(0,a.checkEnhancedItems)(this.selectedInventoryItems),_t("enhanced-item-confirm")).addCondition(()=>(0,a.checkPersonalItems)(this.selectedInventoryItems),_t("personal-item-confirm")).processConditions(()=>this.getEnhancement().sendRequest(this.getEnhancement().RT.ENCHANT,this.selectedInventoryItems,this.afterEnchant.bind(this)))}afterEnchant(t){}setEnchantDisableState(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?(this.el.classList.add("disabled"),this.addReagentsBlock=!0,this.setReagentsDisableState(!0)):(this.el.classList.remove("disabled"),this.addReagentsBlock=!1,this.setReagentsDisableState(!1)),this.setEnchantConfirmButton()}setReagentsDisableState(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?(this.reagentsGridEl.classList.add("disabled"),this.autofiller.disabled(),this.addReagentsBlock=!0):(this.autofiller.enabled(),this.reagentsGridEl.classList.remove("disabled"),this.addReagentsBlock=!1),this.setEnchantConfirmButton()}updateUsages(t){let{count:e,limit:i}=t;this.usageCounterEl.textContent=`${e}/${i}`}update(t){let{data:e,disable:i}=t;void 0!==i&&this.setEnchantDisableState(i)}clearReagents(){this.selectedInventoryItems=[],this.reagentSlots={},this.getEngine().items.deleteAllViewsByViewName(this.getEngine().itemsViewData.ENHANCE_REAGENT_VIEW);const t=this.getEnhancement().selectedEnhanceItem?[this.getEnhancement().selectedEnhanceItem]:[];this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.ENHANCE,t),this.setEnchantConfirmButton()}reset(){this.setEnchantDisableState(!1),this.setReagentsDisableState(!0),this.setEnchantConfirmButton(),this.clearReagents()}destroy(){this.autofiller.reset()}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement"):""}getEnhancement(){return this.getEngine().crafting.enhancement}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(23),a=i(458),s=i(459),r=i(2),o=i(0),l={btnTip:t=>_t("great_merchamp_info %val%",{"%val%":t},"shop")};e.default=class{constructor(t){this.bagsAmount=3,this.el=o.get("autofiller")[0],this.options=Object.assign(Object.assign({},l),t),this.autofillerConfig=new s.default(this.options.configWindow,this.getData(),t=>this.saveData(t)),this.itemGrabber=new a.default(this.options.itemGrabberOptions),this.afterDataSave(this.getData()),this.setContent()}setContent(){this.setButtons()}setButtons(){const t=this.prepareButtonOptions();for(const e of t){const t=new n.default(e).getButton();this.el.appendChild(t)}}prepareButtonOptions(){const t=[],e={text:(0,r.configIcon)(),classes:["small","green","autofiller-config-btn","not-peak"],action:()=>this.autofillerConfig.windowToggle(),tip:_t("config_tip",null,"buttons"),disabled:!1};for(let e=1;e<=this.bagsAmount;e++)t.push({text:e.toString(),classes:["small","green"],action:()=>this.autofillFrom(e),tip:this.options.btnTip(e),disabled:!1});return t.push(e),t}autofillFrom(t){const e=this.itemGrabber.grab(t);this.options.btnFn(e)}afterDataSave(t){const e=this.parseData(t);this.applyDataToItemGrabber(e)}parseData(t){const e={};return Object.keys(t).forEach((function(i,n){e[i]=t[i].filter(t=>t.checked).map(t=>t.key)})),e}applyDataToItemGrabber(t){for(const e in t)switch(e){case"cl":this.options.itemGrabberOptions.allow.cls=t.cl;break;case"rarity":const i=this.options.itemGrabberOptions.allow.stats.find(t=>"rarity"===t.name);i&&(i.params=["includes",t.rarity]);break;default:(0,r.errorReport)("Autofiller.js","applyDataToItemGrabber","No filter type "+e)}this.itemGrabber.setFilters(this.options.itemGrabberOptions)}mergeFilters(t,e){const i=JSON.parse(JSON.stringify(e));for(const e of Object.keys(t))if(i.hasOwnProperty(e))for(const n of t[e]){const t=n.key;i[e].find(e=>e.key===t)||i[e].push(n)}else i[e]=t[e];return i}getData(){const t=Engine.serverStorage.get(this.options.storageName);return t?this.mergeFilters(this.options.filters,t):Object.assign({},this.options.filters)}saveData(t){Engine.serverStorage.sendData({[this.options.storageName]:t},()=>{this.autofillerConfig.filtersUpdate(t),this.afterDataSave(t)})}enabled(){this.el.classList.remove("disabled")}disabled(){this.el.classList.add("disabled")}reset(){this.autofillerConfig.windowRemove()}getContent(){return this.el}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2);let a=i(12);e.default=class{constructor(t){this.setFilters(t)}setFilters(t){this.options=t}grab(t){--t;const e=[],i=Engine.heroEquipment.getHItems(),n=6*t,a=n+6;for(let t in i){const s=i[t];this.checkBag(s,n,a)&&(this.checkCl(s)&&this.checkStats(s)&&e.push(s))}return e}checkBag(t,e,i){return a.isInBagSt(t.st)&&t.y>=e&&t.y<i}checkCl(t){var e,i;let a=!0;return(0,n.isset)(this.options.allow.cls)&&(this.options.allow.cls.length>0&&(null===(e=this.options.allow.cls)||void 0===e?void 0:e.includes(t.cl))||(a=!1)),(0,n.isset)(this.options.deny.cls)&&(null===(i=this.options.deny.cls)||void 0===i?void 0:i.includes(t.cl))&&(a=!1),a}checkStats(t){let e=!0;t._cachedStats;const i=this.options.allow.stats,a=this.options.deny.stats;if((0,n.isset)(i))for(const n of i)this.checkOneStat(t,n)||(e=!1);if((0,n.isset)(a))for(const i of a)this.checkOneStat(t,i)&&(e=!1);return e}checkOneStat(t,e){if("object"==typeof e){const{name:i,params:a}=e;if(!t.haveStat(i))return!1;{const[e,s]=a,r=t._cachedStats[i];if((0,n.count)(e,r,s))return!0}}else if(t.haveStat(e))return!0;return!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(23),a=i(40),s=i(2),r=i(0),o=(i(15),{});e.default=class{constructor(t,e,i){this.data=e,this.saveCallback=i,this.isOpen=!1,this.el=r.get("autofiller")[0],this.options=Object.assign(Object.assign({},o),t),this.setInitialData(),this.windowInit(),this.setContent()}setContent(){this.setHeading(),this.createGroups(),this.setButtons()}setHeading(){this.wndEl.querySelector(".autofiller-config__heading").textContent=this.options.heading}setButtons(){const t=this.wndEl.querySelector(".autofiller-config__buttons"),e=[{text:_t("save",null,"buttons"),classes:["small","green"],action:()=>this.onClickSave()},{text:_t("cancel",null,"buttons"),classes:["small","green"],action:()=>this.windowClose()}];for(const i of e){const e=new n.default(i).getButton();t.appendChild(e)}}onClickSave(){this.saveCallback(this.tempData),this.windowClose()}filtersUpdate(t){this.data=JSON.parse(JSON.stringify(t)),this.setInitialData()}createGroups(){if(!(0,s.isset)(this.options.groups))return void(0,s.errorReport)("Autofiller.js","createGroups","No groups defined");const t=this.wndEl.querySelector(".autofiller-config__groups");for(const{id:e,title:i}of this.options.groups){const n=r.get("autofiller-config-group")[0];n.querySelector(".autofiller-config__title").textContent=i,n.classList.add("group-"+e),t.appendChild(n)}}setCheckboxes(){for(const t in this.tempData){const e=this.tempData[t];for(const{key:i,checked:n,groupId:s}of e){const e=this.wndEl.querySelector(`.group-${s} .autofiller-config__checkboxes`),r=this.getLabel(t,i),o=new a.default({name:`${t}_${i}`,label:r,value:i,i:i,checked:n,attrs:{"data-type":"cl"}},e=>this.onSelected(e,t,i)).getCheckbox();e.appendChild(o)}}}clearCheckboxes(){this.wndEl.querySelectorAll(".autofiller-config__checkboxes").forEach(t=>t.innerHTML="")}onSelected(t,e,i){const n=t.target.checked;this.tempData[e].find(t=>t.key===i).checked=n}getLabel(t,e){let i;switch(t){case"cl":i=_t("au_cat"+e,null,"auction");break;case"rarity":i=_t("rarity_"+e,null,"item");break;default:(0,s.errorReport)("Autofiller.js","getLabel","No filter type "+t)}return i}windowInit(){const t=r.get("autofiller-config");this.getEngine().windowManager.add({content:t,title:this.options.title,nameWindow:this.getEngine().windowsData.name.AUTOFILLER_CONFIG,objParent:this,type:this.getEngine().windowsData.type.TRANSPARENT,nameRefInParent:"wnd",managePosition:{x:"251",y:"65"},addClass:this.options.cssClass+" autofiller-window",onclose:()=>{this.close()}}),this.wnd.addToAlertLayer(),this.wnd.hide(),this.wnd.removeWndOnPeak(),this.wndEl=this.wnd.$[0]}getContent(){return this.el}windowToggle(){this.isOpen?this.windowClose():this.windowOpen()}setInitialData(){this.tempData=JSON.parse(JSON.stringify(this.data))}windowOpen(){this.setInitialData(),this.setCheckboxes(),this.wnd.show(),this.isOpen=!0,this.wnd.center(),this.wnd.setWndOnPeak()}windowClose(){this.wnd.hide(),this.isOpen=!1,this.clearCheckboxes(),this.tempData={}}windowRemove(){this.windowClose(),this.wnd.remove()}close(){this.windowClose()}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i(0);const n=i(113);e.default=class{constructor(t){this.el=t,this.disable=!0,this.lastData=null,this.upgradeLvl=null,this.selectedBonus=null,this.requireItemsFromEQ=[],this.requireItem={},this.createContent(),this.bonusSelector=new n.default(this.bonusChooseEl,{onSelectedClb:this.onBonusSelected.bind(this),ownSubmitBtn:!0}),this.setDisableState(!0),this.resetGold(),this.getEngine().tpls.fetch(Engine.itemsFetchData.NEW_UPGRADE_REQUIRE_TPL,this.newRequireItem.bind(this))}newRequireItem(t,e){const i=this.getEngine().tpls.createViewIcon(t.id,this.getEngine().itemsViewData.ENHANCE_REQUIRE_ITEM_VIEW,"u")[0][0];this.updateAmount(t,i),this.requireItemSlotEl.appendChild(i)}updateAmount(t,e){if(!isset(this.requireItem))return;const i=this.requireItem.amount;this.getEngine().tpls.changeItemAmount(t,$(e),i)}setDisableState(t){this.disable=t,this.disable?this.el.classList.add("disabled","hidden"):this.el.classList.remove("disabled","hidden")}createContent(){this.createConfirmButton(),this.bonusChooseEl=this.el.querySelector(".enhance__bonus"),this.goldAmountEl=this.el.querySelector(".enhance__r-gold-amount"),this.requireItemSlotEl=this.el.querySelector(".enhance__r-item")}onBonusSelected(t){this.selectedBonus=t,this.lastData?this.setStateConfirmButton(this.lastData):this.enableConfirmButton()}clearBonus(){this.bonusChooseEl.innerHTML=""}createConfirmButton(){const t={selector:".enhance__submit2",txt:this.tLang("submit_btn2"),classes:["small","green","disable"],onClick:this.confirmOnClick.bind(this)},e=this.el.querySelector(t.selector);this.confirmBtnEl=createButton(t.txt,t.classes,t.onClick),e.appendChild(this.confirmBtnEl)}confirmOnClick(){const t=this.lastData?{"%val%":formNumberToNumbersGroup(this.lastData.goldPrice)}:null,e=this.tLang("upgrade_cost %val%","enhancement",t),i=this.tLang("confirm-prompt");askAlert({q:t?e+i:i,clb:()=>this.doUpgrade(),m:"yesno4"})}doUpgrade(){const t=4===this.upgradeLvl?"&bonusIdx="+this.selectedBonus:"";_g(`enhancement&action=upgrade&item=${this.getEnhancement().selectedEnhanceItem}${t}`,t=>{isset(t.progressing)&&this.reset()})}enableConfirmButton(){this.confirmBtnEl.classList.remove("disable")}disableConfirmButton(){this.confirmBtnEl.classList.add("disable")}update(t){let{data:e,disable:i}=t;if(void 0!==e){this.lastData=e;const{bonuses:t,goldPrice:i,ingredientPrice:n,ingredientTplId:a,upgradeLevel:s}=e;this.upgradeLvl=s,this.setGoldAmount({goldPrice:i}),this.setRequireItem({ingredientPrice:n,ingredientTplId:a}),t.length>0&&this.bonusSelector.createBonusChoose(t),this.setStateConfirmButton(e)}void 0!==i&&this.setDisableState(i)}setStateConfirmButton(t){const{bonuses:e}=t;e.length>0&&null===this.selectedBonus?this.disableConfirmButton():this.checkRequires(t)?this.enableConfirmButton():this.disableConfirmButton()}checkRequires(t){const{goldPrice:e,ingredientPrice:i,ingredientTplId:n}=t;return e<=this.getEngine().hero.d.gold&&this.checkRequiresItemsAmount(n,i)}checkRequiresItemsAmount(t,e){return checkItemsAmount(t)>=e}setRequireItem(t){let{ingredientPrice:e,ingredientTplId:i}=t;this.requireItem={id:i,amount:e}}setGoldAmount(t){let{goldPrice:e}=t;const i=round(e,2);this.goldAmountEl.innerHTML=i}resetGold(){this.setGoldAmount({goldPrice:0})}removeRequireItem(){this.requireItem={},this.getEngine().tpls.deleteMessItemsByLoc("u")}reset(){this.requireItemsFromEQ=[],this.upgradeLvl=null,this.lastData=null,this.selectedBonus=null,this.removeRequireItem(),this.setDisableState(!0),this.disableConfirmButton(),this.resetGold(),this.clearBonus()}destroy(){this.removeRequireItem(),this.getEngine().tpls.removeCallback(Engine.itemsFetchData.NEW_UPGRADE_REQUIRE_TPL)}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"enhancement"):""}getEnhancement(){return this.getEngine().crafting.enhancement}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),a=i(462);e.default=class{constructor(t){this.wndEl=t,this.receivedCounter=0,this.receivedTpls={},this.selectedExtractItem=null,this.requestBlock=!1,this.createContent(),this.initScroll(),this.droppableInit(),this.getEngine().items.fetch(this.getEngine().itemsFetchData.NEW_EXTRACTION_RECEIVED_ITEM,this.newReceivedItem.bind(this)),this.getEngine().tpls.fetch(this.getEngine().itemsFetchData.NEW_EXTRACTION_RECEIVED_TPL,this.newReceivedItem.bind(this)),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.EXTRACTION),this.getEngine().interfaceItems.setDisableSlots("extraction")}createContent(){const t=n.get("extraction")[0];this.contentEl=this.wndEl.querySelector(".extraction-content"),this.contentEl.innerHTML="",this.contentEl.appendChild(t),this.extractItemSlot=this.contentEl.querySelector(".extraction__item"),this.extractItemSlotReceive=this.contentEl.querySelector(".extraction__receives");const e=this.contentEl.querySelector(".extraction__finalize");this.finalize=new a.default(e)}initScroll(){$(this.contentEl).find(".scroll-wrapper").addScrollBar({track:!0})}updateScroll(){$(".scroll-wrapper",$(this.contentEl)).trigger("update")}droppableInit(){$(this.extractItemSlot).droppable({accept:".inventory-item",drop:(t,e)=>{e.draggable.css("opacity",""),this.onClickInventoryItem(e.draggable.data("item"))}})}newReceivedItem(t){const e=t.isItem()?"items":"tpls",i=this.getEngine()[e].createViewIcon(t.id,this.getEngine().itemsViewData.EXTRACTION_RECEIVED_ITEM_VIEW,"j")[0][0];this.setReceivedItemSlot(i,this.receivedCounter),t.isItem()||this.updateAmount(t,i),i.addEventListener("contextmenu",e=>{t.createOptionMenu(e,!1,{itemId:!0})}),this.extractItemSlotReceive.appendChild(i),this.receivedCounter++}updateAmount(t,e){const i=this.receivedTpls[t.id];i>0&&this.getEngine().tpls.changeItemAmount(t,$(e),i)}setReceivedItemSlot(t,e){const i=Math.floor(e/8),n=e-8*i;t.style.left=32*n+n+1+"px",t.style.top=32*i+i+1+"px"}sendPreviewRequest(){this.selectedExtractItem&&(this.requestBlock=!0,_g("extractor&action=preview&item="+this.selectedExtractItem,this.afterPreviewRequest.bind(this)))}afterPreviewRequest(t){let{extractor:e}=t;this.requestBlock=!1,isset(e)&&isset(e.preview)?this.addItemToExtract():this.selectedExtractItem=null}addItemToExtract(){let t=this.getEngine().items.getItemById(this.selectedExtractItem),e=this.getEngine().items.createViewIcon(t.id,this.getEngine().itemsViewData.EXTRACTION_ITEM_VIEW)[0][0];e.addEventListener("click",()=>{this.onClickInventoryItem(t)}),e.addEventListener("contextmenu",e=>{let i={txt:_t("move",null,"item"),f:()=>{this.onClickInventoryItem(t)}};t.createOptionMenu(e,i,{move:!0,use:!0,split:!0,drop:!0,itemId:!0,destroy:!0,enhance:!0,attachToQuickItems:!0,moveToEnhancement:!0})}),this.getEngine().itemsMovedManager.addItem(t,this.getEngine().itemsMovedData.EXTRACTION,()=>{this.onClickInventoryItem(t)}),t.on("delete",()=>this.clearAll()),this.extractItemSlot.innerHTML="",this.extractItemSlot.appendChild(e),t.on("afterUpdate",()=>this.extractItemAfterUpdate(t.id)),this.extractItemAfterUpdate(t.id)}extractItemAfterUpdate(t){}removeItemFromEnchant(){if(null!=this.selectedExtractItem){const t=this.getEngine().items.getItemById(this.selectedExtractItem);t.unregisterCallback("afterUpdate",()=>this.extractItemAfterUpdate(t.id)),t.unregisterCallback("delete",()=>this.clearAll()),this.selectedExtractItem=null}}onClickInventoryItem(t){if(this.requestBlock)return;const e=parseInt(t.id);if(!this.selectedExtractItem)return this.selectedExtractItem=e,void this.sendPreviewRequest();this.selectedExtractItem!==e?t.st:this.clearAll()}update(t){if(this.requestBlock=!1,isset(t.completed)&&this.clearAll(),isset(t.preview)){const{ingredientItemTplId:e,ingredientItemAmount:i,progressItemTplId:n,progressItemAmount:a,prices:s}=t.preview;e&&(this.receivedTpls[e]=i),this.receivedTpls[n]=a,this.finalize.update(s)}this.updateScroll()}dimRestart(){this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.EXTRACTION),this.getEngine().disableItemsManager.startSpecificItemKindDisable(Engine.itemsDisableData.EXTRACTION)}clearAll(){this.removeItemFromEnchant(),this.finalize.reset(),this.getEngine().tpls.deleteMessItemsByLoc("j"),this.getEngine().items.deleteMessItemsByLoc("j"),this.getEngine().items.deleteAllViewsByViewName(this.getEngine().itemsViewData.EXTRACTION_ITEM_VIEW),this.getEngine().itemsMovedManager.removeItemsByTarget(this.getEngine().itemsMovedData.EXTRACTION),this.dimRestart(),this.receivedCounter=0,this.updateScroll()}close(){this.clearAll(),this.finalize.destroy(),this.getEngine().items.removeCallback(this.getEngine().itemsFetchData.NEW_EXTRACTION_RECEIVED_ITEM),this.getEngine().tpls.removeCallback(this.getEngine().itemsFetchData.NEW_EXTRACTION_RECEIVED_TPL),this.getEngine().disableItemsManager.endSpecificItemKindDisable(Engine.itemsDisableData.EXTRACTION),this.getEngine().interfaceItems.setEnableSlots("extraction"),this.getEngine().crafting.extraction=!1}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"extraction"):""}getEngine(){return Engine}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),a=i(121);e.default=class{constructor(t){this.el=t,this.radioList={radios:[{value:"z",label:""},{value:"s",label:""}],name:"extraction-payment",onSelected:this.onSelected.bind(this)},this.CURRENCY={GOLD:"gold",CREDITS:"credits"},this.disable=!0,this.payments=null,this.selected=null,this.paymentEl=this.el.querySelector(".extraction__payment"),this.buttonsContainerEl=this.el.querySelector(".extraction__submit"),this.setDisableState(!0),this.createConfirmButton()}createChoosePayment(){if(!this.payments)return;const{gold:t,credits:e}=this.payments;this.clearPayment(),this.radioList.radios[0].label=this.createPaymentOption(this.CURRENCY.GOLD,t.toString()),this.radioList.radios[1].label=this.createPaymentOption(this.CURRENCY.CREDITS,e.toString());const i=new a.default(this.radioList,{isInline:!0}).getList();this.paymentEl.appendChild(i)}createPaymentOption(t,e){const i=n.get("extractionPaymentOption")[0];return i.classList.add("extraction__currency--"+t),i.querySelector(".amount").innerHTML=round(e,2),i}onSelected(t){this.selected=t.target.value,this.setStateConfirmButton()}setStateConfirmButton(){null!==this.selected&&this.checkRequires()?this.enableConfirmButton():this.disableConfirmButton()}enableConfirmButton(){this.submitBtnEl.classList.remove("disable")}disableConfirmButton(){this.submitBtnEl.classList.add("disable")}checkRequires(){if(!this.payments)return!1;const{gold:t,credits:e}=this.payments;return t<=this.getEngine().hero.d.gold&&"z"===this.selected||e<=this.getEngine().hero.d.credits&&"s"===this.selected}createConfirmButton(){const t={txt:this.tLang("submit_btn"),classes:["small","green","disable"],onClick:this.confirmOnClick.bind(this)};this.submitBtnEl=createButton(t.txt,t.classes,t.onClick),this.buttonsContainerEl.appendChild(this.submitBtnEl)}confirmOnClick(){var t,e;const i="z"===this.selected?{"%val%":formNumberToNumbersGroup(null===(t=this.payments)||void 0===t?void 0:t.gold),"%val2%":_t("cost_gold")}:{"%val%":formNumberToNumbersGroup(null===(e=this.payments)||void 0===e?void 0:e.credits),"%val2%":_t("cost_credits")},n=this.tLang("extract_cost %val%","extraction",i),a=this.tLang("confirm-prompt");askAlert({q:n+a,clb:()=>this.sendExtractRequest(),m:"yesno4"})}sendExtractRequest(){const t=this.getExtraction().selectedExtractItem;_g(`extractor&action=extract&currency=${this.selected}&item=${t}`)}update(t){this.payments=t,this.createChoosePayment(),this.setDisableState(!1)}setDisableState(t){this.disable=t,this.disable?this.el.classList.add("disabled"):this.el.classList.remove("disabled")}clearPayment(){this.paymentEl.innerHTML=""}reset(){this.selected=null,this.payments=null,this.disableConfirmButton(),this.clearPayment(),this.setDisableState(!0)}destroy(){}tLang(t){return"undefined"==typeof RUNNING_UNIT_TEST?_t(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"extraction"):""}getExtraction(){return this.getEngine().crafting.extraction}getEngine(){return Engine}}},function(t,e){t.exports=function(){const t=()=>{e(),i(),n(),a(),s()},e=()=>{l().shop&&l().shop.close()},i=()=>{l().mails&&l().mails.close()},n=()=>{l().barter&&l().barter.close()},a=()=>{l().auctions&&l().auctions.close()},s=()=>{l().depo&&l().depo.close()},r=()=>{l().crafting.opened&&l().crafting.close()},o=()=>{r(),n()},l=()=>Engine;this.init=()=>{},this.callWindowCloseConfig=e=>{if(l().windowsData.windowCloseConfig[e])switch(e){case l().windowsData.windowCloseConfig.WORLD_WINDOW:case l().windowsData.windowCloseConfig.CRAFTING:t();break;case l().windowsData.windowCloseConfig.BARTER:r();break;case l().windowsData.windowCloseConfig.BONUS_SELECTOR:case l().windowsData.windowCloseConfig.DEPO:case l().windowsData.windowCloseConfig.AUCTION:case l().windowsData.windowCloseConfig.SHOP:case l().windowsData.windowCloseConfig.BATTLE:case l().windowsData.windowCloseConfig.DIALOGUE:case l().windowsData.windowCloseConfig.MAIL:case l().windowsData.windowCloseConfig.RELOAD:case l().windowsData.windowCloseConfig.TRADE:o()}else console.error("[WindowCloseManager.js, callWindowCloseConfig] That windowCloseConfig not exist!",e)}}},function(t,e){t.exports={name:{ACHIEVEMENTS:"ACHIEVEMENTS",ADDONS:"ADDONS",AUCTION_WND1:"AUCTION_WND1",AUCTION_WND2:"AUCTION_WND2",AUCTION_OFF_ITEM_PANEL:"AUCTION_OFF_ITEM_PANEL",BONUS_SELECTOR:"BONUS_SELECTOR",BONUS_RESELECT:"BONUS_RESELECT",BOOK:"BOOK",CATCH_CHAR:"CATCH_CHAR",CHANGE_OUTFIT:"CHANGE_OUTFIT",CHANGE_SERVER:"CHANGE_SERVER",CHESTS_ANIMATION:"CHESTS_ANIMATION",CHESTS_WINDOW:"CHESTS_WINDOW",CHOOSE_OUTFIT:"CHOOSE_OUTFIT",CODE_MANAGER:"CODE_MANAGER",CONQUER_STATS:"CONQUER_STATS",CONSOLE:"CONSOLE",DEPO:"DEPO",EVENT_CALENDAR:"EVENT_CALENDAR",GREAT_MERCHAMP:"GREAT_MERCHAMP",AUTOFILLER_CONFIG:"AUTOFILLER_CONFIG",HELP_WINDOW:"HELP_WINDOW",ALERT_WND:"ALERT_WND",LOG_OFF:"LOG_OFF",LOOT:"LOOT",LOOT_PREVIEW:"LOOT_PREVIEW",DETAILS_WND_MATCHMAKING:"DETAILS_WND_MATCHMAKING",MAIL_BOX:"MAIL_BOX",MATCHMAKING:"MATCHMAKING",MATCHMAKING_SUMMARY:"MATCHMAKING_SUMMARY",MC_ADDON:"MC_ADDON",MOTEL:"MOTEL",PAD_CONTROLLER:"PAD_CONTROLLER",PARTY:"PARTY",POLL:"POLL",PREMIUM_WND:"PREMIUM_WND",PRE_PREMIUM_PANEL:"PRE_PREMIUM_PANEL",PROMO:"PROMO",RECOVERY_ITEMS:"RECOVERY_ITEMS",REGISTRATION:"REGISTRATION",REWARDS_CALENDAR:"REWARDS_CALENDAR",SETTINGS:"SETTINGS",SHOW_EQ:"SHOW_EQ",ITEM_DETAILS:"ITEM_DETAILS",SHOW_MINIATURE:"SHOW_MINIATURE",SMC_ADDON:"SMC_ADDON",TP_SCROLL:"TP_SCROLL",BARTER:"BARTER",BATTLE_PASS:"BATTLE_PASS",CAPTCHA:"CAPTCHA",CLAN_WND:"CLAN_WND",SHOWCASE:"SHOWCASE",CRAFTING:"CRAFTING",WORLD:"WORLD",EDIT_MINI_MAP_WINDOW:"EDIT_MINI_MAP_WINDOW",MINI_MAP_WINDOW:"MINI_MAP_WINDOW",HANDHELD_WINDOW:"HANDHELD_WINDOW",NEWS:"NEWS",QUEST_OBSERVE:"QUEST_OBSERVE",QUESTS_PANEL:"QUESTS_PANEL",DRACONITE_SHOP:"DRACONITE_SHOP",PLAYER_PROFILE:"PLAYER_PROFILE",GOLD_SHOP:"GOLD_SHOP",SHOP_WRAPPER:"SHOP_WRAPPER",STAMINA_SHOP:"STAMINA_SHOP",SKILLS:"SKILLS",SOCIETY_LIST:"SOCIETY_LIST",TUTORIAL_CLOUD:"TUTORIAL_CLOUD",WANTED_LIST:"WANTED_LIST",EDIT_COLOR_PANEL_WHO_IS_HERE:"EDIT_COLOR_PANEL_WHO_IS_HERE",WHO_IS_HERE:"WHO_IS_HERE",CRAFTING_MINI_GAME:"CRAFTING_MINI_GAME",HIDDEN_MINI_GAME:"HIDDEN_MINI_GAME",MASTERMIND_MINI_GAME:"MASTERMIND_MINI_GAME",MEMO_MINI_GAME:"MEMO_MINI_GAME",PIPES_MINI_GAME:"PIPES_MINI_GAME",SAPER_MINI_GAME:"SAPER_MINI_GAME",CHAT_CONFIGURE:"CHAT_CONFIGURE",BATTLE_LOG:"BATTLE_LOG",BATTLE_PREDICTION_HELP_WINDOW:"BATTLE_PREDICTION_HELP_WINDOW",addon_5:"addon_5",addon_12:"addon_12",addon_17:"addon_17",addon_17_edit:"addon_17_edit",addon_19:"addon_19",addon_20:"addon_20",addon_24:"addon_24",addon_24_settings:"addon_24_settings",addon_27:"addon_27",addon_29:"addon_29"},windowCloseConfig:{BARTER:"BARTER",CRAFTING:"CRAFTING",WORLD_WINDOW:"WORLD_WINDOW",BATTLE:"BATTLE",SHOP:"SHOP",DIALOGUE:"DIALOGUE",MAIL:"MAIL",RELOAD:"RELOAD",AUCTION:"AUCTION",DEPO:"DEPO",BONUS_SELECTOR:"BONUS_SELECTOR",TRADE:"TRADE"},type:{TRANSPARENT:"transparent"},position:{CENTER:"CENTER",CENTER_OR_STICK_TO_EQ:"CENTER_OR_STICK_TO_EQ",CENTER_OR_SAVE_IN_STORAGE:"CENTER_OR_SAVE_IN_STORAGE",RIGHT_POSITIONING:"RIGHT_POSITIONING"}}},function(t,e){let i={name:{EXIT:"exit",SETTINGS:"config",FULL_SCREEN:"windows",ADDONS:"puzzle",CLAN:"clans",MAP:"globe",PARTY:"party",CHAT:"chat",CRAFTING:"photo",MINI_MAP:"portable-map-icon",WHO_IS_HERE:"compass",PREMIUM:"star",SKILLS:"skills",COMMUNITY:"friends",QUEST_LOG:"scroll",PICK_UP_ITEM:"drag-item-icon",ATTACK_MOB:"attack-near-mob",ATTACK_PLAYER:"attack-near-player",TALK:"npc-talk-icon",BATTLE_LOG:"fight-log",EQ_TOGGLE:"eq-show-icon",ATTACK_MOB_AUTO:"auto-fight-near-mob",USE_DOOR:"go-gateway",QUICK_PARTY:"quick-party",CONSOLE:"console",CLAN_MSG:"send-clan-msg",NEWS:"news-icon",BATTLE_PASS:"battle-pass-widget-icon",ACHIEVEMENTS:"achievements-icon",MATCHMAKING:"matchmaking-icon",REWARDS_CALENDAR:"rewards-calendar",ZOOM:"zoom-in-out-panel",PAD:"padController",WORLD:"world-icon",addon_5:"addon_5",addon_12:"addon_12",addon_17:"addon_17",addon_19:"addon_19",addon_20:"addon_20",addon_24:"addon_24",addon_27:"addon_27"},notice:{},pos:{TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_RIGHT_ADDITIONAL:"bottom-right-additional",BOTTOM_LEFT_ADDITIONAL:"bottom-left-additional",TOP_RIGHT_ADDITIONAL:"top-right-additional",TOP_LEFT_ADDITIONAL:"top-left-additional"},type:{RED:"red",GREEN:"green",VIOLET:"violet",BLINK_VIOLET:"blink-violet",BLUE:"blue",DISABLED:"disabled"},attr:{WIDGET_INDEX:"widget-index",WIDGET_NAME:"widget-name",WIDGET_POS:"widget-pos"},data:{WIDGET_KEY:"widgetKey"}};i.notice.NEWS={nameWidget:i.name.NEWS,nameNotice:1},i.notice.REWARDS_CALENDAR={nameWidget:i.name.REWARDS_CALENDAR,nameNotice:2,alwaysAvailable:!1},t.exports=i},function(t,e,i){var n=i(467);let a=i(32);t.exports=function(){let t="WindowManager.js",e={},i={},s={};this.init=()=>{this.initLayersAttachList()},this.initLayersAttachList=()=>{i[a.$_ALERTS_LAYER]={},i[a.$_M_ALERT_LAYER]={},i[a.$_M_ALERT_MOBILE_LAYER]={},i[a.$_TUTORIAL_LAYER]={},i[a.$_CONSOLE_LAYER]={},i[a.$_CAPTCHA_LAYER]={}},this.addToAttachLayer=t=>{let e=t.getAttachLayerName(),n=t._idWindow,a=t._nameWindow;i[e].hasOwnProperty(a)||(i[e][a]={}),i[e][a][n]=t},this.removeElementFromWidgetLinked=t=>{let e=t.getAttachWidgetName();e&&this.checkWidgetIsLinkedToWindow(e)&&delete s[e]},this.removeFromAttachLayer=t=>{let e=t.getAttachLayerName(),n=t._idWindow,a=t._nameWindow;delete i[e][a][n],Object.keys(i[e][a]).length||delete i[e][a]},this.checkOptIsCorrect=t=>t?t.nameWindow?!!t.content||(console.error("[WindowManager.js, checkOptIsCorrect] ","par opt.content not exist!!"),!1):(console.error("[WindowManager.js, checkOptIsCorrect] ","par opt.name not exist!!"),!1):(console.error("[WindowManager.js, checkOptIsCorrect] ","opt object not exist!!"),!1),this.manageRegisteredWindow=e=>{Engine.windowsData.name[e]||errorReport(t,"manageRegisteredWindow","Window unregistered!",e)},this.checkWindowIsShowByLinkedWidget=t=>this.getWndByLinkedWidgetName(t).isShow(),this.checkWindowIsShow=t=>!!e[t]&&e[t].isShow(),this.checkWidgetIsLinkedToWindow=t=>!!s[t],this.getWndByLinkedWidgetName=t=>{let e=s[t],i=e[0],n=e[1];return this.getWndByNameAndId(n,i)},this.addElementToWidgetLinkedWithWindow=(t,e,i)=>{s[i]=[e,t]},this.add=t=>{if(!this.checkOptIsCorrect(t))return;let e=t.nameWindow;this.manageRegisteredWindow(e);let i=new n(t);this.checkNameWindowExistInList(e)||this.createNameObjectInList(e);let a=this.getNewIdToWindow(e);return i.init(),this.addToList(e,a,i),this.addIdToWindow(i,a),t.widget&&this.addElementToWidgetLinkedWithWindow(e,a,t.widget),t.objParent&&(this.addNameRefInParentWindow(i,t.nameRefInParent),this.addParentToWindow(i,t.objParent),t.objParent[i._nameRefInParentWindow]=i),i},this.remove=(t,e)=>{let i=this.getWndByNameAndId(t,e);this.removeElementFromWidgetLinked(i),this.removeFromAttachLayer(i),this.removeFromList(i),i.$.remove(),i.parentWindow&&delete i.parentWindow[i._nameRefInParentWindow]},this.addIdToWindow=(t,e)=>{t._idWindow=e},this.addParentToWindow=(t,e)=>{t.parentWindow=e},this.addNameRefInParentWindow=(t,e)=>{t._nameRefInParentWindow=e},this.checkNameWindowExistInList=t=>e.hasOwnProperty(t),this.createNameObjectInList=t=>{e[t]={}},this.addToList=(t,i,n)=>{e[t][i]=n},this.getNewIdToWindow=t=>{let i=0;for(;e[t].hasOwnProperty(i);)i++;return i},this.removeFromList=t=>{let i=t._nameWindow,n=t._idWindow;delete e[i][n],Object.keys(e[i]).length||delete e[i]},this.getWndByNameAndId=(t,i)=>e[t][i],this.getList=()=>e,this.updatePosOfWindowsInSpecificLayer=t=>{a[t]||console.error("[WindowManager.js, updatePosOfWindowsInSpecificLayer] Layer name not exist:",t);let e=i[t];for(let t in e){let i=e[t];for(let t in i)i[t].updatePos()}},this.getLayersAttachList=()=>i}},function(t,e,i){var n=i(0),a=i(8);let s=i(32),r=i(27),o=i(105),l=i(70),c=i(123);t.exports=function(e){let i="Window.js";var d=this;let h=null,u=null,p=null,g=!1;const f=mobileCheck()?30:0;let m,v;this.$backdrop=null,this.getWindowTpl=()=>n.get("border-window"),this.initTplAndDraggable=()=>{this.$=this.getWindowTpl(),this.$.draggable({handle:".header-label-positioner",containment:"body",scroll:!1,drag:function(t,e){mobileCheck()&&E(e)},start:function(){d.setWndOnPeak()},stop:function(t){d.stopDrag(t)}}).css("position","absolute"),e=$.extend({onclose:function(){d.fadeAndRemove()},onstopdrag:function(t){},onopen:function(){},backdrop:!1,closeable:!0},e)},this.init=()=>{this.initTplAndDraggable(),this.initOptions(),this.initClose()};const E=t=>{let e=t.helper,i=("undefined"!=typeof Engine&&null!=Engine.zoomFactor&&Engine.zoomFactor,$("body")),n=e.outerWidth(),a=e.outerHeight(),s=i.width(),r=i.height(),o=Math.round(t.position.left),l=Math.round(t.position.top),c=_(n,a,s,r,o,l);t.position.left=c.left,t.position.top=c.top},_=(t,e,i,n,a,s)=>(s<30&&(s=30),s+e>n&&(s=n-e),a+t>i&&(a=i-t),{left:a,top:s});this.getAttachWidgetName=()=>u,this.setAttachWidgetName=t=>{u=t},this.addNameToWindow=t=>{this._nameWindow=t},this.addControll=function(t,e,i){this.$.find(".window-controlls").show();var a=n.get("button");return this.$.find(".window-controlls").append(a),e&&a.addClass(e),d.addCallback(i,a),a.find(".label").html(t),a},this.correctPositionMenuToRightEdgeOfWnd=()=>{let t=getEngine().interface,e=t.getPopupMenu();if(null==e)return;let i=this.$.position(),n=i.left,a=i.top,s=this.$.outerWidth(),r=this.$.outerHeight(),o=e.outerWidth(),l=e.outerHeight(),c=Engine.zoomFactor;n=n/c+s+o/2,a=a/c+r/2;let d=t.calcPopupMenuPos(n,a,o,l,!1);e.css({left:d.left,top:d.top}),e.css("transition","none")},this.setStartVH=function(t){mobileCheck()&&(this.startVH=t)},this.setCssVH=function(){if(mobileCheck()){for(var t=d.$.find(".inner-content>div").attr("class"),e="<style>",i=10;i>3;i--){var n=1.5*(100-10*i);e+=".zoom-factor-"+10*i+".mobile-version>.game-window-positioner>.alerts-layer>.border-window>.content>.inner-content>."+t,e+="{",e+="height: "+(d.startVH+n)+"vh;",e+="}"}e+="</style>",$(e).appendTo("head")}},this.addCallback=function(t,e){t&&(t.bind(d),e.click((function(){t()})))},this.initZIndex=function(){d.$.on("click",(function(t){t.target.classList.contains("label")||null!==t.target.closest(".not-peak")||d.setWndOnPeak()})),d.$.one("append",(function(){d.setWndOnPeak(),e.backdrop&&d.addBackdrop(e.backdrop)})),d.$.on("destroyed",(function(){d.removeBackdrop()}))},this.checkWndOnPeak=()=>d.$.hasClass("window-on-peak"),this.setWndOnPeak=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e="window-on-peak";d.$.hasClass(e)&&!t||(d.$.siblings(".border-window").removeClass(e),d.$.css("z-index",Engine.windowMaxZIndex++),d.$.addClass(e))},this.removeWndOnPeak=()=>{var t="window-on-peak";d.$.hasClass(t)&&d.$.removeClass(t)},this.setAsParent=function(e){e.constructor===t.exports&&e},this.removeParent=function(){null},this.setWindowAsDialog=function(e){e.constructor===t.exports&&(e.parentWnd=d,e,d.$.addClass("disable"))},this.removeDialog=function(){null,d.$.removeClass("disable")},this.initClose=()=>{this.$.find(".close-button").click((function(){e.onclose.call(d),$(this).tipHide()}))},this.changeDraggableContainment=function(t){this.$.draggable({containment:t})},this.fadeAndRemove=function(){e.backdrop&&this.removeBackdrop(),this.$.remove()},this.title=function(t){this.$.find(".header-label .text").html(t).attr("name",t)},this.addClass=function(t){this.$.addClass(t)},this.setTransparentWindow=()=>{d.$.addClass("transparent"),d.$.append($("<div>").addClass("border-image"))},this.setTipWindow=function(){d.$.addClass("tip-window")},this.setWndType=function(t){switch(t){case Engine.windowsData.type.TRANSPARENT:d.setTransparentWindow();break;case"tip-window":d.setTipWindow();break;default:console.error("[Window.js, setWndType] bad wnd type: "+t)}},this.label=function(t){t?this.$.find(".decoration-label").show().find(".label").html(t):this.$.find(".decoration-label").hide().find(".label").html("")},this.stopDrag=function(){e.managePosition&&(e.managePosition.x&&e.managePosition.y||e.managePosition.position==Engine.windowsData.position.CENTER_OR_SAVE_IN_STORAGE)&&d.saveWindowPosition()},this.updatePos=function(){let t=this.getPos();this.setContentPos(t.x+"px",t.y+"px")},this.getPos=()=>{let t=r.getPositionWindow(this._nameWindow);if(t){if(this.checkPosIsCorrect(t.x,t.y))return{x:t.x,y:t.y}}if(!e.managePosition)return this.getCenterPos();if(e.managePosition&&isset(e.managePosition.x)&&isset(e.managePosition.y)&&e.managePosition.position!=Engine.windowsData.position.RIGHT_POSITIONING)return{x:e.managePosition.x,y:e.managePosition.y};switch(e.managePosition.position){case Engine.windowsData.position.CENTER_OR_STICK_TO_EQ:return this.getCenterPosOrStickToEqColumnPos();case Engine.windowsData.position.CENTER:case Engine.windowsData.position.CENTER_OR_SAVE_IN_STORAGE:return this.getCenterPos();case Engine.windowsData.position.RIGHT_POSITIONING:return this.getRightPos();default:errorReport("Window.js","getPos","NANANAA")}return null},this.checkPassTheScreenBounds=()=>{let t=this.$.height()+5,e=this.$.position().top,i=window.innerHeight,n=this.$.width(),a=this.$.position().left,s=window.innerWidth;return e+t>i||a+n>s},this.setWindowOnLeftTopCorner=()=>{this.setContentPos("0px","0px"),this.saveWindowPosition()},this.checkPosIsCorrect=(t,e)=>{let i=null==Engine.zoomFactor?1:Engine.zoomFactor,n=Math.round(window.innerWidth*(1/i)),a=Math.round(window.innerHeight*(1/i)),s=d.$.outerWidth(),r=d.$.outerHeight();return t>=0&&e>=f&&(t+s<=n&&e+r<=a)},this.setContentPos=function(t,e){d.$.css({left:t,top:e})},this.saveWindowPosition=()=>{var t=this.$.position(),e={x:t.left/Engine.zoomFactor,y:t.top/Engine.zoomFactor};r.setPositionWindow(e,this._nameWindow)},this.getContent=()=>p,this.content=function(t){this.$.find(".inner-content").html(t);var i="";e.type?"transparent"==e.type&&(i=_t("close")):i=_t("hotkey_close"),this.$.find(".close-button-corner-decor").find(".close-button").tip(i),this.initZIndex(),p=t},this.getCenterPos=function(){return{x:d.getCenterPosXOfWidth(),y:d.getCenterPosYOfHeight()}},this.getStickToEqColumnPos=()=>({x:Engine.interface.getXPosOfObjectStickToEqColumn(this.$.outerWidth()),y:this.getCenterPosYOfHeight()}),this.getCenterPosOrStickToEqColumnPos=()=>{let t=this.$.outerWidth();return Engine.interface.centerObjectCoverEqColumn(t)?this.getStickToEqColumnPos():this.getCenterPos()},this.getRightPos=()=>({x:$("body").width()-d.$.outerWidth()-e.managePosition.x,y:e.managePosition.y}),this.getCenterPosXOfWidth=()=>{let t=null==Engine.zoomFactor?1:Engine.zoomFactor,e=Math.round(window.innerWidth*(1/t))/2-this.$.outerWidth()/2;return e<0&&(e=0),e},this.getCenterPosYOfHeight=()=>{let t=null==Engine.zoomFactor?1:Engine.zoomFactor,e=Math.round(window.innerHeight*(1/t))/2-this.$.outerHeight()/2;return e<0&&(e=0),e},this.center=function(){let t=this.getCenterPos();this.$.css({left:t.x,top:t.y})},this.setYPos=function(t){this.$.css({top:t})},this.addBackdrop=t=>{this.$backdrop=$("<div/>",{class:"window-backdrop"}),t.prepend(this.$backdrop),this.setBackdropZIndex()},this.setBackdropZIndex=()=>{if(e.backdrop){let t=this.$.css("z-index");this.$backdrop.css("z-index",t)}},this.removeBackdrop=()=>{e.backdrop&&this.$backdrop&&this.$backdrop.remove()},this.remove=()=>{u&&Engine.widgetManager.manageClassOfWidget(u,!1),Engine.windowManager.remove(this._nameWindow,this._idWindow)};const b=()=>{if(!Engine.tutorialManager)return void errorReport("Window.js","callCheckCanFinishExternalTutorialOpenWindow","Engine.tutorialManager not exist");let t=Engine.tutorialManager.createTutorialDataTrigger(a.ON_FINISH_REQUIRE.OPEN_WINDOW,a.ON_FINISH_TYPE.REQUIRE,this._nameWindow);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)};this.show=()=>{if(this.$.css("display","block"),isset(e.manageShow)&&r.setShowWindow(!0,this._nameWindow),u&&Engine.widgetManager.manageClassOfWidget(u,!0),b(),!Engine.tutorialManager)return console.trace(),void errorReport("Window.js","show","Engine.tutorialManager not exist");Engine.rajWindowEvents&&Engine.rajWindowEvents.callAllActionsBySpecificEventAndWindowName(c.ON_OPEN,this._nameWindow)},this.updateWindowTrigger=()=>{Engine.tutorialManager?Engine.rajWindowEvents?Engine.rajWindowEvents.callAllActionsBySpecificEventAndWindowName(c.ON_UPDATE,this._nameWindow):errorReport("Window.js","updateWindowTrigger","Engine.rajWindowEvents not exist"):errorReport("Window.js","updateWindowTrigger","Engine.tutorialManager not exist")},this.hide=()=>{this.$.css("display","none"),isset(e.manageShow)&&r.setShowWindow(!1,this._nameWindow),u&&Engine.widgetManager.manageClassOfWidget(u,!1)},this.isShow=()=>"none"!=this.$.css("display"),this.toggle=()=>{this.isShow()?this.hide():this.show()},this.setAttachLayerName=t=>{null!=t?(s[t]||console.error("[Window.js, setAttachLayerName] Layer name not exist:",t),h=t):h=null},this.addToAlertLayer=()=>{Engine.interface.get$alertsLayer().append(this.$),this.setAttachLayerName(s.$_ALERTS_LAYER),Engine.windowManager.addToAttachLayer(this)},this.addToMAlertLayer=()=>{Engine.interface.get$mAlertLayer().append(this.$),this.setAttachLayerName(s.$_M_ALERT_LAYER),Engine.windowManager.addToAttachLayer(this)},this.addToCaptchaLayer=()=>{Engine.interface.get$captchaLayer().append(this.$),this.setAttachLayerName(s.$_CAPTCHA_LAYER),Engine.windowManager.addToAttachLayer(this)},this.addToTutorialLayer=()=>{Engine.interface.get$tutorialLayer().append(this.$),this.setAttachLayerName(s.$_TUTORIAL_LAYER),Engine.windowManager.addToAttachLayer(this)},this.addToConsoleLayer=()=>{Engine.interface.get$consoleLayer().append(this.$),this.setAttachLayerName(s.$_CONSOLE_LAYER),Engine.windowManager.addToAttachLayer(this)},this.addToMobileAlertLayer=()=>{Engine.interface.get$mAlertMobileLayer().append(this.$),this.setAttachLayerName(s.$_M_ALERT_MOBILE_LAYER),Engine.windowManager.addToAttachLayer(this)},this.detachFromLayer=()=>{this.hide(),this.$.detach(),Engine.windowManager.removeFromAttachLayer(this),this.setAttachLayerName(null)},this.getAttachLayerName=()=>h,this.initOptions=()=>{if(this.close=e.onclose,!e.nameWindow)return console.error("[Window.js, initOptions] manageOpacity require window name");if(this.addNameToWindow(e.nameWindow),e.title&&this.title(e.title),e.label&&this.label(e.label),e.addClass&&this.addClass(e.addClass),e.content&&this.content(e.content),e.startVH&&this.setStartVH(e.startVH),e.cssVH&&this.setCssVH(e.cssVH),e.type&&this.setWndType(e.type),e.widget&&this.setAttachWidgetName(e.widget),e.closeable||this.$.addClass("no-exit-button"),isset(e.draggable)&&this.$.draggable(e.draggable?"enable":"disable"),isset(e.manageShow)&&this.manageShow(e.manageShow),e.managePosition){let t=e.managePosition;if(t.position&&!Engine.windowsData.position[t.position])return errorReport("Window.js","initOptions","incorrect val of position: "+t.position);if(t.position)switch(t.position){case Engine.windowsData.position.CENTER_OR_SAVE_IN_STORAGE:case Engine.windowsData.position.CENTER_OR_STICK_TO_EQ:case Engine.windowsData.position.CENTER:break;case Engine.windowsData.position.RIGHT_POSITIONING:if(!d.checkXOrYExist(t))return}else if(!d.checkXOrYExist(t))return}if(e.manageSize&&w(e.manageSize,e.type),e.manageOpacity){if(e.type!==Engine.windowsData.type.TRANSPARENT)return console.error("[Window.js, initOptions] manageOpacity require transparent window type",this._nameWindow);if(e.manageOpacity<1)return console.error("[Window.js, initOptions] manageOpacity require value >= 1 // 1 - 0.25, 2 - 0.5, 3 - 0.75, 4 - 1",this._nameWindow);m=new o,m.init(this,this._nameWindow,this.$),m.setManageOpacity(e.manageOpacity)}e.manageCollapse&&this.setManageCollapse(e.manageCollapse)};const w=(t,e)=>{if(e!==getEngine().windowsData.type.TRANSPARENT)return void errorReport(i,"initOptions","manageSize require transparent window type",this._nameWindow);let n=t.callback?t.callback:null;v=new l,v.init(this,this._nameWindow,p,p,t.sizeArray,n)};this.setManageCollapse=t=>{let{defaultVal:e,callbackFn:i,leftPos:n}=t,a=this.createCollapseBtn(n);const s=r.getCollapseWindow(this._nameWindow),o=null!==s?s:e;this.setCollapse(a,o),a.on("click",t=>this.collapseToggle(t,i))},this.createCollapseBtn=t=>{let i=$("<div>",{class:"collapse"});return this.$.append(i),isset(t)?i.css({left:t}):e.manageOpacity&&i.css({left:"2px"}),i},this.setCollapse=(t,e)=>{g=e,this.setCollapseTip(t)},this.collapseToggle=(t,e)=>{g=!g;const i=$(t.currentTarget);this.setCollapseTip(i),this.setCollapseClass(),e(g),r.setCollapseWindow(g,this._nameWindow)},this.setCollapseTip=t=>{const e=g?_t("expand"):_t("collapse");t.tip(e),this.setCollapseClass()},this.setCollapseClass=()=>{g?this.$.addClass("window--collapsed"):this.$.removeClass("window--collapsed")},this.manageShow=()=>{null==r.getShowWindow(this._nameWindow)&&r.setShowWindow(e.manageShow,this._nameWindow),this.manageShowFromStorage()},this.manageShowFromStorage=()=>{r.getShowWindow(this._nameWindow)?this.show():this.hide()},this.checkXOrYExist=t=>!(!isset(t.x)||!isset(t.y))||(errorReport("Window.js","initOptions","bad argument of managePosition. Should be e.g {x: 123, y: 123}",this._nameWindow),!1)}},function(t,e,i){let n=i(469),a=i(31),s=i(4),r=i(3);t.exports=function(){let t="NightController.js",e=null,i=0,o=[],l=.2,c=0,d=!1,h=null,u=!1,p=null,g=null,f=null,m=null,v=null,E=null,_=null,b=null,w=[],C=null,T=!0,y=null,I=null;this.alwaysDraw=!0;const A={r:0,g:0,b:0,a:.5},k=t=>{let e=S(t);return Math.max(b,e)},S=e=>e>=8&&e<18.5?0:e<3.5||e>=23?1:e<=4?.9:e<=4.5?.8:e<=5?.7:e<=5.5?.6:e<=6?.5:e<=6.5?.4:e<=7?.3:e<=7.5?.2:e<=8||e<19?.1:e<19.5?.2:e<20?.3:e<20.5?.4:e<21?.5:e<21.5?.6:e<22?.7:e<22.5?.8:e<23?.9:(errorReport(t,"getNightOpacityFactor","WOW"),0),O=()=>{let t=null;if(C){let e=Engine.getEv(),i=Engine.getWorldTime();t=new Date(1e3*(e||i))}else t=new Date;let e=_,i=t.getHours()+t.getMinutes()/60+t.getSeconds()/60/60,n=Math.floor(i/e);return n=i/e-n,1440*n/60},M=()=>{e=new s;const i=r.TYPE;e.init(t,{createFunc:N,clearFunc:R,createRequire:{color:{type:i.RGBA_COLOR},dayNightCycle:{type:i.OBJECT,optional:!0,elementInObject:{dayDuration:{type:i.INT,optional:!0},worldTime:{type:i.BOOL,optional:!0}}},list:{type:i.ARRAY,elementInArray:{x:{type:i.INT_OR_GET_CHARACTER_DATA},y:{type:i.INT_OR_GET_CHARACTER_DATA},r:{type:i.INT,optional:!0},gradientPercent1:{type:i.INT,range:[0,100],optional:!0},gradientPercent2:{type:i.INT,range:[0,100],optional:!0},offsetX:{type:i.INT,optional:!0},offsetY:{type:i.INT,optional:!0},light:{type:i.OBJECT,optional:!0,elementInObject:{r:{type:i.INT,optional:!0},color:{type:i.RGBA_COLOR,optional:!0},onlyNight:{type:i.BOOL,optional:!0}}}}}}},r.GROUP_NAME.OVERRIDE_OBJECT)},N=(t,e)=>{Z(),x(t),Engine.opt(11)||(F(),L(!1))},R=()=>{x(null),Z()},x=t=>{E=t},L=(t,e)=>{let i=$(),n=H(),a=t?[]:[0],s=!0;if(u&&(0==e||0==n))return Z(),f=e,void P();h.createFrames(m,i,4,a,(function(i){t&&s&&(Z(),s=!1,f=e,P()),D(i)})),t||P()},D=t=>{o.push(t),Engine.rajExtraLight.addExtraLightsToAlreadyCreateFrameOfNight(t,o.length-1)},P=()=>{B()&&G(),U(),X(),d=!0},B=()=>{let t=H();return!u||t>=.1},F=()=>{u=!!isset(E.dayNightCycle),C=!(!u||!isset(E.dayNightCycle.worldTime))&&E.dayNightCycle.worldTime,_=u&&isset(E.dayNightCycle.dayDuration)?E.dayNightCycle.dayDuration:24,b=u&&isset(E.dayNightCycle.minAlpha)?E.dayNightCycle.minAlpha:0,m=h.getHolesList(E,4,"NightController.js"),W(E.color?E.color:A),g=H(),l=E.frameTime?E.frameTime:.1},W=t=>{v=t},$=()=>{let t=null;if(u){let e=getEngine().overrideDayNightCycle;if(e.isOverrideDayNightCycleExist()){let i=e.geNormalizeOverrideDayNightCycleAlpha(b,v.a);t=K(i)}else t=q(k(O()))}else t=j();return t},H=()=>{let t=$();return parseFloat(t.split(",")[3])},G=()=>{let t=E.list;for(let e in t){let i=t[e];if(!i.light)continue;let n=V(i);n&&w.push(n)}},V=(e,i)=>{let a=h.getOnePoint(e,1);if(!isset(a[0]))return errorReport(t,"createLightPoints","One point not exist!",a),null;if(!Engine.rajCase.checkFullFillCase(e.case))return null;let s=new n;return s.init(a[0],i),s},U=()=>{if(getEngine().map.config.getIsQuestFogEnabled())return;let t=`rgba(${$()})`;Engine.interface.get$interfaceLayer().find(".filter-map-night").css({display:"block",background:t})},j=()=>v?v.r+","+v.g+","+v.b+","+v.a:null,q=t=>v?v.r+","+v.g+","+v.b+","+parseFloat(v.a)*t:null,K=t=>v?v.r+","+v.g+","+v.b+","+t:null;this.getFramesOfNight=()=>o;const Y=()=>o.length>0,z=()=>{p&&clearInterval(p),p=null},X=()=>{z(),u&&Q()},Q=()=>{p=setInterval((function(){J()}),6e4)},J=()=>{let t,e=O(),i=getEngine().overrideDayNightCycle;t=i.isOverrideDayNightCycleExist()?i.geNormalizeOverrideDayNightCycleAlpha(b,v.a):k(e)*parseFloat(v.a),null==f&&(f=g),devConsoleLog(["night","hour",e,"newOpacity",t,"oldOpacity",f,"minAlpha",b,"objColor.a",v.a,"normalizeOverrideDayNightCycleAlpha",Engine.overrideDayNightCycle.getAlphaFactor()]),f!=t&&(devConsoleLog(["CHANGE",t,e]),L(!0,t))},Z=()=>{z(),h.onClear(),tt(),et(),(()=>{let t=Engine.interface.get$interfaceLayer().find(".filter-map-night");"none"!=t.css("display")&&t.css("display","none")})(),d=!1,i=0,f=null},tt=()=>{o=[]},et=()=>{w=[]};this.init=()=>{h=new a,h.init(),(()=>{let t=h.createCanvasData();y=t.canvas,I=t.ctx})(),M()},this.getReady=()=>d,this.getFramesWithHoles=()=>h,this.update=t=>{o.length>1&&(c+=t,c>l&&(c=0,i++,i+1>o.length&&(i=0)))},this.draw=t=>{if(!d)return;if(!o[i])return;let e=Engine.map.getClip(),n=Engine.mapShift.getShift(),a=e[0],s=e[1],r=e[2],l=e[3];var c=0*CFG.tileSize-Engine.map.offset[0]+a-n[0],h=0*CFG.tileSize-Engine.map.offset[1]+s-n[1];T?(I.clearRect(0,0,y.width,y.height),I.drawImage(o[i],a,s,r,l,c,h,r,l),(()=>{I.save(),I.globalCompositeOperation="destination-out";let t=Engine.dynamicLightsManager.getDynamicLightList();for(let e in t)t[e].draw(I,i,"MAP");let e=Engine.dynamicDirCharacterLightsManager.getDirDynamicLightList();for(let t in e)e[t].draw(I,i,"MAP");let n=Engine.behaviorDynamicLightsManager.getBehaviorDynamicLightList();for(let t in n)n[t].draw(I,i);I.restore()})(),t.drawImage(y,0,0)):t.drawImage(o[i],a,s,r,l,c,h,r,l)},this.updateData=(t,i)=>{e.checkCorrectMainData(t,i)&&e.updateData(t)},this.onClear=Z,this.getNightOpacity=()=>g,this.getOrder=function(){return getEngine().renderer.getNightOrderWithoutSort()},this.getNight=()=>{if(!d)return[];let t=[this];for(let e in w)t.push(w[e]);let e=Engine.rajExtraLight.getAllExtraLight(),i=Engine.dynamicLightsManager.getDynamicLightList(),n=Engine.dynamicDirCharacterLightsManager.getDirDynamicLightList(),a=Engine.behaviorDynamicLightsManager.getBehaviorDynamicLightList(),s=Y();for(let i in e){let n=!1,a=e[i].onlyNight;e[i].light&&(a?s&&(n=!0):n=!0,n&&t.push(e[i].light))}for(let e in i){let n=!1,a=i[e].getOnlyNight(),r=i[e].getLight();r&&(a?s&&(n=!0):n=!0,n&&t.push(r))}for(let e in n){let i=!1,a=n[e].getOnlyNight(),r=n[e].getLight();r&&(a?s&&(i=!0):i=!0,i&&t.push(r))}for(let e in a){let i=!1,n=a[e].getOnlyNight(),r=a[e].getLight();r&&(n?s&&(i=!0):i=!0,i&&t.push(r))}return t},this.rebuiltAfterSettingsSave=()=>{null!=E&&N(E)},this.createOneLightPoint=V,this.getTime=O,this.resizeMainCanvas=()=>{(()=>{let t=Engine.interface.get$gameLayer(),e=t.width(),i=t.height();0==e&&0==i||(y.width=e,y.height=i)})()},this.setDynamicLight=t=>{T=t},this.checkNight=Y,this.getActualFrame=()=>i,this.getNightFrameLength=()=>4,this.getCalculateStringNightColor=$,this.getDayNightCycle=$,this.rebulitInterval=()=>{J(),X()}}},function(t,e,i){i(62);let n=i(78);t.exports=function(){let t,e,i,a,s,r,o=!1,l=!1,c=null,d=!1;this.alwaysDraw=!0;let h=null;const u=t=>{h=new n,h.init();let e=t.light&&t.light.order;e&&h.checkCorrectData(e)&&h.setOrderData(e)},p=()=>{c=document.createElement("canvas")},g=()=>{c.width=2*i,c.height=2*i;let t=i,e=i,n=c.getContext("2d"),a=n.createRadialGradient(t,e,0,t,e,i);a.addColorStop(0,r.stop0),a.addColorStop(1,r.stop1),n.fillStyle=a,n.beginPath(),n.arc(t,e,i,0,2*Math.PI),n.fill()},f=t=>{r=t},m=t=>{l=t},v=e=>{t=e},E=t=>{e=t},_=t=>{i=t,C(!0)},b=t=>{a=t},w=t=>{s=t},C=t=>{d=t},T=(t,e,n)=>{e-=i,n-=i,d&&(g(),C(!1));let a=Engine.map.clipObject(e,n,c.width,c.height);a&&t.drawImage(c,a.backgroundPositionX,a.backgroundPositionY,a.width,a.height,a.left,a.top,a.width,a.height)};this.getOrder=()=>o?e-.01:h.getOrder(e),this.draw=i=>{let n,r,o=CFG.tileSize,c=Engine.mapShift.getShift(),d=CFG.halfTileSize;l?(n=t+a,r=e+s):(n=t*o+o/2+a-Engine.map.offset[0]-c[0],r=e*o+d+s-Engine.map.offset[1]-c[1]),T(i,n,r)},this.init=(t,e)=>{v(t.x),E(t.y),_(t.r),f(t),b(t.offsetX),w(t.offsetY),w(t.offsetY),u(t),e&&m(e),C(!1),p(),g()},this.setCover=t=>{o=t},this.setX=v,this.setY=E,this.setR=_,this.getR=()=>i,this.getColorLightData=()=>r.light?r.stop0Data:null,this.setColorLightData=(t,e,i,n)=>{if(!r.light)return null;r.stop0Data.r=t,r.stop0Data.g=e,r.stop0Data.b=i,r.stop0Data.a=n,r.stop1Data.r=t,r.stop1Data.g=e,r.stop1Data.b=i,C(!0)},this.refreshColorLightStop=()=>{r.stop0=`rgba(${r.stop0Data.r},${r.stop0Data.g},${r.stop0Data.b},${r.stop0Data.a})`,r.stop1=`rgba(${r.stop1Data.r},${r.stop1Data.g},${r.stop1Data.b},0)`,C(!0)}}},function(t,e){t.exports={V:0,MINIMUM_ORDER:200,KIND:{FLOAT_OBJECT:"FLOAT_OBJECT",MAP_OBJECT:"MAP_OBJECT"}}},function(t,e,i){let n=i(4),a=i(3);t.exports=function(){let t="RajZoomManager.js",e=null,i=null;const s=()=>{e=new n;const i=a.TYPE;e.init(t,{createFunc:r,clearFunc:o,createRequire:{alphaFactor:{type:i.FLOAT}}},a.GROUP_NAME.OVERRIDE_OBJECT)},r=t=>{l(t.alphaFactor),Engine.nightController.rebulitInterval()},o=t=>{l(null),Engine.nightController.rebulitInterval()},l=t=>{i=t},c=(t,e)=>t+(e-t)*i;this.init=()=>{s()},this.updateData=(t,i)=>{e.checkCorrectMainData(t,i)&&e.updateData(t)},this.getAlphaFactor=()=>i,this.isOverrideDayNightCycleExist=()=>null!=i,this.geNormalizeOverrideDayNightCycleAlpha=c,this.geNormalizeOverrideDayNightCycleAlpha=c}},function(t,e,i){let n=i(1),a=i(117),s=i(473);t.exports=function(){const t="TOWN",e="CharacterTimer.js";let i=null;const r=t=>{let e=t.id,i=t.time,n=t.target.id,a=t.target.kind,s=0!=t.time;h(a)?s?p(n,i):g(n):s?f(e,n,a,i):m(e,a)},o=i=>{const a="checkCorrectData";if(!elementIsObject(i))return errorReport(e,a,"should be object!",i),!1;if(!isset(i.show))return errorReport(e,a,"show and hide not exist!",i),!1;let s=i.show;for(let r in s){let o=s[r];if(!isset(o.id))return errorReport(e,a,"id not exist!",i),!1;if(!isset(o.time))return errorReport(e,a,"time not exist!",i),!1;if(!isset(o.target))return errorReport(e,a,"target not exist!",i),!1;if(!elementIsObject(o.target))return errorReport(e,a,"target should be object!",i),!1;if(!isset(o.target.kind))return errorReport(e,a,"target.kind not exist!",i),!1;switch(o.target.kind){case n.NPC:if(!isset(o.target.id))return errorReport(e,a,"target.id not exist!",i),!1;break;case n.HERO:case t:break;default:return errorReport(e,a,"target.kind not exist!",i),!1}}return!0},l=(t,a)=>{switch(t){case n.NPC:case n.HERO:break;default:return void errorReport(e,"getCharacterTimer","targetKind not exist!",t)}return d(t)?!!i[t]:!!i[t][a]},c=(t,e,n)=>{d(e)||h(e)?i[e]=n:i[e][t]=n},d=t=>t==n.HERO,h=e=>e==t,u=(t,n)=>{const a="removeCharacterTimerByTarget";i[n]?d(n)?i[n]=null:l(n,t)?delete i[n][t]:errorReport(e,a,"character not exist",[n,t]):errorReport(e,a,"incorrect targetKind",n)},p=(e,i)=>{let n=new s;n.init(),n.updateData(e,i),c(null,t,n)},g=e=>{i[t]=null},f=(t,e,i,n)=>{let s=new a;s.init(),s.updateData(t,e,i,n),c(e,i,s)},m=(t,e)=>{if(e==n.HERO&&(i[e]=null),e==n.NPC){let n=i[e];for(let i in n){n[i].getId()==t&&u(i,e)}}},v=()=>{i={[n.NPC]:{},[n.HERO]:null,[t]:null}};this.init=()=>{v()},this.onClear=()=>{i[t]&&getEngine().interface.show$mapTimer(!1),v()},this.updateData=t=>{if(!o(t))return;let e=t.show;for(let t in e){let i=e[t];r(i)}},this.check=l,this.getCharacterTimer=(t,e)=>d(t)?i[t]:i[t][e],this.update=e=>{let a=i[n.NPC],s=i[n.HERO],r=i[t];for(let t in a)a[t].update(e);s&&s.update(e),r&&r.update(e)},this.isHero=d,this.removeCharacterTimer=m,this.removeTownTimer=g}},function(t,e){t.exports=function(){let t,e,i=null,n=null,a=null;const s=()=>Math.round((new Date).getTime()/1e3),r=t=>{getEngine().interface.setTip$mapTimer(t)},o=()=>{a||null!=n&&n<s()&&(p(),l(!0))},l=t=>{a=t},c=t=>t>60?"#e6d6bf":t>0?"#ffa500":"#ff0000",d=e=>{t=e},h=t=>{e=t},u=()=>{getEngine().interface.addClassTo$mapTimer("blink-map-timer")},p=()=>{getEngine().interface.removeClassFrom$mapTimer("blink-map-timer")},g=()=>{p(),getEngine().interface.show$mapTimer(!1),getEngine().interfaceTimerManager.removeTownTimer(t)};this.init=()=>{getEngine().interface.show$mapTimer(!0),u(),l(!1)},this.updateData=(t,e)=>{d(t),h(e+s())},this.update=t=>{let a=s(),l=e-a;if(Engine.interfaceStart&&!n&&(n=a+3),l<0)return void g();let d=Math.round(l);if(i!=d){let t=getSecondLeft(d,{noVar:!0}),e=`<div style="color:${c(d)}">${t}</div>`;i=d,r(e),o()}}}},function(t,e,i){let n=i(475),a=i(22),s=i(21),r=i(4),o=i(3);t.exports=function(){let t="FloatForegroundManager.js",e=null,i=null;const l=()=>{const e=o.TYPE;i=new r,i.init(t,{createFunc:d,removeFunc:h,checkExistFunc:g,createRequire:{xVector:{type:e.NUMBER,optional:!0},yVector:{type:e.NUMBER,optional:!0},color:{type:e.RGB_OR_RGBA_COLOR,optional:!0},url:{optional:!0}}},o.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},c=t=>{t.color&&s.manageRandomElementInObjectIfExist(t.color),i.updateData(t)},d=t=>{let e=t.id,i=new n;i.init(t),u(e,i)},h=t=>{let e=t.id,i=m(e),n=i.getActualAlpha();i.clearCanvasFadeIfExist();let s={originalObject:i,id:a.FLOAT_FOREGROUND+e,updateOriginalObject:!0,startAlpha:n};Engine.wraithObjectManager.createWraithObject(s),p(e)},u=(t,i)=>{e[t]=i},p=t=>{delete e[t]},g=t=>!!e[t],f=()=>{e={}},m=t=>e[t];this.init=()=>{f(),l()},this.update=t=>{for(let i in e)e[i].update(t)},this.onClear=()=>{f()},this.updateData=c,this.updateDataFloatForegroundFromRayController=(t,e)=>{if(i.checkCorrectMainData(t,e))for(let e in t.list){let i=t.list[e];c(i)}},this.getDrawableList=()=>{let t=[];if(!Engine.settings||!Engine.settings.checkTurnOnWeatherAndEventEffects())return t;for(let i in e)t.push(e[i]);return t}}},function(t,e,i){var n=i(74),a=i(58);t.exports=function(){let t=null,e=null,i=null,s=null;this.alwaysDraw=!0;let r=null,o=null,l=null,c=.2,d=-.1,h=1,u=null,p=!1,g=null;const f=()=>{let t={action:a.action.FADE_IN,callback:()=>{g=null},finishAlpha:h};g=new n,g.init(),g.updateData(t)},m=t=>{s=t,l=t.id,isset(t.xVector)&&(c=t.xVector),isset(t.yVector)&&(d=t.yVector),isset(t.color)&&(isset(t.color.r)&&isset(t.color.g)&&isset(t.color.b)&&(u=t.color),isset(t.color.a)&&(h=t.color.a))},v=e=>{let i;i=e.url?CFG.a_rajGraphics+e.url:"../img/environmentalEffects/fog/fog_2.png",Engine.imgLoader.onload(i,!1,!1,e=>{t=e,y(),A(!0)})},E=()=>({0:{bgX:null,bgY:null,width:null,height:null,left:null,top:null},1:{bgX:null,bgY:null,width:null,height:null,left:null,top:null},2:{bgX:null,bgY:null,width:null,height:null,left:null,top:null},3:{bgX:null,bgY:null,width:null,height:null,left:null,top:null}}),_=(t,i)=>{let n=1!=h||g;if(n){let e=g?g.getFadeValue():h;t.save(),t.globalAlpha=e}for(let n in i){let a=i[n];a.width<0||(a.height<0||null!=a.width&&null!=a.height&&t.drawImage(e,a.bgX,a.bgY,a.width,a.height,a.left,a.top,a.width,a.height))}n&&t.restore()},b=(t,i,n)=>{let a=Engine.mapShift.getShift();var s=0*CFG.tileSize-Engine.map.offset[0];let o=i[0]+a[0]-Engine.map.offset[0],l=i[0]+i[2]+a[0]-Engine.map.offset[0],d=c>=0,h=null,u=null,p=null,g=null,f=null;g=d?s-r:s-r-e.width,f=l-o,h=o,u=g+e.width-h;let m=0;u>f&&(m=u-f,u=f),p=e.width-u-m,u>0&&C(n,0,h,u,p),g=d?s-r+e.width:s-r,h=Math.max(o,g),u=g+e.width-h,f=l-h,u>f&&(u=f),p=g>0?0:Math.abs(g),u>0&&C(n,1,h,u,p)},w=(t,i,n)=>{let a=Engine.mapShift.getShift();var s=0*CFG.tileSize-Engine.map.offset[1];let r=i[1]+a[1]-Engine.map.offset[1],l=i[1]+i[3]+a[1]-Engine.map.offset[1],c=d>=0,h=null,u=null,p=null,g=null,f=null;g=c?s-o:s-o-e.height,f=l-r,h=r,u=g+e.height-h;let m=0;u>f&&(m=u-f,u=f),p=e.height-u-m,u>0&&T(n,0,h,u,p),g=c?s-o+e.height:s-o,h=Math.max(r,g),u=g+e.height-h,f=l-h,u>f&&(u=f),p=g>0?0:Math.abs(g),u>0&&T(n,1,h,u,p)},C=(t,e,i,n,a)=>{let s=t[e];s.bgX=a,s.width=n,s.left=i},T=(t,e,i,n,a)=>{let s=t[e];s.bgY=a,s.height=n,s.top=i},y=()=>{e=document.createElement("canvas"),i=e.getContext("2d"),I(Engine.map.size.x,Engine.map.size.y),i.fillStyle=i.createPattern(t,"repeat"),i.fillRect(0,0,e.width,e.height),null!=u&&(i.globalCompositeOperation="source-in",i.fillStyle=`rgb(${u.r},${u.g},${u.b})`,i.fillRect(0,0,e.width,e.height))},I=(i,n)=>{let a=CFG.tileSize*i,s=CFG.tileSize*n,r=(1+Math.floor(a/t.width))*t.width,o=(1+Math.floor(s/t.height))*t.height;e.width=r,e.height=o},A=t=>{p=t},k=()=>{r=0,o=0};this.init=t=>{k(),m(t),v(t),f()},this.update=t=>{p&&(g&&g.update(t),r+=c*t*100,o+=d*t*100,(r>e.width||r<-e.width)&&(r=0),(o>e.height||o<-e.height)&&(o=0))},this.draw=t=>{p&&(t=>{let e=E(),i=Engine.map.getClip();i&&(b(t,i,e),w(t,i,e),C(e,2,e[0].left,e[0].width,e[0].bgX),T(e,2,e[1].top,e[1].height,e[1].bgY),C(e,3,e[1].left,e[1].width,e[1].bgX),T(e,3,e[0].top,e[0].height,e[0].bgY),_(t,e))})(t)},this.getOrder=()=>398,this.getActualAlpha=()=>g?g.getFadeValue():h,this.clearCanvasFadeIfExist=()=>{g&&(g=null)}}},function(t,e,i){let n=i(477),a=i(1),s=i(21),r=i(3),o=i(4),l=(i(6),i(125),i(62));t.exports=function(){let t={fileName:"FloatObjectManager.js"},e=null,i=null;const c=()=>{i=new o;const e=r.TYPE,n=l.behavior,a=l.kind;i.init(t.fileName,{createFunc:h,removeFunc:u,checkExistFunc:E,updateFunc:p,createRequire:{url:!0,x:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},color:{type:e.RGB_OR_RGBA_COLOR,optional:!0},offsetX:{type:e.INT,optional:!0},offsetY:{type:e.INT,optional:!0},kind:{specificVal:[a.SPRITE,a.GIF,a.FAKE_NPC,a.IDLE_FAKE_NPC_FRAME],optional:!0},behavior:{type:e.OBJECT,elementInObject:{list:{type:e.ARRAY,elementInArray:{name:{conditionVal:{[n.IDLE]:{duration:{type:e.FLOAT,optional:!0}},[n.IDLE_GIF_ANIMATION]:{},[n.MOVE_FROM_VECTORS]:{xVector:{type:e.FLOAT,optional:!0},yVector:{type:e.FLOAT,optional:!0}},[n.CHANGE_IMG]:{url:!0,color:{type:e.RGB_OR_RGBA_COLOR,optional:!0},offsetX:{type:e.INT,optional:!0},offsetY:{type:e.INT,optional:!0},kind:{specificVal:[a.SPRITE,a.GIF,a.FAKE_NPC,a.IDLE_FAKE_NPC_FRAME]}},[n.MOVE_TO_CORDS]:{x:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[n.FOLLOW]:{x:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[n.TP_TO_CORDS]:{x:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:e.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[n.TP_ON_OTHER_SIDE]:{},[n.FADE_IN]:{},[n.FADE_OUT]:{},[n.ROTATION]:{speed:{type:e.FLOAT}}}}}}}}}},r.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},d=(t,e)=>{i.updateData(t,e)},h=(t,e)=>{s.manageRandomElementInBehaviorIfExist(t.behavior),t.color&&s.manageRandomElementInObjectIfExist(t.color);let i=t.id,a=new n;a.init(t,e),m(i,a)},u=(t,e)=>{let i=t.id;_(i).remove(),g(i)},p=(t,e)=>{let i=_(t.id);t.callInstantBehavior&&(i.setBreakBehavior(!0),i.setNewBehaviourData(t.callInstantBehavior))},g=e=>{let i=_(e);if(i){if(i.checkFadeOutWithOnRemove()){let t={originalObject:i,id:a.FLOAT_OBJECT+e,startAlpha:i.getAlpha(),speed:2,updateOriginalObject:!0,checkUpdateOriginalObject:()=>!i.getAllBehaviorFinished()};Engine.wraithObjectManager.createWraithObject(t)}v(e)}else warningReport(t.fileName,"remove",`floatObject id: ${e} not exist!`)},f=e=>(isset(e.gif)&&errorReport(t.fileName,"checkFloatObjectDataCorrect",'gif attr is deprecated! Use kind attr with values "SPRITE" || "GIF" || "FAKE_NPC"',e),!0),m=(t,i)=>{e[t]=i},v=t=>{delete e[t]},E=t=>!!e[t],_=i=>E(i)?e[i]:(warningReport(t,"getFloatObjectById",`floatObject ${i} not exist!`,e),null),b=()=>{e={}};this.init=()=>{b(),c()},this.update=t=>{for(let i in e)e[i].update(t)},this.onClear=()=>{b()},this.updateDataFloatObjectFromRayController=(t,e)=>{if(i.checkCorrectMainData(t,e))for(let i in t.list){let n=t.list[i];f(n)&&d(n,e)}},this.getDrawableList=()=>{let t=[];for(let i in e)t.push(e[i]);return t},this.remove=g,this.getById=_,this.checkObjectExist=E,this.updateBehavior=t=>{let e=t.list;for(let t in e){let i=e[t],n=i.id,a=_(n);a&&(a.setBreakBehavior(!0),a.setNewBehaviourData(i))}}}},function(t,e,i){let n=i(62),a=i(6);i(97);var s=i(65),r=i(74),o=i(58);let l=i(119),c=i(76),d=i(11),h=i(124),u=i(478),p=i(125),g=i(1),f=i(78);t.exports=function(){let t="FloatObject.js",e=null,i=null,m=null,v=null,E=n.kind.SPRITE;this.canvasObjectType=g.FLOAT_OBJECT,this.x=null,this.y=null,this.fh=null,this.fw=null,this.halffw=null,this.ofsetX=0,this.ofsetY=0,this.frame=0;var _=0;let b,w=null,C=null,T=0,y=null,I=null,A=null,k=null,S=null,O=1,M=!0,N=null,R=!1,x=null,L=!1,D=null,P=!1,B=!1,F=!1,W=!1,$=null,H=null,G=null;const V=t=>{$=new f,$.init()},U=()=>{H=new u,H.init(this)},j=()=>{G=new p,G.init(this)},q=()=>{v=new c,v.init(this,()=>{$t()},()=>{At(),Engine.floatObjectManager.remove(e)}),v.setDefaultRepeat(n.defaultData.BEHAVIOR_REPEAT)},K=t=>{D=t},Y=()=>{let t=!0;isset(y.withCreateInstantFadeIn)&&y.withCreateInstantFadeIn&&(t=!1),t&&z()},z=()=>{let t={action:o.action.FADE_IN,finishAlpha:O,callback:()=>{I=null}};I=new r,I.init(),I.updateData(t)},X=()=>{b=new s,b.init()},Q=t=>{ge(t.id),fe(t),Ee(a.getCharacterData(t.x,D)),_e(a.getCharacterData(t.y,D)),J(t)},J=t=>{if(be(a.getCharacterData(t.url,D)),isset(t.order)){let e=t.order;$.checkCorrectData(e)&&$.setOrderData(e)}if(isset(t.kind)&&ue(t.kind),isset(t.offsetX)&&oe(t.offsetX),isset(t.offsetY)&&le(t.offsetY),E==n.kind.IDLE_FAKE_NPC_FRAME&&(isset(t.dir)?de(a.getCharacterData(t.dir,D)):de(d.S)),isset(t.color)){let e=t.color;isset(e.r)&&isset(e.g)&&isset(e.b)&&we(e),isset(e.a)&&Ce(e.a)}},Z=()=>{switch(E){case n.kind.SPRITE:tt();break;case n.kind.GIF:et(CFG.r_rajGraphics+N,1);break;case n.kind.FAKE_NPC:case n.kind.IDLE_FAKE_NPC_FRAME:et(CFG.r_opath+fixSrc(N),4)}},tt=()=>{let t=this;Engine.imgLoader.onload(CFG.a_rajGraphics+N,!1,!1,e=>{let i;i=S?at(e):e,ye(i),t.fw=e.width,t.fh=e.height,t.halffw=t.fw/2,ae(!0)})},et=(t,e)=>{Engine.imgLoader.onload(t,{speed:!1,externalSource:cdnUrl},(t,i)=>{let n=it(i,t,e);this.fw=n.fw,this.fh=n.fh,this.halffw=n.halffw,w=n.frames,C=0,ye(n.image)},t=>{nt(t)},()=>{st()})},it=(t,e,i)=>({fw:t.hdr.width/i,fh:t.hdr.height/i,halffw:this.fw/2/i,frames:t.frames,image:e}),nt=t=>{let e;e=S?at(t):t,ye(e),ae(!0)},at=t=>{let e=document.createElement("canvas"),i=e.getContext("2d");return i.drawImage(t,0,0),i.globalCompositeOperation="source-in",i.fillStyle=`rgb(${S.r},${S.g},${S.b})`,i.fillRect(0,0,t.width,t.height),e},st=()=>{errorReport(t,"fetchError","Error fetch error :"+N)},rt=()=>{null!=Qt()&&St(!0)},ot=()=>{null!=ee()&&G.startMoveNoiseBehavior()},lt=t=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0)},ct=()=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0)},dt=t=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0)},ht=t=>{v.decreaseDuration(t),E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0),v.getDuration()<0&&v.callBehavior()},ut=t=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0),w.length==C+1&&(T=0,C=0,v.callBehavior())},pt=t=>{let e=h.getNewPositionFromVectors(i,m,A,k,t),a=h.getReachEdge(e,this.fw,this.fh);Ee(e.newX),_e(e.newY),E==n.kind.FAKE_NPC&&_t(t),a&&v.callBehavior()},gt=t=>{let e=h.getNewPositionFromVectors(i,m,A,k,t);Ee(e.newX),_e(e.newY),E==n.kind.FAKE_NPC&&_t(t),h.checkReachCord({x:i,y:m},{x:F,y:W},{xVector:A,yVector:k})&&(Ee(F),_e(W),v.callBehavior())},ft=t=>{v.decreaseDuration(t);let e=h.getNewPositionFromVectors(i,m,A,k,t);Ee(e.newX),_e(e.newY),E==n.kind.FAKE_NPC&&_t(t),v.getDuration()<0?v.callBehavior():h.checkReachCord({x:i,y:m},{x:F,y:W},{xVector:A,yVector:k})&&(Ee(F),_e(W),v.callBehavior())},mt=t=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0)},vt=t=>{E==n.kind.FAKE_NPC&&ce(0),E==n.kind.IDLE_FAKE_NPC_FRAME&&ce(0)},Et=t=>{w&&w.length>1&&t&&bt(t)},_t=t=>{(_+=5*t)>=.5&&(ce(this.frame+1),_%=.5,4==this.frame&&ce(0))},bt=t=>{T+=100*t,w[C].delay>T||(T-=w[C].delay,C=w.length==C+1?0:C+1)},wt=t=>{},Ct=()=>M?I?I.getFadeValue():O:0,Tt=t=>{let e=CFG.tileSize,a=CFG.halfTileSize,s=this.fw,r=this.fh,o=this.halffw,l=1,c=0,d=0;E==n.kind.FAKE_NPC&&(d=yt(A,k,r),c=this.frame*s,l=4),E==n.kind.IDLE_FAKE_NPC_FRAME&&(d=this.dirIndex*r,c=this.frame*s,l=4);let h=Engine.mapShift.getShift(),u=null;u=E==n.kind.FAKE_NPC||E==n.kind.IDLE_FAKE_NPC_FRAME?0:a-o;let p=Math.round(i*e+u+this.ofsetX-(Engine.map.offset[0]-h[0])),g=Math.round(m*e-r+e+this.ofsetY-(Engine.map.offset[1]-h[1]));p+=G.getXMoveNoise()*e,g+=G.getYMoveNoise()*e;let f=Engine.map.clipObject(p,g,s,r);f&&t.drawImage(x,c+f.backgroundPositionX,d+C*r*l+f.backgroundPositionY,f.width,f.height,f.left,f.top,f.width,f.height)},yt=(t,e,i)=>{let n=0;return null==t&&null==e||(n=Math.abs(t)>Math.abs(e)?t>0?2*i:i:e>0?0:3*i),n},It=t=>{let e=CFG.tileSize,n=CFG.halfTileSize,a=Engine.mapShift.getShift();var s=Math.round(i*e+n-this.halffw+this.ofsetX-Engine.map.offset[0]-a[0]),r=Math.round(m*e-this.fh+e+this.ofsetY-Engine.map.offset[1]-a[1]);if(G&&(s+=G.getXMoveNoise()*e,r+=G.getYMoveNoise()*e),H.checkNormalPos()){let e=Engine.map.clipObject(s,r,x.width,x.height);if(!e)return;t.drawImage(x,e.backgroundPositionX,e.backgroundPositionY,e.width,e.height,e.left,e.top,e.width,e.height)}else H.drawSprite(t,s,r,x)},At=()=>{this.getObjectDynamicLightManager().removeAllDynamicLights(),re(!0)},kt=t=>{let e=[];for(let i in t){let a=t[i];switch(a.name){case n.behavior.MOVE_TO_START_CORDS:a.name=n.behavior.MOVE_TO_CORDS,a.x=this.startX,a.y=this.startY,e.push(a);break;case n.behavior.TP_START_CORDS:a.name=n.behavior.TP,a.x=this.startX,a.y=this.startY,e.push(a);break;default:e.push(t[i])}}return e},St=t=>{H.startRotationBehavior(t)},Ot=()=>{let t={},e=Gt(),i=Vt(),n=Ut(),a=jt(),s=qt(),r=Kt();e&&(t.order=e),i&&(t.kind=i),n&&(t.offsetX=n),a&&(t.offsetY=a),s&&(t.color=s),r&&(t.url=r),ae(!1),ye(null),we(null),oe(0),le(0),ce(0),self.fw=null,self.fh=null,self.halffw=null,w=null,C=0,J(t),Z(),Te()},Mt=()=>{I&&(I=null);let t=zt();if(rt(),ot(),t)return ne(!1),void v.callBehavior();let e={action:o.action.FADE_OUT,finishAlpha:O,callback:()=>{I=null,ne(!1),v.callBehavior()}};I=new r,I.init(),I.updateData(e)},Nt=()=>{I&&(I=null);let t=zt();if(rt(),ot(),ne(!0),t)return void v.callBehavior();let e={action:o.action.FADE_IN,finishAlpha:O,callback:()=>{I=null,v.callBehavior()}};I=new r,I.init(),I.updateData(e)},Rt=()=>{let t=Yt();me(a.getCharacterData(t.x,D)),ve(a.getCharacterData(t.y,D)),Ee(P),_e(B),v.callBehavior()},xt=()=>{let t=CFG.tileSize,e=i*t,n=m*t,a=(Engine.map.size.x+2)*t,s=(Engine.map.size.y+2)*t;e<0-this.fw&&(e=a),e>a&&(e=0),n<0-this.fh&&(n=s),n>s&&(n=0),Ee(e/t),_e(n/t),v.callBehavior()},Lt=()=>{let t=v.getActualBehaviorDurationData();null!=t&&v.setDuration(t),rt(),ot()},Dt=()=>{T=0,C=0},Pt=()=>{let t=Zt(),e=te();t=null==t?n.defaultData.X_VECTOR:t,e=null==e?n.defaultData.Y_VECTOR:e,he(t),pe(e),rt(),ot()},Bt=()=>{let t=Jt(),e=Xt(),a=Wt({x:t.x,y:t.y});se(a.rx),ie(a.ry),e=null==e?n.defaultData.SPEED:e;let s=h.getNewVectorsFromDestinyAndPowerOfVectors({x:i,y:m},{x:F,y:W},e);he(s.newXVector),pe(s.newYVector),rt(),ot()},Ft=()=>{let t=Jt(),e=Xt(),a=Wt({x:t.x,y:t.y});se(a.rx),ie(a.ry),e=null==e?n.defaultData.SPEED:e;let s=h.getNewVectorsFromDestinyAndPowerOfVectors({x:i,y:m},{x:F,y:W},e);he(s.newXVector),pe(s.newYVector),rt(),ot();let r=v.getActualBehaviorDurationData();null!=r&&v.setDuration(r)},Wt=t=>({rx:a.getCharacterData(t.x,D),ry:a.getCharacterData(t.y,D)}),$t=()=>{se(null),ie(null),me(null),ve(null),v.setDuration(n.defaultData.BEHAVIOR_DURATION)},Ht=()=>v.getActualBehavior(),Gt=()=>{let t=Ht();return t&&isset(t.order)?t.order:null},Vt=()=>{let t=Ht();return t&&isset(t.kind)?t.kind:null},Ut=()=>{let t=Ht();return t&&isset(t.offsetX)?t.offsetX:null},jt=()=>{let t=Ht();return t&&isset(t.offsetY)?t.offsetY:null},qt=()=>{let t=Ht();return t&&isset(t.color)?t.color:null},Kt=()=>{let t=Ht();return t&&isset(t.url)?t.url:null},Yt=()=>{let t=Ht();return t?{x:t.x,y:t.y}:null},zt=()=>{let t=Ht();return t?!!t.instant:null},Xt=()=>{let t=Ht();return t&&t.speed?t.speed:null},Qt=()=>{let t=Ht();return t&&t.attachRotation?t.attachRotation:null},Jt=()=>{let t=Ht();return t?{x:t.x,y:t.y}:null},Zt=()=>{let t=Ht();return t&&isset(t.xVector)?t.xVector:null},te=()=>{let t=Ht();return t&&isset(t.yVector)?t.yVector:null},ee=()=>{let t=Ht();return t&&t.attachMoveNoise?t.attachMoveNoise:null},ie=t=>{W=t},ne=t=>{M=t},ae=t=>{R=t},se=t=>{F=t},re=t=>{L=t},oe=t=>{this.ofsetX=t},le=t=>{this.ofsetY=t},ce=t=>{this.frame=t},de=t=>{this.dir=t,this.dirIndex=d.dirMapping.indexOf(t)},he=t=>{A=t},ue=t=>{E=t},pe=t=>{k=t},ge=t=>{e=t},fe=t=>{y=t},me=t=>{P=t},ve=t=>{B=t},Ee=t=>{i=t,this.x=t,this.rx=t},_e=t=>{m=t,this.y=t,this.ry=t},be=t=>{N=t},we=t=>{S=null!=t?{r:t.r,g:t.g,b:t.b}:null},Ce=t=>{O=t},Te=()=>{v.callBehavior()},ye=t=>{x=t};this.init=(t,e)=>{q(),U(),j(),v.setBehaviorRepeat(n.defaultData.BEHAVIOR_REPEAT),V(t),t.behavior.randomFirstIndex&&l.updateRandomFirstIndex(t.behavior),K(e),Q(t),v.setBehaviorData(t.behavior),Z(),X(),v.setBehaviorList(kt(copyStructure(t.behavior.list))),isset(y.behavior.repeat)&&v.setBehaviorRepeat(t.behavior.repeat),Y(),v.callBehavior()},this.update=t=>{if(!R)return;if(v.getBreakBehavior())return void v.callBehavior();H.updateRotationAngle(t),G.updateMoveNoise(t);const e=v.getActualBehaviorName(),i=n.behavior,a=n.kind;switch(e){case i.IDLE:ht(t);break;case i.IDLE_GIF_ANIMATION:ut(t);break;case i.MOVE_FROM_VECTORS:pt(t);break;case i.MOVE_TO_CORDS:gt(t);break;case i.FOLLOW:ft(t);break;case i.TP_TO_CORDS:mt(t);break;case i.TP_ON_OTHER_SIDE:vt(t);break;case i.FADE_IN:lt(t);break;case i.FADE_OUT:dt(t);break;case i.ROTATION:H.updateRotateAction(t);break;case i.CHANGE_IMG:ct(t)}switch(I&&I.update(t),E){case a.SPRITE:wt(t);break;case a.GIF:case a.FAKE_NPC:case a.IDLE_FAKE_NPC_FRAME:Et(t)}},this.draw=t=>{if(!R)return;if(Engine.rajCharacterHide.checkHideObject(this))return;let e=Ct(),i=!L&&1!=e;switch(i&&(t.save(),t.globalAlpha=e),E){case n.kind.SPRITE:It(t);break;case n.kind.GIF:case n.kind.FAKE_NPC:case n.kind.IDLE_FAKE_NPC_FRAME:Tt(t)}i&&t.restore()},this.remove=At,this.callBehavior=Te,this.startBehavior=e=>{switch(e){case n.behavior.IDLE:Lt();break;case n.behavior.IDLE_GIF_ANIMATION:Dt();break;case n.behavior.MOVE_FROM_VECTORS:Pt();break;case n.behavior.MOVE_TO_CORDS:Bt();break;case n.behavior.FOLLOW:Ft();break;case n.behavior.TP_TO_CORDS:Rt();break;case n.behavior.TP_ON_OTHER_SIDE:xt();break;case n.behavior.FADE_IN:Nt();break;case n.behavior.FADE_OUT:Mt();break;case n.behavior.ROTATION:St(!1);break;case n.behavior.CHANGE_IMG:Ot(!1);break;default:errorReport(t,"startBehavior","Incorrect name!",e)}},this.serverRayControllerData=t=>{Engine.rajController.parseObject(t,!1,D)},this.checkFadeOutWithOnRemove=()=>{let t=!0;return isset(y.withRemoveInstantFadeOut)&&y.withRemoveInstantFadeOut&&(t=!1),t},this.getAllBehaviorFinished=()=>v.getAllBehaviorFinished(),this.getRemoved=()=>L,this.getAlpha=()=>O,this.getOrder=()=>$.getOrder(m),this.getActualBehavior=Ht,this.getActualBehaviorSpeedData=Xt,this.getId=()=>e,this.getImg=()=>N,this.setBreakBehavior=t=>{v.setBreakBehavior(t)},this.setNewBehaviourData=t=>{v.setNewBehaviorData(t)},this.prepareBehaviorList=kt,this.getObjectDynamicLightManager=()=>b}},function(t,e,i){let n=i(62);t.exports=function(){let t,e=0,i=50,a=0,s=null,r=null;const o=(t,e)=>{if(1==t){if(null!=e)return e>0?1/0:-1/0}else if(null!=e)return e*t;return null},l=()=>{let e=t.getActualBehavior();return e&&e.attachRotation.speed?e.attachRotation.speed:null},c=()=>{let e=t.getActualBehavior();return e&&e.attachRotation.setAngle?e.attachRotation.setAngle:null},d=()=>{let e=t.getActualBehavior();return e&&e.attachRotation.addAngle?e.attachRotation.addAngle:null},h=()=>{let e=t.getActualBehavior();return e&&e.attachRotation.rotationOffset?e.attachRotation.rotationOffset:null},u=()=>{let e=t.getActualBehavior();return e&&e.attachRotation.repeat?e.attachRotation.repeat:null},p=()=>{let e=t.getActualBehavior();return e&&e.setAngle?e.setAngle:null},g=()=>{let e=t.getActualBehavior();return e&&e.addAngle?e.addAngle:null},f=()=>{let e=t.getActualBehavior();return e&&e.rotationOffset?e.rotationOffset:null},m=t=>{i=t},v=t=>{a=t},E=t=>{s=t},_=t=>{r=t},b=e=>{t=e};this.init=t=>{b(t),m(n.defaultData.ROTATION_SPEED),_(!1)},this.setRotationSpeed=m,this.startRotationBehavior=i=>{let n,a,s,r;_(!1);let b=null;i?(n=l(),a=c(),s=d(),r=h(),b=u(),null!=b&&(s=o(b,s))):(n=t.getActualBehaviorSpeedData(),a=p(),s=g(),r=f()),null!=n&&m(n),null!=r&&E(r),null==a?null==s||v(e+s):v(a)},this.updateRotationAngle=t=>{if(e==a)return;let n=i*t*100;e<a?(e+=n,e>=a&&(e=a,_(!0))):(e-=n,e<=a&&(e=a,_(!0)))},this.updateRotateAction=e=>{r&&(_(!1),t.callBehavior())},this.checkNormalPos=()=>e%360==0&&null==s,this.drawSprite=(i,n,a,r)=>{i.save(),i.translate(n+t.fw/2,a+t.fh/2),i.rotate(e*Math.PI/180);let o=null==s?t.fw/2:s.x,l=null==s?t.fh/2:s.y;i.drawImage(r,0,0,r.width,r.height,0-o,0-l,r.width,r.height),i.restore()}}},function(t,e,i){let n,a=i(480);function s(){let t="ImgLoader.js",e={},i={},n={};this.init=()=>{},this.preLoadImages=()=>{let t=[{url:CFG.r_epath+"elite-here3.gif",gifReader:{speed:!0,externalSource:cdnUrl}},{url:"../img/gui/dialogue/dialogue-header.png",gifReader:!1},{url:"../img/gui/buttony.png",gifReader:!1},{url:CFG.oimg+"/questMapBorder/questMapCornerBorder.png",gifReader:!1},{url:CFG.oimg+"/questMapBorder/questMapMiddleBorder.png",gifReader:!1}];if(t.length)for(let e=0;e<t.length;e++)this.cacheInitGraphic(t[e].url,t[e].gifReader);else r()},this.add=(t,n,a)=>{n?i[t]=a:e[t]=a},this.checkExist=(t,n)=>n?i[t]:e[t],this.onload=(t,e,i,n,a,s)=>{let r=!!e,o=this.checkExist(t,r);r?this.gifReaderStrategy(o,t,e,i,n,a,s):this.imageReaderStrategy(o,t,i,n,a,s)},this.gifReaderStrategy=(t,e,i,n,r,l,c)=>{let d,h=this;t?(d=t,a.fetch(e,!0,(function(t){n&&n(d,t),r&&r(d,t)}))):(d=new Image,a.fetch(e,i.speed,t=>{d.src=t.img,n&&n(d,t),d.onload=function(){h.checkExist(e,!0)||h.add(e,!0,d),r&&r(d,t)}},t=>{0!=t.currentTarget.status?o(t,e,l):s(e,i,n,r,l)},i.externalSource,i.insecureSource,c))};const s=(e,i,n,a,s)=>{let r=Math.floor(100*Math.random()),o=this;warningReport(t,"manage429Status","429 status. Try download again after "+r,e),setTimeout((function(){o.onload(e,i,n,a,s,!0)}),r)};this.imageReaderStrategy=(t,e,i,n,a,r)=>{let l,c=this;if(t)l=t,i&&i(l),n&&n(l);else{r?l=r:(l=new Image,i&&i(l));let t=new XMLHttpRequest;t.open("GET",e+"?v="+__build.version),t.responseType="blob",t.onload=function(t){let i=(window.URL||window.webkitURL).createObjectURL(this.response);l.src=i,l.onload=function(){c.checkExist(e,!1)||c.add(e,!1,l),n&&n(l)}},t.onerror=function(r){0==t.status?s(e,null,i,n,a):o(r,e,a)},t.send()}},this.cacheInitGraphic=(t,e)=>{let i=this;e?this.onload(t,e,()=>{i.addToPreLoadSuccessLoadedList(t)},()=>{i.deleteFromPreLoadSuccessLoadedList(t),i.manageUnlockImages()}):i.onload(t,!1,()=>{this.addToPreLoadSuccessLoadedList(t)},()=>{this.deleteFromPreLoadSuccessLoadedList(t),this.manageUnlockImages()},()=>{this.deleteFromPreLoadSuccessLoadedList(t),this.manageUnlockImages()})},this.addToPreLoadSuccessLoadedList=t=>{n[t]=!0},this.deleteFromPreLoadSuccessLoadedList=t=>{delete n[t]},this.checkFinishPreLoad=()=>!Object.keys(n).length,this.manageUnlockImages=()=>{this.checkFinishPreLoad()&&(Engine.interface.lock.unlock("images"),Engine.loader.load("images"))};const o=(e,i,n)=>{n?n(e):errorReport(t,"manageError","FETCH ERROR!",i)}}function r(){n.manageUnlockImages()}t.exports={init:function(t){n=new s,n.init(t)},onload:function(t,e,i,a,s){n.onload(t,e,i,a,s)},manageUnlockImages:r,preLoadImages:function(){n.preLoadImages()}}},function(t,e,i){var n=new function(){this.cached={},this.handlers={},this.registerHandler=function(t,e){if(void 0!==this.cached[t])return e(this.cached[t]),!0;var i=!0;return void 0===this.handlers[t]&&(this.handlers[t]=[],i=!1),this.handlers[t].push(e),i},this.runHandlers=function(t,e){if(this.cached[t]=e,void 0!==this.handlers[t]){for(var i in this.handlers[t])this.handlers[t][i](e);this.handlers[t]=[]}}},a=function(t){return t.reduce((function(t,e){return 2*t+e}),0)},s=function(t){for(var e=[],i=7;i>=0;i--)e.push(!!(t&1<<i));return e},r=function(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return t instanceof Uint8Array?t[this.pos++]:255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],i=0;i<t;i++)e.push(this.readByte());return e},this.read=function(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},o=function(t,e){e||(e={});var i=function(e){for(var i=[],n=0;n<e;n++)i.push(t.readBytes(3));return i},n=function(){var e,i;i="";do{e=t.readByte(),i+=t.read(e)}while(0!==e);return i},r=function(r){r.leftPos=t.readUnsigned(),r.topPos=t.readUnsigned(),r.width=t.readUnsigned(),r.height=t.readUnsigned();var o=s(t.readByte());r.lctFlag=o.shift(),r.interlaced=o.shift(),r.sorted=o.shift(),r.reserved=o.splice(0,2),r.lctSize=a(o.splice(0,3)),r.lctFlag&&(r.lct=i(1<<r.lctSize+1)),r.lzwMinCodeSize=t.readByte();var l=n();r.pixels=function(t,e){for(var i,n,a=0,s=function(t){for(var i=0,n=0;n<t;n++)e.charCodeAt(a>>3)&1<<(7&a)&&(i|=1<<n),a++;return i},r=[],o=1<<t,l=o+1,c=t+1,d=[],h=function(){d=[],c=t+1;for(var e=0;e<o;e++)d[e]=[e];d[o]=[],d[l]=null};;)if(n=i,(i=s(c))!==o){if(i===l)break;if(i<d.length)n!==o&&d.push(d[n].concat(d[i][0]));else{if(i!==d.length)throw new Error("Invalid LZW code.");d.push(d[n].concat(d[n][0]))}r.push.apply(r,d[i]),d.length===1<<c&&c<12&&c++}else h();return r}(r.lzwMinCodeSize,l),r.interlaced&&(r.pixels=function(t,e){for(var i=new Array(t.length),n=t.length/e,a=function(n,a){var s=t.slice(a*e,(a+1)*e);i.splice.apply(i,[n*e,e].concat(s))},s=[0,4,2,1],r=[8,8,4,2],o=0,l=0;l<4;l++)for(var c=s[l];c<n;c+=r[l])a(c,o),o++;return i}(r.pixels,r.width)),e.img&&e.img(r)},o=function(){var i={};switch(i.sentinel=t.readByte(),String.fromCharCode(i.sentinel)){case"!":i.type="ext",function(i){switch(i.label=t.readByte(),i.label){case 249:i.extType="gce",function(i){t.readByte();var n=s(t.readByte());i.reserved=n.splice(0,3),i.disposalMethod=a(n.splice(0,3)),i.userInput=n.shift(),i.transparencyGiven=n.shift(),i.delayTime=t.readUnsigned(),i.transparencyIndex=t.readByte(),i.terminator=t.readByte(),e.gce&&e.gce(i)}(i);break;case 254:i.extType="com",function(t){t.comment=n(),e.com&&e.com(t)}(i);break;case 1:i.extType="pte",function(i){t.readByte();i.ptHeader=t.readBytes(12),i.ptData=n(),e.pte&&e.pte(i)}(i);break;case 255:i.extType="app",function(i){t.readByte();switch(i.identifier=t.read(8),i.authCode=t.read(3),i.identifier){case"NETSCAPE":!function(i){t.readByte();i.unknown=t.readByte(),i.iterations=t.readUnsigned(),i.terminator=t.readByte(),e.app&&e.app.NETSCAPE&&e.app.NETSCAPE(i)}(i);break;default:!function(t){t.appData=n(),e.app&&e.app[t.identifier]&&e.app[t.identifier](t)}(i)}}(i);break;default:i.extType="unknown",function(t){t.data=n(),e.unknown&&e.unknown(t)}(i)}}(i);break;case",":i.type="img",r(i);break;case";":i.type="eof",e.eof&&e.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}"eof"!==i.type&&l()},l=function(t){e.isFast?o():setTimeout(o,0)};!function(){var n={};if(n.sig=t.read(3),n.ver=t.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=t.readUnsigned(),n.height=t.readUnsigned();var r=s(t.readByte());n.gctFlag=r.shift(),n.colorRes=a(r.splice(0,3)),n.sorted=r.shift(),n.gctSize=a(r.splice(0,3)),n.bgColor=t.readByte(),n.pixelAspectRatio=t.readByte(),n.gctFlag&&(n.gct=i(1<<n.gctSize+1)),e.hdr&&e.hdr(n)}(),l()};t.exports={fetch:function(t,e,i,a,s,l,c){if(void 0===this.cache.cached[t]){var d,h,u,p,g,f,m,v,E=document.createElement("canvas"),_=document.createElement("canvas"),b=_.getContext("2d"),w=[],C=function(){d&&w.push({data:d.getImageData(0,0,v.width,v.height),delay:u})},T={hdr:function(t){v=t,E.width=t.width,E.height=t.height},gce:function(t){C(),h=null,u=null,m=p,p=null,d=null,h=t.transparencyGiven?t.transparencyIndex:null,u=t.delayTime,p=t.disposalMethod},img:function(t){d||(d=E.getContext("2d",{willReadFrequently:!0}));var e=w.length,i=t.lctFlag?t.lct:v.gct;e>0&&(3===m&&isset(f)?d.putImageData(w[f].data,0,0):f=e-1,2===m&&d.clearRect(g.leftPos,g.topPos,g.width,g.height));var n=d.getImageData(t.leftPos,t.topPos,t.width,t.height),a=n.data;t.pixels.forEach((function(t,e){t!==h&&(a[4*e+0]=i[t][0],a[4*e+1]=i[t][1],a[4*e+2]=i[t][2],a[4*e+3]=255)}));n.height,n.width;for(var s=document.createElement("canvas").getContext("2d").createImageData(n.width,n.height),r=0;r<a.length;r++)s.data[r]=a[r];d.putImageData(s,t.leftPos,t.topPos),g=t},eof:function(){C(),_.width=v.width,_.height=v.height*w.length;for(var t=0;t<w.length;t++)b.putImageData(w[t].data,0,t*v.height),delete w[t].data;y({hdr:v,frames:w,img:_.toDataURL()})},isFast:e},y=function(){};!function(t,e,i,a,s,l){if(l||!n.registerHandler(t,e,i)){var c=new XMLHttpRequest;if(s)c.open("POST","image_proxy.php?a="+t,!0);else{let e=(a||"")+"/gifcache"+t+"64";c.open("GET",e,!0)}c.onloadend=function(t){200!==c.status&&i&&i(t)},c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)try{var e=new r(atob(c.responseText));y=function(e){n.runHandlers(t,e)},o(e,T)}catch(e){i&&i(e),console.warn("[GifReader.js, defragmentUrlGif] Failed to read binary image data from "+t)}},c.send()}}(t,i,a,s,l,c)}else i(this.cache.cached[t])},cache:n}},function(t,e,i){"use strict";t.exports=class{constructor(){}set(t){this.getEngine().dead||(this.getEngine().dead=!0,this.getEngine().interface.get$gameLayer().find(".dead-overlay").show(),this.getEngine().lock.add("dead")),this.updateCounter(t)}unset(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getEngine().dead=!1,this.getEngine().hero.updateCollider(),t?this.getEngine().interface.get$gameLayer().find(".dead-overlay").fadeOut():this.getEngine().interface.get$gameLayer().find(".dead-overlay").hide(),this.getEngine().lock.remove("dead")}updateCounter(t){const e=t%60,i=t>59?Math.floor(t/60):"",n=""!==i?`${i}min ${e}s`:e+"s";this.getEngine().interface.get$gameLayer().find(".dazed-time").text(n)}update(t){t>0?this.set(t):this.getEngine().dead&&this.unset(),2==this.getEngine().getInitLvl()&&this.getEngine().questTracking.clearQuestTrackingDataAfterDie(),API.callEvent(this.getEngine().apiData.HERO_DEAD,{id:this.getEngine().hero.d.id,nick:this.getEngine().hero.d.nick,sec:t})}getEngine(){return Engine}}},function(t,e,i){var n=i(33),a=i(22),s=(i(126),i(6),i(483));t.exports=function(){let t,e={},i=null;const r="on_",o=()=>{i=new s,i.init()},l=function(t){let e;try{e=JSON.parse(t)}catch(e){return void errorReport("RajController.js","parseJSON","Incorrect JSON format!",t)}d(e,[],{source:"ENGINE"})},c=function(t,e,i){d(t,e,i)},d=(e,n,a)=>{CFG.debug,e=i.getRajDataAfterAllReplace(e),devConsoleLog("SRAJ_CALL_AFTER_REPLACE",e,a);for(let i in e){if(n&&n.indexOf(i)>-1)continue;let s="before_"+i;t[s]&&t[s](e[i],a)}for(let i in e){if(n&&n.indexOf(i)>-1)continue;let s=r+i;t[s]&&t[s](e[i],a)}for(let i in e){if(n&&n.indexOf(i)>-1)continue;let s="after_"+i;t[s]&&t[s](e[i],a)}},h=function(){t={[r+a.INTERFACE_SKIN]:function(t){Engine.themeController.updateData(t,n.THEME_KIND.EVENT)},[r+a.WEATHER]:function(t,e){Engine.weather.updateDataWeatherFromRayController(t,e)},[r+a.NIGHT]:function(t,e){Engine.nightController.updateData(t,e)},[r+a.OVERRIDE_DAY_NIGHT_CYCLE]:function(t,e){Engine.overrideDayNightCycle.updateData(t,e)},[r+a.MAP_FILTER]:function(t,e){Engine.mapFilter.updateData(t,e)},[r+a.SCREEN_EFFECTS]:function(t,e){Engine.screenEffectsManager.updateData(t,e)},[r+a.FLOAT_FOREGROUND]:function(t,e){Engine.floatForegroundManager.updateDataFloatForegroundFromRayController(t,e)},[r+a.FLOAT_OBJECT]:function(t,e){Engine.floatObjectManager.updateDataFloatObjectFromRayController(t,e)},[r+a.TRACKING]:function(t,e){Engine.rajTracking.updateData(t,e)},[r+a.EARTHQUAKE]:function(t,e){Engine.earthQuakeManager.updateData(t,e)},[r+a.CHARACTER_EFFECT]:function(t,e){Engine.characterEffectsManager.updateData(t,e)},["before_"+a.FAKE_NPC]:function(t,e){Engine.fakeNpcs.updateData(t,e)},[r+a.TUTORIAL]:function(t){Engine.tutorialManager.startTutorialFromRayController(t)},[r+a.BATTLE_EVENTS]:function(t,e){Engine.rajBattleEvents.updateData(t,e)},[r+a.MAP_EVENTS]:function(t,e){Engine.rajMapEvents.updateData(t,e)},[r+a.CHARACTER_IMAGE_CHANGER]:function(t,e){Engine.rajCharacterImageChangerManager.updateData(t,e)},[r+a.WINDOW_EVENTS]:function(t,e){Engine.rajWindowEvents.updateData(t,e)},[r+a.MAP_EXTERNAL_PROPERTIES_REFRESH]:function(t,e){Engine.map.refreshRayControllerData(t)},[r+a.PROGRAMMER]:function(t,e){Engine.rajProgrammer.updateData(t)},[r+a.CAMERA]:function(t,e){Engine.rajCamera.updateData(t,e)},[r+a.DIALOGUE]:function(t,e){Engine.rajDialogue.updateData(t,e)},[r+a.CHARACTER_HIDE]:function(t,e){Engine.rajCharacterHide.updateData(t,e)},["before_"+a.EXTRA_LIGHT]:function(t,e){Engine.rajExtraLight.updateData(t,e)},["after_"+a.DYNAMIC_LIGHT]:function(t,e){Engine.dynamicLightsManager.updateData(t,e)},["after_"+a.DYNAMIC_DIR_CHARACTER_LIGHT]:function(t,e){Engine.dynamicDirCharacterLightsManager.updateData(t,e)},["after_"+a.BEHAVIOR_DYNAMIC_LIGHT]:function(t,e){Engine.behaviorDynamicLightsManager.updateData(t,e)},["before_"+a.EMO_DEFINITIONS]:function(t,e){Engine.rajEmoDefinitions.updateData(t)},[r+a.EMO_ACTIONS]:function(t,e){Engine.rajEmoActions.updateData(t,e)},[r+a.YELLOW_MESSAGE]:function(t,e){Engine.rajYellowMessage.updateData(t)},[r+a.SEQUENCE]:function(t,e){Engine.rajSequenceManager.updateData(t,e)},[r+a.RANDOM_CALLER]:function(t,e){Engine.rajRandomCallerManager.updateData(t)},[r+a.SOUND]:function(t,e){Engine.rajSoundManager.updateData(t,e)},[r+a.AREA_TRIGGER]:function(t,e){Engine.rajAreaTriggerManager.updateData(t,e)},[r+a.MAP_MUSIC]:function(t,e){Engine.rajMapMusicManager.updateData(t,e)},["after_"+a.ZOOM]:function(t,e){Engine.rajZoomManager.updateData(t,e)},["after_"+a.CONNECT_SRAJ]:function(t,e){for(let i=0;i<t.length;i++)0!=lengthObject(t[i])&&c(t[i],[],e)}}};this.testNight=()=>{l('{"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.7},"list":[{"light":{"r":20,"color":{"r":255,"g":157,"b":0,"a":0.6}},"x":26,"y":15,"r":80},{"x":20,"y":15,"r":80}]}}')},this.testNightWithEmptyList=()=>{l('{"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.7},"list":[]}}')},this.testRemoveNight=()=>{l('{"night":{"action":"REMOVE"}}')},this.testRemoveFog=()=>{l('{"fog":{"action":"REMOVE"}}')},this.createTextFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":1,"x":2,"y":8,"img":"/noob/hm.gif","click":{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"FAKE_NPC","id":1},"effect":"TEXT","params":{"position":"TOP","text":["one","two","three","four","five","six","seven","eight"]}}]}},"behavior":{"repeat":true,"list":[{"name":"IDLE"}]}}]}}')},this.createHeroDirFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":1,"x":2,"y":8,"img":"/noob/hm.gif","click":{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"FAKE_NPC","id":1},"effect":"TEXT","params":{"position":"TOP","text":["one","two","three","four","five","six","seven","eight"]}}]}},"behavior":{"repeat":true,"list":[{"name":"IDLE","dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}}}]}}]}}')},this.createHeroDirFakeBug=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":1,"x":2,"y":8,"img":"/noob/hm.gif","click":{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"FAKE_NPC","id":1},"effect":"TEXT","params":{"position":"TOP","text":["one","two","three","four","five","six","seven","eight"]}}]}},"behavior":{"repeat":true,"list":[{"name":"IDLE","dir":{"getCharacterData":{"kind":"HERO","toGeta":"dir"}}}]}}]}}')},this.testTextBlario=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"NPC","id":"10008"},"effect":"TEXT","params":{"position":"TOP","text":["one","two","three","four","five","six","seven","eight"]}}]}}')},this.testTextBlarioBeforeAfter=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"NPC","id":"10008"},"effect":"TEXT","params":{"position":"TOP","duration":1,"between":0,"repeat":2,"delayBefore":5,"delayAfter":5,"text":["one","two","three"]}}]}}')},this.testCharacterEffetsTintBlarioBeforeAfter=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"NPC","id":"10008"},"effect":"TINT","params":{"duration":5,"repeat":true,"delayAfter":5,"color":"255,0,255"}}]}}')},this.testCharacterEffetsIconBlarioBeforeAfter=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"NPC","id":"10008"},"effect":"ANIMATION","params":{"position":"CENTER","gifUrl":"204_blyskawiczny-atak.gif","repeat":true,"delayAfter":5}}]}}')},this.testTextBlarioRandomTrue=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","name":"anim1","target":{"kind":"NPC","id":"10008"},"effect":"TEXT","params":{"position":"TOP","random":true,"text":["one","two","three","four","five","six","seven","eight"]}}]}}')},this.testIconEffectBehind=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","name":"tytxd","windowTarget":"MAP","effect":"ANIMATION","target":{"kind":"HERO","id":1},"params":{"behind":true,"gifUrl":"titanharpy.gif","repeat":true,"position":"CENTER"}}]}}')},this.testIconEffect=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","name":"nanana","windowTarget":"MAP","effect":"ANIMATION","target":{"kind":"HERO"},"params":{"position":"LEFT","gifUrl":"204_blyskawiczny-atak.gif","repeat":true}}]}}')},this.testStickMapTextEffect=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","id":"Sralala-0","windowTarget":"MAP","effect":"TEXT","target":{"kind":"HERO"},"params":{"stickMap":true,\n        "text":[\n        "Yeaaaahh","KE?","Nanana","Naaaah","Meeeeh","BOOM"\n        ]}}]}}')},this.testStickMapBlackTextEffect=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","id":"Sralala-1","windowTarget":"MAP","effect":"TEXT","target":{"kind":"HERO"},"params":{"color":{"r":0,"g":0,"b":0},"stickMap":true,"text":["Yeaaaahh","KE?","Nanana","Naaaah","Meeeeh","BOOM"]}}]}}')},this.testRandomTextEffect=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","id":"Sralala","windowTarget":"MAP","effect":"TEXT","params":{"random":true,"between":1, "duration":1,"position":"TOP","repeat":true,\n        "text":[\n        "Yeaaaahh","KE?","Nanana","Naaaah","Meeeeh","BOOM"\n        ]}}]}}')},this.testTextEffect=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","name":"Sralala","windowTarget":"MAP","effect":"TEXT","target":{"kind":"HERO"},"params":{"between":1, "duration":1,"position":"TOP","repeat":true,\n        "text":[\n        "Yeaaaahh","KE?","Nanana","Naaaah","Meeeeh","BOOM"\n        ]}}]}}')},this.testRemoveFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"REMOVE","id":0}]}}')},this.testTutorialItem=()=>{l('{"tutorial":{"textPc":"testowy textPc","textMobile":"testowy HeaderMobile","headerPc":"testowy HeaderPc","graphic":"/img/gui/newTutorial/1.gif","htmlFocus":".interface-layer>.right-column.main-column","htmlPosition":".interface-layer>.right-column.main-column","itemsNeed":{"htmlMultiGlow":true,"items":{"w":{"16":{"loc":"g","tpl":177}},"p":{"16":{"loc":"g","tpl":177}},"m":{"16":{"loc":"g","tpl":177}},"t":{"16":{"loc":"g","tpl":177}},"h":{"16":{"loc":"g","tpl":177}},"b":{"16":{"loc":"g","tpl":177}}}},"blink":true,"onFinish":{"require":[{"useItemTpl":[177]}]}}}')},this.testMove=()=>{l('{"tutorial":{"textPc":"testowy [color=red]textPc[/color]","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".echh-layer","canvasMultiGlow":{"objects":[{"typeObject":"hero"}]},"blink":true,"canvasPosition":{"typeObject":"hero"},"onFinish":{"require":[{"moveRequire":true}]}}}')},this.testMoveCase=()=>{l('{"tutorial":{"case":{"quest":{"ACTIVE":[1022,1356],"NEVER_OCCUR":[1],"NOT_FINISH":[1022],"FINISH":[1425]}},"textPc":"testowy [color=red]textPc[/color]","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".echh-layer","canvasMultiGlow":{"objects":[{"typeObject":"hero"}]},"blink":true,"canvasPosition":{"typeObject":"hero"},"onFinish":{"require":[{"moveRequire":true}]}}}')},this.testTalkTutorial=()=>{l('{"tutorial":{"textPc":"Podejdz do zioma tekst","textMobile":"Podejdz do zioma tekst","headerPc":"Podejdz do zioma header","headerMobile":"Podejdz do zioma header","htmlPositionOffset":{"left": 10, "top": 0}, "htmlPosition":".tutorial-banner-anchor","graphic":"/img/gui/newTutorial/8.gif","htmlMultiGlow":[".widget-in-interface-bar.widget-npc-talk-icon"],"canvasMultiGlow":{"objects":[{"typeObject":"npc","id":1}]},"canvasPosition":{"typeObject":"npc","id":10008},"blink":true,"onFinish":{"require":[{"talkNpcId":10008}]}}}')},this.testAttackNpcTutorial=()=>{l('{"tutorial":{"textPc":"Podejdz do zioma tekst","textMobile":"Podejdz do zioma tekst","headerPc":"Podejdz do zioma header","headerMobile":"Podejdz do zioma header","htmlPositionOffset":{"left": 10, "top": 0}, "htmlPosition":".tutorial-banner-anchor","graphic":"/img/gui/newTutorial/8.gif","htmlMultiGlow":[".widget-in-interface-bar.widget-npc-talk-icon"],"canvasMultiGlow":{"objects":[{"typeObject":"npc","id":1}]},"canvasPosition":{"typeObject":"npc","id":76972},"blink":true,"onFinish":{"require":[{"attackNpcId":76972}]}}}')},this.testPreventRepeatAttackNpcTutorial=()=>{l('{"tutorial":{"textPc":"Podejdz do zioma tekst","textMobile":"Podejdz do zioma tekst","headerPc":"Podejdz do zioma header","headerMobile":"Podejdz do zioma header","htmlPositionOffset":{"left":10,"top":0},"htmlPosition":".tutorial-banner-anchor","graphic":"/img/gui/newTutorial/8.gif","htmlMultiGlow":[".widget-in-interface-bar.widget-npc-talk-icon"],"canvasMultiGlow":{"objects":[{"typeObject":"npc","id":1}]},"canvasPosition":{"typeObject":"npc","id":76972},"blink":true,"preventRepeat":{"name":"asd"},"onFinish":{"require":[{"attackNpcId":76972}]}}}')},this.testTutorialExternalProperties=()=>{l('{"tutorial":{"textPc":"Podejdz do zioma tekst","textMobile":"Podejdz do zioma tekst","headerPc":"Podejdz do zioma header","headerMobile":"Podejdz do zioma header","graphic":"/img/gui/newTutorial/8.gif","external_properties":{"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.7},"list":[{"light":{"r":20,"color":{"r":255,"g":157,"b":0,"a":0.6}},"x":26,"y":15,"r":80},{"x":20,"y":15,"r":80}]}},"blink":true,"onFinish":{"external_properties":{"night":{"action":"REMOVE"}},"require":[{"moveRequire":true}]}}}')},this.testTutorialBattleSkill=()=>{l('{"tutorial":{"textPc":"use skill","textMobile":"use skill","headerPc":"use skill","headerMobile":"use skill","graphic":"/img/gui/newTutorial/8.gif","blink":true,"onFinish":{"require":[{"useBattleSkill":-1}]}}}')},this.testTutorialBattleSkillAbsoluteFinishEndBattle=()=>{l('{"tutorial":{"textPc":"use skill","textMobile":"use skill","headerPc":"use skill","headerMobile":"use skill","graphic":"/img/gui/newTutorial/8.gif","blink":true,"onFinish":{"require":[{"useBattleSkill":-1}],"absoluteFinish":["endBattle"]}}}')},this.testTutorialItemsInBasket=()=>{l('{"tutorial":{"textPc":"t_17_ni_pl","textMobile":"t_17_ni_mobile_pl","headerPc":"t_header_17_ni_pl","headerMobile":"t_header_17_ni_pl","graphic":"/img/gui/newTutorial/1.gif","itemsNeed":{"htmlMultiGlow":true,"tpls":{"w":{"9":{"loc":"n","tpl":63}},"p":{"9":{"loc":"n","tpl":63}},"m":{"9":{"loc":"n","tpl":63}},"t":{"9":{"loc":"n","tpl":63}},"h":{"9":{"loc":"n","tpl":63}},"b":{"9":{"loc":"n","tpl":63}}}},"htmlMultiGlow":[".inner-content>.shop-wrapper>.shop-content>.buy-items"],"htmlPosition":".border-window:has(.content:has(.inner-content:has(.shop-wrapper)))","blink":true,"onFinish":{"require":[{"itemsInBasket":true}]}}}')},this.testTutorialItemsInBasketCloseShop=()=>{l('{"tutorial":{"textPc":"t_17_ni_pl","textMobile":"t_17_ni_mobile_pl","headerPc":"t_header_17_ni_pl","headerMobile":"t_header_17_ni_pl","graphic":"/img/gui/newTutorial/1.gif","itemsNeed":{"htmlMultiGlow":true,"tpls":{"w":{"9":{"loc":"n","tpl":63}},"p":{"9":{"loc":"n","tpl":63}},"m":{"9":{"loc":"n","tpl":63}},"t":{"9":{"loc":"n","tpl":63}},"h":{"9":{"loc":"n","tpl":63}},"b":{"9":{"loc":"n","tpl":63}}}},"htmlMultiGlow":[".inner-content>.shop-wrapper>.shop-content>.buy-items"],"htmlPosition":".border-window:has(.content:has(.inner-content:has(.shop-wrapper)))","blink":true,"onFinish":{"require":[{"itemsInBasket":true}],"break":["closeShop"]}}}')},this.testTutorialStepByStep=()=>{l('{"tutorial":{"textPc":"pierwszy tutorial","textMobile":"pierwszy tutorial","headerPc":"pierwszy tutorial","headerMobile":"pierwszy tutorial","graphic":"/img/gui/newTutorial/8.gif","blink":true,"onFinish":{"external_properties":{"tutorial":{"textPc":"drugi tutorial","textMobile":"drugi tutorial","headerPc":"drugi tutorial","headerMobile":"drugi tutorial","graphic":"/img/gui/newTutorial/8.gif","blink":true,"onFinish":{"external_properties":{"night":{"action":"REMOVE"}},"require":[{"useItemTpl":[177]}]}}},"require":[{"moveRequire":true}]}}}')},this.testTutorialStepByStepCloseShop=()=>{l('{"tutorial":{"textPc":"do koszyka itemy now!","textMobile":"do koszyka itemy now!","headerPc":"do koszyka itemy now!","headerMobile":"do koszyka itemy now!","graphic":"/img/gui/newTutorial/1.gif","itemsNeed":{"htmlMultiGlow":true,"tpls":{"w":{"15":{"loc":"n","tpl":3232}},"p":{"15":{"loc":"n","tpl":3232}},"m":{"15":{"loc":"n","tpl":3232}},"t":{"15":{"loc":"n","tpl":3232}},"h":{"15":{"loc":"n","tpl":3232}},"b":{"15":{"loc":"n","tpl":3232}}}},"htmlMultiGlow":[".inner-content>.shop-wrapper>.shop-content>.buy-items"],"htmlPosition":".border-window:has(.content:has(.inner-content:has(.shop-wrapper)))","blink":true,"onFinish":{"require":[{"itemsInBasket":true}],"break":["closeShop"],"external_properties":{"tutorial":{"textPc":"akceptuj itemy now!","textMobile":"akceptuj itemy now!","headerPc":"akceptuj itemy now!","headerMobile":"akceptuj itemy now!","graphic":"/img/gui/newTutorial/1.gif","htmlFocus":".shop-wrapper>.shop-content>.finalize-button","htmlPosition":".shop-wrapper>.shop-content>.finalize-button","blink":true,"onFinish":{"require":[{"acceptBasket":true}],"break":["closeShop"]}}}}}}')},this.testTutorialRecipeWidget=()=>{l('{"tutorial":{"textPc":"click widget CRAFTING!!","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".widget-button:has(.icon.photo)","blink":true,"htmlPosition":".widget-button:has(.icon.photo)","onFinish":{"require":[{"clickWidget":"photo"}]}}}')},this.testTutorialOpenWindow=()=>{l('{"tutorial":{"id": -10,"textPc":"CRAFTING!!","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".widget-button:has(.icon.photo)","blink":true,"htmlPosition":".widget-button:has(.icon.photo)","onFinish":{"require":[{"openWindow":"CRAFTING"}]}}}')},this.testTutorialClickRecipeOnList=()=>{l('{"tutorial":{"textPc":"click widget CRAFTING!!","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".crafting-recipe-in-list.recipe-id-804","blink":true,"htmlPosition":".crafting-recipe-in-list.recipe-id-804","onFinish":{"require":[{"clickRecipeOnList":804}]}}}')},this.testTutorialClickUseRecipe=()=>{l('{"tutorial":{"textPc":"click widget CRAFTING!!","textMobile":"[color=blue]testowy HeaderMobile[/color]","headerPc":"[color=orange]testowy HeaderPc[/color]","headerMobile":"[color=red]testowy HeaderPc[/color]","graphic":"/img/gui/newTutorial/6.gif","htmlFocus":".do-recipe .crafting-description-button .button","blink":true,"htmlPosition":".do-recipe .crafting-description-button .button","onFinish":{"require":[{"useRecipe":804}]}}}')},this.testTutorialBattleEventsOnStartFight=()=>{l('{"battleEvents":{"ON_START_FIGHT_WITH_NPC":{"tutorial":{"blink":true,"draggableWnd":false,"graphic":"/img/gui/newTutorial/9_eng.gif","headerMobile":"Close battle window","headerPc":"Close battle window","htmlFocus":".close-battle-ground","htmlPosition":".tutorial-banner-anchor","onFinish":{"absoluteFinish":["heroEndBattle"],"require":[{"useBattleSkill":-1}]},"textMobile":"","textPc":""}}}}')},this.testTutorialWindowEventsOnOpen=()=>{l('{"windowEvents":{"ON_OPEN":{"windowName":"CRAFTING","external_properties":{"tutorial":{"blink":true,"graphic":"/img/gui/newTutorial/9_eng.gif","headerMobile":"RECIPES WND","headerPc":"Nana","onFinish":{"require":[{"moveRequire":true}]},"textMobile":"asd asd","textPc":"asd asd"}}}}}')},this.testTutorialWindowEventsOnOpen=()=>{l('{"windowEvents":{"list":[{"action":"CREATE","id":0,"name":"ON_UPDATE","windowName":"CRAFTING","external_properties":{"tutorial":{"textPc":"","textMobile":"","headerPc":"Click known recipe","headerMobile":"Click known recipe","graphic":"/img/gui/newTutorial/1.gif","id":-15,"htmlMultiGlow":[".recipe-id-821"],"draggableWnd":false,"htmlPositionOffset":{"left":10,"top":-30},"htmlPosition":".tutorial-banner-anchor","blink":true,"onFinish":{"require":[{"clickRecipeOnList":821}],"break":["closeCrafting"],"external_properties":{"tutorial":{"textPc":"","textMobile":"","headerPc":"Accept offer","headerMobile":"Accept offer","graphic":"/img/gui/newTutorial/1.gif","id":-16,"htmlMultiGlow":[".recipes-content .bottom-row-panel .do-recipe .button.green"],"draggableWnd":false,"htmlPositionOffset":{"left":10,"top":-30},"htmlPosition":".tutorial-banner-anchor","blink":true,"onFinish":{"require":[{"useRecipe":821}],"break":["closeCrafting"]}}}}}}}]}}')},this.testTutorialWindowEventsOnUpdate=()=>{l('{"windowEvents":{"ON_UPDATE":{"windowName":"CRAFTING","external_properties":{"tutorial":{"id":-15,"blink":true,"graphic":"/img/gui/newTutorial/9_eng.gif","headerMobile":"RECIPES WND","headerPc":"Nana","htmlFocus":".crafting-recipe-in-list.recipe-id-244","htmlPosition":".crafting-recipe-in-list.recipe-id-244","onFinish":{"require":[{"clickRecipeOnList":244}]},"textMobile":"asd asd","textPc":"asd asd"}}}}}')},this.testTutorialWindowEventsOnUpdate2=()=>{l('{"windowEvents":{"ON_UPDATE":{"windowName":"CRAFTING","external_properties":{"tutorial":{"id":-15,"blink":true,"graphic":"/img/gui/newTutorial/9_eng.gif","headerMobile":"RECIPES WND","headerPc":"Nana","htmlMultiGlow":[".crafting-recipe-in-list.recipe-id-244"],"htmlPosition":".crafting-recipe-in-list.recipe-id-244","onFinish":{"require":[{"clickRecipeOnList":244}],"break":["closeCrafting"]},"textMobile":"asd asd","textPc":"asd asd"}}}}}')},this.testNightCase=()=>{l('{"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.9},"list":[{"light":{"r":20,"color":{"r":255,"g":157,"b":0,"a":0.6}},"case":{"QUEST":{"ACTIVE":[1718]}},"x":26,"y":15,"r":80},{"x":20,"y":15,"r":80}]}}')},this.testNightCaseMapExternalPropertiesRefresh=()=>{l('{"mapExternalPropertiesRefresh":["night"]}')},this.testNightMinAlpha=()=>{l('{"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.6},"dayNightCycle":{"dayDuration":1,"minAlpha":0.6},"list":[{"x":28,"y":21},{"x":26,"y":21}]}}')},this.testCreateProgrammer10=()=>{l('{"template":{"CREATE_BUBBLE":{"weather":{"list":[{"action":"CREATE","name":"Bubble"}]}},"REMOVE_BUBBLE":{"weather":{"list":[{"action":"REMOVE","name":"Bubble"}]}}},"programmer":{"list":[{"id":10,"action":"CREATE","name":"LOOPPER","duration":"00:01:00","delay":"00:02:00","start":{"time":"00:00:01","external_properties":{"getTpl":"CREATE_BUBBLE"}},"end":{"time":"23:59:59","external_properties":{"getTpl":"REMOVE_BUBBLE"}}}]}}')},this.testBubble=()=>{l('{"weather":{"list":[{"action":"CREATE","name":"Bubble"}]}}')},this.testRemoveProgrammer10=()=>{l('{"programmer":{"list":[{"id":10,"action":"REMOVE","name":"LOOPPER"}]}}')},this.testCreateProgrammer11=()=>{l('{"template":{"CREATE_RAIN":{"weather":{"list":[{"action":"CREATE","name":"Rain"}]}},"REMOVE_RAIN":{"weather":{"list":[{"action":"REMOVE","name":"Rain"}]}}},"programmer":{"list":[{"id":11,"action":"CREATE","name":"NORMAL_DAY","start":{"time":"00:00:01","external_properties":{"getTpl":"CREATE_RAIN"}},"end":{"time":"23:59:59","external_properties":{"getTpl":"REMOVE_RAIN"}}}]}}')},this.testRemoveProgrammer11=()=>{l('{"programmer":{"list":[{"id":11,"action":"REMOVE","name":"NORMAL_DAY"}]}}')},this.testCreateForceProgrammer11=()=>{l('{"programmer":{"list":[{"id":11,"action":"CREATE_FORCE","name":"NORMAL_DAY","start":{"time":"00:00:01","external_properties":{"yellowMessage":{"list":[{"action":"CREATE","text":"Nan na na"}]}}},"end":{"time":"23:59:59"}}]}}')},this.testGetTemplate=()=>{l('{"template":{"0":{"action":"CREATE","windowTarget":"MAP","effect":"ANIMATION","target":{"kind":"FAKE_NPC"},"params":{"position":"RIGHT","gifUrl":"204_blyskawiczny-atak.gif","repeat":1}},"1":{"action":"CREATE","windowTarget":"MAP","effect":"TEXT","target":{"kind":"FAKE_NPC"},"params":{"position":"TOP","text":["one","two","three","four","five","six","seven","eight"]}}},"fakeNpc":{"list":[{"action":"CREATE","id":0,"x":1,"y":5,"img":"/noob/hm.gif","behavior":{"repeat":true,"list":[{"name":"WALK_AND_TP_START","x":13,"y":7,"speed":2,"external_properties":{"characterEffect":{"list":[{"getTpl":0,"name":"Sralala1","target":{"id":0}}]}}}]}},{"action":"CREATE","id":1,"x":2,"y":8,"img":"/noob/hm.gif","click":{"characterEffect":{"list":[{"getTpl":1,"name":"textText2","target":{"id":1},"params":{"repeat":1,"random":"ONE","height":20,"color":"0,255,0"}},{"getTpl":0,"name":"anim1","target":{"id":1},"params":{"position":"CENTER"}}]}},"behavior":{"repeat":true,"list":[{"name":"IDLE"}]}}]}}')},this.testExtraLight=()=>{l('{"extraLight":{"list":[{"action":"CREATE","id":0,"d":{"x":42,"y":16,"r":400}}]}}')},this.testExtraLightRemove=()=>{l('{"extraLight":{"list":[{"action":"REMOVE","id":0}]}}')},this.testExtraLight2=()=>{l('{"extraLight":{"list":[{"action":"CREATE_FORCE","id":0,"d":{"x":20,"y":10,"r":400,"light":{"r":390,"onlyNight":false,"color":{"r":255,"g":23,"b":23,"a":0.75}}}},{"action":"CREATE_FORCE","id":1,"d":{"x":22,"y":10,"r":400,"light":{"onlyNight":false,"r":390,"color":{"r":0,"g":255,"b":0,"a":0.75}}}},{"action":"CREATE_FORCE","id":2,"d":{"x":24,"y":10,"r":400,"light":{"onlyNight":false,"r":390,"color":{"r":0,"g":0,"b":255,"a":0.75}}}}]}}')},this.testExtraLightRemove2=()=>{l('{"extraLight":{"list":[{"action":"REMOVE","id":0},{"action":"REMOVE","id":1},{"action":"REMOVE","id":2}]}}')},this.testDynamicLight0=()=>{l('{"dynamicLight":{"list":[{"action":"CREATE","id":0,"master":{"kind":"HERO"},"d":{"r":80}}]}}')},this.testDynamicLight1=()=>{l('{"dynamicLight":{"list":[{"action":"CREATE","id":0,"master":{"kind":"HERO"},"d":{"offsetX":20,"r":80}}]}}')},this.testDynamicLight2=()=>{l('{"dynamicLight":{"list":[{"action":"CREATE","id":0,"master":{"kind":"HERO"},"d":{"light":{"r":40,"color":{"r":0,"g":255,"b":0,"a":0.5}},"r":80}},{"action":"CREATE","id":0,"master":{"kind":"FAKE_NPC","id":"0-fake-npc-army-0"},"d":{"light":{"r":40,"color":{"r":0,"g":255,"b":0,"a":0.5}},"r":80}}]}}')},this.testDynamicLight3=()=>{l('{"dynamicLight":{"list":[{"action":"CREATE","id":1,"master":{"kind":"HERO"},"d":{"offsetX":-32,"offsetY":-12,"r":60,"light":{"r":50,"color":{"r":219,"g":186,"b":56,"a":0.4}}}},{"action":"CREATE","id":2,"master":{"kind":"HERO"},"d":{"offsetX":32,"offsetY":-32,"r":70,"light":{"r":60,"color":{"r":219,"g":186,"b":56,"a":0.4}}}},{"action":"CREATE","id":3,"master":{"kind":"HERO"},"d":{"offsetY":0,"r":40,"light":{"r":30,"color":{"r":219,"g":186,"b":56,"a":0.4}}}}]}}')},this.testExtraLightClear=()=>{l('{"extraLight":{"action":"CLEAR_DATA"}}')},this.testExtraLightClearDataAndMapExternalPropertiesRefresh=()=>{l('{"mapExternalPropertiesRefresh":["night"],"extraLight":{"action":"CLEAR_DATA"}}')},this.testFloatForeground=()=>{l('{"floatForeground":{"list":[{"id":0,"action":"CREATE","xVector":-0.5,"color":{"r":1,"g":255,"b":0}},{"id":1,"action":"CREATE","xVector":1,"yVector":1,"color":{"r":0,"g":0,"b":255}}]}}')},this.testFloatForegroundRemove=()=>{l('{"floatForeground":{"list":[{"id":0,"action":"REMOVE"}, {"id":1,"action":"REMOVE"}]}}')},this.testyXD0=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"list":[{"name":"WALK","x":5,"y":15},{"name":"WALK","x":12,"y":15},{"name":"WALK","x":12,"y":19},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testyXD1=()=>{l('{"fakeNpc":{"list":[{"action":"REMOVE","id":2}]}}')},this.testyXD2=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE_IF_NOT_EXIST","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"list":[{"name":"WALK","x":5,"y":15},{"name":"WALK","x":12,"y":15},{"name":"WALK","x":12,"y":19},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testyXD3=()=>{l('{"fakeNpc":{"list":[{"action":"REMOVE_IF_EXIST","id":2}]}}')},this.testyRandomFirstIndex=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"randomFirstIndex":{"forActions":["WALK"]},"list":[{"name":"WALK","x":5,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":19},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testyRandomFirstIndex2=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"randomFirstIndex":{},"list":[{"name":"WALK","x":5,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":19},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testyRandomFirstIndex3=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"randomFirstIndex":{"forActions":["WALK","IDLE"]},"list":[{"name":"WALK","x":5,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":19},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testyRandomFirstIndex4=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":2,"img":{"getCharacterData":{"kind":"HERO","toGet":"img"}},"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":1,"randomFirstIndex":{"forActions":["IDLE"]},"list":[{"name":"WALK","x":5,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":15},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":12,"y":19},{"name":"IDLE","duration":1,"dir":"S"},{"name":"WALK","x":15,"y":19}]}}]}}')},this.testCameraTargetSetFakeNpc=()=>{l('{"camera":{"target":{"kind":"FAKE_NPC","id":"loop-fake-npc-0"}}}')},this.testCameraTargetSetPet=()=>{l('{"camera":{"target":{"kind":"PET"}}}')},this.testCameraTargetSetMap=()=>{l('{"camera":{"target":{"kind":"MAP","x":12,"y":6}}}')},this.testCameraTargetClear=()=>{l('{"camera":{"clear":true}}')},this.testHideHero=()=>{l('{"characterHide":{"list":[{"action":"CREATE","target":{"kind":"HERO"}}]}}')},this.testHidePet=()=>{l('{"characterHide":{"list":[{"action":"CREATE","target":{"kind":"PET"}}]}}')},this.testHideNpc=()=>{l('{"characterHide":{"list":[{"action":"CREATE","target":{"kind":"NPC","id":249647}}]}}')},this.testHideNpcWithShowOnMiniMap=()=>{l('{"characterHide":{"list":[{"action":"CREATE","target":{"kind":"NPC","id":249647},"displayOnMiniMap":true}]}}')},this.testUnhideNpc=()=>{l('{"characterHide":{"list":[{"action":"REMOVE","target":{"kind":"NPC","id":249647}}]}}')},this.testDialogueHeaderText=()=>{l('{"dialogue":{"header":{"text":"TEEESTTT"}}}')},this.testDialogueHeaderTextGetCharacterData=()=>{l('{"dialogue":{"header":{"text":{"getCharacterData":{"kind":"HERO","toGet":"nick"}}}}}')},this.testDialogueHeaderTextGetCharacterDataNpc=()=>{l('{"dialogue":{"header":{"text":{"getCharacterData":{"kind":"NPC","id":255396,"toGet":"nick"}}}}}')},this.testDialogueHeaderClear=()=>{l('{"dialogue":{"clear":true}}')},this.testMapFilter1=()=>{l('{"mapFilter":{"color":{"r":100,"g":0,"b":0,"a":0.3}}}')},this.testMapFilter2=()=>{l('{"mapFilter":{"clear":true}}')},this.testCrazyEval=()=>{},this.testRajEmoCreate=()=>{l('{"emoDefinitions":{"list":[{"name":"NPC_SL_SHOP","priority":65,"params":{"action":"OnSelf","filename":"battle.gif","offset":[0,-4]}}]},"emoActions":{"list":[{"action":"CREATE","name":"NPC_SL_SHOP","target":{"kind":"NPC","id":150951}}]}}')},this.testRajEmoRemoveWithRebuild=()=>{l('{"emoActions":{"list":[{"action":"REMOVE","name":"NPC_SL_SHOP","target":{"kind":"NPC","id":48175}}]}}')},this.testRajShopEmoRemove=()=>{l('{"emoActions":{"list":[{"action":"REMOVE","name":"SHOP","target":{"kind":"NPC","id":267672}}]}}')},this.testRajShopEmoCreate=()=>{l('{"emoActions":{"list":[{"action":"CREATE","name":"SHOP","target":{"kind":"NPC","id":267672}}]}}')},this.testRajShopEmoCreateWithCase=()=>{l('{"emoActions":{"list":[{"case":{"list":[{"kind":"ARGUMENT","key":"QUEST","name":"ACTIVE","params":[182]}]},"action":"CREATE","name":"SHOP","target":{"kind":"NPC","id":267672}}]}}')},this.testRajEmoRemoveWithoutRebuild=()=>{l('{"emoActions":{"list":[{"action":"REMOVE","name":"NPC_SL_SHOP","target":{"kind":"NPC","id":210404}}]}}')},this.test1216Group=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","id":0,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[1,0]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[1,0]}}}]}},{"action":"CREATE","id":1,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[-1,0]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[-1,0]}}}]}},{"action":"CREATE","id":2,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[1,-1]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[1,-1]}}}]}},{"action":"CREATE","id":3,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[0,-1]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[0,-1]}}}]}},{"action":"CREATE","id":4,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[-1,-1]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[-1,-1]}}}]}},{"action":"CREATE","id":5,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[1,-2]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[1,-2]}}}]}},{"action":"CREATE","id":6,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[0,-2]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[0,-2]}}}]}},{"action":"CREATE","id":7,"img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":[-1,-2]}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":[-1,-2]}}}]}}]}}')},this.testTutUpdateWnd=()=>{l('{"windowEvents":{"ON_UPDATE":{"windowName":"CRAFTING","external_properties":{"tutorial":{"id":-12, "blink":true,"graphic":"/img/gui/newTutorial/9_eng.gif","headerMobile":"RECIPES WND","headerPc":"Nana","htmlFocus":".crafting-recipe-in-list.recipe-id-244","htmlPosition":".crafting-recipe-in-list.recipe-id-244","onFinish":{"require":[{"clickRecipeOnList":244}]},"textMobile":"asd asd","textPc":"asd asd"}}}}}')},this.test1216Backup=()=>{l('\n        {\n  "template": {\n    "$CLOUD_GROUP" : {\n      "list": [\n        {\n          "getTpl" : "$NORMAL_CLOUD",\n          "tplVars": {\n            "@id": {"getTplVar": "@firstCloudId"},\n            "@x" : {"getTplVar": "@xGroup", "modify": {"kind": "MATH_ADD", "v": -5}},\n            "@y" : {"getTplVar": "@yGroup"},\n            "@maxRGroup" : {"getTplVar": "@rGroup"},\n            "@maxGGroup" : {"getTplVar": "@gGroup"},\n            "@maxBGroup" : {"getTplVar": "@bGroup"}\n          }\n        },\n        {\n          "getTpl" : "$NORMAL_CLOUD",\n          "tplVars": {\n            "@id"        : {"getTplVar": "@seccondCloudId"},\n            "@x"         : {"getTplVar": "@xGroup", "modify": {"kind": "MATH_ADD", "v": 5}},\n            "@y"         : {"getTplVar": "@yGroup"},\n            "@maxRGroup" : {"getTplVar": "@rGroup"},\n            "@maxGGroup" : {"getTplVar": "@gGroup"},\n            "@maxBGroup" : {"getTplVar": "@bGroup"}\n          }\n        }\n      ]\n    },\n    "$NORMAL_CLOUD": {\n      "id"      : {"getTplVar": "@id"},\n      "x"       : {"getTplVar": "@x"},\n      "y"       : {"getTplVar": "@y"},\n      "action"  : "CREATE",\n      "url"     : "chmury/obj2.png",\n      "getTpl"  : "$COLOR_TO_CLOUD",\n      "tplVars" : {\n        "@maxR": {"getTplVar": "@maxRGroup"},\n        "@maxG": {"getTplVar": "@maxGGroup"},\n        "@maxB": {"getTplVar": "@maxBGroup"}\n      },\n      "behavior": {\n        "repeat": true,\n        "list": [\n          {"name": "MOVE_FROM_VECTORS", "xVector": 1.0, "yVector": 1.0},\n          {"name": "TP_ON_OTHER_SIDE"}\n        ]\n      }\n    },\n    "$COLOR_RANDOM" : {\n      "getRandom": {\n        "start"      : 0,\n        "end"        : {"getTplVar": "@max"},\n        "resultType" : "int"\n      }\n    },\n    "$COLOR_TO_CLOUD": {\n      "color": {\n        "r": {"getTpl": "$COLOR_RANDOM", "tplVars": {"@max":{"getTplVar": "@maxR"}}},\n        "g": {"getTpl": "$COLOR_RANDOM", "tplVars": {"@max":{"getTplVar": "@maxG"}}},\n        "b": {"getTpl": "$COLOR_RANDOM", "tplVars": {"@max":{"getTplVar": "@maxB"}}},\n        "a": 1\n      }\n    }\n  },\n  "floatObject": {\n    "getTpl": "$CLOUD_GROUP",\n    "tplVars": {\n      "@firstCloudId"   : "firstCloud-0",\n      "@seccondCloudId" : "seccondCloud-0",\n      "@xGroup"         : 10,\n      "@yGroup"         : 10,\n      "@rGroup"         : 255,\n      "@gGroup"         : 255,\n      "@bGroup"         : 255\n    }\n  }\n}\n        ')},this.floatObjectRandomFirstIndex=()=>{l('{"template":{"$CLOUD_GROUP":{"list":[{"getTpl":"$NORMAL_CLOUD","tplVars":{"@id":{"getTplVar":"@firstCloudId"},"@x":{"getTplVar":"@xGroup","modify":{"kind":"MATH_ADD","v":-5}},"@y":{"getTplVar":"@yGroup"},"@maxRGroup":{"getTplVar":"@rGroup"},"@maxGGroup":{"getTplVar":"@gGroup"},"@maxBGroup":{"getTplVar":"@bGroup"}}},{"getTpl":"$NORMAL_CLOUD","tplVars":{"@id":{"getTplVar":"@seccondCloudId"},"@x":{"getTplVar":"@xGroup","modify":{"kind":"MATH_ADD","v":5}},"@y":{"getTplVar":"@yGroup"},"@maxRGroup":{"getTplVar":"@rGroup"},"@maxGGroup":{"getTplVar":"@gGroup"},"@maxBGroup":{"getTplVar":"@bGroup"}}}]},"$NORMAL_CLOUD":{"id":{"getTplVar":"@id"},"x":{"getTplVar":"@x"},"y":{"getTplVar":"@y"},"action":"CREATE","url":"chmury/obj2.png","getTpl":"$COLOR_TO_CLOUD","tplVars":{"@maxR":{"getTplVar":"@maxRGroup"},"@maxG":{"getTplVar":"@maxGGroup"},"@maxB":{"getTplVar":"@maxBGroup"}},"behavior":{"repeat":true,"randomFirstIndex":{"forActions":["MOVE_FROM_VECTORS"]},"list":[{"name":"MOVE_FROM_VECTORS","xVector":-1.0,"yVector":1.0},{"name":"TP_ON_OTHER_SIDE"},{"name":"MOVE_FROM_VECTORS","xVector":1.0,"yVector":-1.0},{"name":"TP_ON_OTHER_SIDE"},{"name":"MOVE_FROM_VECTORS","xVector":1.0,"yVector":1.0},{"name":"TP_ON_OTHER_SIDE"}]}},"$COLOR_RANDOM":{"getRandom":{"start":0,"end":{"getTplVar":"@max"},"resultType":"int"}},"$COLOR_TO_CLOUD":{"color":{"r":{"getTpl":"$COLOR_RANDOM","tplVars":{"@max":{"getTplVar":"@maxR"}}},"g":{"getTpl":"$COLOR_RANDOM","tplVars":{"@max":{"getTplVar":"@maxG"}}},"b":{"getTpl":"$COLOR_RANDOM","tplVars":{"@max":{"getTplVar":"@maxB"}}},"a":1}}},"floatObject":{"getTpl":"$CLOUD_GROUP","tplVars":{"@firstCloudId":"firstCloud-0","@seccondCloudId":"seccondCloud-0","@xGroup":10,"@yGroup":10,"@rGroup":255,"@gGroup":255,"@bGroup":255}}}')},this.test1216AllBackup=()=>{l('{"template":{"pink-cloud":{"action":"CREATE","offsetX":-6,"offsetY":-24,"url":"chmury/obj2.png","color":{"r":{"getRandom":{"start":0,"end":233,"resultType":"int"}},"g":{"getRandom":{"start":0,"end":233,"resultType":"int"}},"b":{"getRandom":{"start":0,"end":233,"resultType":"int"}},"a":0.6}},"my-text":{"action":"CREATE","windowTarget":"MAP","name":"text1","target":{"kind":"FAKE_NPC","id":"army-leader-0"},"effect":"TEXT","params":{"duration":1,"position":"TOP"}}},"programmer":{"loopper":[{"loopStart":"10:00:00","loopEnd":"21:00:00","cycle":{"delay":"00:02:00","duration":"00:01:00","startData":{"weather":{"list":[{"action":"CREATE","name":"Rain","speedY":-1,"speedX":2}]}},"endData":{"weather":{"list":[{"action":"REMOVE","name":"Rain","speedY":-1,"speedX":2}]}}}}]},"night":{"action":"CREATE","color":{"r":0,"g":0,"b":0,"a":0.3},"list":[{"x":20,"y":15,"r":80}]},"floatForeground":{"list":[{"id":0,"action":"CREATE","yVector":-0.6,"color":{"r":0,"g":255,"b":0,"a":0.5}},{"id":1,"action":"CREATE","yVector":-0.4,"xVector":-0.3,"color":{"r":0,"g":0,"b":255,"a":0.3}}]},"floatObject":{"list":[{"getFor":{"idPrefix":"dupa-","forVars":[{"x":1,"yVectormodify":0.2},{"x":2,"yVectormodify":1},{"x":5,"yVectormodify":2},{"x":7,"yVectormodify":2.5},{"x":5,"yVectormodify":0.1},{"x":2,"yVectormodify":0.5},{"x":8,"yVectormodify":1},{"x":9,"yVectormodify":2.5},{"x":1,"yVectormodify":0.5},{"x":2,"yVectormodify":0.1},{"x":1,"yVectormodify":2}],"data":{"getTpl":"pink-cloud","x":{"getForVar":"x"},"y":{"getRandom":{"start":5,"end":10,"resultType":"int"}},"behavior":{"repeat":true,"list":[{"name":"MOVE_FROM_VECTORS","xVector":{"getForVar":"yVectormodify"}}]}}}},{"id":0,"action":"CREATE","x":{"getRandom":{"start":5,"end":30,"resultType":"int"}},"y":5,"url":"chmury/obj1.png","color":{"r":0,"g":255,"b":0},"behavior":{"repeat":true,"list":[{"name":"MOVE_FROM_VECTORS","xVector":-0.5}]}},{"id":1,"action":"CREATE","x":5,"y":8,"url":"chmury/obj1.png","color":{"a":0.5},"behavior":{"repeat":true,"list":[{"name":"MOVE_FROM_VECTORS","xVector":1,"yVector":1},{"name":"TP_TO_CORDS","x":5,"yVector":8}]}},{"id":2,"action":"CREATE","x":5,"y":10,"gif":true,"url":"chmury/99_gorace-uderzenie.gif","color":{"a":0.5},"behavior":{"repeat":true,"list":[{"name":"MOVE_FROM_VECTORS"}]}},{"id":3,"action":"CREATE","x":8,"y":10,"gif":true,"url":"chmury/99_gorace-uderzenie.gif","color":{"r":0,"g":255,"b":255},"behavior":{"repeat":true,"list":[{"name":"MOVE_FROM_VECTORS"}]}}]},"fakeNpc":{"list":[{"action":"CREATE","img":"noob/bm.gif","id":"army-leader-0","speed":1,"x":6,"dir":"N","y":16,"behavior":{"list":[{"name":"IDLE","duration":13,"dir":"N","external_properties":{"characterEffect":{"list":[{"getTpl":"my-text","params":{"text":["W prawo"]}}]}}},{"name":"IDLE","duration":13,"dir":"N","external_properties":{"characterEffect":{"list":[{"getTpl":"my-text","params":{"text":["W lewo"]}}]}}}]}},{"getFor":{"idPrefix":"","forVars":[{"x":1},{"x":2},{"x":3},{"x":4},{"x":5},{"x":6},{"x":7}],"data":{"getFor":{"idPrefix":"-fake-npc-army-","forVars":[{"x":{"getForVar":"x","parent":0},"y":9,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}},{"x":{"getForVar":"x","parent":0},"y":10,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}},{"x":{"getForVar":"x","parent":0},"y":11,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}},{"x":{"getForVar":"x","parent":0},"y":12,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}},{"x":{"getForVar":"x","parent":0},"y":13,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}},{"x":{"getForVar":"x","parent":0},"y":14,"xMove":{"getMath":{"resultType":"int","list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":3}]}}}],"data":{"action":"CREATE","img":"noob/bm.gif","speed":1,"x":{"getForVar":"x"},"y":{"getForVar":"y"},"behavior":{"list":[{"name":"WALK","x":{"getForVar":"xMove"},"y":{"getForVar":"y"}},{"name":"IDLE","duration":10,"dir":"S"},{"name":"WALK","x":{"getForVar":"x"},"y":{"getForVar":"y"}},{"name":"IDLE","duration":10,"dir":"S"}]}}}}}},{"getFor":{"idPrefix":"group-","forVars":[{"xMove":1,"yMove":0},{"xMove":-1,"yMove":0},{"xMove":1,"yMove":-1},{"xMove":0,"yMove":-1},{"xMove":-1,"yMove":-1},{"xMove":1,"yMove":-2},{"xMove":0,"yMove":-2},{"xMove":-1,"yMove":-2}],"data":{"action":"CREATE","img":"/noob/hm.gif","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"dir":{"getCharacterData":{"kind":"HERO","toGet":"dir"}},"behavior":{"repeat":true,"list":[{"name":"WALK","x":{"getCharacterData":{"kind":"HERO","toGet":"x","rotation":{"x":{"getForVar":"xMove"},"y":{"getForVar":"yMove"}}}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y","rotation":{"x":{"getForVar":"xMove"},"y":{"getForVar":"yMove"}}}}}]}}}}]}}')},this.test1237Backup=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","effect":"TINT","name":"MAP-TEST","target":{"kind":"ALL_MONSTER"},"params":{"position":"CENTER","repeat":true,"color":"0,255,0","duration":2}}]},"fakeNpc":{"list":[{"getFor":{"idPrefix":"loop-fake-npc-","forVars":[{"x":1,"y":0},{"x":1,"y":1},{"x":1,"y":2},{"x":2,"y":0}],"data":{"action":"CREATE","img":"noob/bm.gif","speed":4,"x":{"getForVar":"x"},"y":{"getForVar":"y"},"behavior":{"repeat":true,"list":[{"getFor":{"idPrefix":"loop-deep-behaviour-","forVars":[{"xMove":{"getMath":{"list":[{"v":{"getForVar":"x","parent":0}},{"a":"+"},{"v":{"getForVar":"index","parent":0}}],"resultType":"int"}},"yMove":{"getForVar":"y","parent":0}},{"xMove":{"getForVar":"x","parent":0},"yMove":{"getForVar":"y","parent":0}}],"data":{"name":"WALK","x":{"getForVar":"xMove"},"y":{"getForVar":"yMove"}}}},{"name":"IDLE","duration":{"getRandom":{"start":1,"end":4,"resultType":"int"}},"dir":"S"}]}}}}]}}')},this.test2318Backup=()=>{l('{"template":{"oneRoundBehaviour":{"getFor":{"idPrefix":"one-round","forVars":[{"x":0,"y":2},{"x":0,"y":5},{"x":2,"y":5},{"x":2,"y":0}],"data":{"name":"WALK","x":{"getForVar":"x"},"y":{"getForVar":"y"}}}}},"fakeNpc":{"list":[{"action":"CREATE","id":66,"img":"noob/bm.gif","speed":4,"x":3,"y":5,"behavior":{"repeat":true,"list":[{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"getTpl":"oneRoundBehaviour"},{"name":"IDLE","duration":5,"dir":"S"}]}}]}}')},this.testScreenEffects1=()=>{l('{"screenEffects":{"list":[{"id":0,"action":"CREATE","behavior":{"list":[{"repeat":1,"duration":2,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":0.1},"color1":{"r":0,"g":0,"b":0,"a":0.9}}},{"repeat":1,"duration":2,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":0.9},"color1":{"r":0,"g":0,"b":0,"a":0.9},"holes":[{"hole0":{"r":200,"x":5,"y":3,"gradientPercent1":0,"gradientPercent2":0},"hole1":{"r":100,"x":22,"y":16,"gradientPercent1":0,"gradientPercent2":0}},{"hole0":{"r":100,"x":22,"y":16,"gradientPercent1":0,"gradientPercent2":0},"hole1":{"r":200,"x":5,"y":3,"gradientPercent1":0,"gradientPercent2":0}}]}},{"repeat":1,"duration":2,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":0.9},"color1":{"r":0,"g":0,"b":0,"a":0.9},"holes":[{"hole0":{"r":200,"x":22,"y":16,"gradientPercent1":0,"gradientPercent2":0},"hole1":{"r":200,"x":6,"y":10,"gradientPercent1":0,"gradientPercent2":0}}]}},{"repeat":1,"duration":1.5,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":0.9},"color1":{"r":0,"g":0,"b":0,"a":0.9},"holes":[{"hole0":{"r":200,"x":6,"y":10,"gradientPercent1":0,"gradientPercent2":0},"hole1":{"r":200,"x":13,"y":8,"gradientPercent1":0,"gradientPercent2":0}}]}},{"repeat":1,"duration":5,"mode":"static","data":{"color":{"r":0,"g":0,"b":0,"a":0.9},"holes":[{"r":200,"x":13,"y":8,"gradientPercent1":0,"gradientPercent2":0}]}}]}}]}}')},this.testScreenEffectsRemoveIfExist=()=>{l('{"screenEffects":{"list":[{"id":0,"action":"REMOVE_IF_EXIST"}]}}')},this.testScreenEffectsHolesDynamicCreateIfNotExist=()=>{l('{"screenEffects":{"list":[{"id":0,"action":"CREATE_IF_NOT_EXIST","behaviour":[{"repeat":1,"duration":2,"mode":"static","data":{"color":{"r":0,"g":0,"b":0,"a":0.9},"holes":[{"r":50,"x":10,"y":10},{"r":50,"x":20,"y":10}]}}]},{"id":1,"action":"CREATE","behaviour":[{"repeat":1,"duration":2,"mode":"static","data":{"color":{"r":0,"g":0,"b":0,"a":0.5},"holes":[{"r":100,"x":10,"y":10}]}}]}]}}')},this.testSequence=()=>{l('{"template":{"tpl-create-snow":{"weather":{"list":[{"action":"CREATE","name":"Snow"}]}},"tpl-remove-snow":{"weather":{"list":[{"action":"REMOVE","name":"Snow"}]}},"tpl-create-rain":{"weather":{"list":[{"action":"CREATE","name":"Rain"}]}},"tpl-remove-rain":{"weather":{"list":[{"action":"REMOVE","name":"Rain"}]}}},"sequence":{"list":[{"id":0,"action":"CREATE","repeat":2,"behavior":[{"delayBefore":2,"repeat":2,"external_properties":{"getTpl":"tpl-create-snow"}},{"duration":0,"external_properties":{"getTpl":"tpl-remove-snow"}},{"duration":1,"repeat":10,"external_properties":{"getTpl":"tpl-create-rain"}},{"duration":0.2,"repeat":20,"external_properties":{"getTpl":"tpl-create-snow"}},{"duration":0,"external_properties":{"getTpl":"tpl-remove-rain"}},{"duration":0,"external_properties":{"getTpl":"tpl-remove-snow"}}]}]}}')},this.testRemoveSequence=()=>{l('{"sequence":{"list":[{"id":0,"action":"REMOVE"}]}}')},this.testSound=()=>{l('{"sound":{"list":[{"id":0,"action":"CREATE","url":"kogut01.mp3"}]}}')},this.testSoundRepeat=()=>{l('{"sound":{"list":[{"id":0,"action":"CREATE","repeat":2,"url":"kogut01.mp3"}]}}')},this.testSoundSource=()=>{l('{"sound":{"list":[{"id":1,"action":"CREATE","repeat":true,"url":"kogut01.mp3","source":{"x":10,"y":10,"range":5}}]}}')},this.testSoundInfinitiveRepeat=()=>{l('{"sound":{"list":[{"id":0,"action":"CREATE","repeat":true,"url":"kogut01.mp3"}]}}')},this.testRemoveSound=()=>{l('{"sound":{"list":[{"id":0,"action":"REMOVE"}]}}')},this.testAven=()=>{l('{"template":{"oneRoundBehaviour":{"getFor":{"idPrefix":"one-round","forVars":[{"x":12,"y":13},{"x":11,"y":16},{"x":14,"y":17},{"x":13,"y":13}],"data":{"name":"WALK","x":{"getForVar":"x"},"y":{"getForVar":"y"}}}}},"callInstantBehaviorFakeNpc":{"list":[{"getFor":{"idPrefix":"fakeNPClist","forVars":[{"id":41},{"id":42},{"id":43},{"id":44},{"id":45},{"id":46},{"id":47},{"id":48}],"data":{"id":{"getForVar":"id"},"repeat":1,"list":[{"getTpl":"oneRoundBehavior"},{"getTpl":"oneRoundBehavior"}]}}}]},"characterHide":{"list":[{"action":"CREATE","kind":"NPC","id":264318},{"action":"CREATE","kind":"NPC","id":264319},{"action":"CREATE","kind":"NPC","id":264320},{"action":"CREATE","kind":"NPC","id":264321},{"action":"CREATE","kind":"NPC","id":264322},{"action":"CREATE","kind":"NPC","id":264323},{"action":"CREATE","kind":"NPC","id":264324},{"action":"CREATE","kind":"NPC","id":264325}]}}')},this.testAven2=()=>{l('{"template":{"oneRoundBehavior":{"getFor":{"idPrefix":"one-round","forVars":[{"x":12,"y":13},{"x":11,"y":16},{"x":14,"y":17},{"x":13,"y":13}],"data":{"name":"WALK","x":{"getForVar":"x"},"y":{"getForVar":"y"}}}}},"callInstantBehaviorFakeNpc":{"list":[{"getFor":{"idPrefix":"fakeNPClist","iterations":8,"data":{"repeat":1,"list":[{"getTpl":"oneRoundBehavior"},{"getTpl":"oneRoundBehavior"}]}}}]},"characterHide":{"list":[{"action":"CREATE","kind":"NPC","id":264318},{"action":"CREATE","kind":"NPC","id":264319},{"action":"CREATE","kind":"NPC","id":264320},{"action":"CREATE","kind":"NPC","id":264321},{"action":"CREATE","kind":"NPC","id":264322},{"action":"CREATE","kind":"NPC","id":264323},{"action":"CREATE","kind":"NPC","id":264324},{"action":"CREATE","kind":"NPC","id":264325}]}}')},this.tesAreaTriggerTest=()=>{l('{"areaTrigger":{"list":[{"id":1,"action":"CREATE","x":5,"y":5,"cols":1,"rows":1,"exceptionCords":[],"additionalCords":[],"repeat":true,"callOnEachMapAreaCord":true,"external_properties":{"sound":{"list":[{"id":0,"action":"CREATE","repeat":1,"url":"kogut01.mp3"}]}}}]}}')},this.removeAreaTriggerTest=()=>{l('{"areaTrigger":{"list":[{"id":1,"action":"REMOVE"}]}}')},this.testAlbion=()=>{l('{"template":{"dream-0":{"screenEffects":{"list":[{"id":0,"action":"CREATE","behavior":[{"repeat":1,"duration":1,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":0},"color1":{"r":0,"g":0,"b":0,"a":1.0}}},{"duration":1,"mode":"static","data":{"color":{"r":0,"g":0,"b":0,"a":1.0}}},{"repeat":1,"duration":0.2,"mode":"transition","data":{"color0":{"r":0,"g":0,"b":0,"a":1.0},"color1":{"r":0,"g":0,"b":0,"a":0}}}]}]}},"earthQuake-effect-0":{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"MAP","effect":"TEXT","name":"kajuta-nad-hero","params":{"color":"255,0,0","height":20,"position":"TOP","text":["What this time?!"]},"target":{"kind":"NPC","id":140821}},{"action":"CREATE","windowTarget":"MAP","effect":"TEXT","name":"kajuta-nad-albion","params":{"duration":60,"height":15,"position":"TOP","text":["Looks like we`re not going to rest yet! Quick, lets go to on main deck!"]},"target":{"kind":"NPC","id":140792}}]},"earthQuake":{"duration":1,"frequency":0.4,"quantity":2}}},"sequence":{"list":[{"id":0,"action":"CREATE","behavior":{"list":[{"duration":2,"external_properties":{"getTpl":"dream-0"}},{"duration":1,"external_properties":{"getTpl":"earthQuake-effect-0"}}]}}]}}')},this.testDeclareMapMusic=()=>{l('{"mapMusic":{"list":[{"action":"CREATE","id":0,"file":"0.mp3"},{"action":"CREATE","id":1,"file":"1.mp3"}]}}')},this.testChangeMapMusic=()=>{l('{"mapMusic":{"play":{"id":1}}}')},this.testBehaviorDynamicLight=()=>{l('{"behaviorDynamicLight":{"list":[{"id":0,"action":"CREATE","d":{"x":10,"y":10,"r":200,"light":{"r":20,"color":{"r":0,"g":0,"b":0,"a":1}},"behavior":{"list":[{"name":"IDLE"},{"name":"MOVE_TO_CORDS","x":5,"y":15},{"name":"TRANSITION_AND_MOVE_TO_CORDS","x":5,"y":15,"light":{"color":{"r":0,"g":0,"b":0,"a":1}}},{"name":"TRANSITION","light":{"color":{"r":200,"g":200,"b":200,"a":1}}},{"name":"TRANSITION","r":400},{"name":"TRANSITION","light":{"r":40,"color":{"r":100,"g":100,"b":100,"a":1}}}]}}}]}}')},this.testRemoveBehaviorDynamicLight=()=>{l('{"behaviorDynamicLight":{"list":[{"id":0,"action":"REMOVE"}]}}')},this.testZoom=()=>{l('{"zoom":{"zoom":2}}')},this.testEarthQuake1=()=>{l('{"earthQuake":{"duration":10,"frequency":0.4,"quantity":2}}')},this.testEarthQuake2=()=>{l('{"earthQuake":{"duration":1,"frequency":0.4,"quantity":2, "power":100}}')},this.testEarthQuake3=()=>{l('{"earthQuake":{"clear":true}}')},this.testInterfaceSkin1=()=>{l('{"interfaceSkin":{"name":"redscale"}}')},this.testInterfaceSkin2=()=>{l('{"interfaceSkin":{"clear":true}}')},this.testZoomDuration=()=>{l('{"zoom":{"zoom":2,"speed":3,"duration":5}}')},this.testZoomClear=()=>{l('{"zoom":{"clear":true}}')},this.tutorialBarterTest=()=>{l('{"connectSraj":[{"tutorial":{"textPc":"t_17_ni_pl","textMobile":"t_17_ni_mobile_pl","headerPc":"t_header_17_ni_pl","headerMobile":"t_header_17_ni_pl","graphic":"/img/gui/newTutorial/1.gif","id":-10,"htmlMultiGlow":[".offer-id-4645"],"htmlPosition":".barter-window","blink":true,"onFinish":{"require":[{"clickBarterOfferOnList":4645}],"break":["closeBarter"],"external_properties":{"tutorial":{"textPc":"asd","textMobile":"asd","headerPc":"asd","headerMobile":"asd","graphic":"/img/gui/newTutorial/1.gif","id":-11,"htmlMultiGlow":[".barter-content>.bottom-row-panel>.do-recipe>.button.green"],"htmlPosition":".barter-window","blink":true,"onFinish":{"require":[{"clickBarterOfferOnList":4645}],"break":["closeBarter"]}}}}}}]}')},this.tutorialBarterTest2=()=>{l('{"connectSraj":[{"tutorial":{"textPc":"t_17_ni_pl","textMobile":"t_17_ni_mobile_pl","headerPc":"t_header_17_ni_pl","headerMobile":"t_header_17_ni_pl","graphic":"/img/gui/newTutorial/1.gif","id":-10,"htmlMultiGlow":[".offer-id-4645"],"htmlPosition":".barter-window","blink":true,"onFinish":{"require":[{"clickBarterOfferOnList":4645}],"break":["closeBarter"]}}}]}')},this.tutorialBarterTest3=()=>{l('{"connectSraj":[{"tutorial":{"textPc":"asd","textMobile":"asd","headerPc":"asd","headerMobile":"asd","graphic":"/img/gui/newTutorial/1.gif","id":-11,"htmlMultiGlow":[".barter-content>.bottom-row-panel>.do-recipe>.button.green"],"htmlPosition":".barter-window","blink":true,"onFinish":{"require":[{"useBarterOffer":4645}],"break":["closeBarter"]}}}]}')},this.testTut=()=>{l('{"tutorial":{"textPc":"t_17_ni_pl","textMobile":"t_17_ni_mobile_pl","headerPc":"t_header_17_ni_pl","headerMobile":"t_header_17_ni_pl","graphic":"/img/gui/newTutorial/1.gif","id":-10,"itemsNeed":{"htmlMultiGlow":true,"items":{"w":{"16":{"loc":"g","tpl":48455}},"p":{"16":{"loc":"g","tpl":48455}},"m":{"16":{"loc":"g","tpl":48455}},"t":{"16":{"loc":"g","tpl":48455}},"h":{"16":{"loc":"g","tpl":48455}},"b":{"16":{"loc":"g","tpl":48455}}}},"htmlPosition":".credits-tip","blink":true,"onFinish":{"require":[{"clickBarterOfferOnList":4645}],"break":["closeBarter"],"external_properties":{}}}}')},this.testBattleEffect=()=>{Engine.rajController.parseJSON('{"characterEffect":{"list":[{"action":"CREATE","windowTarget":"BATTLE","name":"FIGHT-MAP","effect":"ANIMATION","target":{"kind":"NPC","id":133569},"params":{"gifUrl":"22_ogluszajacy-cios.gif","position":"CENTER","repeat":10}},{"action":"CREATE","windowTarget":"BATTLE","name":"FIGHT-MAP","effect":"ANIMATION","target":{"kind":"NPC","id":133569},"params":{"gifUrl":"22_ogluszajacy-cios.gif","position":"LEFT","repeat":10}},{"action":"CREATE","windowTarget":"BATTLE","name":"FIGHT-MAP","effect":"ANIMATION","target":{"kind":"NPC","id":133569},"params":{"gifUrl":"22_ogluszajacy-cios.gif","position":"RIGHT","repeat":10}},{"action":"CREATE","windowTarget":"BATTLE","name":"FIGHT-MAP","effect":"ANIMATION","target":{"kind":"NPC","id":133569},"params":{"gifUrl":"22_ogluszajacy-cios.gif","position":"TOP","repeat":10}},{"action":"CREATE","windowTarget":"BATTLE","name":"FIGHT-MAP","effect":"ANIMATION","target":{"kind":"NPC","id":133569},"params":{"gifUrl":"22_ogluszajacy-cios.gif","position":"BOTTOM","repeat":10}}]}}')},this.testCreateDynamicDirCharacterLight=()=>{Engine.rajController.parseJSON('{"dynamicDirCharacterLight":{"list":[{"action":"CREATE","id":20,"master":{"kind":"HERO"},"d":{"base":{"r":80,"light":{"r":15,"color":{"r":255,"g":0,"b":0,"a":0.8}}},"S":{"offsetX":-10},"N":{"offsetX":10},"W":{"cover":true}}}]}}')},this.testRemoveDynamicDirCharacterLight=()=>{Engine.rajController.parseJSON('{"dynamicDirCharacterLight":{"list":[{"action":"REMOVE","id":20}]}}')},this.testCreateTrackingParent=()=>{Engine.rajController.parseJSON('{"tracking":{"parent":{"kind":"FLOAT_OBJECT","id":"followTest0"}}}')},this.testCreateTrackingTarget=()=>{Engine.rajController.parseJSON('{"tracking":{"target":{"list":[{"id":0,"name":"asdasd","x":50,"y":50}]}}}')},this.testRemoveTracking=()=>{Engine.rajController.parseJSON('{"tracking":{"clear":true}}')},this.testFollow=()=>{Engine.rajController.parseJSON('{"floatObject":{"list":[{"id":"followTest0","x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}},"action":"CREATE","url":"chmury/obj2.png","color":{"r":0,"g":255,"b":0,"a":1},"behavior":{"repeat":true,"list":[{"name":"FOLLOW","speed":0.5,"duration":2,"x":{"getCharacterData":{"kind":"HERO","toGet":"x"}},"y":{"getCharacterData":{"kind":"HERO","toGet":"y"}}}]}}]}}')},this.testCallInstantBehaviorFloatObject=()=>{Engine.rajController.parseJSON('{"callInstantBehaviorFloatObject":{"list":[{"id":"moveNoiseTest1","repeat":1,"list":[{"name":"MOVE_TO_CORDS","x":22,"y":12}]}]}}')},this.testMoveNoise0=()=>{Engine.rajController.parseJSON('\n{"floatObject":{"list":[{"id":"moveNoiseTest0","action":"CREATE_IF_NOT_EXIST","url":"chmury/obj2.png","x":12,"y":12,"behavior":{"list":[{"name":"IDLE","repeat":true,"attachMoveNoise":{"vals":[{"x":-1.5,"y":-0.5,"speed":0.5},{"x":0.0,"y":1.0,"speed":0.5},{"x":-0.5,"y":0.1,"speed":0.5},{"x":-0.2,"y":-0.1,"speed":0.5},{"x":-1.5,"y":-0.5,"speed":0.5},{"x":0.0,"y":1.0,"speed":0.5},{"x":-0.5,"y":0.1,"speed":0.5},{"x":-0.2,"y":-0.1,"speed":0.5}]}}]}}]}}')},this.testMoveNoise1=()=>{Engine.rajController.parseJSON('\n{"floatObject":{"list":[{"id":"moveNoiseTest1","action":"CREATE_IF_NOT_EXIST","url":"chmury/obj2.png","x":8,"y":12,"behavior":{"list":[{"name":"IDLE","repeat":true,"attachMoveNoise":{"vals":[{"x":-1.5,"y":-0.5,"speed":35},{"x":0.0,"y":1.0,"speed":35},{"x":-0.5,"y":0.1,"speed":35},{"x":-0.2,"y":-0.1,"speed":35},{"x":-1.5,"y":-0.5,"speed":35},{"x":0.0,"y":0.1,"speed":35},{"x":-0.5,"y":0.1,"speed":35},{"x":-0.2,"y":-0.1,"speed":35}]}}]}}]}}')},this.testMoveNoise2=()=>{Engine.rajController.parseJSON('\n{"floatObject":{"list":[{"id":"moveNoiseTest2","action":"CREATE_IF_NOT_EXIST","url":"chmury/obj2.png","x":4,"y":12,"behavior":{"list":[{"name":"IDLE","repeat":true,"attachMoveNoise":{"vals":[{"x":-0.02,"y":-0.1,"speed":35},{"x":0.01,"y":0.1,"speed":35},{"x":-0.1,"y":0.1,"speed":35},{"x":-0.05,"y":-0.1,"speed":35},{"x":-0.05,"y":-0.1,"speed":35},{"x":0.0,"y":0.01,"speed":35},{"x":-0.1,"y":0.1,"speed":35},{"x":0.2,"y":-0.1,"speed":35}]}}]}}]}}')},this.testMoveNoise3=()=>{Engine.rajController.parseJSON('\n{"floatObject":{"list":[{"id":"moveNoiseTest3","action":"CREATE_IF_NOT_EXIST","url":"chmury/obj2.png","x":4,"y":15,"behavior":{"list":[{"name":"IDLE","repeat":true,"attachMoveNoise":{"vals":[{"x":-0.02,"y":-0.01,"speed":10},{"x":0.01,"y":0.01,"speed":10},{"x":-0.03,"y":-0.02,"speed":10},{"x":-0.01,"y":-0.03,"speed":10},{"x":0.02,"y":0.03,"speed":10},{"x":-0.02,"y":0.01,"speed":10},{"x":-0.10,"y":0.04,"speed":10},{"x":0.02,"y":-0.1,"speed":10}]}}]}}]}}')},this.testMoveNoise4=()=>{Engine.rajController.parseJSON('\n{"floatObject":{"list":[{"id":"moveNoiseTest4","action":"CREATE_IF_NOT_EXIST","url":"chmury/obj2.png","x":4,"y":15,"behavior":{"list":[{"name":"IDLE","repeat":true,"attachMoveNoise":{"vals":[{"x":-0.02,"y":-0.01,"speed":0.03},{"x":0.01,"y":0.01,"speed":0.03},{"x":-0.03,"y":-0.02,"speed":0.03},{"x":-0.01,"y":-0.03,"speed":0.03},{"x":0.02,"y":0.03,"speed":0.03},{"x":-0.02,"y":0.01,"speed":0.03},{"x":-0.10,"y":0.04,"speed":0.03},{"x":0.02,"y":-0.1,"speed":0.03}]}}]}}]}}')},this.testBehaviorDynamicLight2=()=>{l('\n{"behaviorDynamicLight":{"list":[{"id":0,"action":"CREATE","d":{"x":10,"y":10,"r":200,"light":{"r":20,"color":{"r":255,"g":0,"b":0,"a":1}},"behavior":{"repeat":true,"list":[{"name":"IDLE"},{"name":"MOVE","x":10,"y":20},{"name":"IDLE","duration":1},{"name":"MOVE","x":20,"y":20}]}}}]}}\n        ')},this.testCreateFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE","x":10,"y":15,"id":"fakeNpcTest0","img":"/noob/hm.gif","behavior":{"list":[{"name":"IDLE"}]}}]}}')},this.testCreateForceFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"CREATE_FORCE","x":10,"y":15,"id":"fakeNpcTest0","img":"/paid/slowianka1.gif","behavior":{"list":[{"name":"WALK_AND_TP_START","x":1,"y":1}]}}]}}')},this.testRemoveFakeNpc=()=>{l('{"fakeNpc":{"list":[{"action":"REMOVE","x":10,"y":15,"id":"fakeNpcTest0"}]}}')},this.testCreateFloatObject=()=>{l('{"floatObject":{"list":[{"id":"testBehavior0","action":"CREATE","url":"chmury/obj1.png","withCreateInstantFadeIn":true,"x":27,"y":20,"behavior":{"list":[{"name":"MOVE_TO_CORDS","x":10,"y":10,"speed":1}]}}]}}')},this.testCreateForceFloatObject=()=>{l('{"floatObject":{"list":[{"id":"testBehavior0","action":"CREATE_FORCE","url":"chmury/obj1.png","withCreateInstantFadeIn":true,"x":1,"y":20,"behavior":{"list":[{"name":"MOVE_TO_CORDS","x":20,"y":1,"speed":1}]}}]}}')},this.testRemoveFloatObject=()=>{l('{"floatObject":{"list":[{"action":"REMOVE","x":10,"y":15,"id":"testBehavior0"}]}}')},this.testRemoveProgrammer1=()=>{l('{"programmer":{"list":[{"action":"REMOVE","id":1,"name":"WEEK_DAY"}]}}')},this.testRemoveProgrammer2=()=>{l('{"programmer":{"list":[{"action":"REMOVE","id":2,"name":"NORMAL_DAY"}]}}')},this.testRemoveProgrammer3=()=>{l('{"programmer":{"list":[{"action":"REMOVE","id":3,"name":"NORMAL_DAY"}]}}')},this.testRemoveProgrammer4=()=>{l('{"programmer":{"list":[{"action":"REMOVE","id":4,"name":"LOOPPER"}]}}')},this.testOnRespawnNpc=()=>{l('{"mapEvents":{"list":[{"action":"CREATE","name":"ON_RESPAWN_NPC","id":123,"npcId":48189,"external_properties":{"yellowMessage":{"list":[{"action":"CREATE","text":"ZAJEC HARE"}]}}}]}}')},this.testOnOverwriteDayNightCycle=()=>{l('{"overrideDayNightCycle":{"alphaFactor":0.8}}')},this.testRemoveOverwriteDayNightCycle=()=>{l('{"overrideDayNightCycle":{"clear":true}}')},this.testDzik=()=>{l('{"emoActions":{"list":[{"action":"CREATE","name":"e3","target":{"id":150951,"kind":"NPC"}}]},"emoDefinitions":{"list":[{"name":"e3","params":{"action":"OnSelf","filename":"ico-boss.gif"},"priority":90}]}}')},this.testCharacterEffectGetCharacterData=()=>{l('{"characterEffect":{"list":[{"action":"CREATE","id":1212121,"windowTarget":"MAP","effect":"ANIMATION","target":{"kind":"HERO"},"params":{"gifUrl":{"getCharacterData":{"kind":"FLOAT_OBJECT","id":"moveNoiseTest1","toGet":"img"}},"repeat":true,"position":"CENTER"}}]}}')},this.init=function(){o(),h()},this.parseJSON=l,this.checkRajKeyExist=t=>{for(let e in a)if(a[e]==t)return!0;return!1},this.parseObject=c,this.addSrajClass=(t,i)=>{e[t]||(e[t]={}),e[t][i]=!0},this.getAllSrajClass=()=>e}},function(t,e,i){const n=i(484),a=i(485),s=i(486),r=i(126),o=i(22),l=i(79),c=i(127);t.exports=function(){const t="RajFullJSONReplacer.js";let e=null,i=null,d=null,h=null;const u=(n,a)=>{switch(n){case"getTpl":return e.getReplaceDataGetTplFullReplaceJson(a);case l.GET_RANDOM_KEY:i.getRandomFullReplaceJson(a);break;case c.GET_FUNC_KEY:d.getFuncFullReplaceJson(a);break;case"getFor":h.getForFullReplaceJson(a);break;default:errorReport(t,"parseRajJSON","undefined type",n)}};this.init=()=>{e=new r,e.init(),i=new n,i.init(),d=new a,d.init(),h=new s,h.init()},this.getRajDataAfterAllReplace=t=>(t[o.TEMPLATE]&&(t=u("getTpl",t)),u("getFor",t),u(l.GET_RANDOM_KEY,t),u(c.GET_FUNC_KEY,t),t)}},function(t,e,i){const n=i(79);t.exports=function(){const t="RajRandom.js",e=t=>{for(let n in t){let a=t[n];if(elementIsObject(a))a.getRandom?t[n]=i(a.getRandom):e(t[n]);else if(elementIsArray(t[n])){let i=t[n];for(let t in i)e(i[t])}else;}isset(t.getRandom)},i=t=>{if(!s(t))return 0;const e=n.resultType;switch(t.resultType){case e.INT:case e.FLOAT:return r(t);case e.OPTION:return a(t)}return null},a=t=>{let e=t.options,i=e.length-1;return e[Math.round(Math.random()*i)]},s=e=>{const i="checkCorrectDataGetRandomNumber",a=n.resultType,s=a.INT,r=a.FLOAT,o=a.OPTION;if(!isset(e.resultType))return errorReport(t,i,"Attr resultType is obligatory!",e),!1;if(![s,r,o].includes(e.resultType))return errorReport(t,i,"Available val of resultType attr : int, float or option!",e),!1;if(e.resultType==s||e.resultType==r)return isset(e.start)?isNumberFunc(e.start)?isset(e.end)||isset(e.variation)?isset(e.end)&&!isNumberFunc(e.end)?(errorReport(t,i,"Attr end have to number val!",e),!1):!(isset(e.variation)&&!isNumberFunc(e.variation))||(errorReport(t,i,"Attr variation have to number val!",e),!1):(errorReport(t,i,"Attr end or variation is obligatory!",e),!1):(errorReport(t,i,"Attr start have to number val!",e),!1):(errorReport(t,i,"Attr start is obligatory!",e),!1);if(e.resultType==o){if(!isset(e.options))return errorReport(t,i,"Attr options is obligatory!",e),!1;if(!elementIsArray(e.options))return errorReport(t,i,"Attr options have to be array!",e),!1}return!0},r=t=>{let e=t.start,i=null;if(isset(t.end)){let n=Math.abs(e-t.end);i=e+Math.random()*n}if(isset(t.variation)){i=e+(Math.round(Math.random())?1:-1)*Math.random()*t.variation}const a=n.resultType;switch(t.resultType){case a.INT:return Math.round(i);case a.FLOAT:return i}};this.init=()=>{},this.getRandomFullReplaceJson=t=>{e(t)}}},function(t,e,i){const n=i(127);t.exports=function(){const t="RajFunc.js",e=t=>{for(let a in t){let s=t[a];if(a!=n.GET_FUNC_KEY)if(elementIsObject(s))s.getFunc?i(s,s.getFunc):e(t[a]);else if(elementIsArray(t[a])){let i=t[a];for(let t in i)e(i[t])}else;else i(t,s)}isset(t.getFunc)},i=(t,e)=>{if(isset(e.x),!a(e))return null;let i=s(e);delete t.getFunc;for(let e in i)t[e]=i[e]},a=e=>{let i="checkCorrectDataGetRandomNumber";if(!isset(e.resultType))return errorReport(t,i,"Attr resultType is obligatory!",e),!1;const a=n.resultType,s=n.kind.LINEAR;if(![a.INT,a.FLOAT].includes(e.resultType))return errorReport(t,i," Available val of resultType attr : int or float!",e),!1;if(!isset(e.inputX))return errorReport(t,i,"Attr inputX is obligatory!",e),!1;if(!isNumberFunc(e.inputX))return errorReport(t,i,"Attr inputX have to number!",e),!1;if(!isset(e.kind))return errorReport(t,i,"Attr kind is obligatory!",e),!1;if(e.kind!=s)return errorReport(t,i,"Only kind linear is supported!",e),!1;if(!isset(e.pattern))return errorReport(t,i,"Attr pattern is obligatory!",e),!1;if(isset(e.vector)){if(!elementIsArray(e.vector))return errorReport(t,i,"Attr vector have to be array e.g [0,0]!",e),!1;if(!isNumberFunc(e.vector[0])||!isNumberFunc(e.vector[1]))return errorReport(t,i,"Attr vector[0] and vector[0] have to be array number!",e),!1}if(e.kind==s){if(!isset(e.pattern.a))return errorReport(t,i,"Attr pattern.a is obligatory!",e),!1;if(isset(e.pattern.b)&&!isNumberFunc(e.pattern.b))return errorReport(t,i,"Attr pattern.b have to number!",e),!1;if(!isNumberFunc(e.pattern.a))return errorReport(t,i,"Attr pattern.a have to number!",e),!1}return!0},s=t=>{let e={},i=n.defaultData.outputXVarName,a=n.defaultData.outputYVarName,s=[0,0],o=0,l=t.pattern,c=t.inputX;return isset(t.outputXVarName)&&(i=t.outputXVarName),isset(t.outputYVarName)&&(a=t.outputYVarName),isset(t.pattern.b)&&(o=t.pattern.b),isset(t.vector)&&(s[0]=t.vector[0],s[1]=t.vector[1]),e[i]=t.inputX+s[0],e[a]=r(c,l.a,o,s,t.resultType),e},r=(t,e,i,a,s)=>{let r=e*t+i;r+=a[1];const o=n.resultType;switch(s){case o.INT:return Math.round(r);case o.FLOAT:return r}};this.init=()=>{},this.getFuncFullReplaceJson=t=>{e(t)}}},function(module,exports){module.exports=function(){const moduleData={fileName:"RajFullJSONReplacer.js"},init=()=>{},getForFullReplaceJson=t=>{getForParseJson(t)},getForParseJson=(t,e)=>{for(let i in t){let n=t[i];if(elementIsObject(n))n.getFor?errorReport(moduleData.fileName,"getForParseJson","BUUUUUUUUUUUG!"):getForParseJson(t[i],e);else if(elementIsArray(t[i])){let n=t[i];for(let t=0;t<n.length;t++){let i=n[t];if(i.getFor){let a=getFor(i.getFor,e);n.splice(t,1),connectArray(n,a,t),t--,t+=a.length}else getForParseJson(i,e)}}else;}isset(t.getFor)},connectArray=(t,e,i)=>{for(let n=0;n<e.length;n++)t.splice(i+n,0,e[n])},breakDeepArray=t=>{let e=[];for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<n.length;t++){let i=n[t];e.push(i)}}return e},preParseForVars=(t,e,i,n,a)=>{getForVarParseJson(t,e,i,n,a),parseGetMath(t)},parseGetMath=t=>{if(!t)return null;for(let e in t){let i=t[e];if(elementIsObject(i))i.getMath?t[e]=getMath(i.getMath):parseGetMath(t);else if(elementIsArray(t[e])){let i=t[e];for(let t in i)parseGetMath(i[t])}}},getMath=data=>{let mathEval="",list=data.list,resultType=data.resultType;for(let t=0;t<list.length;t++){let e=list[t],i=isset(e.v),n=isset(e.a),a;if(i&&n)return errorReport(moduleData.fileName,"getMath","getMath can use v or a!",data),null;if(isset(e.v)&&(a=parseNumber(e.v)),isset(e.a)&&(a=parseAction(e.a)),null==a)return data;mathEval+=a}let value=eval(mathEval);switch(resultType){case"int":return Math.round(value);case"float":return value;default:return errorReport(moduleData.fileName,"getMath","icorrect resultType",data),data}},parseNumber=t=>isNumberFunc(t)?t:(errorReport(moduleData.fileName,"parseNumber","It is not number!",t),null),parseAction=t=>{switch(t){case"*":return"*";case"+":return"+";case"-":return"-";case"/":return"/";case"(":return"(";case")":return")";default:return errorReport(moduleData.fileName,"parseAction","unresigned action",t),null}},getFor=(t,e)=>{if(!checkCorrectDataGetRandom(t))return null;let i=[],n=t.forVars,a=t.idPrefix,s=null;s=n?n.length:t.iterations,n||(n=[]),e||(e={list:[]});for(let e=0;e<s;e++){let s=copyStructure(t.data);n[e]||(n[e]={}),s.id=a+e,n[e].index=e,i.push(s)}let r=e.list.length;e.list.push({forVars:n,actualForIndex:0});let o=0;for(let t in n)preParseForVars(n[t],{},o,r,e),o++;let l=t.data.getFor;for(let t=0;t<i.length;t++){let a=i[t],s=n[t].index;if(e.list[r].actualForIndex=s,l){let n=getFor(a.getFor,e);for(let e=0;e<n.length;e++)n[e].id=i[t].id+n[e].id;i[t]=n}else getForVarParseJson(a,n,s,r,e)}return l&&(i=breakDeepArray(i)),e.list.pop(),i},getForVarParseJson=(t,e,i,n,a)=>{for(let s in t){let r=t[s];if(elementIsObject(r))r.getForVar?t[s]=getForVar(r,e,i,n,a):(getForParseJson(t[s],a),getForVarParseJson(t[s],e,i,n,a));else if(elementIsArray(t[s])){let r=t[s];for(let t in r)r[t].getFor&&(r[t]=getFor(r[t].getFor,a)),getForVarParseJson(r[t],e,i,n,a)}else;}isset(t.getForVar)},getForVar=(t,e,i,n,a)=>{let s=t.getForVar;if(isset(t.parent)){let e=t.parent,i=a.list[e],n=isset(t.specificIndex)?t.specificIndex:i.actualForIndex;return i.forVars[n][s]}return e[i][s]},checkCorrectDataGetRandom=t=>!0;this.init=init,this.getForFullReplaceJson=getForFullReplaceJson}},function(t,e,i){var n=i(488);let a=i(3),s=i(4);i(6);t.exports=function(){let t,e,i="SequenceManager.js";this.getSequenceList=()=>t;const r=()=>{const t=a.TYPE;e=new s,e.init(i,{createFunc:l,removeFunc:u,checkExistFunc:h,createRequire:{behavior:{type:t.OBJECT,elementInObject:{repeat:{type:t.INT_OR_BOOL,optional:!0},list:{type:t.ARRAY,elementInArray:{delayBefore:{type:t.NUMBER,optional:!0},duration:{type:t.NUMBER,optional:!0},external_properties:{type:t.OBJECT}}}}}}},a.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},o=(t,i)=>{e.updateData(t,i)},l=(t,e)=>{c(t,e)},c=(t,e)=>{let i=new n,a=t.id;i.init(),i.updateData(t,e),d(i,a)},d=(e,i)=>{t[i]=e},h=e=>!!t[e],u=(t,e)=>{p(t.id)},p=e=>{delete t[e]};this.init=()=>{t={},r()},this.updateData=(t,i)=>{if(!e.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n){let e=n[t];o(e,i)}},this.update=e=>{for(let i in t)t[i].update(e)},this.onClear=()=>{(()=>{for(let e in t)delete t[e]})()},this.rajRemoveActionBeyondManager=(t,e)=>{u({action:a.ACTION.REMOVE,id:t},e)}}},function(t,e,i){let n=i(489),a=i(490),s=i(128);t.exports=function(){let t,e,i,r,o,l="RajSequence.js",c=null;const d=()=>{S(0),h()},h=()=>{e=[]},u=t=>{e.push(t)},p=()=>!!e[t]||(errorReport(l,"checkActualBehaviourExist",`behaviour index ${t} not exist!`,e),!1),g=e=>{if(b())return T(),C()?void w():(S(0),m(),v(),E(),_(),void f(e));t++;let i=y();i&&i.setActualLifeTime(e),f(e)},f=t=>{let e=y().getSrajCase();null!=e&&(Engine.rajCase.checkFullFillCase(e)||g(t))},m=()=>{for(let t in e)e[t].setActualLifeTime(0)},v=()=>{for(let t in e)e[t].setActualRepeat(s.defaultData.REPEAT)},E=()=>{for(let t in e)e[t].setActualDelayBefore(s.defaultData.DELAY_BEFORE)},_=()=>{for(let t in e)e[t].setSrayWasCall(!1)},b=()=>e.length==t+1,w=()=>{Engine.rajSequenceManager.rajRemoveActionBeyondManager(i,c)},C=()=>!0!==r&&o>r,T=()=>{A(o+1)},y=()=>e[t],I=t=>{r=t},A=t=>{o=t},k=t=>{i=t},S=e=>{t=e};this.init=()=>{d(),I(a.defaultData.REPEAT),A(a.defaultData.REPEAT)},this.remove=w,this.update=e=>{let i,n=!1;for(;i!=t;){if(i=t,!p())return;if(n&&(e=0),y().update(e),n=!0,null==t)return}},this.updateData=(t,e)=>{k(t.id),t.behavior.repeat&&I(t.repeat);let i=t.behavior.list;(t=>{c=t})(e);for(let t in i){let e=new n(this);u(e),e.init(),e.updateData(i[t])}f(0)},this.getId=()=>i,this.setNextBehaviour=g,this.getAdditionalData=()=>c}},function(t,e,i){i(6);let n=i(128);t.exports=function(t){let e=null,i=null,a=null,s=null,r=null,o=null,l=null,c=null,d=null,h=null;this.alwaysDraw=!0;const u=()=>o>s,p=()=>l>c,g=()=>{C(e+1);let t=l-c;if(!(!0!==i&&e>i))return v(t),b(n.defaultData.DELAY_BEFORE),void y(!1);f(t)},f=e=>{t.setNextBehaviour(e)},m=t=>{d=t},v=t=>{l=t},E=t=>{c=t},_=t=>{s=t},b=t=>{o=t},w=t=>{i=t},C=t=>{e=t},T=t=>{r=t},y=t=>{h=t},I=t=>{a=t};this.init=()=>{C(n.defaultData.REPEAT),w(n.defaultData.REPEAT),I(n.defaultData.DURATION),v(0),_(n.defaultData.DELAY_BEFORE),b(n.defaultData.DELAY_BEFORE),y(!1)},this.update=e=>{(0==s||((t=>{b(o+t)})(e),u()))&&(h||(Engine.rajController.parseObject(d,[],t.getAdditionalData()),y(!0)),(t=>{v(l+t)})(e),p()&&g())},this.updateData=t=>{isset(t.repeat)&&w(t.repeat),isset(t.duration)&&I(t.duration),isset(t.delayBefore)&&_(t.delayBefore),isset(t.case)&&T(t.case),E(a),m(t.external_properties)},this.setActualLifeTime=v,this.setActualRepeat=C,this.setActualDelayBefore=b,this.setSrayWasCall=y,this.getSrajCase=()=>r}},function(t,e){t.exports={defaultData:{REPEAT:1}}},function(t,e){t.exports=function(){let t,e="RajRandomCaller.js";this.init=()=>{t={}},this.updateData=t=>{let i=t.options;if(!isset(i))return void errorReport(e,"updateData","Attr options is obligatory!",t);if(!elementIsArray(i))return void errorReport(e,"updateData","Attr options have to be array!",t);let n=getRandomElementFromArray(i);Engine.rajController.parseObject(n,[],{rajRandomCaller:null})},this.onClear=()=>{}}},function(t,e,i){i(493);const n=i(6),a=i(4),s=i(3),r=i(49);t.exports=function(){const t="RajAreaTriggerManager.js";let e;const i=()=>{const i=s.TYPE,n=r.kind;e=new a,e.init(t,{createFunc:l,removeFunc:c,checkExistFunc:getEngine().mapAreaCordTriggerManager.checkMapAreaTriggerById,createRequire:{x:{type:i.INT_OR_GET_CHARACTER_DATA},y:{type:i.INT_OR_GET_CHARACTER_DATA},kind:{specificVal:[n.ON_IN,n.ON_OUT],optional:!0},cols:{type:i.INT,optional:!0},rows:{type:i.INT,optional:!0},exceptionCords:{type:i.ARRAY,optional:!0},repeat:{type:i.INT_OR_BOOL,optional:!0},actionOnEachCord:{type:i.BOOL,optional:!0},external_properties:{type:i.OBJECT,optional:!0}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},o=(t,i)=>{e.updateData(t,i)},l=(t,e)=>{t.x=n.getCharacterData(t.x,e),t.y=n.getCharacterData(t.y,e),t.mapAreaTriggerCallback=function(){Engine.rajController.parseObject(t.external_properties,!1,e)},Engine.mapAreaCordTriggerManager.updateData(t)},c=t=>{let e=t.id;Engine.mapAreaCordTriggerManager.removeMapAreaTriggerById(e)};this.init=()=>{i()},this.updateData=(t,i)=>{if(!e.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n){let e=n[t];o(e,i)}},this.onClear=()=>{}}},function(t,e){t.exports={action:{CREATE:"CREATE",REMOVE:"REMOVE"}}},function(t,e,i){const n=i(495),a=(i(129),i(6)),s=i(3),r=i(4);t.exports=function(){const t="RajSoundManager.js";let e,i;const o=()=>{const e=s.TYPE;i=new r,i.init(t,{createFunc:c,removeFunc:h,updateFunc:d,checkExistFunc:g,createRequire:{repeat:{type:e.INT_OR_BOOL,optional:!0},url:{},source:{type:e.OBJECT,optional:!0,elementInObject:{x:{type:e.INT_OR_GET_CHARACTER_DATA},y:{type:e.INT_OR_GET_CHARACTER_DATA},range:{type:e.NUMBER}}}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},l=(t,e)=>{i.updateData(t,e)},c=(t,e)=>{let i=new n,s=t.id;f(s,i),isset(t.source)&&(t.source.x=a.getCharacterData(t.source.x,e),t.source.y=a.getCharacterData(t.source.y,e)),i.init(),i.updateData(t)},d=(t,e)=>{let i=t.id;p(i).updateData(t)},h=(t,e)=>{let i=t.id;Engine.soundManager.checkSrajSoundIsPlaying(i)&&(Engine.soundManager.finishPlayingSrajSound(i),u(i))},u=t=>{m(t)},p=t=>e[t],g=t=>!!p(t),f=(t,i)=>{e[t]=i},m=t=>{delete e[t]},v=()=>{e={}};this.init=()=>{v(),o()},this.update=t=>{for(let i in e)e[i].update(t)},this.removeRajSound=u,this.updateData=(t,e)=>{if(!i.checkCorrectMainData(t,e))return;let n=t.list;for(let t in n){let i=n[t];l(i,e)}},this.onClear=()=>{(()=>{for(let t in e){let i=e[t].getId();Engine.soundManager.checkSrajSoundIsPlaying(i)&&Engine.soundManager.finishPlayingSrajSound(i)}})(),v()}}},function(t,e,i){let n=i(129);t.exports=function(){let t=null,e=null,i=null,a=null,s=null,r=null,o=null,l=null,c=!1,d=!1,h=null,u=null,p=null;const g=()=>l>r,f=()=>o>s,m=()=>{if(T(),!C())return L(n.defaultData.DELAY_BEFORE),D(n.defaultData.DELAY_AFTER),P(!1),void B(!1);E()},v=()=>{Engine.soundManager.createSrajSound(e,this)},E=()=>{Engine.rajSoundManager.removeRajSound(t)},_=t=>p=t,b=(t,e)=>Math.sqrt(Math.pow(h.x-t,2)+Math.pow(h.y-e,2)),w=()=>b(h.x+h.range+1,h.y),C=()=>!0!==a&&i>a,T=()=>{N(i+1)},y=t=>{L(o+t)},I=t=>{D(l+t)},A=t=>{e=t},k=e=>{t=e},S=t=>{h=t},O=t=>{u=t},M=t=>{a=t},N=t=>{i=t},R=t=>{s=t},x=t=>{r=t},L=t=>{o=t},D=t=>{l=t},P=t=>{c=t},B=t=>{d=t};this.init=()=>{M(n.defaultData.REPEAT),N(n.defaultData.REPEAT),R(n.defaultData.DELAY_BEFORE),L(n.defaultData.DELAY_BEFORE),x(n.defaultData.DELAY_AFTER),D(n.defaultData.DELAY_AFTER)},this.checkSource=()=>!!h,this.getVolumeForSourceSound=(t,e)=>{let i=b(t,e);return i>u?0:Math.abs(Math.round(i/u*100)-100)},this.getSpecificVolume=()=>p,this.finishSound=()=>{B(!0)},this.getId=()=>t,this.update=t=>{(c||0==s||(y(t),f()))&&(c||(P(!0),v()),d&&(0==r||(I(t),g()))&&m())},this.updateData=t=>{isset(t.url)&&(A(t.url),Engine.soundManager.prepareSrajSound(e)),isset(t.id)&&k(t.id),isset(t.repeat)&&M(t.repeat),isset(t.delayBefore)&&R(t.delayBefore),isset(t.delayAfter)&&x(t.delayAfter),isset(t.volume)&&_(t.volume),isset(t.source)&&(S(t.source),O(w()))}}},function(t,e,i){let n=i(4),a=i(3);t.exports=function(){let t="RajMapMusicManager.js",e=null,i=null,s=null;const r=()=>{const e=a.TYPE;s=new n,s.init(t,{createFunc:d,removeFunc:h,checkExistFunc:f,createRequire:{file:{}},mainDataRequire:{play:{type:e.OBJECT,optional:!0,elementInObject:{id:{}}}}},a.GROUP_NAME.OBJECT_WITH_OPTIONAL_LIST_ACTION_ID)},o=t=>{for(let e in t)c(t[e]);Engine.soundManager.refreshGroupObj()},l=t=>{E(t.id),Engine.soundManager.setMusic(!0)},c=t=>{s.updateData(t)},d=t=>{u(t)},h=t=>{let e=t.id;p(e)},u=t=>{let e=t.id,i={id:e,musicId:"SRAJ_"+e,file:t.file,group:999};m(e,i),Engine.soundManager.addSrajMapMusic(i.musicId,i.file,i.group)},p=t=>{let e=g(t);v(t),Engine.soundManager.removeSrajMapMusic(e.musicId)},g=t=>e[t],f=t=>!!e[t],m=(t,i)=>{e[t]=i},v=t=>{delete e[t]},E=t=>{i=t};this.init=()=>{e={},r()},this.updateData=(t,e)=>{s.checkCorrectMainData(t,e)&&(t.list&&o(t.list),t.play&&l(t.play))},this.getLastPlayId=()=>i,this.getMusicIdByMapMusicId=i=>{let n=g(i);return n?n.musicId:(errorReport(t,"getMusicIdByMapMusicId",`Map music ${i} not exist!`,e),null)},this.onClear=()=>{let t=lengthObject(e);for(let t in e)p(t);t&&Engine.soundManager.refreshGroupObj(),E(null)}}},function(t,e,i){let n=i(1);var a=i(13);let s=i(60),r=i(3),o=i(4);t.exports=function(){let t="RajEmoActions.js",e=null;const i=r.ACTION.CREATE,l=r.ACTION.REMOVE;let c;const d=()=>{e=new o;const i=r.TYPE;e.init(t,{createFunc:u,removeFunc:p,createRequire:{target:{type:{name:i.TARGET,option:[r.TARGET_KIND.THIS_NPC_INSTANCE,n.NPC]}}}},r.GROUP_NAME.OBJECT_WITH_LIST_ACTION_NAME)},h=()=>{c={}},u=(t,e)=>{let n=t.name,s=t.target.id,r=a.OBJECT_TYPE.NPC;m(s)||f(s),v(s,n,i)||E(s,n,i),v(s,n,l)&&_(s,n,l),Engine.emotions.updateData([{name:n,source_id:s,source_type:r}]),g(s,n)},p=(t,e)=>{let n=t.name,s=t.target.id;a.OBJECT_TYPE.NPC;m(s)||f(s),v(s,n,i)&&_(s,n,i),v(s,n,l)||E(s,n,l),Engine.emotions.deleteAllSourceEmo(s,n),g(s,n)},g=t=>{let e=getEngine().npcs.getById(t);e&&e.createTipFromNpcData()},f=t=>{c[t]={[i]:{},[l]:{}}},m=t=>!!c[t],v=(t,e,i)=>c[t][i][e],E=(t,e,i)=>{c[t][i][e]=!0},_=(t,e,i)=>delete c[t][i][e];this.init=()=>{h(),d()},this.updateData=(t,i)=>{if(!e.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n){let a=n[t];e.updateData(a,i)}},this.checkOneNpcActionsList=m,this.getShowNotify=(t,e)=>!!(t=>0==lengthObject(c[t][i])&&lengthObject(0==c[t][l]))(t)||(!!v(t,e,i)||!v(t,e,l)),this.deleteOneNpcActionsList=t=>{m(t)&&delete c[t]},this.onClear=()=>{h()},this.getRajEmoDefinitionsActionsFileNamesArrayToAddToTip=t=>{let e=c[t][i],n=[];for(let t in e){if(s.BITS[t])continue;if(a.NAME.NORMAL_QUEST==t)continue;if(a.NAME.DAILY_QUEST==t)continue;let e=getEngine().rajEmoDefinitions.getFilename(t);n.push(e)}return n},this.getClToAddToTip=t=>{let e=c[t][i],n=[];for(let t in e)s.BITS[t]&&a.NAME.NORMAL_QUEST==t&&a.NAME.DAILY_QUEST==t&&n.push(t);return n}}},function(t,e,i){let n=i(499),a=i(80),s=i(4),r=i(3);t.exports=function(){let t,e=null,i="ScreenEffectsManager.js";const o=()=>{const t=r.TYPE,n=a.mode;e=new s,e.init(i,{createFunc:c,removeFunc:d,checkExistFunc:v,createRequire:{order:{type:t.INT,optional:!0},repeat:{type:t.INT_OR_BOOL,optional:!0},behavior:{type:t.OBJECT,elementInObject:{list:{type:t.ARRAY,elementInArray:{mode:{conditionVal:{[n.TRANSITION]:{color0:{type:t.RGBA_COLOR,optional:!0},color1:{type:t.RGBA_COLOR,optional:!0},holes:{type:t.ARRAY,optional:!0,elementInArray:{hole0:{type:t.OBJECT,elementInObject:{x:{type:t.NUMBER},y:{type:t.NUMBER},r:{type:t.NUMBER}}},hole01:{type:t.OBJECT,elementInObject:{x:{type:t.NUMBER},y:{type:t.NUMBER},r:{type:t.NUMBER}}}}}},[n.STATIC]:{data:{type:t.OBJECT,elementIsObject:{duration:{type:t.NUMBER},color:{type:t.RGBA_COLOR}}}}}}}}}}}},r.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},l=t=>{e.updateData(t)},c=t=>{h(t)},d=t=>{u(t.id)},h=t=>{let e=new n,i=t.id;e.init(),e.updateData(t),f(e,i)},u=t=>{m(t)},p=()=>{g()},g=()=>{t={}},f=(e,i)=>{t[i]=e},m=e=>{delete t[e]},v=e=>!!t[e],E=()=>{let e=Engine.interface.get$gameLayer(),i=e.width(),n=e.height();if(0!=i||0!=n)for(let e in t)t[e].resize(i,n)};this.init=()=>{p(),o()},this.onClear=p,this.getDrawableList=()=>{if(!lengthObject(t))return[];let e=[];for(let i in t){let n=t[i].getBehaviourToRenderEffect();n&&e.push(n)}return e},this.update=e=>{for(let i in t)t[i].update(e)},this.updateData=(t,i)=>{if(!e.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n)l(n[t])},this.removeScreenEffect=u,this.resize=()=>{E()}}},function(t,e,i){var n=i(500);let a=i(31),s=i(80),r=i(21);t.exports=function(){let t,e,i,o,l,c,d,h,u="ScreenEffect.js";const p=()=>{let t=Engine.interface.get$gameLayer(),e=t.width(),i=t.height();if(d=h.createCanvasData(),0==e&&0==i)return;let n=d.canvas;n.width=e,n.height=i},g=()=>{O(0),f()},f=()=>{e=[]},m=t=>{e.push(t)},v=()=>!!e[t]||(errorReport(u,"checkActualBehaviourExist",`behaviour index ${t} not exist!`,e),!1),E=()=>{for(let t in e)e[t].setActualLifeTime(0)},_=()=>{for(let t in e)e[t].setActualRepeat(1)},b=()=>e.length==t+1,w=()=>{Engine.screenEffectsManager.removeScreenEffect(i)},C=()=>!0!==l&&c>l,T=()=>{A(c+1)},y=()=>e[t],I=t=>{l=t},A=t=>{c=t},k=t=>{o=t},S=t=>{i=t},O=e=>{t=e};this.init=()=>{h=new a,p(),g(),k(s.defaultData.ORDER),I(s.defaultData.SCREEN_EFFECT_REPEAT),A(s.defaultData.SCREEN_EFFECT_REPEAT)},this.getOrder=()=>o,this.remove=w,this.getBehaviourToRenderEffect=()=>null==t?null:v()?y():null,this.update=e=>{let i,n=!1;for(;i!=t;){if(i=t,!v())return;if(n&&(e=0),y().update(e),n=!0,null==t)return}},this.updateData=t=>{S(t.id),t.order&&k(t.order),t.behavior.repeat&&I(t.repeat);let e=t.behavior.list;for(let t in e){let i=new n(this),a=e[t];if(a.data){let t=a.data,e=t.holes;t.color&&r.manageRandomElementInObjectIfExist(t.color),t.color0&&r.manageRandomElementInObjectIfExist(t.color0),t.color1&&r.manageRandomElementInObjectIfExist(t.color1),e&&(e.hole0&&r.manageRandomElementInObjectIfExist(e.hole0),e.hole1&&r.manageRandomElementInObjectIfExist(e.hole1))}m(i),i.init(),i.updateData(a)}},this.getId=()=>i,this.setNextBehaviour=e=>{if(b())return T(),C()?void w():(O(0),E(),void _());t++;let i=y();i&&i.setActualLifeTime(e)},this.resize=(t,e)=>{d.canvas.width=t,d.canvas.height=e},this.getHelpCanvas=()=>d.canvas,this.getHelpCtx=()=>d.ctx,this.getFramesWithHoles=()=>h}},function(t,e,i){let n=i(6),a=i(80);t.exports=function(t){let e=null,i=null,s=null,r=null,o=null,l=null,c="ScreenBehaviour.js";this.alwaysDraw=!0;let d={r:null,g:null,b:null,a:null},h={r:null,g:null,b:null,a:null},u=[],p={r:null,g:null,b:null,a:null},g=[];const f=t=>{switch(s){case a.mode.TRANSITION:v(t);break;case a.mode.STATIC:m(t);break;default:errorReport(c,"updateDataByMode","undefined mode "+s,t)}},m=t=>{T(t.data.color),C(t.data.holes)},v=t=>{(t=>{let e=t.data.color0,i=t.data.color1,n=d,a=h;n.r=e.r,n.g=e.g,n.b=e.b,n.a=e.a,a.r=i.r,a.g=i.g,a.b=i.b,a.a=i.a})(t),E(t.data.holes)},E=t=>{for(let e in t)u.push(t[e])},_=()=>{w(),b()},b=()=>{let t=o/l;g=[];for(let e in u){let i=u[e],n=i.hole0,a=i.hole1,s=GET_HARD_COPY_STRUCTURE(n);s.x=y(t,n.x,a.x),s.y=y(t,n.y,a.y),s.r=y(t,n.r,a.r),g.push(s)}},w=()=>{let t=o/l,e=d,i=h;L(y(t,e.r,i.r)),D(y(t,e.g,i.g)),P(y(t,e.b,i.b)),B(y(t,e.a,i.a))},C=t=>{for(let e in t)g.push(t[e])},T=t=>{L(t.r),D(t.g),P(t.b),B(t.a)},y=(t,e,i)=>{if(e==i)return e;let n,a=Math.abs(e-i)*t;return n=e<i?e+a:e-a,n},I=()=>o>l,A=()=>{R(e+1);let t=o-l;!0!==i&&e>i?k(t):S(t)},k=e=>{t.setNextBehaviour(e)},S=t=>{o=t},O=t=>{l=t},M=t=>{s=t},N=t=>{i=t},R=t=>{e=t},x=t=>{r=t},L=t=>{p.r=t},D=t=>{p.g=t},P=t=>{p.b=t},B=t=>{p.a=t};this.init=()=>{R(a.defaultData.BEHAVIOR_REPEAT),N(a.defaultData.BEHAVIOR_REPEAT),x(a.defaultData.BEHAVIOR_DURATION),S(0)},this.draw=e=>{let i=t.getHelpCanvas(),a=t.getHelpCtx(),s=i.width,r=i.height;if(a.save(),a.clearRect(0,0,s,r),a.fillStyle="rgba("+p.r+","+p.g+","+p.b+","+p.a+")",a.fillRect(0,0,s,r),!g.length)return a.restore(),void e.drawImage(i,0,0);a.globalCompositeOperation="destination-out";let o=Engine.mapShift.getShift();for(let e in g){let i=g[e],s=t.getFramesWithHoles().getOnePoint(i,1,!0)[0];s.x=n.getCharacterData(s.x),s.y=n.getCharacterData(s.y),s.offsetX-=Engine.map.offset[0]-o[0],s.offsetY-=Engine.map.offset[1]-o[1],t.getFramesWithHoles().drawOneHole(s,a)}a.restore(),e.drawImage(i,0,0)},this.update=t=>{(t=>{S(o+t)})(t),I()?A():s==a.mode.TRANSITION&&_()},this.updateData=t=>{t.mode&&M(t.mode),t.repeat&&N(t.repeat),t.duration&&x(t.duration),O(r),f(t)},this.getOrder=()=>1e3+t.getOrder(),this.setActualLifeTime=S,this.setActualRepeat=R}},function(t,e){t.exports=function(){let t="RajEmoDefinitions.js",e={};const i=(t,i,n)=>{a(t)||(e[t]={action:i.action,filename:i.filename,priority:n},i.offset&&(e[t].offset=i.offset))},n=e=>{if(!elementIsObject(e))return errorReport(t,"isDataCorrect",'emoDefinitions have to object!  e.g. {"name":"NPC_SL_SHOP","priority":65,"params":{"action":"OnSelf","filename":"battle.gif"}}',e),!1;if(!isset(e.name))return errorReport(t,"isDataCorrect","emoDefinitions have to have name attr!",e),!1;if(!isset(e.priority))return errorReport(t,"isDataCorrect","emoDefinitions have to have priority attr!",e),!1;if(!isset(e.params))return errorReport(t,"isDataCorrect","emoDefinitions have to have params attr!",e),!1;if(!elementIsObject(e.params))return errorReport(t,"isDataCorrect","params attr have to be object!",e),!1;if(!isset(e.params.action))return errorReport(t,"isDefinitionCorrect","data.params.action not exist in emoDefinition!",e),!1;if(!["OnSelf"].includes(e.params.action))return errorReport(t,"isDefinitionCorrect","data.params.action can be CREATE or REMOVE value only!",e),!1;return isset(e.params.filename)?!!isInt(e.priority)||(errorReport(t,"isDataCorrect","priority attr have to integet!",e),!1):(errorReport(t,"isDefinitionCorrect","data.params.filename not exist in emoDefinition!",e),!1)},a=t=>!!e[t];this.init=()=>{},this.updateData=t=>{let e=t.list;for(let t in e){let a=e[t];if(!n(a))continue;let s=a.name,r=a.params,o=a.priority;i(s,r,o)}},this.getDefinition=t=>a(t)?e[t]:null,this.getPriority=t=>a(t)?e[t].priority:null,this.getFilename=t=>a(t)?e[t].filename:null,this.getArrayOfDefinitionsName=()=>{let t=[];for(let i in e)t.push(i);return t},this.onClear=()=>{e={}}}},function(module,exports,__webpack_require__){let RajDataCase=__webpack_require__(503),RajGetSpecificData=__webpack_require__(6);module.exports=function(){let moduleData={fileName:"RajCase.js"};const init=()=>{},checkKeyQuest=t=>{const e=RajDataCase.QUEST.ATTR,i=t.params;switch(t.name){case e.NEVER_OCCUR:return neverOccurQueststFullFill(i);case e.ACTIVE:return activeQueststFullFill(i);case e.NO_ACTIVE:return noActiveQueststFullFill(i);case e.FINISH:return finishQueststFullFill(i);case e.NOT_FINISH:return notFinishQueststFullFill(i);default:errorReport(moduleData.fileName,"checkKeyQuest","unregistered data.name",t)}return null},checkKeyOutfit=t=>{const e=RajDataCase.OUTFIT.ATTR,i=t.params;switch(t.name){case e.ONE_OF:return oneOfOutfitFullFill(i);default:errorReport(moduleData.fileName,"checkKeyOutfit","unregistered data.name",t)}return null},checkKeyPet=t=>{const e=RajDataCase.PET.ATTR,i=t.params;switch(t.name){case e.ONE_OF:return oneOfPetFullFill(i);default:errorReport(moduleData.fileName,"checkKeyPet","unregistered data.name",t)}return null},checkKeyExistObj=t=>{const e=RajDataCase.EXIST_OBJ.ATTR,i=t.params;switch(t.name){case e.FLOAT_OBJECT:return checkFloatObjExist(i);case e.FAKE_NPC:return checkFakeNpcExist(i);case e.NPC:return checkNpcExist(i);default:errorReport(moduleData.fileName,"checkKeyExistObj","unregistered data.name",t)}return null},checkKeyExistObjHaveOutfit=(t,e)=>{const i=RajDataCase.EXIST_OBJ_HAVE_OUTFIT.ATTR,n=t.params;let a=[];for(let t in n)n[t].id=RajGetSpecificData.getCharacterData(n[t].id,e);for(let t in n)a.push(n[t].id);switch(t.name){case i.FAKE_NPC:return checkFakeNpcExist(a)&&checkFakeNpcHaveOutfit(n);case i.NPC:return checkNpcExist(a)&&checkNpcHaveOutfit(n);default:errorReport(moduleData.fileName,"checkKeyExistObj","unregistered data.name",t)}return null},checkCharacterDir=(t,e)=>{const i=RajDataCase.CHARACTER_DIR.ATTR,n=t.params;switch(t.name){case i.ONE_OF:return oneOfCharacterDirFullFill(n,e);default:errorReport(moduleData.fileName,"checkCharacterDir","unregistered data.name",t)}return null},checkHeroEquipmentItemTpl=(t,e)=>{const i=RajDataCase.HERO_EQUIPMENT_ITEM_TPL.ATTR,n=t.params;switch(t.name){case i.HAVE_ITEM_TPL:return haveItemTplFullFill(n,e);case i.ONE_OF:return oneOfItemTplFullFill(n,e);default:errorReport(moduleData.fileName,"checkHeroEquipmentItemTpl","unregistered data.name",t)}return null},oneOfItemTplFullFill=t=>{for(let e in t){let i=t[e];if(Engine.heroEquipment.getHeroItemTpl(i))return!0}return!1},haveItemTplFullFill=t=>{let e=0;for(let i in t){let n=t[i];Engine.heroEquipment.getHeroItemTpl(n)&&e++}return e==t.length},oneOfCharacterDirFullFill=(t,e)=>{for(let i in t){let n=t[i],a=n.dir,s=RajGetSpecificData.getTargetObject(n,e);if(!s)return!1;if(s.getDir()==a)return!0}return!1},checkFakeNpcHaveOutfit=t=>{let e=0;for(let i in t){let n=getEngine().fakeNpcs.getById(t[i].id).getImg();t[i].img==n&&e++}return t.length==e},checkNpcHaveOutfit=t=>{let e=0;for(let i in t){let n=getEngine().npcs.getById(t[i].id).getImg();t[i].img==n&&e++}return t.length==e},checkFloatObjExist=t=>{let e=0;for(let i=0;i<t.length;i++)getEngine().floatObjectManager.checkObjectExist(t[i])&&e++;return t.length==e},checkFakeNpcExist=t=>{let e=0;for(let i=0;i<t.length;i++)getEngine().fakeNpcs.checkFakeNpcListExist(t[i])&&e++;return t.length==e},checkNpcExist=t=>{let e=0;for(let i=0;i<t.length;i++)getEngine().npcs.checkNpc(t[i])&&e++;return t.length==e},checkKeyTown=t=>{const e=RajDataCase.TOWN.ATTR,i=t.params;switch(t.name){case e.ONE_OF:return oneOfTownFullFill(i);default:errorReport(moduleData.fileName,"checkKeyTown","unregistered data.name",t)}return null},checkFullFillCase=(t,e)=>!isset(t)||(isset(t.list)?getResultFromContainer(t.list,!1,e):checkFullFillCaseOld(t)),checkFullFillCaseOld=t=>{if(!isset(t))return!0;warningReport(moduleData.fileName,"checkFullFillCaseOld","this case is deprecated! use new format with list: []",t);const e=RajDataCase.QUEST.KEY_NAME,i=RajDataCase.TOWN.KEY_NAME,n=RajDataCase.OUTFIT.KEY_NAME,a=RajDataCase.PET.KEY_NAME;if(t[e]){const i=RajDataCase.QUEST.ATTR.NEVER_OCCUR,n=RajDataCase.QUEST.ATTR.ACTIVE,a=RajDataCase.QUEST.ATTR.NO_ACTIVE,s=RajDataCase.QUEST.ATTR.FINISH,r=RajDataCase.QUEST.ATTR.NOT_FINISH;let o=t[e];if(o[i]&&!neverOccurQueststFullFill(o[i]))return!1;if(o[n]&&!activeQueststFullFill(o[n]))return!1;if(o[a]&&!noActiveQueststFullFill(o[a]))return!1;if(o[s]&&!finishQueststFullFill(o[s]))return!1;if(o[r]&&!notFinishQueststFullFill(o[r]))return!1}if(t[n]){const e=RajDataCase.OUTFIT.ATTR.ONE_OF;let i=t[n];if(i[e]&&!oneOfOutfitFullFill(i[e]))return!1}if(t[a]){const e=RajDataCase.PET.ATTR.ONE_OF;let i=t[a];if(i[e]&&!oneOfPetFullFill(i[e]))return!1}if(t[i]){const e=RajDataCase.TOWN.ATTR.ONE_OF;let n=t[i];if(n[e]&&!oneOfTownFullFill(n[e]))return!1}return!0},getResultFromContainer=(t,e,i)=>{let n=[];for(let e=0;e<t.length;e++){let a=t[e];n.push(getMathResult(a,i))}let a=getResultFromOperationArray(n,t);return e?!a:a},getResultFromOperationArray=(operationArray,list)=>{let operationStr=operationArray.join("");devConsoleLog(["rajCase",operationStr,list]);let result=eval(operationStr);return!0===result||!1===result?result:null},getMathResult=(t,e)=>{const i=RajDataCase.kind;switch(t.kind){case i.ARGUMENT:return t.not?!getResultOfArgument(t,e):getResultOfArgument(t,e);case i.CONNECTOR:return getConnector(t);case i.CONTAINER:return getResultFromContainer(t.list,!!t.not&&t.not,e);default:errorReport(moduleData.fileName,"getMathResult","unregistered data.kind",t)}return null},getConnector=t=>{const e=RajDataCase.connector;switch(t.name){case e.AND:return"&&";case e.OR:return"||";default:errorReport(moduleData.fileName,"getConnector","unregistered data.name",t)}return null},getResultOfArgument=(t,e)=>{const i=RajDataCase.QUEST.KEY_NAME2,n=RajDataCase.TOWN.KEY_NAME2,a=RajDataCase.OUTFIT.KEY_NAME2,s=RajDataCase.PET.KEY_NAME2,r=RajDataCase.EXIST_OBJ.KEY_NAME2,o=RajDataCase.EXIST_OBJ_HAVE_OUTFIT.KEY_NAME2,l=RajDataCase.HERO_EQUIPMENT_ITEM_TPL.KEY_NAME,c=RajDataCase.CHARACTER_DIR.KEY_NAME;switch(t.key){case i:return checkKeyQuest(t);case n:return checkKeyTown(t);case a:return checkKeyOutfit(t);case s:return checkKeyPet(t);case r:return checkKeyExistObj(t);case o:return checkKeyExistObjHaveOutfit(t,e);case c:return checkCharacterDir(t,e);case l:return checkHeroEquipmentItemTpl(t,e);default:errorReport(moduleData.fileName,"getResultOfArgument","unregistered data.key",t)}return null},notFinishQueststFullFill=t=>{for(let e in t){let i=t[e];if(Engine.quests.checkFinishQuest(i))return!1}return!0},finishQueststFullFill=t=>{for(let e in t){let i=t[e];if(!Engine.quests.checkFinishQuest(i))return!1}return!0},neverOccurQueststFullFill=t=>{for(let e in t){let i=t[e];if(Engine.quests.getQuestData(i))return!1;if(Engine.quests.checkFinishQuest(i))return!1}return!0},noActiveQueststFullFill=t=>{let e=0;for(let i in t){let n=t[i];Engine.quests.getQuestData(n)?Engine.quests.checkFinishQuest(n)&&e++:e++}return e==t.length},activeQueststFullFill=t=>{let e=0;for(let i in t){let n=t[i];Engine.quests.getQuestData(n)&&e++}return e==t.length},oneOfTownFullFill=t=>{for(let e in t){let i=t[e];if(Engine.map.d.id==i)return!0}return!1},oneOfOutfitFullFill=t=>{for(let e in t){let i=t[e];if(Engine.hero.d.img==i)return!0}return!1},oneOfPetFullFill=t=>{for(let e in t){let i=t[e],n=Engine.hero.getPet();if(n&&n.outfitSrc==i)return!0}return!1};this.init=init,this.checkFullFillCase=checkFullFillCase}},function(t,e){t.exports={HERO_EQUIPMENT_ITEM_TPL:{KEY_NAME:"HERO_EQUIPMENT_ITEM_TPL",ATTR:{HAVE_ITEM_TPL:"HAVE_ITEM_TPL",ONE_OF:"ONE_OF"}},QUEST:{KEY_NAME:"quest",KEY_NAME2:"QUEST",ATTR:{ACTIVE:"ACTIVE",NO_ACTIVE:"NO_ACTIVE",NEVER_OCCUR:"NEVER_OCCUR",FINISH:"FINISH",NOT_FINISH:"NOT_FINISH"}},TOWN:{KEY_NAME:"town",KEY_NAME2:"TOWN",ATTR:{ONE_OF:"ONE_OF"}},OUTFIT:{KEY_NAME:"outfit",KEY_NAME2:"OUTFIT",ATTR:{ONE_OF:"ONE_OF"}},PET:{KEY_NAME:"pet",KEY_NAME2:"PET",ATTR:{ONE_OF:"ONE_OF"}},EXIST_OBJ:{KEY_NAME2:"EXIST_OBJ",ATTR:{FLOAT_OBJECT:"FLOAT_OBJECT",FAKE_NPC:"FAKE_NPC",NPC:"NPC"}},EXIST_OBJ_HAVE_OUTFIT:{KEY_NAME2:"EXIST_OBJ_HAVE_OUTFIT",ATTR:{FAKE_NPC:"FAKE_NPC",NPC:"NPC"}},CHARACTER_DIR:{KEY_NAME:"CHARACTER_DIR",ATTR:{ONE_OF:"ONE_OF"}},kind:{ARGUMENT:"ARGUMENT",CONNECTOR:"CONNECTOR",CONTAINER:"CONTAINER"},connector:{AND:"AND",OR:"OR"}}},function(t,e,i){const n=i(6),a=i(4),s=i(3);t.exports=function(){const t="RajDialogue.js";let e=null,i=null;const r=()=>{i=new a;const e=s.TYPE;i.init(t,{createFunc:o,clearFunc:l,createRequire:{header:{type:e.OBJECT,elementInObject:{text:{}}}}},s.GROUP_NAME.OVERRIDE_OBJECT)},o=t=>{u(),c(t.header)},l=()=>{u(),d()},c=t=>{let e;e=t.text?n.getCharacterData(t.text):null,h(e),d()},d=()=>{Engine&&Engine.dialogue&&Engine.dialogue.manageDialogHeaderText()},h=t=>{e=t},u=()=>{h(null)};this.init=()=>{r()},this.getDialogName=()=>e,this.onClear=u,this.updateData=(t,e)=>{i.checkCorrectMainData(t,e)&&i.updateData(t)}}},function(t,e,i){let n=i(3),a=i(4),s=i(506);t.exports=function(){const t="RajProgrammer.js";let e=null,i=null,r=null,o=null,l=null,c=null,d=null,h=null,u=null,p=null,g=null,f=null;const m=()=>{d=new a;const e=n.TYPE,i=s.WEEK_DAY,r=s.NORMAL_DAY,o=s.SPECIFIC_DAY,l=s.LOOPPER;d.init(t,{createFunc:N,removeFunc:R,checkExistFunc:_,createRequire:{start:{type:e.OBJECT,elementInObject:{time:{specificFunc:et},external_properties:{type:e.OBJECT}}},end:{type:e.OBJECT,elementInObject:{time:{specificFunc:et},external_properties:{type:e.OBJECT,optional:!0}}},name:{conditionVal:{[i]:{weekDay:{specificVal:[0,1,2,3,4,5,6]}},[r]:{},[o]:{specificDay:{specificFunc:tt}},[l]:{duration:{specificFunc:et},delay:{specificFunc:et}}}}},createRequireFunc:t=>it(t)},n.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID_NAME)},v=()=>{e={},i={},r={},o={},h={},u={},p={},g={},f={}},E=(t,e)=>{h[t]=e},_=t=>!!h[t],b=()=>{l=setInterval((function(){I()}),1e4)},w=t=>{c=t},C=()=>Math.round(ts()/1e3),T=()=>getCurrentDate({day:!0,month:!0}),y=()=>getStartWeekDay(c),I=()=>{let t=C(),e=(t=>t-c)(t);for(let t=0;t<e;t++)w(c+1),A();w(t)},A=()=>{let t=ut_time(c,!0),e=T(),i=y();const n=s.END,a=s.START;k(t,n,!1),k(t,a,!0),S(t,n,!1),S(t,a,!0),O(e,n,t,!1),O(e,a,t,!0),M(i,n,t,!1),M(i,a,t,!0)},k=(t,e,i)=>{if(o[e]&&o[e][t]){let n=o[e][t];const a=s.LOOPPER;J(n,i,a),Q(n)}},S=(t,e,i)=>{if(r[e]&&r[e][t]){let n=r[e][t];const a=s.NORMAL_DAY;J(n,i,a),Q(n)}},O=(t,e,n,a)=>{if(i[t]&&i[t][e][n]){let r=i[t][e][n];const o=s.SPECIFIC_DAY;J(r,a,o),Q(r)}},M=(t,i,n,a)=>{if(e[t]&&e[t][i][n]){let r=e[t][i][n];const o=s.WEEK_DAY;devConsoleLog(["callWeekDaysProgrammer",r]),J(r,a,o),Q(r)}},N=(t,e)=>{let i=s.WEEK_DAY,n=s.NORMAL_DAY,a=s.SPECIFIC_DAY,r=s.LOOPPER,o=G();switch(t.name){case i:X(t);let e=y();if(t.weekDay!=e)return;V(t,o,i);break;case n:j(t),V(t,o,n);break;case a:z(t);let s=T();if(t.specificDay!=s)return;V(t,o,a);break;case r:let l=H(t);for(let t=0;t<l.length;t++)q(l[t]);for(let t in l){let e=l[t];V(e,o,r)}}},R=(t,e)=>{let i=t.id;if(!_(i))return;const n=s.WEEK_DAY,a=s.SPECIFIC_DAY,r=s.NORMAL_DAY,o=s.LOOPPER;switch((t=>h[t])(i).name){case n:L(i);break;case a:D(i);break;case r:P(i);break;case o:x(i)}(t=>{delete h[t]})(i)},x=t=>{const e=s.LOOPPER,i=s.END,n=s.START;let a=o[n],r=o[i];if(u[t]){let n,a=Y(u[t].helpId),s=o[i][a.endTime];for(let t=0;t<s.length;t++)if(s[t].id==a.id){n=s[t];break}Z(n,!1,e),Q([n])}B(t,a,r)},L=t=>{const i=s.WEEK_DAY,n=s.END,a=s.START;let r=y();for(let s in e){let o=e[s][a],l=e[s][n];F(t,o,l,r==s,i)}},D=t=>{const e=s.SPECIFIC_DAY,n=s.END,a=s.START;let r=T();for(let s in i){let o=i[s][a],l=i[s][n];F(t,o,l,r==s,e)}},P=t=>{const e=s.NORMAL_DAY,i=s.END,n=s.START;let a=r[n],o=r[i];F(t,a,o,!0,e)},B=(t,e,i)=>{let n,a;for(let i in e){let a=e[i];n=$(t,a,i),n&&deleteElementFromArray(n.i,a)}for(let e in i){let n=i[e];a=$(t,n,e),a&&deleteElementFromArray(a.i,n)}},F=(t,e,i,n,a)=>{let s,r;for(let i in e){let n=e[i];if(s=$(t,n,i),s){deleteElementFromArray(s.i,n);break}}for(let e in i){let n=i[e];if(r=$(t,n,e),r){deleteElementFromArray(r.i,n);break}}n&&s&&r&&W(s,r,a)},W=(t,e,i)=>{let n=t.obj.srajData,a=e.obj.srajData;if(null==n&&null==a)return;let s={start:{time:t.time},end:{time:e.time}},r=G();U(s,r)&&(Z(e.obj,!1,i),Q([e.obj]))},$=(t,e,i)=>{for(let n=0;n<e.length;n++)if(e[n].id==t)return{i:n,obj:e[n],time:i};return null},H=t=>{let e=[],i=t.start.time,n=t.end.time,a=nt(i),s=nt(n),r=t.start.external_properties,o=t.end.external_properties?t.end.external_properties:null,l=t.id,c=t.name;E(l,t);let d=60*new Date(0).getTimezoneOffset(),h=nt(t.duration),u=nt(t.delay),p=a;for(;p<s&&p+h<s;){let t=p+d+h,i={id:l,name:c,start:{startTimeSeconds:p,time:ut_time(p+d,!0),external_properties:r},end:{endTimeSeconds:p+h,time:ut_time(t,!0)}};o&&(i.end.external_properties=o),e.push(i),p+=u}return e},G=()=>{let t=new Date;return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},V=(t,e,i)=>{if(!U(t,e))return;let n=t.id,a={id:n,srajData:t.start.external_properties};t.end.external_properties&&(a.endExist=!0,i==s.LOOPPER&&(a.helpId=K(n,t.end.time))),Z(a,!0,i),Q([a])},U=(t,e)=>{let i,n;return t.start.startTimeSeconds&&t.end.endTimeSeconds?(i=t.start.startTimeSeconds,n=t.end.endTimeSeconds):(i=nt(t.start.time),n=nt(t.end.time)),i<e&&e<n},j=t=>{let e=t.start.time,i=t.end.time,n=t.start.external_properties,a=t.end.external_properties,o=t.id;const l=s.END,c=s.START;E(o,t),checkObjectIsEmpty(r)&&(r={[c]:{},[l]:{}});let d=r[c],h=r[l],u={id:o,srajData:n,endExist:!1};d[e]||(d[e]=[]),d[e].push(u),!a||a&&checkObjectIsEmpty(a)||(u.endExist=!0,h[i]||(h[i]=[]),h[i].push({id:o,srajData:a}))},q=t=>{let e=t.start.time,i=t.end.time,n=t.start.startTimeSeconds,a=t.end.endTimeSeconds,r=t.start.external_properties,l=t.end.external_properties,c=t.id;const d=s.END,h=s.START;checkObjectIsEmpty(o)&&(o={[h]:{},[d]:{}});let u=o[h],p=o[d];u[e]||(u[e]=[]);let g={id:c,srajData:r,startTimeSeconds:n,endExist:!1};u[e].push(g),!l||l&&checkObjectIsEmpty(l)||(g.endExist=K(c,i),g.helpId=K(c,i),p[i]||(p[i]=[]),p[i].push({id:c,helpId:K(c,i),srajData:l,endTimeSeconds:a}))},K=(t,e)=>t+"-"+e,Y=e=>{let i=e.split("-");return 2!=i.length?(errorReport(t,"getDataFromHelpId","BUG"),{id:0,endTime:"00:00:00"}):{id:i[0],endTime:i[1]}},z=t=>{let e=t.start.time,n=t.end.time,a=t.start.external_properties,r=t.end.external_properties,o=t.specificDay,l=t.id;const c=s.END,d=s.START;E(l,t),i[o]||(i[o]={[d]:{},[c]:{}});let h=i[o][d],u=i[o][c],p={id:l,srajData:a,endExist:!1};h[e]||(h[e]=[]),h[e].push(p),!r||r&&checkObjectIsEmpty(r)||(p.endExist=!0,u[n]||(u[n]=[]),u[n].push({id:l,srajData:r}))},X=t=>{let i=t.start.time,n=t.end.time,a=t.start.external_properties,r=t.end.external_properties,o=t.weekDay,l=t.id;const c=s.END,d=s.START;E(l,t),e[o]||(e[o]={[d]:{},[c]:{}});let h=e[o][d],u=e[o][c];h[i]||(h[i]=[]);let p={id:l,srajData:a,endExist:!1};h[i].push(p),!r||r&&checkObjectIsEmpty(r)||(p.endExist=!0,u[n]||(u[n]=[]),u[n].push({id:l,srajData:r}))},Q=e=>{for(let i in e)Engine.rajController.parseObject(e[i].srajData,!1,{module:t})},J=(t,e,i)=>{for(let n=0;n<t.length;n++)Z(t[n],e,i)},Z=(e,i,n)=>{const a=s.LOOPPER,r=s.WEEK_DAY,o=s.SPECIFIC_DAY,l=s.NORMAL_DAY;if(1==i&&!e.endExist)return;const c=e.id,d=isset(e.helpId)?e.helpId:null;let h=null;switch(n){case a:h=u;break;case r:h=f;break;case o:h=g;break;case l:h=p;break;default:return void errorReport(t,"setActiveEventWithEnd",`kind ${n} not eixst!`)}i?h[c]=null==d||{helpId:d}:delete h[c]},tt=e=>{const i="checkCorrectDate";let n=e.split(".");return 2==n.length?!(!isNumberFunc(n[0])||!isNumberFunc(n[1]))||(errorReport(t,i,"Incorrect date format! ONLY numbers PLEASE!!",e),!1):(errorReport(t,i,"Incorrect date format! Need DD.MM !",e),!1)},et=e=>{const i="checkCorrectTime";let n=e.split(":");return 3==n.length?isNumberFunc(n[0])&&isNumberFunc(n[1])&&isNumberFunc(n[2])?!(n[0]>23||n[1]>59||n[2]>59)||(errorReport(t,i,"Crazy time! Correct PLEASE!!",e),!1):(errorReport(t,i,"Incorrect time format! ONLY numbers PLEASE!!",e),!1):(errorReport(t,i,"Incorrect time format! Need HH:MM:SS !",e),!1)},it=e=>{let i=nt(e.start.time);return!(nt(e.end.time)<i)||(errorReport(t,'checkCorrectOneEvent", "oneEvent.end.time must be declared late than oneEvent.start.time !!',e),!1)},nt=t=>{let e=t.split(":");return 3600*parseInt(e[0])+60*parseInt(e[1])+parseInt(e[2])};this.init=()=>{v(),m(),w(C()),b()},this.updateData=(t,e)=>{if(d.checkCorrectMainData(t,e))for(let i=0;i<t.list.length;i++){let n=t.list[i];d.updateData(n,e)}},this.onClear=()=>{v()}}},function(t,e){t.exports={WEEK_DAY:"WEEK_DAY",SPECIFIC_DAY:"SPECIFIC_DAY",NORMAL_DAY:"NORMAL_DAY",LOOPPER:"LOOPPER",START:"START",STOP:"STOP"}},function(t,e,i){let n=i(31),a=i(6),s=i(21),r=i(3),o=i(4),l=i(1);t.exports=function(){let t,e="RajExtraLight.js",i={},c=null;const d=r.ACTION.CREATE,h=r.ACTION.CREATE_FORCE,u=r.ACTION.REMOVE;const p=()=>{const t=r.TYPE;c=new o,c.init(e,{createFunc:w,removeFunc:C,checkExistFunc:A,createRequire:{master:{type:{name:t.TARGET,option:[r.TARGET_KIND.THIS_NPC_INSTANCE,l.NPC]},optional:!0},d:{type:t.OBJECT,elementInObject:{x:{type:t.INT_OR_GET_CHARACTER_DATA},y:{type:t.INT_OR_GET_CHARACTER_DATA},r:{type:t.NUMBER,optional:!0},gradientPercent1:{type:t.NUMBER,optional:!0},gradientPercent2:{type:t.NUMBER,optional:!0},offsetX:{type:t.NUMBER,optional:!0},offsetY:{type:t.NUMBER,optional:!0},light:{type:t.OBJECT,optional:!0,elementInObject:{r:{type:t.INT,optional:!0},color:{type:t.RGBA_COLOR,optional:!0},onlyNight:{type:t.BOOL,optional:!0}}}}}}},r.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},g=(e,i,n)=>{let a=i.getContext("2d");a.save(),a.globalCompositeOperation="destination-out",t.drawOneHole(e.onePointDataArrayHole[n],a,!0),a.restore()},f=(e,i,n)=>{let a=i.getContext("2d"),s=e.onePointDataArrayHole[n],r=Engine.nightController.getNightOpacity();s.stop0="rgba(0,0,0,"+r+")",s.stop1="rgba(0,0,0,"+.2*r+")",a.save(),a.globalCompositeOperation="lighter",t.drawOneHole(s,a,!0),a.restore()},m=t=>{const i="oneExtraLightData";return elementIsObject(t)?t.action==u||(t.d?!!elementIsObject(t)||(errorReport(e,i,"oneExtraLightData.d have to be object!",t),!1):(errorReport(e,i,"oneExtraLightData.d is obligatory in extraLight module!",t),!1)):(errorReport(e,i,"oneExtraLightData have to be object!",t),!1)},v=(t,e)=>{let n=s.manageRandomElementInObjectIfExist;n(t.d);let r=t.d.light;r&&(n(r),r.color&&n(r.color));let o=isset(t.id);o&&(t.id=a.getCharacterData(t.id,e));let l=t.master,c=b(l);if(t.id=c&&!o?(()=>{let t=0;for(;i[t];)t++;return t})():t.id,t.action==d&&(t.action=h),!c)return;let u=a.getTargetObject(l,e);u?E(u,t):_(t)},E=(t,e)=>{t.addExtraLightId(e.id);let i=(t=>({kind:"NPC",id:t.getId()}))(t);isset(i.id)&&(e.master.id=i.id),isset(i.kind)&&(e.master.kind=i.kind),e.d.x=t.d.x,e.d.y=t.d.y},_=t=>{warningReport(e,"prepareOneDataWithoutTargetObject","?"),t.d.x=a.getCharacterData(t.d.x,additionalData),t.d.y=a.getCharacterData(t.d.y,additionalData)},b=t=>{return t&&((e=t).kind&&(e.kind==r.TARGET_KIND.THIS_NPC_INSTANCE||"NPC"==e.kind));var e},w=(t,e)=>{let i=t.id,n=t.master?t.master:null;t.d.x=a.getCharacterData(t.d.x,e),t.d.y=a.getCharacterData(t.d.y,e),T(i,t,n)},C=t=>{let e=t.id;y(e)},T=(e,n,a)=>{((e,n,a)=>{if(i[e]={id:e,rajData:n,onePointDataArrayHole:t.getOnePoint(n,4,!0,!1),light:null,onlyNight:!0,master:a},!n.light)return;let s=Engine.nightController.createOneLightPoint(n);s&&(i[e].light=s,isset(n.light.onlyNight)&&(i[e].onlyNight=n.light.onlyNight))})(e,n.d,a),(t=>{let e=getEngine().nightController.getFramesOfNight(),i=I(t);for(let t=0;t<e.length;t++)g(i,e[t],t)})(e)},y=t=>{(t=>{let e=getEngine().nightController.getFramesOfNight(),i=I(t);for(let t=0;t<e.length;t++)f(i,e[t],t)})(t),(t=>{delete i[t]})(t)},I=t=>i[t],A=t=>!!i[t],k=()=>{i={}};this.init=()=>{t=new n,t.init(),p()},this.getExtraLightByNpcIdArray=t=>{let e=[];for(let n in i){let a=i[n];if(a.master&&"NPC"==a.master.kind){let i=t[a.master.id];if(!i)continue;e.push({warriorId:i.warriorId,originalId:i.originalId,extraLight:a})}}return e},this.rajRemoveActionBeyondManager=t=>{C({id:t,action:u})},this.getAllExtraLight=()=>i,this.resetExtraLight=k,this.addExtraLightsToAlreadyCreateFrameOfNight=(t,e)=>{for(let n in i){let i=I(n);g(i,t,e)}},this.updateData=(t,i)=>{if(t.action)return void("CLEAR_DATA"==t.action?k():errorReport(e,"updateData","undefined action",t.action));if(!c.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n){let e=n[t];m(e)&&(e.action!=u&&v(e,i),c.updateData(e,i))}}}},function(t,e,i){let n=i(31),a=i(509),s=i(3),r=i(4),o=i(1);t.exports=function(){let t,e,i="DynamicLightsManager.js",l={};const c=s.ACTION.REMOVE,d=()=>{e=new r;const t=s.TYPE;e.init(i,{createFunc:h,removeFunc:u,checkExistFunc:f,createRequire:{master:{type:{name:t.TARGET,option:[o.FAKE_NPC,o.HERO,o.PET,o.FLOAT_OBJECT]}},d:{type:t.OBJECT,elementInObject:{r:{type:t.FLOAT,optional:!0},gradientPercent1:{type:t.INT,optional:!0},gradientPercent2:{type:t.INT,optional:!0},offsetX:{type:t.INT,optional:!0},offsetY:{type:t.INT,optional:!0},light:{type:t.OBJECT,optional:!0,elementInObject:{r:{type:t.INT,optional:!0},color:{type:t.RGBA_COLOR,optional:!0},onlyNight:{type:t.BOOL,optional:!0}}}}}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},h=(t,e)=>{let i=new a;p(t.id,i),i.init(),i.updateData(t,e)},u=t=>{let e=t.id,i=m(e).getMaster();i&&i.getObjectDynamicLightManager().removeDynamicLightId(e),g(e)},p=(t,e)=>{l[t]=e},g=t=>{delete l[t]},f=t=>!!l[t],m=t=>l[t];this.init=()=>{t=new n,d()},this.update=t=>{for(let e in l)l[e].update(t)},this.updateData=(t,i)=>{let n=t.list;for(let t in n){let a=n[t];e.updateData(a,i)}},this.getDynamicLightList=()=>l,this.onClear=()=>{l={}},this.getframesWithHoles=()=>t,this.rajRemoveActionBeyondManager=t=>{u({id:t,action:c})}}},function(t,e,i){let n=i(6),a=i(81);t.exports=function(){let t=!0,e=null,i=null,s=null;this.init=()=>{s=new a},this.draw=(t,e)=>{let n=s.getDynamicHoleImgBuActualFrame(e);if(!n)return;let a=CFG.tileSize,r=CFG.halfTileSize,o=CFG.quarterTileSize,l=Engine.mapShift.getShift(),c=n.width,d=n.height,h=i.rx*a+r-c/2+(isset(i.ofsetX)?i.ofsetX:0)-Engine.map.offset[0]-l[0]+(void 0!==i.leftPosMod?i.leftPosMod:0),u=i.ry*a-d/2+o-Engine.map.offset[1]-l[1];t.drawImage(n,h,u)},this.updateData=(a,r)=>{let o=a.id,l=s.getXY(o,a.d);a.d.x=l.x,a.d.y=l.y,s.prepareDynamicPointAndDynamicPointImg(a.d),e=s.createLight(a.d),t=s.getOnlyNight(a.d),((t,e,a)=>{let s=n.getTargetObject(e,a);s&&(i=s,i.getObjectDynamicLightManager().addDynamicLightId(t))})(o,a.master,r)},this.update=t=>{e&&i&&(e.setX(i.rx),e.setY(i.ry))},this.getOnlyNight=()=>t,this.getLight=()=>e,this.getMaster=()=>i}},function(t,e,i){let n=i(31),a=i(511),s=i(3),r=i(4),o=i(1);t.exports=function(){let t,e,i="DynamicDirCharacterLightsManager.js",l={};const c=s.ACTION.REMOVE,d=()=>{const t=s.TYPE;let n={r:{type:t.NUMBER,optional:!0},gradientPercent1:{type:t.NUMBER,optional:!0},gradientPercent2:{type:t.NUMBER,optional:!0},offsetX:{type:t.NUMBER,optional:!0},offsetY:{type:t.NUMBER,optional:!0},light:{type:t.OBJECT,optional:!0,elementInObject:{r:{type:t.INT,optional:!0},color:{type:t.RGBA_COLOR,optional:!0},onlyNight:{type:t.BOOL,optional:!0}}}},a=GET_HARD_COPY_STRUCTURE(n);a.cover={type:t.BOOL,optional:!0},e=new r,e.init(i,{createFunc:h,removeFunc:u,checkExistFunc:f,createRequire:{master:{type:{name:t.TARGET,option:[o.FAKE_NPC,o.HERO,o.PET]}},d:{type:t.OBJECT,elementInObject:{base:{type:t.OBJECT,elementInObject:n},N:{type:t.OBJECT,optional:!0,elementInObject:a},S:{type:t.OBJECT,optional:!0,elementInObject:a},E:{type:t.OBJECT,optional:!0,elementInObject:a},W:{type:t.OBJECT,optional:!0,elementInObject:a}}}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},h=(t,e)=>{const i=new a,n=t.id;p(n,i),i.init(),i.updateData(n,t,e)},u=t=>{let e=t.id,i=m(e).getMaster();i&&i.getObjectDynamicLightManager().removeDynamicDirCharacterLightId(e),g(e)},p=(t,e)=>{l[t]=e},g=t=>{delete l[t]},f=t=>!!l[t],m=t=>l[t];this.init=()=>{t=new n,d()},this.update=t=>{for(let e in l)l[e].update(t)},this.updateData=(t,i)=>{if(!e.checkCorrectMainData(t,i))return;let n=t.list;for(let t in n){let a=n[t];e.updateData(a,i)}},this.getDirDynamicLightList=()=>l,this.onClear=()=>{l={}},this.getframesWithHoles=()=>t,this.rajRemoveActionBeyondManager=t=>{u({id:t,action:c})}}},function(t,e,i){let n=i(6),a=i(81),s=(i(1),i(11));t.exports=function(){let t=!0,e=null,i=null;const r=()=>{i={BASE:null,[s.N]:null,[s.E]:null,[s.S]:null,[s.W]:null}},o=(t,e,i)=>{let n=[s.N,s.E,s.S,s.W];for(let a of n){if(!i[a])continue;let n=deepMergeData(e,{d:i[a]});c(a,t,n)}},l=t=>i[t]?i[t].dynamicLightCommons:null,c=(t,e,n)=>{let s=new a,r=s.getXY(e,n.d),o=n.d;if(n.d.x=r.x,n.d.y=r.y,o.cover){let t=[{r:0,g:0,b:0,a:.8},{r:0,g:0,b:0,a:.2},{r:0,g:0,b:0,a:0}];s.prepareDynamicPointAndDynamicPointImg(o,t)}else s.prepareDynamicPointAndDynamicPointImg(o);let l=s.createLight(o);l&&o.cover&&l.setCover(!0),i[t]={dynamicLightCommons:s,light:l}},d=()=>{let t=e.getNDir();return i[t]&&i[t].light?i[t].light:i.BASE.light};this.init=()=>{r()},this.draw=(t,n)=>{let a=(()=>{let t=e.getNDir();return i[t]&&i[t].dynamicLightCommons?i[t].dynamicLightCommons:i.BASE.dynamicLightCommons})().getDynamicHoleImgBuActualFrame(n);if(!a)return;let s=CFG.tileSize,r=CFG.halfTileSize,o=CFG.quarterTileSize,l=Engine.mapShift.getShift(),c=a.width,d=a.height,h=e.rx*s+r-c/2+(isset(e.ofsetX)?e.ofsetX:0)-Engine.map.offset[0]-l[0]+(void 0!==e.leftPosMod?e.leftPosMod:0),u=e.ry*s-d/2+o-Engine.map.offset[1]-l[1];t.drawImage(a,h,u)},this.updateData=(i,a,s)=>{let r={action:a.action,id:a.id,master:copyStructure(a.master),d:copyStructure(a.d.base)},d=r.d;c("BASE",i,r);let h=l("BASE");t=h.getOnlyNight(d),((t,i,a)=>{let s=n.getTargetObject(i,a);s&&(e=s,e.getObjectDynamicLightManager().addDynamicDirCharacterLightId(t))})(i,r.master,s),o(i,r,a.d)},this.update=t=>{if(!e)return;let i=d();i&&(i.setX(e.rx),i.setY(e.ry))},this.getOnlyNight=()=>t,this.getLight=d,this.getMaster=()=>e}},function(t,e,i){let n=i(513),a=i(3),s=i(130),r=i(4);t.exports=function(){let t,e="BehaviorDynamicLightsManager.js",i={};const o=()=>{t=new r;const i=a.TYPE,n=s.behavior;t.init(e,{createFunc:c,removeFunc:d,checkExistFunc:l,createRequire:{d:{type:i.OBJECT,elementInObject:{x:{type:i.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:i.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},r:{type:i.FLOAT,optional:!0},gradientPercent1:{type:i.INT,optional:!0},gradientPercent2:{type:i.INT,optional:!0},offsetX:{type:i.INT,optional:!0},offsetY:{type:i.INT,optional:!0},light:{type:i.OBJECT,optional:!0,elementInObject:{r:{type:i.INT,optional:!0},color:{type:i.RGBA_COLOR,optional:!0},onlyNight:{type:i.BOOL,optional:!0}}},behavior:{type:i.OBJECT,elementInObject:{repeat:{type:i.INT_OR_BOOL,optional:!0},list:{type:i.ARRAY,elementInArray:{name:{conditionVal:{[n.IDLE]:{duration:{type:i.FLOAT,optional:!0}},[n.MOVE_TO_CORDS]:{x:{type:i.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS},y:{type:i.FLOAT_OR_GET_CHARACTER_DATA_OR_GET_RANDOM_ELEMENTS}},[n.TRANSITION]:{duration:{type:i.FLOAT,optional:!0},light:{type:i.OBJECT,optional:!0},r:{type:i.INT,optional:!0}},[n.TRANSITION_AND_MOVE_TO_CORDS]:{duration:{type:i.FLOAT,optional:!0}}}}}}}}}}}},a.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},l=t=>!!i[t],c=(t,e)=>{let a=t.id,s=new n;((t,e)=>{i[t]=e})(a,s),s.init(),s.updateData(a,t,e)},d=t=>{(t=>{delete i[t]})(t.id)};this.init=()=>{o()},this.update=t=>{for(let e in i)i[e].update(t)},this.updateData=(e,i)=>{if(!t.checkCorrectMainData(e,i))return;let n=e.list;for(let e of n)t.updateData(e,i)},this.getBehaviorDynamicLightList=()=>i,this.rajRemoveActionBeyondManager=t=>{d({action:a.REMOVE,id:t})},this.onClear=()=>{i={}}}},function(t,e,i){let n=i(130),a=i(6),s=i(81),r=i(76);t.exports=function(){let t="BehaviorDynamicLight.js",e=null,i=null,o=null,l=null,c=null,d=!0,h=null,u=null,p=!1,g=!1,f=null,m=null,v=null,E=null,_=null,b=null,w=null,C=null;const T=()=>{e=new r,e.init(this,()=>{J()},()=>{at()}),e.setDefaultRepeat(n.defaultData.BEHAVIOR_REPEAT)},y=t=>{o=t},I=t=>{i=t},A=t=>{e.decreaseDuration(t),e.getDuration()<0&&e.callBehavior()},k=t=>{S(t),null==l&&null==c&&e.callBehavior()},S=t=>{if(null==l&&null==c)return;let e=M(w,C,l,c,t);$(e.newX),H(e.newY),O({x:w,y:C},{x:p,y:g},{xVector:l,yVector:c})&&(tt(null),et(null),$(p),H(g))},O=(t,e,i)=>{let n=!1,a=!1;return 0==i.xVector?n=!0:i.xVector>0?t.x>e.x&&(n=!0):t.x<e.x&&(n=!0),0==i.yVector?a=!0:i.yVector>0?t.y>e.y&&(a=!0):t.y<e.y&&(a=!0),n&&a},M=(t,e,i,n,a)=>{let s=CFG.tileSize;return{newX:(t*s+i*a*100)/s,newY:(e*s+n*a*100)/s}},N=t=>{R(t),null==_&&null==b&&null==f&&null==m&&null==v&&null==E&&e.callBehavior()},R=t=>{let e=Q(),n=X();if(b){let e=n.r,i=h.getR(),a=D(t,i,e,b);h.setR(a.newLightR),a.finish&&(b=null)}if(_){let n=e,a=Engine.nightController.getActualFrame(),s=Engine.nightController.getNightFrameLength(),r=a-1;r<0&&(r=s-1);let o=u.getDynamicHoleRByFrame(r),l=u.getDynamicHoleOffsetXByFrame(a),c=u.getDynamicHoleOffsetYByFrame(a),d=L(t,o,n,_),h={d:{offsetX:l,offsetY:c,r:Math.round(d.newHoleR)}},p=u.getXY(i,h.d);if(d.finish){for(let t=0;t<s;t++)x(t,p.x,p.y,d.newHoleR);_=null}else x(a,p.x,p.y,d.newHoleR)}if(f||m||v||E){let e=n.color,i=h.getColorLightData(),a=P(t,i,e,f,m,v,E);h.setColorLightData(a.newColor.r,a.newColor.g,a.newColor.b,a.newColor.a),h.refreshColorLightStop(),a.finish&&(f=null,m=null,v=null,E=null)}},x=(t,e,i,n)=>{u.setDynamicHoleXByFrame(t,e),u.setDynamicHoleYByFrame(t,i),u.setDynamicHoleRByFrame(t,n),u.drawHoleByFrame(t)},L=(t,e,i,n)=>{let a=e,s=!1;if(n){let r=F(t,n,e,i);a=r.newVal,s=B(s,r)}return{newHoleR:a,finish:s}},D=(t,e,i,n)=>{let a=e,s=!1;if(n){let r=F(t,n,e,i);a=r.newVal,s=B(s,r)}return{newLightR:a,finish:s}},P=(t,e,i,n,a,s,r)=>{let o={r:e.r,g:e.g,b:e.b,a:e.a},l=!1;if(n){let a=F(t,n,e.r,i.r);o.r=a.newVal,l=B(l,a)}if(a){let n=F(t,a,e.g,i.g);o.g=n.newVal,l=B(l,n)}if(s){let n=F(t,s,e.b,i.b);o.b=n.newVal,l=B(l,n)}if(r){let n=F(t,r,e.a,i.a);o.a=n.newVal,l=B(l,n)}return{newColor:o,finish:l}},B=(t,e)=>!!t||!!e.finish,F=(t,e,i,n)=>{let a={newVal:i+t*e,finish:null};return e>0?a.newVal>n&&(a.finish=!0):a.newVal<n&&(a.finish=!0),a.finish&&(a.newVal=n),a},W=t=>{S(t),R(t),null==l&&null==c&&null==_&&null==b&&null==f&&null==m&&null==v&&null==E&&e.callBehavior()},$=t=>{w=t,this.x=t,this.rx=t},H=t=>{C=t,this.y=t,this.ry=t},G=()=>{let t=e.getActualBehaviorDurationData();null!=t&&e.setDuration(t)},V=(t,e,i)=>t==e?null:(e-t)/i,U=()=>{q(),j()},j=()=>{let t=e.getActualBehaviorDurationData();t=null===t?n.defaultData.BEHAVIOR_DURATION:t;let i=Q(),a=X();if(a){if(a.color){let e=a.color,i=h.getColorLightData();f=V(i.r,e.r,t),m=V(i.g,e.g,t),v=V(i.b,e.b,t),E=V(i.a,e.a,t)}if(a.r){let e=a.r,i=h.getR();b=V(i,e,t)}}if(null!=i){let e=i,n=Engine.nightController.getActualFrame(),a=u.getDynamicHoleRByFrame(n),s=Engine.nightController.getNightFrameLength();_=V(a,e,t/s)}},q=()=>{let t=z(),i=e.getActualBehaviorDurationData(),a=Y({x:t.x,y:t.y}),s=null;it(a.rx),nt(a.ry),i=null==i?n.defaultData.BEHAVIOR_DURATION:i,s=((t,e,i,n,a)=>Math.sqrt(Math.abs(t-i)+Math.abs(e-n))/a)(w,C,p,g,i);let r=K({x:w,y:C},{x:p,y:g},s);tt(r.newXVector),et(r.newYVector)},K=(t,e,i)=>{let n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return n+a==0?{newXVector:0,newYVector:0}:{newXVector:n*i/(n+a)*(t.x<=e.x?1:-1),newYVector:a*i/(n+a)*(t.y<=e.y?1:-1)}},Y=t=>({rx:a.getCharacterData(t.x),ry:a.getCharacterData(t.y)}),z=()=>{let t=Z();return t?{x:t.x,y:t.y}:null},X=()=>{let t=Z();return t&&t.light?t.light:null},Q=()=>{let t=Z();return t&&t.r?t.r:null},J=()=>{e.setDuration(n.defaultData.BEHAVIOR_DURATION)},Z=()=>e.getActualBehavior(),tt=t=>{l=t},et=t=>{c=t},it=t=>{p=t},nt=t=>{g=t},at=()=>{Engine.behaviorDynamicLightsManager.rajRemoveActionBeyondManager(i)};this.init=()=>{u=new s,T(),e.setBehaviorRepeat(n.defaultData.BEHAVIOR_REPEAT)},this.draw=(t,e)=>{let i=u.getDynamicHoleImgBuActualFrame(e);if(!i)return;let n=CFG.tileSize,a=CFG.halfTileSize,s=CFG.quarterTileSize,r=Engine.mapShift.getShift(),o=i.width,l=i.height,c=w*n+a-o/2-Engine.map.offset[0]-r[0],d=C*n-l/2+s-Engine.map.offset[1]-r[1];t.drawImage(i,c,d)},this.update=t=>{let i=e.getActualBehaviorName();const a=n.behavior;switch(i){case a.IDLE:A(t);break;case a.MOVE_TO_CORDS:k(t);break;case a.TRANSITION:N(t);break;case a.TRANSITION_AND_MOVE_TO_CORDS:W(t)}h.setX(w),h.setY(C)},this.updateData=(t,n,s)=>{((t,e)=>{I(t.id),y(t),$(a.getCharacterData(t.d.x,e)),H(a.getCharacterData(t.d.y,e))})(n,s),e.setBehaviorList(copyStructure(o.d.behavior.list));let r=u.getXY(i,n.d);n.d.x=r.x,n.d.y=r.y,u.prepareDynamicPointAndDynamicPointImg(n.d),h=u.createLight(n.d),d=u.getOnlyNight(n.d),isset(n.d.behavior.repeat)&&e.setBehaviorRepeat(o.d.behavior.repeat),e.callBehavior()},this.getOnlyNight=()=>d,this.getLight=()=>h,this.getId=()=>i,this.startBehavior=e=>{const i=n.behavior;switch(e){case i.IDLE:G();break;case i.MOVE_FROM_VECTORS:startMoveFromVectorsBehavior();break;case i.MOVE_TO_CORDS:q();break;case i.TRANSITION:j();break;case i.TRANSITION_AND_MOVE_TO_CORDS:U();break;case i.TP_TO_CORDS:startTpBehavior();break;case i.TP_ON_OTHER_SIDE:startTpOnOtherSideBehavior();break;default:errorReport(t,"startBehavior","Incorrect name!",e)}}}},function(t,e,i){let n=i(1),a=i(4),s=i(3);t.exports=function(){const t="RajCameraTarget.js";let e={data:null,targetObject:null,cords:null},i=null,r=0;const o=()=>{i=new a;const e=s.TYPE,r=n.NPC,o=n.FAKE_NPC,d=n.PET,h=n.MAP,u=n.FLOAT_OBJECT,p=s.TARGET_KIND.THIS_NPC_INSTANCE;i.init(t,{createFunc:l,clearFunc:c,createRequire:{target:{type:{name:e.TARGET,option:[p,o,d,h,u,r]}},duration:{type:e.NUMBER,optional:!0}}},s.GROUP_NAME.OVERRIDE_OBJECT)},l=t=>{d(),u(t)},c=()=>{d()},d=()=>{if(p(null,null,null),h(),Engine.dialogue){let t=Engine.dialogue.getDialogueCenterPos();Engine.map.centerOn(t.x,t.y)}},h=()=>{r=0},u=t=>{switch(t.target.kind){case n.FAKE_NPC:p(t,Engine.fakeNpcs.getById(t.target.id),null);break;case n.PET:p(t,Engine.hero.getPet(),null);break;case n.NPC:p(t,Engine.npcs.getById(t.target.id),null);break;case n.MAP:p(t,null,{x:t.target.x,y:t.target.y});break;case n.FLOAT_OBJECT:p(t,Engine.floatObjectManager.getById(t.target.id))}},p=(t,i,n)=>{e.data=t,e.targetObject=i,e.cords=n},g=()=>{null!=e.targetObject&&Engine.map.centerOn(e.targetObject.rx,e.targetObject.ry),null!=e.cords&&Engine.map.centerOn(e.cords.x,e.cords.y)};this.init=()=>{o()},this.update=t=>{if(null==e.data)return;let i=e.data.duration;i&&(r+=1e3*t,r>1e3*i)?d():g()},this.updateData=(t,e)=>{i.checkCorrectMainData(t,e)&&i.updateData(t,e)},this.onClear=()=>{d()}}},function(t,e,i){let n=i(1),a=i(4),s=i(3);t.exports=function(){const t="RajTracking.js";let e=null,i={data:null,parentObject:null,targets:{}};const r=()=>{e=new a;const i=s.TYPE;e.init(t,{createFunc:l,clearFunc:c,createRequire:{parent:{optional:!0,type:{name:i.TARGET,option:[n.FLOAT_OBJECT,n.FAKE_NPC,n.PET]}},target:{optional:!0,elementInObject:{list:{type:i.ARRAY,elementInArray:{id:{},name:{},x:{type:i.INT},y:{type:i.INT}}}}}}},s.GROUP_NAME.OVERRIDE_OBJECT)},o=(t,e)=>({name:t.name,id:e,x:t.x,y:t.y}),l=(t,e)=>{v(t)&&(d(),h(t,e))},c=()=>{d()},d=()=>{(()=>{m(null,null);for(let t in i.targets){let e=i.targets[t].id;Engine.targets.deleteArrow("SRAJ_TRACKING_ARROW"+e),delete i[e]}})()},h=t=>{u(t),p(t)},u=t=>{if(t.parent)switch(t.parent.kind){case n.FAKE_NPC:m(t,Engine.fakeNpcs.getById(t.parent.id));break;case n.PET:m(t,Engine.hero.getPet());break;case n.FLOAT_OBJECT:m(t,Engine.floatObjectManager.getById(t.parent.id))}},p=t=>{if(!t.target)return;let e=t.target.list;for(let t in e){let n=e[t];if(!Engine.rajCase.checkFullFillCase(n.case))continue;let a=getFreeIdOfObject(i.targets),s=o(n,a);f(s),g(s)}},g=t=>{i.targets[t.id]=t},f=t=>{const e="SRAJ_TRACKING_ARROW"+t.id;getEngine().targets.addArrow(e,t.name,t,"SRAJ_TRACKING_ARROW")},m=(t,e)=>{i.data=t,i.parentObject=e},v=e=>{let i=e.parent;const a="checkParent";switch(i.kind){case n.FAKE_NPC:if(!isset(i.id))return errorReport(t,a,"parent.kind:FAKE_NPC have to parent.id attr!",e),!1;if(!Engine.fakeNpcs.getById(i.id))return errorReport(t,a,"parent.kind:FAKE_NPC fakeNpc not exist!",e),!1;break;case n.PET:if(!Engine.hero.getPet())return errorReport(t,a,"parent.kind:PET Hero not use pet now!",e),!1;break;case n.FLOAT_OBJECT:if(!Engine.floatObjectManager.getById(e.parent.id))return errorReport(t,a,"parent.kind:FLOAT_OBJECT floatObject not exist!",e),!1;break;default:return errorReport(t,a,"undefined parent.kind!",e),!1}return!0};this.init=()=>{r()},this.updateData=(t,i)=>{e.checkCorrectMainData(t,i)&&e.updateData(t,i)},this.getParent=()=>null==i.parentObject?null:i.parentObject,this.checkParent=()=>null!=i.parentObject,this.onClear=()=>{d()}}},function(t,e,i){let n=i(1),a=i(4);const s=i(3);t.exports=function(){let t="RajCharacterHide.js",e=!1,i=!1,r=null,o={},l={},c={};const d=()=>{r=new a;const e=s.TYPE,i=n.HERO,o=n.PET,l=n.FAKE_NPC,c=n.NPC,d=n.FLOAT_OBJECT,h=s.TARGET_KIND.THIS_NPC_INSTANCE;r.init(t,{createFunc:_,removeFunc:b,createRequire:{target:{type:{name:e.TARGET,option:[i,o,l,d,c,h]}},showTip:{type:e.BOOL,optional:!0},displayOnMiniMap:{type:e.BOOL,optional:!0}}},s.GROUP_NAME.OBJECT_WITH_LIST_ACTION_TARGET)},h=t=>{e=0!=t?{showTip:!isset(t.showTip)||t.showTip,displayOnMiniMap:!!isset(t.displayOnMiniMap)&&t.displayOnMiniMap}:null},u=t=>{i=0!=t?{showTip:!isset(t.showTip)||t.showTip}:null},p=()=>!!e,g=()=>!!i,f=t=>{delete o[t]},m=t=>{delete l[t]},v=t=>l[t],E=(e,i)=>{e.kind&&errorReport(t,"checkCorrectData",'{kind: "..."} is deprecated! Use {target: {kind: "..."}}',e),r.updateData(e,i)},_=(e,i)=>{switch(e.kind&&(e.target={kind:{}},e.target.kind=e.kind,delete e.kind,isset(e.id)&&(e.target.id=e.id,delete e.id)),e.target.kind){case n.HERO:h(e);break;case n.PET:u(e);break;case n.FAKE_NPC:a=e.target.id,o[a]=!0;break;case n.FLOAT_OBJECT:(t=>{c[t]=!0})(e.target.id);break;case n.NPC:(t=>{l[t.target.id]={showTip:!isset(t.showTip)||t.showTip,displayOnMiniMap:!!isset(t.displayOnMiniMap)&&t.displayOnMiniMap}})(e);break;default:errorReport(t,"createAction","undefined kind",e.target.kind)}var a},b=(e,i)=>{switch(e.kind&&(e.target={kind:{}},e.target.kind=e.kind,delete e.kind,isset(e.id)&&(e.target.id=e.id,delete e.id)),e.target.kind){case n.HERO:h(!1);break;case n.PET:u(!1);break;case n.FAKE_NPC:f(e.target.id);break;case n.FLOAT_OBJECT:a=e.target.id,delete c[a];break;case n.NPC:m(e.target.id);break;default:errorReport(t,"removeAction","undefined kind",e.target.kind)}var a},w=t=>!v(t)||l[t].showTip,C=()=>!p()||e.showTip,T=()=>!g()||i.showTip;this.init=()=>{d()},this.updateData=(t,e)=>{if(r.checkCorrectMainData(t,e))for(let i in t.list)E(t.list[i],e)},this.checkHideObject=e=>{let i=e.canvasObjectType;if(!i)return!1;switch(i){case n.HERO:return p();case n.PET:return g();case n.FAKE_NPC:return a=e.id,o[a];case n.NPC:return v(e.d.id);case n.FLOAT_OBJECT:return(t=>!!c[t])(e.getId());case n.OTHER:case n.M_ITEM:case n.GATEWAY:case n.MAP:case n.HEROES_RESP:return!1;default:errorReport(t,"checkHideObject","undefined kind!",i)}var a},this.checkDisplayOnMiniMap=i=>{let a=i.canvasObjectType;if(!a)return!0;switch(a){case n.HERO:return!p()||e.displayOnMiniMap;case n.PET:case n.FAKE_NPC:return!1;case n.NPC:return s=i.d.id,!v(s)||l[s].displayOnMiniMap;case n.OTHER:case n.M_ITEM:case n.GATEWAY:case n.MAP:case n.HEROES_RESP:return!0;default:errorReport(t,"checkShowTip","undefined kind!",a)}var s},this.checkShowTip=e=>{let i=e.canvasObjectType;if(!i)return!0;switch(i){case n.HERO:return C();case n.PET:return T();case n.FAKE_NPC:return!0;case n.NPC:return w(e.d.id);case n.OTHER:case n.M_ITEM:case n.GATEWAY:case n.MAP:case n.HEROES_RESP:return!0;default:errorReport(t,"checkShowTip","undefined kind!",i)}},this.onClear=()=>{h(!1),u(!1);for(let t in o)f(t);for(let t in l)m(t)}}},function(t,e,i){let n=i(25);i(1);t.exports=function(){const t=(t,e)=>{switch(t.windowTarget){case n.windowTarget.MAP:Engine.characterEffectsMapManager.updateData(t,e);break;case n.windowTarget.BATTLE:Engine.characterEffectsBattleManager.updateData(t,e);break;default:errorReport("CharacterEffectsManager.js","updateData","incorrect attr windowTarget!",t)}},e=t=>{let e=[];for(let i in t){let n=t[i];e.push(n)}return e};this.init=()=>{},this.updateData=(i,n)=>{if(!Engine.characterEffectsMapManager.getRajActionManager().checkCorrectMainData(i,n))return;let a=e(i.list);for(let e in a){let i=a[e];i.windowTarget?t(i,n):errorReport("CharacterEffectsManager.js","updateData","Attr windowTarget not exist!",i)}}}},function(t,e,i){let n=i(519),a=i(520),s=i(521),r=i(25),o=i(21),l=i(3),c=i(4),d=(i(6),i(1)),h=i(41);t.exports=function(){let t=null,e={},i="CharacterEffectsMapManager.js";l.ACTION.CREATE,l.ACTION.CREATE_IF_NOT_EXIST;const u=()=>{const e=l.TYPE,n=r.effect,a=h.params.position,s=r.TINT_KIND;t=new c,t.init(i,{createFunc:p,removeFunc:f,checkExistFunc:m,createRequire:{target:{type:{name:e.TARGET,option:[l.TARGET_KIND.THIS_NPC_INSTANCE,d.NPC,d.FAKE_NPC,d.HERO]}},effect:{conditionVal:{[n.ANIMATION]:{params:{type:e.OBJECT,elementInObject:{duration:{type:e.NUMBER,optional:!0},repeat:{type:e.INT_OR_BOOL,optional:!0},delayBefore:{type:e.NUMBER,optional:!0},delayAfter:{type:e.NUMBER,optional:!0},offsetX:{type:e.NUMBER,optional:!0},offsetY:{type:e.NUMBER,optional:!0},opacity:{type:e.FLOAT,optional:!0},gifUrl:{},behind:{type:e.BOOL,optional:!0},speechBubble:{type:e.BOOL,optional:!0},position:{specificVal:[a.TOP,a.RIGHT,a.BOTTOM,a.LEFT,a.CENTER]}}}},[n.TINT]:{params:{type:e.OBJECT,elementInObject:{duration:{type:e.NUMBER},repeat:{type:e.INT_OR_BOOL,optional:!0},delayBefore:{type:e.NUMBER,optional:!0},delayAfter:{type:e.NUMBER,optional:!0},offsetX:{type:e.NUMBER,optional:!0},offsetY:{type:e.NUMBER,optional:!0},opacity:{type:e.FLOAT,optional:!0},color:{type:e.RGBA_COLOR},tintPercent:{type:e.NUMBER,optional:!0},kind:{specificVal:[s.SHOW_AND_HIDE,s.SHOW_AND_STICK,s.HIDE],optional:!0}}}},[n.TEXT]:{params:{type:e.OBJECT,elementInObject:{duration:{type:e.NUMBER,optional:!0},repeat:{type:e.INT_OR_BOOL,optional:!0},delayBefore:{type:e.NUMBER,optional:!0},delayAfter:{type:e.NUMBER,optional:!0},offsetX:{type:e.NUMBER,optional:!0},offsetY:{type:e.NUMBER,optional:!0},text:{type:e.ARRAY},color:{type:e.RGB_COLOR,optional:!0},height:{type:e.NUMBER,optional:!0},between:{type:e.NUMBER,optional:!0},stickMap:{type:e.BOOL,optional:!0},random:{optional:!0}}}}}}}},l.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID)},p=(t,e)=>{let i=g(t);i&&v(t,i,e)},g=t=>{switch(t.effect){case r.effect.ANIMATION:return n;case r.effect.TINT:return a;case r.effect.TEXT:return s;default:return errorReport(i,"getTypeClass","incorrect attr effect!",t),null}},f=t=>{let e=t.id;E(e)},m=t=>!!e[t],v=(t,e,i)=>{let n=new e,a=t.id;n.init(a,t),n.getMaster()&&b(a,n)},E=t=>{w(t)},_=(t,e,i)=>{let n=[];for(let a in i){let s=i[a],r=s.getMasterKindObject();if(r!=t)continue;let o=!1;switch(r){case d.HERO:o=!0;break;case d.NPC:s.getMasterId()==e&&(o=!0)}o&&n.push(s)}return n},b=(t,i)=>{e[t]=i},w=t=>{delete e[t]};this.init=()=>{u()},this.updateData=(e,n)=>{e.params&&o.manageRandomElementInObjectIfExist(e.params),e.name?errorReport(i,"updateData","Attr name is deprecated! Use id!",e):e.target?t.updateData(e,n):errorReport(i,"updateData","Attr target is obligatory!",e)},this.update=t=>{for(let i in e)e[i].update(t)},this.getDrawableList=()=>{let t=[];if(Engine.hero.d.stasis)return t;for(let i in e)t.push(e[i]);return t},this.getEffectsByEffectNameAndMaster=(t,i,n)=>{let a=[];for(let s in e){let r=e[s],o=r.getData();if(o.effect==t&&o.target.kind==i){let t=isset(o.target.id);(!t||t&&o.target.id==n)&&a.push(r)}}return a},this.afterStopAction=t=>{let i=e[t],n=i.getRepeat(),a=i.getActualRepeat();null!=n?!0!==n&&a>n?E(t):i.start():E(t)},this.getEffectsByKind=_,this.removeCharacterEffectFromDeleteCharacter=(t,i)=>{let n=_(t,i,e);for(let t in n){let e=n[t].getId();E(e)}},this.getRajActionManager=()=>t,this.onClear=()=>{e={}}}},function(t,e,i){i(25);let n=i(82),a=i(6),s=function(){let t,e,i,n=!1,s=0,r=null,o=null,l=null;const c=t=>{let e=this.getData(),i=CFG.r_rajGraphics+a.getCharacterData(e.params.gifUrl,t),n={speed:!1,externalSource:cdnUrl};if(Engine.imgLoader.onload(i,n,(t,e)=>{d(e,t)},t=>{h()}),!e.params.speechBubble)return;let s=CFG.r_epath+"speech_bubble.gif";Engine.imgLoader.onload(s,{speed:!0,externalSource:cdnUrl},!1,t=>{l=t})},d=(n,a)=>{t=a,e=n.frames,i=!0,this.setFw(n.hdr.width),this.setFh(n.hdr.height)},h=()=>{u()},u=()=>{r=0,o=0,n=!0,this.setCycleFinish(!1),this.setDelayBefore(0),this.setDelayAfter(0)},p=()=>{let t=this.getId(),e=this.getActualRepeat();n=!1,e++,this.setCycleFinish(!1),this.setActualRepeat(e),Engine.characterEffectsMapManager.afterStopAction(t)};this.init=(t,e,i)=>{this.initObject(t,e),c(i)},this.update=t=>{if(n){if(e&&e.length>1){let i=100*t;if(this.isDelayBeforeInParams()&&(this.increaseDelayBefore(i),!this.isDelayBeforeReach()))return;if(this.getCycleFinish())return void(this.isDelayAfterInParams()?(this.increaseDelayAfter(i),this.isDelayAfterReach()&&p()):p());r+=i,s+=i,e[o].delay<r&&(r-=e[o].delay,e.length==o+1?(o=0,this.setCycleFinish(!0)):o+=1)}this.getMaster()&&(this.setXFromMaster(),this.setYFromMaster())}},this.draw=e=>{if(!n)return;if(!this.getMaster())return;if(this.shouldBreakDrawFromDelayBefore())return;if(this.getCycleFinish())return;let i=this.getData().params.opacity,a=this.getFw(),s=this.getFh();i&&(e.save(),e.globalAlpha=i);let r=this.getPos(),c=o*s,d=Math.round(r.left),h=Math.round(r.top);l&&e.drawImage(l,d-l.width/2+this.fw/2,h-l.height/2+this.fh/2),e.drawImage(t,0,c,a,s,d,h,a,s),i&&e.restore()},this.start=u,this.stop=p};(s.prototype=Object.create(n.prototype)).constructor=s,t.exports=s},function(t,e,i){i(25);let n=i(82),a=i(1),s=i(11),r=i(25),o=function(){const t={fileName:"TintEffect.js"};let e,i,n,o,l=!1,c=0,d=!1;const h=()=>{let e=this.getData().params.kind;const i=r.TINT_KIND;if(isset(e))switch(e){case i.SHOW_AND_HIDE:e=i.SHOW_AND_HIDE;break;case i.SHOW_AND_STICK:e=i.SHOW_AND_STICK;break;case i.HIDE:e=i.HIDE;break;default:errorReport(t.file,"initKind",`Kind ${e} not exist!`)}else e=i.SHOW_AND_HIDE;u(e)},u=t=>{o=t},p=()=>{g(()=>{m()})},g=t=>{let n=this.getMaster();n&&(n.canvasObjectType!=a.NPC||n.onloadProperImg?(i=document.createElement("canvas"),e=i.getContext("2d"),i.width=n.fw,i.height=n.fh,this.setFw(n.fw),this.setFh(n.fh),t()):setTimeout(()=>{g(t)},100))},f=()=>{let t=this.getData(),i=this.getMaster(),n=t.params.color;var a=isset(i.dir)?i.dir:"S",r=i.frame*i.fw;let o=null;switch(a){case s.S:o=0;break;case s.W:o=i.fh;break;case s.E:o=2*i.fh;break;case s.N:o=3*i.fh}o+=i.activeFrame*i.fh,e.globalCompositeOperation="source-over",e.fillStyle=`rgb(${n.r},${n.g},${n.b})`,e.fillRect(0,0,i.fw,i.fh),e.globalCompositeOperation="destination-in",e.drawImage(i.sprite,r,o,i.fw,i.fh,0,0,i.fw,i.fh)},m=()=>{if(n=0,l=!0,o==r.TINT_KIND.HIDE){let t=this.getData();d=!0,c=t.params.color.a,n=Math.round(10*(3.14-Math.sin(c)))/10}this.setCycleFinish(!1),this.setDelayBefore(0),this.setDelayAfter(0)},v=()=>{let t=this.getId(),e=this.getActualRepeat();l=!1,e++,this.setCycleFinish(!1),this.setActualRepeat(e),Engine.characterEffectsMapManager.afterStopAction(t)};this.init=(t,e)=>{this.initObject(t,e),h(),p()},this.start=m,this.update=t=>{if(!l)return;let e=this.getData(),i=1==e.params.color.a?.99:e.params.color.a,a=100*t;if(this.isDelayBeforeInParams()&&(this.increaseDelayBefore(a),!this.isDelayBeforeReach()))return;if(this.getCycleFinish())return void(this.isDelayAfterInParams()?(this.increaseDelayAfter(a),this.isDelayAfterReach()&&v()):v());if(this.getMaster()&&(this.setXFromMaster(),this.setYFromMaster()),d&&o==r.TINT_KIND.SHOW_AND_STICK)return;let s=3.14*(1-i)*e.params.duration,h=e.params.duration+s;n+=3.14*t*1/h,n>3.14&&(n=0,d=!1,this.setCycleFinish(!0)),c=Math.round(100*Math.sin(n))/100,c>i&&!d&&(d=!0,c=i,n=3.14-n)},this.draw=t=>{if(!l)return;if(!this.getMaster())return;if(this.shouldBreakDrawFromDelayBefore())return;if(this.getCycleFinish())return;let e=this.getFw(),n=this.getFh();t.save(),t.globalAlpha=c;let a=this.getPos(),s=Math.round(a.left),r=Math.round(a.top);f(),t.drawImage(i,0,0,e,n,s,r,e,n),t.restore()}};(o.prototype=Object.create(n.prototype)).constructor=o,t.exports=o},function(t,e,i){let n=i(82),a=i(66),s=i(99),r=function(){let t=null,e=null,i=5,n=5,r=null,o=null,l=null,c=!1,d=!1,h=null;this.textOrder=null;const u=()=>{let t=this.getData(),e=t.effect,i=t.target.kind,n=t.target.id,a=Engine.characterEffectsMapManager.getEffectsByEffectNameAndMaster(e,i,n);if(!a.length)return 0;let s=0;for(let t in a){let e=a[t].textOrder;s<e&&(s=e)}return s+1},p=t=>{this.textOrder=t},g=()=>{let t=u();p(t)},f=()=>{h=new a},m=t=>{r=t},v=t=>{i=t},E=t=>{n=t},_=()=>null!==this.getX()&&null!==this.getY(),b=()=>{let a=r.length,s=isset(this.data.params.stickMap),h=this.data.params.random;t-=i,e=n,c=!1,s&&(this.setX(null),this.setY(null)),l++,o=w(a,h,o),l=C(a,h,l),l>a-1?d=!0:this.isDelayBeforeInParams()||0!=n||(c=!0)},w=(t,e,i)=>(e?i=Math.round(Math.random()*(t-1)):i++,i),C=(t,e,i)=>e?("ONE"==e&&(i=t),i):i,T=()=>{let i=r.length,n=this.data.params.random;t=0,e=0,o=w(i,n,-1),l=0,d=!1,this.setPosFromMaster(),this.setCycleFinish(!1),this.setDelayBefore(0),this.setDelayAfter(0)},y=()=>{let t=this.getId(),e=this.getActualRepeat();e++,this.setCycleFinish(!1),this.setActualRepeat(e),Engine.characterEffectsMapManager.afterStopAction(t)};this.start=T,this.stop=y,this.init=(t,e)=>{this.initObject(t,e),f(),isset(e.params.duration)&&v(e.params.duration),isset(e.params.between)&&E(e.params.between),m(e.params.text),g(),T()},this.update=a=>{(t=>{0!=n&&0!=e?(e-=t,e<0?(e=0,c=!0):c=!1):c=!0})(a);let s=100*a;this.isDelayBeforeInParams()&&(this.increaseDelayBefore(s),!this.isDelayBeforeReach())||(this.getCycleFinish()?this.isDelayAfterInParams()?(this.increaseDelayAfter(s),this.isDelayAfterReach()&&y()):y():d?0==e&&this.setCycleFinish(!0):c&&(this.data.params.stickMap?_()||this.setPosFromMaster():this.getMaster()&&this.setPosFromMaster(),t+=a,t>i&&b()))},this.draw=t=>{if(!c)return;let e=this.getMaster();if(!e)return;if(this.shouldBreakDrawFromDelayBefore())return;if(this.getCycleFinish())return;let i=this.getPos(),n=0;n+=s.addOffsetOfEmo(e,!1),n+=s.addOffsetOfKillTimer(e,!1),n+=s.addOffsetOfDataDrawNick(e);let a=Math.round(i.left),l=Math.round(i.top)-n,d=this.getData(),u=d.params.height,p=d.params.color;u=u||11,p=p?`rgb(${p.r},${p.g},${p.b})`:"#ffffff",t.save(),h.draw(t,r[o],a,l,u,p),t.restore()}};(r.prototype=Object.create(n.prototype)).constructor=r,t.exports=r},function(t,e,i){let n=i(523),a=i(25),s=i(1);t.exports=function(){let t,e,i={};const r=t=>{t.effect==a.effect.ANIMATION&&c(t)},o=t=>{let e=l(t);for(let t in e){let i=e[t].getId();d(i)}},l=t=>h(t.name,t.target.kind,t.target.id),c=t=>{let e=new n,a=(()=>{if(0==lengthObject(i))return 0;for(let t in i){let e=parseInt(t)+1;if(!i[e])return e}return errorReport("MapObjectManager.js","getNewId","newId empty! list :",i),Math.random()})();e.init(a,t),u(a,e)},d=t=>{i[t]?p(t):errorReport("MapObjectManager.js","removeMapObject",`id ${t} not exist!`,i)},h=(t,e,n)=>{let a=[];for(let r in i){let o=i[r],l=o.getMasterKindObject();if(o.getName()!=t)continue;if(l!=e)continue;let c=!1;switch(l){case s.HERO:c=!0;break;case s.NPC:o.getMasterId()==n&&(c=!0)}c&&a.push(o)}return a},u=(t,e)=>{i[t]=e},p=t=>{delete i[t]},g=()=>{t=Engine.battle.$.find(".character-effects")[0],e=t.getContext("2d")},f=()=>{let e=Engine.battle.$;t.width=e.width(),t.height=e.height()};this.init=()=>{g(),f()},this.updateData=t=>{switch(t.action){case a.action.CREATE:r(t);break;case a.action.REMOVE:o(t)}},this.getDrawableList=()=>{let t=[];for(let e in i)t.push(i[e]);return t},this.onResize=()=>{f()},this.update=t=>{for(let e in i)i[e].update(t)},this.draw=()=>{e.clearRect(0,0,t.width,t.height);for(let t in i)i[t].draw(e)},this.onClear=()=>{i={}},this.afterStopAction=t=>{let e=i[t],n=e.getRepeat(),a=e.getActualRepeat();null!=n?1!=n&&a>n?d(t):e.start():d(t)}}},function(t,e,i){let n=i(25);t.exports=function(){let t,e,i,a,s,r=null,o=null,l=null,c=null,d=0,h=null,u=null,p=1,g=null,f=null,m=!1;this.alwaysDraw=!0;const v=()=>{b(f.xPos)},E=()=>{c=g.name},_=()=>{w(f.yPos)},b=t=>{o=t},w=t=>{l=t},C=()=>{let t=g.target.id,e=Engine.battle.warriorsList;for(let i in e)if(e[i].getOriginalId()==t)return e[i];return null},T=t=>{f=t},y=()=>{let t=CFG.r_battleEffectsGif+g.params.gifUrl,e={speed:!1,externalSource:cdncrUrl};Engine.imgLoader.onload(t,e,(t,e)=>{I(e,t)},t=>{A()})},I=(n,r)=>{t=r,i=n.hdr.width,a=n.hdr.height,e=n.frames,s=!0};this.getOrder=()=>1e4;const A=()=>{k()},k=()=>{h=0,u=0,m=!0},S=t=>{r=t},O=t=>{g=t},M=()=>{let t=f.fw,e=f.fh;switch(g.params.position){case n.position.CENTER:return[t/2-i/2,-e/2];case n.position.LEFT:return[-i,-e/2];case n.position.RIGHT:return[t,-e/2];case n.position.TOP:return[t/2-i/2,-e-a/2];case n.position.BOTTOM:return[t/2-i/2,a/2];default:return errorReport("MapObject.js","getPositionModify","position not exist",position),[0,0]}};this.init=(t,e)=>{S(t),O(e),E(),T(C()),v(),_(),y()},this.getId=()=>r,this.getName=()=>c,this.getActualRepeat=()=>p,this.getRepeat=()=>g.params.repeat?g.params.repeat:null,this.update=t=>{if(m&&e&&e.length>1){let i=100*t;h+=i,d+=i,e[u].delay<h&&(h-=e[u].delay,e.length==u+1?(u=0,m=!1,p++,Engine.characterEffectsBattleManager.afterStopAction(r)):u+=1)}},this.draw=e=>{if(!m)return;let n=g.params.opacity;n&&(e.save(),e.globalAlpha=n);let s=M(),r=Engine.battle.$[0].offsetWidth/2-Engine.battle.getBattleArea()[0].offsetWidth/2+o+s[0]-f.fw/2,c=Engine.battle.$[0].offsetHeight/2-Engine.battle.getBattleArea()[0].offsetHeight/2+l+s[1]-1.5*f.fh,d=u*a;console.log(o,l,f.id),e.drawImage(t,0,d,i,a,r,c,i,a),n&&e.restore()},this.start=k,this.getMasterKindObject=()=>f.getCanvasObjectType(),this.getMasterId=()=>f.id}},function(t,e,i){let n=i(29),a=i(525),s=i(526);t.exports=function(){let t={};this.init=function(){},this.draw=function(){for(let e in t)t[e].draw()},this.getList=function(){return t},this.update=function(e){for(let i in t)t[i].update(e)},this.addCharacter=function(e){if(!function(t){return t.drawSystem&&t.path?n.drawSystem[t.drawSystem]?!(t.drawSystem==n.drawSystem.PET&&!t.hasOwnProperty("actions"))||(errorReport("CanvasCharacterWrapperManager.js","checkDataCorrect","Attr actions not exist!"),!1):(errorReport("CanvasCharacterWrapperManager.js","checkDataCorrect","That draw system not exist:"+t.drawSystem),!1):(errorReport("CanvasCharacterWrapperManager.js","checkDataCorrect","Attr drawSystem not exist!"),!1)}(e))return!1;let i=function(){let e=0;for(;t[e];)e++;return e}();return function(e,i){t[e]=i}(i,function(t){switch(t.drawSystem){case n.drawSystem.PLAYER_OUTFIT:return new a;case n.drawSystem.PET:return new s;default:errorReport("CanvasCharacterWrapperManager.js","createObject","That drawSystem not supporter yet:"+t.drawSystem)}}(e)),t[i].init(i),t[i].updateData(e),t[i]},this.removeCharacter=function(e){!function(e){return!!t[e]}(e)?errorReport("CanvasCharacterWrapperManager.js","removeCharacter","Character not exit:"+e):(t[e].remove(),function(e){delete t[e]}(e))}}},function(t,e,i){let n=i(11);t.exports=function(){let t,e,i,a,s,r,o,l,c,d=0,h=0,u=0,p=0,g=null,f=0,m=[n.S,n.W,n.N,n.E],v=["down","left","up","right"],E=0,_=!1,b=!1;function w(t,e){l.width=t,l.height=e}function C(t,e){return[t,()=>{g=e}]}this.init=function(e){t=e,l=document.createElement("canvas"),c=l.getContext("2d"),$(l).on("contextmenu",t=>{getE(t),function(t){let e=[];for(let t=0;t<v.length;t++){let i=C(_t(v[t]),t);e.push(i)}null!=g&&e.push(C(_t("cancel_action_or_dir"),null)),e.push([_t("try_on"),()=>Engine.hero.outfitPreview(i)]),Engine.interface.showPopupMenu(e,t)}(t)}),w(32,48)},this.updateData=function(t){e=t.drawSystem,i=t.path,Engine.imgLoader.onload(CFG.r_opath+i,{speed:!1,externalSource:cdnUrl},(t,e)=>{_||function(t,e){a=t.hdr.width/4,s=t.hdr.height/4,r=t.frames,o=e,w(a,s)}(e,t)},t=>{_||(b=!0)},()=>{_||errorReport("CanvsCharacterWrapper.js","loadImg","Load img error")})},this.update=function(t){!function(t){r&&r.length>1&&t&&(h+=100*t,r[d].delay<h&&(h-=r[d].delay,d=r.length==d+1?0:d+1))}(t),function(t){if(null!=g)return void(E=g);if(f+=100*t,200>f)return;f=0,E++,E+1>m.length&&(E=0)}(t),function(t){u+=2*t,u>=.5&&(p++,u%=.5,4==p&&(p=0))}(t)},this.draw=function(){if(!b)return;let t;switch(m[E]){case n.S:t=0;break;case n.W:t=s;break;case n.E:t=2*s;break;case n.N:t=3*s}let e=p*a,i=t+d*s*4;c.clearRect(0,0,a,s),c.drawImage(o,e,i,a,s,0,0,a,s)},this.getCanvas=function(){return l},this.getId=function(){return t},this.remove=function(){$(l).remove(),l=null,_=!0}}},function(t,e,i){let n=i(67),a=i(11);t.exports=function(){let t,e,i,s,r,o,l,c,d,h,u,p,g=this,f=0,m=0,v=0,E=0,_=0,b=null,w=0,C=[a.S,a.W,a.N,a.E],T=["down","left","up","right"],y=0,I=null,A=!1,k=!1,S=null;function O(t,e){u.width=t,u.height=e}function M(t,e){return[t,()=>{b=e,L()}]}function N(t){return[t.name,()=>{var e;e=t.actionIndex,L(),R(e),S.doAction(g)}]}function R(t){I=t}function x(){return null!=I}function L(){m=0,P(0),D(0),R(null)}function D(t){_=t}function P(t){f=t}this.init=function(e){t=e,S=new n,u=document.createElement("canvas"),p=u.getContext("2d"),$(u).on("contextmenu",t=>{getE(t),function(t){var e=[];if(s){for(var i=0;i<s.length;i++){let t=N(s[i]);e.push(t)}for(let t=0;t<T.length;t++){let i=M(_t(T[t]),t);e.push(i)}(null!=b||x())&&e.push(M(_t("cancel_action_or_dir"),null)),Engine.interface.showPopupMenu(e,t)}}(t)}),O(32,48)},this.updateData=function(t){e=t.path,""!=t.actions&&(i=t.actions.split("|"),s=S.createActionsDataArrayForHero(i)),Engine.imgLoader.onload(CFG.r_ppath+e,{speed:!1,externalSource:cdnUrl},(t,i)=>{A||function(t,i){let n=new RegExp("-([0-9]+)(a?).gif").exec(e);n||(n=[0,0,""]),d=isNaN(parseInt(n[1]))?0:parseInt(n[1]),h="a"==n[2],r=t.hdr.width/(4+d+(h?1:0)),o=t.hdr.height/4,l=t.frames,c=i,O(r,o)}(i,t)},t=>{A||(k=!0)},()=>{A||errorReport("CanvasCharacterWrapper.js","loadImg","Load img error")})},this.update=function(t){!function(t){l&&l.length>1&&t&&(v+=100*t,l[m].delay<v&&(v-=l[m].delay,m=l.length==m+1?0:m+1))}(t),x()?S.updateAction(g,t):(function(t){if(x())return;if(null!=b)return void(y=b);if(w+=100*t,200>w)return;w=0,y++,y+1>C.length&&(y=0)}(t),function(t){if(x())return;E+=2*t,E>=.5&&(_++,E%=.5,_==(h?5:4)&&(_=h?1:0))}(t))},this.draw=function(){if(!k)return;let t;if(x())switch(f){case 0:t=0;break;case 1:t=o;break;case 2:t=2*o;break;case 3:t=3*o}else switch(C[y]){case a.S:t=0;break;case a.W:t=o;break;case a.E:t=2*o;break;case a.N:t=3*o}let e=_*r,i=t+m*o*4;p.clearRect(0,0,r,o),p.drawImage(c,e,i,r,o,0,0,r,o)},this.getCanvas=function(){return u},this.getId=function(){return t},this.stopAction=L,this.setRunActionIndex=R,this.getRunActionIndex=function(){return I},this.getSpecialByRunActionIndex=function(){for(let t=0;t<s.length;t++)if(s[t].actionIndex==I)return s[t].special},this.setDirIndex=function(t){y=t},this.getAnim=function(){return h},this.setFrame=D,this.getActionFrame=function(){return f},this.setActionFrame=P,this.remove=function(){$(u).remove(),u=null,A=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(103);t.exports=class{constructor(){this.windows={},this.lastOpenWindow=null,this.getEngine().items.fetch(this.getEngine().itemsFetchData.NEW_OTHER_EQ_ITEM,this.setItems.bind(this))}update(t){this.windows[t.id]||this.getEqData(t)}getEqData(t){const e=_l(),i=t.id%128,n=`https://mec.garmory-cdn.cloud/${e}/${t.world||this.getEngine().worldConfig.getWorldName()}/${i}/${t.id}.json`;fetch(n).then(t=>t.json()).then(e=>{this.newWindow(t,e)}).catch(e=>{this.newWindow(t,{})})}setItems(t){this.lastOpenWindow&&this.windows[this.lastOpenWindow]&&this.windows[this.lastOpenWindow].setItems(t)}newWindow(t,e){const i=new n.default(t);this.windows[t.id]=i,this.lastOpenWindow=t.id,i.update(e)}removeWindow(t){delete this.windows[t]}getEngine(){return Engine}}},function(t,e,i){var n=i(529);t.exports=function(){const t={},e=e=>!!t[e],i=(i,a,s,r)=>{e(i)||(t[i]=new n,t[i].init(i,a,s,r))};this.init=()=>{},this.add=i,this.remove=e=>{delete t[e]},this.close=e=>{t[e].close()},this.check=e,this.list=t,this.newPlayerProfile=t=>{let e;const n={staticUrl:!1,accountId:"",characterId:"",worldName:Engine.worldConfig.getWorldName(),contentClass:"iframe-profile-wnd",wndData:{title:_t("preview",!1,"shop")},...t};if(n.staticUrl)e=n.staticUrl.replace("#","?source=client#");else{if(""===n.accountId)throw new Error("[IframeWindowManager.js, newPlayerProfile] If you want create profile link you need provide accountId");const t=n.characterId?`#char_${n.characterId},${n.worldName}`:"";e=`https://www.margonem.pl/profile/view,${n.accountId}?source=client${t}`}i(e,n.contentClass,n.wndData)},this.newClanPage=t=>{let e;const n={staticUrl:!1,clanId:"",worldName:Engine.worldConfig.getWorldName(),contentClass:"iframe-clan-page-wnd",wndData:{title:_t("preview",!1,"shop")},...t};if(n.staticUrl)e=n.staticUrl+"?source=client";else{if(""===n.clanId)throw new Error("[IframeWindowManager.js, newClanPage] If you want create clan link you need provide clanId");e=`https://www.margonem.pl/guilds/view,${n.worldName},${n.clanId}?source=client`}i(e,n.contentClass,n.wndData)},this.integrationPage=t=>{const e={contentClass:"iframe-integration-page-wnd",wndData:{title:_t("integration")},...t};i("https://www.margonem.pl/config?source=client#inne",e.contentClass,e.wndData)}}},function(t,e,i){let n=i(0);t.exports=function(){let t,e,i,a,s;const r=(t,n,r,o)=>{e=t,i=r||{},a=n||"",s=o||function(){}},o=()=>{t.getContent().find(".main-iframe").attr("src",e)},l=()=>{let e={content:n.get("iframe-window").addClass(a),nameWindow:Engine.windowsData.name.DEPO,title:"",onclose:()=>{s(),c()}};i=$.extend(e,i),t=Engine.windowManager.add(i),t.addToAlertLayer(),t.setWndOnPeak(),t.center()},c=()=>{t.remove(),Engine.iframeWindowManager.remove(e)};this.init=(t,e,i,n)=>{r(t,e,i,n),l(),o()},this.close=c}},function(t,e,i){let n=i(3),a=i(4),s=(i(1),i(6)),r=i(131);t.exports=function(){let t="RajBattleEvents.js",e=null,i=null,o=null;const l=()=>{const e=n.TYPE;o=new a,o.init(t,{createFunc:h,removeFunc:u,checkExistFunc:f,createRequire:{external_properties:{type:e.OBJECT},npcId:{optional:!0}}},n.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID_NAME)},c=()=>{i={}},d=()=>{e={},e[r.ON_START_FIGHT_WITH_NPC]={},e[r.ON_DIE_NPC]={}},h=(t,e)=>{t.npcId=s.getCharacterData(t.npcId,e);let i=t.name,n=t.npcId,a=t.id,r=t.external_properties;E(i,n,a,r),m(a,t)},u=(t,e)=>{t.npcId=s.getCharacterData(t.npcId,e);let i=t.name,n=t.npcId,a=t.id;p(i,n,a)},p=(t,e,n)=>{if(isset(n))f(n)&&v(n);else for(let e in i){i[e].npcId==t&&v(e)}g(e,t,n)},g=(t,i,n)=>{isset(n)?delete e[t][i][n]:delete e[t][i]},f=t=>!!i[t],m=(t,e)=>{i[t]=e},v=t=>{delete i[t]},E=(t,i,n,a)=>{e[t][i]||(e[t][i]={}),e[t][i][n]=a},_=t=>{Engine.rajController.parseObject(t)};this.init=()=>{c(),d(),l()},this.updateData=(t,e)=>{if(o.checkCorrectMainData(t,e))for(let i in t.list){let n=t.list[i];o.updateData(n,e)}},this.callAllActionsBySpecificEventAndWarrior=(t,i)=>{let n=e[t][i];if(n){for(let t in n){let e=n[t];_(e)}p(i,t)}},this.onClear=()=>{c(),d()},this.isPossibleCallBattleEventsFromExternalProperties=t=>{if(!t.npc)return!1;let e=t.getOriginalId();return null!=Engine.npcs.getExternalProperties(e)}}},function(t,e){t.exports=function(){let t={fileName:"RajYellowMessage.js"};const e=e=>e.list?!!elementIsArray(e.list)||(errorReport(t.fileName,"checkCorrectData","attr list have to be array!",e),!1):(errorReport(t.fileName,"checkCorrectData","attr list not exist!",e),!1),i=e=>e.action?"CREATE"!=e.action?(errorReport(t.fileName,"checkOneCorrectData","undefined action name",e),!1):!!e.text||(errorReport(t.text,"checkOneCorrectData","attr text not exist!",e),!1):(errorReport(t.fileName,"checkOneCorrectData","attr action not exist!",e),!1),n=t=>{let e=t.text;message(e)};this.init=()=>{},this.updateData=t=>{if(!e(t))return;let a=t.list;for(let t in a){let e=a[t];if(i(e)&&Engine.rajCase.checkFullFillCase(e.case))switch(e.action){case"CREATE":n(e)}}}}},function(t,e,i){const n=i(1),a=i(533),s=i(59),r=i(3),o=i(4);t.exports=function(){let t={fileName:"RajCharacterImageChangerManager.js"},e=null,i=null,l=null,c=null,d=null;const h=()=>{i=new o;const e=r.TYPE,a=s.ORDER_DATA_KIND,l=s.KIND;i.init(t.fileName,{createFunc:p,removeFunc:v,checkExistFunc:b,createRequire:{kind:{specificVal:[l.ON_RESPAWN,l.ON_DIE,l.AFTER_DIE],optional:!0},target:{type:{name:e.TARGET,option:[n.NPC,r.TARGET_KIND.THIS_NPC_INSTANCE]}},behind:{type:e.BOOL,optional:!0},offsetX:{type:e.INT,optional:!0},offsetY:{type:e.INT,optional:!0},repeat:{type:e.INT_OR_BOOL,optional:!0},characterShow:{type:e.BOOL,optional:!0},order:{optional:!0,elementInObject:{kind:{specificVal:[a.MAP_OBJECT,a.FLOAT_OBJECT],optional:!0},v:{type:e.FLOAT,optional:!0}}}}},r.GROUP_NAME.OBJECT_WITH_LIST_ACTION_TARGET_ID)},u=(t,e,i)=>{l[e][t]=i},p=(t,e)=>{let i=t.id;w(i,t,e),g(t)},g=e=>{let i=e.list,n=e.id,a=e.target.id;const r=s.KIND;for(let s in i){let o=i[s].kind;[r.ON_RESPAWN,r.ON_DIE,r.AFTER_DIE].includes(o)?f(o,a,n):errorReport(t,"addToEvents","incorrect kind",e)}},f=(t,e,i)=>{c[t][e]||(c[t][e]={}),c[t][e][i]=!0},m=(e,i,n)=>{const a="removeFromEvent";c[e]?c[e][i]?c[e][i][n]?delete c[e][i][n]:errorReport(t.fileName,a,`id ${n} rajCharacterImage not exist`,c[e][i]):errorReport(t.fileName,a,`npcId ${i} not exist`,c[e]):errorReport(t.fileName,a,`kind ${e} event not exist`,e)},v=(e,i)=>{let a=e.id,r=C(a),o=r.data.target.id;E(a),(e=>{let i=e.list,n=e.id,a=e.target.id;const r=s.KIND;for(let s in i){let o=i[s].kind;[r.ON_RESPAWN,r.ON_DIE,r.AFTER_DIE].includes(o)?m(o,a,n):errorReport(t,"addToEvents","incorrect kind",e)}})(r.data),u(o,n.NPC,!1),I(a)},E=t=>{let e=C(t).data.list;for(let i in e){let e=A(t,i);N(e)&&x(e)}},_=()=>{T(),y(),l={NPC:{}},(()=>{const t=s.KIND;c={},c[t.ON_RESPAWN]={},c[t.ON_DIE]={},c[t.AFTER_DIE]={}})()},b=t=>!!e[t],w=(t,i,n)=>{e[t]={id:t,data:i,additionalData:n}},C=i=>b(i)?e[i]:(warningReport(t,"getById",`characterImageChanger ${i} not exist!`,e),null),T=()=>{d={}},y=()=>{e={}},I=i=>{C(i)?(t=>{delete e[t]})(i):warningReport(t.fileName,"remove",`rajCharacterImageChanger id: ${i} not exist!`)},A=(t,e)=>t+"_"+e,k=(t,e,i,n)=>{let a=C(t).data.list;for(let s in a){let r=a[s];if(i!=r.kind)continue;let o=A(t,s),l=S(i);l.updateData(o,t,r,e,n),O(o,l)}},S=t=>{const e=new a,i=s.KIND,n=[i.ON_RESPAWN,i.ON_DIE,i.AFTER_DIE].includes(t);return e.init(n),e},O=(t,e)=>{d[t]=e},M=(t,e)=>{const i=s.KIND.AFTER_DIE,n=t.getId(),a=c[i][n];if(a)for(let n in a)k(n,t,i,e)},N=t=>!!d[t],R=t=>d[t],x=t=>{delete d[t]};this.init=()=>{_(),h()},this.updateData=(t,e)=>{if(!i.checkCorrectMainData(t,e))return;let n=t.list;for(let t in n){let a=n[t];i.updateData(a,e)}},this.setCharacterHide=u,this.callAllActionsBySpecificEventAndNpc=(t,e)=>{let i=e.npcId,n=c[t][i];if(!n)return;let a=getEngine().npcs.getById(i);for(let i in n)k(i,a,t,e)},this.getDrawableList=()=>{let t=[];for(let e in d)t.push(d[e]);return t},this.removeCharacterImageGraphic=t=>{if(!N(t))return;let e=R(t),i=e.getParentId(),n=e.getKind(),a=e.getTarget();x(t);if(n==s.KIND.ON_DIE){let t=C(i);M(a,t.additionalData)}},this.checkHideObject=t=>{let e=l[t.canvasObjectType];if(e)return!!e[t.getId()]},this.update=t=>{for(let e in d)d[e].update(t)},this.onClear=_}},function(t,e,i){const n=i(59);let a=i(78);t.exports=function(){const t="RajCharacterImageGraphic.js";this.rx=null,this.ry=null,this.fh=null,this.fw=null,this.halffw=null,this.ofsetX=0,this.ofsetY=0,this.frame=0;let e,i,s,r,o,l,c,d,h,u,p,g,f=null,m=null,v=0,E=null,_=null;const b=t=>{g=new a,g.init()},w=t=>{p=t},C=()=>{B(n.DEFAULT_DATA.BEHIND),P(n.DEFAULT_DATA.ACTUAL_REPEAT),D(n.DEFAULT_DATA.REPEAT),L(n.DEFAULT_DATA.CHARACTER_HIDE)},T=()=>{getEngine().rajCharacterImageChangerManager.setCharacterHide(h.getId(),"NPC",r)},y=(t,e)=>{Engine.imgLoader.onload(t,{speed:!1,externalSource:cdnUrl},(t,i)=>{let n=I(i,t,e);this.fw=n.fw,this.fh=n.fh,this.halffw=n.halffw,f=n.frames,m=0,H(n.image)},t=>{k(t)},()=>{A()})},I=(t,e,i)=>{let n=t.hdr.width;return{fw:n/i,fh:t.hdr.height/i,halffw:n/2/i,frames:t.frames,image:e}},A=()=>{errorReport(t,"fetchError","Error fetch error :"+i)},k=t=>{H(t),G(!0)},S=()=>{h.getOnloadProperImg()&&(u||O(h.getSprite()))},O=t=>{u=t},M=t=>{p&&!r&&h.drawIcon(t,!0)},N=t=>{v+=100*t,f[m].delay>v||(v-=f[m].delay,f.length==m+1?(m=0,U()):m++)},R=t=>{i=t},x=t=>{s=t},L=t=>{r=t},D=t=>{l=t},P=t=>{o=t},B=t=>{e=t},F=t=>{c=t},W=t=>{d=t},$=t=>{h=t},H=t=>{E=t},G=t=>{_=t},V=t=>{let e=CFG.tileSize,i=CFG.halfTileSize,n=this.fw,a=this.fh,s=this.halffw,r=this.frame*n,o=getEngine().mapShift.getShift(),l=i-s,c=Math.round(this.rx*e+l+this.ofsetX-(Engine.map.offset[0]-o[0])),d=Math.round(this.ry*e-a+e+this.ofsetY-(Engine.map.offset[1]-o[1])),h=Engine.map.clipObject(c,d,n,a);h&&t.drawImage(E,r+h.backgroundPositionX,0+m*a*1+h.backgroundPositionY,h.width,h.height,h.left,h.top,h.width,h.height)},U=()=>{!0!==l&&(P(o+1),o!=l||j())},j=()=>{r&&(L(!1),h.resetActiveFrame()),T(),getEngine().rajCharacterImageChangerManager.removeCharacterImageGraphic(d)};this.init=t=>{b(),C(),w(t),G(!1)},this.updateData=(t,e,n,a,s)=>{if($(a),W(t),F(e),x(n.kind),R(n.url),isset(n.characterShow)&&L(!n.characterShow),isset(n.repeat)&&D(n.repeat),isset(n.behind)&&B(n),isset(n.external_properties)&&Engine.rajController.parseObject(n.external_properties,!1,s),isset(n.order)){let t=n.order;g.checkCorrectData(t)&&g.setOrderData(t)}y(CFG.r_rajGraphics+i,1),T(),S()},this.update=t=>{_&&(this.rx=h.getX(),this.ry=h.getY(),N(t)),S()},this.draw=t=>{e||M(t),_&&V(t),e&&M(t)},this.getOrder=()=>g.getOrder(this.ry),this.getKind=()=>s,this.getParentId=()=>c,this.getTarget=()=>h}},function(t,e,i){var n=i(75);let a=i(3),s=i(4),r=i(6);t.exports=function(){let t="RajMapEvents.js",e=null,i=null,o=null;const l=()=>{const e=a.TYPE;o=new s,o.init(t,{createFunc:h,removeFunc:u,checkExistFunc:f,createRequire:{external_properties:{type:e.OBJECT},npcId:{type:e.INT_OR_GET_CHARACTER_DATA},name:{specificVal:[n.ON_DIE_NPC,n.ON_RESPAWN_NPC]}}},a.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID_NAME)},c=()=>{i={}},d=()=>{e={},e[n.ON_DIE_NPC]={},e[n.ON_RESPAWN_NPC]={}},h=(t,e)=>{t.npcId=r.getCharacterData(t.npcId,e);let i=t.name,n=t.npcId,a=t.id,s=t.external_properties;E(i,n,a,s),m(a,t)},u=(t,e)=>{t.npcId=r.getCharacterData(t.npcId,e);let i=t.name,n=t.npcId,a=t.id;p(n,i,a)},p=(t,e,n)=>{if(isset(n))f(n)&&v(n);else for(let e in i){i[e].npcId==t&&v(e)}g(e,t,n)},g=(t,i,n)=>{isset(n)?delete e[t][i][n]:delete e[t][i]},f=t=>!!i[t],m=(t,e)=>{i[t]=e},v=t=>{delete i[t]},E=(t,i,n,a)=>{e[t][i]||(e[t][i]={}),e[t][i][n]=a},_=(t,e)=>{Engine.rajController.parseObject(t,[],e)};this.init=()=>{c(),d(),l()},this.updateData=(t,e)=>{if(o.checkCorrectMainData(t,e))for(let i in t.list){let n=t.list[i];o.updateData(n,e)}},this.callAllActionsBySpecificEventAndNpc=(t,i)=>{let n=i.npcId,a=e[t][n];if(a){for(let t in a){let e=a[t];_(e,i)}p(n,t)}},this.onClear=()=>{c(),d()}}},function(t,e,i){let n=i(3),a=i(4),s=i(123);t.exports=function(){let t="RajWindowEvents.js",e={},i=null,r=null;const o=()=>{const e=n.TYPE;r=new a,r.init(t,{createFunc:d,removeFunc:h,checkExistFunc:g,createRequire:{external_properties:{type:e.OBJECT},windowName:!0}},n.GROUP_NAME.OBJECT_WITH_LIST_ACTION_ID_NAME)},l=()=>{i={}},c=()=>{e[s.ON_OPEN]=[],e[s.ON_UPDATE]=[],e[s.ON_FIRST_UPDATE]=[]},d=(t,e)=>{let i=t.name,n=t.id,a=t.windowName,s=t.external_properties;v(i,a,n,s),f(n,t)},h=(t,e)=>{let i=t.name,n=t.windowName,a=t.id;u(i,n,a)},u=(t,e,n)=>{for(let t in i)t==n&&m(n);p(t,e,n)},p=(t,i,n)=>{isset(n)?e[t][i]?e[t][i][n]?(delete e[t][i][n],0==lengthObject(e[t][i])&&delete e[t][i]):errorReport("RajWindowEvents.js","removeActionFromEvent",`id ${n} not exist`,e[t][i]):errorReport("RajWindowEvents.js","removeActionFromEvent",`windowName ${i} not exist`,e[t]):delete e[t][i]},g=t=>!!i[t],f=(t,e)=>{i[t]=e},m=t=>{delete i[t]},v=(t,i,n,a)=>{e[t][i]||(e[t][i]={}),e[t][i][n]=a},E=t=>{Engine.rajController.parseObject(t)};this.init=()=>{l(),c(),o()},this.updateData=(t,e)=>{if(r.checkCorrectMainData(t,e))for(let i in t.list){let n=t.list[i];r.updateData(n,e)}},this.onClear=()=>{l(),c()},this.callAllActionsBySpecificEventAndWindowName=(t,i)=>{let n=e[t][i];if(n)for(let e in n){let a=n[e];E(a),u(t,i,e)}}}},function(t,e,i){var n=i(0);let a=i(14);var s=i(537),r=i(539),o=i(83),l=i(0),c=i(541),d=i(542),h=i(52),u=i(39);let p=i(543);const g=i(551);var f=i(8);const m=i(15),v=i(552);t.exports=function(){var t,e,i,E,_,b,w,C,T,y,I,A,k,S,O,M,N,R,x=this,L=!1,D=!1,P=null,B=!1,F=!0,W=null,H=null,G=null,V=null,U=null;let j=null,q=null,K=null,Y=null,z=null;this.zoomMode=!1;let X={width:0,height:0,scale:0},Q=null,J=[{name:"small",height:82},{name:"normal",height:200},{name:"big",height:260},{name:"veryBig",height:340}];var Z=[_t("deep_wound",null,"buff"),_t("wound",null,"buff"),_t("critical_deep_wound",null,"buff"),_t("poisoned",null,"buff"),_t("fire",null,"buff"),_t("swow_down",null,"buff"),_t("speed_up",null,"buff"),_t("frostbite",null,"buff"),_t("shock",null,"buff")],tt={sw:_t("w_bastard",null,"battle"),"1h":_t("w_onehanded",null,"battle"),"2h":_t("w_twohanded",null,"battle"),bs:_t("w_bastard",null,"battle"),dis:_t("w_distance",null,"battle"),h:_t("w_helper",null,"battle"),"icon-6":_t("w_wand",null,"battle"),orb:_t("w_rod",null,"battle"),sh:_t("w_shield",null,"battle"),fire:_t("w_fire",null,"battle"),light:_t("w_light",null,"battle"),frost:_t("w_frost",null,"battle"),poison:_t("w_poison",null,"battle"),phydis:_t("w_phydis",null,"battle"),wound:_t("w_wound",null,"battle")},et={"icon-1":_t("w_onehanded",null,"eq_w"),"icon-2":_t("w_twohanded",null,"eq_w"),"icon-3":_t("w_bastard",null,"eq_w"),"icon-4":_t("w_distance",null,"eq_w"),"icon-5":_t("w_helper",null,"eq_w"),"icon-6":_t("w_wand",null,"eq_w"),"icon-7":_t("w_rod",null,"eq_w"),"icon-14":_t("w_shield",null,"eq_w"),"icon-fire":_t("w_fire",null,"eq_w"),"icon-light":_t("w_light",null,"eq_w"),"icon-frost":_t("w_frost",null,"eq_w"),"icon-poison":_t("w_poison",null,"eq_w"),"icon-phydis":_t("w_phydis",null,"eq_w"),"icon-wound":_t("w_wound",null,"eq_w"),"icon-weapon":_t("w_weapon",null,"eq_w")},it={"002.jpg":"m15.jpg","003.jpg":"m17.jpg","004.jpg":"m13.jpg","005.jpg":"m10.jpg","006.jpg":"m10.jpg","007.jpg":"m11.jpg","07n.jpg":"m11.jpg","008.jpg":"m13.jpg","009.jpg":"m9.jpg","010.jpg":"m8.jpg","011.jpg":"m5.jpg","012.jpg":"m7.jpg","013.jpg":"m18.jpg","014.jpg":"m6.jpg","015.jpg":"m14.jpg","018.jpg":"m2.jpg","019.jpg":"m1.jpg","19n.jpg":"m1.jpg","021.jpg":"m5.jpg","027.jpg":"m4.jpg","27n.jpg":"m17.jpg","032.jpg":"m3.jpg","033.jpg":"m2.jpg","034.jpg":"m1.jpg","035.jpg":"m11.jpg","35n.jpg":"m11.jpg","aa1.jpg":"m16.jpg","aa2.jpg":"m16.jpg","bb.jpg":"m16.jpg","cc1.jpg":"m14.jpg","cc2.jpg":"m14.jpg","dd1.jpg":"m12.jpg","dd2.jpg":"m16.jpg","dd3.jpg":"m16.jpg","dd4.jpg":"m18.jpg","j.jpg":"m15.jpg","ee.jpg":"m15.jpg","f.jpg":"m15.jpg","g.jpg":"m15.jpg","h.jpg":"m15.jpg","i.jpg":"m12.jpg","k.jpg":"m15.jpg","l.jpg":"m15.jpg","matchmaking.jpg":"matchmaking.jpg","36.jpg":"m24.jpg","37.jpg":"m26.jpg"};this.getfirstLogsExist=()=>K,this.getIconTips=()=>et,this.isOneStepId=t=>t==u.specificSkills.ONE_STEP_ID,this.isNormalAttackId=t=>t==u.specificSkills.NORMAL_ATTACK_ID,this.changeIconRegToTextReg=t=>{let e=this.getIconTips();for(let i in e)if(t.search('"'+i+'"')>-1)return'<span class="weapon-require">'+e[i]+"</span>";return t},this.initVariable=function(){t=!1,!0,e={1:[],2:[]},i=null,S=[],Y=null,N=[],E=2,O=[],M=[],this.takenQueue={},this.warriorsList={},this.forumLog=[],this.w_amount=0,this.isAuto=!1,this.myteam=null,this.endBattle=!1,this.endBattleForMe=!1,this.canLeaveBattle=!1,this.selectedWarriorID=null,this.showedSkills=null,this.heroMana=null,this.heroEnergy=null,this.show=!1,nt(!0)},this.init=function(){this.initVariable(),this.initBattleWindow(),this.initBattleController(),this.initObjects(),this.setPredictionScrollbar(),this.zoomMode||A.css("transform","translateX(-50%)"),j=new v,j.init(),U=T[0].querySelector(".turn-prediction")},this.getFlist1=()=>O,this.getFlist2=()=>M,this.getTeamIDs=()=>e,this.initProgressBars=function(){var t=T.find(".stats-wrapper");this.createProgressBar(t,"hp-progress-bar red"),this.createProgressBar(t,"ep-progress-bar yellow"),this.createProgressBar(t,"mp-progress-bar blue")},this.initObjects=function(){this.skillBattleMenu=new c,this.warriors=new s,this.scaleBattle=new d,this.battleEffectsController=new p,this.battleEffectsController.init(),this.battleNight=new g,this.battleNight.init(),this.warriors.init(),(k=new r).init()},this.addAttackToBattleSkills=t=>{S[u.specificSkills.NORMAL_ATTACK_ID]={id:u.specificSkills.NORMAL_ATTACK_ID,name:_t("normal_atack",null,"skills"),attr:"",cost:"-",require:"",regs:"",lvl:"1/1",kind:"",hotSlot:t,currentStatsIndex:0,allStats:["norm-atack=1"]}},this.addOneStepToBattleSkills=t=>{S[u.specificSkills.ONE_STEP_ID]={id:u.specificSkills.ONE_STEP_ID,name:_t("step",null,"skills"),attr:"",cost:"-",require:"",regs:"",lvl:"1/1",kind:"",hotSlot:t,currentStatsIndex:0,allStats:["step=1"]}},this.getBattleMessageShow=()=>k.getShow(),this.update=e=>{let n=!isset(e.close);if(isset(e.init)&&(x.setDateTime(),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,5),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,5),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,15),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,15),this.closeOtherWindows()),e.skills_disabled&&x.setSkillsDisabled(e.skills_disabled),isset(e.myteam)&&(x.myteam=e.myteam),isset(e.start_move)&&(i=e.start_move)<15&&n&&Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,7),isset(e.move)&&(e.move<0?(x.setEndBattleForMe(),n&&Engine.tutorialManager.tutorialStart(CFG.LANG.PL,8)):x.setIntervalMove(e.move)),isset(e.endBattle)&&e.endBattle&&this.setEndBattle(),isset(e.skills)){var a=-1;S=[],R=!1;for(var s=0;s<e.skills.length;s+=10){var r=parseInt(e.skills[s]);a++,0!=r&&(a>7&&(R=!0),x.isNormalAttackId(r)?x.addAttackToBattleSkills(a):x.isOneStepId(r)?x.addOneStepToBattleSkills(a):S[r]={id:r,name:e.skills[s+1],attr:e.skills[s+2],cost:x.getFormCost(e.skills[s+8]),require:x.getRequire(e.skills[s+1],e.skills[s+6]),regs:e.skills[s+6],lvl:e.skills[s+7],stats:e.skills[s+8],kind:e.skills[s+9],hotSlot:a,currentStatsIndex:0,allStats:[e.skills[s+8]]})}R?T.addClass("with-skills"):T.removeClass("with-skills"),x.showSkills(),x.setButtonsClass()}if(isset(e.w)&&(x.updateWarriors(e.w),x.updateAutoButton(),x.updateCanLeaveBattle()),isset(e.current)&&x.setCurrent(e.current),isset(e.battleground)&&x.updateBattleground(e.battleground),isset(e.skills_combo_max)&&x.updatecomboSkillsMax(e.skills_combo_max),isset(e.m)){if(K=!0,x.newTurn(e.current),this.takenQueue={},isset(e.init)&&"1"==e.init){let t=this.joinStrFromObjects(O,"str",", "),e=this.joinStrFromObjects(M,"str",", ");k.reload(t,e)}for(var s in e.m)k.battleMsg(e.m[s],!t,e.m,s);x.onResize(),x.selectedWarriorID&&x.infoUpdate()}if(isset(e.turns_warriors)&&x.turnPredictionUpdateAnimation(e.turns_warriors),isset(e.close))x.close(e);else{if(e.init){let t=x.warriors.checkAllWarriorsProperWarriorImageLoaded();nt(t)}isset(e.w)&&"1"!=e.init&&Engine.battle.battleNight.rebuildBattleNight(),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,6,e),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,6,e)}},this.getFormCost=t=>{if(""==t)return"";let e=t.split(";"),i={};for(let t in e){let n=e[t].split("=");i[n[0]]=n[1]}return isset(i.energy)?i.energy.replace(/\*c?plvl/,"")+"e":isset(i.mana)?i.mana.replace(/\*c?plvl/,"")+"m":""},this.setButtonsClass=()=>{const t=$(".buttons-wrapper .button");R?t.addClass("square"):t.removeClass("square")},this.setSkillsDisabled=t=>{Y=t},this.checkDisabled=t=>Y.includes(parseInt(t)),this.getRequire=(t,e)=>{if(""==e)return e;let i,n=e.split(";");for(let t in n){let e=n[t].split("=");if("reqw"==e[0]){i=e[1];break}}return i||""},this.turnPredictionUpdateAnimation=t=>{$(U).animate({opacity:0},"fast",(function(){x.updateTurnPredictions(t),$(this).animate({opacity:1},"fast")}))},this.updateTurnPredictions=t=>{U.innerHTML="",j.clear();for(let e in t){const i=t[e],n=l.get("turn-prediction__item")[0],a=n.querySelector(".turn-prediction__name"),s=n.querySelector(".turn-prediction__av"),r=this.getWarriorType(i),o=x.warriorsList[i];if(!r)return;switch(r){case 1:a.classList.add("turn-prediction__name--green");break;case 2:a.classList.add("turn-prediction__name--blue");break;case 3:a.classList.add("turn-prediction__name--red")}a.innerHTML=parseContentBB(o.name),this.createAvatar(s,o.icon,o.npc),j.appendWarrior(n,o.icon,o.npc),U.append(n)}V.trigger("update"),j.updateScrollbar()},this.setPredictionScrollbar=()=>{(V=T.find(".right-column .scroll-wrapper")).addScrollBar({track:!0})},this.createAvatar=(t,e,i)=>{const n=i?CFG.a_npath:CFG.a_opath,a=i?"cover":"400% 400%";createImgStyle($(t),n+e,{height:"28px",width:"32px",sprite:!i},{"background-size":a},32)},this.getWarriorType=t=>{const e=Engine.hero.d.id;if(!isset(x.warriorsList[e]))return!1;const i=x.warriorsList[e],n=x.warriorsList[t];let a=2;return e==t?a=1:n.team!=i.team&&(a=3),a},this.getWarrior=t=>this.warriorsList[t],this.updateAutoButton=function(){var t=Engine.hero.d.id,e=isset(x.warriorsList[t])&&x.warriorsList[t].fast<1;x.setVisibleAutofight(e)},this.updateCanLeaveBattle=function(){var t=x.canLeaveBattle,e=Engine.hero.d.id,i=isset(x.warriorsList[e]);x.canLeaveBattle=i&&0===x.warriorsList[e].hpp,t!==x.canLeaveBattle&&x.showPanelActionsButs()},this.updatecomboSkillsMax=function(t){for(var e=0;e<t.length;e++){for(var i=t[e],n=l.get("combo-wrapper"),a=i[1],s=0;s<a;s++){var r=l.get("combo-point"),o="";o=1==a?"all":0==s?"left":s+1==a?"right":"middle",r.addClass(o),n.append(r)}Engine.interface.get$interfaceLayer().find(".bottom.positioner").find(".icon-"+i[0]).parent().append(n)}x.setComboPointsOnSkill()},this.getBattleController=function(){return T},this.getComboPoints=function(){return W},this.setComboPoints=function(t){W=t},this.setComboPointsOnSkill=function(){var t=Engine.interface.get$interfaceLayer().find(".bottom.positioner").find(".combo-wrapper"),e=Engine.interface.get$popUpLayer().find(".menu-item").find(".combo-wrapper");this.manageComboPoits(t),this.manageComboPoits(e)},this.manageComboPoits=function(t){t.each((function(){$(this).find(".combo-point").removeClass("active");for(var t=0;t<W;t++)$(this).children("").eq(t).addClass("active")}))},this.setCurrent=function(t){var e=x.warriorsList[t];if(e){var i=e.$.find(".current-arrow");if(Engine.party&&(Engine.party.get$Wnd().find(".blink").removeClass("blink"),Engine.party.get$Wnd().find(".other-party-id-"+t).find(".border-blink").addClass("blink")),i.length<1){var n=l.get("current-arrow");x.$.find(".current-arrow").remove(),e.$.append(n),Engine.imgLoader.onload("/img/emo/battle.gif",!1,!1,t=>{x.setCanvasArrow(t)})}}},this.setCanvasArrow=function(t){let e=$("<canvas>").attr({width:"16px",height:"16px"});e[0].getContext("2d").drawImage(t,0,0);let i=e[0].toDataURL();x.$.find(".canvas-arrow").css({background:"url("+i+")"})},this.animateUpAndDown=function(t,e){var i="-"==e?"+":"-";t.animate({top:e+"=6"},500,(function(){x.animateUpAndDown(t,i)}))},this.infoUpdate=function(){Object.keys(x.warriorsList).length&&x.selectedWarriorID&&x.warriorsList[x.selectedWarriorID].hpp>0&&x.clickCharacter(x.selectedWarriorID,{type:"focus",preventDefault:function(){}})},this.updateData=function(e,i){if(!isset(e.close)||isset(e.init)||this.isBattleShow()){var n=!t;if(isset(e.auto)&&(x.isAuto=parseInt(e.auto),(L=x.isAuto)&&(q=!0)),n&&(x.hideBattleLog(),x.showBattlePanel(),x.setComboPoints(null),x.skillBattleMenu.removeAllCooldown(),Engine.hero.markOtherObj&&Engine.hero.markOtherObj.deleteRedMark()),!x.show&&!x.isAuto){Engine.hero.markOtherObj=null,t=!0,x.show=!0;const n=isset(e.init)&&e.init,a=isset(i.loot)&&isset(i.loot.init),s=isset(Engine.loots)&&Engine.loots.wnd.isShow();n&&a||!s||Engine.loots.deleteItemsAndCloseLootWindow()}isset(e.init)&&e.init&&x.callCheckCanFinishExternalTutorialStartBattle(),x.update(e),n&&(q=!1,L&&(q=!0),F=!0,!0,at(),x.battleNight.rebuildBattleNight(),x.clearMarkWarior(),x.setFirstMarkObj(),x.newTurn(e.current),x.showPanelActionsButs(),V.trigger("scrollTop"),"1"==e.auto&&x.callCheckCanFinishExternalTutorialHeroEndBattle())}},this.setWatchPosition=function(){},this.updateBattleground=function(t){let e=x.$.find(".battle-background");var i=it[t]?it[t]:t.replace(/si/g,"ni"),n=CFG.a_bpath+i;"matchmaking.jpg"==i&&(n="img/bg-match/matchmaking.jpg"),e.css("transform","translate(-50%,-50%) scale(2.0)"),Engine.imgLoader.onload(n,null,null,t=>{e.css("background","url("+t.src+")"),x.onResize()})},this.joinStrFromObjects=(t,e,i)=>{let n=[];for(let i in t)n.push(t[i][e]);return n.join(i)},this.updateWarriors=function(t){if(!e[1].length){for(var i in t){e[t[i].team].push(i);let n={id:i,name:t[i].name,lvl:t[i].lvl,prof:t[i].prof,str:t[i].name+"("+t[i].lvl+t[i].prof+")"};2!=t[i].team?O.push(n):M.push(n)}let n=this.joinStrFromObjects(O,"str",", "),a=this.joinStrFromObjects(M,"str",", ");k.open(),k.clear(),k.battleMsg("0;0;txt="+_t("battle_starts_between %grp1% %grp2%",{"%grp1%":n,"%grp2%":a})),j.show()}var n=t;for(var a in n){t.init&&x.w_amount++,n[a].id=parseInt(a);var s=n[a];x.warriors.update(s,x.isAuto)}var r=x.warriors.getLines();x.warriors.resetStartSideLines();for(var o=x.warriors.getStartSideLines(),l=0;l<r.length;l++)for(var c=r[l],d=0;d<c.length;d++){var h=c[d];h.sideLeft=d<c.length/2;var u=x.getAlive(h);h.sideLeft?u&&(o[l].firstLeft=d):null==o[l].firstRight&&u&&(o[l].firstRight=d)}const p=x.warriors.getDieMob();!1!==p&&p==Engine.battle.getMarkObject()&&(Engine.battle.clearMarkWarior(),Engine.battle.setFirstMarkObj())};const nt=t=>{z=t};this.getAllProperWarriorImageLoaded=()=>z,this.leaveTimeout=function(){D||x.leaveBattle(),D=!0,setTimeout((function(){D=!1}),2e3)},this.newTurn=function(t){B=t==Engine.hero.d.id,x.clearYourTurnTimeout(),B&&(H=setTimeout((function(){var t=Engine.soundManager;t.getStateSoundNotifById(7)||t.createNotifSound(8)}),5e3))},this.clearYourTurnTimeout=function(){H&&(clearTimeout(H),H=null)},this.setEndBattleForMe=function(){if(!x.endBattleForMe){if(x.endBattleForMe=!0,x.canLeaveBattle=!0,x.clearYourTurnTimeout(),x.clearIntervalMove(),API.callEvent(Engine.apiData.SHOW_CLOSE_BATTLE),x.isAuto)return;x.$.find(".current-arrow").css("display","none"),x.showPanelActionsButs(),x.updateMoveTime(0),Engine.party&&Engine.party.get$Wnd().find(".blink").removeClass("blink"),x.callCheckCanFinishExternalTutorialHeroEndBattle()}},this.setEndBattle=()=>{this.endBattle=!0},this.clearIntervalMove=()=>{null!=G&&clearInterval(G)},this.setIntervalMove=t=>{let e=t;x.clearIntervalMove(),x.updateMoveTime(e),G=setInterval(()=>{e--,-1!==e?x.updateMoveTime(e):x.clearIntervalMove()},1e3)},this.updateMoveTime=t=>{const e=_t("sec",null,"battle");if(x.isAuto)return w.hasClass("too-close")&&w.removeClass("too-close"),!1;const n=!i||t<0?0:t/i*100;!isset(t)||t>_?(setPercentProgressBar(b,n),!0):setPercentProgressBar(b,n),C.html((x.endBattleForMe?0:t)+" "+e),t<=5&&!x.endBattleForMe&&B&&!L?w.hasClass("too-close")||w.addClass("too-close"):w.hasClass("too-close")&&w.removeClass("too-close"),_=t},this.autoActionAfterTimeOnTurn=function(){var t=Engine.hero.d.id;if(t!=P&&isset(x.warriorsList[t])){var e=x.warriorsList[t],i=x.warriorsList[P],n=1;if(i==e?n=0:i.team!=e.team&&(n=2),!(1==n)){var s=e.y,r=i.y,o=Engine.hero.d.prof,l=o==a.TRACKER||o==a.HUNTER,c=o==a.MAGE,d=!(r-s<2),h=this.huntersCanAttack(l,d),u=this.mageCanAttack(c,d);h||u?_g("fight&a=strike&id="+P):d?_g("fight&a=move"):_g("fight&a=strike&id="+P)}}},this.createButton=function(t,e,i,a){var s=n.get("button").addClass("green");s.find(".label").text(e),i=R?i+" square":i,s.addClass(i),s.click(a),t.append(s)},this.addControlButtons=function(){var t=[_t("quick_battle",null,"battle"),_t("copy-battle-logs",null,"battle"),_t("change_target_battle",null,"battle"),_t("battle_logs",null,"battle"),_t("battle_leave",null,"battle"),_t("close_logs",null,"battle"),_t("surrender",null,"battle")],e=T.find(".buttons-wrapper");T.find(".surrender").click(()=>{_g("fight&a=surrender")}).tip(_t("surrender",null,"battle")),x.createButton(e,t[0],"auto-fight-btn small",(function(){x.canAutoFight()})),x.createButton(e,t[1],"copy-battle-logs small",(function(){k.copyForumLog(),mAlert(_t("copyToClipboard",null,"battle"))})),x.createButton(e,t[4],"close-battle-ground small",(function(){x.canLeave()})),x.createButton(e,t[5],"close-battle-logs small",(function(){x.hideBattleLog()})),x.createButton(e,t[2],"change-target-btn small",(function(){x.selectWarrior(!0)})),T.find(".toggle-battle").click(x.toggleBattlePanel),T.find(".attach-battle-log-help-window").click((function(){k.toggleAttachBattleLogHelpWindow()})),T.find(".attach-battle-prediction-help-window").click((function(){j.toggleAttach()}))},this.showPanelActionsButs=function(){var t=x.canLeaveBattle;t||(t=x.endBattleForMe);var e=!t,i=e?"":"none",n=e?"none":"",a=T.find(".surrender");Engine.worldConfig.getHardcore()||a.css("display","inline-block"),T.find(".change-target-btn").css("display",i),x.setVisibleAutofight(e),T.find(".battle-end-layer").css("display",n),T.find(".copy-battle-logs").css("display",n),T.find(".close-battle-ground").css("display",n),t&&T.find(".close-battle-logs").css("display","none")},this.setVisibleAutofight=function(t){var e=!t||x.endBattleForMe||x.canLeaveBattle?"none":"";T.find(".auto-fight-btn").css("display",e),e=""!==e||Engine.worldConfig.getHardcore()?"none":e;var i=T.find(".surrender");"none"!=i.css("display")&&i.css("display",e)},this.createProgressBar=function(t,e,i){var n=l.get("progress-bar-wrapper").addClass(e);i&&n.find(".label").html(i),n.css("display","none"),t.append(n)},this.deleteWarrior=function(t){for(var i=e[2],n=0;n<i.length;n++){if(i[n]==t){i.splice(n,1);break}}for(;N.length;)N.pop()},this.setDateTime=function(){T.find(".battle-watch").html(ut_fulltime(ts()/1e3))},this.selectWarrior=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=Engine.battle,i=e.getMarkObject(),n=this.warriors.getLines(),a=e.warriorsList[i].y,s=t?this.getNextAliveById(n[a],i):this.getNextAliveById(n[a],i,!0);if(i==s){a=this.getNextLine(n,t,a);for(var r=0;r<n.length;r++){var o=this.getFirstAliveIdChar(n[a],!t);if(o)return void x.setClickOnNewTarget(null,null,o);a=this.getNextLine(n,t,a)}}else x.setClickOnNewTarget(null,null,s)},this.getNextLine=(t,e,i)=>(e?i>t.length-1?i=0:i++:i<0?i=t.length-1:i--,i),this.getMarkObject=function(){return P},this.lookForPosMarkWarrior=function(t){null==P&&(P=Engine.hero.d.id),t||(t=Engine.battle.warriors.getLines());for(var e=0;e<t.length;e++){var i=t[e];for(var n in i)if(i[n].id==P)return{x:n,y:e}}},this.clearMarkWarior=function(){P=null},this.getPosMarkObject=function(t,e){var i=Engine.battle.warriors.getLines(),n=x.lookForPosMarkWarrior(i);if(n){if(t&&e)return console.warn("[Battle.js, getPosMarkObject] TARGET CHANGE TWO AXIS!!!"),!1;if(e){if(e>0){for(var a=n.y+1;a<i.length;a++){if(x.checkInThisRowEnemyAlive(i[a])){var s=x.getNearestXAfterChangeLine(i,a,n.x,n.y);return x.setClickOnNewTarget(s,a),!0}}return!1}for(a=n.y-1;a>-1;a--){if(x.checkInThisRowEnemyAlive(i[a])){s=x.getNearestXAfterChangeLine(i,a,n.x,n.y);return x.setClickOnNewTarget(s,a),!0}}return!1}if(t){var r=i[n.y],o=n.x,l=n.y;if(!x.checkInThisRowEnemyAlive(r))return!1;var c=t<0&&t?x.getPrevAliveChar(r,o):x.getNextAliveChar(r,o);return x.setClickOnNewTarget(c,l),o!=c}}},this.setFirstMarkObj=function(){x.warriors.setDieMob(!1),this.getPosMarkObject(-1,0)||this.getPosMarkObject(1,0)||this.getPosMarkObject(0,1)||this.getPosMarkObject(0,-1)},this.setClickOnNewTarget=function(t,e,i){var n;n=i||Engine.battle.warriors.getLines()[e][t].id;x.clickCharacter(n,{type:"focus",preventDefault:function(){}})},this.checkInThisRowEnemyAlive=function(t){var e=x.warriorsList[Engine.hero.d.id];for(var i in t)if(x.getAlive(t[i])&&t[i].team!==e.team)return!0;return!1},this.getFirstAliveIdChar=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===t)return null;for(var i in e&&(t=[...t]).reverse(),t){var n=x.getAlive(t[i]);if(n)return t[i].id}return null},this.getNextAliveById=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=null;for(var a in i&&(t=[...t]).reverse(),t){var s=t[a],r=s.id,o=x.getAlive(s);if(n&&o)return r;r==e&&(n=!0),o&&r}return e},this.getNextAliveChar=function(t,e){var i=null;for(var n in t){var a=x.getAlive(t[n]);if(i&&a)return n;n==e&&(i=!0),a&&n}return e},this.getPrevAliveChar=function(t,e){var i=null;for(var n in t){var a=x.getAlive(t[n]);if(n==e&&i)return i;a&&(i=n)}return e},this.getAlive=function(t){var e=x.warriorsList[Engine.hero.d.id];return t==e?0:t.team!=e.team&&2,t.hpp>0},this.getNearestXAfterChangeLine=function(t,e,i,n){var a=t[e],s=t[n],r=s[i],o=r.sideLeft,l=r.id,c=null,d=s.length,h=0;if(o){for(var u=d-1;u>-1;u--)if(s[u].sideLeft&&h++,s[u].id==l){c=h;break}}else for(u=0;u<d;u++)if(s[u].sideLeft||h++,s[u].id==l){c=h;break}d=a.length;h=0;var p=null;if(o){for(u=d-1;u>-1;u--){var g=x.getAlive(a[u]);if(a[u].sideLeft&&g&&(h++,p=u),h==c)break}return 0==h&&(p=x.warriors.getStartSideLines()[e].firstRight),p}for(u=0;u<d;u++){g=x.getAlive(a[u]);if(!a[u].sideLeft&&g&&(h++,p=u),h==c)break}return 0==h&&(p=x.warriors.getStartSideLines()[e].firstLeft),p},this.manageKindWarriorShowed=function(t){if(E!=t){for(;N.length;)N.pop();E=t}},this.getSkillName=t=>S[t]?S[t].name:null,this.getSkill=function(t,e,i,a,s){var r=n.get("battle-skill");x.isOneStepId(a)&&r.find(".background").addClass("move-skill-bck"),this.setSkillTip(r,t,i,a),i&&x.setManaOrEnergySkill(r,i),s&&r.addClass("require");var o="skill-icon "+_l()+" icon-"+a;return r.attr("battle-skill-id",a),r.find(".icon").addClass(o),r.click((function(){x.endBattleForMe||(x.callCheckCanFinishExternalTutorialUseBattleSkill(a),x.sendRequest(r,e,a))})),r},this.callCheckCanFinishExternalTutorialUseBattleSkill=t=>{let e=Engine.tutorialManager.createTutorialDataTrigger(f.ON_FINISH_REQUIRE.USE_BATTLE_SKILL,f.ON_FINISH_TYPE.REQUIRE,t);Engine.tutorialManager.checkCanFinishExternalAndFinish(e)},this.callCheckCanFinishExternalTutorialHeroEndBattle=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(f.ON_FINISH_ABSOLUTE_FINISH.HERO_END_BATTLE,f.ON_FINISH_TYPE.ABSOLUTE_FINISH,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.callCheckCanFinishExternalTutorialHeroLeaveBattleButtonOrHotkey=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(f.ON_FINISH_REQUIRE.HERO_LEAVE_BATTLE_BUTTON_OR_HOTKEY,f.ON_FINISH_TYPE.REQUIRE,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.callCheckCanFinishExternalTutorialCloseBattleWindow=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(f.ON_FINISH_ABSOLUTE_FINISH.CLOSE_BATTLE_WINDOW,f.ON_FINISH_TYPE.ABSOLUTE_FINISH,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.callCheckCanFinishExternalTutorialStartBattle=()=>{let t=Engine.tutorialManager.createTutorialDataTrigger(f.ON_FINISH_ABSOLUTE_FINISH.START_BATTLE,f.ON_FINISH_TYPE.ABSOLUTE_FINISH,!0);Engine.tutorialManager.checkCanFinishExternalAndFinish(t)},this.setSkillTip=function(t,e,i,n){h.setSkillTip(t,S[n])},this.getGroupById=t=>{for(let e in O)if(O[e].id==t)return O;for(let e in M)if(M[e].id==t)return M;return errorReport("Battle.js","getGroupById",`id ${t} not exist in flist1 and flist2`,[O,M]),[]},this.getBattleSkillType=t=>t.search("e")>-1?"e":t.search("m")>-1?"m":(console.error("[Battle.js, getBattleSkillType] Bad type off skill:",t),""),this.manageUseSkillAnimation=function(t){Engine.opt(8)?setTimeout((function(){t.remove()}),200):t.fadeOut("slow",(function(){$(this).remove()}))},this.sendRequest=function(t,e,i){var n=e+(x.isOneStepId(i)?"":P),a=(t.position().left,Engine.zoomFactor,l.get("after-use-skill")),s=t.hasClass("disabled");if(t.parent().append(a),x.manageUseSkillAnimation(a),s){if(t.hasClass("die")&&message(_t("bad-target",null,"battle")),t.hasClass("not-enough-e")&&message(_t("needE",null,"battle")),t.hasClass("not-enough-m")&&message(_t("needM",null,"battle")),t.hasClass("too-far")&&message(_t("too-far",null,"battle")),t.hasClass("bad-target")&&message(_t("bad-target",null,"battle")),t.hasClass("mage-held-wand")&&message(_t("mage-held-wand",null,"battle")),t.hasClass("last-line")&&message(_t("last-line",null,"battle")),t.hasClass("hunter-can-not-one-step")&&message(_t("hunter-without-arrow %prof%",{"%prof%":getAllProfName(Engine.hero.d.prof)},"battle")),t.hasClass("require"))for(var r=S[i].require.split(","),o=0;o<r.length;o++){var c=r[o];isset(tt[c])?message(tt[c]):message(c)}}else!1,_g(n,(function(){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,6),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,6),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,7),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,7),!0}))},this.checkManaOrEnergy=function(t,e){if(!e)return!1;var i=parseInt(e),n=e[e.length-1],a=x.heroMana,s=x.heroEnergy;return t.addClass(n),!!("m"==n&&a<i||"e"==n&&s<i)&&(t.addClass("not-enough-"+n),!0)},this.getBattleSkill=t=>S[t],this.getAllBattleSkill=()=>S,this.checkDisabledAndAddClass=function(t,e){return!!x.checkDisabled(e)&&(t.addClass("require"),!0)},this.checkTooFar=function(t,e,i){return!!(2&e&&i)&&(t.addClass("too-far"),!0)},this.setManaOrEnergySkill=function(t,e){if(!e)return!1;var i=e[e.length-1];t.addClass(i),t.find(".type").html(e.slice(0,-1))},this.addToHotSlot=function(t,e,i,n){y.add(I).find("[slot="+n+"]").append(t);var a=n;n>7||(x.showedSkills[a]=[t,i,e])},this.addToshowedSkills=function(t,e){var i=t;x.showedSkills[i]=e},this.addAttackSkill=function(t){var e=_t("attack",null,"battle"),i=u.specificSkills.NORMAL_ATTACK_ID,n=x.getSkill(e,"fight&a=strike&id=",!1,i,"");x.addToHotSlot(n,i,"fight&a=strike&id=",t)},this.addStepSkill=function(t){var e=_t("move_forward",null,"battle"),i=u.specificSkills.ONE_STEP_ID,n=x.getSkill(e,"fight&a=move",!1,i,"");x.addToHotSlot(n,i,"fight&a=move",t)},this.showSkills=function(){var t,e;for(var i in x.removeHotSkills(),x.showedSkills={},S){var n=S[i];if(x.isNormalAttackId(i)){this.addAttackSkill(n.hotSlot);continue}if(x.isOneStepId(i)){this.addStepSkill(n.hotSlot);continue}var a=S[i].require;let s=x.checkDisabled(i);e="fight&a=spell&s="+i+"&id=",t=x.getSkill(n.name,e,n.cost,i,!!s&&a),x.addToHotSlot(t,i,e,n.hotSlot)}Engine.dead||y.css("display","block")},this.removeHotSkills=function(){y&&(x.showedSkills=null,y.add(I).find(".battle-skill").remove())},this.initBattleController=function(){T=n.get("battle-controller"),y=Engine.interface.get$interfaceLayer().find(".skill-usable-slots"),I=T.find(".skill-usable-add-slots"),T.find(".time"),C=T.find(".seconds"),w=T.find(".time-progress-bar"),b=T.find(".time-inner"),x.addControlButtons(),x.initProgressBars(),Engine.interface.get$interfaceLayer().find(".bottom.positioner").prepend(T),Engine.hotKeys.replaceAutoAndChangeBtnsNames(),Engine.hotKeys.replaceCloseFightBtnsNames()};const at=()=>{if(getEngine().battle.zoomMode)return;let t=st()?0:15,e=T.height();A.css("bottom",e-t)};this.setSizeOfBattlePanel=()=>{let t=o.getBattlePanelState();T.find(".toggle-battle").tip(_t("toggleBattlePanel")),t||(t=mobileCheck()?"normal":"big");let e=this.getIndexByNameIBattleControllerSize(t);this.setActualSize(t),this["set"+t+"Size"](),this.setBattleControllerPanelHeight(e),this.manageShowMore(e),Engine.hotKeys.replaceToggleBattlePanelTipNames()},this.setActualSize=t=>{Q=t},this.manageShowMore=t=>{let e,i=T.find(".toggle-battle"),n="show-more";if(J.length>t+1){e=this.checkBattleControllerIsTooBig(!0)?"":n}else e="";i.removeClass(n).addClass(e)},this.initBattleWindow=function(){this.$=n.get("battle-window"),A=this.$.find(".battle-area"),Engine.interface.get$gameLayer().append(this.$),x.onResize(),this.$.on("mousewheel DOMMouseScroll",throttle(this.onScrollBattle,300))},this.getBattleArea=()=>A,this.isBattleShow=()=>isset(this.$)&&"block"===this.$.css("display"),this.getBattleController=()=>T,this.onScrollBattle=t=>{let e=t.originalEvent.wheelDelta>0||t.originalEvent.detail<0;this.selectWarrior(e)},this.leaveBattle=function(){_g("fight&a=exit")},this.canAutoFight=()=>{x.checkWT()?mAlert(_t("auto_fight_prompt",null,"battle"),[{txt:_t("yes"),callback:function(){return x.show&&x.autoFight(),!0}},{txt:_t("no"),callback:function(){return!0}}]):x.autoFight()},this.canLeave=()=>{x.checkWT()&&!x.endBattle?mAlert(_t("leave_alert",null,"battle"),[{txt:_t("yes"),callback:function(){return x.leaveBattle(),!0}},{txt:_t("no"),callback:function(){return!0}}]):x.leaveBattle()},this.checkWT=()=>{if(this.warriorsList)for(let t in this.warriorsList){let e=this.warriorsList[t].wt;if(isset(e)&&e>=80)return!0}return!1},this.autoFight=function(){x.setVisibleAutofight(!1),_g("fight&a=f",(function(t){Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,6),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.EN,6),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,7),isset(t.alert)&&x.setVisibleAutofight(!0),L=!0,q=!0}))},this.getAutoFightWasCallInBattle=()=>q,this.clickCharacter=function(t,e){if(!x.isAuto){var i=x.warriorsList[t.toString()];x.warriorsList[Engine.hero.d.id];P=t,e&&"contextmenu"==e.type&&i.hpp>0&&x.skillBattleMenu.showMenuSkills(e,i,S),x.setDisabledSkills(i),x.showWarriorInfo(i),$(".progress-bar-wrapper",".battle-area").css("z-index",0),$(".selector",".one-warrior").css("display","none").removeClass("selected"),$(".one-warrior").removeClass("selected"),i.$.find(".selector").css("display",0==i.hpp?"none":"block"),0==i.hpp?i.$.removeClass("selected"):i.$.addClass("selected"),i.$.find(".progress-bar-wrapper").css("z-index","+=1")}},this.setDisabledSkills=function(t){var e=x.warriorsList[Engine.hero.d.id],i=!(t.y-e.y<2),n=1;if(t==e?n=0:t.team!=e.team&&(n=2),x.skillBattleMenu.addDisabledClassToAllMenuItems(),y.add(I).find(".battle-skill").addClass("disabled"),y.add(I).find(".battle-skill").removeClass("bad-target too-far not-enough-e not-enough-m die last-line mage-held-wand hunter-can-not-one-step"),0==t.hpp)return y.add(I).find(".battle-skill").addClass("die");for(var a in this.checkAttackAndMoveDisabled(i,n),S)if(!x.isNormalAttackId(a)&&!x.isOneStepId(a)){var s=S[a],r=!1,o=!1,l=S[a].cost,c=x.getSkillObjFromBars(a);x.checkManaOrEnergy(c,l)&&(o=!0),x.checkDisabledAndAddClass(c,a)&&(o=!0),8&s.attr&&!n&&(r=!0),16&s.attr&&1==n&&(r=!0),24&s.attr||2!=n||(r=!0),x.checkTooFar(c,s.attr,i)&&(o=!0),r||c.addClass("bad-target"),o||r&&(c.removeClass("disabled"),x.skillBattleMenu.removeDisabledClassFromMenuSkill(a))}},this.getSkillObjFromBars=function(t){return y.add(I).find(".icon-"+t).parent()},this.checkAttackAndMoveDisabled=function(t,e){var i=Engine.hero.d.id,n=i==P,s=1==e,r=Engine.hero.d.prof,o=r==a.TRACKER||r==a.HUNTER,l=r==a.MAGE,c=x.getSkillObjFromBars(u.specificSkills.NORMAL_ATTACK_ID),d=x.getSkillObjFromBars(u.specificSkills.ONE_STEP_ID),h=x.skillBattleMenu.getMenuSkill(u.specificSkills.NORMAL_ATTACK_ID),p=x.skillBattleMenu.getMenuSkill(u.specificSkills.ONE_STEP_ID),g=!n&&!s,f=this.huntersCanAttack(o,t),m=this.mageCanAttack(l,t);return!t&&g||(f||m)&&g?(c.removeClass("disabled"),h.removeClass("disabled")):n||s?c.addClass("bad-target"):t&&c.addClass("too-far"),this.mageCanOneStep(l,t)?this.huntersCanOneStep(o,t)?4==x.warriorsList[i.toString()].y?d.addClass("last-line"):(d.removeClass("disabled"),void p.removeClass("disabled")):d.addClass("hunter-can-not-one-step"):d.addClass("mage-held-wand")},this.huntersCanAttack=function(t,e){if(t){var i=isset(Engine.heroEquipment.getEqItems()[m.CL.DISTANCE_WEAPON]),n=isset(Engine.heroEquipment.getEqItems()[m.CL.QUIVER]);return!(!i||!n)||!e}},this.mageCanAttack=function(t,e){if(t)return!!isset(Engine.heroEquipment.getEqItems().magic)||!e},this.huntersCanOneStep=function(t){if(!t)return!0;var e=isset(Engine.heroEquipment.getEqItems()[m.CL.DISTANCE_WEAPON]),i=isset(Engine.heroEquipment.getEqItems()[m.CL.QUIVER]);return!(e&&i)},this.mageCanOneStep=function(t){return!t||!isset(Engine.heroEquipment.getEqItems().magic)},this.showWarriorInfo=function(t){if(!x.isAuto){x.selectedWarriorID=t.id;var e=l.get("profs-icon").addClass(t.prof);T.find(".nick").html(t.name),T.find(".level").html("("+t.lvl+")"),T.find(".prof-wrapper").html(e),e.tip(getAllProfName(t.prof));var i=T.find(".buffs-wrapper"),n=t.energy0>0&&t.prof!=a.MAGE,s=t.mana0>0&&[a.WARRIOR,a.BLADE_DANCER,a.HUNTER].indexOf(t.prof)<0;x.updateProgressBar(t.hpp,"hp-progress-bar"),x.updateWarriorBuffs(i,t.hpp,t.buffs),n?x.updateProgressBar(t.energy,"ep-progress-bar",t.energy0):T.find(".ep-progress-bar").css("display","none"),s?x.updateProgressBar(t.mana,"mp-progress-bar",t.mana0):T.find(".mp-progress-bar").css("display","none")}},this.setAvatarBgSize=function(t,e,i){var n=[e,i];return e>i?(n[0]=77,n[1]=Math.floor(77*i/e)):(n[0]=Math.floor(77*e/i),n[1]=77),n},this.updateWarriorBuffs=function(t,e,i){if(t.empty(),i&&e>0){for(var n=i,a=0;n;)a+=1&n,n>>=1;for(var s=0,r=0;r<9;r++)if(i>>r&1){Math.ceil((a-s)/2);var o=l.get("buff").addClass("_"+r);o.tip(Z[r],"t_static"),t.append(o),s++}}},this.updateHpProgressBar=function(t){var e=T.find(".hp-progress-bar > .bar-percentage"),i=(T.find(".hp-progress-bar > .background").width(),T.find(".hp-progress-bar > .label")),n=t/100;e.css("display",0==t?"none":"block"),i.html(t+"%"),setPercentProgressBar(e,n)},this.updateProgressBar=function(t,e,i){var n="."+e,a=T.find(n),s=T.find(n+" > .bar-percentage");if(T.hasClass("small")&&isset(i)?a.css("display","none"):a.css("display","block"),!isset(t))return a.css("display","none");var r,o=T.find(n+" > .label");i?(r=t/i,o.html(t+"/"+i)):(r=t/100,o.html(t+"%")),setPercentProgressBar(s,100*r),s.css({display:0==t?"none":"block"})},this.clearDisabledSkills=()=>{Y=null},this.clearWarriorList=function(){for(var t in x.warriorsList)delete x.warriorsList[t];x.warriorsList={},x.$.find(".one-warrior").remove()},this.clearTeamIDs=function(){for(var t in e)delete e[t];e={}},this.hideBattlePanel=function(){Engine.interface.get$GAME_CANVAS().css("display","block"),T.css("display","none")},this.close=function(e){Engine.lock.remove("battle"),Engine.interface.heroElements.showElements("game"),x.battleNight.onClear(),x.battleEffectsController.clearAllEffects(),k.close(),j.hide(),x.removeHotSkills(),x.warriors.resetLines(),x.warriors.clearCanvasWarriors(),x.clearWarriorList(),x.clearDisabledSkills(),x.hideBattlePanel(),x.w_amount=0,t=!1,x.clearTeamIDs(),x.showInterfaceItems(),x.show=!1,x.endBattleForMe=!0,x.canLeaveBattle=!0,T&&T.removeClass("active"),x.$.find(".warrior").remove(),x.$.css("display","none"),API.callEvent(Engine.apiData.CLOSE_BATTLE),$("body").trigger("close_battle"),$("body").removeClass("in-battle"),Engine.tutorialManager.checkCanFinishAndFinish(CFG.LANG.PL,8),Engine.tutorialManager.tutorialStart(CFG.LANG.PL,9),Engine.tutorialManager.tutorialStart(CFG.LANG.EN,9),x.callCheckCanFinishExternalTutorialHeroLeaveBattleButtonOrHotkey(),x.callCheckCanFinishExternalTutorialCloseBattleWindow(),"1"==e.auto&&x.checkIsOptWithAutoCloseBattleWindow()&&x.callCheckCanFinishExternalTutorialCloseBattleWindow()},this.showBattlePanel=function(){API.callEvent(Engine.apiData.OPEN_BATTLE_WINDOW),Engine.lock.add("battle"),x.initVariable(),Engine.interface.get$GAME_CANVAS().css("display","none"),T.css("display","block"),x.setSizeOfBattlePanel(),Engine.interface.heroElements.showElements("battle"),Engine.dead||x.hideInterfaceItems(),x.$.css("display","block"),$("body").addClass("in-battle"),x.isAuto&&(x.show=!0)},this.checkIsOptWithAutoCloseBattleWindow=()=>!!Engine.opt(27),this.showBattleLog=function(){T.css("display","block");const t=T.hasClass("with-skills")?"flex":"inline-block";T.find(".close-battle-logs").css("display",t),T.find(".close-battle-ground").css("display","none"),Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.BATTLE_LOG,!0),k.showBattleLogHelpWindow(),j.show()},this.hideBattleLog=function(){T.css("display","none"),T.find(".close-battle-logs").css("display","none"),Engine.widgetManager.manageClassOfWidget(Engine.widgetsData.name.BATTLE_LOG,!1),k.hideBattleLogHelpWindow(),j.hide()},this.toogleBattleLogs=function(){x.show||("block"==T.css("display")?x.hideBattleLog():x.showBattleLog(),k.updateScroll())},this.getShow=()=>this.show;this.onResize=()=>{if(this.getShow()){if(X.width=A.width(),X.height=A.height(),this.scaleBattle&&this.scaleBattle.manageBattleAreaPosition(),this.battleEffectsController&&this.battleEffectsController.getBattleBackgroundTintAction().onResize(),this.warriors.updatePositions(),T&&this.checkBattleControllerIsTooBig()&&this.setPanelState("veryBig"),T){let t=this.getIndexByNameIBattleControllerSize(Q);this.manageShowMore(t)}this.battleNight.rebuildBattleNight(),Engine.characterEffectsBattleManager.onResize()}},this.updateBattleAreaPos=function(){var t,e=$("body").height();t=e<510?120-(510-e):e<540?120:e/2-150,$(".battle-area",x.$).css({bottom:t})},this.getYPosByLine=t=>this.zoomMode?384-35*(t-3):420-30*(t-3),this.doSkillAction=function(t){var e=parseInt(t)-1;if(null!=x.showedSkills&&x.showedSkills[e]&&F){F=!1,setTimeout((function(){F=!0}),300);var i=x.showedSkills[e],n=i[0],a=i[1],s=i[2];x.callCheckCanFinishExternalTutorialUseBattleSkill(s),x.sendRequest(n,a,s)}},this.hideInterfaceItems=function(){Engine.interface.get$interfaceLayer().find(".bottom-panel>.slots").css("display","none"),Engine.interface.get$interfaceLayer().find(".skill-usable-slots").css("display","block"),T.find(".skill-usable-add-slots").css("display","block"),Engine.hero.lvl>299&&$(".end-game-overlay").removeClass("end-game-overlay")},this.showInterfaceItems=function(){Engine.interface.get$interfaceLayer().find(".bottom-panel>.slots").css("display","block"),Engine.interface.get$interfaceLayer().find(".skill-usable-slots").css("display","none"),T.find(".skill-usable-add-slots").css("display","none"),Engine.interface.heroElements.checkAndSetEndGamePanel()},this.toggleBattlePanel=function(){x.setPanelState(Q)},this.setPanelState=t=>{let e=this.getIndexByNameIBattleControllerSize(t),i=this.getNextIndexInBattleControllerSize(e),n=this.getNextStateByIndexInBattleControllerSize(e);if(this.setActualSize(n),this["set"+n+"Size"](),this.setBattleControllerPanelHeight(i),P&&this.show){
//!self.show == only battle log
let t=P.toString(),e=this.warriorsList[t];this.showWarriorInfo(e)}k.updateScroll(),o.setBattlePanelState(n),at(),this.onResize()},this.getIndexByNameIBattleControllerSize=t=>{for(let e=0;e<J.length;e++)if(J[e].name==t)return e;console.error("[Battle.js, getIndexByNameIBattleControllerSize] NAME NOT EXIST:",t)},this.getNextIndexInBattleControllerSize=t=>(t++,J.length>t?t:0),this.getNextStateByIndexInBattleControllerSize=t=>{let e=this.getNextIndexInBattleControllerSize(t);return J[e].name},this.getBattleControllerSize=t=>J[t].height,this.setBattleControllerPanelHeight=t=>{let e=this.getBattleControllerSize(t);T.height(e+"px")},this.checkBattleControllerIsTooBig=t=>{if("small"==Q)return!1;if(!t&&"normal"==Q)return!1;let e=this.getIndexByNameIBattleControllerSize(Q);t&&(e=this.getNextIndexInBattleControllerSize(e));let i=this.getBattleControllerSize(e),n=Engine.zoomFactor;return n*i-(T.hasClass("with-skills")?0:15)+n*Engine.interface.getBottomPositioner().height()>.5*(n*Engine.interface.get$InterfaceLayerHeight())};const st=()=>R;this.setbigSize=function(){T.find(".left-column").css("display","block"),T.find(".right-column").css("display","block"),T.find(".buffs-wrapper").css("display","block"),T.find(".buttons-wrapper").css("display","block"),T.find(".buffs-wrapper").css("display","block")},this.setveryBigSize=function(){T.find(".left-column").css("display","block"),T.find(".right-column").css("display","block"),T.find(".buffs-wrapper").css("display","block"),T.find(".buttons-wrapper").css("display","block"),T.find(".buffs-wrapper").css("display","block")},this.setnormalSize=function(){T.find(".left-column").css("display","block"),T.find(".right-column").css("display","block"),T.find(".buffs-wrapper").css("display","block"),T.find(".buttons-wrapper").css("display","block"),T.find(".buffs-wrapper").css("display","none")},this.setsmallSize=function(){T.find(".left-column").css("display","none"),T.find(".right-column").css("display","none"),T.find(".buffs-wrapper").css("display","none"),T.find(".buttons-wrapper").css("display","block"),T.find(".buffs-wrapper").css("display","none")},this.updateHeroOutfit=()=>{this.show&&Engine.battle.getWarrior(Engine.hero.d.id).updateIcon()},this.closeOtherWindows=()=>{const t=Engine.windowsData.windowCloseConfig.BATTLE;Engine.windowCloseManager.callWindowCloseConfig(t)}}},function(t,e,i){var n=i(538);i(0);t.exports=function(){var t=this,e=[],i=[],a=!1,s={};this.addCanvasWarrior=(t,e)=>{s[t]=e},this.deleteCanvasWarrior=t=>{delete s[t]},this.clearCanvasWarriors=()=>{for(let t in s)this.deleteCanvasWarrior(t)},this.updateAllWarriors=t=>{for(let e in s)s[e].update(t)},this.drawAllWarriors=()=>{for(let t in s)s[t].draw()},this.init=function(){t.resetLines()},this.checkAllWarriorsProperWarriorImageLoaded=()=>{for(var t=0;t<e.length;t++){let i=e[t];for(let t=0;t<i.length;t++)if(!i[t].getProperWarriorImageLoaded())return!1}return!0},this.allWarriorsLoadedCallback=()=>{if(!this.checkAllWarriorsProperWarriorImageLoaded())return;let t=getEngine();!t.battle.getAllProperWarriorImageLoaded()&&t.battle.getShow()&&(console.log("allWarriorsLoadedCallback"),t.battle.battleNight.rebuildBattleNight())},this.resetLines=function(){for(;e.length;)e.pop();e=[[],[],[],[],[],[]],t.resetStartSideLines()},this.resetStartSideLines=function(){i=[{firstLeft:null,firstRight:null},{firstLeft:null,firstRight:null},{firstLeft:null,firstRight:null},{firstLeft:null,firstRight:null},{firstLeft:null,firstRight:null},{firstLeft:null,firstRight:null}]},this.getLines=function(){return e},this.getStartSideLines=function(){return i};var r=[75,60,45,30,15,0];this.getSeparatoprWidth=()=>r,this.updatePositions2=function(){var t=0;for(var i in Engine.battle.warriorsList)Engine.battle.warriorsList[i].loaded&&t++;for(var n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)e[n][a].loaded?e[n][a].fw+r[n]:0;var s=0;for(a=0;a<e[n].length;a++){if(!e[n][a].loaded)continue;var o=Engine.battle.getYPosByLine(n),l=256+s+(e[n][a].loaded?e[n][a].fw/2:0)+(n%2==0?-16:16);s+=e[n][a].loaded?e[n][a].fw+r[n]:0;var c={top:o-(e[n][a].loaded?e[n][a].fh:0),left:l};e[n][a].xPos>=0&&t==Engine.battle.w_amount?e[n][a].$.stop(!0).animate(c):e[n][a].$.stop(!0).css(c),e[n][a].xPos=l,e[n][a].yPos=o}}};const o=()=>{let t=Engine.battle.$.width()/15,i=t>80?1:t/80;i=Math.max(.45,i);let n=50*i;((t,i,n)=>{for(let a=0;a<e.length;a++)for(let s=0;s<e[a].length;s++)e[a][s].loaded&&d(s,a,t,i,n)})(n,100*i,2*CFG.tileSize*i),(()=>{for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)e[t][i].loaded&&(e[t][i].xPos=h(i,t),e[t][i].yPos=Engine.battle.getYPosByLine(t))})(),(()=>{let t=getEngine().battle.getBattleArea().width()/2;0==t&&(t=256);for(let i=0;i<e.length;i++){if(!e[i].length)continue;let n=t-l(i);for(let t=0;t<e[i].length;t++)e[i][t].loaded&&(e[i][t].xPos+=n)}})(),(t=>{for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++){if(!e[i][n].loaded)continue;i%2==0&&(e[i][n].xPos+=t)}})(n)},l=t=>{let i=e[t].length-1;return startX=i%2==0?i/2:Math.floor(i/2),h(startX,t)};this.updatePositions=function(){Engine.zoomMode?updatePositions2():(o(),c())};const c=()=>{let t=0;for(let e in Engine.battle.warriorsList)Engine.battle.warriorsList[e].loaded&&t++;for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++){let a=e[i][n];if(!a.loaded)continue;let s=a.xPos,r={top:a.yPos-(e[i][n].loaded?e[i][n].fh:0),left:s};e[i][n].xPos>=0&&t==Engine.battle.w_amount?e[i][n].$.stop(!0).animate(r):e[i][n].$.stop(!0).css(r)}},d=(t,i,n,a,s)=>{let r,o=e[i][t],l=o.fw;if(!o.loaded)return e[i][t].widthWarriorInGrid=n,void(e[i][t].widthSeparatorInGrid=s);r=l>n&&l>a?l:n,e[i][t].widthWarriorInGrid=r,e[i][t].widthSeparatorInGrid=s},h=(t,i)=>{let n=0;for(let a=0;a<t;a++){let t=e[i][a];n+=t.widthWarriorInGrid/2,n+=t.widthSeparatorInGrid}return n};this.update=function(e,i){var a=!0;if(!isset(Engine.battle.warriorsList[e.id.toString()])){let t=new n;t.init(e,i),Engine.battle.warriorsList[e.id]=t,a=!1}var s=Engine.battle.warriorsList[e.id];s.updateWarrior(e),t.updatePositions(),Engine.battle.scaleBattle&&Engine.battle.scaleBattle.manageBattleAreaPosition(),a?API.callEvent(Engine.apiData.UPDATE_WARRIOR,s):API.callEvent(Engine.apiData.NEW_WARRIOR,s)},this.getMobClassByWType=t=>{let e;return e=t>=80&&t<=89?"heroes":t>=100?"titan":t>=90?"colossus":t>=10&&t<20?"elite":t>=20&&t<30?"elite2":t>=30&&t<40?"elite3":"normal",e},this.setBar=function(t,e){setPercentProgressBar(t,e)},this.getDieMob=function(){return a},this.setDieMob=function(t){a=t},this.setWarriorsAnimationState=t=>{for(let e in s)s[e].setStaticAnimation(t)},this.rebuildAnimateWarrior=()=>{let t=isInterfaceAnimationOn();for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++){let a=e[i][n];t?a.addAnimateWarrior():a.removeAnimateWarrior()}},this.resetWarriorsActionAnimation=()=>{for(let t in s)s[t].goBackToSequence()}}},function(t,e,i){var n=i(0),a=i(22),s=i(131);let r=i(14);var o=i(52);let l=i(72);t.exports=function(){var t=this,e=0;let i=null,c=null;this.sequenceIndex=0,this.frame=0,this.frameAmount=1,this.sequence=[],this.frames=null,this.ctx=null,this.fw=null,this.fh=null,this.sprite=null,this.fightDir=null,this.loaded=!1;let d=!1;this.fightAction=null;let h=!1;this.setActions=function(e){if(!this.npc)return;var i=new RegExp(/_s_(.*?)_e_/g).exec(e);if(!i)return;if(i.length>2)return console.warn("[OneWarrior.js, setActions] Multiple declaration",e);let n=i[1],a=[];for(let e of n){let i=parseInt(e);if(!Number.isInteger(i))return t.frameAmount=1,void console.warn("[OneWarrior.js, setActions] Argument is not integer");a.push(i)}t.frameAmount=5,t.sequence=a},this.getFrameWidth=e=>e/(this.npc?t.frameAmount:4),this.getFrameHeight=t=>t/(this.npc?1:4),this.beforeOnload=(e,i)=>{this.loaded=!0,this.fw=this.getFrameWidth(e.hdr.width),this.fh=this.getFrameHeight(e.hdr.height),this.halffw=t.fw/2,this.halffh=t.fh/2,this.frames=e.frames,this.activeFrame=0,this.sprite=i,this.setWarriorCharacter(),u()};const u=()=>{h=!0,getEngine().battle.warriors.allWarriorsLoadedCallback()};this.getProperWarriorImageLoaded=()=>h,this.addAnimateWarrior=()=>{this.$.addClass("animate-warrior")},this.removeAnimateWarrior=()=>{this.$.addClass("animate-warrior")},this.setWarriorCharacter=()=>{this.$.css("display","block"),this.createCanvasIcon(),this.appendCanvasIcon(),this.draw(),this.$.css({width:t.fw,height:t.fh,marginLeft:-t.fw/2+"px"}),this.$.find(".selector, .hover-selector").css({height:40,width:t.fw,"border-radius":60,bottom:-15}),Engine.battle.warriors.updatePositions(),Engine.battle.infoUpdate(),Engine.battle.scaleBattle.manageBattleAreaPosition();let e=Engine.rajBattleEvents.isPossibleCallBattleEventsFromExternalProperties(this);if(isInterfaceAnimationOn()&&setTimeout(this.addAnimateWarrior,800),!e)return;if(d)return;d=!0;let i=this.getOriginalId(),n=Engine.npcs.getExternalProperties(i);Engine.rajController.parseObject(n,[a.INTERFACE_SKIN,a.WEATHER,a.FLOAT_OBJECT,a.FLOAT_FOREGROUND,a.SCREEN_EFFECTS,a.NIGHT,a.MAP_FILTER,a.EARTHQUAKE,a.CHARACTER_EFFECT,a.FAKE_NPC,a.TUTORIAL,a.MAP_EVENTS,a.CHARACTER_IMAGE_CHANGER,a.EMO_DEFINITIONS,a.EMO_ACTIONS,a.MAP_EVENTS,a.EXTRA_LIGHT,a.DYNAMIC_LIGHT,a.YELLOW_MESSAGE,a.SEQUENCE,a.SOUND,a.AREA_TRIGGER,a.RANDOM_CALLER,a.CONNECT_SRAJ,a.ZOOM,a.TRACKING],{npcId:i}),Engine.rajBattleEvents.callAllActionsBySpecificEventAndWarrior(s.ON_START_FIGHT_WITH_NPC,i)},this.appendCanvasIcon=()=>{this.setFightDir(),this.$.find(".canvas-warrior-icon").html(this.$canvasIcon),Engine.battle.warriors.addCanvasWarrior(this.id,this),this.loaded=!0},this.setFightDir=function(){this.npc?this.fightDir="S":this.fightDir=this.team==Engine.battle.myteam?"N":"S"},this.updateIcon=()=>{let e;const i=this.id===Engine.hero.d.id&&Engine.hero.previewOutfit?Engine.hero.previewOutfit:this.icon;e=this.npc?CFG.r_npath+fixSrc(i):CFG.r_opath+fixSrc(i),t.setActions(e),t.setStaticAnimation(Engine.opt(8)),this.setPlaceHolderIcon(),Engine.imgLoader.onload(e,{speed:!0,externalSource:cdnUrl},(t,e)=>{this.beforeOnload(e,t)})},this.setPlaceHolderIcon=function(){let t=this.getPlaceholderCharacter();this.fw=32,this.fh=48,this.halffw=16,this.halffh=24,this.activeFrame=0,this.sprite=t,this.imgLoaded=!0,this.frames=[{delay:300}],this.setWarriorCharacter()},this.getPlaceholderCharacter=function(){return this.placeHolderCharacter},this.createCanvasIcon=function(e){this.$canvasIcon=$("<canvas>"),this.$canvasIcon.attr({width:t.fw,height:t.fh}),this.ctx=this.$canvasIcon[0].getContext("2d")},this.getOriginalId=()=>c,this.createPlaceHolderCharacter=function(){Engine.imgLoader.onload("../img/def-npc-sprite.gif",!1,(t,e)=>{this.placeHolderCharacter=t})},this.init=function(t,e){this.createPlaceHolderCharacter(),this.id=t.id,c=t.originalId,this.$=n.get("one-warrior").addClass("transition"),this.$.addClass("other-id-battle-"+t.id),t.npc&&(this.npc=!0,this.$.addClass("one-warrior--npc")),this.setCursor(t.team),this.$.on("click contextmenu",(function(e){return Engine.battle.clickCharacter(t.id,e)})),this.xPos=-1,this.energyBar=!1,this.manaBar=!1;var a=this.$.find(".progress-bar-wrapper"),s=n.get("health-points").addClass("stat-bar");a.append(s);var o=this.$.find(".progress-bar-wrapper");if(this.npc&&(i=n.get("super-cast").addClass("stat-bar"),a.append(i)),t.energy0>0&&t.prof!=r.MAGE){var l=n.get("energy-points").addClass("stat-bar"),d=l.find(".inner");l.appendTo(o);var h=t.energy/t.energy0;Engine.battle.warriors.setBar(d,100*h),this.energyBar=!0}if(t.mana0>0&&[r.WARRIOR,r.BLADE_DANCER,r.HUNTER].indexOf(t.prof)<0){var u=n.get("mana-points").addClass("stat-bar stat-bar-bottom"),p=u.find(".inner");u.appendTo(o);h=t.mana/t.mana0;Engine.battle.warriors.setBar(p,100*h),this.manaBar=!0}(this.energyBar||this.manaBar)&&s.addClass("stat-bar-top"),this.energyBar&&this.manaBar?l.addClass("stat-bar-middle"):this.energyBar&&!this.manaBar&&l.addClass("stat-bar-bottom"),e||this.$.appendTo(Engine.battle.$.find(".battle-area"))},this.setCursor=t=>{const e=l.CURSOR.DO_ACTION;this.$.addClass(e)},this.update=t=>{if(this.frames&&this.frames.length>1&&(e+=100*t,this.frames[this.activeFrame].delay<e))if(e-=this.frames[this.activeFrame].delay,this.frames.length==this.activeFrame+1){if(this.activeFrame=0,this.loopAction)return;this.manageSequenceAction()}else this.activeFrame=this.activeFrame+1},this.manageSequenceAction=function(){t.sequence.length&&(t.sequenceIndex++,t.sequenceIndex>t.sequence.length-1?(t.sequenceIndex=0,t.frame=0):t.frame=t.sequence[t.sequenceIndex])},this.draw=function(t){if(this.loaded){t||this.ctx.clearRect(0,0,this.fw,this.fh);var e=isset(this.fightDir)?this.fightDir:"S",i=this.fh,n=this.frame*this.fw,a=0;switch(e){case"S":a=0;break;case"W":a=this.fh;break;case"E":a=2*this.fh;break;case"N":a=3*this.fh}this.img||this.staticAnimation?this.ctx.drawImage(this.img||this.sprite,n,a,this.fw,i,0,0,this.fw,i):this.sprite&&void 0!==this.activeFrame&&this.frames.length>0&&this.npc?this.ctx.drawImage(this.sprite,n,a+this.activeFrame*this.fh,this.fw,i,0,0,this.fw,i):this.sprite&&void 0!==this.activeFrame&&this.frames.length>0&&!this.npc&&this.ctx.drawImage(this.sprite,n,a+this.activeFrame*this.fh*4,this.fw,i,0,0,this.fw,i)}},this.updateWarrior=t=>{let e=Engine.battle.warriors.getLines();for(var a in t){var r=this[a];switch(this[a]=t[a],a){case"name":this.$.find(".warrior-name").text(this.name);break;case"icon":this.updateIcon();break;case"y":if(1!=Engine.battle.myteam&&(this.y=5-this.y),isset(r)){var l=e[r].indexOf(this);e[r].splice(l,1)}e[this.y].push(this),e[this.y].sort((function(t,e){return t.xPos-e.xPos})),this.$.css("zIndex",5-this.y);break;case"hpp":isset(r)&&this.showDamage(r);break;case"buffs":var c=this.$.find(".warrior-buffs-wrapper");c.css("margin-left",-(28-this.fw/2)),Engine.battle.updateWarriorBuffs(c,this.hpp,this.buffs);break;case"cooldowns":var d=this.cooldowns;0==d.length&&Engine.battle.skillBattleMenu.removeAllCooldown();for(var h=0;h<d.length;h++){var u=(m=d[h])[1],p=$(".bottom.positioner").find(".icon-"+m[0]).parent(),g=p.parent();if(0==u)p.removeClass("cooldown-disabled"),g.find(".cooldown-left").remove(),Engine.battle.skillBattleMenu.deleteCooldownFromMenuItem(m[0]);else{var f=g.find(".cooldown-left");f.length<1&&(f=n.get("cooldown-left"),g.append(f),f.click((function(){message(_t("can_not_use_skill_now"))}))),p.addClass("cooldown-disabled"),f.html(u),Engine.battle.skillBattleMenu.updateCooldownMenuInMenuItem(m[0],u)}}break;case"doublecastcost":var m;if($(".bottom.positioner").find(".double-cast-cost").removeClass("double-cast-cost").each((function(){var t=$(this).attr("old-val");let e=$(this).parent(),i=e.attr("battle-skill-id"),n=Engine.battle.getBattleSkill(i),a=Engine.battle.getBattleSkillType(n.cost);n.name;$(this).removeAttr("old-val"),$(this).html(t.slice(0,-1)),n.cost=t,o.changeCostInTip(e,n.cost.slice(0,-1))})),Engine.battle.skillBattleMenu.deleteAllDoubleCostFromMenu(),(m=this.doublecastcost).length<1)break;var v=m[1];let t=$(".bottom.positioner").find(".icon-"+m[0]).parent();if(0===t.length)break;var E=t.find(".type"),_=E.html();E.addClass("double-cast-cost").html(v.slice(0,-1));let a=Engine.battle.getBattleSkill(m[0]),s=Engine.battle.getBattleSkillType(v);a.cost=v,E.attr("old-val",_+s),o.changeCostInTip(t,a.cost.slice(0,-1)),Engine.battle.skillBattleMenu.addDoubleCastCostToMenuItem(m[0],m[1]);break;case"combo":var b=Engine.battle.getComboPoints();Engine.battle.setComboPoints(this.combo),b!=this.combo&&Engine.battle.setComboPointsOnSkill();break;case"mana0":if(this.manaBar&&this.mana0>0){var w=this.$.find(".mana-points").find(".inner"),C=this.mana/this.mana0;Engine.battle.warriors.setBar(w,100*C)}break;case"energy0":if(this.energyBar){w=this.$.find(".energy-points").find(".inner"),C=this.energy/this.energy0;Engine.battle.warriors.setBar(w,100*C)}break;case"wt":const T=Engine.battle.warriors.getMobClassByWType(this.wt);this.$.addClass("wt-"+T);break;case"super_cast":const y=this.super_cast.turn/this.super_cast.total_turns*100;i.addClass("active"),this.super_cast.turn===this.super_cast.total_turns&&i.addClass("completed"),this.removeSuperCastDividers();const I=this.createSuperCasDividers(this.super_cast.total_turns);i.append(I);const A=i.find(".inner");Engine.battle.warriors.setBar(A,y)}}if(this.id!==Engine.hero.d.id&&this.super_cast&&!isset(t.super_cast)&&(this.super_cast=null,i.addClass("finish"),i.removeClass("completed"),setTimeout(()=>{i.removeClass("finish"),i.removeClass("active")},500)),this.id==Engine.hero.d.id){var T=this.energy,y=this.energy0,I=this.mana,A=this.mana0;Engine.interface.heroElements.setEnergy(T,y),Engine.interface.heroElements.setMana(I,A),Engine.battle.heroMana=I,Engine.battle.heroEnergy=T}if(this.updateHpp(),this.createWarriorTip(),0==this.hpp){$(".buff",this.$).remove(),Engine.battle.selectedWarriorID==this.id&&(Engine.battle.selectedWarriorID=null,Engine.battle.skillBattleMenu.closeMenu()),Engine.battle.deleteWarrior(this.id),this.loaded=!0,this.$.find(".selector").css("display","none"),this.$.css("display","block"),this.$.addClass("die-warrior"),this.createGrave(),this.$.find(".canvas-warrior-icon").css("display","none"),Engine.battle.warriors.setDieMob(this.id),Engine.rajBattleEvents.isPossibleCallBattleEventsFromExternalProperties(this)&&Engine.rajBattleEvents.callAllActionsBySpecificEventAndWarrior(s.ON_DIE_NPC,this.getOriginalId())}Engine.battle.warriors.updatePositions()},this.turnTranslation=t=>{let e;return e=1===t?_t("turn"):t>1&&t<5?_t("turns"):_t("turn5"),`${t} ${e}`},this.createSuperCasDividers=t=>{const e=document.createElement("div");e.classList.add("dividers");for(let i=1;i<t;i++){const n=document.createElement("div");n.classList.add("divider"),n.style.left=i/t*100+"%",e.appendChild(n)}return e},this.removeSuperCastDividers=()=>{const t=i[0].querySelector(".dividers");t&&t.parentNode.removeChild(t)},this.fillTipSuperCast=t=>{if(isset(this.super_cast)&&null!==this.super_cast){const{name:e,total_turns:i,turn:n}=this.super_cast,a=parseInt(i?n/i*100:100)+"%",s=i-n;t.find(".sc-content").addClass("active"),t.find(".sc-content__name").text(e),t.find(".sc-content__percent").text(a),t.find(".sc-content__turns").text(this.turnTranslation(s))}else t.find(".sc-content").removeClass("active")},this.fillTipResistances=t=>{let e=!1;if(isset(this.ac)){let e=0===this.ac.bonus?"":`(+${this.ac.bonus})`;t.find(".ac").text(`${this.ac.cur} ${e} `),t.find(".ac-content").addClass("active"),isset(this.ac.destroyed)&&t.find(".ac-destroyed").addClass("active")}if(isset(this.resfire)){let i=0===this.resfire.bonus?"":`(+${this.resfire.bonus})`;t.find(".resfire").text(`${this.resfire.cur} ${i} `),e=!0}if(isset(this.resfrost)){let i=0===this.resfrost.bonus?"":`(+${this.resfrost.bonus})`;t.find(".resfrost").text(`${this.resfrost.cur} ${i} `),e=!0}if(isset(this.reslight)){let e=0===this.reslight.bonus?"":`(+${this.reslight.bonus})`;t.find(".reslight").text(`${this.reslight.cur} ${e} `)}if(isset(this.act)){let e=0===this.act.bonus?"":`(+${this.act.bonus})`;t.find(".act").text(`${this.act.cur} ${e} `)}e&&t.find(".resist-content").addClass("active")},this.fillTipEnergyAndMana=t=>{let e=!1;Engine.battle.myteam===this.team&&(isset(this.energyBar)&&this.energyBar&&(e=!0,t.find(".energy").text(_t("energy_amount %val%",{"%val%":this.energy+"/"+this.energy0},"battle"))),isset(this.manaBar)&&this.manaBar&&(e=!0,t.find(".mana").text(_t("mana_amount %val%",{"%val%":this.mana+"/"+this.mana0},"battle")))),e&&t.find(".mana-energy-content").addClass("active")},this.createWarriorTip=()=>{const e=n.get("one-warrior-tip").addClass("info-wrapper");e.find(".nick").html(`${parseContentBB(this.name)} (${this.lvl+this.prof})`),e.find(".hp").text(_t("life_percent %val%",{"%val%":t.hpp},"battle")),this.fillTipResistances(e),this.fillTipEnergyAndMana(e),this.fillTipSuperCast(e),this.$.find(".canvas-warrior-icon, .grave-warrior-other, .grave-warrior-npc").tip(e.prop("outerHTML"))},this.createGrave=()=>{(this.id>0?this.$.find(".grave-warrior-other"):this.$.find(".grave-warrior-npc")).css("display","block")},this.showDamage=e=>{var i=this.hpp;if(e!=i){var n=this.$.find(".warrior-dmg"),a=i-e;n.removeClass("green red"),n.addClass(a>0?"green":"red"),n.html((a>0?"+":"-")+Math.abs(a)+"%"),n.css({"margin-left":-n.width()/2,display:"block"}),t.manageDamageAnimation(n)}},this.manageDamageAnimation=function(t){if(Engine.opt(8)){let e=parseInt(t.css("top"));t.css("top",e-30+"px"),setTimeout((function(){t.remove()}),1e3)}else t.animate({top:"-=30px"},500,(function(){$(this).fadeOut(500,(function(){$(this).css("top",0)}))}))},this.updateHpp=function(){Engine.battle.selectedWarriorID==this.id&&Engine.battle.updateHpProgressBar(this.hpp);var t=this.$.find(".health-points"),e=t.find(".inner"),i=this.hpp/100;if(0==i)return t.css("display","none"),this.$.find(".energy-points").css("display","none"),this.$.find(".mana-points").css("display","none"),void this.$.find(".warrior-background").css("display","none");Engine.battle.warriors.setBar(e,100*i)},this.setStaticAnimation=function(t){IE?this.staticAnimation=!0:this.staticAnimation=t},this.goBackToSequence=()=>{this.frame=0,this.resetActionIndex(),this.loopAction=!1},this.setIdle1Action=()=>{this.isSequenceWarrior()&&(this.resetActionIndex(),this.frame=0,this.loopAction=!1)},this.setIdle2Action=()=>{this.isSequenceWarrior()&&(this.resetActionIndex(),this.frame=1,this.loopAction=!1)},this.setIdle3Action=()=>{this.isSequenceWarrior()&&(this.resetActionIndex(),this.frame=2,this.loopAction=!1)},this.setAttackAction=()=>{this.isSequenceWarrior()&&(this.resetActionIndex(),this.frame=3,this.loopAction=!1)},this.setCastAction=()=>{this.isSequenceWarrior()&&(this.resetActionIndex(),this.frame=4,this.loopAction=!0)},this.resetActionIndex=()=>{this.isSequenceWarrior()&&(this.sequenceIndex=0,this.activeFrame=0)},this.isSequenceWarrior=()=>this.npc&&this.sequence.length}},function(t,e,i){var n=i(0),a=i(540);t.exports=function(){var t=this,e=null,i=null;this.forumLog=null;let s,r=!1;this.init=function(){i=$(".battle-controller .left-column"),e=i.find(".scroll-pane"),$(".scroll-wrapper",i).addScrollBar({track:!0}),s=new a,s.init()},this.open=function(){r=!0,this.forumLog=[],t.updateScroll(),t.showBattleLogHelpWindow()},this.updateScroll=function(){s.updateScrollbar(),$(".scroll-wrapper",i).trigger("updateWhenBottom")},this.close=function(){r=!0,t.hideBattleLogHelpWindow()},this.showBattleLogHelpWindow=()=>{s.show()},this.hideBattleLogHelpWindow=()=>{s.hide()},this.getShow=function(){return r},this.clear=function(){e.empty(),s.clear()},this.toggleAttachBattleLogHelpWindow=()=>{s.toggleAttach()},this.reload=function(e,i){t.clear(),t.battleMsg("0;0;txt="+_t("battle_starts_between %grp1% %grp2%",{"%grp1%":e,"%grp2%":i}))},this.copyForumLog=function(){var e=document.createElement("textarea");e.style.position="absolute",e.style.opacity="0",e.value=t.forumLog.join("\n"),document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Your browser doesn't support copy button")}document.body.removeChild(e)},this.battleMsg=function(i,a,r,o){var l=i;i=i.split(";"),isset(a)||(a=!1);var c,d,h=0,u=0,p=!1;if(i[0].indexOf("=")>0){var g=i[0].split("=");h=parseInt(g[0]),isset(Engine.battle.getShow())&&isset(Engine.battle.warriorsList[h])&&(Engine.battle.warriorsList[h].hpp=parseInt(g[1])),p=!0}else h=parseInt(i[0]);if(i[1].indexOf("=")>0){g=i[1].split("=");u=parseInt(g[0]),isset(Engine.battle.getShow())&&isset(Engine.battle.warriorsList[u])&&(Engine.battle.warriorsList[u].hpp=parseInt(g[1]))}else u=parseInt(i[1]);var f="(a)",m="(a)";isset(Engine.battle.getShow())&&(c=h?Engine.battle.warriorsList[h]:{name:"BŁĄD#1!"},d=u?Engine.battle.warriorsList[u]:{name:"BŁĄD#1!"}),isset(c)&&"x"!=c.gender&&(f="k"==c.gender?"a":""),isset(d)&&"x"!=d.gender&&(m="k"==d.gender?"a":""),i.splice(0,2);var v=["","",""],E="",_="",b="",w=0,C=0!=h&&0==u&&p,T="";for(var y in i){y==i.length-1&&C&&(T=c.name,c.name+="("+c.hpp+"%)");var I=i[y].split("=");switch(Engine.battle.battleEffectsController.manageBattleEffects(I[0],I[1],c,d,i,r,o),I[0]){case"winner":if("?"==I[1])v[1]+=_t("battle_no_winner",null,"battle");else if(I[1].indexOf(",")<0){f="";for(var A in Engine.battle.warriorsList)Engine.battle.warriorsList[A].name==I[1]&&"k"==Engine.battle.warriorsList[A].gender?f="a":Engine.battle.warriorsList[A].name==I[1]&&"x"==Engine.battle.warriorsList[A].gender&&(f="(a)");v[1]+=_t("winner_is %name% %posfix%",{"%posfix%":f,"%name%":I[1]},"battle")}else v[1]+=_t("winner_team_is %name% %posfix%",{"%name%":I[1]},"battle");E="win";break;case"loser":if(I[1].indexOf(",")<0){f="";for(var A in Engine.battle.warriorsList)Engine.battle.warriorsList[A].name==I[1]&&"k"==Engine.battle.warriorsList[A].gender?f="a":Engine.battle.warriorsList[A].name==I[1]&&"x"==Engine.battle.warriorsList[A].gender&&(f="(a)");v[1]+=_t("loser_is %name% %posfix%",{"%posfix%":f,"%name%":I[1]},"battle")}else v[1]+=_t("loser_team_is %name% %posfix%",{"%name%":I[1]},"battle");E="lose";break;case"flee":let t=l.split(";");const[e,n]=t[0].split("=");v[1]+=_t("msg_flee %name% %hp%",{"%name%":T,"%hp%":n+"%"}),E="txt";break;case"txt":v[1]+=I[1],E="txt";break;case"loot":v[1]+=_t("msg_loot %name% %g1% %m1%",{"%name%":c.name,"%g1%":f,"%m1%":I[1]}),E="loot";break;case"-reddest_per0":break;case"-redabdest_per":v[1]+=_t("msg_redabdest_per %m1%",{"%m1%":I[1]})+"<br>";break;case"dloot":v[1]+=_t("msg_dloot %name% %g1% %m1%",{"%name%":c.name,"%g1%":f,"%m1%":I[1]}),E="loot";break;case"step":v[1]+="<font color='white'>"+_t("msg_step %name% %g1%",{"%name%":c.name,"%g1%":f})+"</font>",E="neu";break;case"afterheal":v[1]+="<font color='4afffd'><i>"+_t("msg_afterheal %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>",E="neu";break;case"reusearrows":v[1]+='<font color= "41ff57"><i>',1==I[1]?v[1]+=_t("msg_reusearrows_one"):I[1]<5?v[1]+=_t("msg_reusearrows %val% %arrows%",{"%val%":I[1],"%arrows%":_t("part_arrows_plural1")}):v[1]+=_t("msg_reusearrows %val% %arrows%",{"%val%":I[1],"%arrows%":_t("part_arrows_plural2")}),v[1]+=" "+c.name+".</i></font><br>",E="neu";break;case"wound":1==(k=I[1].split(",")).length?v[1]+="<font color='85caff'><i>"+_t("msg_wound %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>":v[1]+="<font color='85caff'><i>"+_t("msg_wound_multi %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"</i></font><br>",E="neu";break;case"+woundfrost":v[1]+="<font color='85caff'><i>"+_t("msg_woundfrost %val%",{"%val%":I[1]})+"</i></font><br>",E="neu";break;case"critwound":1==(k=I[1].split(",")).length?v[1]+="<font color='ff4a20'><i><b>"+_t("msg_critwound %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</b></i></font><br>":v[1]+="<font color='ff4a20'><i><b>"+_t("msg_critwound %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"</b></i></font><br>",E="neu";break;case"+woundpoison":v[1]+=_t("msg_woundpoison %val%",{"%val%":I[1]})+"<br>",E="neu";break;case"+of_woundpoison":v[1]+=_t("msg_of_woundpoison %val%",{"%val%":I[1]})+"<br>",E="neu";break;case"+woundmagic":v[1]+=_t("msg_woundmagic %val%",{"%val%":I[1]})+"<br>",E="neu";break;case"+of_woundmagic":v[1]+=_t("msg_of_woundmagic %val%",{"%val%":I[1]})+"<br>",E="neu";break;case"injure":1==(k=I[1].split(",")).length?v[1]+="<font color='30ff00'><i>"+_t("msg_injure %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>":v[1]+="<font color='30ff00'><i>"+_t("msg_injure %name% %val0% %val1%",{"%name%":c.name,"%val%":k[0],"%val1%":k[1]})+"</i></font><br>",E="neu";break;case"poison":1==(k=I[1].split(",")).length?v[1]+="<font color='30ff00'><i>"+_t("msg_poison %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>":v[1]+="<font color='30ff00'><i>"+_t("msg_poison %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"</i></font><br>",E="neu";break;case"heal":1==(k=I[1].split(",")).length?v[1]+="<font color='4afffd'><i>"+_t("msg_heal %gain_lost% %name% %val%",{"%name%":c.name,"%val%":I[1],"%gain_lost%":I[1]>=0?_t("part_gained"):_t("part_lost")})+"</i></font><br>":v[1]+="<font color='4afffd'><i>"+_t("msg_heal %gain_lost% %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1],"%gain_lost%":k[0]>=0?_t("part_gained"):_t("part_lost")})+"</i></font><br>",E="neu";break;case"fire":1==(k=I[1].split(",")).length?v[1]+='<font color="fffc00"><i>'+_t("msg_fire %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>":v[1]+='<font color="fffc00"><i>'+_t("msg_fire %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"</i></font><br>",E="neu";break;case"light":1==(k=I[1].split(",")).length?v[1]+='<font color="ffff00"><i>'+_t("msg_light %name% %val%",{"%name%":c.name,"%val%":I[1]})+"</i></font><br>":v[1]+='<font color="ffff00"><i>'+_t("msg_light %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"</i></font><br>",E="neu";break;case"frost":var k;1==(k=I[1].split(",")).length?v[1]+=_t("msg_frost %name% %val%",{"%name%":c.name,"%val%":I[1]})+"<br>":v[1]+='<font color="85caff"><i>'+_t("msg_frost %name% %val0% %val1%",{"%name%":c.name,"%val0%":k[0],"%val1%":k[1]})+"<br>";break;case"shout":v[1]+="<font color='5eff06'>"+_t("msg_shout %name%",{"%name%":c.name,"%name2%":I[1]})+"</font><br>",E="neu";break;case"en-regen":v[1]+=_t("msg_en-regen %gain_lost% %name% %val%",{"%name%":c.name,"%val%":I[1],"%gain_lost%":I[1]>0?_t("part_gained"):_t("part_lost")})+"<br>",E="neu";break;case"achpp_per":v[1]+=_t("achpp_per",{"%val%":I[1]})+"<br>";break;case"allslow":v[1]+=_t("msg_allslow")+"<br>";break;case"arrowrain":v[1]+=_t("msg_arrowrain")+"<br>";break;case"aura-ac_per":var S=d.team==Engine.battle.myteam?"fr":"en";v[1]+='<font class="'+S+'">'+_t("msg_aura-ac_per %val% %name%",{"%val%":mp(I[1]),"%name%":c.name})+"</font><br>";break;case"aura-ac":v[1]+=_t("msg_aura-ac %val%",{"%val%":I[1]})+"<br>";break;case"aura-resall":S=d.team==Engine.battle.myteam?"fr":"en";v[1]+='<font class="'+S+'">'+_t("msg_aura-resall %val% %name%",{"%val%":mp(I[1]),"%name%":c.name})+"</font><br>";break;case"aura-sa_per":S=d.team==Engine.battle.myteam?"fr":"en";v[1]+='<font class="'+S+'">'+_t("msg_aura-sa_per_new %val% %name%",{"%val%":mp(I[1]),"%name%":c.name})+"</font><br>";break;case"aura-sa":v[1]+=_t("msg_aura-sa %val%",{"%val%":mp(I[1]/100)})+"<br>";break;case"bandage":1==(N=I[1].split(",")).length?v[1]+=_t("msg_aura-bandage %val%",{"%val%":N[0],"%name%":c.name})+"<br>":v[1]+=_t("msg_aura-bandage-multi %val% %val2%",{"%name%":c.name,"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"blizzard":v[1]+=_t("msg_blizzard")+"<br>";break;case"cover":v[1]+=_t("msg_cover")+"<br>";break;case"disturb":v[1]+=_t("msg_disturb")+"<br>";break;case"physical":v[1]+=_t("msg_physical %name% %val%",{"%name%":c.name,"%val%":I[1]})+"<br>";break;case"poison_lowdmg_per-enemies":v[1]+=_t("msg_poison_lowdmg_per-enemies %val%",{"%val%":I[1]})+"<br>";break;case"-poison_lowdmg_per":v[1]+=_t("msg_-poison_lowdmg_per %val%",{"%val%":I[1]})+"<br>";break;case"doubleshoot":v[1]+=_t("msg_doubleshoot %name%",{"%name%":c.name})+"<br>";break;case"+energy":v[1]+=_t("msg_+energy %val%",{"%val%":I[1]})+"<br>";break;case"energyout":v[1]+=_t("msg_energyout %val%",{"%val%":I[1]})+"<br>";break;case"energy":v[1]+=_t("msg_energy %name% %gain_loss% %val%",{"%name%":c.name,"%gain_loss%":I[1]>0?_t("part_loss_en"):_t("part_gain_en"),"%val%":Math.abs(I[1])})+"<br>";break;case"en-regen-cast":v[1]+=_t("msg_en-regen-cast %name% %target%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"firewall":break;case"thunder":v[1]+=_t("msg_thunder %name%",{"%name%":c.name})+"<br>";break;case"storm":v[1]+=_t("msg_storm %name%",{"%name%":c.name})+"<br>";break;case"mlightshiled":v[1]+=_t("msg_mlightshiled %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"fireshield":v[1]+=_t("msg_fireshield %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"lightshield2":v[1]+=_t("msg_lightshield2 %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"lightshield":v[1]+=_t("msg_lightshield %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"frostshield":v[1]+=_t("msg_frostshield %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"sunshield_per":case"sunshield":v[1]+=_t("msg_sunshield %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"antidote":v[1]+=_t("msg_antidote %val%",{"%val%":I[1]})+"<br>";break;case"sunreduction":v[1]+=_t("msg_sunreduction %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"footshoot":v[1]+=_t("msg_footshoot %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"stealmana":v[1]+=_t("msg_stealmana %name%",{"%val%":I[1],"%target%":d.name})+"<br>";break;case"rime_per":var O=I[1].split(",");v[1]+=_t("msg_rime_per %val% %name%",{"%val%":O[0],"%name%":c.name})+"<br>";break;case"trickyknife":v[1]+=_t("msg_trickyknife %name% %target%",{"%name%":c.name,"%target%":d.name})+"<br>";break;case"healall_per":1==(N=I[1].split(",")).length?v[1]+=_t("msg_healall_per %name% %val%",{"%name%":c.name,"%val%":N[0]})+"<br>":v[1]+=_t("msg_healall_per_multi %name% %val% %val2%",{"%name%":c.name,"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"healall":v[1]+=_t("msg_healall %name% %val%",{"%name%":c.name,"%val%":I[1]})+"<br>";break;case"manatransfer":v[1]+=_t("msg_manatransfer %name% %val% %name2%",{"%name2%":d.name,"%name%":c.name,"%val%":I[1]})+"<br>";break;case"soullink":v[1]+=_t("msg_soullink %name%",{"%name%":c.name})+"<br>";break;case"combo-max":v[1]+=_t("msg_combo-max",{"%val%":I[1]})+"<br>";break;case"poisonspread":v[1]+=_t("msg_poisonspread")+I[1]+"<br>";break;case"poisonspread_failkey":v[1]+=_t("msg_poisonspread_failkey")+"<br>";break;case"removeslow-allies":v[1]+=_t("msg_removeslow-allies")+"<br>";break;case"removestun-allies":v[1]+=_t("msg_removestun-allies")+"<br>";break;case"of-woundstart":v[1]+=_t("msg_of-woundstart")+"<br>";break;case"lowheal_per-enemies":v[1]+=_t("msg_lowheal_per-enemies val",{"%val%":I[1]})+"<br>",console.log(I[1]);break;case"stinkbomb":v[1]+=_t("msg_stinkbomb %name% %name2%",{"%name%":c.name,"%name2%":d.name})+"<br>";break;case"managain":v[1]+=_t("msg_managain %name% %val%",{"%name%":c.name,"%val%":mp(I[1])})+"<br>";break;case"insult":v[1]+=_t("msg_insult %name% %name2% %val%",{"%name%":c.name,"%val%":I[1],"%name2%":d.name})+"<br>";break;case"prepare":v[1]+=_t("msg_prepare %name%",{"%name%":c.name,"%name2%":I[1]})+"<br>",E="auto";break;case"skillId":break;case"tspell":v[1]+=_t("msg_tspell %name%",{"%name%":c.name,"%name2%":I[1]})+"<br>",E="auto";break;case"legbon_lastheal":O=I[1].split(",");v[1]+=_t("msg_legbon_lastheal %val%",{"%val%":O[1],"%val2%":O[0]})+"<br>";break;case"+superspell-dispel":v[1]+=_t("msg_+dispel")+"<br>";break;case"-tenacity":v[1]+=_t("msg_-tenacity")+"<br>";break;case"+oth_dmg":O=I[1].split(",");v[1]+="<b class=dmg"+O[1]+">"+_t("msg_+oth_dmg %val% %name%",{"%val%":O[0],"%name%":O[2]})+"<br>",E="auto";break;case"+oth_cover":O=I[1].split(",");v[1]+=_t("msg_+oth_cover %val% %name%",{"%val%":O[0],"%name%":O[2]})+"<br>";break;case"+exp":var M=_t("msg_+exp %val%",{"%val%":I[1]});v[1]+=M+"<br>",E="exp";break;case"+ph":v[1]+=_t("msg_+ph %val%",{"%val%":I[1]})+"<br>",E="win";break;case"+of_dmg":_+="<b class=dmgo>+"+I[1]+"</b>";break;case"+thirdatt":v[1]+="<font color='ffc039'><b>"+_t("+third_strike")+"</b></font><br>",_+="<b class=third>+"+I[1]+"</b>";break;case"+crit":v[1]+="<font color='ff96b1'><i>"+_t("msg_+crit")+"</i></font><br>";break;case"+verycrit":v[1]+="<font color='ff4e91'><i><b>"+_t("msg_+verycrit")+"</b></i></font><br>";break;case"+of_crit":v[1]+="<font color='ff75d0'><i><b>"+_t("msg_+of_crit")+"</b></i></font><br>";break;case"+wound":v[1]+=_t("msg_+wound")+"<br>";break;case"+of_wound":v[1]+="<font color='ff753c'><i><b>"+_t("msg_+of_wound")+"</b></i></font><br>";break;case"+critwound":v[1]+=_t("msg_+critwound")+"<br>";break;case"+critslow_per":v[1]+=_t("msg_+critslow_per= %val%",{"%val%":I[1]})+"<br>";break;case"+critslow":v[1]+="<font color='ff6c2b'><i>"+_t("msg_+hithurt %val%",{"%val%":I[1]})+"</i></font><br>";break;case"+critsa_per":v[1]+=_t("msg_+critsa_per %val%",{"%val%":I[1]})+"<br>";break;case"+critsa":v[1]+=_t("msg_+critsa %val%",{"%val%":I[1]})+"<br>";break;case"+pierce":v[1]+="<font color='82ff88'>"+_t("msg_+pierce")+"</font><br>";break;case"+acdmg":v[1]+=_t("msg_+acdmg %val%",{"%val%":I[1]})+"<br>";break;case"+acdmg_destroyed":v[1]+=_t("msg_+acdmg_destroyed")+"<br>";break;case"+resdmg":v[1]+=_t("msg_+resdmg %val%",{"%val%":I[1]})+"<br>";break;case"+stun":v[1]+=_t("msg_+stun")+"<br>";break;case"+stun2":v[1]+=_t("msg_+stun2")+"<br>";break;case"+stun2-f":v[1]+=_t("msg_+stun2-f")+"<br>";break;case"+stun2-l":v[1]+=_t("msg_+stun2-l")+"<br>";break;case"+stun2-c":v[1]+=_t("msg_+stun2-c")+"<br>";break;case"+stun2-d":v[1]+=_t("msg_+stun2-d")+"<br>";break;case"+freeze":v[1]+="<font color='#66efff'><i>"+_t("msg_+freeze")+"</i></font><br>";break;case"+immobilize":v[1]+=_t("msg_+immobilize")+"<br>";break;case"+distract":v[1]+=_t("msg_+distract")+"<br>";break;case"+fastarrow":v[1]+="<font color='fffd78'><i>"+_t("msg_+fastarrow")+"</i></font><br>";break;case"+engback":v[1]+=_t("msg_+engback %val%",{"%val%":mp(I[1])})+"<br>";break;case"+swing":v[1]+=_t("msg_+swing")+"<br>";break;case"+injure":v[1]+="<font color='ff829f'><b><i>"+_t("msg_+injure %val%",{"%val%":I[1]})+"</i></b></font><br>";break;case"+firearrow":v[1]+=_t("msg_+firearrow")+"<br>";break;case"+manadest":case"-manadest":1==(N=I[1].split(",")).length?v[1]+=_t(`msg_${I[0]} %val%`,{"%val%":I[1]})+"<br>":v[1]+=_t(`msg_${I[0]}_multi %val%`,{"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"dmg_hpp":v[1]+=_t("msg_-dmg_hpp")+"<br>";break;case"+endest":case"-endest":1==(N=I[1].split(",")).length?v[1]+=_t(`msg_${I[0]} %val%`,{"%val%":I[1]})+"<br>":v[1]+=_t(`msg_${I[0]}_multi %val%`,{"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"+abdest":v[1]+=_t("msg_+abdest %val%",{"%val%":I[1]})+"<br>";break;case"+actdmg":v[1]+=_t("msg_+actdmg %val%",{"%val%":I[1]})+"<br>";break;case"resfire_per":v[1]+=_t("msg_resfire_per %val%",{"%val%":I[1]})+"<br>";break;case"reslight_per":v[1]+=_t("msg_reslight_per %val%",{"%val%":I[1]})+"<br>";break;case"resfrost_per":v[1]+=_t("msg_resfrost_per %val%",{"%val%":I[1]})+"<br>";break;case"mana":I[1]>0?console.warn("[BattleMessage.js, battleMsg] Mana error"):v[1]+=_t("msg_receivemana %name% %val%",{"%name%":c.name,"%val%":Math.abs(I[1])})+"<br>";break;case"+resdmgf":v[1]+=_t("msg_+resdmgf %val%",{"%val%":I[1]})+"<br>";break;case"+resdmgc":v[1]+=_t("msg_+resdmgc %val%",{"%val%":I[1]})+"<br>";break;case"+resdmgl":v[1]+=_t("msg_+resdmgl %val%",{"%val%":I[1]})+"<br>";break;case"+legbon_verycrit":v[1]+="<font color='ff53a8'><b><i>"+_t("msg_+legbon_verycrit")+"</i></b></font><br>";break;case"+mcurse":v[1]+=_t("msg_+mcurse")+"<br>";break;case"-legbon_cleanse":v[2]+="<font color='ff9999'><b>"+_t("msg_-legbon_cleanse")+"</b></font><br>";break;case"-legbon_glare":v[2]+="<font color='ffe25b'><b>"+_t("msg_-legbon_glare")+"</b></font><br>";break;case"+superspell-prevented":v[2]+=_t("msg_+superspell-prevented")+"<br>";break;case"+legbon_curse":v[1]+="<font color='ffe25b'><b>"+_t("msg_+legbon_curse")+"</b></font><br>";break;case"+legbon_pushback":v[1]+=_t("msg_+legbon_pushback")+"<br>";break;case"+legbon_holytouch":v[1]+="<font color='00fff0'><i><b>"+_t("msg_+legbon_holytouch %val%")+"</b></i></font><br>";break;case"legbon_holytouch_heal":v[1]+="<font color='00fff0'><i><b>"+_t("msg_legbon_holytouch_heal %val%",{"%val%":I[1],"%name%":c.name})+"</b></i></font><br>",E="neu";break;case"-legbon_dmgred":v[1]+=_t("msg_-legbon_dmgred %val%",{"%val%":I[1]})+"<br>";break;case"anguish":let a=I[1].split(",");console.log("anguish"),E="neu",1==a.length?v[1]+=_t("msg_anguish %name% %hpp% %val0%",{"%name%":T,"%hpp%":c.hpp,"%val0%":a[0]})+"<br>":v[1]+=_t("msg_anguish %name% %hpp% %val0% %val1%",{"%name%":T,"%hpp%":c.hpp,"%val0%":a[0],val1:a[1]})+"<br>";break;case"-legbon_facade":v[1]+=_t("msg_-legbon_facade %val%",{"%val%":I[1]})+"<br>",console.log("-legbon_facade");break;case"+legbon_anguish":v[1]+=_t("msg_+legbon_anguish %val%",{"%val%":I[1]})+"<br>",console.log("+legbon_anguish");break;case"-legbon_retaliation":v[1]+=_t("msg_-legbon_retaliation %val%",{"%val%":I[1]})+"<br>";break;case"+legbon_frenzy_main":v[1]+=_t("msg_+legbon_frenzy_main %val%",{"%val%":I[1]})+"<br>",console.log("+legbon_frenzy_main");break;case"+legbon_frenzy_off":v[1]+=_t("msg_+legbon_frenzy_off %val%",{"%val%":I[1]})+"<br>",console.log("msg_+legbon_frenzy_off %val%");break;case"-blok":v[2]+="<font color='8dff5b'><b>"+_t("msg_-blok %val%",{"%val%":I[1]})+"</b></font><br>";break;case"-evade":v[2]+="<font color='00baff'><b>"+_t("msg_-evade")+"</b></font><br>";break;case"-parry":v[2]+="<font color='d1d1d1'>"+_t("msg_-parry")+"</font><br>";break;case"-pierceb":v[2]+="<font color='8dff5b'><b>"+_t("msg_-pierceb")+"</b></font><br>";break;case"-contra":v[2]+=_t("msg_-contra")+"<br>";break;case"+rage":v[2]+=_t("msg_+rage %val%",{"%val%":I[1]})+"<br>";break;case"-rage":v[2]+=_t("msg_-rage")+"<br>";break;case"+absorb":v[2]+=_t("msg_+absorb %val%",{"%val%":I[1]})+"<br>";break;case"-absorb":v[2]+=_t("msg_-absorb %val%",{"%val%":I[1]})+"<br>";break;case"+absorbm":v[2]+=_t("msg_+absorbm %val%",{"%val%":I[1]})+"<br>";break;case"-absorbm":v[2]+=_t("msg_-absorbm %val%",{"%val%":I[1]})+"<br>";break;case"-arrowblock":v[2]+=_t("msg_-arrowblock")+"<br>";break;case"-thirdatt":b+="<b class=third>-"+I[1]+"</b>",w+=I[1];break;case"-legbon_critred":v[2]+=_t("msg_-legbon_critred")+"<br>";break;case"-legbon_resgain":v[2]+=_t("msg_-legbon_resgain")+"<br>";break;case"ansgame":v[1]+=_t("msg_ansgame",{"%name%":c.name})+"<br>";break;case"+vulture":v[2]+=_t("msg_+vulture= %val%",{"%val%":I[1]})+"<br>";break;case"-reddest_per":v[2]+=_t("msg_-reddest_per %val%",{"%val%":I[1]})+"<br>";break;case"-redacdmg":v[2]+=_t("msg_-redacdmg %val%",{"%val%":I[1]})+"<br>";break;case"-redacdmg_per":v[2]+=_t("msg_-redacdmg_per %val%",{"%val%":I[1]})+"<br>";break;case"-redmanadest_per":v[2]+=_t("msg_-redmanadest_per %val%",{"%val%":I[1]})+"<br>";break;case"-redendest_per":v[2]+=_t("msg_-redendest_per %val%",{"%val%":I[1]})+"<br>";break;case"-resmanaendest":O=I[1].split(",");v[2]+=_t("msg_-resmanaendest %val%",{"%val1%":O[0],"%val2%":O[1]})+"<br>";break;case"+critpoison_per":v[2]+=_t("msg_+critpoison_per %val%",{"%val%":I[1]})+"<br>";break;case"alllowdmg":O=I[1].split(",");v[1]+=_t("msg_alllowdmg %val% %name%",{"%val%":O[0],"%name%":O[2]})+"<br>";break;case"allslow_per":O=I[1].split(",");v[1]+=_t("msg_allslow_per %val% %name%",{"%val%":O[0],"%name%":c.name})+"<br>";break;case"blackout":v[1]+=_t("msg_blackout")+"<br>";break;case"aura-adddmg2_per-meele":v[1]+=_t("msg_blesswords_perw %val% %name%",{"%val%":I[1],"%name%":c.name})+"<br>";break;case"chainlightning":break;case"chainlightning_perw":v[1]+=_t("msg_chainlightning_perw %name%",{"%name%":c.name})+"<br>";break;case"critstagnation":v[1]+=_t("msg_critstagnation")+"<br>";break;case"distractshoot":v[1]+=_t("msg_distractshoot")+"<br>";break;case"disturbshoot":v[1]+=_t("msg_disturbshoot")+"<br>";break;case"+rotatingblade":case"daggerthrow":break;case"vamp":v[1]+=_t("msg_vamp %val%",{"%name%":c.name,"%target%":d.name,"%val%":I[1]})+"<br>";break;case"woundextend":v[1]+=_t("msg_woundextend %name% %target%",{"%name%":c.name,"%target%":d.name})+"<br>";break;case"heal_per":v[1]+=_t("msg_heal_per %name%",{"%name%":c.name,"%target%":h==u?_t("part_himself"):d.name})+"<br>";break;case"heal_target":1==(N=I[1].split(",")).length?v[1]+=_t("msg_heal_target %target% %val%",{"%target%":d.name,"%val%":N[0]})+"<br>":v[1]+=_t("msg_heal_target-multi %target% %val% %val2%",{"%target%":d.name,"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"-redmanadest":v[1]+=_t("msg_-redmanadest %val%",{"%val%":I[1]})+"<br>";break;case"-redendest":v[1]+=_t("msg_-redendest %val%",{"%val%":I[1]})+"<br> ";break;case"+lowheal2turns":v[1]+=_t("msg_+lowheal2turns %val%",{"%val%":I[1]})+"<br>";break;case"-lowcritallval":v[1]+=_t("msg_-lowcritallval %val%",{"%val%":I[1]})+"<br>";break;case"surpass_bonus_total":v[1]+=_t("surpass_bonus_total %val% %name%",{"%val%":I[1],"%name%":c.name.replace(new RegExp("\\(.+?\\)"),"")})+"<br>";break;case"+crush":case"vamp_time":case"+taken_dmg":case"+critpierce":case"critval-enemies":case"critmval-enemies":case"critval-allies":case"critmval-allies":var N;if("vamp_time"!=I[0])v[1]+=_t("eng_game_only_val_"+I[0]+" %val%",{"%val%":I[1]})+"<br>";else 1==(N=I[1].split(",")).length?v[1]+=_t("eng_game_only_val_vamp_time %val%",{"%val%":N[0]})+"<br>":v[1]+=_t("eng_game_only_val_vamp_time %val% %val2%",{"%val%":N[0],"%val2%":N[1]})+"<br>";break;case"+spell-taken_dmg":v[1]+=_t("eng_game_only_nick_"+I[0]+" %name%",{"%name%":I[1]})+"<br>";break;case"+spell-vamp_time":case"distortion":case"stinkbomb_crit":case"stinkbomb_pierce":v[1]+=_t("eng_game_only_nick_"+I[0]+" %name%",{"%name%":d.name})+"<br>";break;case"heal_per-enemies":v[1]+=_t("eng_game_nick_and_value_"+I[0]+" %name% %val%",{"%name%":c.name,"%val%":Math.abs(I[1])})+"<br>";break;case"heal_per-allies":case"hp_per-allies":case"hp_per-enemies":v[1]+=_t("eng_game_nick_and_value_"+I[0]+" %name% %val%",{"%name%":c.name,"%val%":I[1]})+"<br>";break;case"dmg-target_physical":v[1]+=_t("eng_game_opponent_nick_and_value_"+I[0]+" %target% %val%",{"%target%":d.name,"%val%":I[1]})+"<br>";break;case"balloflight":case"active_decblock_per":case"active_absorbdest_per":break;case"spell-taken_dmg":case"-spell-distortion":v[1]+=_t("eng_game_nick_and_opponent_"+I[0]+" %name% %target%",{"%name%":c.name,"%target%":d.name})+"<br>";break;case"-spell-immunity_to_dmg":v[1]+=_t("eng_game_nick_and_friendnick_"+I[0]+" %name%",{"%name%":c.name})+"<br>";break;case"-immunity_to_dmg":case"+spell-taken_dmg-all":v[1]+=_t("end-game-without-percent"+I[0])+"<br>";break;case"active_decblock_per-enemies":case"active_block_per":case"+abdest_per":case"+abmdest_per":v[1]+=_t("msg_only_val_"+I[0],{"%val%":I[1]})+"<br>";break;case"tcustom":v[1]+=_t("msg_tcustom_target %target% %val%",{"%target%":d.name,"%val%":I[1]})+"<br>",E="txt";break;case"removedot":case"removedot-allies":case"removestun":v[1]+=_t("skill_"+I[0],null,"new_skills")+"<br/>";break;default:"dmg"==I[0].substr(1,3)?"+"==I[0].charAt(0)?(Engine.battle.battleEffectsController.manageBattleEffects("normalAttack",[1],c,d,i,r,o),_+="<b class="+I[0].substr(1)+">+"+I[1]+"</b>"):(b+="<b class="+I[0].substr(1)+" prof-"+c.prof+">-"+I[1]+"</b>",w-=I[1]):v[2]+=_t("msg_unknown_prameter %val%",{"%val%":i[y]})+"</b><br>"}}""!=T&&(c.name=T),"auto"==E&&(E=Engine.battle.warriorsList[h].team<2?"attack":"attack2"),""!=_&&(E=Engine.battle.warriorsList[h].team<2?"attack":"attack2",Engine.battle.warriorsList[h].setAttackAction(),v[0]=_t("msg_dmgdone %name1% %hpp% %val%",{"%name1%":c.name,"%hpp%":c.hpp,"%val%":_})+"<br>",v[2]+=_t("msg_dmgtaken %name1% %hpp% %val%",{"%name1%":d.name,"%hpp%":d.hpp,"%val%":b})+"<br>",!Engine.battle.isAuto&&a&&b&&(void 0===Engine.battle.takenQueue[d.id]&&(Engine.battle.takenQueue[d.id]=0),function(){var t=d.team==Engine.battle.myteam?"fr":"en",e=w>0?"+":"",i=t+" "+(w<0?"neg":w>0?"pos":""),a=n.get("dmg").html(e+w).addClass(i);setTimeout((function(){var t=parseInt(d.$.css("top"));a.css({top:t,left:parseInt(d.$.css("left"))-15+10*Math.random()-5}),$(".battle-area",Engine.battle.$).append(a),a.animate({top:t-40,opacity:0},1500,(function(){$(this).remove()}))}),250*Engine.battle.takenQueue[d.id]),Engine.battle.takenQueue[d.id]++}())),""!=E&&(E=" class="+E);var R="";switch(E.split("=")[1]){case"attack2":R="i";break;case"attack":R="";break;default:"neu"==E&&console.log("[BattleMessage.js, battleMsg] Warn battle"),R="neu"==E?"u":"b"}var x=v.join("");isPl()&&(x=x.replace(/#/g,f).replace(/\$/g,m));var L=strip_tags(x.replace(/<br>/gim,"\n"),!1);t.forumLog.push(""==R?L:"["+R+"]"+L+"[/"+R+"]");var D=v.join("");isPl()&&(D=D.replace(/#/g,f).replace(/\$/g,m)),D=D.replace(/\+\+/g,"+");var P=n.get("battle-msg").html(parseContentBB(D,!1)),B=E.split("=");P.addClass(B[1]),e.append(P),Engine.dead||Engine.opt(8)||(P.css("display","none"),P.fadeIn("slow")),s.appendMsg(P.clone()),t.updateScroll()}}},function(t,e,i){var n=i(0),a=i(83);t.exports=function(){let t,e,i,s,r;const o=()=>{t=n.get("battle-log-help-window")},l=()=>{let t=a.getAttachBattleLogHelpWindow();h(t)},c=()=>{e=Engine.windowManager.add({content:t,nameWindow:Engine.windowsData.name.BATTLE_LOG,title:_t("battle_logs",null,"battle"),type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,manageSize:{sizeArray:[{w:235,h:200},{w:235,h:325},{w:235,h:450},{w:235,h:600},{w:330,h:200},{w:330,h:325},{w:330,h:450},{w:330,h:600}],callback:d},managePosition:{x:"251",y:"60",position:Engine.windowsData.position.CENTER_OR_STICK_TO_EQ},addClass:"battle-log-help-window-transparent",onclose:()=>{g(!1)}}),e.addToAlertLayer(),e.center(),i=e.$.find(".scroll-wrapper"),s=e.$.find(".scroll-pane"),i.addScrollBar({track:!0}),e.$.find(".inner-content").css({"margin-top":"5px"}),e.$.find(".content").css({margin:"-17px -22px -18px"}),i.css("height","100%"),e.$.find(".scrollbar-wrapper").css({top:-13,bottom:-6}),p()},d=()=>{i.trigger("updateWhenBottom")},h=t=>{r=t},u=()=>{r&&e.show()},p=()=>{e.hide()},g=t=>{h(t),a.setAttachBattleLogHelpWindow(r),r?u():p()};this.init=()=>{o(),c(),l()},this.updateScrollbar=d,this.show=u,this.toggleAttach=()=>{g(!r)},this.hide=p,this.clear=()=>{s.empty()},this.appendMsg=t=>{t.css("opacity",1),e.$.find(".scroll-pane").append(t)}}},function(t,e){t.exports=function(){let t=this;this.showMenuSkills=function(e,i,n){let a,s,r=[],o=[],l=t.getType(i),c=2==l,d=0==l;for(let t in n)o.push(t);o.sort((function(t,e){return n[t].hotSlot-n[e].hotSlot}));for(var h=0;h<o.length;h++){let e=o[h];var u=n[e];-1!=e?-2!=e?t.canUseSkillOnThisPerson(u,i)&&(a="fight&a=spell&s="+e+"&id=",r.push(t.createMenuSkill(u.name,a,u.cost,e))):d&&(s=_t("move_forward",null,"battle"),a="fight&a=move",r.push(t.createMenuSkill(s,a,!1,-2))):c&&(s=_t("attack",null,"battle"),a="fight&a=strike&id=",r.push(t.createMenuSkill(s,a,!1,-1)))}let p=getE(e);p.clientX+=100,Engine.interface.showPopupMenu(r,p),Engine.interface.get$popUpLayer().find(".popup-menu").addClass("skill-popup-menu")},this.canUseSkillOnThisPerson=function(e,i){let n=!1,a=t.getType(i);return 8&e.attr&&!a&&(n=!0),16&e.attr&&1==a&&(n=!0),24&e.attr||2!=a||(n=!0),n},this.getType=function(t){let e=Engine.battle.warriorsList[Engine.hero.d.id],i=1;return t==e?i=0:t.team!=e.team&&(i=2),i},this.createMenuSkill=function(e,i,n,a){let s={button:{cls:"not-close menu-item-skill menu-item-skill-id-"+a}},r=Engine.interface.get$interfaceLayer().find(".icon-"+a).parent(),o=r.parent().find(".cooldown-left"),l=r.parent().find(".combo-wrapper"),c='<span class="name-menu-skill">'+e+"</span>";if(n){let e=r.parent().find(".double-cast-cost"),i=$("<span>").html("("+n+")").addClass("cost-menu-skill");if(e.length){let n=t.getCostType(r),a="("+e.html()+n+")";c+=$("<span>").html(a).addClass("menu-double-cast-cost")[0].outerHTML,i.css("display","none")}c+=i[0].outerHTML}if(-1==a&&(s.button.cls+=" one-step-skill-menu "),o.length){let t=o.clone();t.html(t.html()+"t"),c+=t[0].outerHTML,s.button.cls+=" cooldown-disabled"}if(l.length){c+=l.clone()[0].outerHTML}return[c,function(){Engine.battle.sendRequest(r,i,a)},s]},this.getCostType=function(t){return t.hasClass("m")?"m":t.hasClass("e")?"e":(console.error("[SkillBattleMenu.js, getCostType] Bad skill cost type"),"")},this.updateCooldownMenuInMenuItem=function(e,i){var n=t.getMenuSkill(e),a=t.getMenuSkill(e).find(".cooldown-left");a.length||(a=$("<div>").addClass("cooldown-left cooldown-disabled"),n.append(a),n.addClass("cooldown-disabled")),a.html(i+"t")},this.deleteCooldownFromMenuItem=function(e){let i=t.getMenuSkill(e),n=i.find(".cooldown-left");n.length&&(n.remove(),i.removeClass("cooldown-disabled"))},this.removeAllCooldown=function(){Engine.interface.get$popUpLayer().find(".menu-item-skill").find(".cooldown-left").remove(),Engine.interface.get$popUpLayer().find(".cooldown-disabled").removeClass("cooldown-disabled"),Engine.interface.get$interfaceLayer().find(".cooldown-left").remove()},this.getMenuSkill=function(t){return Engine.interface.get$popUpLayer().find(".menu-item-skill-id-"+t)},this.removeDisabledClassFromMenuSkill=function(t){Engine.interface.get$popUpLayer().find(".menu-item-skill-id-"+t).removeClass("disabled")},this.addDisabledClassToAllMenuItems=function(){Engine.interface.get$popUpLayer().find(".menu-item-skill").addClass("disabled")},this.addDoubleCastCostToMenuItem=function(e,i){let n=t.getMenuSkill(e),a=$("<span>").html("("+i+")").addClass("menu-double-cast-cost");n.append(a),n.find(".cost-menu-skill").css("display","none")},this.deleteAllDoubleCostFromMenu=function(){Engine.interface.get$popUpLayer().find(".menu-double-cast-cost").remove(),Engine.interface.get$popUpLayer().find(".cost-menu-skill").css("display","inline")},this.closeMenu=function(){Engine.interface.get$popUpLayer().find(".skill-popup-menu").remove()}}},function(t,e){t.exports=function(){let t=1;this.getAvailableHeightForBattleArea=()=>{let t=Engine.battle.getBattleController(),e=Engine.zoomFactor?Engine.zoomFactor:1,i=t.hasClass("with-skills")?0:15,n=e*t.height()-i,a=e*Engine.interface.getBottomPositioner().height(),s=e*Engine.interface.getTopPositioner().height(),r=e*Engine.interface.get$InterfaceLayerHeight()-n-a-s;return r>0?r:0},this.getAvailableWidthForBattleArea=()=>Engine.battle.$.width()*Engine.zoomFactor,this.getMaxBattleGroundHeight=()=>{let t=Engine.battle.getBattleArea(),e=Engine.zoomFactor,i=e*this.getMaxHeightMob(),n=e*Engine.battle.getYPosByLine(5),a=e*t.height(),s=a-(n-i);return s=s<a?a:s,s},this.getMaxSumWidthOfLine=()=>{let t=Engine.battle.warriors.getLines(),e=0,i=Engine.battle.warriors.getSeparatoprWidth();for(let n=0;n<t.length;n++){let a=t[n],s=0;for(let t=0;t<a.length;t++)s+=a[t].$.width(),s+=i[n];s+=60,s>e&&(e=s)}return Engine.zoomFactor*e},this.manageBattleAreaPosition=()=>{if(!getEngine().battle.zoomMode)return;let e=Engine.zoomFactor?Engine.zoomFactor:1,i=Engine.battle.getBattleArea(),n=this.getAvailableHeightForBattleArea(),a=this.getAvailableWidthForBattleArea(),s=this.getMaxBattleGroundHeight(),r=a/this.getMaxSumWidthOfLine();r=r>1?1:r;let o=n/s;o=o>1?1:o,t=r<1||o<1?Math.min(r,o):1;let l=1*n/e/2;i.css("transform","translate(-50%, -50%) scale("+t+")"),i.css("top",l+"px")},this.getFirstTakenLine=()=>{let t=Engine.battle.warriors.getLines();for(let e=0;e<t.length;e++)if(t[e].length)return e;return null},this.getLastTakenLine=()=>{let t=Engine.battle.warriors.getLines();for(let e=t.length-1;e>-1;e--)if(t[e].length)return e;return null},this.getMaxHeightMob=()=>{let t=Engine.battle.warriors.getLines(),e=0;for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<n.length;t++){let i=n[t].$.height();i>e&&(e=i)}}return e},this.getScale=()=>getEngine().battle.zoomMode?t:1}},function(t,e,i){let n=i(544),a=i(545),s=i(546),r=i(41);var o=i(57);t.exports=function(){let t,e,i,l={},c={},d={};this.clearAllEffects=()=>{i.clearWarriorsActionController()},this.getBlock=()=>c,this.getOverrideSkillsDefinitions=()=>d,this.getSkillsDefinitions=()=>l,this.getBattleEarthQuakeAction=()=>e,this.getBattleBackgroundTintAction=()=>t,this.getBattleWarriorsActionController=()=>i,this.init=()=>{t=new n,e=new a,i=new s,t.init(),e.init(),i.init(),this.initDataFromJSON()},this.updateData=t=>{if(!Engine.opt(26))for(let e=0;e<t.length;e++){let i=t[e];for(let t=0;t<i.length;t++){let e=i[t],n=this.createOneEffectData(e);this.startEffect(n)}}},this.getEmptyId=t=>{let e=0;for(;t[e];)e++;return e},this.createOneEffectData=t=>({finish:!1,data:JSON.parse(JSON.stringify(t)),effectId:null}),this.startEffect=n=>{n.data.target==r.target.SCREEN&&(n.data.effect==r.effect.SHAKE&&(e.updateData(n),e.start()),n.data.effect==r.effect.TINT&&(t.updateData(n),t.start())),n.data.target==r.target.CHARACTER&&i.updateData(n)},this.checkRepeat=(t,e)=>{let i=e.data.params.repeat;return!!i&&t<i+1},this.afterStopAction=(t,e,n)=>{this.checkRepeat(e,n)?t.start():n.data.target==r.target.CHARACTER&&i.removeAction(n)},this.updateFromBattleMessage=t=>{for(var e in console.log("START"),console.log(t.join(";")),t){let i=this.getF1F2(t[e]);console.log(i.f1,i.f2)}console.log("END"),console.log("")},this.getF1F2=t=>{let e,i,n=t.split(";"),a=0,s=0;if(n[0].indexOf("=")>0){let t=n[0].split("=");a=parseInt(t[0])}else a=parseInt(n[0]);if(n[1].indexOf("=")>0){let t=n[1].split("=");s=parseInt(t[0])}else s=parseInt(n[1]);return isset(Engine.battle.show)&&(e=a?Engine.battle.warriorsList[a]:{name:"B�?ĄD#1!"},i=s?Engine.battle.warriorsList[s]:{name:"B�?ĄD#1!"}),{f1:e,f2:i}},this.checkIsBlock=(t,e,i,n)=>{if(!e)return!1;if(!i)return!1;let a=this.getArrayToCheckBlock(i,n);for(let e in a){if(!c[a[e]])continue;let i=c[a[e]];if(t!=a[e]){if(i.all&&i.exception)return this.checkExceptionBlockList(i,t);if(i.list)for(let e in i.list)if(i.list[e]==t)return!0}}return!1},this.checkExceptionBlockList=(t,e)=>{for(let i in t.exception)if(t.exception[i]==e)return!1;return!0},this.getArrayToCheckBlock=(t,e)=>{let i=t[e];if(i.match(/skillId=([0-9]*)/g)){let n=parseInt(e);if(Number.isInteger(parseInt(n))){let a=n+1;t[a]&&(i=t[e]+","+t[a])}}return i.split(";")},this.checkNormalSkillIsOverrideBySpecificSkillEffect=(t,e,i,n)=>{if(!e)return!1;if(!i)return!1;let a=i.join(",").split(";");for(let t in a){let e=this.getSkillIdFromOneMessage(a[t]);if(null!=e&&this.checkInOverrideSkillDefinitionEffectExist(e,n))return e}return!1},this.checkInOverrideSkillDefinitionEffectExist=(t,e)=>{let i=d[t];if(!i)return!1;for(let t in i)if(i[t].effect==e)return!0;return!1},this.getSkillIdFromOneMessage=t=>{let e=t.match(/skillId=([0-9]*)/g);return e?1!=e.length?(errorReport("BattleEffectsController.js","checkNormalAttackIsOverride","skillId Attr should have only one i one msg! one msg:"+t,e),null):t.split(",")[0].replace("=","-"):null},this.manageBattleEffects=(t,e,i,n,a,s,r)=>{if(Engine.battle.getAutoFightWasCallInBattle()||!Engine.interface.alreadyInitialised||!Engine.allInit)return;if(this.checkIsBlock(t,a,s,r))return;let o=this.getCloneSkillDefinition(t,e,a,s);null!=o&&(this.manageTargetOfCloneSkillsDefinitions(o,i,n),this.manageImageUrlOfCloneSkillsDefinitions(o),this.updateData([o]))},this.getCloneSkillDefinition=(t,e,i,n)=>{if("skillId"==t){let t="skillId-"+e;return l[t]?copyStructure(l[t]):null}if(!l[t])return null;let a=null;switch(t){case"normalAttack":a=r.effect.TINT;break;case"+crit":a=r.effect.SHAKE}let s=this.checkNormalSkillIsOverrideBySpecificSkillEffect(t,i,n,a);return s?copyStructure(this.getOverrideSkillDefinitionByEffect(s,a)):copyStructure(l[t])},this.getOverrideSkillDefinitionByEffect=(t,e)=>{let i=d[t];for(let t in i)if(i[t].effect==e)return[i[t]];return null},this.manageTargetOfCloneSkillsDefinitions=(t,e,i)=>{let n=[];for(let e in t){let a=t[e];if(a.target!=r.target.CHARACTER)continue;let s=a.specificTarget;if(!s)return void console.error("[BattleEffectsController.js, manageTargetOfCloneSkillsDefinitions] ATTR specificTarget not exist!",t[e]);switch(s){case r.specificTarget.SKILL_CASTER:case r.specificTarget.SKILL_TARGET:a.id=i.id;break;case r.specificTarget.SKILL_CASTER_GROUP:this.changeGroupTargetToSingleTargetArray(a,n,Engine.battle.getGroupById(i.id),r.specificTarget.SKILL_CASTER);break;case r.specificTarget.SKILL_TARGET_GROUP:this.changeGroupTargetToSingleTargetArray(a,n,Engine.battle.getGroupById(i.id),r.specificTarget.SKILL_TARGET);break;default:return void console.error("[BattleEffectsController.js, manageTargetOfCloneSkillsDefinitions] Bad val of specificTarget",a,s)}}if(n.length){for(let e=0;e<t.length;e++){let i=t[e];i.target==r.target.CHARACTER&&(i.specificTarget!=r.specificTarget.SKILL_CASTER_GROUP&&i.specificTarget!=r.specificTarget.SKILL_TARGET_GROUP||(t.splice(e,1),e--))}for(let e=0;e<n.length;e++)t.push(n[e])}},this.changeGroupTargetToSingleTargetArray=(t,e,i,n)=>{for(let a in i){let s=JSON.parse(JSON.stringify(t));s.id=i[a].id,s.specificTarget=n,e.push(s)}},this.manageImageUrlOfCloneSkillsDefinitions=t=>{for(let e in t)if(t[e].effect==r.effect.ANIMATION&&!t[e].params.gifUrl)return void console.error("[BattleEffectsController.js, manageImageUrlOfCloneSkillsDefinitions] ATTR gifUrl not exist!",t[e])},this.checkData=(t,e)=>{let i=!0;for(let n in t){let a=t[n];for(let t in a)if("params"==t){this.checkParams(a.params,e)||(i=!1)}else{this.checkDataParam(a,t,e)||(i=!1)}}return i},this.checkData2=(t,e)=>{if(!t.skillConfig)return errorReport("BattleEffectsController.js","checkData2","skillConfig not exist: SKILL_NAME:"+e),!1;if(!t.block)return errorReport("BattleEffectsController.js","checkData2","block not exist: SKILL_NAME:"+e),!1;let i=this.checkSkillConfig(t.skillConfig,"skillConfig");if(t.overrideSkillConfig)return i;{let e=this.checkSkillConfig(t.overrideSkillConfig,"overrideSkillConfig");return i&&e}},this.checkSkillConfig=(t,e,i)=>{let n=!0;for(let a in t){let s=t[a];for(let t in s)if("params"==t){this.checkParams(s.params,e,i)||(n=!1)}else{this.checkDataParam(s,t,e,i)||(n=!1)}}return n},this.checkParams=(t,e,i)=>{let n=!1;for(let a in t){if(!r.params[a]){errorReport("BattleEffectsController.js","checkData","ListName:"+i+". Key in params not exist: "+a+", SKILL_NAME:"+e);continue}let s=t[a],o=!1;switch(a){case"position":r.params[a][s]||(o=!0);break;case"duration":case"delay":case"repeat":case"opacity":this.isNumber(s)||(o=!0);break;case"color":this.isColor(s)||(o=!0);break;case"url":this.isString(s)||(o=!0),t.gifUrl=s;break;case"gifUrl":this.isString(s)||(o=!0);break;default:errorReport("BattleEffectsController.js","checkData","ListName:"+i+". Undefined key in params:"+a+", SKILL_NAME:"+e)}o&&(n=!0,errorReport("BattleEffectsController.js","checkData","ListName:"+i+". Key in params:"+a+" has not correct:"+s+", SKILL_NAME:"+e))}return!n},this.checkDataParam=(t,e,i,n)=>{if(!r[e])return errorReport("BattleEffectsController.js","checkDataParam","ListName:"+n+". Undefined battle data effect key: "+e+", SKILL_NAME:"+i),!1;let a=t[e];if(["soundUrl"].includes(e)){if(!this.isString(a))return errorReport("BattleEffectsController.js","checkDataParam","ListName:"+n+". Key in params:"+e+" has not correct:"+a+", SKILL_NAME:"+i),!1}else if(!r[e][a])return errorReport("BattleEffectsController.js","checkDataParam","ListName:"+n+". Val in battle data effect key:"+e+" has not correct:"+a+", SKILL_NAME:"+i),!1;return!0},this.isNumber=t=>"number"==typeof t,this.isString=t=>"string"==typeof t,this.isColor=t=>{if(!this.isString(t))return!1;if(!t.length)return!1;let e=t.split(",");if(3!=e.length)return!1;for(let t in e){if(NaN==parseInt(e[t]))return!1}return!0},this.parseJSON=t=>{let e=t.skillDefinitions;for(let t in e){let i;try{i=JSON.parse(e[t].data)}catch(i){errorReport("BattleEffectsController.js","parseJSON","incorrect JSON format in BattleEffects!, SKILL_NAME: "+e[t].name+", line: "+e[t].data)}e[t].data=i,this.checkData2(e[t].data,e[t].name)||delete e[t]}for(let t in e){let i=e[t];l[i.name]=i.data.skillConfig,i.data.overrideSkillConfig&&(d[i.name]=i.data.overrideSkillConfig),Object.keys(i.data.block).length&&(c[i.name]=i.data.block)}this.onLoadGifs(),this.prepareBATTLE_EFFECT_DATA()},this.prepareBATTLE_EFFECT_DATA=()=>{for(let t in l){let e=l[t];for(let t in e){let i=e[t];i.soundUrl&&(Engine.soundManager.addToBATTLE_EFFECT_DATA(i.soundUrl,i.soundUrl),Engine.soundManager.loadToCache(i.soundUrl,o.TYPE.BATTLE_EFFECT))}}},this.onLoadGifs=()=>{for(let t in l){let e=l[t];for(let t in e){if(e[t].effect!=r.effect.ANIMATION)continue;let i=CFG.r_battleEffectsGif+e[t].params.gifUrl,n={speed:!1,externalSource:cdncrUrl};Engine.imgLoader.onload(i,n)}}},this.initDataFromJSON=()=>{let t=location.hostname.split(".")[0];"local"==t&&(t="dev");let e=cdnUrl+`/obrazki/skillEffects/${_l()}/${t}.json`;$.getJSON(e,t=>{this.parseJSON(t)})}}},function(t,e){t.exports=function(){let t,e,i,n,a,s=!1,r=1;this.init=()=>{e=Engine.battle.$.find(".battle-effect-tint")[0],t=e.getContext("2d"),this.setCanvasSize()},this.updateData=t=>{i=t},this.update=t=>{s&&(n+=3.14*t*1/i.data.params.duration,n>3.14&&(n=0,this.stop()),a=Math.round(100*Math.sin(n))/100)},this.draw=()=>{s&&(t.clearRect(0,0,e.width,e.height),t.save(),t.globalAlpha=a,t.fillStyle="rgb("+i.data.params.color+")",t.fillRect(0,0,e.width,e.height),t.restore())},this.onResize=()=>{this.setCanvasSize()},this.setCanvasSize=()=>{let t=Engine.battle.$;e.width=t.width(),e.height=t.height()},this.start=()=>{$(e).css("display","block"),n=0,s=!0},this.stop=()=>{$(e).css("display","none"),s=!1,r++,Engine.battle.battleEffectsController.afterStopAction(this,r,i)},this.getTint=()=>s?[]:[self]}},function(t,e){t.exports=function(){let t,e,i,n=1;this.init=()=>{},this.updateData=t=>{i=t},this.start=()=>{t&&this.stop(),Engine.battle.$.css({transform:"scale(1.05)"}),t=setInterval(()=>{let t=15*Math.sin(Math.random()),e=15*Math.sin(Math.random());Engine.battle.$.css({top:t,left:e})},50),e=setTimeout(()=>{Engine.battle.$.css({transform:"scale(1.0)",left:0,top:0}),this.stop()},1e3*i.data.params.duration)},this.stop=()=>{clearInterval(t),clearTimeout(e),n++,Engine.battle.battleEffectsController.afterStopAction(this,n,i)}}},function(t,e,i){let n=i(547),a=i(548),s=i(549),r=i(41);t.exports=function(){let t={},e={},i={};this.init=()=>{},this.clearWarriorsActionController=()=>{t={},e={},i={}},this.getVars=()=>[t,e,i],this.updateData=t=>{let e=t.data.effect;t.data.soundUrl&&Engine.soundManager.createBattleEffectSound(t.data.soundUrl),e==r.effect.TINT&&this.addTintAction(t),e==r.effect.SHAKE&&this.addShakeAction(t),e==r.effect.ANIMATION&&this.addAnimationAction(t)},this.addTintAction=e=>{let i=e.data.id,a=Engine.battle.getWarrior(i),s=new n;t[i]||(t[i]={});let r=Engine.battle.battleEffectsController.getEmptyId(t[i]);e.effectId=r,t[i][r]=s,t[i][r].updateData(e,a),t[i][r].start()},this.addShakeAction=t=>{let i=t.data.id,n=new a;e[i]||(e[i]={});let s=Engine.battle.battleEffectsController.getEmptyId(e[i]);t.effectId=s,e[i][s]=n,e[i][s].updateData(t),e[i][s].start()},this.addAnimationAction=t=>{let e=t.data.id,n=null;i[e]?n=i[e]:(n=new s,i[e]=n,n.init(e)),t.effectId=Engine.battle.battleEffectsController.getEmptyId(i[e].getList()),n.updateData(t)},this.removeAction=t=>{t.data.effect==r.effect.SHAKE&&this.removeShakeAction(t),t.data.effect==r.effect.TINT&&this.removeTintAction(t),t.data.effect==r.effect.ANIMATION&&this.removeAnimationAction(t)},this.removeShakeAction=t=>{let i=t.data.id,n=t.effectId;e[i]&&(delete e[i][n],Object.keys(e[i]).length||delete e[i])},this.removeTintAction=i=>{let n=i.data.id,a=i.effectId;e[n]&&(delete t[n][a],Object.keys(t[n]).length||delete t[n])},this.removeAnimationAction=t=>{let e=t.data.id,n=t.data.params.position,a=t.effectId;i[e].removeIconAnimation(a,n),i[e].checkAllAnimationEmpty()&&delete i[e]},this.updateAllEffects=e=>{for(let i in t){let n=t[i];for(let a in n)t[i][a].update(e)}for(let t in i){i[t].update(e)}},this.drawAllEffects=()=>{for(let e in t){let i=t[e];for(let n in i)t[e][n].draw()}for(let t in i){i[t].draw()}}}},function(t,e){t.exports=function(){let t,e,i,n=!1,a=1,s=0,r=null;this.init=()=>{},this.updateData=(e,i)=>{t=e,r=i},this.start=()=>{e=0,n=!0},this.stop=()=>{n=!1,a++,Engine.battle.battleEffectsController.afterStopAction(this,a,t)},this.update=a=>{n&&(this.checkDelayCanAnimationPass()?(e+=3.14*a*1/t.data.params.duration,e>3.14&&(e=0,this.stop()),i=Math.round(100*Math.sin(e))/100):s+=a)},this.checkDelayCanAnimationPass=()=>!t.data.params.delay||t.data.params.delay<s,this.draw=()=>{r.ctx&&this.checkDelayCanAnimationPass()&&(r.ctx.save(),r.ctx.fillStyle="rgba("+t.data.params.color+","+i+")",r.ctx.fillRect(0,0,r.fw,r.fh),r.ctx.globalCompositeOperation="destination-in",r.draw(!0),r.ctx.restore())}}},function(t,e){t.exports=function(){let t,e,i,n=1;this.init=()=>{},this.updateData=t=>{i=t},this.start=()=>{if(i.data.params.delay){let t=1e3*i.data.params.delay;setTimeout(()=>{this.startShake()},t)}else this.startShake()},this.startShake=()=>{let n=i.data.id,a=Engine.battle.getWarrior(n).$.find(".canvas-warrior-icon");t=setInterval(()=>{let t=10*Math.sin(Math.random()),e=10*Math.sin(Math.random());a.css({top:t,left:e})},50),e=setTimeout(()=>{a.css({left:0,top:0}),this.stop()},1e3*i.data.params.duration)},this.stop=()=>{clearInterval(t),clearTimeout(e),n++,Engine.battle.battleEffectsController.afterStopAction(this,n,i)}}},function(t,e,i){let n=i(550);i(41);t.exports=function(){let t,e={};this.init=(t,e)=>{this.setWarriorId(t)},this.getList=()=>e,this.setWarriorId=e=>{t=e},this.checkAllAnimationEmpty=()=>!Object.keys(e).length,this.initCanvas=()=>{},this.updateData=i=>{let a=new n,s=i.effectId;e[s]=a,a.init(),a.updateData(this,i,t),a.startFetch()},this.removeIconAnimation=(t,i)=>{e[t].remove(),delete e[t]},this.getIndexOfIconAnimation=(t,e)=>{let i=(void 0)[e];for(let e=0;e<i.length;e++){if(i[e].getData().effectId==t)return e}return console.error("[AnimationWarriorAction.js, getIndexOfIconAnimation] Index not exist by data",t,e),-1},this.update=t=>{for(let i in e)e[i].update(t)},this.draw=()=>{for(let t in e)e[t].draw()},this.start=t=>{},this.stop=()=>{}}},function(t,e,i){let n=i(41);t.exports=function(){let t=0,e=null,i=null,a=1,s=null,r=null,o=null,l=null,c=!1,d=null,h=null,u=!1,p=null,g=null,f=null,m=null;this.init=()=>{},this.createCanvas=()=>{let t=d.data.params.position.toLowerCase();p=document.createElement("canvas"),g=p.getContext("2d");let e=$(p);e.addClass("canvas-graphic-effect canvas-icon-wrapper-"+t),m.append(e)},this.getFH=()=>l,this.getFW=()=>o,this.getData=()=>d,this.getFetchReady=()=>c,this.getDrawIcon=()=>u,this.set$warrior=()=>{m=Engine.battle.getBattleArea().find(".other-id-battle-"+f)},this.updateData=(t,e,i)=>{h=t,d=e,f=i,this.set$warrior(),this.createCanvas()},this.update=n=>{if(u&&r&&r.length>1){let a=100*n;e+=a,t+=a,r[i].delay<e&&(e-=r[i].delay,r.length==i+1?(i=0,this.stop()):i+=1)}},this.draw=()=>{if(!u)return;let t=d.data.params.opacity;t&&(g.save(),g.globalAlpha=t),g.clearRect(0,0,o,l),g.drawImage(s,0,-i*l),t&&g.restore()},this.start=()=>{e=0,i=0,u=!0},this.stop=()=>{u=!1,a++,Engine.battle.battleEffectsController.afterStopAction(this,a,d)},this.startFetch=()=>{let t=this,e=CFG.r_battleEffectsGif+d.data.params.gifUrl,i={speed:!1,externalSource:cdncrUrl};Engine.imgLoader.onload(e,i,(e,i)=>{t.beforeOnload(i,e)},e=>{t.afterOnload()})},this.beforeOnload=(t,e)=>{s=e,o=t.hdr.width,l=t.hdr.height,r=t.frames,c=!0},this.afterOnload=()=>{let t;switch(d.data.params.position){case n.params.position.TOP:t=this.setPosition_topCanvas;break;case n.params.position.RIGHT:t=this.setPosition_rightCanvas;break;case n.params.position.BOTTOM:t=this.setPosition_bottomCanvas;break;case n.params.position.LEFT:t=this.setPosition_leftCanvas;break;case n.params.position.CENTER:t=this.setPosition_centerCanvas;break;default:console.error("[AnimationWarriorAction.js, rebuildCanvasPosition] Position not exist!",d.params.position)}let e=t(m.width(),m.height());p.width=o,p.height=l,$(p).css(e),this.start()},this.setPosition_topCanvas=(t,e)=>({top:-l+"px",left:t/2-o/2+"px"}),this.setPosition_rightCanvas=(t,e)=>({top:e/2-l/2+"px",left:t+"px"}),this.setPosition_bottomCanvas=(t,e)=>({top:e+"px",left:t/2-o/2+"px"}),this.setPosition_leftCanvas=(t,e)=>({top:e/2-l/2+"px",left:-o+"px"}),this.setPosition_centerCanvas=(t,e)=>({top:t/2-l/2+"px",left:t/2-o/2+"px"}),this.remove=()=>{$(p).remove()}}},function(t,e,i){let n=i(31);t.exports=function(){let t,e="BattleNight.js",i=null,a=null,s=!1,r=0,o=[],l=0,c={};const d=t=>{s=t},h=()=>{i=Engine.battle.$.find(".battle-night2-layer")[0],a=i.getContext("2d")},u=()=>{let t=getEngine().battle.$,e=t.width(),i=t.height();f(e,i),g(e,i)},p=()=>{for(let t=0;t<4;t++){let t=document.createElement("canvas");o.push(t)}},g=(t,e)=>{for(let i=0;i<4;i++)o[i].width=t,o[i].height=e},f=(t,e)=>{i.width=t,i.height=e},m=()=>{let t=_();for(let e in t)t[e].draw(a)},v=()=>{let t=i.width,e=i.height;a.clearRect(0,0,t,e)},E=()=>{const t="drawActualFrameOfNight";o[r]?i.width?i.height?a.drawImage(o[r],0,0):errorReport(e,t,"battleNight.height not exist!"):errorReport(e,t,"battleNight.width not exist!"):errorReport(e,t,"framesOfNight[actualFrame] not exist!")},_=()=>{let t=[],e=getEngine().nightController.checkNight();for(let i in c){let n=!1,a=c[i].onlyNight;c[i].light&&(a?e&&(n=!0):n=!0,n&&t.push(c[i].light))}return t},b=()=>{let t={};for(let e in Engine.battle.warriorsList){let i=Engine.battle.warriorsList[e].getOriginalId();t[i]={warriorId:e,originalId:i}}return Engine.rajExtraLight.getExtraLightByNpcIdArray(t)},w=()=>{O(),T(),y(),C()},C=()=>{for(let t in c)I(t,o)},T=()=>{let t=b();if(t.length)for(let e in t){let i=t[e],n=i.extraLight.master,a=i.warriorId,s=i.extraLight.id;if("NPC"==n.kind){let t=Engine.battle.warriorsList[a];if(!t)continue;S(s,i.extraLight,a,t.xPos,t.yPos)}}},y=()=>{let t=i.width,e=i.height,n=getEngine().nightController.getCalculateStringNightColor();n||(n="0,0,0,0");let a="rgba("+n+")";for(let i in o){let n=o[i].getContext("2d");n.fillStyle=a,n.clearRect(0,0,t,e),n.fillRect(0,0,t,e)}},I=(t,e)=>{let i=A(t);for(let t=0;t<e.length;t++)k(i,e[t],t)},A=t=>c[t],k=(e,i,n)=>{let a=i.getContext("2d");a.save(),a.globalCompositeOperation="destination-out",t.drawOneHole(e.onePointDataArrayHole[n],a,!0),a.restore()},S=(e,i,n,a,s)=>{let r=getEngine(),o=GET_HARD_COPY_STRUCTURE(i.rajData),l=(r.battle.getBattleArea(),r.battle.scaleBattle.getScale()),d=r.battle.getBattleArea().position();if(a*=l,s*=l,s-=CFG.tileSize*l/2,o.x=a+d.left,o.y=s+d.top,o.r*=l,isset(o.offsetX)&&(o.offsetX*=l),isset(o.offsetY)&&(o.offsetY*=l),isset(o.gradientPercent1)&&(o.gradientPercent1*=l),isset(o.gradientPercent2)&&(o.gradientPercent2*=l),c[e]={id:e,rajData:o,onePointDataArrayHole:t.getOnePoint(o,4,!0,!1),light:null,onlyNight:!0,master:{id:n,kind:"WARRIOR",originalId:i.master.id,originalKind:i.master.kind}},!i.light)return;let h=r.nightController.createOneLightPoint(o,!0);h&&(c[e].light=h,isset(i.light.onlyNight)&&(c[e].onlyNight=i.light.onlyNight))},O=()=>{c={}};this.init=()=>{t=new n,t.setRealXYPos(!0),h(),p(),u(),d(!0)},this.getDataArrayToDrawHole=b,this.rebuildBattleNight=()=>{u(),w()},this.update=t=>{o.length>1&&(l+=t,l>.2&&(l=0,r++,r+1>o.length&&(r=0)))},this.draw=()=>{s=!0,v(),m(),getEngine().nightController.checkNight()&&E()},this.onClear=()=>{O()}}},function(t,e,i){var n=i(0);let a=i(83);i(70);t.exports=function(){let t,e=null,i=null,s=null,r=null;const o=()=>{e=n.get("battle-prediction-help-window")},l=()=>{let t=a.getAttachBattlePredictionHelpWindow();h(t)},c=()=>{i=Engine.windowManager.add({content:e,nameWindow:Engine.windowsData.name.BATTLE_PREDICTION_HELP_WINDOW,title:_t("prediction"),type:Engine.windowsData.type.TRANSPARENT,manageOpacity:3,manageSize:{sizeArray:[{w:148,h:200},{w:148,h:325},{w:235,h:200},{w:235,h:325}],callback:d},managePosition:{x:"251",y:"60",position:Engine.windowsData.position.CENTER_OR_STICK_TO_EQ},addClass:"battle-prediction-help-window-transparent",onclose:()=>{g(!1)}}),i.addToAlertLayer(),i.center(),s=i.$.find(".scroll-wrapper"),r=i.$.find(".scroll-pane"),s.addScrollBar({track:!0}),i.$.find(".inner-content").css({"margin-top":"5px"}),i.$.find(".content").css({margin:"-17px -22px -18px"}),s.css("height","100%"),i.$.find(".scrollbar-wrapper").css({top:-13,bottom:-6}),p()},d=()=>{s.trigger("update")},h=e=>{t=e},u=()=>{t&&i.show()},p=()=>{i.hide()},g=e=>{h(e),a.setAttachBattlePredictionHelpWindow(t),t?u():p()};this.init=()=>{o(),c(),l()},this.clear=()=>{r.empty()},this.toggleAttach=()=>{g(!t)},this.appendWarrior=(t,e,i)=>{let n=$(t).clone(),a=n[0].querySelector(".turn-prediction__av");getEngine().battle.createAvatar(a,e,i),r.append(n)},this.updateScrollbar=d,this.show=u,this.hide=p}},function(t,e,i){"use strict";var n,a,s=this&&this.__classPrivateFieldSet||function(t,e,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(t,i):a?a.value=i:e.set(t,i),i},r=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};t.exports=(a=class{constructor(){n.set(this,void 0),this.setDefaults()}setDefaults(){s(this,n,{api_domain:"",enableme:!1,enablenar:!1,skipmute:!1,dropdestroylvl:0,loot:0,ttlootdel:!1,pvplvloff:!1,pvpstart:null,pvpend:null,nonpvpstart:null,nonpvpend:null,npcexp:0,npcresp:0,weaktitans:0,ph:0,priv_world:!1,questexp:0,supervisorIds:[],wanted_show:0,hidelvl:!1,worldname:"",pvp:!1,hardcore:!1,brutal:!1,rpg:!1},"f")}update(t){s(this,n,Object.assign(Object.assign({},r(this,n,"f")),t),"f")}getApiDomain(){return r(this,n,"f").api_domain}getEnableMe(){return r(this,n,"f").enableme}getEnableNar(){return r(this,n,"f").enablenar}getSkipMute(){return r(this,n,"f").skipmute}getDropDestroyLvl(){return r(this,n,"f").dropdestroylvl}getLoot(){return r(this,n,"f").loot}getTtlLootDel(){return r(this,n,"f").ttlootdel}getPvpLvlOff(){return r(this,n,"f").pvplvloff}getPvpStart(){return r(this,n,"f").pvpstart}getPvpEnd(){return r(this,n,"f").pvpend}getNonPvpStart(){return r(this,n,"f").nonpvpstart}getNonPvpEnd(){return r(this,n,"f").nonpvpend}getNpcExp(){return r(this,n,"f").npcexp}getNpcResp(){return r(this,n,"f").npcresp}getWeakTitans(){return r(this,n,"f").weaktitans}getPh(){return r(this,n,"f").ph}getPrivWorld(){return r(this,n,"f").priv_world}getQuestExp(){return r(this,n,"f").questexp}getSupervisorIds(){return r(this,n,"f").supervisorIds}getWantedShow(){return r(this,n,"f").wanted_show}getWorldName(){return r(this,n,"f").worldname}getPvp(){return r(this,n,"f").pvp}getHardcore(){return r(this,n,"f").hardcore}getBrutal(){return r(this,n,"f").brutal}getRpg(){return r(this,n,"f").rpg}},n=new WeakMap,a)},function(t,e,i){var n=i(73);t.exports=function(){let t={width:null,height:null},e=null,i={fileName:"Resolution.js"};const a=(t,e)=>{o(t)&&(r(t),s(),l(),e||getEngine().onResize())},s=()=>{let i=n.DATA[e].w,a=n.DATA[e].h;t.width=i,t.height=a},r=t=>{e=t},o=t=>!!n.KEY[t]||(errorReport(i,"setResolution","resolutionKey not exist!",t),!1),l=()=>{document.body.setAttribute("data-res",n.RES[e])};this.init=()=>{a(n.KEY._DEFAULT,!0)},this.setResolution=a,this.getResolutionData=()=>({w:t.width,h:t.height}),this.getResolutionKey=()=>e}},function(t,e,i){i(556);t.exports=function(){let t,e=null,i=null,n=!1;this.alwaysDraw=!0;const a=()=>{let t=CFG.oimg+"/questMapBorder/questMapCornerBorder.png";getEngine().imgLoader.onload(t,null,null,t=>{e=t})},s=()=>{let t=CFG.oimg+"/questMapBorder/questMapMiddleBorder.png";getEngine().imgLoader.onload(t,null,null,t=>{i=t})},r=()=>{let t=document.createElement("canvas"),e=t.getContext("2d");return{canvas:t,ctx:e}},o=t=>{e&&i?l(t):setTimeout(()=>{o(t)},500)},l=i=>{let a=e.width,s=e.height,r=getEngine().map.size,o=r.x*CFG.tileSize,l=r.y*CFG.tileSize,h=l-2*a,u=o-a,p=l-a,g=d(o-2*a),f=d(h),m=c(g,0,0,g.width,g.height,0,0,0,i),v=c(f,u,0,f.height,f.width,90,s,0,i),E=c(g,a,p,g.width,g.height,180,g.width,s,i),_=c(f,0,s,f.height,f.width,270,0,f.width,i);t.push(m),t.push(v),t.push(E),t.push(_);let b=i?[i.r,i.g,i.b]:[0,0,0];getEngine().map.setBackgroundColor(b),n=!0},c=(t,e,i,n,a,s,o,l,c)=>{let d=r(),h=d.canvas,u=d.ctx;return h.width=n,h.height=a,c&&(u.fillStyle=`rgb(${c.r},${c.g},${c.b})`,u.fillRect(0,0,h.width,h.height)),u.save(),u.translate(o,l),u.rotate(s*Math.PI/180),c&&(u.globalCompositeOperation="destination-in"),u.drawImage(t,0,0),u.restore(),{x:e,y:i,img:h}},d=t=>{let n=e.width,a=e.height,s=i.height,o=r(),l=o.ctx;return o.canvas.width=n+t,o.canvas.height=a,l.fillStyle=l.createPattern(i,"repeat"),l.drawImage(e,0,0),l.rect(n,0,t,s),l.fill(),o.canvas},h=()=>{t=[]},u=t=>{let e=getEngine().interface.get$interfaceLayer().find(".filter-map-night");"block"!=e.css("display")&&e.css({display:"block",background:`rgba(${t.r},${t.g},${t.b},1)`})},p=()=>{let t=getEngine().interface.get$interfaceLayer().find(".filter-map-fog");"none"!=t.css("display")&&t.css("display","none")};this.getDrawableList=()=>[this],this.getOrder=()=>getEngine().renderer.getQuestMapOrderWithoutSort(),this.draw=e=>{if(!n)return;let i=getEngine().mapShift.getShift(),a=getEngine().map.offset;for(let n=0;n<t.length;n++){let s=t[n],r=s.x-a[0]-i[0],o=s.y-a[1]-i[1];e.drawImage(s.img,Math.round(r),Math.round(o))}},this.init=()=>{h(),a(),s()},this.prepareBorderCanvas=o,this.onClear=()=>{h(),p(),u({r:57,g:37,b:83})}}},function(t,e){t.exports={RENDER_CONNECT_IMAGE_BORDER_WIDTH:50,RENDER_CONNECT_IMAGE_BORDER_HEIGHT:100}}]);